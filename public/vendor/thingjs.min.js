!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).THREE={})}(this,(function(e){"use strict";void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t});var t=0,i=1,r=2,n=1,o=2,a=3,s=0,l=1,u=2,c=0,h=1,p=2,d=0,f=1,m=2,g=3,v=4,y=5,b=100,_=101,x=102,E=103,w=104,T=200,S=201,A=202,M=203,C=204,R=205,D=206,P=207,j=208,F=209,O=210,k=0,L=1,B=2,H=3,I=4,N=5,U=6,V=7,z=0,q=1,W=2,G=0,X=1,Y=2,J=3,Q=4,Z=5,K=301,$=302,ee=303,te=304,ie=305,re=306,ne=307,oe=1e3,ae=1001,se=1002,le=1003,ue=1004,ce=1005,he=1006,pe=1007,de=1008,fe=1009,me=1010,ge=1011,ve=1012,ye=1013,be=1014,_e=1015,xe=1016,Ee=1017,we=1018,Te=1019,Se=1020,Ae=1021,Me=1022,Ce=1023,Re=1024,De=1025,Pe=Ce,je=1026,Fe=1027,Oe=1028,ke=33776,Le=33777,Be=33778,He=33779,Ie=35840,Ne=35841,Ue=35842,Ve=35843,ze=36196,qe=37808,We=37809,Ge=37810,Xe=37811,Ye=37812,Je=37813,Qe=37814,Ze=37815,Ke=37816,$e=37817,et=37818,tt=37819,it=37820,rt=37821,nt=2201,ot=2400,at=0,st=1,lt=2,ut=3e3,ct=3001,ht=3007,pt=3002,dt=3003,ft=3004,mt=3005,gt=3006,vt=3200,yt=3201,bt=0,_t=1,xt=7680,Et=519,wt=35044;function Tt(){}Object.assign(Tt.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners[e];if(void 0!==i){var r=i.indexOf(t);-1!==r&&i.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=t.slice(0),r=0,n=i.length;r<n;r++)i[r].call(this,e)}}}});for(var St=[],At=0;At<256;At++)St[At]=(At<16?"0":"")+At.toString(16);var Mt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(St[255&e]+St[e>>8&255]+St[e>>16&255]+St[e>>24&255]+"-"+St[255&t]+St[t>>8&255]+"-"+St[t>>16&15|64]+St[t>>24&255]+"-"+St[63&i|128]+St[i>>8&255]+"-"+St[i>>16&255]+St[i>>24&255]+St[255&r]+St[r>>8&255]+St[r>>16&255]+St[r>>24&255]).toUpperCase()},clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Mt.DEG2RAD},radToDeg:function(e){return e*Mt.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function Ct(e,t){this.x=e||0,this.y=t||0}function Rt(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==r?r:1}Object.defineProperties(Ct.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Ct.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}}),Object.assign(Rt,{slerp:function(e,t,i,r){return i.copy(e).slerp(t,r)},slerpFlat:function(e,t,i,r,n,o,a){var s=i[r+0],l=i[r+1],u=i[r+2],c=i[r+3],h=n[o+0],p=n[o+1],d=n[o+2],f=n[o+3];if(c!==f||s!==h||l!==p||u!==d){var m=1-a,g=s*h+l*p+u*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,a=Math.sin(a*_)/b}var x=a*v;if(s=s*m+h*x,l=l*m+p*x,u=u*m+d*x,c=c*m+f*x,m===1-a){var E=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=E,l*=E,u*=E,c*=E}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}}),Object.defineProperties(Rt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(Rt.prototype,{isQuaternion:!0,set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,r=e._y,n=e._z,o=e.order,a=Math.cos,s=Math.sin,l=a(i/2),u=a(r/2),c=a(n/2),h=s(i/2),p=s(r/2),d=s(n/2);return"XYZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"YXZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"ZXY"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"ZYX"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"YZX"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c-h*p*d):"XZY"===o&&(this._x=h*u*c-l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c+h*p*d),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],a=i[1],s=i[5],l=i[9],u=i[2],c=i[6],h=i[10],p=r+s+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(a-n)*t):r>s&&r>h?(t=2*Math.sqrt(1+r-s-h),this._w=(c-l)/t,this._x=.25*t,this._y=(n+a)/t,this._z=(o+u)/t):s>h?(t=2*Math.sqrt(1+s-r-h),this._w=(o-u)/t,this._x=(n+a)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-r-s),this._w=(a-n)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var i=e.dot(t)+1;return i<1e-6?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(Mt.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var i=this.angleTo(e);if(0===i)return this;var r=Math.min(1,t/i);return this.slerp(e,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,a=t._x,s=t._y,l=t._z,u=t._w;return this._x=i*u+o*a+r*l-n*s,this._y=r*u+o*s+n*a-i*l,this._z=n*u+o*l+i*s-r*a,this._w=o*u-i*a-r*s-n*l,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,a=o*e._w+i*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var s=1-a*a;if(s<=Number.EPSILON){var l=1-t;return this._w=l*o+t*this._w,this._x=l*i+t*this._x,this._y=l*r+t*this._y,this._z=l*n+t*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(s),c=Math.atan2(u,a),h=Math.sin((1-t)*c)/u,p=Math.sin(t*c)/u;return this._w=o*h+this._w*p,this._x=i*h+this._x*p,this._y=r*h+this._y*p,this._z=n*h+this._z*p,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var Dt=new jt,Pt=new Rt;function jt(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0}Object.assign(jt.prototype,{isVector3:!0,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Pt.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(Pt.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*r-a*i,u=s*i+a*t-n*r,c=s*r+n*i-o*t,h=-n*t-o*i-a*r;return this.x=l*s+h*-n+u*-a-c*-o,this.y=u*s+h*-o+c*-n-l*-a,this.z=c*s+h*-a+l*-o-u*-n,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-n*a,this.y=n*o-i*s,this.z=i*a-r*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(e){return Dt.copy(this).projectOnVector(e),this.sub(Dt)},reflect:function(e){return this.sub(Dt.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());0===t&&console.error("THREE.Vector3: angleTo() can't handle zero length vectors.");var i=this.dot(e)/t;return Math.acos(Mt.clamp(i,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,i){var r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var Ft,Ot=new jt;function kt(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(kt.prototype,{isMatrix3:!0,set:function(e,t,i,r,n,o,a,s,l){var u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=n,u[5]=s,u[6]=i,u[7]=o,u[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(e){for(var t=0,i=e.count;t<i;t++)Ot.x=e.getX(t),Ot.y=e.getY(t),Ot.z=e.getZ(t),Ot.applyMatrix3(this),e.setXYZ(t,Ot.x,Ot.y,Ot.z);return e},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],a=i[3],s=i[6],l=i[1],u=i[4],c=i[7],h=i[2],p=i[5],d=i[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],b=r[7],_=r[2],x=r[5],E=r[8];return n[0]=o*f+a*v+s*_,n[3]=o*m+a*y+s*x,n[6]=o*g+a*b+s*E,n[1]=l*f+u*v+c*_,n[4]=l*m+u*y+c*x,n[7]=l*g+u*b+c*E,n[2]=h*f+p*v+d*_,n[5]=h*m+p*y+d*x,n[8]=h*g+p*b+d*E,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],u=e[8];return t*o*u-t*a*l-i*n*u+i*a*s+r*n*l-r*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var i=e.elements,r=this.elements,n=i[0],o=i[1],a=i[2],s=i[3],l=i[4],u=i[5],c=i[6],h=i[7],p=i[8],d=p*l-u*h,f=u*c-p*s,m=h*s-l*c,g=n*d+o*f+a*m;if(0===g){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var y=1/g;return r[0]=d*y,r[1]=(a*h-p*o)*y,r[2]=(u*o-a*l)*y,r[3]=f*y,r[4]=(p*n-a*c)*y,r[5]=(a*s-u*n)*y,r[6]=m*y,r[7]=(o*c-h*n)*y,r[8]=(l*n-o*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,i,r,n,o,a){var s=Math.cos(n),l=Math.sin(n);this.set(i*s,i*l,-i*(s*o+l*a)+o+e,-r*l,r*s,-r*(-l*o+s*a)+a+t,0,0,1)},scale:function(e,t){var i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this},rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=this.elements,n=r[0],o=r[3],a=r[6],s=r[1],l=r[4],u=r[7];return r[0]=t*n+i*s,r[3]=t*o+i*l,r[6]=t*a+i*u,r[1]=-i*n+t*s,r[4]=-i*o+t*l,r[7]=-i*a+t*u,this},translate:function(e,t){var i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<9;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}});var Lt={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Ft&&(Ft=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Ft.width=e.width,Ft.height=e.height;var i=Ft.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Ft}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},Bt=0;function Ht(e,t,i,r,n,o,a,s,l,u){Object.defineProperty(this,"id",{value:Bt++}),this.uuid=Mt.generateUUID(),this.name="",this.image=void 0!==e?e:Ht.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Ht.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:ae,this.wrapT=void 0!==r?r:ae,this.magFilter=void 0!==n?n:he,this.minFilter=void 0!==o?o:de,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:Ce,this.type=void 0!==s?s:fe,this.offset=new Ct(0,0),this.repeat=new Ct(1,1),this.center=new Ct(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new kt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==u?u:ut,this.version=0,this.onUpdate=null}function It(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1}function Nt(e,t,i){this.width=e,this.height=t,this.scissor=new It(0,0,e,t),this.scissorTest=!1,this.viewport=new It(0,0,e,t),i=i||{},this.texture=new Ht(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:he,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function Ut(e,t,i){Nt.call(this,e,t,i),this.samples=4,this.webglDepthRenderbuffer=i?i.webglDepthRenderbuffer:null}Ht.DEFAULT_IMAGE=void 0,Ht.DEFAULT_MAPPING=300,Ht.prototype=Object.assign(Object.create(Tt.prototype),{constructor:Ht,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=Mt.generateUUID()),!t&&void 0===e.images[r.uuid]){var n;if(Array.isArray(r)){n=[];for(var o=0,a=r.length;o<a;o++)n.push(Lt.getDataURL(r[o]))}else n=Lt.getDataURL(r);e.images[r.uuid]={uuid:r.uuid,url:n}}i.image=r.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case oe:e.x=e.x-Math.floor(e.x);break;case ae:e.x=e.x<0?0:1;break;case se:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case oe:e.y=e.y-Math.floor(e.y);break;case ae:e.y=e.y<0?0:1;break;case se:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Ht.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(It.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(It.prototype,{isVector4:!0,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*n,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*n,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*n,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,n,o=e.elements,a=o[0],s=o[4],l=o[8],u=o[1],c=o[5],h=o[9],p=o[2],d=o[6],f=o[10];if(Math.abs(s-u)<.01&&Math.abs(l-p)<.01&&Math.abs(h-d)<.01){if(Math.abs(s+u)<.1&&Math.abs(l+p)<.1&&Math.abs(h+d)<.1&&Math.abs(a+c+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(c+1)/2,v=(f+1)/2,y=(s+u)/4,b=(l+p)/4,_=(h+d)/4;return m>g&&m>v?m<.01?(i=0,r=.707106781,n=.707106781):(r=y/(i=Math.sqrt(m)),n=b/i):g>v?g<.01?(i=.707106781,r=0,n=.707106781):(i=y/(r=Math.sqrt(g)),n=_/r):v<.01?(i=.707106781,r=.707106781,n=0):(i=b/(n=Math.sqrt(v)),r=_/n),this.set(i,r,n,t),this}var x=Math.sqrt((d-h)*(d-h)+(l-p)*(l-p)+(u-s)*(u-s));return Math.abs(x)<.001&&(x=1),this.x=(d-h)/x,this.y=(l-p)/x,this.z=(u-s)/x,this.w=Math.acos((a+c+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Nt.prototype=Object.assign(Object.create(Tt.prototype),{constructor:Nt,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Ut.prototype=Object.assign(Object.create(Nt.prototype),{constructor:Ut,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Nt.prototype.copy.call(this,e),this.samples=e.samples,this.webglDepthRenderbuffer=e.webglDepthRenderbuffer,this}});var Vt=new jt,zt=new Jt,qt=new jt(0,0,0),Wt=new jt(1,1,1),Gt=new jt,Xt=new jt,Yt=new jt;function Jt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Jt.prototype,{isMatrix4:!0,set:function(e,t,i,r,n,o,a,s,l,u,c,h,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Jt).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,i=e.elements,r=1/Vt.setFromMatrixColumn(e,0).length(),n=1/Vt.setFromMatrixColumn(e,1).length(),o=1/Vt.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,o=Math.cos(i),a=Math.sin(i),s=Math.cos(r),l=Math.sin(r),u=Math.cos(n),c=Math.sin(n);if("XYZ"===e.order){var h=o*u,p=o*c,d=a*u,f=a*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-a*s,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*u,g=s*c,v=l*u,y=l*c;t[0]=m+y*a,t[4]=v*a-g,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-a,t[2]=g*a-v,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){m=s*u,g=s*c,v=l*u,y=l*c;t[0]=m-y*a,t[4]=-o*c,t[8]=v+g*a,t[1]=g+v*a,t[5]=o*u,t[9]=y-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){h=o*u,p=o*c,d=a*u,f=a*c;t[0]=s*u,t[4]=d*l-p,t[8]=h*l+f,t[1]=s*c,t[5]=f*l+h,t[9]=p*l-d,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var b=o*s,_=o*l,x=a*s,E=a*l;t[0]=s*u,t[4]=E-b*c,t[8]=x*c+_,t[1]=c,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=_*c+x,t[10]=b-E*c}else if("XZY"===e.order){b=o*s,_=o*l,x=a*s,E=a*l;t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=b*c+E,t[5]=o*u,t[9]=_*c-x,t[2]=x*c-_,t[6]=a*u,t[10]=E*c+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(qt,e,Wt)},lookAt:function(e,t,i){var r=this.elements;return Yt.subVectors(e,t),0===Yt.lengthSq()&&(Yt.z=1),Yt.normalize(),Gt.crossVectors(i,Yt),0===Gt.lengthSq()&&(1===Math.abs(i.z)?Yt.x+=1e-4:Yt.z+=1e-4,Yt.normalize(),Gt.crossVectors(i,Yt)),Gt.normalize(),Xt.crossVectors(Yt,Gt),r[0]=Gt.x,r[4]=Xt.x,r[8]=Yt.x,r[1]=Gt.y,r[5]=Xt.y,r[9]=Yt.y,r[2]=Gt.z,r[6]=Xt.z,r[10]=Yt.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],a=i[4],s=i[8],l=i[12],u=i[1],c=i[5],h=i[9],p=i[13],d=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],_=i[15],x=r[0],E=r[4],w=r[8],T=r[12],S=r[1],A=r[5],M=r[9],C=r[13],R=r[2],D=r[6],P=r[10],j=r[14],F=r[3],O=r[7],k=r[11],L=r[15];return n[0]=o*x+a*S+s*R+l*F,n[4]=o*E+a*A+s*D+l*O,n[8]=o*w+a*M+s*P+l*k,n[12]=o*T+a*C+s*j+l*L,n[1]=u*x+c*S+h*R+p*F,n[5]=u*E+c*A+h*D+p*O,n[9]=u*w+c*M+h*P+p*k,n[13]=u*T+c*C+h*j+p*L,n[2]=d*x+f*S+m*R+g*F,n[6]=d*E+f*A+m*D+g*O,n[10]=d*w+f*M+m*P+g*k,n[14]=d*T+f*C+m*j+g*L,n[3]=v*x+y*S+b*R+_*F,n[7]=v*E+y*A+b*D+_*O,n[11]=v*w+y*M+b*P+_*k,n[15]=v*T+y*C+b*j+_*L,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(e){for(var t=0,i=e.count;t<i;t++)Vt.x=e.getX(t),Vt.y=e.getY(t),Vt.z=e.getZ(t),Vt.applyMatrix4(this),e.setXYZ(t,Vt.x,Vt.y,Vt.z);return e},determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],a=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],p=e[14];return e[3]*(+n*s*c-r*l*c-n*a*h+i*l*h+r*a*p-i*s*p)+e[7]*(+t*s*p-t*l*h+n*o*h-r*o*p+r*l*u-n*s*u)+e[11]*(+t*l*c-t*a*p-n*o*c+i*o*p+n*a*u-i*l*u)+e[15]*(-r*a*u-t*s*c+t*a*h+r*o*c-i*o*h+i*s*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,i){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],o=r[1],a=r[2],s=r[3],l=r[4],u=r[5],c=r[6],h=r[7],p=r[8],d=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],b=r[15],_=d*y*h-v*f*h+v*c*m-u*y*m-d*c*b+u*f*b,x=g*f*h-p*y*h-g*c*m+l*y*m+p*c*b-l*f*b,E=p*v*h-g*d*h+g*u*m-l*v*m-p*u*b+l*d*b,w=g*d*c-p*v*c-g*u*f+l*v*f+p*u*y-l*d*y,T=n*_+o*x+a*E+s*w;if(0===T){var S="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(S);return console.warn(S),this.identity()}var A=1/T;return i[0]=_*A,i[1]=(v*f*s-d*y*s-v*a*m+o*y*m+d*a*b-o*f*b)*A,i[2]=(u*y*s-v*c*s+v*a*h-o*y*h-u*a*b+o*c*b)*A,i[3]=(d*c*s-u*f*s-d*a*h+o*f*h+u*a*m-o*c*m)*A,i[4]=x*A,i[5]=(p*y*s-g*f*s+g*a*m-n*y*m-p*a*b+n*f*b)*A,i[6]=(g*c*s-l*y*s-g*a*h+n*y*h+l*a*b-n*c*b)*A,i[7]=(l*f*s-p*c*s+p*a*h-n*f*h-l*a*m+n*c*m)*A,i[8]=E*A,i[9]=(g*d*s-p*v*s-g*o*m+n*v*m+p*o*b-n*d*b)*A,i[10]=(l*v*s-g*u*s+g*o*h-n*v*h-l*o*b+n*u*b)*A,i[11]=(p*u*s-l*d*s-p*o*h+n*d*h+l*o*m-n*u*m)*A,i[12]=w*A,i[13]=(p*v*a-g*d*a+g*o*f-n*v*f-p*o*y+n*d*y)*A,i[14]=(g*u*a-l*v*a-g*o*c+n*v*c+l*o*y-n*u*y)*A,i[15]=(l*d*a-p*u*a+p*o*c-n*d*c-l*o*f+n*u*f)*A,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,a=e.y,s=e.z,l=n*o,u=n*a;return this.set(l*o+i,l*a-r*s,l*s+r*a,0,l*a+r*s,u*a+i,u*s-r*o,0,l*s-r*a,u*s+r*o,n*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){var r=this.elements,n=t._x,o=t._y,a=t._z,s=t._w,l=n+n,u=o+o,c=a+a,h=n*l,p=n*u,d=n*c,f=o*u,m=o*c,g=a*c,v=s*l,y=s*u,b=s*c,_=i.x,x=i.y,E=i.z;return r[0]=(1-(f+g))*_,r[1]=(p+b)*_,r[2]=(d-y)*_,r[3]=0,r[4]=(p-b)*x,r[5]=(1-(h+g))*x,r[6]=(m+v)*x,r[7]=0,r[8]=(d+y)*E,r[9]=(m-v)*E,r[10]=(1-(h+f))*E,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this},decompose:function(e,t,i){var r=this.elements,n=Vt.set(r[0],r[1],r[2]).length(),o=Vt.set(r[4],r[5],r[6]).length(),a=Vt.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],zt.copy(this);var s=1/n,l=1/o,u=1/a;return zt.elements[0]*=s,zt.elements[1]*=s,zt.elements[2]*=s,zt.elements[4]*=l,zt.elements[5]*=l,zt.elements[6]*=l,zt.elements[8]*=u,zt.elements[9]*=u,zt.elements[10]*=u,t.setFromRotationMatrix(zt),i.x=n,i.y=o,i.z=a,this},makePerspective:function(e,t,i,r,n,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*n/(t-e),l=2*n/(i-r),u=(t+e)/(t-e),c=(i+r)/(i-r),h=-(o+n)/(o-n),p=-2*o*n/(o-n);return a[0]=s,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,i,r,n,o){var a=this.elements,s=1/(t-e),l=1/(i-r),u=1/(o-n),c=(t+e)*s,h=(i+r)*l,p=(o+n)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}});var Qt=new Jt,Zt=new Rt;function Kt(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._order=r||Kt.DefaultOrder}function $t(){this.mask=1}Kt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Kt.DefaultOrder="XYZ",Object.defineProperties(Kt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(Kt.prototype,{isEuler:!0,set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var r=Mt.clamp,n=e.elements,o=n[0],a=n[4],s=n[8],l=n[1],u=n[5],c=n[9],h=n[2],p=n[6],d=n[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(p,u),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(p,d),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,u))):"YZX"===t?(this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,d))):"XZY"===t?(this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(p,u),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-c,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==i&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,i){return Qt.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Qt,t,i)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return Zt.setFromEuler(this),this.setFromQuaternion(Zt,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new jt(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign($t.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return 0!=(this.mask&e.mask)}});var ei=0,ti=new jt,ii=new Rt,ri=new Jt,ni=new jt,oi=new jt,ai=new jt,si=new Rt,li=new jt(1,0,0),ui=new jt(0,1,0),ci=new jt(0,0,1),hi={type:"added"},pi={type:"removed"};function di(){Object.defineProperty(this,"id",{value:ei++}),this.uuid=Mt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=di.DefaultUp.clone();var e=new jt,t=new Kt,i=new Rt,r=new jt(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Jt},normalMatrix:{value:new kt}}),this.matrix=new Jt,this.matrixWorld=new Jt,this.matrixAutoUpdate=di.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new $t,this.visible=!0,this.renderLayer=null,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function fi(){di.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}di.DefaultUp=new jt(0,1,0),di.DefaultMatrixAutoUpdate=!0,di.prototype=Object.assign(Object.create(Tt.prototype),{constructor:di,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return ii.setFromAxisAngle(e,t),this.quaternion.multiply(ii),this},rotateOnWorldAxis:function(e,t){return ii.setFromAxisAngle(e,t),this.quaternion.premultiply(ii),this},rotateX:function(e){return this.rotateOnAxis(li,e)},rotateY:function(e){return this.rotateOnAxis(ui,e)},rotateZ:function(e){return this.rotateOnAxis(ci,e)},translateOnAxis:function(e,t){return ti.copy(e).applyQuaternion(this.quaternion),this.position.add(ti.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(li,e)},translateY:function(e){return this.translateOnAxis(ui,e)},translateZ:function(e){return this.translateOnAxis(ci,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(ri.getInverse(this.matrixWorld))},lookAt:function(e,t,i){e.isVector3?ni.copy(e):ni.set(e,t,i);var r=this.parent;this.updateWorldMatrix(!0,!1),oi.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ri.lookAt(oi,ni,this.up):ri.lookAt(ni,oi,this.up),this.quaternion.setFromRotationMatrix(ri),r&&(ri.extractRotation(r.matrixWorld),ii.setFromRotationMatrix(ri),this.quaternion.premultiply(ii.inverse()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(hi),this.dispatchEvent({type:"addedChild",object:e})):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var i=this.children.indexOf(e);return-1!==i&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(pi)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),ri.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ri.multiply(e.parent.matrixWorld)),e.applyMatrix(ri),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new jt),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Rt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(oi,e,ai),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new jt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(oi,si,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new jt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,n=0,o=r.length;n<o;n++)r[n].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function n(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isMesh&&this.drawMode!==at&&(r.drawMode=this.drawMode),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,l=a.length;s<l;s++){var u=a[s];n(e.shapes,u)}else n(e.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(s=0,l=this.material.length;s<l;s++)c.push(n(e.materials,this.material[s]));r.material=c}else r.material=n(e.materials,this.material);if(this.children.length>0){r.children=[];for(s=0;s<this.children.length;s++)r.children.push(this.children[s].toJSON(e).object)}if(t){var h=m(e.geometries),p=m(e.materials),d=m(e.textures),f=m(e.images);a=m(e.shapes);h.length>0&&(i.geometries=h),p.length>0&&(i.materials=p),d.length>0&&(i.textures=d),f.length>0&&(i.images=f),a.length>0&&(i.shapes=a)}return i.object=r,i;function m(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var i=0;i<e.children.length;i++){var r=e.children[i];this.add(r.clone())}return this}}),fi.prototype=Object.assign(Object.create(di.prototype),{constructor:fi,isScene:!0,copy:function(e,t){return di.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=di.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var mi=[new jt,new jt,new jt,new jt,new jt,new jt,new jt,new jt],gi=new jt,vi=new Ci,yi=new jt,bi=new jt,_i=new jt,xi=new jt,Ei=new jt,wi=new jt,Ti=new jt,Si=new jt,Ai=new jt,Mi=new jt;function Ci(e,t){this.min=void 0!==e?e:new jt(1/0,1/0,1/0),this.max=void 0!==t?t:new jt(-1/0,-1/0,-1/0)}function Ri(e,t,i,r,n){var o,a;for(o=0,a=e.length-3;o<=a;o+=3){Mi.fromArray(e,o);var s=n.x*Math.abs(Mi.x)+n.y*Math.abs(Mi.y)+n.z*Math.abs(Mi.z),l=t.dot(Mi),u=i.dot(Mi),c=r.dot(Mi);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>s)return!1}return!0}Object.assign(Ci.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var u=e[s],c=e[s+1],h=e[s+2];u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,o,a),this},setFromBufferAttribute:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,a=-1/0,s=0,l=e.count;s<l;s++){var u=e.getX(s),c=e.getY(s),h=e.getZ(s);u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,o,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var i=gi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new jt),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new jt),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),vi.copy(t.boundingBox),vi.applyMatrix4(e.matrixWorld),this.expandByPoint(vi.min),this.expandByPoint(vi.max));for(var i=e.children,r=0,n=i.length;r<n;r++)this.expandByObject(i[r]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new jt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,gi),gi.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(Ti),Si.subVectors(this.max,Ti),yi.subVectors(e.a,Ti),bi.subVectors(e.b,Ti),_i.subVectors(e.c,Ti),xi.subVectors(bi,yi),Ei.subVectors(_i,bi),wi.subVectors(yi,_i);var t=[0,-xi.z,xi.y,0,-Ei.z,Ei.y,0,-wi.z,wi.y,xi.z,0,-xi.x,Ei.z,0,-Ei.x,wi.z,0,-wi.x,-xi.y,xi.x,0,-Ei.y,Ei.x,0,-wi.y,wi.x,0];return!!Ri(t,yi,bi,_i,Si)&&(!!Ri(t=[1,0,0,0,1,0,0,0,1],yi,bi,_i,Si)&&(Ai.crossVectors(xi,Ei),Ri(t=[Ai.x,Ai.y,Ai.z],yi,bi,_i,Si)))},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new jt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return gi.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(gi).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()?this:(mi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),mi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),mi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),mi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),mi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),mi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),mi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),mi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(mi),this)},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Di=new Ci;function Pi(e,t){this.center=void 0!==e?e:new jt,this.radius=void 0!==t?t:0}Object.assign(Pi.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var i=this.center;void 0!==t?i.copy(t):Di.setFromPoints(e).getCenter(i);for(var r=0,n=0,o=e.length;n<o;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var i=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new jt),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Ci),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var ji=new jt,Fi=new jt,Oi=new jt,ki=new jt,Li=new jt,Bi=new jt,Hi=new jt;function Ii(e,t){this.origin=void 0!==e?e:new jt,this.direction=void 0!==t?t:new jt(0,0,-1)}Object.assign(Ii.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new jt),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,ji)),this},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new jt),t.subVectors(e,this.origin);var i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=ji.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ji.copy(this.direction).multiplyScalar(t).add(this.origin),ji.distanceToSquared(e))},distanceSqToSegment:function(e,t,i,r){Fi.copy(e).add(t).multiplyScalar(.5),Oi.copy(t).sub(e).normalize(),ki.copy(this.origin).sub(Fi);var n,o,a,s,l=.5*e.distanceTo(t),u=-this.direction.dot(Oi),c=ki.dot(this.direction),h=-ki.dot(Oi),p=ki.lengthSq(),d=Math.abs(1-u*u);if(d>0)if(o=u*c-h,s=l*d,(n=u*h-c)>=0)if(o>=-s)if(o<=s){var f=1/d;a=(n*=f)*(n+u*(o*=f)+2*c)+o*(u*n+o+2*h)+p}else o=l,a=-(n=Math.max(0,-(u*o+c)))*n+o*(o+2*h)+p;else o=-l,a=-(n=Math.max(0,-(u*o+c)))*n+o*(o+2*h)+p;else o<=-s?a=-(n=Math.max(0,-(-u*l+c)))*n+(o=n>0?-l:Math.min(Math.max(-l,-h),l))*(o+2*h)+p:o<=s?(n=0,a=(o=Math.min(Math.max(-l,-h),l))*(o+2*h)+p):a=-(n=Math.max(0,-(u*l+c)))*n+(o=n>0?l:Math.min(Math.max(-l,-h),l))*(o+2*h)+p;else o=u>0?-l:l,a=-(n=Math.max(0,-(u*o+c)))*n+o*(o+2*h)+p;return i&&i.copy(this.direction).multiplyScalar(n).add(this.origin),r&&r.copy(Oi).multiplyScalar(o).add(Fi),a},intersectSphere:function(e,t){ji.subVectors(e.center,this.origin);var i=ji.dot(this.direction),r=ji.dot(ji)-i*i,n=e.radius*e.radius;if(r>n)return null;var o=Math.sqrt(n-r),a=i-o,s=i+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var i,r,n,o,a,s,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),u>=0?(n=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(n=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),i>o||n>r?null:((n>i||i!=i)&&(i=n),(o<r||r!=r)&&(r=o),c>=0?(a=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(a=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),i>s||a>r?null:((a>i||i!=i)&&(i=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(i>=0?i:r,t)))},intersectsBox:function(e){return null!==this.intersectBox(e,ji)},intersectTriangle:function(e,t,i,r,n){Li.subVectors(t,e),Bi.subVectors(i,e),Hi.crossVectors(Li,Bi);var o,a=this.direction.dot(Hi);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}ki.subVectors(this.origin,e);var s=o*this.direction.dot(Bi.crossVectors(ki,Bi));if(s<0)return null;var l=o*this.direction.dot(Li.cross(ki));if(l<0)return null;if(s+l>a)return null;var u=-o*ki.dot(Hi);return u<0?null:this.at(u/a,n)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var Ni=new jt,Ui=new jt,Vi=new kt;function zi(e,t){this.normal=void 0!==e?e:new jt(1,0,0),this.constant=void 0!==t?t:0}Object.assign(zi.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,i){var r=Ni.subVectors(i,t).cross(Ui.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new jt),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new jt);var i=e.delta(Ni),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var n=-(e.start.dot(this.normal)+this.constant)/r;return n<0||n>1?void 0:t.copy(i).multiplyScalar(n).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new jt),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var i=t||Vi.getNormalMatrix(e),r=this.coplanarPoint(Ni).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var qi=new jt,Wi=new jt,Gi=new jt,Xi=new jt,Yi=new jt,Ji=new jt,Qi=new jt,Zi=new jt,Ki=new jt,$i=new jt;function er(e,t,i){this.a=void 0!==e?e:new jt,this.b=void 0!==t?t:new jt,this.c=void 0!==i?i:new jt}Object.assign(er,{getNormal:function(e,t,i,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new jt),r.subVectors(i,t),qi.subVectors(e,t),r.cross(qi);var n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)},getBarycoord:function(e,t,i,r,n){qi.subVectors(r,t),Wi.subVectors(i,t),Gi.subVectors(e,t);var o=qi.dot(qi),a=qi.dot(Wi),s=qi.dot(Gi),l=Wi.dot(Wi),u=Wi.dot(Gi),c=o*l-a*a;if(void 0===n&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),n=new jt),0===c)return n.set(-2,-1,-1);var h=1/c,p=(l*s-a*u)*h,d=(o*u-a*s)*h;return n.set(1-p-d,d,p)},containsPoint:function(e,t,i,r){return er.getBarycoord(e,t,i,r,Xi),Xi.x>=0&&Xi.y>=0&&Xi.x+Xi.y<=1},getUV:function(e,t,i,r,n,o,a,s){return this.getBarycoord(e,t,i,r,Xi),s.set(0,0),s.addScaledVector(n,Xi.x),s.addScaledVector(o,Xi.y),s.addScaledVector(a,Xi.z),s},isFrontFacing:function(e,t,i,r){return qi.subVectors(i,t),Wi.subVectors(e,t),qi.cross(Wi).dot(r)<0}}),Object.assign(er.prototype,{set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return qi.subVectors(this.c,this.b),Wi.subVectors(this.a,this.b),.5*qi.cross(Wi).length()},getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new jt),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return er.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new zi),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return er.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,i,r,n){return er.getUV(e,this.a,this.b,this.c,t,i,r,n)},containsPoint:function(e){return er.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return er.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new jt);var i,r,n=this.a,o=this.b,a=this.c;Yi.subVectors(o,n),Ji.subVectors(a,n),Zi.subVectors(e,n);var s=Yi.dot(Zi),l=Ji.dot(Zi);if(s<=0&&l<=0)return t.copy(n);Ki.subVectors(e,o);var u=Yi.dot(Ki),c=Ji.dot(Ki);if(u>=0&&c<=u)return t.copy(o);var h=s*c-u*l;if(h<=0&&s>=0&&u<=0)return i=s/(s-u),t.copy(n).addScaledVector(Yi,i);$i.subVectors(e,a);var p=Yi.dot($i),d=Ji.dot($i);if(d>=0&&p<=d)return t.copy(a);var f=p*l-s*d;if(f<=0&&l>=0&&d<=0)return r=l/(l-d),t.copy(n).addScaledVector(Ji,r);var m=u*d-p*c;if(m<=0&&c-u>=0&&p-d>=0)return Qi.subVectors(a,o),r=(c-u)/(c-u+(p-d)),t.copy(o).addScaledVector(Qi,r);var g=1/(m+f+h);return i=f*g,r=h*g,t.copy(n).addScaledVector(Yi,i).addScaledVector(Ji,r)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var tr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ir={h:0,s:0,l:0},rr={h:0,s:0,l:0};function nr(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}function or(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function ar(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function sr(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function lr(e,t,i,r,n,o){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new jt,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new nr,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==o?o:0}Object.assign(nr.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(e,t,i){if(e=Mt.euclideanModulo(e,1),t=Mt.clamp(t,0,1),i=Mt.clamp(i,0,1),0===t)this.r=this.g=this.b=i;else{var r=i<=.5?i*(1+t):i+t-i*t,n=2*i-r;this.r=or(n,r,e+1/3),this.g=or(n,r,e),this.b=or(n,r,e-1/3)}return this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r,n=i[1],o=i[2];switch(n){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,l=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(a,s,l)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(e)){var u=i[1],c=u.length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},setColorName:function(e){var t=tr[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=ar(e.r),this.g=ar(e.g),this.b=ar(e.b),this},copyLinearToSRGB:function(e){return this.r=sr(e.r),this.g=sr(e.g),this.b=sr(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,i,r=this.r,n=this.g,o=this.b,a=Math.max(r,n,o),s=Math.min(r,n,o),l=(s+a)/2;if(s===a)t=0,i=0;else{var u=a-s;switch(i=l<=.5?u/(a+s):u/(2-a-s),a){case r:t=(n-o)/u+(n<o?6:0);break;case n:t=(o-r)/u+2;break;case o:t=(r-n)/u+4}t/=6}return e.h=t,e.s=i,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,i){return this.getHSL(ir),ir.h+=e,ir.s+=t,ir.l+=i,this.setHSL(ir.h,ir.s,ir.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(ir),e.getHSL(rr);var i=Mt.lerp(ir.h,rr.h,t),r=Mt.lerp(ir.s,rr.s,t),n=Mt.lerp(ir.l,rr.l,t);return this.setHSL(i,r,n),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()},getColorKeyword:function(){return tr}}),nr.NAMES=tr,Object.assign(lr.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var ur=0;function cr(){Object.defineProperty(this,"id",{value:ur++}),this.uuid=Mt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=f,this.side=s,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=c,this.opacity=1,this.transparent=!1,this.blendSrc=C,this.blendDst=R,this.blendEquation=b,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=H,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Et,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=xt,this.stencilZFail=xt,this.stencilZPass=xt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.colorMapping=null,this.baseQuaternion=null,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function hr(e){cr.call(this),this.type="MeshBasicMaterial",this.color=new nr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}function pr(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=wt,this.updateRange={offset:0,count:-1},this.resizeDirty=!1,this.version=0}function dr(e,t,i){pr.call(this,new Int8Array(e),t,i)}function fr(e,t,i){pr.call(this,new Uint8Array(e),t,i)}function mr(e,t,i){pr.call(this,new Uint8ClampedArray(e),t,i)}function gr(e,t,i){pr.call(this,new Int16Array(e),t,i)}function vr(e,t,i){pr.call(this,new Uint16Array(e),t,i)}function yr(e,t,i){pr.call(this,new Int32Array(e),t,i)}function br(e,t,i){pr.call(this,new Uint32Array(e),t,i)}function _r(e,t,i){pr.call(this,new Float32Array(e),t,i)}function xr(e,t,i){pr.call(this,new Float64Array(e),t,i)}function Er(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function wr(e){if(0===e.length)return-1/0;for(var t=e[0],i=1,r=e.length;i<r;++i)e[i]>t&&(t=e[i]);return t}cr.prototype=Object.assign(Object.create(Tt.prototype),{constructor:cr,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity,i.refractionRatio=this.refractionRatio,void 0!==this.combine&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==f&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==s&&(i.side=this.side),this.vertexColors!==c&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){var n=r(e.textures),o=r(e.images);n.length>0&&(i.textures=n),o.length>0&&(i.images=o)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,i=null;if(null!==t){var r=t.length;i=new Array(r);for(var n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this.colorMapping=e.colorMapping,e.baseQuaternion?this.baseQuaternion=e.baseQuaternion.clone():this.baseQuaternion=null,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(cr.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),hr.prototype=Object.create(cr.prototype),hr.prototype.constructor=hr,hr.prototype.isMeshBasicMaterial=!0,hr.prototype.copy=function(e){return cr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Object.defineProperty(pr.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(pr.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new nr),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new Ct),t[i++]=o.x,t[i++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new jt),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new It),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),dr.prototype=Object.create(pr.prototype),dr.prototype.constructor=dr,fr.prototype=Object.create(pr.prototype),fr.prototype.constructor=fr,mr.prototype=Object.create(pr.prototype),mr.prototype.constructor=mr,gr.prototype=Object.create(pr.prototype),gr.prototype.constructor=gr,vr.prototype=Object.create(pr.prototype),vr.prototype.constructor=vr,yr.prototype=Object.create(pr.prototype),yr.prototype.constructor=yr,br.prototype=Object.create(pr.prototype),br.prototype.constructor=br,_r.prototype=Object.create(pr.prototype),_r.prototype.constructor=_r,xr.prototype=Object.create(pr.prototype),xr.prototype.constructor=xr,Object.assign(Er.prototype,{computeGroups:function(e){for(var t,i=[],r=void 0,n=e.faces,o=0;o<n.length;o++){var a=n[o];a.materialIndex!==r&&(r=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,i.push(t)),t={start:3*o,materialIndex:r})}void 0!==t&&(t.count=3*o-t.start,i.push(t)),this.groups=i},fromGeometry:function(e){var t,i=e.faces,r=e.vertices,n=e.faceVertexUvs,o=n[0]&&n[0].length>0,a=n[1]&&n[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var u=0;u<l;u++)t[u]={name:s[u].name,data:[]};this.morphTargets.position=t}var c,h=e.morphNormals,p=h.length;if(p>0){c=[];for(u=0;u<p;u++)c[u]={name:h[u].name,data:[]};this.morphTargets.normal=c}var d=e.skinIndices,f=e.skinWeights,m=d.length===r.length,g=f.length===r.length;r.length>0&&0===i.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(u=0;u<i.length;u++){var v=i[u];this.vertices.push(r[v.a],r[v.b],r[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var b=v.normal;this.normals.push(b,b,b)}var _,x=v.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var E=v.color;this.colors.push(E,E,E)}if(!0===o)void 0!==(_=n[0][u])?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new Ct,new Ct,new Ct));if(!0===a)void 0!==(_=n[1][u])?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new Ct,new Ct,new Ct));for(var w=0;w<l;w++){var T=s[w].vertices;t[w].data.push(T[v.a],T[v.b],T[v.c])}for(w=0;w<p;w++){var S=h[w].vertexNormals[u];c[w].data.push(S.a,S.b,S.c)}m&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),g&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var Tr=1,Sr=new Jt,Ar=new di,Mr=new jt,Cr=new Ci,Rr=new Ci,Dr=new jt;function Pr(){Object.defineProperty(this,"id",{value:Tr+=2}),this.uuid=Mt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Pr.prototype=Object.assign(Object.create(Tt.prototype),{constructor:Pr,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(wr(e)>65535?br:vr)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var i=this.attributes.normal;void 0!==i&&((new kt).getNormalMatrix(e).applyToBufferAttribute(i),i.needsUpdate=!0);var r=this.attributes.tangent;void 0!==r&&((new kt).getNormalMatrix(e).applyToBufferAttribute(r),r.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return Sr.makeRotationX(e),this.applyMatrix(Sr),this},rotateY:function(e){return Sr.makeRotationY(e),this.applyMatrix(Sr),this},rotateZ:function(e){return Sr.makeRotationZ(e),this.applyMatrix(Sr),this},translate:function(e,t,i){return Sr.makeTranslation(e,t,i),this.applyMatrix(Sr),this},scale:function(e,t,i){return Sr.makeScale(e,t,i),this.applyMatrix(Sr),this},lookAt:function(e){return Ar.lookAt(e),Ar.updateMatrix(),this.applyMatrix(Ar.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Mr).negate(),this.translate(Mr.x,Mr.y,Mr.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var i=new _r(3*t.vertices.length,3),r=new _r(3*t.colors.length,3);if(this.setAttribute("position",i.copyVector3sArray(t.vertices)),this.setAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new _r(t.lineDistances.length,1);this.setAttribute("lineDistance",n.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new _r(t,3)),this},updateFromObject:function(e){var t,i=e.geometry;if(e.isMesh){var r=i.__directGeometry;if(!0===i.elementsNeedUpdate&&(r=void 0,i.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(i);r.verticesNeedUpdate=i.verticesNeedUpdate,r.normalsNeedUpdate=i.normalsNeedUpdate,r.colorsNeedUpdate=i.colorsNeedUpdate,r.uvsNeedUpdate=i.uvsNeedUpdate,r.groupsNeedUpdate=i.groupsNeedUpdate,i.verticesNeedUpdate=!1,i.normalsNeedUpdate=!1,i.colorsNeedUpdate=!1,i.uvsNeedUpdate=!1,i.groupsNeedUpdate=!1,i=r}return!0===i.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(i.vertices),t.needsUpdate=!0),i.verticesNeedUpdate=!1),!0===i.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(i.normals),t.needsUpdate=!0),i.normalsNeedUpdate=!1),!0===i.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(i.colors),t.needsUpdate=!0),i.colorsNeedUpdate=!1),i.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(i.uvs),t.needsUpdate=!0),i.uvsNeedUpdate=!1),i.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(i.lineDistances),t.needsUpdate=!0),i.lineDistancesNeedUpdate=!1),i.groupsNeedUpdate&&(i.computeGroups(e.geometry),this.groups=i.groups,i.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Er).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new pr(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var i=new Float32Array(3*e.normals.length);this.setAttribute("normal",new pr(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.setAttribute("color",new pr(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var n=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new pr(n,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new pr(o,2).copyVector2sArray(e.uvs2))}for(var a in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[a],u=0,c=l.length;u<c;u++){var h=l[u],p=new _r(3*h.data.length,3);p.name=h.name,s.push(p.copyVector3sArray(h.data))}this.morphAttributes[a]=s}if(e.skinIndices.length>0){var d=new _r(4*e.skinIndices.length,4);this.setAttribute("skinIndex",d.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new _r(4*e.skinWeights.length,4);this.setAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ci);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var i=0,r=t.length;i<r;i++){var n=t[i];Cr.setFromBufferAttribute(n),this.morphTargetsRelative?(Dr.addVectors(this.boundingBox.min,Cr.min),this.boundingBox.expandByPoint(Dr),Dr.addVectors(this.boundingBox.max,Cr.max),this.boundingBox.expandByPoint(Dr)):(this.boundingBox.expandByPoint(Cr.min),this.boundingBox.expandByPoint(Cr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Pi);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var i=this.boundingSphere.center;if(Cr.setFromBufferAttribute(e),t)for(var r=0,n=t.length;r<n;r++){var o=t[r];Rr.setFromBufferAttribute(o),this.morphTargetsRelative?(Dr.addVectors(Cr.min,Rr.min),Cr.expandByPoint(Dr),Dr.addVectors(Cr.max,Rr.max),Cr.expandByPoint(Dr)):(Cr.expandByPoint(Rr.min),Cr.expandByPoint(Rr.max))}Cr.getCenter(i);var a=0;for(r=0,n=e.count;r<n;r++)Dr.fromBufferAttribute(e,r),a=Math.max(a,i.distanceToSquared(Dr));if(t)for(r=0,n=t.length;r<n;r++){o=t[r];for(var s=this.morphTargetsRelative,l=0,u=o.count;l<u;l++)Dr.fromBufferAttribute(o,l),s&&(Mr.fromBufferAttribute(e,l),Dr.add(Mr)),a=Math.max(a,i.distanceToSquared(Dr))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var i=t.position.array;if(void 0===t.normal)this.setAttribute("normal",new pr(new Float32Array(i.length),3));else for(var r=t.normal.array,n=0,o=r.length;n<o;n++)r[n]=0;var a,s,l,u=t.normal.array,c=new jt,h=new jt,p=new jt,d=new jt,f=new jt;if(e){var m=e.array;for(n=0,o=e.count;n<o;n+=3)a=3*m[n+0],s=3*m[n+1],l=3*m[n+2],c.fromArray(i,a),h.fromArray(i,s),p.fromArray(i,l),d.subVectors(p,h),f.subVectors(c,h),d.cross(f),u[a]+=d.x,u[a+1]+=d.y,u[a+2]+=d.z,u[s]+=d.x,u[s+1]+=d.y,u[s+2]+=d.z,u[l]+=d.x,u[l+1]+=d.y,u[l+2]+=d.z}else for(n=0,o=i.length;n<o;n+=9)c.fromArray(i,n),h.fromArray(i,n+3),p.fromArray(i,n+6),d.subVectors(p,h),f.subVectors(c,h),d.cross(f),u[n]=d.x,u[n+1]=d.y,u[n+2]=d.z,u[n+3]=d.x,u[n+4]=d.y,u[n+5]=d.z,u[n+6]=d.x,u[n+7]=d.y,u[n+8]=d.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var i=this.attributes;for(var r in i)if(void 0!==e.attributes[r])for(var n=i[r].array,o=e.attributes[r],a=o.array,s=o.itemSize*t,l=Math.min(a.length,n.length-s),u=0,c=s;u<l;u++,c++)n[c]=a[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,i=e.count;t<i;t++)Dr.x=e.getX(t),Dr.y=e.getY(t),Dr.z=e.getZ(t),Dr.normalize(),e.setXYZ(t,Dr.x,Dr.y,Dr.z)},toNonIndexed:function(){function e(e,t){for(var i=e.array,r=e.itemSize,n=new i.constructor(t.length*r),o=0,a=0,s=0,l=t.length;s<l;s++){o=t[s]*r;for(var u=0;u<r;u++)n[a++]=i[o++]}return new pr(n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Pr,i=this.index.array,r=this.attributes;for(var n in r){var o=e(r[n],i);t.setAttribute(n,o)}var a=this.morphAttributes;for(n in a){for(var s=[],l=a[n],u=0,c=l.length;u<c;u++){o=e(l[u],i);s.push(o)}t.morphAttributes[n]=s}t.morphTargetsRelative=this.morphTargetsRelative;for(var h=this.groups,p=(u=0,h.length);u<p;u++){var d=h[u];t.addGroup(d.start,d.count,d.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var n=this.attributes;for(var i in n){var o=(p=n[i]).toJSON();""!==p.name&&(o.name=p.name),e.data.attributes[i]=o}var a={},s=!1;for(var i in this.morphAttributes){for(var l=this.morphAttributes[i],u=[],c=0,h=l.length;c<h;c++){var p;o=(p=l[c]).toJSON();""!==p.name&&(o.name=p.name),u.push(o)}u.length>0&&(a[i]=u,s=!0)}s&&(e.data.morphAttributes=a,e.data.morphTargetsRelative=this.morphTargetsRelative);var d=this.groups;d.length>0&&(e.data.groups=JSON.parse(JSON.stringify(d)));var f=this.boundingSphere;return null!==f&&(e.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),e},clone:function(){return(new Pr).copy(this)},copy:function(e){var t,i,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone());var o=e.attributes;for(t in o){var a=o[t];this.setAttribute(t,a.clone())}var s=e.morphAttributes;for(t in s){var l=[],u=s[t];for(i=0,r=u.length;i<r;i++)l.push(u[i].clone());this.morphAttributes[t]=l}this.morphTargetsRelative=e.morphTargetsRelative;var c=e.groups;for(i=0,r=c.length;i<r;i++){var h=c[i];this.addGroup(h.start,h.count,h.materialIndex)}var p=e.boundingBox;null!==p&&(this.boundingBox=p.clone());var d=e.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var jr=new Jt,Fr=new Ii,Or=new Pi,kr=new jt,Lr=new jt,Br=new jt,Hr=new jt,Ir=new jt,Nr=new jt,Ur=new jt,Vr=new jt,zr=new jt,qr=new Ct,Wr=new Ct,Gr=new Ct,Xr=new jt,Yr=new jt;function Jr(e,t){di.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Pr,this.material=void 0!==t?t:new hr({color:16777215*Math.random()}),this.drawMode=at,this.updateMorphTargets()}function Qr(e,t,i,r,n,o,a,s){if(null===(t.side===l?r.intersectTriangle(a,o,n,!0,s):r.intersectTriangle(n,o,a,t.side!==u,s)))return null;Yr.copy(s),Yr.applyMatrix4(e.matrixWorld);var c=i.ray.origin.distanceTo(Yr);return c<i.near||c>i.far?null:{distance:c,point:Yr.clone(),object:e}}function Zr(e,t,i,r,n,o,a,s,l,u,c,h){kr.fromBufferAttribute(n,u),Lr.fromBufferAttribute(n,c),Br.fromBufferAttribute(n,h);var p=e.morphTargetInfluences;if(t.morphTargets&&o&&p){Ur.set(0,0,0),Vr.set(0,0,0),zr.set(0,0,0);for(var d=0,f=o.length;d<f;d++){var m=p[d],g=o[d];0!==m&&(Hr.fromBufferAttribute(g,u),Ir.fromBufferAttribute(g,c),Nr.fromBufferAttribute(g,h),a?(Ur.addScaledVector(Hr,m),Vr.addScaledVector(Ir,m),zr.addScaledVector(Nr,m)):(Ur.addScaledVector(Hr.sub(kr),m),Vr.addScaledVector(Ir.sub(Lr),m),zr.addScaledVector(Nr.sub(Br),m)))}kr.add(Ur),Lr.add(Vr),Br.add(zr)}var v=Qr(e,t,i,r,kr,Lr,Br,Xr);if(v){s&&(qr.fromBufferAttribute(s,u),Wr.fromBufferAttribute(s,c),Gr.fromBufferAttribute(s,h),v.uv=er.getUV(Xr,kr,Lr,Br,qr,Wr,Gr,new Ct)),l&&(qr.fromBufferAttribute(l,u),Wr.fromBufferAttribute(l,c),Gr.fromBufferAttribute(l,h),v.uv2=er.getUV(Xr,kr,Lr,Br,qr,Wr,Gr,new Ct));var y=new lr(u,c,h);er.getNormal(kr,Lr,Br,y.normal),v.face=y}return v}Jr.prototype=Object.assign(Object.create(di.prototype),{constructor:Jr,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return di.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,i,r=this.geometry;if(r.isBufferGeometry){var n=r.morphAttributes,o=Object.keys(n);if(o.length>0){var a=n[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)i=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}else{var s=r.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var i,r=this.geometry,n=this.material,o=this.matrixWorld;if(void 0!==n&&(null===r.boundingSphere&&r.computeBoundingSphere(),Or.copy(r.boundingSphere),Or.applyMatrix4(o),!1!==e.ray.intersectsSphere(Or)&&(jr.getInverse(o),Fr.copy(e.ray).applyMatrix4(jr),null===r.boundingBox||!1!==Fr.intersectsBox(r.boundingBox))))if(this.drawMode===at||this.drawMode===st){if(r.isBufferGeometry){var a,s,l,u,c,h,p,d,f,m,g,v=r.index,y=r.attributes.position,b=r.morphAttributes.position,_=r.morphTargetsRelative,x=r.attributes.uv,E=r.attributes.uv2,w=r.groups,T=r.drawRange;if(null!==v)if(Array.isArray(n))for(u=0,h=w.length;u<h;u++)for(f=n[(d=w[u]).materialIndex],m=Math.max(d.start,T.start),g=Math.min(d.start+d.count,T.start+T.count),c=m,p=g=Math.min(g,v.count);c<p;c+=3)a=v.getX(c),s=v.getX(c+1),l=v.getX(c+2),(i=Zr(this,f,e,Fr,y,b,_,x,E,a,s,l))&&(i.faceIndex=Math.floor(c/3),i.face.materialIndex=d.materialIndex,t.push(i));else for(u=m=Math.max(0,T.start),h=g=Math.min(v.count,T.start+T.count);u<h;u+=3)a=v.getX(u),s=v.getX(u+1),l=v.getX(u+2),(i=Zr(this,n,e,Fr,y,b,_,x,E,a,s,l))&&(i.faceIndex=Math.floor(u/3),t.push(i));else if(void 0!==y){var S=this.drawMode===st,A=S?1:3;if(Array.isArray(n))for(u=0,h=w.length;u<h;u++)for(f=n[(d=w[u]).materialIndex],m=Math.max(d.start,T.start),g=Math.min(d.start+d.count,T.start+T.count),g=Math.min(g,y.count),S&&(g-=2),c=m,p=g;c<p;c+=A)(i=Zr(this,f,e,Fr,y,b,_,x,E,a=c,s=c+1,l=c+2))&&(i.faceIndex=Math.floor(c/A),i.face.materialIndex=d.materialIndex,t.push(i));else for(m=Math.max(0,T.start),g=Math.min(y.count,T.start+T.count),S&&(g-=2),u=m,h=g;u<h;u+=A)(i=Zr(this,n,e,Fr,y,b,_,x,E,a=u,s=u+1,l=u+2))&&(i.faceIndex=Math.floor(u/A),t.push(i))}}else if(r.isGeometry){var M,C,R,D,P=Array.isArray(n),j=r.vertices,F=r.faces,O=r.faceVertexUvs[0];O.length>0&&(D=O);for(var k=0,L=F.length;k<L;k++){var B=F[k],H=P?n[B.materialIndex]:n;if(void 0!==H&&(M=j[B.a],C=j[B.b],R=j[B.c],i=Qr(this,H,e,Fr,M,C,R,Xr))){if(D&&D[k]){var I=D[k];qr.copy(I[0]),Wr.copy(I[1]),Gr.copy(I[2]),i.uv=er.getUV(Xr,M,C,R,qr,Wr,Gr,new Ct)}i.face=B,i.faceIndex=k,t.push(i)}}}}else console.warn("THREE.Mesh: TriangleFanDrawMode are not supported by .raycast().")},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Kr=0,$r=new Jt,en=new di,tn=new jt;function rn(){Object.defineProperty(this,"id",{value:Kr+=2}),this.uuid=Mt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}rn.prototype=Object.assign(Object.create(Tt.prototype),{constructor:rn,isGeometry:!0,applyMatrix:function(e){for(var t=(new kt).getNormalMatrix(e),i=0,r=this.vertices.length;i<r;i++){this.vertices[i].applyMatrix4(e)}for(i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(var o=0,a=n.vertexNormals.length;o<a;o++)n.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return $r.makeRotationX(e),this.applyMatrix($r),this},rotateY:function(e){return $r.makeRotationY(e),this.applyMatrix($r),this},rotateZ:function(e){return $r.makeRotationZ(e),this.applyMatrix($r),this},translate:function(e,t,i){return $r.makeTranslation(e,t,i),this.applyMatrix($r),this},scale:function(e,t,i){return $r.makeScale(e,t,i),this.applyMatrix($r),this},lookAt:function(e){return en.lookAt(e),en.updateMatrix(),this.applyMatrix(en.matrix),this},fromBufferGeometry:function(e){var t=this,i=null!==e.index?e.index.array:void 0,r=e.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var n=r.position.array,o=void 0!==r.normal?r.normal.array:void 0,a=void 0!==r.color?r.color.array:void 0,s=void 0!==r.uv?r.uv.array:void 0,l=void 0!==r.uv2?r.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var u=0;u<n.length;u+=3)t.vertices.push((new jt).fromArray(n,u)),void 0!==a&&t.colors.push((new nr).fromArray(a,u));function c(e,i,r,n){var u=void 0===a?[]:[t.colors[e].clone(),t.colors[i].clone(),t.colors[r].clone()],c=new lr(e,i,r,void 0===o?[]:[(new jt).fromArray(o,3*e),(new jt).fromArray(o,3*i),(new jt).fromArray(o,3*r)],u,n);t.faces.push(c),void 0!==s&&t.faceVertexUvs[0].push([(new Ct).fromArray(s,2*e),(new Ct).fromArray(s,2*i),(new Ct).fromArray(s,2*r)]),void 0!==l&&t.faceVertexUvs[1].push([(new Ct).fromArray(l,2*e),(new Ct).fromArray(l,2*i),(new Ct).fromArray(l,2*r)])}var h=e.groups;if(h.length>0)for(u=0;u<h.length;u++)for(var p=h[u],d=p.start,f=d,m=d+p.count;f<m;f+=3)void 0!==i?c(i[f],i[f+1],i[f+2],p.materialIndex):c(f,f+1,f+2,p.materialIndex);else if(void 0!==i)for(u=0;u<i.length;u+=3)c(i[u],i[u+1],i[u+2]);else for(u=0;u<n.length/3;u+=3)c(u,u+1,u+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(tn).negate(),this.translate(tn.x,tn.y,tn.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,r=new Jt;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var e=new jt,t=new jt,i=0,r=this.faces.length;i<r;i++){var n=this.faces[i],o=this.vertices[n.a],a=this.vertices[n.b],s=this.vertices[n.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t,i,r,n,o,a;for(void 0===e&&(e=!0),a=new Array(this.vertices.length),t=0,i=this.vertices.length;t<i;t++)a[t]=new jt;if(e){var s,l,u,c=new jt,h=new jt;for(r=0,n=this.faces.length;r<n;r++)o=this.faces[r],s=this.vertices[o.a],l=this.vertices[o.b],u=this.vertices[o.c],c.subVectors(u,l),h.subVectors(s,l),c.cross(h),a[o.a].add(c),a[o.b].add(c),a[o.c].add(c)}else for(this.computeFaceNormals(),r=0,n=this.faces.length;r<n;r++)a[(o=this.faces[r]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,i=this.vertices.length;t<i;t++)a[t].normalize();for(r=0,n=this.faces.length;r<n;r++){var p=(o=this.faces[r]).vertexNormals;3===p.length?(p[0].copy(a[o.a]),p[1].copy(a[o.b]),p[2].copy(a[o.c])):(p[0]=a[o.a].clone(),p[1]=a[o.b].clone(),p[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,i;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var r=(i=this.faces[e]).vertexNormals;3===r.length?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,i,r,n;for(i=0,r=this.faces.length;i<r;i++)for((n=this.faces[i]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;e<t;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var o=new rn;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(i=0,r=this.faces.length;i<r;i++)l=new jt,u={a:new jt,b:new jt,c:new jt},a.push(l),s.push(u)}var l,u,c=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),i=0,r=this.faces.length;i<r;i++)n=this.faces[i],l=c.faceNormals[i],u=c.vertexNormals[i],l.copy(n.normal),u.a.copy(n.vertexNormals[0]),u.b.copy(n.vertexNormals[1]),u.c.copy(n.vertexNormals[2])}for(i=0,r=this.faces.length;i<r;i++)(n=this.faces[i]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ci),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Pi),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e&&e.isGeometry){var r,n=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,u=this.colors,c=e.colors;void 0===i&&(i=0),void 0!==t&&(r=(new kt).getNormalMatrix(t));for(var h=0,p=a.length;h<p;h++){var d=a[h].clone();void 0!==t&&d.applyMatrix4(t),o.push(d)}for(h=0,p=c.length;h<p;h++)u.push(c[h].clone());for(h=0,p=l.length;h<p;h++){var f,m,g,v=l[h],y=v.vertexNormals,b=v.vertexColors;(f=new lr(v.a+n,v.b+n,v.c+n)).normal.copy(v.normal),void 0!==r&&f.normal.applyMatrix3(r).normalize();for(var _=0,x=y.length;_<x;_++)m=y[_].clone(),void 0!==r&&m.applyMatrix3(r).normalize(),f.vertexNormals.push(m);f.color.copy(v.color);for(_=0,x=b.length;_<x;_++)g=b[_],f.vertexColors.push(g.clone());f.materialIndex=v.materialIndex+i,s.push(f)}for(h=0,p=e.faceVertexUvs.length;h<p;h++){var E=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(_=0,x=E.length;_<x;_++){for(var w=E[_],T=[],S=0,A=w.length;S<A;S++)T.push(w[S].clone());this.faceVertexUvs[h].push(T)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,i,r,n,o,a,s,l={},u=[],c=[],h=Math.pow(10,4);for(i=0,r=this.vertices.length;i<r;i++)e=this.vertices[i],void 0===l[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(l[t]=i,u.push(this.vertices[i]),c[i]=u.length-1):c[i]=c[l[t]];var p=[];for(i=0,r=this.faces.length;i<r;i++){(n=this.faces[i]).a=c[n.a],n.b=c[n.b],n.c=c[n.c],o=[n.a,n.b,n.c];for(var d=0;d<3;d++)if(o[d]===o[(d+1)%3]){p.push(i);break}}for(i=p.length-1;i>=0;i--){var f=p[i];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},setFromPoints:function(e){this.vertices=[];for(var t=0,i=e.length;t<i;t++){var r=e[t];this.vertices.push(new jt(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,i=0;i<t;i++)e[i]._id=i;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var r,n,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===t&&(r=[]),a&&a.length===t&&(n=[]);for(i=0;i<t;i++){var s=e[i]._id;r&&r.push(o[s]),n&&n.push(a[s])}r&&(this.faceVertexUvs[0]=r),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}for(var r=[],n=0;n<this.vertices.length;n++){var o=this.vertices[n];r.push(o.x,o.y,o.z)}var a=[],s=[],l={},u=[],c={},h=[],p={};for(n=0;n<this.faces.length;n++){var d=this.faces[n],f=void 0!==this.faceVertexUvs[0][n],m=d.normal.length()>0,g=d.vertexNormals.length>0,v=1!==d.color.r||1!==d.color.g||1!==d.color.b,y=d.vertexColors.length>0,b=0;if(b=w(b,0,0),b=w(b,1,!0),b=w(b,2,!1),b=w(b,3,f),b=w(b,4,m),b=w(b,5,g),b=w(b,6,v),b=w(b,7,y),a.push(b),a.push(d.a,d.b,d.c),a.push(d.materialIndex),f){var _=this.faceVertexUvs[0][n];a.push(A(_[0]),A(_[1]),A(_[2]))}if(m&&a.push(T(d.normal)),g){var x=d.vertexNormals;a.push(T(x[0]),T(x[1]),T(x[2]))}if(v&&a.push(S(d.color)),y){var E=d.vertexColors;a.push(S(E[0]),S(E[1]),S(E[2]))}}function w(e,t,i){return i?e|1<<t:e&~(1<<t)}function T(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=s.length/3,s.push(e.x,e.y,e.z),l[t])}function S(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]?c[t]:(c[t]=u.length,u.push(e.getHex()),c[t])}function A(e){var t=e.x.toString()+e.y.toString();return void 0!==p[t]?p[t]:(p[t]=h.length/2,h.push(e.x,e.y),p[t])}return e.data={},e.data.vertices=r,e.data.normals=s,u.length>0&&(e.data.colors=u),h.length>0&&(e.data.uvs=[h]),e.data.faces=a,e},clone:function(){return(new rn).copy(this)},copy:function(e){var t,i,r,n,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,i=s.length;t<i;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,i=l.length;t<i;t++)this.colors.push(l[t].clone());var u=e.faces;for(t=0,i=u.length;t<i;t++)this.faces.push(u[t].clone());for(t=0,i=e.faceVertexUvs.length;t<i;t++){var c=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),r=0,n=c.length;r<n;r++){var h=c[r],p=[];for(o=0,a=h.length;o<a;o++){var d=h[o];p.push(d.clone())}this.faceVertexUvs[t].push(p)}}var f=e.morphTargets;for(t=0,i=f.length;t<i;t++){var m={};if(m.name=f[t].name,void 0!==f[t].vertices)for(m.vertices=[],r=0,n=f[t].vertices.length;r<n;r++)m.vertices.push(f[t].vertices[r].clone());if(void 0!==f[t].normals)for(m.normals=[],r=0,n=f[t].normals.length;r<n;r++)m.normals.push(f[t].normals[r].clone());this.morphTargets.push(m)}var g=e.morphNormals;for(t=0,i=g.length;t<i;t++){var v={};if(void 0!==g[t].vertexNormals)for(v.vertexNormals=[],r=0,n=g[t].vertexNormals.length;r<n;r++){var y=g[t].vertexNormals[r],b={};b.a=y.a.clone(),b.b=y.b.clone(),b.c=y.c.clone(),v.vertexNormals.push(b)}if(void 0!==g[t].faceNormals)for(v.faceNormals=[],r=0,n=g[t].faceNormals.length;r<n;r++)v.faceNormals.push(g[t].faceNormals[r].clone());this.morphNormals.push(v)}var _=e.skinWeights;for(t=0,i=_.length;t<i;t++)this.skinWeights.push(_[t].clone());var x=e.skinIndices;for(t=0,i=x.length;t<i;t++)this.skinIndices.push(x[t].clone());var E=e.lineDistances;for(t=0,i=E.length;t<i;t++)this.lineDistances.push(E[t]);var w=e.boundingBox;null!==w&&(this.boundingBox=w.clone());var T=e.boundingSphere;return null!==T&&(this.boundingSphere=T.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var nn=function(e){function t(t,i,r,n,o,a){e.call(this),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:r,widthSegments:n,heightSegments:o,depthSegments:a},this.fromBufferGeometry(new on(t,i,r,n,o,a)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(rn),on=function(e){function t(t,i,r,n,o,a){e.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:i,depth:r,widthSegments:n,heightSegments:o,depthSegments:a};var s=this;t=t||1,i=i||1,r=r||1,n=Math.floor(n)||1,o=Math.floor(o)||1,a=Math.floor(a)||1;var l=[],u=[],c=[],h=[],p=0,d=0;function f(e,t,i,r,n,o,a,f,m,g,v){var y,b,_=o/m,x=a/g,E=o/2,w=a/2,T=f/2,S=m+1,A=g+1,M=0,C=0,R=new jt;for(b=0;b<A;b++){var D=b*x-w;for(y=0;y<S;y++){var P=y*_-E;R[e]=P*r,R[t]=D*n,R[i]=T,u.push(R.x,R.y,R.z),R[e]=0,R[t]=0,R[i]=f>0?1:-1,c.push(R.x,R.y,R.z),h.push(y/m),h.push(1-b/g),M+=1}}for(b=0;b<g;b++)for(y=0;y<m;y++){var j=p+y+S*b,F=p+y+S*(b+1),O=p+(y+1)+S*(b+1),k=p+(y+1)+S*b;l.push(j,F,k),l.push(F,O,k),C+=6}s.addGroup(d,C,v),d+=C,p+=M}f("z","y","x",-1,-1,r,i,t,a,o,0),f("z","y","x",1,-1,r,i,-t,a,o,1),f("x","z","y",1,1,t,r,i,n,a,2),f("x","z","y",1,-1,t,r,-i,n,a,3),f("x","y","z",1,-1,t,i,r,n,o,4),f("x","y","z",-1,-1,t,i,-r,n,o,5),this.setIndex(l),this.setAttribute("position",new _r(u,3)),this.setAttribute("normal",new _r(c,3)),this.setAttribute("uv",new _r(h,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Pr);function an(e){var t={};for(var i in e)for(var r in t[i]={},e[i]){var n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}return t}function sn(e){for(var t={},i=0;i<e.length;i++){var r=an(e[i]);for(var n in r)t[n]=r[n]}return t}var ln={clone:an,merge:sn},un="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",cn="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function hn(e){cr.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=un,this.fragmentShader=cn,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function pn(){di.call(this),this.type="Camera",this.matrixWorldInverse=new Jt,this.projectionMatrix=new Jt,this.projectionMatrixInverse=new Jt}function dn(e,t,i,r){pn.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}hn.prototype=Object.create(cr.prototype),hn.prototype.constructor=hn,hn.prototype.isShaderMaterial=!0,hn.prototype.copy=function(e){return cr.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=an(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},hn.prototype.toJSON=function(e){var t=cr.prototype.toJSON.call(this,e);for(var i in t.uniforms={},this.uniforms){var r=this.uniforms[i].value;r&&r.isTexture?t.uniforms[i]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[i]={type:"m4",value:r.toArray()}:t.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var n={};for(var o in this.extensions)!0===this.extensions[o]&&(n[o]=!0);return Object.keys(n).length>0&&(t.extensions=n),t},pn.prototype=Object.assign(Object.create(di.prototype),{constructor:pn,isCamera:!0,copy:function(e,t){return di.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new jt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){di.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),dn.prototype=Object.assign(Object.create(pn.prototype),{constructor:dn,isPerspectiveCamera:!0,copy:function(e,t){return pn.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Mt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Mt.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Mt.RAD2DEG*Math.atan(Math.tan(.5*Mt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,r,n,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Mt.DEG2RAD*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;n+=o.offsetX*r/a,t-=o.offsetY*i/s,r*=o.width/a,i*=o.height/s}var l=this.filmOffset;0!==l&&(n+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=di.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var fn=90,mn=1;function gn(e,t,i,r){di.call(this),this.type="CubeCamera";var n=new dn(fn,mn,e,t);n.up.set(0,-1,0),n.lookAt(new jt(1,0,0)),this.add(n);var o=new dn(fn,mn,e,t);o.up.set(0,-1,0),o.lookAt(new jt(-1,0,0)),this.add(o);var a=new dn(fn,mn,e,t);a.up.set(0,0,1),a.lookAt(new jt(0,1,0)),this.add(a);var s=new dn(fn,mn,e,t);s.up.set(0,0,-1),s.lookAt(new jt(0,-1,0)),this.add(s);var l=new dn(fn,mn,e,t);l.up.set(0,-1,0),l.lookAt(new jt(0,0,1)),this.add(l);var u=new dn(fn,mn,e,t);u.up.set(0,-1,0),u.lookAt(new jt(0,0,-1)),this.add(u),r=r||{format:Me,magFilter:he,minFilter:he},this.renderTarget=new vn(i,i,r),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var i=e.getRenderTarget(),r=this.renderTarget,c=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,n),e.setRenderTarget(r,1),e.render(t,o),e.setRenderTarget(r,2),e.render(t,a),e.setRenderTarget(r,3),e.render(t,s),e.setRenderTarget(r,4),e.render(t,l),r.texture.generateMipmaps=c,e.setRenderTarget(r,5),e.render(t,u),e.setRenderTarget(i)},this.clear=function(e,t,i,r){for(var n=e.getRenderTarget(),o=this.renderTarget,a=0;a<6;a++)e.setRenderTarget(o,a),e.clear(t,i,r);e.setRenderTarget(n)}}function vn(e,t,i){Nt.call(this,e,t,i)}function yn(e,t,i,r,n,o,a,s,l,u,c,h){Ht.call(this,null,o,a,s,l,u,r,n,c,h),this.image={data:e||null,width:t||1,height:i||1},this.magFilter=void 0!==l?l:le,this.minFilter=void 0!==u?u:le,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}gn.prototype=Object.create(di.prototype),gn.prototype.constructor=gn,vn.prototype=Object.create(Nt.prototype),vn.prototype.constructor=vn,vn.prototype.isWebGLRenderTargetCube=!0,vn.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var i=new fi,r={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},n=new hn({type:"CubemapFromEquirect",uniforms:an(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:l,blending:d});n.uniforms.tEquirect.value=t;var o=new Jr(new on(5,5,5),n);i.add(o);var a=new gn(1,10,1);return a.renderTarget=this,a.renderTarget.texture.name="CubeCameraTexture",a.update(e,i),o.geometry.dispose(),o.material.dispose(),this},yn.prototype=Object.create(Ht.prototype),yn.prototype.constructor=yn,yn.prototype.isDataTexture=!0;var bn=new Pi,_n=new jt;function xn(e,t,i,r,n,o){this.planes=[void 0!==e?e:new zi,void 0!==t?t:new zi,void 0!==i?i:new zi,void 0!==r?r:new zi,void 0!==n?n:new zi,void 0!==o?o:new zi]}Object.assign(xn.prototype,{set:function(e,t,i,r,n,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=i[5],u=i[6],c=i[7],h=i[8],p=i[9],d=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(a-r,c-s,f-h,y-m).normalize(),t[1].setComponents(a+r,c+s,f+h,y+m).normalize(),t[2].setComponents(a+n,c+l,f+p,y+g).normalize(),t[3].setComponents(a-n,c-l,f-p,y-g).normalize(),t[4].setComponents(a-o,c-u,f-d,y-v).normalize(),t[5].setComponents(a+o,c+u,f+d,y+v).normalize(),this},intersectsObject:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),bn.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(bn)},intersectsSprite:function(e){return bn.center.set(0,0,0),bn.radius=.7071067811865476,bn.applyMatrix4(e.matrixWorld),this.intersectsSphere(bn)},intersectsSphere:function(e){for(var t=this.planes,i=e.center,r=-e.radius,n=0;n<6;n++){if(t[n].distanceToPoint(i)<r)return!1}return!0},intersectsBox:function(e){for(var t=this.planes,i=0;i<6;i++){var r=t[i];if(_n.x=r.normal.x>0?e.max.x:e.min.x,_n.y=r.normal.y>0?e.max.y:e.min.y,_n.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(_n)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}});var En={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) {\n\t\tdiscard;\n\t} else {\n\t\tdiffuseColor.a = opacity;\n\t}\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"#ifdef USE_CARTESIAN3\n    vec3 transformed = czm_converPosition(position);\n#else\n    vec3 transformed = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif\n#ifdef USE_ALPHAINDEX\n\tdiffuseColor.a *= vAlpha;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n#ifdef USE_ALPHAINDEX\n\tvarying float vAlpha;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n#ifdef USE_ALPHAINDEX\n\tattribute float alphaIndex;\n\tvarying float vAlpha;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif\n#ifdef USE_ALPHAINDEX\n\tvAlpha = alphaIndex;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nvec3 czm_converPosition( vec3 origin ) {\n   vec3 res = vec3( 0.0 );\n       res.x = -origin.x;\n       res.y = origin.z;\n       res.z = origin.y;\n       return res;\n}\nvec3 applyQuaternion ( vec3 v, vec4 q ) {\n        float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n\t\tfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\n\t\tfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\n\t\tfloat iw = - q.x * v.x - q.y * v.y - q.z * v.z;\n\t\treturn vec3( ix * q.w + iw * ( -q.x ) + iy * ( -q.z ) - iz * ( -q.y ),\n\t\t            iy * q.w + iw * ( -q.y ) + iz * ( -q.x ) - ix * ( -q.z ),\n\t\t            iz * q.w + iw * ( -q.z ) + ix * ( -q.y ) - iy * ( -q.x ) );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\ttransformedNormal = mat3( instanceMatrix ) * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t\n\t\t#ifdef  BASE_QUATERNION\n\t\t\tvec3 newNormal = applyQuaternion(worldNormal, baseQuaternion);\n\t\t#endif\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\t#ifdef  BASE_QUATERNION\n\t\t\t\n\t\t\t\tvec3 queryVec = vec3( flipEnvMap * newNormal.x, newNormal.yz );\n\t\t\t\t\n\t\t\t#else\n\t\t\t\n\t\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t\t\n            #endif\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\n\t\t\t#ifdef  BASE_QUATERNION\n\t\t\t\n\t\t\t\tvec3 queryVec = vec3( flipEnvMap * newNormal.x, newNormal.yz );\n\t\t\t\t\n\t\t\t#else\n\t\t\t\n\t\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t\t\n            #endif\n    \n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\n\t\t#ifdef  BASE_QUATERNION\n\t\t\treflectVec = applyQuaternion(reflectVec, baseQuaternion);\n\t\t\t\t\n\t\t#endif \n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n    fogFactor = fogFactor >= fogAlpha ? fogAlpha : fogFactor;\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\tuniform float fogAlpha;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = saturate( clearcoat );\tmaterial.clearcoatRoughness = clamp( clearcoatRoughness, 0.04, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_normalmap_pars_fragment:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpack2HalfToRGBA( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpack2HalfToRGBA( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = ( floor( uv * size - 0.5 ) + 0.5 ) * texelSize;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform mat4 localBindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( localBindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",colormapping_fragment:"#ifdef COLOR_MAPPING\n    float gray = clamp( dot( diffuseColor.rgb, vec3(0.333, 0.333, 0.333) ), 0.0, 1.0 );\n    diffuseColor.rgb = texture2D( colorMapping, vec2( gray, 0.5 ) ).rgb;\n  #endif",colormapping_pars_fragment:"#ifdef COLOR_MAPPING\n    uniform sampler2D colorMapping;\n  #endif",baseQuaternion_pars_fragment:"#ifdef BASE_QUATERNION\n    uniform vec4 baseQuaternion;\n  #endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nuniform mat4 colorMatrix;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = colorMatrix * mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"uniform vec4 cubeQuat;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 cubeDir = transformDirection( position, modelMatrix );\n\tvWorldDirection = applyQuaternion( cubeDir, cubeQuat );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200 || defined(ALPHATEST)\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#ifdef ALPHATEST\n\tuniform float opacity;\n#endif\n#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <colormapping_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <colormapping_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <colormapping_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <baseQuaternion_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <colormapping_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},wn={common:{diffuse:{value:new nr(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new kt},uvTransform1:{value:new kt},uvTransform2:{value:new kt},alphaMap:{value:null},alphaMap1:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ct(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new nr(16777215)},fogAlpha:{value:1}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new nr(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new kt}},sprite:{diffuse:{value:new nr(15658734)},opacity:{value:1},center:{value:new Ct(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new kt}}},Tn={basic:{uniforms:sn([wn.common,wn.specularmap,wn.envmap,wn.aomap,wn.lightmap,wn.fog]),vertexShader:En.meshbasic_vert,fragmentShader:En.meshbasic_frag},lambert:{uniforms:sn([wn.common,wn.specularmap,wn.envmap,wn.aomap,wn.lightmap,wn.emissivemap,wn.fog,wn.lights,{emissive:{value:new nr(0)}}]),vertexShader:En.meshlambert_vert,fragmentShader:En.meshlambert_frag},phong:{uniforms:sn([wn.common,wn.specularmap,wn.envmap,wn.aomap,wn.lightmap,wn.emissivemap,wn.bumpmap,wn.normalmap,wn.displacementmap,wn.gradientmap,wn.fog,wn.lights,{emissive:{value:new nr(0)},specular:{value:new nr(1118481)},shininess:{value:30}}]),vertexShader:En.meshphong_vert,fragmentShader:En.meshphong_frag},standard:{uniforms:sn([wn.common,wn.envmap,wn.aomap,wn.lightmap,wn.emissivemap,wn.bumpmap,wn.normalmap,wn.displacementmap,wn.roughnessmap,wn.metalnessmap,wn.fog,wn.lights,{emissive:{value:new nr(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:En.meshphysical_vert,fragmentShader:En.meshphysical_frag},matcap:{uniforms:sn([wn.common,wn.bumpmap,wn.normalmap,wn.displacementmap,wn.fog,{matcap:{value:null}}]),vertexShader:En.meshmatcap_vert,fragmentShader:En.meshmatcap_frag},points:{uniforms:sn([wn.points,wn.fog]),vertexShader:En.points_vert,fragmentShader:En.points_frag},dashed:{uniforms:sn([wn.common,wn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:En.linedashed_vert,fragmentShader:En.linedashed_frag},depth:{uniforms:sn([wn.common,wn.displacementmap]),vertexShader:En.depth_vert,fragmentShader:En.depth_frag},normal:{uniforms:sn([wn.common,wn.bumpmap,wn.normalmap,wn.displacementmap,{opacity:{value:1}}]),vertexShader:En.normal_vert,fragmentShader:En.normal_frag},sprite:{uniforms:sn([wn.sprite,wn.fog]),vertexShader:En.sprite_vert,fragmentShader:En.sprite_frag},background:{uniforms:{uvTransform:{value:new kt},t2D:{value:null}},vertexShader:En.background_vert,fragmentShader:En.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1},colorMatrix:{value:new Jt},cubeQuat:{value:new It}},vertexShader:En.cube_vert,fragmentShader:En.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:En.equirect_vert,fragmentShader:En.equirect_frag},distanceRGBA:{uniforms:sn([wn.common,wn.displacementmap,{referencePosition:{value:new jt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:En.distanceRGBA_vert,fragmentShader:En.distanceRGBA_frag},shadow:{uniforms:sn([wn.lights,wn.fog,{color:{value:new nr(0)},opacity:{value:1}}]),vertexShader:En.shadow_vert,fragmentShader:En.shadow_frag}};function Sn(){var e=null,t=!1,i=null;function r(n,o){!1!==t&&(i(n,o),e.requestAnimationFrame(r))}return{start:function(){!0!==t&&null!==i&&(e.requestAnimationFrame(r),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function An(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);var r=t.get(i);r&&(e.deleteBuffer(r.buffer),t.delete(i))},update:function(i,r){i.isInterleavedBufferAttribute&&(i=i.data);var n=t.get(i);void 0===n?t.set(i,function(t,i){var r=t.array,n=t.usage,o=e.createBuffer();e.bindBuffer(i,o),e.bufferData(i,r,n),t.onUploadCallback();var a=5126;return r instanceof Float32Array?a=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?a=5123:r instanceof Int16Array?a=5122:r instanceof Uint32Array?a=5125:r instanceof Int32Array?a=5124:r instanceof Int8Array?a=5120:r instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(i,r)):n.version<i.version&&(!function(t,i,r){var n=i.array,o=i.updateRange;e.bindBuffer(r,t),i.resizeDirty?(e.bufferData(r,n,i.usage),i.resizeDirty=!1):-1===o.count?e.bufferSubData(r,0,n):(e.bufferSubData(r,o.offset*n.BYTES_PER_ELEMENT,n.subarray(o.offset,o.offset+o.count)),o.count=-1)}(n.buffer,i,r),n.version=i.version)}}}function Mn(e,t,i,r){rn.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r},this.fromBufferGeometry(new Cn(e,t,i,r)),this.mergeVertices()}function Cn(e,t,i,r){Pr.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};var n,o,a=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(i)||1,u=Math.floor(r)||1,c=l+1,h=u+1,p=e/l,d=t/u,f=[],m=[],g=[],v=[];for(o=0;o<h;o++){var y=o*d-s;for(n=0;n<c;n++){var b=n*p-a;m.push(b,-y,0),g.push(0,0,1),v.push(n/l),v.push(1-o/u)}}for(o=0;o<u;o++)for(n=0;n<l;n++){var _=n+c*o,x=n+c*(o+1),E=n+1+c*(o+1),w=n+1+c*o;f.push(_,x,w),f.push(x,E,w)}this.setIndex(f),this.setAttribute("position",new _r(m,3)),this.setAttribute("normal",new _r(g,3)),this.setAttribute("uv",new _r(v,2))}function Rn(e,t,i,r){var n,o,a=new nr(0),u=0,c=null,h=0;function p(e,i){t.buffers.color.setClear(e.r,e.g,e.b,i,r)}return{getClearColor:function(){return a},setClearColor:function(e,t){a.set(e),p(a,u=void 0!==t?t:1)},getClearAlpha:function(){return u},setClearAlpha:function(e){p(a,u=e)},render:function(t,r,d,f){var m=r.background,g=e.vr,v=g.getSession&&g.getSession();if(v&&"additive"===v.environmentBlendMode&&(m=null),null===m?(p(a,u),c=null,h=0):m&&m.isColor&&(p(m,1),f=!0,c=null,h=0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLRenderTargetCube)){void 0===o&&((o=new Jr(new on(1,1,1),new hn({type:"BackgroundCubeMaterial",uniforms:an(Tn.cube.uniforms),vertexShader:Tn.cube.vertexShader,fragmentShader:Tn.cube.fragmentShader,side:l,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.tCube.value}}),i.update(o));var y=m.isWebGLRenderTargetCube?m.texture:m;o.material.uniforms.tCube.value=y,o.material.uniforms.tFlip.value=m.isWebGLRenderTargetCube?1:-1,y.colorMatrix?o.material.uniforms.colorMatrix.value.copy(y.colorMatrix):o.material.uniforms.colorMatrix.value.identity(),y.baseQuaternion?o.material.uniforms.cubeQuat.value.copy(y.baseQuaternion):o.material.uniforms.cubeQuat.value.set(0,0,0,1),t.custom1.length?o.renderLayer=1:o.renderLayer=null,c===m&&h===y.version||(o.material.needsUpdate=!0,c=m,h=y.version),t.unshift(o,o.geometry,o.material,0,0,null)}else m&&m.isTexture&&(void 0===n&&((n=new Jr(new Cn(2,2),new hn({type:"BackgroundMaterial",uniforms:an(Tn.background.uniforms),vertexShader:Tn.background.vertexShader,fragmentShader:Tn.background.fragmentShader,side:s,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(n.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(n)),n.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),n.material.uniforms.uvTransform.value.copy(m.matrix),t.custom1.length?n.renderLayer=1:n.renderLayer=null,c===m&&h===m.version||(n.material.needsUpdate=!0,c=m,h=m.version),t.unshift(n,n.geometry,n.material,0,0,null))}}}function Dn(e,t,i,r){var n,o=r.isWebGL2;this.setMode=function(e){n=e},this.render=function(t,r){e.drawArrays(n,t,r),i.update(r,n)},this.renderInstances=function(r,a,s,l){if(0!==l){var u,c;if(o)u=e,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[c](n,a,s,l),i.update(s,n,l)}}}function Pn(e,t,i){var r;function n(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,a=void 0!==i.precision?i.precision:"highp",s=n(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var l=!0===i.logarithmicDepthBuffer,u=e.getParameter(34930),c=e.getParameter(35660),h=e.getParameter(3379),p=e.getParameter(34076),d=e.getParameter(34921),f=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),v=c>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;var i=t.get("EXT_texture_filter_anisotropic");return r=null!==i?e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:a,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:p,maxAttributes:d,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?e.getParameter(36183):0}}function jn(){var e=this,t=null,i=0,r=!1,n=!1,o=new zi,a=new kt,s={value:null,needsUpdate:!1};function l(){s.value!==t&&(s.value=t,s.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(t,i,r,n){var l=null!==t?t.length:0,u=null;if(0!==l){if(u=s.value,!0!==n||null===u){var c=r+4*l,h=i.matrixWorldInverse;a.getNormalMatrix(h),(null===u||u.length<c)&&(u=new Float32Array(c));for(var p=0,d=r;p!==l;++p,d+=4)o.copy(t[p]).applyMatrix4(h,a),o.normal.toArray(u,d),u[d+3]=o.constant}s.value=u,s.needsUpdate=!0}return e.numPlanes=l,u}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,n,o){var a=0!==e.length||n||0!==i||r;return r=n,t=u(e,o,0),i=e.length,a},this.beginShadows=function(){n=!0,u(null)},this.endShadows=function(){n=!1,l()},this.setState=function(e,o,a,c,h,p){if(!r||null===e||0===e.length||n&&!a)n?u(null):l();else{var d=n?0:i,f=4*d,m=h.clippingState||null;s.value=m,m=u(e,c,f,p);for(var g=0;g!==f;++g)m[g]=t[g];h.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=d}}}function Fn(e){var t={};return{get:function(i){if(void 0!==t[i])return t[i];var r;switch(i){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(i)}return null===r&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),t[i]=r,r}}}function On(e,t,i){var r=new WeakMap,n=new WeakMap;function o(e){var a=e.target,s=r.get(a);for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);a.removeEventListener("dispose",o),r.delete(a);var u=n.get(s);u&&(t.remove(u),n.delete(s)),i.memory.geometries--}function a(e){var i=[],r=e.index,o=e.attributes.position,a=0;if(null!==r){var s=r.array;a=r.version;for(var l=0,u=s.length;l<u;l+=3){var c=s[l+0],h=s[l+1],p=s[l+2];i.push(c,h,h,p,p,c)}}else{s=o.array;a=o.version;for(l=0,u=s.length/3-1;l<u;l+=3){c=l+0,h=l+1,p=l+2;i.push(c,h,h,p,p,c)}}var d=new(wr(i)>65535?br:vr)(i,1);d.version=a,t.update(d,34963);var f=n.get(e);f&&t.remove(f),n.set(e,d)}return{get:function(e,t){var n=r.get(t);return n||(t.addEventListener("dispose",o),t.isBufferGeometry?n=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Pr).setFromObject(e)),n=t._bufferGeometry),r.set(t,n),i.memory.geometries++,n)},update:function(e){var i=e.index,r=e.attributes;for(var n in null!==i&&t.update(i,34963),r)t.update(r[n],34962);var o=e.morphAttributes;for(var n in o)for(var a=o[n],s=0,l=a.length;s<l;s++)t.update(a[s],34962)},getWireframeAttribute:function(e){var t=n.get(e);if(t){var i=e.index;null!==i&&t.version<i.version&&a(e)}else a(e);return n.get(e)}}}function kn(e,t,i,r){var n,o,a,s=r.isWebGL2;this.setMode=function(e){n=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,r){e.drawElements(n,r,o,t*a),i.update(r,n)},this.renderInstances=function(r,l,u,c){if(0!==c){var h,p;if(s)h=e,p="drawElementsInstanced";else if(p="drawElementsInstancedANGLE",null===(h=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[p](n,u,o,l*a,c),i.update(u,n,c)}}}function Ln(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,r){switch(r=r||1,t.calls++,i){case 4:t.triangles+=r*(e/3);break;case 5:case 6:t.triangles+=r*(e-2);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Bn(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Hn(e){var t={},i=new Float32Array(8);return{update:function(r,n,o,a){var s=r.morphTargetInfluences,l=s.length,u=t[n.id];if(void 0===u){u=[];for(var c=0;c<l;c++)u[c]=[c,0];t[n.id]=u}var h=o.morphTargets&&n.morphAttributes.position,p=o.morphNormals&&n.morphAttributes.normal;for(c=0;c<l;c++){0!==(f=u[c])[1]&&(h&&n.deleteAttribute("morphTarget"+c),p&&n.deleteAttribute("morphNormal"+c))}for(c=0;c<l;c++){(f=u[c])[0]=c,f[1]=s[c]}u.sort(Bn);var d=0;for(c=0;c<8;c++){var f;if(f=u[c]){var m=f[0],g=f[1];if(g){h&&n.setAttribute("morphTarget"+c,h[m]),p&&n.setAttribute("morphNormal"+c,p[m]),i[c]=g,d+=g;continue}}i[c]=0}var v=n.morphTargetsRelative?1:1-d;a.getUniforms().setValue(e,"morphTargetBaseInfluence",v),a.getUniforms().setValue(e,"morphTargetInfluences",i)}}}function In(e,t,i,r){var n={};return{update:function(e){var o=r.render.frame,a=e.geometry,s=t.get(e,a);return n[s.id]!==o&&(a.isGeometry&&s.updateFromObject(e),t.update(s),n[s.id]=o),e.isInstancedMesh&&i.update(e.instanceMatrix,34962),s},dispose:function(){n={}}}}function Nn(e,t,i,r,n,o,a,s,l,u){e=void 0!==e?e:[],t=void 0!==t?t:K,a=void 0!==a?a:Me,Ht.call(this,e,t,i,r,n,o,a,s,l,u),this.flipY=!1}function Un(e,t,i,r){Ht.call(this,null),this.image={data:e||null,width:t||1,height:i||1,depth:r||1},this.magFilter=le,this.minFilter=le,this.wrapR=ae,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Vn(e,t,i,r){Ht.call(this,null),this.image={data:e||null,width:t||1,height:i||1,depth:r||1},this.magFilter=le,this.minFilter=le,this.wrapR=ae,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Tn.physical={uniforms:sn([Tn.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new nr(0)},clearcoatNormalScale:{value:new Ct(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:En.meshphysical_vert,fragmentShader:En.meshphysical_frag},Mn.prototype=Object.create(rn.prototype),Mn.prototype.constructor=Mn,Cn.prototype=Object.create(Pr.prototype),Cn.prototype.constructor=Cn,Nn.prototype=Object.create(Ht.prototype),Nn.prototype.constructor=Nn,Nn.prototype.isCubeTexture=!0,Object.defineProperty(Nn.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),Un.prototype=Object.create(Ht.prototype),Un.prototype.constructor=Un,Un.prototype.isDataTexture2DArray=!0,Vn.prototype=Object.create(Ht.prototype),Vn.prototype.constructor=Vn,Vn.prototype.isDataTexture3D=!0;var zn=new Ht,qn=new Un,Wn=new Vn,Gn=new Nn,Xn=[],Yn=[],Jn=new Float32Array(16),Qn=new Float32Array(9),Zn=new Float32Array(4);function Kn(e,t,i){var r=e[0];if(r<=0||r>0)return e;var n=t*i,o=Xn[n];if(void 0===o&&(o=new Float32Array(n),Xn[n]=o),0!==t){r.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=i,e[a].toArray(o,s)}return o}function $n(e,t){if(e.length!==t.length)return!1;for(var i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function eo(e,t){for(var i=0,r=t.length;i<r;i++)e[i]=t[i]}function to(e,t){var i=Yn[t];void 0===i&&(i=new Int32Array(t),Yn[t]=i);for(var r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function io(e,t){var i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function ro(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if($n(i,t))return;e.uniform2fv(this.addr,t),eo(i,t)}}function no(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if($n(i,t))return;e.uniform3fv(this.addr,t),eo(i,t)}}function oo(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if($n(i,t))return;e.uniform4fv(this.addr,t),eo(i,t)}}function ao(e,t){var i=this.cache,r=t.elements;if(void 0===r){if($n(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),eo(i,t)}else{if($n(i,r))return;Zn.set(r),e.uniformMatrix2fv(this.addr,!1,Zn),eo(i,r)}}function so(e,t){var i=this.cache,r=t.elements;if(void 0===r){if($n(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),eo(i,t)}else{if($n(i,r))return;Qn.set(r),e.uniformMatrix3fv(this.addr,!1,Qn),eo(i,r)}}function lo(e,t){var i=this.cache,r=t.elements;if(void 0===r){if($n(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),eo(i,t)}else{if($n(i,r))return;Jn.set(r),e.uniformMatrix4fv(this.addr,!1,Jn),eo(i,r)}}function uo(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.safeSetTexture2D(t||zn,n)}function co(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||qn,n)}function ho(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||Wn,n)}function po(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.safeSetTextureCube(t||Gn,n)}function fo(e,t){var i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function mo(e,t){var i=this.cache;$n(i,t)||(e.uniform2iv(this.addr,t),eo(i,t))}function go(e,t){var i=this.cache;$n(i,t)||(e.uniform3iv(this.addr,t),eo(i,t))}function vo(e,t){var i=this.cache;$n(i,t)||(e.uniform4iv(this.addr,t),eo(i,t))}function yo(e,t){e.uniform1fv(this.addr,t)}function bo(e,t){e.uniform1iv(this.addr,t)}function _o(e,t){e.uniform2iv(this.addr,t)}function xo(e,t){e.uniform3iv(this.addr,t)}function Eo(e,t){e.uniform4iv(this.addr,t)}function wo(e,t){var i=Kn(t,this.size,2);e.uniform2fv(this.addr,i)}function To(e,t){var i=Kn(t,this.size,3);e.uniform3fv(this.addr,i)}function So(e,t){var i=Kn(t,this.size,4);e.uniform4fv(this.addr,i)}function Ao(e,t){var i=Kn(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function Mo(e,t){var i=Kn(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function Co(e,t){var i=Kn(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function Ro(e,t,i){var r=t.length,n=to(i,r);e.uniform1iv(this.addr,n);for(var o=0;o!==r;++o)i.safeSetTexture2D(t[o]||zn,n[o])}function Do(e,t,i){var r=t.length,n=to(i,r);e.uniform1iv(this.addr,n);for(var o=0;o!==r;++o)i.safeSetTextureCube(t[o]||Gn,n[o])}function Po(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return io;case 35664:return ro;case 35665:return no;case 35666:return oo;case 35674:return ao;case 35675:return so;case 35676:return lo;case 35678:case 36198:return uo;case 35679:return ho;case 35680:return po;case 36289:return co;case 5124:case 35670:return fo;case 35667:case 35671:return mo;case 35668:case 35672:return go;case 35669:case 35673:return vo}}(t.type)}function jo(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return yo;case 35664:return wo;case 35665:return To;case 35666:return So;case 35674:return Ao;case 35675:return Mo;case 35676:return Co;case 35678:return Ro;case 35680:return Do;case 5124:case 35670:return bo;case 35667:case 35671:return _o;case 35668:case 35672:return xo;case 35669:case 35673:return Eo}}(t.type)}function Fo(e){this.id=e,this.seq=[],this.map={}}jo.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),eo(t,e)},Fo.prototype.setValue=function(e,t,i){for(var r=this.seq,n=0,o=r.length;n!==o;++n){var a=r[n];a.setValue(e,t[a.id],i)}};var Oo=/([\w\d_]+)(\])?(\[|\.)?/g;function ko(e,t){e.seq.push(t),e.map[t.id]=t}function Lo(e,t,i){var r=e.name,n=r.length;for(Oo.lastIndex=0;;){var o=Oo.exec(r),a=Oo.lastIndex,s=o[1],l="]"===o[2],u=o[3];if(l&&(s|=0),void 0===u||"["===u&&a+2===n){ko(i,void 0===u?new Po(s,e,t):new jo(s,e,t));break}var c=i.map[s];void 0===c&&ko(i,c=new Fo(s)),i=c}}function Bo(e,t){this.seq=[],this.map={};for(var i=e.getProgramParameter(t,35718),r=0;r<i;++r){var n=e.getActiveUniform(t,r);Lo(n,e.getUniformLocation(t,n.name),this)}}function Ho(e,t,i){var r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}Bo.prototype.setValue=function(e,t,i,r){var n=this.map[t];void 0!==n&&n.setValue(e,i,r)},Bo.prototype.setOptional=function(e,t,i){var r=t[i];void 0!==r&&this.setValue(e,i,r)},Bo.upload=function(e,t,i,r){for(var n=0,o=t.length;n!==o;++n){var a=t[n],s=i[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,r)}},Bo.seqWithValue=function(e,t){for(var i=[],r=0,n=e.length;r!==n;++r){var o=e[r];o.id in t&&i.push(o)}return i};var Io=0;function No(e){switch(e){case ut:return["Linear","( value )"];case ct:return["sRGB","( value )"];case pt:return["RGBE","( value )"];case ft:return["RGBM","( value, 7.0 )"];case mt:return["RGBM","( value, 16.0 )"];case gt:return["RGBD","( value, 256.0 )"];case ht:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case dt:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function Uo(e,t,i){var r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();return r&&""===n?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+n+function(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}(e.getShaderSource(t))}function Vo(e,t){var i=No(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function zo(e,t){var i;switch(t){case X:i="Linear";break;case Y:i="Reinhard";break;case J:i="Uncharted2";break;case Q:i="OptimizedCineon";break;case Z:i="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function qo(e){return""!==e}function Wo(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Go(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Xo=/^[ \t]*#include +<([\w\d./]+)>/gm;function Yo(e){return e.replace(Xo,Jo)}function Jo(e,t){var i=En[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return Yo(i)}var Qo=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function Zo(e){return e.replace(Qo,Ko)}function Ko(e,t,i,r){for(var n="",o=parseInt(t);o<parseInt(i);o++)n+=r.replace(/\[ i \]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return n}function $o(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function ea(e,t,i,r,s,l){var u,c,h,p,d,f=e.getContext(),m=r.defines,g=s.vertexShader,v=s.fragmentShader,y=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===n?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===o?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===a&&(t="SHADOWMAP_TYPE_VSM"),t}(l),b=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case K:case $:t="ENVMAP_TYPE_CUBE";break;case re:case ne:t="ENVMAP_TYPE_CUBE_UV";break;case ee:case te:t="ENVMAP_TYPE_EQUIREC";break;case ie:t="ENVMAP_TYPE_SPHERE"}return t}(l),_=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case $:case te:t="ENVMAP_MODE_REFRACTION"}return t}(l),x=function(e){var t="ENVMAP_BLENDING_MULTIPLY";if(e.envMap)switch(e.combine){case z:t="ENVMAP_BLENDING_MULTIPLY";break;case q:t="ENVMAP_BLENDING_MIX";break;case W:t="ENVMAP_BLENDING_ADD"}return t}(l),E=e.gammaFactor>0?e.gammaFactor:1,w=l.isWebGL2?"":function(e,t,i){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(qo).join("\n")}(r.extensions,l,t),T=function(e){var t=[];for(var i in e){var r=e[i];!1!==r&&t.push("#define "+i+" "+r)}return t.join("\n")}(m),S=f.createProgram(),A=l.numMultiviewViews;if(r.isRawShaderMaterial?((u=[T].filter(qo).join("\n")).length>0&&(u+="\n"),(c=[w,T].filter(qo).join("\n")).length>0&&(c+="\n")):(u=[$o(l),"#define SHADER_NAME "+s.name,T,l.instancing?"#define USE_INSTANCING":"",l.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+E,"#define MAX_BONES "+l.maxBones,l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp2?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+_:"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.normalMap&&l.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",l.normalMap&&l.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",l.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",l.displacementMap&&l.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.roughnessMap?"#define USE_ROUGHNESSMAP":"",l.metalnessMap?"#define USE_METALNESSMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.vertexTangents?"#define USE_TANGENT":"",l.vertexColors?"#define USE_COLOR":"",l.vertexUvs?"#define USE_UV":"",l.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",l.flatShading?"#define FLAT_SHADED":"",l.skinning?"#define USE_SKINNING":"",l.useVertexTexture?"#define BONE_TEXTURE":"",l.morphTargets?"#define USE_MORPHTARGETS":"",l.morphNormals&&!1===l.flatShading?"#define USE_MORPHNORMALS":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+y:"",l.sizeAttenuation?"#define USE_SIZEATTENUATION":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&(l.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(qo).join("\n"),c=[w,$o(l),"#define SHADER_NAME "+s.name,T,l.alphaTest?"#define ALPHATEST "+l.alphaTest+(l.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+E,l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp2?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.matcap?"#define USE_MATCAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+b:"",l.envMap?"#define "+_:"",l.envMap?"#define "+x:"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.normalMap&&l.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",l.normalMap&&l.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",l.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.roughnessMap?"#define USE_ROUGHNESSMAP":"",l.metalnessMap?"#define USE_METALNESSMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.sheen?"#define USE_SHEEN":"",l.vertexTangents?"#define USE_TANGENT":"",l.vertexColors?"#define USE_COLOR":"",l.vertexUvs?"#define USE_UV":"",l.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",l.gradientMap?"#define USE_GRADIENTMAP":"",l.flatShading?"#define FLAT_SHADED":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+y:"",l.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",l.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&(l.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensions&&r.extensions.shaderTextureLOD||l.envMap)&&(l.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",l.toneMapping!==G?"#define TONE_MAPPING":"",l.toneMapping!==G?En.tonemapping_pars_fragment:"",l.toneMapping!==G?zo("toneMapping",l.toneMapping):"",l.dithering?"#define DITHERING":"",l.outputEncoding||l.mapEncoding||l.matcapEncoding||l.envMapEncoding||l.emissiveMapEncoding?En.encodings_pars_fragment:"",l.mapEncoding?Vo("mapTexelToLinear",l.mapEncoding):"",l.matcapEncoding?Vo("matcapTexelToLinear",l.matcapEncoding):"",l.envMapEncoding?Vo("envMapTexelToLinear",l.envMapEncoding):"",l.emissiveMapEncoding?Vo("emissiveMapTexelToLinear",l.emissiveMapEncoding):"",l.outputEncoding?(h="linearToOutputTexel",p=l.outputEncoding,d=No(p),"vec4 "+h+"( vec4 value ) { return LinearTo"+d[0]+d[1]+"; }"):"",l.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"",l.useColorMapping?"#define COLOR_MAPPING":"",l.useBaseQuaternion?"#define BASE_QUATERNION":"","\n"].filter(qo).join("\n")),g=Go(g=Wo(g=Yo(g),l),l),v=Go(v=Wo(v=Yo(v),l),l),g=Zo(g),v=Zo(v),l.isWebGL2&&!r.isRawShaderMaterial){var M=!1,C=/^\s*#version\s+300\s+es\s*\n/;r.isShaderMaterial&&null!==g.match(C)&&null!==v.match(C)&&(M=!0,g=g.replace(C,""),v=v.replace(C,"")),u=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+u,c=["#version 300 es\n","#define varying in",M?"":"out highp vec4 pc_fragColor;",M?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+c,A>0&&(u=(u=u.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","layout(num_views = "+A+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join("\n"),["uniform mat4 modelViewMatrices["+A+"];","uniform mat4 projectionMatrices["+A+"];","uniform mat4 viewMatrices["+A+"];","uniform mat3 normalMatrices["+A+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),c=(c=c.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+A+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n")))}var R,D,P=c+v,j=Ho(f,35633,u+g),F=Ho(f,35632,P);if(f.attachShader(S,j),f.attachShader(S,F),void 0!==r.index0AttributeName?f.bindAttribLocation(S,0,r.index0AttributeName):!0===l.morphTargets&&f.bindAttribLocation(S,0,"position"),f.linkProgram(S),e.debug.checkShaderErrors){var O=f.getProgramInfoLog(S).trim(),k=f.getShaderInfoLog(j).trim(),L=f.getShaderInfoLog(F).trim(),B=!0,H=!0;if(!1===f.getProgramParameter(S,35714)){B=!1;var I=Uo(f,j,"vertex"),N=Uo(f,F,"fragment");console.error("THREE.WebGLProgram: shader error: ",f.getError(),"35715",f.getProgramParameter(S,35715),"gl.getProgramInfoLog",O,I,N)}else""!==O?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",O):""!==k&&""!==L||(H=!1);H&&(this.diagnostics={runnable:B,material:r,programLog:O,vertexShader:{log:k,prefix:u},fragmentShader:{log:L,prefix:c}})}return f.deleteShader(j),f.deleteShader(F),this.getUniforms=function(){return void 0===R&&(R=new Bo(f,S)),R},this.getAttributes=function(){return void 0===D&&(D=function(e,t){for(var i={},r=e.getProgramParameter(t,35721),n=0;n<r;n++){var o=e.getActiveAttrib(t,n).name;i[o]=e.getAttribLocation(t,o)}return i}(f,S)),D},this.destroy=function(){f.deleteProgram(S),this.program=void 0},this.name=s.name,this.id=Io++,this.cacheKey=i,this.usedTimes=1,this.program=S,this.vertexShader=j,this.fragmentShader=F,this.numMultiviewViews=A,this}function ta(e,t,i){var r=[],n=i.isWebGL2,o=i.floatVertexTextures,a=i.precision,s=i.maxVertexUniforms,c=i.vertexTextures,h={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","useColorMapping","useBaseQuaternion"];function d(e,t){var i;return e?e.isTexture?i=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=e.texture.encoding):i=ut,i===ut&&t&&(i=ht),i}this.getParameters=function(t,r,p,f,m,g,v){var y=h[t.type],b=v.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(o)return 1024;var i=s,r=Math.floor((i-20)/4),n=Math.min(r,t.length);return n<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+n+"."),0):n}(v):0;null!==t.precision&&(a=i.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",a,"instead.");var _=e.getRenderTarget(),x=_&&_.isWebGLMultiviewRenderTarget?_.numViews:0;return{isWebGL2:n,shaderID:y,precision:a,instancing:!0===v.isInstancedMesh,supportsVertexTextures:c,numMultiviewViews:x,outputEncoding:d(_?_.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:d(t.map,e.gammaInput),matcap:!!t.matcap,matcapEncoding:d(t.matcap,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:d(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===re||t.envMap.mapping===ne),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:d(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===_t,tangentSpaceNormalMap:t.normalMapType===bt,clearcoatNormalMap:!!t.clearcoatNormalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,sheen:!!t.sheen,combine:t.combine,vertexTangents:t.normalMap&&t.vertexTangents,vertexColors:t.vertexColors,vertexUvs:!!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatNormalMap||t.displacementMap),uvsVertexOnly:!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatNormalMap||!t.displacementMap),fog:!!f,useFog:t.fog,fogExp2:f&&f.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:i.logarithmicDepthBuffer,skinning:t.skinning&&b>0,maxBones:b,useVertexTexture:o,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numDirLightShadows:r.directionalShadowMap.length,numPointLightShadows:r.pointShadowMap.length,numSpotLightShadows:r.spotShadowMap.length,numClippingPlanes:m,numClipIntersection:g,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&p.length>0,shadowMapType:e.shadowMap.type,toneMapping:t.toneMapped?e.toneMapping:G,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===u,flipSided:t.side===l,useColorMapping:!!t.colorMapping,useBaseQuaternion:!!t.baseQuaternion,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCacheKey=function(t,i){var r=[];if(i.shaderID?r.push(i.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var n in t.defines)r.push(n),r.push(t.defines[n]);for(var o=0;o<p.length;o++)r.push(i[p[o]]);return r.push(t.onBeforeCompile.toString()),r.push(e.gammaOutput),r.push(e.gammaFactor),r.join()},this.acquireProgram=function(i,n,o,a){for(var s,l=0,u=r.length;l<u;l++){var c=r[l];if(c.cacheKey===a){++(s=c).usedTimes;break}}return void 0===s&&(s=new ea(e,t,a,i,n,o),r.push(s)),s},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function ia(){var e=new WeakMap;return{get:function(t){var i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,r){e.get(t)[i]=r},dispose:function(){e=new WeakMap}}}function ra(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function na(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.material.id!==t.material.id?e.material.id-t.material.id:e.id-t.id}function oa(){var e=[],t=0,i=[],r=[],n=[],o={id:-1};function a(i,r,n,a,s,l){var u=e[t];return void 0===u?(u={id:i.id,object:i,geometry:r,material:n,program:n.program||o,groupOrder:a,renderOrder:i.renderOrder,z:s,group:l},e[t]=u):(u.id=i.id,u.object=i,u.geometry=r,u.material=n,u.program=n.program||o,u.groupOrder=a,u.renderOrder=i.renderOrder,u.z=s,u.group=l),t++,u}return{custom1:i,opaque:r,transparent:n,init:function(){t=0,i.length=0,r.length=0,n.length=0},push:function(e,t,o,s,l,u){var c=a(e,t,o,s,l,u);1===e.renderLayer?i.push(c):(!0===o.transparent?n:r).push(c)},unshift:function(e,t,o,s,l,u){var c=a(e,t,o,s,l,u);1===e.renderLayer?i.unshift(c):(!0===o.transparent?n:r).unshift(c)},sort:function(){i.length>1&&i.sort(ra),r.length>1&&r.sort(ra),n.length>1&&n.sort(na)}}}function aa(){var e=new WeakMap;function t(i){var r=i.target;r.removeEventListener("dispose",t),e.delete(r)}return{get:function(i,r){var n,o=e.get(i);return void 0===o?(n=new oa,e.set(i,new WeakMap),e.get(i).set(r,n),i.addEventListener("dispose",t)):void 0===(n=o.get(r))&&(n=new oa,o.set(r,n)),n},dispose:function(){e=new WeakMap}}}function sa(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var i;switch(t.type){case"DirectionalLight":i={direction:new jt,color:new nr,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ct};break;case"SpotLight":i={position:new jt,direction:new jt,color:new nr,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ct};break;case"PointLight":i={position:new jt,color:new nr,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ct,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":i={direction:new jt,skyColor:new nr,groundColor:new nr};break;case"RectAreaLight":i={color:new nr,position:new jt,halfWidth:new jt,halfHeight:new jt}}return e[t.id]=i,i}}}var la=0;function ua(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function ca(){for(var e=new sa,t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},i=0;i<9;i++)t.probe.push(new jt);var r=new jt,n=new Jt,o=new Jt;return{setup:function(i,a,s){for(var l=0,u=0,c=0,h=0;h<9;h++)t.probe[h].set(0,0,0);var p=0,d=0,f=0,m=0,g=0,v=0,y=0,b=0,_=s.matrixWorldInverse;i.sort(ua),h=0;for(var x=i.length;h<x;h++){var E=i[h],w=E.color,T=E.intensity,S=E.distance,A=E.shadow&&E.shadow.map?E.shadow.map.texture:null;if(E.isAmbientLight)l+=w.r*T,u+=w.g*T,c+=w.b*T;else if(E.isLightProbe)for(var M=0;M<9;M++)t.probe[M].addScaledVector(E.sh.coefficients[M],T);else if(E.isDirectionalLight){if((R=e.get(E)).color.copy(E.color).multiplyScalar(E.intensity),R.direction.setFromMatrixPosition(E.matrixWorld),r.setFromMatrixPosition(E.target.matrixWorld),R.direction.sub(r),R.direction.transformDirection(_),R.shadow=E.castShadow,E.castShadow){var C=E.shadow;R.shadowBias=C.bias,R.shadowRadius=C.radius,R.shadowMapSize=C.mapSize,t.directionalShadowMap[p]=A,t.directionalShadowMatrix[p]=E.shadow.matrix,v++}t.directional[p]=R,p++}else if(E.isSpotLight){if((R=e.get(E)).position.setFromMatrixPosition(E.matrixWorld),R.position.applyMatrix4(_),R.color.copy(w).multiplyScalar(T),R.distance=S,R.direction.setFromMatrixPosition(E.matrixWorld),r.setFromMatrixPosition(E.target.matrixWorld),R.direction.sub(r),R.direction.transformDirection(_),R.coneCos=Math.cos(E.angle),R.penumbraCos=Math.cos(E.angle*(1-E.penumbra)),R.decay=E.decay,R.shadow=E.castShadow,E.castShadow){C=E.shadow;R.shadowBias=C.bias,R.shadowRadius=C.radius,R.shadowMapSize=C.mapSize,t.spotShadowMap[f]=A,t.spotShadowMatrix[f]=E.shadow.matrix,b++}t.spot[f]=R,f++}else if(E.isRectAreaLight){(R=e.get(E)).color.copy(w).multiplyScalar(T),R.position.setFromMatrixPosition(E.matrixWorld),R.position.applyMatrix4(_),o.identity(),n.copy(E.matrixWorld),n.premultiply(_),o.extractRotation(n),R.halfWidth.set(.5*E.width,0,0),R.halfHeight.set(0,.5*E.height,0),R.halfWidth.applyMatrix4(o),R.halfHeight.applyMatrix4(o),t.rectArea[m]=R,m++}else if(E.isPointLight){if((R=e.get(E)).position.setFromMatrixPosition(E.matrixWorld),R.position.applyMatrix4(_),R.color.copy(E.color).multiplyScalar(E.intensity),R.distance=E.distance,R.decay=E.decay,R.shadow=E.castShadow,E.castShadow){C=E.shadow;R.shadowBias=C.bias,R.shadowRadius=C.radius,R.shadowMapSize=C.mapSize,R.shadowCameraNear=C.camera.near,R.shadowCameraFar=C.camera.far,t.pointShadowMap[d]=A,t.pointShadowMatrix[d]=E.shadow.matrix,y++}t.point[d]=R,d++}else if(E.isHemisphereLight){var R;(R=e.get(E)).direction.setFromMatrixPosition(E.matrixWorld),R.direction.transformDirection(_),R.direction.normalize(),R.skyColor.copy(E.color).multiplyScalar(T),R.groundColor.copy(E.groundColor).multiplyScalar(T),t.hemi[g]=R,g++}}t.ambient[0]=l,t.ambient[1]=u,t.ambient[2]=c;var D=t.hash;D.directionalLength===p&&D.pointLength===d&&D.spotLength===f&&D.rectAreaLength===m&&D.hemiLength===g&&D.numDirectionalShadows===v&&D.numPointShadows===y&&D.numSpotShadows===b||(t.directional.length=p,t.spot.length=f,t.rectArea.length=m,t.point.length=d,t.hemi.length=g,t.directionalShadowMap.length=v,t.pointShadowMap.length=y,t.spotShadowMap.length=b,t.directionalShadowMatrix.length=v,t.pointShadowMatrix.length=y,t.spotShadowMatrix.length=b,D.directionalLength=p,D.pointLength=d,D.spotLength=f,D.rectAreaLength=m,D.hemiLength=g,D.numDirectionalShadows=v,D.numPointShadows=y,D.numSpotShadows=b,t.version=la++)},state:t}}function ha(){var e=new ca,t=[],i=[];return{init:function(){t.length=0,i.length=0},state:{lightsArray:t,shadowsArray:i,lights:e},setupLights:function(r){e.setup(t,i,r)},pushLight:function(e){t.push(e)},pushShadow:function(e){i.push(e)}}}function pa(){var e=new WeakMap;function t(i){var r=i.target;r.removeEventListener("dispose",t),e.delete(r)}return{get:function(i,r){var n;return!1===e.has(i)?(n=new ha,e.set(i,new WeakMap),e.get(i).set(r,n),i.addEventListener("dispose",t)):!1===e.get(i).has(r)?(n=new ha,e.get(i).set(r,n)):n=e.get(i).get(r),n},dispose:function(){e=new WeakMap}}}function da(e){cr.call(this),this.type="MeshDepthMaterial",this.depthPacking=vt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function fa(e){cr.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new jt,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}da.prototype=Object.create(cr.prototype),da.prototype.constructor=da,da.prototype.isMeshDepthMaterial=!0,da.prototype.copy=function(e){return cr.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},fa.prototype=Object.create(cr.prototype),fa.prototype.constructor=fa,fa.prototype.isMeshDistanceMaterial=!0,fa.prototype.copy=function(e){return cr.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var ma="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpack2HalfToRGBA ( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",ga="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function va(e,t,i){var r=new xn,o=new Ct,c=new Ct,h=new It,p=[],f=[],m={},g={0:l,1:s,2:u},v=new hn({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ct},radius:{value:4}},vertexShader:ga,fragmentShader:ma}),y=v.clone();y.defines.HORIZONAL_PASS=1;var b=new Pr;b.setAttribute("position",new pr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var _=new Jr(b,v),x=this;function E(i,r){var n=t.update(_);v.uniforms.shadow_pass.value=i.map.texture,v.uniforms.resolution.value=i.mapSize,v.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(r,null,n,v,_,null),y.uniforms.shadow_pass.value=i.mapPass.texture,y.uniforms.resolution.value=i.mapSize,y.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(r,null,n,y,_,null)}function w(e,t,i){var r=e<<0|t<<1|i<<2,n=p[r];return void 0===n&&(n=new da({depthPacking:yt,morphTargets:e,skinning:t}),p[r]=n),n}function T(e,t,i){var r=e<<0|t<<1|i<<2,n=f[r];return void 0===n&&(n=new fa({morphTargets:e,skinning:t}),f[r]=n),n}function S(t,i,r,n,o,s){var l=t.geometry,u=null,c=w,h=t.customDepthMaterial;if(!0===r.isPointLight&&(c=T,h=t.customDistanceMaterial),void 0===h){var p=!1;!0===i.morphTargets&&(!0===l.isBufferGeometry?p=l.morphAttributes&&l.morphAttributes.position&&l.morphAttributes.position.length>0:!0===l.isGeometry&&(p=l.morphTargets&&l.morphTargets.length>0));var d=!1;!0===t.isSkinnedMesh&&(!0===i.skinning?d=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),u=c(p,d,!0===t.isInstancedMesh)}else u=h;if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var f=u.uuid,v=i.uuid,y=m[f];void 0===y&&(y={},m[f]=y);var b=y[v];void 0===b&&(b=u.clone(),y[v]=b),u=b}return u.visible=i.visible,u.wireframe=i.wireframe,u.side=s===a?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:g[i.side],u.clipShadows=i.clipShadows,u.clippingPlanes=i.clippingPlanes,u.clipIntersection=i.clipIntersection,u.wireframeLinewidth=i.wireframeLinewidth,u.linewidth=i.linewidth,!0===r.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(r.matrixWorld),u.nearDistance=n,u.farDistance=o),u}function A(i,n,o,s,l){if(!1!==i.visible){if(i.layers.test(n.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&l===a)&&(!i.frustumCulled||r.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,i.matrixWorld);var u=t.update(i),c=i.material;if(Array.isArray(c))for(var h=u.groups,p=0,d=h.length;p<d;p++){var f=h[p],m=c[f.materialIndex];if(m&&m.visible){var g=S(i,m,s,o.near,o.far,l);e.renderBufferDirect(o,null,u,g,i,f)}}else if(c.visible){g=S(i,c,s,o.near,o.far,l);e.renderBufferDirect(o,null,u,g,i,null)}}for(var v=i.children,y=0,b=v.length;y<b;y++)A(v[y],n,o,s,l)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=n,this.render=function(t,n,s){if(!1!==x.enabled&&(!1!==x.autoUpdate||!1!==x.needsUpdate)&&0!==t.length){var l=e.getRenderTarget(),u=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),f=e.state;f.setBlending(d),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(var m=0,g=t.length;m<g;m++){var v=t[m],y=v.shadow;if(void 0!==y){o.copy(y.mapSize);var b=y.getFrameExtents();if(o.multiply(b),c.copy(y.mapSize),(o.x>i||o.y>i)&&(console.warn("THREE.WebGLShadowMap:",v,"has shadow exceeding max texture size, reducing"),o.x>i&&(c.x=Math.floor(i/b.x),o.x=c.x*b.x,y.mapSize.x=c.x),o.y>i&&(c.y=Math.floor(i/b.y),o.y=c.y*b.y,y.mapSize.y=c.y)),null===y.map&&!y.isPointLightShadow&&this.type===a){var _={minFilter:he,magFilter:he,format:Ce};y.map=new Nt(o.x,o.y,_),y.map.texture.name=v.name+".shadowMap",y.mapPass=new Nt(o.x,o.y,_),y.camera.updateProjectionMatrix()}if(null===y.map){_={minFilter:le,magFilter:le,format:Ce};y.map=new Nt(o.x,o.y,_),y.map.texture.name=v.name+".shadowMap",y.camera.updateProjectionMatrix()}e.setRenderTarget(y.map),e.clear();for(var w=y.getViewportCount(),T=0;T<w;T++){var S=y.getViewport(T);h.set(c.x*S.x,c.y*S.y,c.x*S.z,c.y*S.w),f.viewport(h),y.updateMatrices(v,T),r=y.getFrustum(),A(n,s,y.camera,v,this.type)}y.isPointLightShadow||this.type!==a||E(y,s)}else console.warn("THREE.WebGLShadowMap:",v,"has no shadow.")}x.needsUpdate=!1,e.setRenderTarget(l,u,p)}}}function ya(e,n,o){var a=o.isWebGL2;var s=new function(){var t=!1,i=new It,r=null,n=new It(0,0,0,0);return{setMask:function(i){r===i||t||(e.colorMask(i,i,i,i),r=i)},setLocked:function(e){t=e},setClear:function(t,r,o,a,s){!0===s&&(t*=a,r*=a,o*=a),i.set(t,r,o,a),!1===n.equals(i)&&(e.clearColor(t,r,o,a),n.copy(i))},reset:function(){t=!1,r=null,n.set(-1,0,0,0)}}},c=new function(){var t=!1,i=null,r=null,n=null;return{setTest:function(e){e?be(2929):_e(2929)},setMask:function(r){i===r||t||(e.depthMask(r),i=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case k:e.depthFunc(512);break;case L:e.depthFunc(519);break;case B:e.depthFunc(513);break;case H:e.depthFunc(515);break;case I:e.depthFunc(514);break;case N:e.depthFunc(518);break;case U:e.depthFunc(516);break;case V:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,i=null,r=null,n=null}}},h=new function(){var t=!1,i=null,r=null,n=null,o=null,a=null,s=null,l=null,u=null;return{setTest:function(e){t||(e?be(2960):_e(2960))},setMask:function(r){i===r||t||(e.stencilMask(r),i=r)},setFunc:function(t,i,a){r===t&&n===i&&o===a||(e.stencilFunc(t,i,a),r=t,n=i,o=a)},setOp:function(t,i,r){a===t&&s===i&&l===r||(e.stencilOp(t,i,r),a=t,s=i,l=r)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,i=null,r=null,n=null,o=null,a=null,s=null,l=null,u=null}}},p=e.getParameter(34921),z=new Uint8Array(p),q=new Uint8Array(p),W=new Uint8Array(p),G={},X=null,Y=null,J=null,Q=null,Z=null,K=null,$=null,ee=null,te=null,ie=!1,re=null,ne=null,oe=null,ae=null,se=null,le=e.getParameter(35661),ue=!1,ce=0,he=e.getParameter(7938);-1!==he.indexOf("WebGL")?(ce=parseFloat(/^WebGL\ ([0-9])/.exec(he)[1]),ue=ce>=1):-1!==he.indexOf("OpenGL ES")&&(ce=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(he)[1]),ue=ce>=2);var pe=null,de={},fe=new It,me=new It;function ge(t,i,r){var n=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var a=0;a<r;a++)e.texImage2D(i+a,0,6408,1,1,0,6408,5121,n);return o}var ve={};function ye(t,i){(z[t]=1,0===q[t]&&(e.enableVertexAttribArray(t),q[t]=1),W[t]!==i)&&((a?e:n.get("ANGLE_instanced_arrays"))[a?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](t,i),W[t]=i)}function be(t){!0!==G[t]&&(e.enable(t),G[t]=!0)}function _e(t){!1!==G[t]&&(e.disable(t),G[t]=!1)}ve[3553]=ge(3553,3553,1),ve[34067]=ge(34067,34069,6),s.setClear(0,0,0,1),c.setClear(1),h.setClear(0),be(2929),c.setFunc(H),Se(!1),Ae(i),be(2884),Te(d);var xe={};if(xe[b]=32774,xe[_]=32778,xe[x]=32779,a)xe[E]=32775,xe[w]=32776;else{var Ee=n.get("EXT_blend_minmax");null!==Ee&&(xe[E]=Ee.MIN_EXT,xe[w]=Ee.MAX_EXT)}var we={};function Te(t,i,r,n,o,a,s,l){if(t!==d){if(Y||(be(3042),Y=!0),t===y)o=o||i,a=a||r,s=s||n,i===Q&&o===$||(e.blendEquationSeparate(xe[i],xe[o]),Q=i,$=o),r===Z&&n===K&&a===ee&&s===te||(e.blendFuncSeparate(we[r],we[n],we[a],we[s]),Z=r,K=n,ee=a,te=s),J=t,ie=null;else if(t!==J||l!==ie){if(Q===b&&$===b||(e.blendEquation(32774),Q=b,$=b),l)switch(t){case f:e.blendFuncSeparate(1,771,1,771);break;case m:e.blendFunc(1,1);break;case g:e.blendFuncSeparate(0,0,769,771);break;case v:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case f:e.blendFuncSeparate(770,771,1,771);break;case m:e.blendFunc(770,1);break;case g:e.blendFunc(0,769);break;case v:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}Z=null,K=null,ee=null,te=null,J=t,ie=l}}else Y&&(_e(3042),Y=!1)}function Se(t){re!==t&&(t?e.frontFace(2304):e.frontFace(2305),re=t)}function Ae(n){n!==t?(be(2884),n!==ne&&(n===i?e.cullFace(1029):n===r?e.cullFace(1028):e.cullFace(1032))):_e(2884),ne=n}function Me(t,i,r){t?(be(32823),ae===i&&se===r||(e.polygonOffset(i,r),ae=i,se=r)):_e(32823)}function Ce(t){void 0===t&&(t=33984+le-1),pe!==t&&(e.activeTexture(t),pe=t)}return we[T]=0,we[S]=1,we[A]=768,we[C]=770,we[O]=776,we[j]=774,we[D]=772,we[M]=769,we[R]=771,we[F]=775,we[P]=773,{buffers:{color:s,depth:c,stencil:h},initAttributes:function(){for(var e=0,t=z.length;e<t;e++)z[e]=0},enableAttribute:function(e){ye(e,0)},enableAttributeAndDivisor:ye,disableUnusedAttributes:function(){for(var t=0,i=q.length;t!==i;++t)q[t]!==z[t]&&(e.disableVertexAttribArray(t),q[t]=0)},enable:be,disable:_e,useProgram:function(t){return X!==t&&(e.useProgram(t),X=t,!0)},setBlending:Te,setMaterial:function(e,t){e.side===u?_e(2884):be(2884);var i=e.side===l;t&&(i=!i),Se(i),e.blending===f&&!1===e.transparent?Te(d):Te(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),c.setFunc(e.depthFunc),c.setTest(e.depthTest),c.setMask(e.depthWrite),s.setMask(e.colorWrite);var r=e.stencilWrite;h.setTest(r),r&&(h.setMask(e.stencilWriteMask),h.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),h.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Me(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:Se,setCullFace:Ae,setLineWidth:function(t){t!==oe&&(ue&&e.lineWidth(t),oe=t)},setPolygonOffset:Me,setScissorTest:function(e){e?be(3089):_e(3089)},activeTexture:Ce,bindTexture:function(t,i){null===pe&&Ce();var r=de[pe];void 0===r&&(r={type:void 0,texture:void 0},de[pe]=r),r.type===t&&r.texture===i||(e.bindTexture(t,i||ve[t]),r.type=t,r.texture=i)},unbindTexture:function(){var t=de[pe];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===fe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),fe.copy(t))},viewport:function(t){!1===me.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),me.copy(t))},reset:function(){for(var t=0;t<q.length;t++)1===q[t]&&(e.disableVertexAttribArray(t),q[t]=0);G={},pe=null,de={},X=null,J=null,re=null,ne=null,s.reset(),c.reset(),h.reset()}}}function ba(e,t,i,r,n,o,a){var s,l=n.isWebGL2,u=n.maxTextures,c=n.maxCubemapSize,h=n.maxTextureSize,p=n.maxSamples,d=new WeakMap,f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d");function m(e,t){return f?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(e,t,i,r){var n=1;if((e.width>r||e.height>r)&&(n=r/Math.max(e.width,e.height)),n<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var o=t?Mt.floorPowerOfTwo:Math.floor,a=o(n*e.width),l=o(n*e.height);void 0===s&&(s=m(a,l));var u=i?m(a,l):s;return u.width=a,u.height=l,u.getContext("2d").drawImage(e,0,0,a,l),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+l+")."),u}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function v(e){return Mt.isPowerOfTwo(e.width)&&Mt.isPowerOfTwo(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==le&&e.minFilter!==he}function b(t,i,n,o){e.generateMipmap(t),r.get(i).__maxMipLevel=Math.log(Math.max(n,o))*Math.LOG2E}function _(i,r){if(!1===l)return i;var n=i;return 6403===i&&(5126===r&&(n=33326),5131===r&&(n=33325),5121===r&&(n=33321)),6407===i&&(5126===r&&(n=34837),5131===r&&(n=34843),5121===r&&(n=32849)),6408===i&&(5126===r&&(n=34836),5131===r&&(n=34842),5121===r&&(n=32856)),6402===i&&(5123===r&&(n=33189),5125===r&&(n=e.DEPTH_COMPONENT24),5126===r&&(n=36012)),34041===i&&(34042===r&&(n=35056),r===e.FLOAT_32_UNSIGNED_INT_24_8_REV&&(n=e.DEPTH32F_STENCIL8)),33325===n||33326===n||34842===n||34836===n?t.get("EXT_color_buffer_float"):34843!==n&&34837!==n||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),n}function x(e){return e===le||e===ue||e===ce?9728:9729}function E(t){var i=t.target;i.removeEventListener("dispose",E),function(t){var i=r.get(t);if(void 0===i.__webglInit)return;e.deleteTexture(i.__webglTexture),r.remove(t)}(i),i.isVideoTexture&&d.delete(i),a.memory.textures--}function w(t){var i=t.target;i.removeEventListener("dispose",w),function(t){var i=r.get(t),n=r.get(t.texture);if(!t)return;void 0!==n.__webglTexture&&e.deleteTexture(n.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var o=0;o<6;o++)e.deleteFramebuffer(i.__webglFramebuffer[o]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[o]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer);t.isWebGLMultisampleRenderTarget&&(i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglSamplingbuffer),i.__webglColorRenderbuffer&&e.deleteRenderbuffer(i.__webglColorRenderbuffer));if(t.isWebGLMultiviewRenderTarget){e.deleteTexture(i.__webglColorTexture),e.deleteTexture(i.__webglDepthStencilTexture),a.memory.textures-=2;o=0;for(var s=i.__webglViewFramebuffers.length;o<s;o++)e.deleteFramebuffer(i.__webglViewFramebuffers[o])}r.remove(t.texture),r.remove(t)}(i),a.memory.textures--}var T=0;function S(e,t){var n=r.get(e);if(e.isVideoTexture&&function(e){var t=a.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}(e),e.version>0&&n.__version!==e.version){var o=e.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void j(n,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+t),i.bindTexture(3553,n.__webglTexture)}function A(t,n){if(6===t.image.length){var a=r.get(t);if(t.version>0&&a.__version!==t.version){P(a,t),i.activeTexture(33984+n),i.bindTexture(34067,a.__webglTexture),e.pixelStorei(37440,t.flipY);for(var s=t&&t.isCompressedTexture,u=t.image[0]&&t.image[0].isDataTexture,h=[],p=0;p<6;p++)h[p]=s||u?u?t.image[p].image:t.image[p]:g(t.image[p],!1,!0,c);var d,f=h[0],m=v(f)||l,x=o.convert(t.format),E=o.convert(t.type),w=_(x,E);if(D(34067,t,m),s){for(p=0;p<6;p++){d=h[p].mipmaps;for(var T=0;T<d.length;T++){var S=d[T];t.format!==Ce&&t.format!==Me?null!==x?i.compressedTexImage2D(34069+p,T,w,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+p,T,w,S.width,S.height,0,x,E,S.data)}}a.__maxMipLevel=d.length-1}else{d=t.mipmaps;for(p=0;p<6;p++)if(u){i.texImage2D(34069+p,0,w,h[p].width,h[p].height,0,x,E,h[p].data);for(T=0;T<d.length;T++){var A=(S=d[T]).image[p].image;i.texImage2D(34069+p,T+1,w,A.width,A.height,0,x,E,A.data)}}else{i.texImage2D(34069+p,0,w,x,E,h[p]);for(T=0;T<d.length;T++){S=d[T];i.texImage2D(34069+p,T+1,w,x,E,S.image[p])}}a.__maxMipLevel=d.length}y(t,m)&&b(34067,t,f.width,f.height),a.__version=t.version,t.onUpdate&&t.onUpdate(t)}else i.activeTexture(33984+n),i.bindTexture(34067,a.__webglTexture)}}function M(e,t){i.activeTexture(33984+t),i.bindTexture(34067,r.get(e).__webglTexture)}var C={};C[oe]=10497,C[ae]=33071,C[se]=33648;var R={};function D(i,o,a){a?(e.texParameteri(i,10242,C[o.wrapS]),e.texParameteri(i,10243,C[o.wrapT]),32879!==i&&35866!==i||e.texParameteri(i,32882,C[o.wrapR]),e.texParameteri(i,10240,R[o.magFilter]),e.texParameteri(i,10241,R[o.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),32879!==i&&35866!==i||e.texParameteri(i,32882,33071),o.wrapS===ae&&o.wrapT===ae||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,x(o.magFilter)),e.texParameteri(i,10241,x(o.minFilter)),o.minFilter!==le&&o.minFilter!==he&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=t.get("EXT_texture_filter_anisotropic");if(s){if(o.type===_e&&null===t.get("OES_texture_float_linear"))return;if(o.type===xe&&null===(l||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(i,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,n.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function P(t,i){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",E),t.__webglTexture=e.createTexture(),a.memory.textures++)}function j(t,r,a){var s=3553;r.isDataTexture2DArray&&(s=35866),r.isDataTexture3D&&(s=32879),P(t,r),i.activeTexture(33984+a),i.bindTexture(s,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);var u=function(e){return!l&&(e.wrapS!==ae||e.wrapT!==ae||e.minFilter!==le&&e.minFilter!==he)}(r)&&!1===v(r.image),c=g(r.image,u,!1,h),p=v(c)||l,d=o.convert(r.format),f=o.convert(r.type),m=_(d,f);D(s,r,p);var x,E=r.mipmaps;if(r.isDepthTexture){if(!n.isWebGL2){if(m=6402,r.type===_e){if(!1===l)throw new Error("Float Depth Texture only supported in WebGL2.0");m=36012}else l&&(m=33189);r.format===je&&6402===m&&r.type!==ve&&r.type!==be&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=ve,f=o.convert(r.type)),r.format===Fe&&(m=34041,r.type!==Se&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Se,f=o.convert(r.type)))}i.texImage2D(3553,0,m,c.width,c.height,0,d,f,null)}else if(r.isDataTexture)if(E.length>0&&p){for(var w=0,T=E.length;w<T;w++)x=E[w],i.texImage2D(3553,w,m,x.width,x.height,0,d,f,x.data);r.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else i.texImage2D(3553,0,m,c.width,c.height,0,d,f,c.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(w=0,T=E.length;w<T;w++)x=E[w],r.format!==Ce&&r.format!==Me?null!==d?i.compressedTexImage2D(3553,w,m,x.width,x.height,0,x.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,w,m,x.width,x.height,0,d,f,x.data);t.__maxMipLevel=E.length-1}else if(r.isDataTexture2DArray)i.texImage3D(35866,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)i.texImage3D(32879,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(E.length>0&&p){for(w=0,T=E.length;w<T;w++)x=E[w],i.texImage2D(3553,w,m,d,f,x);r.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else i.texImage2D(3553,0,m,d,f,c),t.__maxMipLevel=0;y(r,p)&&b(3553,r,c.width,c.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function F(t,n,a,s){var l=o.convert(n.texture.format),u=o.convert(n.texture.type),c=_(l,u);i.texImage2D(s,0,c,n.width,n.height,0,l,u,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,s,r.get(n.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function O(t,i,r){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){if(r){var n=L(i);e.renderbufferStorageMultisample(36161,n,33189,i.width,i.height)}else e.renderbufferStorage(36161,33189,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){if(r){n=L(i);e.renderbufferStorageMultisample(36161,n,35056,i.width,i.height)}else e.renderbufferStorage(36161,34041,i.width,i.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var a=_(o.convert(i.texture.format),o.convert(i.texture.type));if(r){n=L(i);e.renderbufferStorageMultisample(36161,n,a,i.width,i.height)}else e.renderbufferStorage(36161,a,i.width,i.height)}e.bindRenderbuffer(36161,null)}function k(t){var i=r.get(t),n=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),S(i.depthTexture,0);var n=r.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===je)e.framebufferTexture2D(36160,36096,3553,n,0);else{if(i.depthTexture.format!==Fe)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,n,0)}}(i.__webglFramebuffer,t)}else if(n){i.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(36160,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=e.createRenderbuffer(),O(i.__webglDepthbuffer[o],t)}else e.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),O(i.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}function L(e){return l&&e.isWebGLMultisampleRenderTarget?Math.min(p,e.samples):0}R[le]=9728,R[ue]=9984,R[ce]=9986,R[he]=9729,R[pe]=9985,R[de]=9987;var B=!1,H=!1;this.allocateTextureUnit=function(){var e=T;return e>=u&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+u),T+=1,e},this.resetTextureUnits=function(){T=0},this.setTexture2D=S,this.setTexture2DArray=function(e,t){var n=r.get(e);e.version>0&&n.__version!==e.version?j(n,e,t):(i.activeTexture(33984+t),i.bindTexture(35866,n.__webglTexture))},this.setTexture3D=function(e,t){var n=r.get(e);e.version>0&&n.__version!==e.version?j(n,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,n.__webglTexture))},this.setTextureCube=A,this.setTextureCubeDynamic=M,this.setupRenderTarget=function(n){var s=r.get(n),u=r.get(n.texture);n.addEventListener("dispose",w),u.__webglTexture=e.createTexture(),a.memory.textures++;var c=!0===n.isWebGLRenderTargetCube,h=!0===n.isWebGLMultisampleRenderTarget,p=!0===n.isWebGLMultiviewRenderTarget,d=v(n)||l;if(c){s.__webglFramebuffer=[];for(var f=0;f<6;f++)s.__webglFramebuffer[f]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),h)if(l){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var m=_(o.convert(n.texture.format),o.convert(n.texture.type)),g=L(n);e.renderbufferStorageMultisample(36161,g,m,n.width,n.height),e.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),n.depthBuffer&&(s.__webglDepthRenderbuffer=n.webglDepthRenderbuffer||e.createRenderbuffer(),O(s.__webglDepthRenderbuffer,n,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(p){var x=n.width,E=n.height,T=n.numViews;e.bindFramebuffer(36160,s.__webglFramebuffer);var S=t.get("OVR_multiview2");a.memory.textures+=2;var A=e.createTexture();e.bindTexture(35866,A),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,32856,x,E,T,0,6408,5121,null),S.framebufferTextureMultiviewOVR(36160,36064,A,0,0,T);var M=e.createTexture();e.bindTexture(35866,M),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,35056,x,E,T,0,34041,34042,null),S.framebufferTextureMultiviewOVR(36160,33306,M,0,0,T);var C=new Array(T);for(f=0;f<T;++f)C[f]=e.createFramebuffer(),e.bindFramebuffer(36160,C[f]),e.framebufferTextureLayer(36160,36064,A,0,f);s.__webglColorTexture=A,s.__webglDepthStencilTexture=M,s.__webglViewFramebuffers=C,e.bindFramebuffer(36160,null),e.bindTexture(35866,null)}if(c){i.bindTexture(34067,u.__webglTexture),D(34067,n.texture,d);for(f=0;f<6;f++)F(s.__webglFramebuffer[f],n,36064,34069+f);y(n.texture,d)&&b(34067,n.texture,n.width,n.height),i.bindTexture(34067,null)}else p||(i.bindTexture(3553,u.__webglTexture),D(3553,n.texture,d),F(s.__webglFramebuffer,n,36064,3553),y(n.texture,d)&&b(3553,n.texture,n.width,n.height),i.bindTexture(3553,null));n.depthBuffer&&k(n)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(y(t,v(e)||l)){var n=e.isWebGLRenderTargetCube?34067:3553,o=r.get(t).__webglTexture;i.bindTexture(n,o),b(n,t,e.width,e.height),i.bindTexture(n,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(l){var i=r.get(t);e.bindFramebuffer(36008,i.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,i.__webglFramebuffer);var n=t.width,o=t.height,a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024),e.blitFramebuffer(0,0,n,o,0,0,n,o,a,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),B=!0),e=e.texture),S(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLRenderTargetCube&&(!1===H&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),H=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?A(e,t):M(e,t)}}function _a(e,t,i){var r=i.isWebGL2;return{convert:function(e){var i;if(e===fe)return 5121;if(e===Ee)return 32819;if(e===we)return 32820;if(e===Te)return 33635;if(e===me)return 5120;if(e===ge)return 5122;if(e===ve)return 5123;if(e===ye)return 5124;if(e===be)return 5125;if(e===_e)return 5126;if(e===xe)return r?5131:null!==(i=t.get("OES_texture_half_float"))?i.HALF_FLOAT_OES:null;if(e===Ae)return 6406;if(e===Me)return 6407;if(e===Ce)return 6408;if(e===Re)return 6409;if(e===De)return 6410;if(e===je)return 6402;if(e===Fe)return 34041;if(e===Oe)return 6403;if(e===ke||e===Le||e===Be||e===He){if(null===(i=t.get("WEBGL_compressed_texture_s3tc")))return null;if(e===ke)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Le)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Be)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===He)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===Ie||e===Ne||e===Ue||e===Ve){if(null===(i=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===Ie)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Ne)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Ue)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Ve)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return e===ze?null!==(i=t.get("WEBGL_compressed_texture_etc1"))?i.COMPRESSED_RGB_ETC1_WEBGL:null:e===qe||e===We||e===Ge||e===Xe||e===Ye||e===Je||e===Qe||e===Ze||e===Ke||e===$e||e===et||e===tt||e===it||e===rt?null!==(i=t.get("WEBGL_compressed_texture_astc"))?e:null:e===Se?r?34042:null!==(i=t.get("WEBGL_depth_texture"))?i.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function xa(e,t,i,r){Nt.call(this,e,t,r),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=i}function Ea(e,t){var i,r,n,o,a,s,l,u=2,c=e.extensions,h=e.properties,p=0;function d(e){return e.isArrayCamera?e.cameras:(a[0]=e,a)}this.isAvailable=function(){if(void 0===l){var e=c.get("OVR_multiview2");if(l=null!==e&&!1===t.getContextAttributes().antialias){p=t.getParameter(e.MAX_VIEWS_OVR),i=new xa(0,0,u),s=new Ct,o=[],n=[],a=[];for(var r=0;r<p;r++)o[r]=new Jt,n[r]=new kt}}return l},this.attachCamera=function(t){!1!==function(e){if(void 0===e.isArrayCamera)return!0;var t=e.cameras;if(t.length>p)return!1;for(var i=1,r=t.length;i<r;i++)if(t[0].viewport.z!==t[i].viewport.z||t[0].viewport.w!==t[i].viewport.w)return!1;return!0}(t)&&(r=e.getRenderTarget(),function(t){if(r?s.set(r.width,r.height):e.getDrawingBufferSize(s),t.isArrayCamera){var n=t.cameras[0].viewport;i.setSize(n.z,n.w),i.setNumViews(t.cameras.length)}else i.setSize(s.x,s.y),i.setNumViews(u)}(t),e.setRenderTarget(i))},this.detachCamera=function(n){i===e.getRenderTarget()&&(e.setRenderTarget(r),function(e){var r=i,n=r.numViews,o=h.get(r).__webglViewFramebuffers,a=r.width,l=r.height;if(e.isArrayCamera)for(var u=0;u<n;u++){var c=e.cameras[u].viewport,p=c.x,d=c.y,f=p+c.z,m=d+c.w;t.bindFramebuffer(36008,o[u]),t.blitFramebuffer(0,0,a,l,p,d,f,m,16384,9728)}else t.bindFramebuffer(36008,o[0]),t.blitFramebuffer(0,0,a,l,0,0,s.x,s.y,16384,9728)}(n))},this.updateCameraProjectionMatricesUniform=function(e,i){for(var r=d(e),n=0;n<r.length;n++)o[n].copy(r[n].projectionMatrix);i.setValue(t,"projectionMatrices",o)},this.updateCameraViewMatricesUniform=function(e,i){for(var r=d(e),n=0;n<r.length;n++)o[n].copy(r[n].matrixWorldInverse);i.setValue(t,"viewMatrices",o)},this.updateObjectMatricesUniforms=function(e,i,r){for(var a=d(i),s=0;s<a.length;s++)o[s].multiplyMatrices(a[s].matrixWorldInverse,e.matrixWorld),n[s].getNormalMatrix(o[s]);r.setValue(t,"modelViewMatrices",o),r.setValue(t,"normalMatrices",n)}}function wa(){di.call(this),this.type="Group"}function Ta(e){dn.call(this),this.cameras=e||[]}xa.prototype=Object.assign(Object.create(Nt.prototype),{constructor:xa,isWebGLMultiviewRenderTarget:!0,copy:function(e){return Nt.prototype.copy.call(this,e),this.numViews=e.numViews,this},setNumViews:function(e){return this.numViews!==e&&(this.numViews=e,this.dispose()),this}}),wa.prototype=Object.assign(Object.create(di.prototype),{constructor:wa,isGroup:!0}),Ta.prototype=Object.assign(Object.create(dn.prototype),{constructor:Ta,isArrayCamera:!0});var Sa,Aa=new jt,Ma=new jt;function Ca(e,t,i){Aa.setFromMatrixPosition(t.matrixWorld),Ma.setFromMatrixPosition(i.matrixWorld);var r=Aa.distanceTo(Ma),n=t.projectionMatrix.elements,o=i.projectionMatrix.elements,a=n[14]/(n[10]-1),s=n[14]/(n[10]+1),l=(n[9]+1)/n[5],u=(n[9]-1)/n[5],c=(n[8]-1)/n[0],h=(o[8]+1)/o[0],p=a*c,d=a*h,f=r/(-c+h),m=f*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var g=a+f,v=s+f,y=p-m,b=d+(r-m),_=l*s/v*g,x=u*s/v*g;e.projectionMatrix.makePerspective(y,b,_,x,g,v)}function Ra(e){var t,i,r=this,n=null,o=null,a=[],s=new Jt,l=new Jt,u=1,c="local-floor";"undefined"!=typeof window&&"VRFrameData"in window&&(o=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",x,!1));var h=new Jt,p=new Rt,d=new jt,f=new dn,m=new dn;m.viewport=new It,m.layers.enable(1);var g=new dn;g.viewport=new It,g.layers.enable(2);var v=new Ta([m,g]);function y(){return null!==n&&!0===n.isPresenting}v.layers.enable(1),v.layers.enable(2);var b,_=new Ct;function x(){if(y()){var o=n.getEyeParameters("left");t=2*o.renderWidth*u,i=o.renderHeight*u,b=e.getPixelRatio(),e.getSize(_),e.setDrawingBufferSize(t,i,1),m.viewport.set(0,0,t/2,i),g.viewport.set(t/2,0,t/2,i),A.start(),r.dispatchEvent({type:"sessionstart"})}else r.enabled&&e.setDrawingBufferSize(_.width,_.height,b),A.stop(),r.dispatchEvent({type:"sessionend"})}var E=[],w=[];function T(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),i=0,r=t.length;i<r;i++){var n=t[i];if(n&&("Daydream Controller"===n.id||"Gear VR Controller"===n.id||"Oculus Go Controller"===n.id||"OpenVR Gamepad"===n.id||n.id.startsWith("Oculus Touch")||n.id.startsWith("HTC Vive Focus")||n.id.startsWith("Spatial Controller"))){var o=n.hand;if(0===e&&(""===o||"right"===o))return n;if(1===e&&"left"===o)return n}}}function S(e,r){null!==r&&4===r.length&&e.set(r[0]*t,r[1]*i,r[2]*t,r[3]*i)}this.enabled=!1,this.getController=function(e){var t=a[e];return void 0===t&&((t=new wa).matrixAutoUpdate=!1,t.visible=!1,a[e]=t),t},this.getDevice=function(){return n},this.setDevice=function(e){void 0!==e&&(n=e),A.setContext(e)},this.setFramebufferScaleFactor=function(e){u=e},this.setReferenceSpaceType=function(e){c=e},this.getCamera=function(e){var t="local-floor"===c?1.6:0;if(n.depthNear=e.near,n.depthFar=e.far,n.getFrameData(o),"local-floor"===c){var i=n.stageParameters;i?s.fromArray(i.sittingToStandingTransform):s.makeTranslation(0,t,0)}var r=o.pose;f.matrix.copy(s),f.matrix.decompose(f.position,f.quaternion,f.scale),null!==r.orientation&&(p.fromArray(r.orientation),f.quaternion.multiply(p)),null!==r.position&&(p.setFromRotationMatrix(s),d.fromArray(r.position),d.applyQuaternion(p),f.position.add(d)),f.updateMatrixWorld(),e.matrixWorld.copy(f.matrixWorld);for(var u=e.children,y=0,b=u.length;y<b;y++)u[y].updateMatrixWorld(!0);m.near=e.near,g.near=e.near,m.far=e.far,g.far=e.far,m.matrixWorldInverse.fromArray(o.leftViewMatrix),g.matrixWorldInverse.fromArray(o.rightViewMatrix),l.getInverse(s),"local-floor"===c&&(m.matrixWorldInverse.multiply(l),g.matrixWorldInverse.multiply(l));var _=e.parent;null!==_&&(h.getInverse(_.matrixWorld),m.matrixWorldInverse.multiply(h),g.matrixWorldInverse.multiply(h)),m.matrixWorld.getInverse(m.matrixWorldInverse),g.matrixWorld.getInverse(g.matrixWorldInverse),m.projectionMatrix.fromArray(o.leftProjectionMatrix),g.projectionMatrix.fromArray(o.rightProjectionMatrix),Ca(v,m,g);var x=n.getLayers();if(x.length){var A=x[0];S(m.viewport,A.leftBounds),S(g.viewport,A.rightBounds)}return function(){for(var e=0;e<a.length;e++){var t=a[e],i=T(e);if(void 0!==i&&void 0!==i.pose){if(null===i.pose)return;var r=i.pose;!1===r.hasPosition&&t.position.set(.2,-.6,-.05),null!==r.position&&t.position.fromArray(r.position),null!==r.orientation&&t.quaternion.fromArray(r.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(s),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var n="Daydream Controller"===i.id?0:1;void 0===E[e]&&(E[e]=!1),E[e]!==i.buttons[n].pressed&&(E[e]=i.buttons[n].pressed,!0===E[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"}))),n=2,void 0===w[e]&&(w[e]=!1),void 0!==i.buttons[n]&&w[e]!==i.buttons[n].pressed&&(w[e]=i.buttons[n].pressed,!0===w[e]?t.dispatchEvent({type:"squeezestart"}):(t.dispatchEvent({type:"squeezeend"}),t.dispatchEvent({type:"squeeze"})))}else t.visible=!1}}(),v},this.getStandingMatrix=function(){return s},this.isPresenting=y;var A=new Sn;this.setAnimationLoop=function(e){A.setAnimationLoop(e),y()&&A.start()},this.submitFrame=function(){y()&&n.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",x)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}function Da(e,t){var i=this,r=null,n=null,o="local-floor",a=null,s=[],l=[];var u=new dn;u.layers.enable(1),u.viewport=new It;var c=new dn;c.layers.enable(2),c.viewport=new It;var h=new Ta([u,c]);function p(e){for(var t=0;t<s.length;t++)l[t]===e.inputSource&&s[t].dispatchEvent({type:e.type})}function d(){e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),b.stop(),i.dispatchEvent({type:"sessionend"})}function f(e){n=e,b.setContext(r),b.start(),i.dispatchEvent({type:"sessionstart"})}function m(){for(var e=0;e<s.length;e++)l[e]=g(e)}function g(e){for(var t=r.inputSources,i=0;i<t.length;i++){var n=t[i],o=n.handedness;if(0===e&&("none"===o||"right"===o))return n;if(1===e&&"left"===o)return n}}function v(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}h.layers.enable(1),h.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=s[e];return void 0===t&&((t=new wa).matrixAutoUpdate=!1,t.visible=!1,s[e]=t),t},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(e){o=e},this.getSession=function(){return r},this.setSession=function(e){null!==(r=e)&&(r.addEventListener("select",p),r.addEventListener("selectstart",p),r.addEventListener("selectend",p),r.addEventListener("squeeze",p),r.addEventListener("squeezestart",p),r.addEventListener("squeezeend",p),r.addEventListener("end",d),r.updateRenderState({baseLayer:new XRWebGLLayer(r,t)}),r.requestReferenceSpace(o).then(f),r.addEventListener("inputsourceschange",m),m())},this.getCamera=function(e){var t=e.parent,i=h.cameras;v(h,t);for(var r=0;r<i.length;r++)v(i[r],t);e.matrixWorld.copy(h.matrixWorld);for(var n=e.children,o=(r=0,n.length);r<o;r++)n[r].updateMatrixWorld(!0);return Ca(h,u,c),h},this.isPresenting=function(){return null!==r&&null!==n};var y=null;var b=new Sn;b.setAnimationLoop((function(t,i){if(null!==(a=i.getViewerPose(n))){var o=a.views,u=r.renderState.baseLayer;e.setFramebuffer(u.framebuffer);for(var c=0;c<o.length;c++){var p=o[c],d=u.getViewport(p),f=p.transform.inverse.matrix,m=h.cameras[c];m.matrix.fromArray(f).getInverse(m.matrix),m.projectionMatrix.fromArray(p.projectionMatrix),m.viewport.set(d.x,d.y,d.width,d.height),0===c&&h.matrix.copy(m.matrix)}}for(c=0;c<s.length;c++){var g=s[c],v=l[c];if(v){var b=i.getPose(v.targetRaySpace,n);if(null!==b){g.matrix.fromArray(b.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.visible=!0;continue}}g.visible=!1}y&&y(t)})),this.setAnimationLoop=function(e){y=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new Jt},this.getDevice=function(){console.warn("THREE.WebXRManager: getDevice() has been deprecated.")},this.setDevice=function(){console.warn("THREE.WebXRManager: setDevice() has been deprecated.")},this.setFrameOfReferenceType=function(){console.warn("THREE.WebXRManager: setFrameOfReferenceType() has been deprecated.")},this.submitFrame=function(){}}function Pa(){var e=new Map;this.$mode=0;var t=this;this.setMode=function(e){t.$mode=e},this.getMode=function(){return t.$mode},this.addStrategy=function(t,i){e.set(t,i)},this.getStrategy=function(){return e.get(t.$mode)},this.hasStrategy=function(t){return e.has(t)}}function ja(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,n=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,p=null,d=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.initRenderList=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=X,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var f,m,g,v,y,b,_,x,E,w,T,S,A,M,C,R,D,P,j=this,F=!1,O=null,k=0,L=0,B=null,H=null,I=-1,N={geometry:null,program:null,wireframe:!1},U=null,V=null,z=new It,q=new It,W=null,G=t.width,Y=t.height,J=1,Q=new It(0,0,G,Y),Z=new It(0,0,G,Y),K=!1,$=new xn,ee=new jn,te=!1,ie=!1,re=new Jt,ne=new jt;function oe(){return null===B?J:1}try{var ae={alpha:r,depth:n,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:u,powerPreference:c,failIfMajorPerformanceCaveat:h,xrCompatible:!0};if(t.addEventListener("webglcontextlost",pe,!1),t.addEventListener("webglcontextrestored",de,!1),null===(f=i||t.getContext("webgl",ae)||t.getContext("experimental-webgl",ae)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===f.getShaderPrecisionFormat&&(f.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function se(){m=new Fn(f),!1===(g=new Pn(f,m,e)).isWebGL2&&(m.get("WEBGL_depth_texture"),m.get("OES_texture_float"),m.get("OES_texture_half_float"),m.get("OES_texture_half_float_linear"),m.get("OES_standard_derivatives"),m.get("OES_element_index_uint"),m.get("ANGLE_instanced_arrays")),m.get("OES_texture_float_linear"),P=new _a(f,m,g),(v=new ya(f,m,g)).scissor(q.copy(Z).multiplyScalar(J).floor()),v.viewport(z.copy(Q).multiplyScalar(J).floor()),y=new Ln(f),b=new ia,_=new ba(f,m,v,b,g,P,y),x=new An(f),E=new On(f,x,y),w=new In(f,E,x,y),C=new Hn(f),T=new ta(j,m,g),S=new aa,A=new pa,M=new Rn(j,v,w,s),R=new Dn(f,m,y,g),D=new kn(f,m,y,g),y.programs=T.programs,j.capabilities=g,j.extensions=m,j.properties=b,j.renderLists=S,j.state=v,j.info=y}se();var le="undefined"!=typeof navigator&&"xr"in navigator?new Da(j,f):new Ra(j);this.vr=le;var ue=new Ea(j,f),ce=new va(j,w,g.maxTextureSize);this.shadowMap=ce;var he=new Pa;function pe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),F=!0}function de(){console.log("THREE.WebGLRenderer: Context Restored."),F=!1,se()}function me(e){var t=e.target;t.removeEventListener("dispose",me),function(e){ge(e),b.remove(e)}(t)}function ge(e){var t=b.get(e).program;e.program=void 0,void 0!==t&&T.releaseProgram(t)}this.materialManager=he,this.onCustom1Finish=function(){},this.renderCustom1=!0,this.getContext=function(){return f},this.getContextAttributes=function(){return f.getContextAttributes()},this.forceContextLoss=function(){var e=m.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=m.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return J},this.setPixelRatio=function(e){void 0!==e&&(J=e,this.setSize(G,Y,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Ct),e.set(G,Y)},this.setSize=function(e,i,r){le.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(G=e,Y=i,t.width=Math.floor(e*J),t.height=Math.floor(i*J),!1!==r&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Ct),e.set(G*J,Y*J).floor()},this.setDrawingBufferSize=function(e,i,r){G=e,Y=i,J=r,t.width=Math.floor(e*r),t.height=Math.floor(i*r),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new It),e.copy(z)},this.getViewport=function(e){return e.copy(Q)},this.setViewport=function(e,t,i,r){e.isVector4?Q.set(e.x,e.y,e.z,e.w):Q.set(e,t,i,r),v.viewport(z.copy(Q).multiplyScalar(J).floor())},this.getScissor=function(e){return e.copy(Z)},this.setScissor=function(e,t,i,r){e.isVector4?Z.set(e.x,e.y,e.z,e.w):Z.set(e,t,i,r),v.scissor(q.copy(Z).multiplyScalar(J).floor())},this.getScissorTest=function(){return K},this.setScissorTest=function(e){v.setScissorTest(K=e)},this.getClearColor=function(){return M.getClearColor()},this.setClearColor=function(){M.setClearColor.apply(M,arguments)},this.getClearAlpha=function(){return M.getClearAlpha()},this.setClearAlpha=function(){M.setClearAlpha.apply(M,arguments)},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===i||i)&&(r|=1024),f.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",pe,!1),t.removeEventListener("webglcontextrestored",de,!1),S.dispose(),A.dispose(),b.dispose(),w.dispose(),le.dispose(),ye.stop()},this.renderBufferImmediate=function(e,t){v.initAttributes();var i=b.get(e);e.hasPositions&&!i.position&&(i.position=f.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=f.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=f.createBuffer()),e.hasColors&&!i.color&&(i.color=f.createBuffer());var r=t.getAttributes();e.hasPositions&&(f.bindBuffer(34962,i.position),f.bufferData(34962,e.positionArray,35048),v.enableAttribute(r.position),f.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(f.bindBuffer(34962,i.normal),f.bufferData(34962,e.normalArray,35048),v.enableAttribute(r.normal),f.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(f.bindBuffer(34962,i.uv),f.bufferData(34962,e.uvArray,35048),v.enableAttribute(r.uv),f.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(f.bindBuffer(34962,i.color),f.bufferData(34962,e.colorArray,35048),v.enableAttribute(r.color),f.vertexAttribPointer(r.color,3,5126,!1,0,0)),v.disableUnusedAttributes(),f.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,r,n,o){var a=n.isMesh&&n.matrixWorld.determinant()<0;v.setMaterial(r,a);var s=Se(e,t,r,n),l=!1;N.geometry===i.id&&N.program===s.id&&N.wireframe===(!0===r.wireframe)||(N.geometry=i.id,N.program=s.id,N.wireframe=!0===r.wireframe,l=!0),n.morphTargetInfluences&&(C.update(n,i,r,s),l=!0);var u=i.index,c=i.attributes.position;if((null===u||0!==u.count)&&void 0!==c&&0!==c.count){var h,p=1;!0===r.wireframe&&(u=E.getWireframeAttribute(i),p=2);var d=R;null!==u&&(h=x.get(u),(d=D).setIndex(h)),l&&(!function(e,t,i,r){if(!1===g.isWebGL2&&(e.isInstancedMesh||t.isInstancedBufferGeometry)&&null===m.get("ANGLE_instanced_arrays"))return;v.initAttributes();var n=t.attributes,o=r.getAttributes(),a=i.defaultAttributeValues;for(var s in o){var l=o[s];if(l>=0){var u=n[s];if(void 0!==u){var c=u.normalized,h=u.itemSize;if(void 0===(w=x.get(u)))continue;var p=w.buffer,d=w.type,y=w.bytesPerElement;if(u.isInterleavedBufferAttribute){var b=u.data,_=b.stride,E=u.offset;b&&b.isInstancedInterleavedBuffer?(v.enableAttributeAndDivisor(l,b.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=b.meshPerAttribute*b.count)):v.enableAttribute(l),f.bindBuffer(34962,p),f.vertexAttribPointer(l,h,d,c,_*y,E*y)}else u.isInstancedBufferAttribute?(v.enableAttributeAndDivisor(l,u.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=u.meshPerAttribute*u.count)):v.enableAttribute(l),f.bindBuffer(34962,p),f.vertexAttribPointer(l,h,d,c,0,0)}else if("instanceMatrix"===s){var w;if(void 0===(w=x.get(e.instanceMatrix)))continue;p=w.buffer,d=w.type;v.enableAttributeAndDivisor(l+0,1),v.enableAttributeAndDivisor(l+1,1),v.enableAttributeAndDivisor(l+2,1),v.enableAttributeAndDivisor(l+3,1),f.bindBuffer(34962,p),f.vertexAttribPointer(l+0,4,d,!1,64,0),f.vertexAttribPointer(l+1,4,d,!1,64,16),f.vertexAttribPointer(l+2,4,d,!1,64,32),f.vertexAttribPointer(l+3,4,d,!1,64,48)}else if(void 0!==a){var T=a[s];if(void 0!==T)switch(T.length){case 2:f.vertexAttrib2fv(l,T);break;case 3:f.vertexAttrib3fv(l,T);break;case 4:f.vertexAttrib4fv(l,T);break;default:f.vertexAttrib1fv(l,T)}}}}v.disableUnusedAttributes()}(n,i,r,s),null!==u&&f.bindBuffer(34963,h.buffer));var y=1/0;null!==u?y=u.count:void 0!==c&&(y=c.count);var b=i.drawRange.start*p,_=i.drawRange.count*p,w=null!==o?o.start*p:0,T=null!==o?o.count*p:1/0,S=Math.max(b,w),A=Math.min(y,b+_,w+T)-1,M=Math.max(0,A-S+1);if(0!==M){if(n.isMesh)if(!0===r.wireframe)v.setLineWidth(r.wireframeLinewidth*oe()),d.setMode(1);else switch(n.drawMode){case at:d.setMode(4);break;case st:d.setMode(5);break;case lt:d.setMode(6)}else if(n.isLine){var P=r.linewidth;void 0===P&&(P=1),v.setLineWidth(P*oe()),n.isLineSegments?d.setMode(1):n.isLineLoop?d.setMode(2):d.setMode(3)}else n.isPoints?d.setMode(0):n.isSprite&&d.setMode(4);n.isInstancedMesh?d.renderInstances(i,S,M,n.count):i.isInstancedBufferGeometry?d.renderInstances(i,S,M,i.maxInstancedCount):d.render(S,M)}}},this.compile=function(e,t){(d=A.get(e,t)).init(),e.traverse((function(e){e.isLight&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(t),e.traverse((function(t){if(t.material)if(Array.isArray(t.material))for(var i=0;i<t.material.length;i++)Te(t.material[i],e.fog,t);else Te(t.material,e.fog,t)}))};var ve=null;var ye=new Sn;function be(e,t,i,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||$.intersectsSprite(e)){r&&ne.setFromMatrixPosition(e.matrixWorld).applyMatrix4(re);var n=w.update(e);(o=e.material).visible&&p.push(e,n,o,i,ne.z,null)}}else if(e.isImmediateRenderObject)r&&ne.setFromMatrixPosition(e.matrixWorld).applyMatrix4(re),p.push(e,null,e.material,i,ne.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==y.render.frame&&(e.skeleton.update(e),e.skeleton.frame=y.render.frame),!e.frustumCulled||$.intersectsObject(e))){r&&ne.setFromMatrixPosition(e.matrixWorld).applyMatrix4(re);n=w.update(e);var o=e.material;if(Array.isArray(o))for(var a=n.groups,s=0,l=a.length;s<l;s++){var u=a[s],c=o[u.materialIndex];c&&c.visible&&p.push(e,n,c,i,ne.z,u)}else o.visible&&p.push(e,n,o,i,ne.z,null)}var h=e.children;for(s=0,l=h.length;s<l;s++)be(h[s],t,i,r)}}function Ee(e,t,i,r){for(var n=0,o=e.length;n<o;n++){var a=e[n],s=a.object,l=a.geometry,u=void 0===r?a.material:r,c=a.group;if(i.isArrayCamera)if(V=i,le.enabled&&ue.isAvailable())we(s,t,i,l,u,c);else for(var h=i.cameras,p=0,f=h.length;p<f;p++){var m=h[p];s.layers.test(m.layers)&&(v.viewport(z.copy(m.viewport)),d.setupLights(m),we(s,t,m,l,u,c))}else V=null,we(s,t,i,l,u,c)}}function we(e,t,i,r,n,o){var a;a=e.onBeforeRender(j,t,i,r,n,o);var s=e.onBeforeUpdateModelViewMatrix;if(!s||null!==s.call(e,j,t,i,r,a,o)){if(0!==he.$mode){var l=he.getStrategy();l&&(a=l.call(e,this,t,i,r,n,o))}if(null!==a){if(a&&(n=a),d=A.get(t,V||i),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){v.setMaterial(n);var u=Se(i,t.fog,n,e);N.geometry=null,N.program=null,N.wireframe=!1,function(e,t){e.render((function(e){j.renderBufferImmediate(e,t)}))}(e,u)}else j.renderBufferDirect(i,t.fog,r,n,e,o);var c=e.onAfterUpdateModelViewMatrix;c&&null===c.call(e,j,t,i,r,a,o)||(e.onAfterRender(j,t,i,r,n,o),d=A.get(t,V||i))}}}function Te(e,t,i){var r=b.get(e),n=d.state.lights,o=d.state.shadowsArray,a=n.state.version,s=T.getParameters(e,n.state,o,t,ee.numPlanes,ee.numIntersection,i),l=T.getProgramCacheKey(e,s),u=r.program,c=!0;if(void 0===u)e.addEventListener("dispose",me);else if(u.cacheKey!==l)ge(e);else if(r.lightsStateVersion!==a)r.lightsStateVersion=a,c=!1;else{if(void 0!==s.shaderID)return;c=!1}if(c){if(s.shaderID){var h=Tn[s.shaderID];r.shader={name:e.type,uniforms:an(h.uniforms),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}}else r.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(r.shader,j),l=T.getProgramCacheKey(e,s),u=T.acquireProgram(e,r.shader,s,l),r.program=u,e.program=u}var p=u.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var f=0;f<j.maxMorphTargets;f++)p["morphTarget"+f]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(f=0;f<j.maxMorphNormals;f++)p["morphNormal"+f]>=0&&e.numSupportedMorphNormals++}var m=r.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=ee.numPlanes,r.numIntersection=ee.numIntersection,m.clippingPlanes=ee.uniform),r.fog=t,r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=a,r.needsLights&&(m.ambientLightColor.value=n.state.ambient,m.lightProbe.value=n.state.probe,m.directionalLights.value=n.state.directional,m.spotLights.value=n.state.spot,m.rectAreaLights.value=n.state.rectArea,m.pointLights.value=n.state.point,m.hemisphereLights.value=n.state.hemi,m.directionalShadowMap.value=n.state.directionalShadowMap,m.directionalShadowMatrix.value=n.state.directionalShadowMatrix,m.spotShadowMap.value=n.state.spotShadowMap,m.spotShadowMatrix.value=n.state.spotShadowMatrix,m.pointShadowMap.value=n.state.pointShadowMap,m.pointShadowMatrix.value=n.state.pointShadowMatrix);var v=r.program.getUniforms(),y=Bo.seqWithValue(v.seq,m);r.uniformsList=y,r.logarithmicDepthBuffer=g.logarithmicDepthBuffer}function Se(e,t,i,r){_.resetTextureUnits();var n=b.get(i),o=d.state.lights;if(te&&(ie||e!==U)){var a=e===U&&i.id===I;ee.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,e,n,a)}i.version===n.__version&&(void 0===n.program?i.needsUpdate=!0:i.fog&&n.fog!==t?i.needsUpdate=!0:n.needsLights&&n.lightsStateVersion!==o.state.version?i.needsUpdate=!0:void 0===n.numClippingPlanes||n.numClippingPlanes===ee.numPlanes&&n.numIntersection===ee.numIntersection?n.logarithmicDepthBuffer!==g.logarithmicDepthBuffer&&(i.needsUpdate=!0):i.needsUpdate=!0),i.version!==n.__version&&(Te(i,t,r),n.__version=i.version);var s,u,c=!1,h=!1,p=!1,m=n.program,y=m.getUniforms(),x=n.shader.uniforms;if(v.useProgram(m.program)&&(c=!0,h=!0,p=!0),i.id!==I&&(I=i.id,h=!0),c||U!==e){if(m.numMultiviewViews>0?ue.updateCameraProjectionMatricesUniform(e,y):y.setValue(f,"projectionMatrix",e.projectionMatrix),g.logarithmicDepthBuffer&&y.setValue(f,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),U!==e&&(U=e,h=!0,p=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap){var E=y.map.cameraPosition;void 0!==E&&E.setValue(f,ne.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&y.setValue(f,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&(m.numMultiviewViews>0?ue.updateCameraViewMatricesUniform(e,y):y.setValue(f,"viewMatrix",e.matrixWorldInverse))}if(i.skinning){y.setOptional(f,r,"bindMatrix"),y.setOptional(f,r,"bindMatrixInverse");var w=r.skeleton;if(w){var T=w.bones,S=r.bindMatrixInverse.clone();if(S.elements[12]=0,S.elements[13]=0,S.elements[14]=0,y.setValue(f,"localBindMatrixInverse",S),g.floatVertexTextures){if(void 0===w.boneTexture){var A=Math.sqrt(4*T.length);A=Mt.ceilPowerOfTwo(A),A=Math.max(A,4);var M=new Float32Array(A*A*4);M.set(w.boneMatrices);var C=new yn(M,A,A,Ce,_e);w.boneMatrices=M,w.boneTexture=C,w.boneTextureSize=A}y.setValue(f,"boneTexture",w.boneTexture,_),y.setValue(f,"boneTextureSize",w.boneTextureSize)}else y.setOptional(f,w,"boneMatrices")}}return(h||n.receiveShadow!==r.receiveShadow)&&(n.receiveShadow=r.receiveShadow,y.setValue(f,"receiveShadow",r.receiveShadow)),h&&(y.setValue(f,"toneMappingExposure",j.toneMappingExposure),y.setValue(f,"toneMappingWhitePoint",j.toneMappingWhitePoint),n.needsLights&&(u=p,(s=x).ambientLightColor.needsUpdate=u,s.lightProbe.needsUpdate=u,s.directionalLights.needsUpdate=u,s.pointLights.needsUpdate=u,s.spotLights.needsUpdate=u,s.rectAreaLights.needsUpdate=u,s.hemisphereLights.needsUpdate=u),t&&i.fog&&function(e,t){e.fogColor.value.copy(t.color),e.fogAlpha&&(e.fogAlpha.value=t.alpha?t.alpha:1);t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(x,t),i.isMeshBasicMaterial?Ae(x,i):i.isMeshLambertMaterial?(Ae(x,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(x,i)):i.isMeshPhongMaterial?(Ae(x,i),i.isMeshToonMaterial?function(e,t){Me(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(x,i):Me(x,i)):i.isMeshStandardMaterial?(Ae(x,i),i.isMeshPhysicalMaterial?function(e,t){Re(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===l&&e.clearcoatNormalScale.value.negate());e.transparency.value=t.transparency}(x,i):Re(x,i)):i.isMeshMatcapMaterial?(Ae(x,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===l&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===l&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(x,i)):i.isMeshDepthMaterial?(Ae(x,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(x,i)):i.isMeshDistanceMaterial?(Ae(x,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(x,i)):i.isMeshNormalMaterial?(Ae(x,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===l&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===l&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(x,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(x,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(x,i)):i.isPointsMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*J,e.scale.value=.5*Y,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(x,i):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(x,i):i.isShadowMaterial&&(x.color.value.copy(i.color),x.opacity.value=i.opacity),void 0!==x.ltc_1&&(x.ltc_1.value=wn.LTC_1),void 0!==x.ltc_2&&(x.ltc_2.value=wn.LTC_2),Bo.upload(f,n.uniformsList,x,_),i.colorMapping&&y.setValue(f,"colorMapping",i.colorMapping,_),i.baseQuaternion&&y.setValue(f,"baseQuaternion",i.baseQuaternion),i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)),y.setValue(f,"baseId",i.baseId),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Bo.upload(f,n.uniformsList,x,_),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&y.setValue(f,"center",r.center),m.numMultiviewViews>0?ue.updateObjectMatricesUniforms(r,e,y):(y.setValue(f,"modelViewMatrix",r.modelViewMatrix),y.setValue(f,"normalMatrix",r.normalMatrix)),y.setValue(f,"modelMatrix",r.matrixWorld),m}function Ae(e,t){var i;e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=b.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?i=t.map:t.specularMap?i=t.specularMap:t.displacementMap?i=t.displacementMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.roughnessMap?i=t.roughnessMap:t.metalnessMap?i=t.metalnessMap:t.alphaMap?i=t.alphaMap:t.emissiveMap&&(i=t.emissiveMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix)),t.alphaMap&&(!0===t.alphaMap.matrixAutoUpdate&&t.alphaMap.updateMatrix(),e.uvTransform1.value.copy(t.alphaMap.matrix)),t.alphaMap1&&(!0===t.alphaMap1.matrixAutoUpdate&&t.alphaMap1.updateMatrix(),e.uvTransform1.value.copy(t.alphaMap1.matrix)),t.emissiveMap&&(!0===t.emissiveMap.matrixAutoUpdate&&t.emissiveMap.updateMatrix(),e.uvTransform2.value.copy(t.emissiveMap.matrix))}function Me(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===l&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===l&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function Re(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===l&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===l&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}ye.setAnimationLoop((function(e){le.isPresenting()||ve&&ve(e)})),"undefined"!=typeof window&&ye.setContext(window),this.setAnimationLoop=function(e){ve=e,le.setAnimationLoop(e),ye.start()},this.render=function(e,t){var i,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),i=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),t&&t.isCamera){if(!F){if(N.geometry=null,N.program=null,N.wireframe=!1,I=-1,U=null,this.initRenderList){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),le.enabled&&le.isPresenting()&&(t=le.getCamera(t)),(d=A.get(e,t)).init(),e.onBeforeRender(j,e,t,i||B),re.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),$.setFromMatrix(re),ie=this.localClippingEnabled,te=ee.init(this.clippingPlanes,ie,t),(p=S.get(e,t)).init(),be(e,t,0,j.sortObjects),!0===j.sortObjects&&p.sort(),te&&ee.beginShadows();var n=d.state.shadowsArray;ce.render(n,e,t),d.setupLights(t),te&&ee.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i),le.enabled&&ue.isAvailable()&&ue.attachCamera(t),M.render(p,e,t,r)}else p=S.get(e,t),this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i),le.enabled&&ue.isAvailable()&&ue.attachCamera(t);var o=p.custom1,a=p.opaque,s=p.transparent;if(e.overrideMaterial){var l=e.overrideMaterial;o.length&&this.renderCustom1&&(Ee(o,e,t,l),this.onCustom1Finish()),a.length&&Ee(a,e,t,l),s.length&&Ee(s,e,t,l)}else o.length&&this.renderCustom1&&(Ee(o,e,t),this.onCustom1Finish()),a.length&&Ee(a,e,t),s.length&&Ee(s,e,t);e.onAfterRender(j,e,t),null!==B&&(_.updateRenderTargetMipmap(B),_.updateMultisampleRenderTarget(B)),v.buffers.depth.setTest(!0),v.buffers.depth.setMask(!0),v.buffers.color.setMask(!0),v.setPolygonOffset(!1),le.enabled&&(ue.isAvailable()&&ue.detachCamera(t),le.submitFrame()),p=null,d=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){O!==e&&null===B&&f.bindFramebuffer(36160,e),O=e},this.getActiveCubeFace=function(){return k},this.getActiveMipmapLevel=function(){return L},this.getRenderTarget=function(){return B},this.setRenderTarget=function(e,t,i){B=e,k=t,L=i,e&&void 0===b.get(e).__webglFramebuffer&&_.setupRenderTarget(e);var r=O,n=!1;if(e){var o=b.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(r=o[t||0],n=!0):r=e.isWebGLMultisampleRenderTarget?b.get(e).__webglMultisampledFramebuffer:o,z.copy(e.viewport),q.copy(e.scissor),W=e.scissorTest}else z.copy(Q).multiplyScalar(J).floor(),q.copy(Z).multiplyScalar(J).floor(),W=K;if(H!==r&&(f.bindFramebuffer(36160,r),H=r),v.viewport(z),v.scissor(q),v.setScissorTest(W),n){var a=b.get(e.texture);f.framebufferTexture2D(36160,36064,34069+(t||0),a.__webglTexture,i||0)}},this.readRenderTargetPixels=function(e,t,i,r,n,o,a){if(e&&e.isWebGLRenderTarget){var s=b.get(e).__webglFramebuffer;if(e.isWebGLRenderTargetCube&&void 0!==a&&(s=s[a]),s){var l=!1;s!==H&&(f.bindFramebuffer(36160,s),l=!0);try{var u=e.texture,c=u.format,h=u.type;if(c!==Ce&&P.convert(c)!==f.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h===fe||P.convert(h)===f.getParameter(35738)||h===_e&&(g.isWebGL2||m.get("OES_texture_float")||m.get("WEBGL_color_buffer_float"))||h===xe&&(g.isWebGL2?m.get("EXT_color_buffer_float"):m.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===f.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&i>=0&&i<=e.height-n&&f.readPixels(t,i,r,n,P.convert(c),P.convert(h),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&f.bindFramebuffer(36160,H)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,i){void 0===i&&(i=0);var r=Math.pow(2,-i),n=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r),a=P.convert(t.format);_.setTexture2D(t,0),f.copyTexImage2D(3553,i,a,e.x,e.y,n,o,0),v.unbindTexture()},this.copyTextureToTexture=function(e,t,i,r){var n=t.image.width,o=t.image.height,a=P.convert(i.format),s=P.convert(i.type);_.setTexture2D(i,0),t.isDataTexture?f.texSubImage2D(3553,r||0,e.x,e.y,n,o,a,s,t.image.data):f.texSubImage2D(3553,r||0,e.x,e.y,a,s,t.image),v.unbindTexture()},this.initTexture=function(e){_.setTexture2D(e,0),v.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Fa(e,t){this.name="",this.color=new nr(e),this.density=void 0!==t?t:25e-5}function Oa(e,t,i){this.name="",this.color=new nr(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3}function ka(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=wt,this.updateRange={offset:0,count:-1},this.version=0}function La(e,t,i,r){this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===r}function Ba(e){cr.call(this),this.type="SpriteMaterial",this.color=new nr(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.assign(Ra.prototype,Tt.prototype),Object.assign(Da.prototype,Tt.prototype),Object.assign(Fa.prototype,{isFogExp2:!0,clone:function(){return new Fa(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Oa.prototype,{isFog:!0,clone:function(){return new Oa(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(ka.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(ka.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(La.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(La.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this},clone:function(){return new this.constructor(this.data,this.itemSize,this.offset,this.normalized).copy(this)}}),Ba.prototype=Object.create(cr.prototype),Ba.prototype.constructor=Ba,Ba.prototype.isSpriteMaterial=!0,Ba.prototype.copy=function(e){return cr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var Ha=new jt,Ia=new jt,Na=new jt,Ua=new Ct,Va=new Ct,za=new Jt,qa=new jt,Wa=new jt,Ga=new jt,Xa=new Ct,Ya=new Ct,Ja=new Ct;function Qa(e){if(di.call(this),this.type="Sprite",void 0===Sa){Sa=new Pr;var t=new ka(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Sa.setIndex([0,1,2,0,2,3]),Sa.setAttribute("position",new La(t,3,0,!1)),Sa.setAttribute("uv",new La(t,2,3,!1))}this.geometry=Sa,this.material=void 0!==e?e:new Ba,this.center=new Ct(.5,.5)}function Za(e,t,i,r,n,o){Ua.subVectors(e,i).addScalar(.5).multiply(r),void 0!==n?(Va.x=o*Ua.x-n*Ua.y,Va.y=n*Ua.x+o*Ua.y):Va.copy(Ua),e.copy(t),e.x+=Va.x,e.y+=Va.y,e.applyMatrix4(za)}Qa.prototype=Object.assign(Object.create(di.prototype),{constructor:Qa,isSprite:!0,raycast:function(e,t){if(null!==e.camera){Ia.setFromMatrixScale(this.matrixWorld),za.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Na.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ia.multiplyScalar(-Na.z);var i,r,n=this.material.rotation;0!==n&&(r=Math.cos(n),i=Math.sin(n));var o=this.center;Za(qa.set(-.5,-.5,0),Na,o,Ia,i,r),Za(Wa.set(.5,-.5,0),Na,o,Ia,i,r),Za(Ga.set(.5,.5,0),Na,o,Ia,i,r),Xa.set(0,0),Ya.set(1,0),Ja.set(1,1);var a=e.ray.intersectTriangle(qa,Wa,Ga,!1,Ha);if(null!==a||(Za(Wa.set(-.5,.5,0),Na,o,Ia,i,r),Ya.set(0,1),null!==(a=e.ray.intersectTriangle(qa,Ga,Wa,!1,Ha)))){var s=e.ray.origin.distanceTo(Ha);s<e.near||s>e.far||t.push({distance:s,point:Ha.clone(),uv:er.getUV(Ha,qa,Wa,Ga,Xa,Ya,Ja,new Ct),face:null,object:this})}}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return di.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}});var Ka=new jt,$a=new jt;function es(){di.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function ts(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Jr.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Jt,this.bindMatrixInverse=new Jt}es.prototype=Object.assign(Object.create(di.prototype),{constructor:es,isLOD:!0,copy:function(e){di.prototype.copy.call(this,e,!1);for(var t=e.levels,i=0,r=t.length;i<r;i++){var n=t[i];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=this.levels,r=0;r<i.length&&!(t<i[r].distance);r++);return i.splice(r,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){for(var i=1,r=t.length;i<r&&!(e<t[i].distance);i++);return t[i-1].object}return null},raycast:function(e,t){if(this.levels.length>0){Ka.setFromMatrixPosition(this.matrixWorld);var i=e.ray.origin.distanceTo(Ka);this.getObjectForDistance(i).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){Ka.setFromMatrixPosition(e.matrixWorld),$a.setFromMatrixPosition(this.matrixWorld);var i=Ka.distanceTo($a);t[0].object.visible=!0;for(var r=1,n=t.length;r<n&&i>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(;r<n;r++)t[r].object.visible=!1}},toJSON:function(e){var t=di.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var i=this.levels,r=0,n=i.length;r<n;r++){var o=i[r];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),ts.prototype=Object.assign(Object.create(Jr.prototype),{constructor:ts,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new It,t=this.geometry.attributes.skinWeight,i=0,r=t.count;i<r;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);var n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Jr.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var is=new Jt,rs=new Jt,ns=new jt;function os(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Jt)}}function as(){di.call(this),this.type="Bone"}Object.assign(os.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new Jt;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},pose:function(){var e,t,i;for(t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(e){var t=this.bones,i=this.boneInverses,r=this.boneMatrices,n=this.boneTexture;e.getWorldPosition(ns);for(var o=0,a=t.length;o<a;o++){var s=t[o]?t[o].matrixWorld:rs;is.multiplyMatrices(s,i[o]);var l=is.elements;l[12]-=ns.x,l[13]-=ns.y,l[14]-=ns.z,is.toArray(r,16*o)}void 0!==n&&(n.needsUpdate=!0)},clone:function(){return new os(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,i=this.bones.length;t<i;t++){var r=this.bones[t];if(r.name===e)return r}}}),as.prototype=Object.assign(Object.create(di.prototype),{constructor:as,isBone:!0});var ss=new Jt,ls=new Jt,us=[],cs=new Jr;function hs(e,t,i){Jr.call(this,e,t),this.instanceMatrix=new pr(new Float32Array(16*i),16),this.count=i}function ps(e){cr.call(this),this.type="LineBasicMaterial",this.color=new nr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}hs.prototype=Object.assign(Object.create(Jr.prototype),{constructor:hs,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var i=this.matrixWorld,r=this.count;if(cs.geometry=this.geometry,cs.material=this.material,void 0!==cs.material)for(var n=0;n<r;n++)this.getMatrixAt(n,ss),ls.multiplyMatrices(i,ss),cs.matrixWorld=ls,cs.raycast(e,us),us.length>0&&(us[0].instanceId=n,us[0].object=this,t.push(us[0]),us.length=0)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),ps.prototype=Object.create(cr.prototype),ps.prototype.constructor=ps,ps.prototype.isLineBasicMaterial=!0,ps.prototype.copy=function(e){return cr.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var ds=new jt,fs=new jt,ms=new Jt,gs=new Ii,vs=new Pi;function ys(e,t,i){1===i&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),di.call(this),this.type="Line",this.geometry=void 0!==e?e:new Pr,this.material=void 0!==t?t:new ps({color:16777215*Math.random()})}ys.prototype=Object.assign(Object.create(di.prototype),{constructor:ys,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,i=[0],r=1,n=t.count;r<n;r++)ds.fromBufferAttribute(t,r-1),fs.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=ds.distanceTo(fs);e.setAttribute("lineDistance",new _r(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;(i=e.lineDistances)[0]=0;for(r=1,n=o.length;r<n;r++)i[r]=i[r-1],i[r]+=o[r-1].distanceTo(o[r])}return this},raycast:function(e,t){var i=e.linePrecision,r=this.geometry,n=this.matrixWorld;if(null===r.boundingSphere&&r.computeBoundingSphere(),vs.copy(r.boundingSphere),vs.applyMatrix4(n),vs.radius+=i,!1!==e.ray.intersectsSphere(vs)){ms.getInverse(n),gs.copy(e.ray).applyMatrix4(ms);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,s=new jt,l=new jt,u=new jt,c=new jt,h=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var p=r.index,d=r.attributes.position.array;if(null!==p)for(var f=p.array,m=0,g=f.length-1;m<g;m+=h){var v=f[m],y=f[m+1];if(s.fromArray(d,3*v),l.fromArray(d,3*y),!(gs.distanceSqToSegment(s,l,c,u)>a))c.applyMatrix4(this.matrixWorld),(x=e.ray.origin.distanceTo(c))<e.near||x>e.far||t.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}else for(m=0,g=d.length/3-1;m<g;m+=h){if(s.fromArray(d,3*m),l.fromArray(d,3*m+3),!(gs.distanceSqToSegment(s,l,c,u)>a))c.applyMatrix4(this.matrixWorld),(x=e.ray.origin.distanceTo(c))<e.near||x>e.far||t.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else if(r.isGeometry){var b=r.vertices,_=b.length;for(m=0;m<_-1;m+=h){var x;if(!(gs.distanceSqToSegment(b[m],b[m+1],c,u)>a))c.applyMatrix4(this.matrixWorld),(x=e.ray.origin.distanceTo(c))<e.near||x>e.far||t.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var bs=new jt,_s=new jt;function xs(e,t){ys.call(this,e,t),this.type="LineSegments"}function Es(e,t){ys.call(this,e,t),this.type="LineLoop"}function ws(e){cr.call(this),this.type="PointsMaterial",this.color=new nr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}xs.prototype=Object.assign(Object.create(ys.prototype),{constructor:xs,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,i=[],r=0,n=t.count;r<n;r+=2)bs.fromBufferAttribute(t,r),_s.fromBufferAttribute(t,r+1),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+bs.distanceTo(_s);e.setAttribute("lineDistance",new _r(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;for(i=e.lineDistances,r=0,n=o.length;r<n;r+=2)bs.copy(o[r]),_s.copy(o[r+1]),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+bs.distanceTo(_s)}return this}}),Es.prototype=Object.assign(Object.create(ys.prototype),{constructor:Es,isLineLoop:!0}),ws.prototype=Object.create(cr.prototype),ws.prototype.constructor=ws,ws.prototype.isPointsMaterial=!0,ws.prototype.copy=function(e){return cr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var Ts=new Jt,Ss=new Ii,As=new Pi,Ms=new jt;function Cs(e,t){di.call(this),this.type="Points",this.geometry=void 0!==e?e:new Pr,this.material=void 0!==t?t:new ws({color:16777215*Math.random()}),this.updateMorphTargets()}function Rs(e,t,i,r,n,o,a){var s=Ss.distanceSqToPoint(e);if(s<i){var l=new jt;Ss.closestPointToPoint(e,l),l.applyMatrix4(r);var u=n.ray.origin.distanceTo(l);if(u<n.near||u>n.far)return;o.push({distance:u,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:a})}}function Ds(e,t,i,r,n,o,a,s,l){Ht.call(this,e,t,i,r,n,o,a,s,l),this.format=void 0!==a?a:Me,this.minFilter=void 0!==o?o:he,this.magFilter=void 0!==n?n:he,this.generateMipmaps=!1}function Ps(e,t,i,r,n,o,a,s,l,u,c,h){Ht.call(this,null,o,a,s,l,u,r,n,c,h),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function js(e,t,i,r,n,o,a,s,l){Ht.call(this,e,t,i,r,n,o,a,s,l),this.needsUpdate=!0}function Fs(e,t,i,r,n,o,a,s,l,u){if((u=void 0!==u?u:je)!==je&&u!==Fe)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&u===je&&(i=ve),void 0===i&&u===Fe&&(i=Se),Ht.call(this,null,r,n,o,a,s,u,i,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:le,this.minFilter=void 0!==s?s:le,this.flipY=!1,this.generateMipmaps=!1}function Os(e){Pr.call(this),this.type="WireframeGeometry";var t,i,r,n,o,a,s,l,u,c,h=[],p=[0,0],d={},f=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,r=m.length;t<r;t++){var g=m[t];for(i=0;i<3;i++)s=g[f[i]],l=g[f[(i+1)%3]],p[0]=Math.min(s,l),p[1]=Math.max(s,l),void 0===d[u=p[0]+","+p[1]]&&(d[u]={index1:p[0],index2:p[1]})}for(u in d)a=d[u],c=e.vertices[a.index1],h.push(c.x,c.y,c.z),c=e.vertices[a.index2],h.push(c.x,c.y,c.z)}else if(e&&e.isBufferGeometry){var v,y,b,_,x,E,w;if(c=new jt,null!==e.index){for(v=e.attributes.position,y=e.index,0===(b=e.groups).length&&(b=[{start:0,count:y.count,materialIndex:0}]),n=0,o=b.length;n<o;++n)for(t=x=(_=b[n]).start,r=x+_.count;t<r;t+=3)for(i=0;i<3;i++)s=y.getX(t+i),l=y.getX(t+(i+1)%3),p[0]=Math.min(s,l),p[1]=Math.max(s,l),void 0===d[u=p[0]+","+p[1]]&&(d[u]={index1:p[0],index2:p[1]});for(u in d)a=d[u],c.fromBufferAttribute(v,a.index1),h.push(c.x,c.y,c.z),c.fromBufferAttribute(v,a.index2),h.push(c.x,c.y,c.z)}else for(t=0,r=(v=e.attributes.position).count/3;t<r;t++)for(i=0;i<3;i++)E=3*t+i,c.fromBufferAttribute(v,E),h.push(c.x,c.y,c.z),w=3*t+(i+1)%3,c.fromBufferAttribute(v,w),h.push(c.x,c.y,c.z)}this.setAttribute("position",new _r(h,3))}function ks(e,t,i){rn.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new Ls(e,t,i)),this.mergeVertices()}function Ls(e,t,i){Pr.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:i};var r,n,o=[],a=[],s=[],l=[],u=new jt,c=new jt,h=new jt,p=new jt,d=new jt;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var f=t+1;for(r=0;r<=i;r++){var m=r/i;for(n=0;n<=t;n++){var g=n/t;e(g,m,c),a.push(c.x,c.y,c.z),g-1e-5>=0?(e(g-1e-5,m,h),p.subVectors(c,h)):(e(g+1e-5,m,h),p.subVectors(h,c)),m-1e-5>=0?(e(g,m-1e-5,h),d.subVectors(c,h)):(e(g,m+1e-5,h),d.subVectors(h,c)),u.crossVectors(p,d).normalize(),s.push(u.x,u.y,u.z),l.push(g,m)}}for(r=0;r<i;r++)for(n=0;n<t;n++){var v=r*f+n,y=r*f+n+1,b=(r+1)*f+n+1,_=(r+1)*f+n;o.push(v,y,_),o.push(y,b,_)}this.setIndex(o),this.setAttribute("position",new _r(a,3)),this.setAttribute("normal",new _r(s,3)),this.setAttribute("uv",new _r(l,2))}function Bs(e,t,i,r){rn.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r},this.fromBufferGeometry(new Hs(e,t,i,r)),this.mergeVertices()}function Hs(e,t,i,r){Pr.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r},i=i||1;var n=[],o=[];function a(e,t,i,r){var n,o,a=Math.pow(2,r),l=[];for(n=0;n<=a;n++){l[n]=[];var u=e.clone().lerp(i,n/a),c=t.clone().lerp(i,n/a),h=a-n;for(o=0;o<=h;o++)l[n][o]=0===o&&n===a?u:u.clone().lerp(c,o/h)}for(n=0;n<a;n++)for(o=0;o<2*(a-n)-1;o++){var p=Math.floor(o/2);o%2==0?(s(l[n][p+1]),s(l[n+1][p]),s(l[n][p])):(s(l[n][p+1]),s(l[n+1][p+1]),s(l[n+1][p]))}}function s(e){n.push(e.x,e.y,e.z)}function l(t,i){var r=3*t;i.x=e[r+0],i.y=e[r+1],i.z=e[r+2]}function u(e,t,i,r){r<0&&1===e.x&&(o[t]=e.x-1),0===i.x&&0===i.z&&(o[t]=r/2/Math.PI+.5)}function c(e){return Math.atan2(e.z,-e.x)}!function(e){for(var i=new jt,r=new jt,n=new jt,o=0;o<t.length;o+=3)l(t[o+0],i),l(t[o+1],r),l(t[o+2],n),a(i,r,n,e)}(r=r||0),function(e){for(var t=new jt,i=0;i<n.length;i+=3)t.x=n[i+0],t.y=n[i+1],t.z=n[i+2],t.normalize().multiplyScalar(e),n[i+0]=t.x,n[i+1]=t.y,n[i+2]=t.z}(i),function(){for(var e=new jt,t=0;t<n.length;t+=3){e.x=n[t+0],e.y=n[t+1],e.z=n[t+2];var i=c(e)/2/Math.PI+.5,r=(a=e,Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5);o.push(i,1-r)}var a;(function(){for(var e=new jt,t=new jt,i=new jt,r=new jt,a=new Ct,s=new Ct,l=new Ct,h=0,p=0;h<n.length;h+=9,p+=6){e.set(n[h+0],n[h+1],n[h+2]),t.set(n[h+3],n[h+4],n[h+5]),i.set(n[h+6],n[h+7],n[h+8]),a.set(o[p+0],o[p+1]),s.set(o[p+2],o[p+3]),l.set(o[p+4],o[p+5]),r.copy(e).add(t).add(i).divideScalar(3);var d=c(r);u(a,p+0,e,d),u(s,p+2,t,d),u(l,p+4,i,d)}})(),function(){for(var e=0;e<o.length;e+=6){var t=o[e+0],i=o[e+2],r=o[e+4],n=Math.max(t,i,r),a=Math.min(t,i,r);n>.9&&a<.1&&(t<.2&&(o[e+0]+=1),i<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new _r(n,3)),this.setAttribute("normal",new _r(n.slice(),3)),this.setAttribute("uv",new _r(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function Is(e,t){rn.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ns(e,t)),this.mergeVertices()}function Ns(e,t){Hs.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Us(e,t){rn.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Vs(e,t)),this.mergeVertices()}function Vs(e,t){Hs.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function zs(e,t){rn.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new qs(e,t)),this.mergeVertices()}function qs(e,t){var i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];Hs.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ws(e,t){rn.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Gs(e,t)),this.mergeVertices()}function Gs(e,t){var i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r];Hs.call(this,n,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Xs(e,t,i,r,n,o){rn.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new Ys(e,t,i,r,n);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function Ys(e,t,i,r,n){Pr.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n},t=t||64,i=i||1,r=r||8,n=n||!1;var o=e.computeFrenetFrames(t,n);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,l=new jt,u=new jt,c=new Ct,h=new jt,p=[],d=[],f=[],m=[];function g(n){h=e.getPointAt(n/t,h);var a=o.normals[n],c=o.binormals[n];for(s=0;s<=r;s++){var f=s/r*Math.PI*2,m=Math.sin(f),g=-Math.cos(f);u.x=g*a.x+m*c.x,u.y=g*a.y+m*c.y,u.z=g*a.z+m*c.z,u.normalize(),d.push(u.x,u.y,u.z),l.x=h.x+i*u.x,l.y=h.y+i*u.y,l.z=h.z+i*u.z,p.push(l.x,l.y,l.z)}}!function(){for(a=0;a<t;a++)g(a);g(!1===n?t:0),function(){for(a=0;a<=t;a++)for(s=0;s<=r;s++)c.x=a/t,c.y=s/r,f.push(c.x,c.y)}(),function(){for(s=1;s<=t;s++)for(a=1;a<=r;a++){var e=(r+1)*(s-1)+(a-1),i=(r+1)*s+(a-1),n=(r+1)*s+a,o=(r+1)*(s-1)+a;m.push(e,i,o),m.push(i,n,o)}}()}(),this.setIndex(m),this.setAttribute("position",new _r(p,3)),this.setAttribute("normal",new _r(d,3)),this.setAttribute("uv",new _r(f,2))}function Js(e,t,i,r,n,o,a){rn.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Qs(e,t,i,r,n,o)),this.mergeVertices()}function Qs(e,t,i,r,n,o){Pr.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:o},e=e||1,t=t||.4,i=Math.floor(i)||64,r=Math.floor(r)||8,n=n||2,o=o||3;var a,s,l=[],u=[],c=[],h=[],p=new jt,d=new jt,f=new jt,m=new jt,g=new jt,v=new jt,y=new jt;for(a=0;a<=i;++a){var b=a/i*n*Math.PI*2;for(M(b,n,o,e,f),M(b+.01,n,o,e,m),v.subVectors(m,f),y.addVectors(m,f),g.crossVectors(v,y),y.crossVectors(g,v),g.normalize(),y.normalize(),s=0;s<=r;++s){var _=s/r*Math.PI*2,x=-t*Math.cos(_),E=t*Math.sin(_);p.x=f.x+(x*y.x+E*g.x),p.y=f.y+(x*y.y+E*g.y),p.z=f.z+(x*y.z+E*g.z),u.push(p.x,p.y,p.z),d.subVectors(p,f).normalize(),c.push(d.x,d.y,d.z),h.push(a/i),h.push(s/r)}}for(s=1;s<=i;s++)for(a=1;a<=r;a++){var w=(r+1)*(s-1)+(a-1),T=(r+1)*s+(a-1),S=(r+1)*s+a,A=(r+1)*(s-1)+a;l.push(w,T,A),l.push(T,S,A)}function M(e,t,i,r,n){var o=Math.cos(e),a=Math.sin(e),s=i/t*e,l=Math.cos(s);n.x=r*(2+l)*.5*o,n.y=r*(2+l)*a*.5,n.z=r*Math.sin(s)*.5}this.setIndex(l),this.setAttribute("position",new _r(u,3)),this.setAttribute("normal",new _r(c,3)),this.setAttribute("uv",new _r(h,2))}function Zs(e,t,i,r,n){rn.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},this.fromBufferGeometry(new Ks(e,t,i,r,n)),this.mergeVertices()}function Ks(e,t,i,r,n){Pr.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},e=e||1,t=t||.4,i=Math.floor(i)||8,r=Math.floor(r)||6,n=n||2*Math.PI;var o,a,s=[],l=[],u=[],c=[],h=new jt,p=new jt,d=new jt;for(o=0;o<=i;o++)for(a=0;a<=r;a++){var f=a/r*n,m=o/i*Math.PI*2;p.x=(e+t*Math.cos(m))*Math.cos(f),p.y=(e+t*Math.cos(m))*Math.sin(f),p.z=t*Math.sin(m),l.push(p.x,p.y,p.z),h.x=e*Math.cos(f),h.y=e*Math.sin(f),d.subVectors(p,h).normalize(),u.push(d.x,d.y,d.z),c.push(a/r),c.push(o/i)}for(o=1;o<=i;o++)for(a=1;a<=r;a++){var g=(r+1)*o+a-1,v=(r+1)*(o-1)+a-1,y=(r+1)*(o-1)+a,b=(r+1)*o+a;s.push(g,v,b),s.push(v,y,b)}this.setIndex(s),this.setAttribute("position",new _r(l,3)),this.setAttribute("normal",new _r(u,3)),this.setAttribute("uv",new _r(c,2))}Cs.prototype=Object.assign(Object.create(di.prototype),{constructor:Cs,isPoints:!0,raycast:function(e,t){var i=this.geometry,r=this.matrixWorld,n=e.params.Points.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),As.copy(i.boundingSphere),As.applyMatrix4(r),As.radius+=n,!1!==e.ray.intersectsSphere(As)){Ts.getInverse(r),Ss.copy(e.ray).applyMatrix4(Ts);var o=n/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(i.isBufferGeometry){var s=i.index,l=i.attributes.position.array;if(null!==s)for(var u=s.array,c=0,h=u.length;c<h;c++){var p=u[c];Ms.fromArray(l,3*p),Rs(Ms,p,a,r,e,t,this)}else{c=0;for(var d=l.length/3;c<d;c++)Ms.fromArray(l,3*c),Rs(Ms,c,a,r,e,t,this)}}else{var f=i.vertices;for(c=0,d=f.length;c<d;c++)Rs(f[c],c,a,r,e,t,this)}}},updateMorphTargets:function(){var e,t,i,r=this.geometry;if(r.isBufferGeometry){var n=r.morphAttributes,o=Object.keys(n);if(o.length>0){var a=n[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)i=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}else{var s=r.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Ds.prototype=Object.assign(Object.create(Ht.prototype),{constructor:Ds,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Ps.prototype=Object.create(Ht.prototype),Ps.prototype.constructor=Ps,Ps.prototype.isCompressedTexture=!0,js.prototype=Object.create(Ht.prototype),js.prototype.constructor=js,js.prototype.isCanvasTexture=!0,Fs.prototype=Object.create(Ht.prototype),Fs.prototype.constructor=Fs,Fs.prototype.isDepthTexture=!0,Os.prototype=Object.create(Pr.prototype),Os.prototype.constructor=Os,ks.prototype=Object.create(rn.prototype),ks.prototype.constructor=ks,Ls.prototype=Object.create(Pr.prototype),Ls.prototype.constructor=Ls,Bs.prototype=Object.create(rn.prototype),Bs.prototype.constructor=Bs,Hs.prototype=Object.create(Pr.prototype),Hs.prototype.constructor=Hs,Is.prototype=Object.create(rn.prototype),Is.prototype.constructor=Is,Ns.prototype=Object.create(Hs.prototype),Ns.prototype.constructor=Ns,Us.prototype=Object.create(rn.prototype),Us.prototype.constructor=Us,Vs.prototype=Object.create(Hs.prototype),Vs.prototype.constructor=Vs,zs.prototype=Object.create(rn.prototype),zs.prototype.constructor=zs,qs.prototype=Object.create(Hs.prototype),qs.prototype.constructor=qs,Ws.prototype=Object.create(rn.prototype),Ws.prototype.constructor=Ws,Gs.prototype=Object.create(Hs.prototype),Gs.prototype.constructor=Gs,Xs.prototype=Object.create(rn.prototype),Xs.prototype.constructor=Xs,Ys.prototype=Object.create(Pr.prototype),Ys.prototype.constructor=Ys,Ys.prototype.toJSON=function(){var e=Pr.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},Js.prototype=Object.create(rn.prototype),Js.prototype.constructor=Js,Qs.prototype=Object.create(Pr.prototype),Qs.prototype.constructor=Qs,Zs.prototype=Object.create(rn.prototype),Zs.prototype.constructor=Zs,Ks.prototype=Object.create(Pr.prototype),Ks.prototype.constructor=Ks;var $s=function(e,t,i){i=i||2;var r,n,o,a,s,l,u,c=t&&t.length,h=c?t[0]*i:e.length,p=el(e,0,h,i,!0),d=[];if(!p||p.next===p.prev)return d;if(c&&(p=function(e,t,i,r){var n,o,a,s,l,u=[];for(n=0,o=t.length;n<o;n++)a=t[n]*r,s=n<o-1?t[n+1]*r:e.length,(l=el(e,a,s,r,!1))===l.next&&(l.steiner=!0),u.push(cl(l));for(u.sort(sl),n=0;n<u.length;n++)ll(u[n],i),i=tl(i,i.next);return i}(e,t,p,i)),e.length>80*i){r=o=e[0],n=a=e[1];for(var f=i;f<h;f+=i)(s=e[f])<r&&(r=s),(l=e[f+1])<n&&(n=l),s>o&&(o=s),l>a&&(a=l);u=0!==(u=Math.max(o-r,a-n))?1/u:0}return il(p,d,i,r,n,u),d};function el(e,t,i,r,n){var o,a;if(n===function(e,t,i,r){for(var n=0,o=t,a=i-r;o<i;o+=r)n+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return n}(e,t,i,r)>0)for(o=t;o<i;o+=r)a=yl(o,e[o],e[o+1],a);else for(o=i-r;o>=t;o-=r)a=yl(o,e[o],e[o+1],a);return a&&fl(a,a.next)&&(bl(a),a=a.next),a}function tl(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!fl(r,r.next)&&0!==dl(r.prev,r,r.next))r=r.next;else{if(bl(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function il(e,t,i,r,n,o,a){if(e){!a&&o&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=ul(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,o,a,s,l,u=1;do{for(i=e,e=null,o=null,a=0;i;){for(a++,r=i,s=0,t=0;t<u&&(s++,r=r.nextZ);t++);for(l=u;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,s--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,u*=2}while(a>1)}(n)}(e,r,n,o);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?nl(e,r,n,o):rl(e))t.push(s.i/i),t.push(e.i/i),t.push(l.i/i),bl(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?il(e=ol(e,t,i),t,i,r,n,o,2):2===a&&al(e,t,i,r,n,o):il(tl(e),t,i,r,n,o,1);break}}}function rl(e){var t=e.prev,i=e,r=e.next;if(dl(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(hl(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&dl(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function nl(e,t,i,r){var n=e.prev,o=e,a=e.next;if(dl(n,o,a)>=0)return!1;for(var s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,u=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,c=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,h=ul(s,l,t,i,r),p=ul(u,c,t,i,r),d=e.prevZ,f=e.nextZ;d&&d.z>=h&&f&&f.z<=p;){if(d!==e.prev&&d!==e.next&&hl(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&dl(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==e.prev&&f!==e.next&&hl(n.x,n.y,o.x,o.y,a.x,a.y,f.x,f.y)&&dl(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&hl(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&dl(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==e.prev&&f!==e.next&&hl(n.x,n.y,o.x,o.y,a.x,a.y,f.x,f.y)&&dl(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function ol(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!fl(n,o)&&ml(n,r,r.next,o)&&gl(n,o)&&gl(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),bl(r),bl(r.next),r=e=o),r=r.next}while(r!==e);return r}function al(e,t,i,r,n,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&pl(a,s)){var l=vl(a,s);return a=tl(a,a.next),l=tl(l,l.next),il(a,t,i,r,n,o),void il(l,t,i,r,n,o)}s=s.next}a=a.next}while(a!==e)}function sl(e,t){return e.x-t.x}function ll(e,t){if(t=function(e,t){var i,r=t,n=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>a){if(a=s,s===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===a)return i.prev;var l,u=i,c=i.x,h=i.y,p=1/0;r=i.next;for(;r!==u;)n>=r.x&&r.x>=c&&n!==r.x&&hl(o<h?n:a,o,c,h,o<h?a:n,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(n-r.x))<p||l===p&&r.x>i.x)&&gl(r,e)&&(i=r,p=l),r=r.next;return i}(e,t)){var i=vl(t,e);tl(i,i.next)}}function ul(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function cl(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function hl(e,t,i,r,n,o,a,s){return(n-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(i-a)*(t-s)>=0&&(i-a)*(o-s)-(n-a)*(r-s)>=0}function pl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&ml(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&gl(e,t)&&gl(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)}function dl(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function fl(e,t){return e.x===t.x&&e.y===t.y}function ml(e,t,i,r){return!!(fl(e,i)&&fl(t,r)||fl(e,r)&&fl(i,t))||dl(e,t,i)>0!=dl(e,t,r)>0&&dl(i,r,e)>0!=dl(i,r,t)>0}function gl(e,t){return dl(e.prev,e,e.next)<0?dl(e,t,e.next)>=0&&dl(e,e.prev,t)>=0:dl(e,t,e.prev)<0||dl(e,e.next,t)<0}function vl(e,t){var i=new _l(e.i,e.x,e.y),r=new _l(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function yl(e,t,i,r){var n=new _l(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function bl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _l(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var xl={area:function(e){for(var t=e.length,i=0,r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return.5*i},isClockWise:function(e){return xl.area(e)<0},triangulateShape:function(e,t){var i=[],r=[],n=[];El(e),wl(i,e);var o=e.length;t.forEach(El);for(var a=0;a<t.length;a++)r.push(o),o+=t[a].length,wl(i,t[a]);var s=$s(i,r);for(a=0;a<s.length;a+=3)n.push(s.slice(a,a+3));return n}};function El(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function wl(e,t){for(var i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}function Tl(e,t){rn.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Sl(e,t)),this.mergeVertices()}function Sl(e,t){Pr.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var i=this,r=[],n=[],o=0,a=e.length;o<a;o++){s(e[o])}function s(e){var o=[],a=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:100,u=void 0===t.bevelEnabled||t.bevelEnabled,c=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:c-2,p=void 0!==t.bevelOffset?t.bevelOffset:0,d=void 0!==t.bevelSegments?t.bevelSegments:3,f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Al;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);var g,v,y,b,_,x,E,w,T=!1;f&&(g=f.getSpacedPoints(s),T=!0,u=!1,v=f.computeFrenetFrames(s,!1),y=new jt,b=new jt,_=new jt),u||(d=0,c=0,h=0,p=0);var S=e.extractPoints(a),A=S.shape,M=S.holes;if(!xl.isClockWise(A))for(A=A.reverse(),E=0,w=M.length;E<w;E++)x=M[E],xl.isClockWise(x)&&(M[E]=x.reverse());var C=xl.triangulateShape(A,M),R=A;for(E=0,w=M.length;E<w;E++)x=M[E],A=A.concat(x);function D(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}var P,j,F,O,k,L,B=A.length,H=C.length;function I(e,t,i){var r,n,o,a=e.x-t.x,s=e.y-t.y,l=i.x-e.x,u=i.y-e.y,c=a*a+s*s,h=a*u-s*l;if(Math.abs(h)>Number.EPSILON){var p=Math.sqrt(c),d=Math.sqrt(l*l+u*u),f=t.x-s/p,m=t.y+a/p,g=((i.x-u/d-f)*u-(i.y+l/d-m)*l)/(a*u-s*l),v=(r=f+a*g-e.x)*r+(n=m+s*g-e.y)*n;if(v<=2)return new Ct(r,n);o=Math.sqrt(v/2)}else{var y=!1;a>Number.EPSILON?l>Number.EPSILON&&(y=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(u)&&(y=!0),y?(r=-s,n=a,o=Math.sqrt(c)):(r=a,n=s,o=Math.sqrt(c/2))}return new Ct(r/o,n/o)}for(var N=[],U=0,V=R.length,z=V-1,q=U+1;U<V;U++,z++,q++)z===V&&(z=0),q===V&&(q=0),N[U]=I(R[U],R[z],R[q]);var W,G,X=[],Y=N.concat();for(E=0,w=M.length;E<w;E++){for(x=M[E],W=[],U=0,z=(V=x.length)-1,q=U+1;U<V;U++,z++,q++)z===V&&(z=0),q===V&&(q=0),W[U]=I(x[U],x[z],x[q]);X.push(W),Y=Y.concat(W)}for(P=0;P<d;P++){for(F=P/d,O=c*Math.cos(F*Math.PI/2),j=h*Math.sin(F*Math.PI/2)+p,U=0,V=R.length;U<V;U++)Q((k=D(R[U],N[U],j)).x,k.y,-O);for(E=0,w=M.length;E<w;E++)for(x=M[E],W=X[E],U=0,V=x.length;U<V;U++)Q((k=D(x[U],W[U],j)).x,k.y,-O)}for(j=h+p,U=0;U<B;U++)k=u?D(A[U],Y[U],j):A[U],T?(b.copy(v.normals[0]).multiplyScalar(k.x),y.copy(v.binormals[0]).multiplyScalar(k.y),_.copy(g[0]).add(b).add(y),Q(_.x,_.y,_.z)):Q(k.x,k.y,0);for(G=1;G<=s;G++)for(U=0;U<B;U++)k=u?D(A[U],Y[U],j):A[U],T?(b.copy(v.normals[G]).multiplyScalar(k.x),y.copy(v.binormals[G]).multiplyScalar(k.y),_.copy(g[G]).add(b).add(y),Q(_.x,_.y,_.z)):Q(k.x,k.y,l/s*G);for(P=d-1;P>=0;P--){for(F=P/d,O=c*Math.cos(F*Math.PI/2),j=h*Math.sin(F*Math.PI/2)+p,U=0,V=R.length;U<V;U++)Q((k=D(R[U],N[U],j)).x,k.y,l+O);for(E=0,w=M.length;E<w;E++)for(x=M[E],W=X[E],U=0,V=x.length;U<V;U++)k=D(x[U],W[U],j),T?Q(k.x,k.y+g[s-1].y,g[s-1].x+O):Q(k.x,k.y,l+O)}function J(e,t){var i,r;for(U=e.length;--U>=0;){i=U,(r=U-1)<0&&(r=e.length-1);var n=0,o=s+2*d;for(n=0;n<o;n++){var a=B*n,l=B*(n+1);K(t+i+a,t+r+a,t+r+l,t+i+l)}}}function Q(e,t,i){o.push(e),o.push(t),o.push(i)}function Z(e,t,n){$(e),$(t),$(n);var o=r.length/3,a=m.generateTopUV(i,r,o-3,o-2,o-1);ee(a[0]),ee(a[1]),ee(a[2])}function K(e,t,n,o){$(e),$(t),$(o),$(t),$(n),$(o);var a=r.length/3,s=m.generateSideWallUV(i,r,a-6,a-3,a-2,a-1);ee(s[0]),ee(s[1]),ee(s[3]),ee(s[1]),ee(s[2]),ee(s[3])}function $(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function ee(e){n.push(e.x),n.push(e.y)}!function(){var e=r.length/3;if(u){var t=0,n=B*t;for(U=0;U<H;U++)Z((L=C[U])[2]+n,L[1]+n,L[0]+n);for(n=B*(t=s+2*d),U=0;U<H;U++)Z((L=C[U])[0]+n,L[1]+n,L[2]+n)}else{for(U=0;U<H;U++)Z((L=C[U])[2],L[1],L[0]);for(U=0;U<H;U++)Z((L=C[U])[0]+B*s,L[1]+B*s,L[2]+B*s)}i.addGroup(e,r.length/3-e,0)}(),function(){var e=r.length/3,t=0;for(J(R,t),t+=R.length,E=0,w=M.length;E<w;E++)J(x=M[E],t),t+=x.length;i.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new _r(r,3)),this.setAttribute("uv",new _r(n,2)),this.computeVertexNormals()}Tl.prototype=Object.create(rn.prototype),Tl.prototype.constructor=Tl,Tl.prototype.toJSON=function(){var e=rn.prototype.toJSON.call(this);return Ml(this.parameters.shapes,this.parameters.options,e)},Sl.prototype=Object.create(Pr.prototype),Sl.prototype.constructor=Sl,Sl.prototype.toJSON=function(){var e=Pr.prototype.toJSON.call(this);return Ml(this.parameters.shapes,this.parameters.options,e)};var Al={generateTopUV:function(e,t,i,r,n){var o=t[3*i],a=t[3*i+1],s=t[3*r],l=t[3*r+1],u=t[3*n],c=t[3*n+1];return[new Ct(o,a),new Ct(s,l),new Ct(u,c)]},generateSideWallUV:function(e,t,i,r,n,o){var a=t[3*i],s=t[3*i+1],l=t[3*i+2],u=t[3*r],c=t[3*r+1],h=t[3*r+2],p=t[3*n],d=t[3*n+1],f=t[3*n+2],m=t[3*o],g=t[3*o+1],v=t[3*o+2];return Math.abs(s-c)<.01?[new Ct(a,1-l),new Ct(u,1-h),new Ct(p,1-f),new Ct(m,1-v)]:[new Ct(s,1-l),new Ct(c,1-h),new Ct(d,1-f),new Ct(g,1-v)]}};function Ml(e,t,i){if(i.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++){var o=e[r];i.shapes.push(o.uuid)}else i.shapes.push(e.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}function Cl(e,t){rn.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Rl(e,t)),this.mergeVertices()}function Rl(e,t){var i=(t=t||{}).font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new rn;var r=i.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Sl.call(this,r,t),this.type="TextBufferGeometry"}function Dl(e,t,i,r,n,o,a){rn.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Pl(e,t,i,r,n,o,a)),this.mergeVertices()}function Pl(e,t,i,r,n,o,a){Pr.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:o,thetaLength:a},e=e||1,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,l,u=Math.min(o+a,Math.PI),c=0,h=[],p=new jt,d=new jt,f=[],m=[],g=[],v=[];for(l=0;l<=i;l++){var y=[],b=l/i,_=0;for(0==l&&0==o?_=.5/t:l==i&&u==Math.PI&&(_=-.5/t),s=0;s<=t;s++){var x=s/t;p.x=-e*Math.cos(r+x*n)*Math.sin(o+b*a),p.y=e*Math.cos(o+b*a),p.z=e*Math.sin(r+x*n)*Math.sin(o+b*a),m.push(p.x,p.y,p.z),d.copy(p).normalize(),g.push(d.x,d.y,d.z),v.push(x+_,1-b),y.push(c++)}h.push(y)}for(l=0;l<i;l++)for(s=0;s<t;s++){var E=h[l][s+1],w=h[l][s],T=h[l+1][s],S=h[l+1][s+1];(0!==l||o>0)&&f.push(E,w,S),(l!==i-1||u<Math.PI)&&f.push(w,T,S)}this.setIndex(f),this.setAttribute("position",new _r(m,3)),this.setAttribute("normal",new _r(g,3)),this.setAttribute("uv",new _r(v,2))}function jl(e,t,i,r,n,o){rn.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:o},this.fromBufferGeometry(new Fl(e,t,i,r,n,o)),this.mergeVertices()}function Fl(e,t,i,r,n,o){Pr.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:o},e=e||.5,t=t||1,n=void 0!==n?n:0,o=void 0!==o?o:2*Math.PI,i=void 0!==i?Math.max(3,i):8;var a,s,l,u=[],c=[],h=[],p=[],d=e,f=(t-e)/(r=void 0!==r?Math.max(1,r):1),m=new jt,g=new Ct;for(s=0;s<=r;s++){for(l=0;l<=i;l++)a=n+l/i*o,m.x=d*Math.cos(a),m.y=d*Math.sin(a),c.push(m.x,m.y,m.z),h.push(0,0,1),g.x=(m.x/t+1)/2,g.y=(m.y/t+1)/2,p.push(g.x,g.y);d+=f}for(s=0;s<r;s++){var v=s*(i+1);for(l=0;l<i;l++){var y=a=l+v,b=a+i+1,_=a+i+2,x=a+1;u.push(y,b,x),u.push(b,_,x)}}this.setIndex(u),this.setAttribute("position",new _r(c,3)),this.setAttribute("normal",new _r(h,3)),this.setAttribute("uv",new _r(p,2))}function Ol(e,t,i,r){rn.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},this.fromBufferGeometry(new kl(e,t,i,r)),this.mergeVertices()}function kl(e,t,i,r){Pr.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t)||12,i=i||0,r=r||2*Math.PI,r=Mt.clamp(r,0,2*Math.PI);var n,o,a,s=[],l=[],u=[],c=1/t,h=new jt,p=new Ct;for(o=0;o<=t;o++){var d=i+o*c*r,f=Math.sin(d),m=Math.cos(d);for(a=0;a<=e.length-1;a++)h.x=e[a].x*f,h.y=e[a].y,h.z=e[a].x*m,l.push(h.x,h.y,h.z),p.x=o/t,p.y=a/(e.length-1),u.push(p.x,p.y)}for(o=0;o<t;o++)for(a=0;a<e.length-1;a++){var g=n=a+o*e.length,v=n+e.length,y=n+e.length+1,b=n+1;s.push(g,v,b),s.push(v,y,b)}if(this.setIndex(s),this.setAttribute("position",new _r(l,3)),this.setAttribute("uv",new _r(u,2)),this.computeVertexNormals(),r===2*Math.PI){var _=this.attributes.normal.array,x=new jt,E=new jt,w=new jt;for(n=t*e.length*3,o=0,a=0;o<e.length;o++,a+=3)x.x=_[a+0],x.y=_[a+1],x.z=_[a+2],E.x=_[n+a+0],E.y=_[n+a+1],E.z=_[n+a+2],w.addVectors(x,E).normalize(),_[a+0]=_[n+a+0]=w.x,_[a+1]=_[n+a+1]=w.y,_[a+2]=_[n+a+2]=w.z}}function Ll(e,t){rn.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Bl(e,t)),this.mergeVertices()}function Bl(e,t){Pr.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var i=[],r=[],n=[],o=[],a=0,s=0;if(!1===Array.isArray(e))u(e);else for(var l=0;l<e.length;l++)u(e[l]),this.addGroup(a,s,l),a+=s,s=0;function u(e){var a,l,u,c=r.length/3,h=e.extractPoints(t),p=h.shape,d=h.holes;for(!1===xl.isClockWise(p)&&(p=p.reverse()),a=0,l=d.length;a<l;a++)u=d[a],!0===xl.isClockWise(u)&&(d[a]=u.reverse());var f=xl.triangulateShape(p,d);for(a=0,l=d.length;a<l;a++)u=d[a],p=p.concat(u);for(a=0,l=p.length;a<l;a++){var m=p[a];r.push(m.x,m.y,0),n.push(0,0,1),o.push(m.x,m.y)}for(a=0,l=f.length;a<l;a++){var g=f[a],v=g[0]+c,y=g[1]+c,b=g[2]+c;i.push(v,y,b),s+=3}}this.setIndex(i),this.setAttribute("position",new _r(r,3)),this.setAttribute("normal",new _r(n,3)),this.setAttribute("uv",new _r(o,2))}function Hl(e,t){if(t.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){var n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}function Il(e,t){Pr.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var i,r,n,o,a=[],s=Math.cos(Mt.DEG2RAD*t),l=[0,0],u={},c=["a","b","c"];e.isBufferGeometry?(o=new rn).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,p=o.faces,d=0,f=p.length;d<f;d++)for(var m=p[d],g=0;g<3;g++)i=m[c[g]],r=m[c[(g+1)%3]],l[0]=Math.min(i,r),l[1]=Math.max(i,r),void 0===u[n=l[0]+","+l[1]]?u[n]={index1:l[0],index2:l[1],face1:d,face2:void 0}:u[n].face2=d;for(n in u){var v=u[n];if(void 0===v.face2||p[v.face1].normal.dot(p[v.face2].normal)<=s){var y=h[v.index1];a.push(y.x,y.y,y.z),y=h[v.index2],a.push(y.x,y.y,y.z)}}this.setAttribute("position",new _r(a,3))}function Nl(e,t,i,r,n,o,a,s){rn.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new Ul(e,t,i,r,n,o,a,s)),this.mergeVertices()}function Ul(e,t,i,r,n,o,a,s){Pr.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:a,thetaLength:s};var l=this;e=void 0!==e?e:1,t=void 0!==t?t:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var u=[],c=[],h=[],p=[],d=0,f=[],m=i/2,g=0;function v(i){var n,o,f,v=new Ct,y=new jt,b=0,_=!0===i?e:t,x=!0===i?1:-1;for(o=d,n=1;n<=r;n++)c.push(0,m*x,0),h.push(0,x,0),p.push(.5,.5),d++;for(f=d,n=0;n<=r;n++){var E=n/r*s+a,w=Math.cos(E),T=Math.sin(E);y.x=_*T,y.y=m*x,y.z=_*w,c.push(y.x,y.y,y.z),h.push(0,x,0),v.x=.5*w+.5,v.y=.5*T*x+.5,p.push(v.x,v.y),d++}for(n=0;n<r;n++){var S=o+n,A=f+n;!0===i?u.push(A,A+1,S):u.push(A+1,A,S),b+=3}l.addGroup(g,b,!0===i?1:2),g+=b}!function(){var o,v,y=new jt,b=new jt,_=0,x=(t-e)/i;for(v=0;v<=n;v++){var E=[],w=v/n,T=w*(t-e)+e;for(o=0;o<=r;o++){var S=o/r,A=S*s+a,M=Math.sin(A),C=Math.cos(A);b.x=T*M,b.y=-w*i+m,b.z=T*C,c.push(b.x,b.y,b.z),y.set(M,x,C).normalize(),h.push(y.x,y.y,y.z),p.push(S,1-w),E.push(d++)}f.push(E)}for(o=0;o<r;o++)for(v=0;v<n;v++){var R=f[v][o],D=f[v+1][o],P=f[v+1][o+1],j=f[v][o+1];u.push(R,D,j),u.push(D,P,j),_+=6}l.addGroup(g,_,0),g+=_}(),!1===o&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(u),this.setAttribute("position",new _r(c,3)),this.setAttribute("normal",new _r(h,3)),this.setAttribute("uv",new _r(p,2))}function Vl(e,t,i,r,n,o,a){Nl.call(this,0,e,t,i,r,n,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:o,thetaLength:a}}function zl(e,t,i,r,n,o,a){Ul.call(this,0,e,t,i,r,n,o,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:o,thetaLength:a}}function ql(e,t,i,r){rn.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},this.fromBufferGeometry(new Wl(e,t,i,r)),this.mergeVertices()}function Wl(e,t,i,r){Pr.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},e=e||1,t=void 0!==t?Math.max(3,t):8,i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI;var n,o,a=[],s=[],l=[],u=[],c=new jt,h=new Ct;for(s.push(0,0,0),l.push(0,0,1),u.push(.5,.5),o=0,n=3;o<=t;o++,n+=3){var p=i+o/t*r;c.x=e*Math.cos(p),c.y=e*Math.sin(p),s.push(c.x,c.y,c.z),l.push(0,0,1),h.x=(s[n]/e+1)/2,h.y=(s[n+1]/e+1)/2,u.push(h.x,h.y)}for(n=1;n<=t;n++)a.push(n,n+1,0);this.setIndex(a),this.setAttribute("position",new _r(s,3)),this.setAttribute("normal",new _r(l,3)),this.setAttribute("uv",new _r(u,2))}Cl.prototype=Object.create(rn.prototype),Cl.prototype.constructor=Cl,Rl.prototype=Object.create(Sl.prototype),Rl.prototype.constructor=Rl,Dl.prototype=Object.create(rn.prototype),Dl.prototype.constructor=Dl,Pl.prototype=Object.create(Pr.prototype),Pl.prototype.constructor=Pl,jl.prototype=Object.create(rn.prototype),jl.prototype.constructor=jl,Fl.prototype=Object.create(Pr.prototype),Fl.prototype.constructor=Fl,Ol.prototype=Object.create(rn.prototype),Ol.prototype.constructor=Ol,kl.prototype=Object.create(Pr.prototype),kl.prototype.constructor=kl,Ll.prototype=Object.create(rn.prototype),Ll.prototype.constructor=Ll,Ll.prototype.toJSON=function(){var e=rn.prototype.toJSON.call(this);return Hl(this.parameters.shapes,e)},Bl.prototype=Object.create(Pr.prototype),Bl.prototype.constructor=Bl,Bl.prototype.toJSON=function(){var e=Pr.prototype.toJSON.call(this);return Hl(this.parameters.shapes,e)},Il.prototype=Object.create(Pr.prototype),Il.prototype.constructor=Il,Nl.prototype=Object.create(rn.prototype),Nl.prototype.constructor=Nl,Ul.prototype=Object.create(Pr.prototype),Ul.prototype.constructor=Ul,Vl.prototype=Object.create(Nl.prototype),Vl.prototype.constructor=Vl,zl.prototype=Object.create(Ul.prototype),zl.prototype.constructor=zl,ql.prototype=Object.create(rn.prototype),ql.prototype.constructor=ql,Wl.prototype=Object.create(Pr.prototype),Wl.prototype.constructor=Wl;var Gl=Object.freeze({__proto__:null,WireframeGeometry:Os,ParametricGeometry:ks,ParametricBufferGeometry:Ls,TetrahedronGeometry:Is,TetrahedronBufferGeometry:Ns,OctahedronGeometry:Us,OctahedronBufferGeometry:Vs,IcosahedronGeometry:zs,IcosahedronBufferGeometry:qs,DodecahedronGeometry:Ws,DodecahedronBufferGeometry:Gs,PolyhedronGeometry:Bs,PolyhedronBufferGeometry:Hs,TubeGeometry:Xs,TubeBufferGeometry:Ys,TorusKnotGeometry:Js,TorusKnotBufferGeometry:Qs,TorusGeometry:Zs,TorusBufferGeometry:Ks,TextGeometry:Cl,TextBufferGeometry:Rl,SphereGeometry:Dl,SphereBufferGeometry:Pl,RingGeometry:jl,RingBufferGeometry:Fl,PlaneGeometry:Mn,PlaneBufferGeometry:Cn,LatheGeometry:Ol,LatheBufferGeometry:kl,ShapeGeometry:Ll,ShapeBufferGeometry:Bl,ExtrudeGeometry:Tl,ExtrudeBufferGeometry:Sl,EdgesGeometry:Il,ConeGeometry:Vl,ConeBufferGeometry:zl,CylinderGeometry:Nl,CylinderBufferGeometry:Ul,CircleGeometry:ql,CircleBufferGeometry:Wl,BoxGeometry:nn,BoxBufferGeometry:on});function Xl(e){cr.call(this),this.type="ShadowMaterial",this.color=new nr(0),this.transparent=!0,this.setValues(e)}function Yl(e){hn.call(this,e),this.type="RawShaderMaterial"}function Jl(e){cr.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new nr(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bt,this.normalScale=new Ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ql(e){Jl.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new Ct(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function Zl(e){cr.call(this),this.type="MeshPhongMaterial",this.color=new nr(16777215),this.specular=new nr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bt,this.normalScale=new Ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Kl(e){Zl.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function $l(e){cr.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bt,this.normalScale=new Ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function eu(e){cr.call(this),this.type="MeshLambertMaterial",this.color=new nr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function tu(e){cr.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new nr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bt,this.normalScale=new Ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function iu(e){ps.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Xl.prototype=Object.create(cr.prototype),Xl.prototype.constructor=Xl,Xl.prototype.isShadowMaterial=!0,Xl.prototype.copy=function(e){return cr.prototype.copy.call(this,e),this.color.copy(e.color),this},Yl.prototype=Object.create(hn.prototype),Yl.prototype.constructor=Yl,Yl.prototype.isRawShaderMaterial=!0,Jl.prototype=Object.create(cr.prototype),Jl.prototype.constructor=Jl,Jl.prototype.isMeshStandardMaterial=!0,Jl.prototype.copy=function(e){return cr.prototype.copy.call(this,e),this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ql.prototype=Object.create(Jl.prototype),Ql.prototype.constructor=Ql,Ql.prototype.isMeshPhysicalMaterial=!0,Ql.prototype.copy=function(e){return Jl.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new nr).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this},Zl.prototype=Object.create(cr.prototype),Zl.prototype.constructor=Zl,Zl.prototype.isMeshPhongMaterial=!0,Zl.prototype.copy=function(e){return cr.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Kl.prototype=Object.create(Zl.prototype),Kl.prototype.constructor=Kl,Kl.prototype.isMeshToonMaterial=!0,Kl.prototype.copy=function(e){return Zl.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},$l.prototype=Object.create(cr.prototype),$l.prototype.constructor=$l,$l.prototype.isMeshNormalMaterial=!0,$l.prototype.copy=function(e){return cr.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},eu.prototype=Object.create(cr.prototype),eu.prototype.constructor=eu,eu.prototype.isMeshLambertMaterial=!0,eu.prototype.copy=function(e){return cr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},tu.prototype=Object.create(cr.prototype),tu.prototype.constructor=tu,tu.prototype.isMeshMatcapMaterial=!0,tu.prototype.copy=function(e){return cr.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},iu.prototype=Object.create(ps.prototype),iu.prototype.constructor=iu,iu.prototype.isLineDashedMaterial=!0,iu.prototype.copy=function(e){return ps.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var ru=Object.freeze({__proto__:null,ShadowMaterial:Xl,SpriteMaterial:Ba,RawShaderMaterial:Yl,ShaderMaterial:hn,PointsMaterial:ws,MeshPhysicalMaterial:Ql,MeshStandardMaterial:Jl,MeshPhongMaterial:Zl,MeshToonMaterial:Kl,MeshNormalMaterial:$l,MeshLambertMaterial:eu,MeshDepthMaterial:da,MeshDistanceMaterial:fa,MeshBasicMaterial:hr,MeshMatcapMaterial:tu,LineDashedMaterial:iu,LineBasicMaterial:ps,Material:cr}),nu={arraySlice:function(e,t,i){return nu.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,i=new Array(t),r=0;r!==t;++r)i[r]=r;return i.sort((function(t,i){return e[t]-e[i]})),i},sortedArray:function(e,t,i){for(var r=e.length,n=new e.constructor(r),o=0,a=0;a!==r;++o)for(var s=i[o]*t,l=0;l!==t;++l)n[a++]=e[s+l];return n},flattenJSON:function(e,t,i,r){for(var n=1,o=e[0];void 0!==o&&void 0===o[r];)o=e[n++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[r])&&(t.push(o.time),i.push.apply(i,a)),o=e[n++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[r])&&(t.push(o.time),a.toArray(i,i.length)),o=e[n++]}while(void 0!==o);else do{void 0!==(a=o[r])&&(t.push(o.time),i.push(a)),o=e[n++]}while(void 0!==o)}},subclip:function(e,t,i,r,n){n=n||30;var o=e.clone();o.name=t;for(var a=[],s=0;s<o.tracks.length;++s){for(var l=o.tracks[s],u=l.getValueSize(),c=[],h=[],p=0;p<l.times.length;++p){var d=l.times[p]*n;if(!(d<i||d>=r)){c.push(l.times[p]);for(var f=0;f<u;++f)h.push(l.values[p*u+f])}}0!==c.length&&(l.times=nu.convertArray(c,l.times.constructor),l.values=nu.convertArray(h,l.values.constructor),a.push(l))}o.tracks=a;var m=1/0;for(s=0;s<o.tracks.length;++s)m>o.tracks[s].times[0]&&(m=o.tracks[s].times[0]);for(s=0;s<o.tracks.length;++s)o.tracks[s].shift(-1*m);return o.resetDuration(),o}};function ou(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function au(e,t,i,r){ou.call(this,e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function su(e,t,i,r){ou.call(this,e,t,i,r)}function lu(e,t,i,r){ou.call(this,e,t,i,r)}function uu(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=nu.convertArray(t,this.TimeBufferType),this.values=nu.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function cu(e,t,i){uu.call(this,e,t,i)}function hu(e,t,i,r){uu.call(this,e,t,i,r)}function pu(e,t,i,r){uu.call(this,e,t,i,r)}function du(e,t,i,r){ou.call(this,e,t,i,r)}function fu(e,t,i,r){uu.call(this,e,t,i,r)}function mu(e,t,i,r){uu.call(this,e,t,i,r)}function gu(e,t,i,r){uu.call(this,e,t,i,r)}function vu(e,t,i){this.name=e,this.tracks=i,this.duration=void 0!==t?t:-1,this.uuid=Mt.generateUUID(),this.duration<0&&this.resetDuration()}function yu(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return pu;case"vector":case"vector2":case"vector3":case"vector4":return gu;case"color":return hu;case"quaternion":return fu;case"bool":case"boolean":return cu;case"string":return mu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var i=[],r=[];nu.flattenJSON(e.keys,i,r,"value"),e.times=i,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(ou.prototype,{evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{var o;i:{r:if(!(e<r)){for(var a=i+2;;){if(void 0===r){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,n)}if(i===a)break;if(n=r,e<(r=t[++i]))break t}o=t.length;break i}if(e>=n)break e;var s=t[1];e<s&&(i=2,n=s);for(a=i-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===a)break;if(r=n,e>=(n=t[--i-1]))break t}o=i,i=0}for(;i<o;){var l=i+o>>>1;e<t[l]?o=l:i=l+1}if(r=t[i],void 0===(n=t[i-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,n,e)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r,o=0;o!==r;++o)t[o]=i[n+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(ou.prototype,{beforeStart_:ou.prototype.copySampleValue_,afterEnd_:ou.prototype.copySampleValue_}),au.prototype=Object.assign(Object.create(ou.prototype),{constructor:au,DefaultSettings_:{endingStart:ot,endingEnd:ot},intervalChanged_:function(e,t,i){var r=this.parameterPositions,n=e-2,o=e+1,a=r[n],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:n=e,a=2*t-i;break;case 2402:a=t+r[n=r.length-2]-r[n+1];break;default:n=e,a=i}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*i-t;break;case 2402:o=1,s=i+r[1]-r[0];break;default:o=e-1,s=t}var l=.5*(i-t),u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-i),this._offsetPrev=n*u,this._offsetNext=o*u},interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(i-t)/(r-t),f=d*d,m=f*d,g=-h*m+2*h*f-h*d,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,b=p*m-p*f,_=0;_!==a;++_)n[_]=g*o[u+_]+v*o[l+_]+y*o[s+_]+b*o[c+_];return n}}),su.prototype=Object.assign(Object.create(ou.prototype),{constructor:su,interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,u=(i-t)/(r-t),c=1-u,h=0;h!==a;++h)n[h]=o[l+h]*c+o[s+h]*u;return n}}),lu.prototype=Object.assign(Object.create(ou.prototype),{constructor:lu,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(uu,{toJSON:function(e){var t,i=e.constructor;if(void 0!==i.toJSON)t=i.toJSON(e);else{t={name:e.name,times:nu.convertArray(e.times,Array),values:nu.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}),Object.assign(uu.prototype,{constructor:uu,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new lu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new su(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new au(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]*=e;return this},trim:function(e,t){for(var i=this.times,r=i.length,n=0,o=r-1;n!==r&&i[n]<e;)++n;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==n||o!==r){n>=o&&(n=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=nu.arraySlice(i,n,o),this.values=nu.arraySlice(this.values,n*a,o*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var i=this.times,r=this.values,n=i.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,a=0;a!==n;a++){var s=i[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),e=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),e=!1;break}o=s}if(void 0!==r&&nu.isTypedArray(r)){a=0;for(var l=r.length;a!==l;++a){var u=r[a];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,u),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,i=this.getValueSize(),r=2302===this.getInterpolation(),n=1,o=e.length-1,a=1;a<o;++a){var s=!1,l=e[a];if(l!==e[a+1]&&(1!==a||l!==l[0]))if(r)s=!0;else for(var u=a*i,c=u-i,h=u+i,p=0;p!==i;++p){var d=t[u+p];if(d!==t[c+p]||d!==t[h+p]){s=!0;break}}if(s){if(a!==n){e[n]=e[a];var f=a*i,m=n*i;for(p=0;p!==i;++p)t[m+p]=t[f+p]}++n}}if(o>0){e[n]=e[o];for(f=o*i,m=n*i,p=0;p!==i;++p)t[m+p]=t[f+p];++n}return n!==e.length&&(this.times=nu.arraySlice(e,0,n),this.values=nu.arraySlice(t,0,n*i)),this},clone:function(){var e=nu.arraySlice(this.times,0),t=nu.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}),cu.prototype=Object.assign(Object.create(uu.prototype),{constructor:cu,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),hu.prototype=Object.assign(Object.create(uu.prototype),{constructor:hu,ValueTypeName:"color"}),pu.prototype=Object.assign(Object.create(uu.prototype),{constructor:pu,ValueTypeName:"number"}),du.prototype=Object.assign(Object.create(ou.prototype),{constructor:du,interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=(i-t)/(r-t),u=s+a;s!==u;s+=4)Rt.slerpFlat(n,0,o,s-a,o,s,l);return n}}),fu.prototype=Object.assign(Object.create(uu.prototype),{constructor:fu,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new du(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),mu.prototype=Object.assign(Object.create(uu.prototype),{constructor:mu,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),gu.prototype=Object.assign(Object.create(uu.prototype),{constructor:gu,ValueTypeName:"vector"}),Object.assign(vu,{parse:function(e){for(var t=[],i=e.tracks,r=1/(e.fps||1),n=0,o=i.length;n!==o;++n)t.push(yu(i[n]).scale(r));return new vu(e.name,e.duration,t)},toJSON:function(e){for(var t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},n=0,o=i.length;n!==o;++n)t.push(uu.toJSON(i[n]));return r},CreateFromMorphTargetSequence:function(e,t,i,r){for(var n=t.length,o=[],a=0;a<n;a++){var s=[],l=[];s.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);var u=nu.getKeyframeOrder(s);s=nu.sortedArray(s,1,u),l=nu.sortedArray(l,1,u),r||0!==s[0]||(s.push(n),l.push(l[0])),o.push(new pu(".morphTargetInfluences["+t[a].name+"]",s,l).scale(1/i))}return new vu(e,-1,o)},findByName:function(e,t){var i=e;if(!Array.isArray(e)){var r=e;i=r.geometry&&r.geometry.animations||r.animations}for(var n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){for(var r={},n=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],l=s.name.match(n);if(l&&l.length>1){var u=r[h=l[1]];u||(r[h]=u=[]),u.push(s)}}var c=[];for(var h in r)c.push(vu.CreateFromMorphTargetSequence(h,r[h],t,i));return c},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var i=function(e,t,i,r,n){if(0!==i.length){var o=[],a=[];nu.flattenJSON(i,o,a,r),0!==o.length&&n.push(new e(t,o,a))}},r=[],n=e.name||"default",o=e.length||-1,a=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var u=s[l].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var c={},h=0;h<u.length;h++)if(u[h].morphTargets)for(var p=0;p<u[h].morphTargets.length;p++)c[u[h].morphTargets[p]]=-1;for(var d in c){var f=[],m=[];for(p=0;p!==u[h].morphTargets.length;++p){var g=u[h];f.push(g.time),m.push(g.morphTarget===d?1:0)}r.push(new pu(".morphTargetInfluence["+d+"]",f,m))}o=c.length*(a||1)}else{var v=".bones["+t[l].name+"]";i(gu,v+".position",u,"pos",r),i(fu,v+".quaternion",u,"rot",r),i(gu,v+".scale",u,"scl",r)}}return 0===r.length?null:new vu(n,o,r)}}),Object.assign(vu.prototype,{resetDuration:function(){for(var e=0,t=0,i=this.tracks.length;t!==i;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new vu(this.name,this.duration,e)}});var bu={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function _u(e,t,i){var r=this,n=!1,o=0,a=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){a++,!1===n&&void 0!==r.onStart&&r.onStart(e,o,a),n=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,a),o===a&&(n=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,i=l.length;t<i;t+=2){var r=l[t],n=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return n}return null}}var xu=new _u;function Eu(e){this.manager=void 0!==e?e:xu,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(Eu.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}});var wu={};function Tu(e){Eu.call(this,e)}function Su(e){Eu.call(this,e)}function Au(e){Eu.call(this,e)}function Mu(e){Eu.call(this,e)}function Cu(e){Eu.call(this,e)}function Ru(e){Eu.call(this,e)}function Du(e){Eu.call(this,e)}function Pu(){this.type="Curve",this.arcLengthDivisions=200}function ju(e,t,i,r,n,o,a,s){Pu.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=r||1,this.aStartAngle=n||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function Fu(e,t,i,r,n,o){ju.call(this,e,t,i,i,r,n,o),this.type="ArcCurve"}function Ou(){var e=0,t=0,i=0,r=0;function n(n,o,a,s){e=n,t=a,i=-3*n+3*o-2*a-s,r=2*n-2*o+a+s}return{initCatmullRom:function(e,t,i,r,o){n(t,i,o*(i-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,i,r,o,a,s){var l=(t-e)/o-(i-e)/(o+a)+(i-t)/a,u=(i-t)/a-(r-t)/(a+s)+(r-i)/s;n(t,i,l*=a,u*=a)},calc:function(n){var o=n*n;return e+t*n+i*o+r*(o*n)}}}Tu.prototype=Object.assign(Object.create(Eu.prototype),{constructor:Tu,load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=bu.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout((function(){t&&t(o),n.manager.itemEnd(e)}),0),o;if(void 0===wu[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],l=!!a[2],u=a[3];u=decodeURIComponent(u),l&&(u=atob(u));try{var c,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var p=new Uint8Array(u.length),d=0;d<u.length;d++)p[d]=u.charCodeAt(d);c="blob"===h?new Blob([p.buffer],{type:s}):p.buffer;break;case"document":var f=new DOMParser;c=f.parseFromString(u,s);break;case"json":c=JSON.parse(u);break;default:c=u}setTimeout((function(){t&&t(c),n.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)}),0)}}else{wu[e]=[],wu[e].push({onLoad:t,onProgress:i,onError:r});var m=new XMLHttpRequest;for(var g in m.open("GET",e,!0),m.addEventListener("load",(function(t){var i=this.response,r=wu[e];if(delete wu[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),bu.add(e,i);for(var o=0,a=r.length;o<a;o++){(s=r[o]).onLoad&&s.onLoad(i)}n.manager.itemEnd(e)}else{for(o=0,a=r.length;o<a;o++){var s;(s=r[o]).onError&&s.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)}}),!1),m.addEventListener("progress",(function(t){for(var i=wu[e],r=0,n=i.length;r<n;r++){var o=i[r];o.onProgress&&o.onProgress(t)}}),!1),m.addEventListener("error",(function(t){var i=wu[e];delete wu[e];for(var r=0,o=i.length;r<o;r++){var a=i[r];a.onError&&a.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)}),!1),m.addEventListener("abort",(function(t){var i=wu[e];delete wu[e];for(var r=0,o=i.length;r<o;r++){var a=i[r];a.onError&&a.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return n.manager.itemStart(e),m}wu[e].push({onLoad:t,onProgress:i,onError:r})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Su.prototype=Object.assign(Object.create(Eu.prototype),{constructor:Su,load:function(e,t,i,r){var n=this,o=new Tu(n.manager);o.setPath(n.path),o.load(e,(function(e){t(n.parse(JSON.parse(e)))}),i,r)},parse:function(e){for(var t=[],i=0;i<e.length;i++){var r=vu.parse(e[i]);t.push(r)}return t}}),Au.prototype=Object.assign(Object.create(Eu.prototype),{constructor:Au,load:function(e,t,i,r){var n=this,o=[],a=new Ps;a.image=o;var s=new Tu(this.manager);function l(l){s.load(e[l],(function(e){var i=n.parse(e,!0);o[l]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(u+=1)&&(1===i.mipmapCount&&(a.minFilter=he),a.format=i.format,a.needsUpdate=!0,t&&t(a))}),i,r)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var u=0,c=0,h=e.length;c<h;++c)l(c);else s.load(e,(function(e){var i=n.parse(e,!0);if(i.isCubemap)for(var r=i.mipmaps.length/i.mipmapCount,s=0;s<r;s++){o[s]={mipmaps:[]};for(var l=0;l<i.mipmapCount;l++)o[s].mipmaps.push(i.mipmaps[s*i.mipmapCount+l]),o[s].format=i.format,o[s].width=i.width,o[s].height=i.height}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=he),a.format=i.format,a.needsUpdate=!0,t&&t(a)}),i,r);return a}}),Mu.prototype=Object.assign(Object.create(Eu.prototype),{constructor:Mu,load:function(e,t,i,r){var n=this,o=new yn,a=new Tu(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(e,(function(e){var i=n.parse(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:ae,o.wrapT=void 0!==i.wrapT?i.wrapT:ae,o.magFilter=void 0!==i.magFilter?i.magFilter:he,o.minFilter=void 0!==i.minFilter?i.minFilter:he,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps,o.minFilter=de),1===i.mipmapCount&&(o.minFilter=he),o.needsUpdate=!0,t&&t(o,i))}),i,r),o}}),Cu.prototype=Object.assign(Object.create(Eu.prototype),{constructor:Cu,load:function(e,t,i,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=bu.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout((function(){t&&t(o),n.manager.itemEnd(e)}),0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),bu.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(t){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a}}),Ru.prototype=Object.assign(Object.create(Eu.prototype),{constructor:Ru,load:function(e,t,i,r){var n=new Nn,o=new THREE.ImageLoader(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(i){o.load(e[i],(function(e){n.images[i]=e,6===++a&&(n.needsUpdate=!0,t&&t(n))}),void 0,r)}for(var l=0;l<e.length;++l)s(l);return n}}),Du.prototype=Object.assign(Object.create(Eu.prototype),{constructor:Du,load:function(e,t,i,r){var n=new Ht,o=new THREE.ImageLoader(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(i){n.image=i;var r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);n.format=r?Me:Ce,n.needsUpdate=!0,void 0!==t&&t(n)}),i,r),n}}),Object.assign(Pu.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var i=this.getUtoTmapping(e);return this.getPoint(i,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,r=[],n=this.getPoint(0),o=0;for(r.push(0),i=1;i<=e;i++)o+=(t=this.getPoint(i/e)).distanceTo(n),r.push(o),n=t;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i,r=this.getLengths(),n=0,o=r.length;i=t||e*r[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=r[n=Math.floor(s+(l-s)/2)]-i)<0)s=n+1;else{if(!(a>0)){l=n;break}l=n-1}if(r[n=l]===i)return n/(o-1);var u=r[n];return(n+(i-u)/(r[n+1]-u))/(o-1)},getTangent:function(e){var t=e-1e-4,i=e+1e-4;t<0&&(t=0),i>1&&(i=1);var r=this.getPoint(t);return this.getPoint(i).clone().sub(r).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var i,r,n,o=new jt,a=[],s=[],l=[],u=new jt,c=new Jt;for(i=0;i<=e;i++)r=i/e,a[i]=this.getTangentAt(r),a[i].normalize();s[0]=new jt,l[0]=new jt;var h=Number.MAX_VALUE,p=Math.abs(a[0].x),d=Math.abs(a[0].y),f=Math.abs(a[0].z);for(p<=h&&(h=p,o.set(1,0,0)),d<=h&&(h=d,o.set(0,1,0)),f<=h&&o.set(0,0,1),u.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],u),l[0].crossVectors(a[0],s[0]),i=1;i<=e;i++)s[i]=s[i-1].clone(),l[i]=l[i-1].clone(),u.crossVectors(a[i-1],a[i]),u.length()>Number.EPSILON&&(u.normalize(),n=Math.acos(Mt.clamp(a[i-1].dot(a[i]),-1,1)),s[i].applyMatrix4(c.makeRotationAxis(u,n))),l[i].crossVectors(a[i],s[i]);if(!0===t)for(n=Math.acos(Mt.clamp(s[0].dot(s[e]),-1,1)),n/=e,a[0].dot(u.crossVectors(s[0],s[e]))>0&&(n=-n),i=1;i<=e;i++)s[i].applyMatrix4(c.makeRotationAxis(a[i],n*i)),l[i].crossVectors(a[i],s[i]);return{tangents:a,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),ju.prototype=Object.create(Pu.prototype),ju.prototype.constructor=ju,ju.prototype.isEllipseCurve=!0,ju.prototype.getPoint=function(e,t){for(var i=t||new Ct,r=2*Math.PI,n=this.aEndAngle-this.aStartAngle,o=Math.abs(n)<Number.EPSILON;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(n=o?0:r),!0!==this.aClockwise||o||(n===r?n=-r:n-=r);var a=this.aStartAngle+e*n,s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var u=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,p=l-this.aY;s=h*u-p*c+this.aX,l=h*c+p*u+this.aY}return i.set(s,l)},ju.prototype.copy=function(e){return Pu.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},ju.prototype.toJSON=function(){var e=Pu.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},ju.prototype.fromJSON=function(e){return Pu.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Fu.prototype=Object.create(ju.prototype),Fu.prototype.constructor=Fu,Fu.prototype.isArcCurve=!0;var ku=new jt,Lu=new Ou,Bu=new Ou,Hu=new Ou;function Iu(e,t,i,r){Pu.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=i||"centripetal",this.tension=r||.5}function Nu(e,t,i,r,n){var o=.5*(r-t),a=.5*(n-i),s=e*e;return(2*i-2*r+o+a)*(e*s)+(-3*i+3*r-2*o-a)*s+o*e+i}function Uu(e,t,i,r){return function(e,t){var i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,r)}function Vu(e,t,i,r,n){return function(e,t){var i=1-e;return i*i*i*t}(e,t)+function(e,t){var i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,n)}function zu(e,t,i,r){Pu.call(this),this.type="CubicBezierCurve",this.v0=e||new Ct,this.v1=t||new Ct,this.v2=i||new Ct,this.v3=r||new Ct}function qu(e,t,i,r){Pu.call(this),this.type="CubicBezierCurve3",this.v0=e||new jt,this.v1=t||new jt,this.v2=i||new jt,this.v3=r||new jt}function Wu(e,t){Pu.call(this),this.type="LineCurve",this.v1=e||new Ct,this.v2=t||new Ct}function Gu(e,t){Pu.call(this),this.type="LineCurve3",this.v1=e||new jt,this.v2=t||new jt}function Xu(e,t,i){Pu.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Ct,this.v1=t||new Ct,this.v2=i||new Ct}function Yu(e,t,i){Pu.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new jt,this.v1=t||new jt,this.v2=i||new jt}function Ju(e){Pu.call(this),this.type="SplineCurve",this.points=e||[]}Iu.prototype=Object.create(Pu.prototype),Iu.prototype.constructor=Iu,Iu.prototype.isCatmullRomCurve3=!0,Iu.prototype.getPoint=function(e,t){var i,r,n,o,a=t||new jt,s=this.points,l=s.length,u=(l-(this.closed?0:1))*e,c=Math.floor(u),h=u-c;if(this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/l)+1)*l:0===h&&c===l-1&&(c=l-2,h=1),this.closed||c>0?i=s[(c-1)%l]:(ku.subVectors(s[0],s[1]).add(s[0]),i=ku),r=s[c%l],n=s[(c+1)%l],this.closed||c+2<l?o=s[(c+2)%l]:(ku.subVectors(s[l-1],s[l-2]).add(s[l-1]),o=ku),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,d=Math.pow(i.distanceToSquared(r),p),f=Math.pow(r.distanceToSquared(n),p),m=Math.pow(n.distanceToSquared(o),p);f<1e-4&&(f=1),d<1e-4&&(d=f),m<1e-4&&(m=f),Lu.initNonuniformCatmullRom(i.x,r.x,n.x,o.x,d,f,m),Bu.initNonuniformCatmullRom(i.y,r.y,n.y,o.y,d,f,m),Hu.initNonuniformCatmullRom(i.z,r.z,n.z,o.z,d,f,m)}else"catmullrom"===this.curveType&&(Lu.initCatmullRom(i.x,r.x,n.x,o.x,this.tension),Bu.initCatmullRom(i.y,r.y,n.y,o.y,this.tension),Hu.initCatmullRom(i.z,r.z,n.z,o.z,this.tension));return a.set(Lu.calc(h),Bu.calc(h),Hu.calc(h)),a},Iu.prototype.copy=function(e){Pu.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Iu.prototype.toJSON=function(){var e=Pu.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Iu.prototype.fromJSON=function(e){Pu.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new jt).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},zu.prototype=Object.create(Pu.prototype),zu.prototype.constructor=zu,zu.prototype.isCubicBezierCurve=!0,zu.prototype.getPoint=function(e,t){var i=t||new Ct,r=this.v0,n=this.v1,o=this.v2,a=this.v3;return i.set(Vu(e,r.x,n.x,o.x,a.x),Vu(e,r.y,n.y,o.y,a.y)),i},zu.prototype.copy=function(e){return Pu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},zu.prototype.toJSON=function(){var e=Pu.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},zu.prototype.fromJSON=function(e){return Pu.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},qu.prototype=Object.create(Pu.prototype),qu.prototype.constructor=qu,qu.prototype.isCubicBezierCurve3=!0,qu.prototype.getPoint=function(e,t){var i=t||new jt,r=this.v0,n=this.v1,o=this.v2,a=this.v3;return i.set(Vu(e,r.x,n.x,o.x,a.x),Vu(e,r.y,n.y,o.y,a.y),Vu(e,r.z,n.z,o.z,a.z)),i},qu.prototype.copy=function(e){return Pu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},qu.prototype.toJSON=function(){var e=Pu.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},qu.prototype.fromJSON=function(e){return Pu.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Wu.prototype=Object.create(Pu.prototype),Wu.prototype.constructor=Wu,Wu.prototype.isLineCurve=!0,Wu.prototype.getPoint=function(e,t){var i=t||new Ct;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},Wu.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Wu.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Wu.prototype.copy=function(e){return Pu.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Wu.prototype.toJSON=function(){var e=Pu.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Wu.prototype.fromJSON=function(e){return Pu.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Gu.prototype=Object.create(Pu.prototype),Gu.prototype.constructor=Gu,Gu.prototype.isLineCurve3=!0,Gu.prototype.getPoint=function(e,t){var i=t||new jt;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},Gu.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Gu.prototype.copy=function(e){return Pu.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Gu.prototype.toJSON=function(){var e=Pu.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Gu.prototype.fromJSON=function(e){return Pu.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Xu.prototype=Object.create(Pu.prototype),Xu.prototype.constructor=Xu,Xu.prototype.isQuadraticBezierCurve=!0,Xu.prototype.getPoint=function(e,t){var i=t||new Ct,r=this.v0,n=this.v1,o=this.v2;return i.set(Uu(e,r.x,n.x,o.x),Uu(e,r.y,n.y,o.y)),i},Xu.prototype.copy=function(e){return Pu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Xu.prototype.toJSON=function(){var e=Pu.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Xu.prototype.fromJSON=function(e){return Pu.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Yu.prototype=Object.create(Pu.prototype),Yu.prototype.constructor=Yu,Yu.prototype.isQuadraticBezierCurve3=!0,Yu.prototype.getPoint=function(e,t){var i=t||new jt,r=this.v0,n=this.v1,o=this.v2;return i.set(Uu(e,r.x,n.x,o.x),Uu(e,r.y,n.y,o.y),Uu(e,r.z,n.z,o.z)),i},Yu.prototype.copy=function(e){return Pu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Yu.prototype.toJSON=function(){var e=Pu.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Yu.prototype.fromJSON=function(e){return Pu.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ju.prototype=Object.create(Pu.prototype),Ju.prototype.constructor=Ju,Ju.prototype.isSplineCurve=!0,Ju.prototype.getPoint=function(e,t){var i=t||new Ct,r=this.points,n=(r.length-1)*e,o=Math.floor(n),a=n-o,s=r[0===o?o:o-1],l=r[o],u=r[o>r.length-2?r.length-1:o+1],c=r[o>r.length-3?r.length-1:o+2];return i.set(Nu(a,s.x,l.x,u.x,c.x),Nu(a,s.y,l.y,u.y,c.y)),i},Ju.prototype.copy=function(e){Pu.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this},Ju.prototype.toJSON=function(){var e=Pu.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e},Ju.prototype.fromJSON=function(e){Pu.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new Ct).fromArray(r))}return this};var Qu=Object.freeze({__proto__:null,ArcCurve:Fu,CatmullRomCurve3:Iu,CubicBezierCurve:zu,CubicBezierCurve3:qu,EllipseCurve:ju,LineCurve:Wu,LineCurve3:Gu,QuadraticBezierCurve:Xu,QuadraticBezierCurve3:Yu,SplineCurve:Ju});function Zu(){Pu.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Ku(e){Zu.call(this),this.type="Path",this.currentPoint=new Ct,e&&this.setFromPoints(e)}function $u(e){Ku.call(this,e),this.uuid=Mt.generateUUID(),this.type="Shape",this.holes=[]}function ec(e,t){di.call(this),this.type="Light",this.color=new nr(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function tc(e,t,i){ec.call(this,e,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(di.DefaultUp),this.updateMatrix(),this.groundColor=new nr(t)}function ic(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Ct(512,512),this.map=null,this.mapPass=null,this.matrix=new Jt,this._frustum=new xn,this._frameExtents=new Ct(1,1),this._viewportCount=1,this._viewports=[new It(0,0,1,1)]}function rc(){ic.call(this,new dn(50,1,.5,500))}function nc(e,t,i,r,n,o){ec.call(this,e,t),this.type="SpotLight",this.position.copy(di.DefaultUp),this.updateMatrix(),this.target=new di,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==o?o:1,this.shadow=new rc}function oc(){ic.call(this,new dn(90,1,.5,500)),this._frameExtents=new Ct(4,2),this._viewportCount=6,this._viewports=[new It(2,1,1,1),new It(0,1,1,1),new It(3,1,1,1),new It(1,1,1,1),new It(3,0,1,1),new It(1,0,1,1)],this._cubeDirections=[new jt(1,0,0),new jt(-1,0,0),new jt(0,0,1),new jt(0,0,-1),new jt(0,1,0),new jt(0,-1,0)],this._cubeUps=[new jt(0,1,0),new jt(0,1,0),new jt(0,1,0),new jt(0,1,0),new jt(0,0,1),new jt(0,0,-1)]}function ac(e,t,i,r){ec.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==r?r:1,this.shadow=new oc}function sc(e,t,i,r,n,o){pn.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==i?i:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function lc(){ic.call(this,new sc(-5,5,5,-5,.5,500))}function uc(e,t){ec.call(this,e,t),this.type="DirectionalLight",this.position.copy(di.DefaultUp),this.updateMatrix(),this.target=new di,this.shadow=new lc}function cc(e,t){ec.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function hc(e,t,i,r){ec.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==r?r:10}function pc(e){Eu.call(this,e),this.textures={}}Zu.prototype=Object.assign(Object.create(Pu.prototype),{constructor:Zu,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Wu(t,e))},getPoint:function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=t){var n=i[r]-t,o=this.curves[r],a=o.getLength(),s=0===a?0:1-n/a;return o.getPointAt(s)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,i=[],r=0,n=this.curves;r<n.length;r++)for(var o=n[r],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),l=0;l<s.length;l++){var u=s[l];t&&t.equals(u)||(i.push(u),t=u)}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},copy:function(e){Pu.prototype.copy.call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Pu.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){Pu.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push((new Qu[r.type]).fromJSON(r))}return this}}),Ku.prototype=Object.assign(Object.create(Zu.prototype),{constructor:Ku,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var i=new Wu(this.currentPoint.clone(),new Ct(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,i,r){var n=new Xu(this.currentPoint.clone(),new Ct(e,t),new Ct(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this},bezierCurveTo:function(e,t,i,r,n,o){var a=new zu(this.currentPoint.clone(),new Ct(e,t),new Ct(i,r),new Ct(n,o));return this.curves.push(a),this.currentPoint.set(n,o),this},splineThru:function(e){var t=new Ju([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,i,r,n,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,i,r,n,o),this},absarc:function(e,t,i,r,n,o){return this.absellipse(e,t,i,i,r,n,o),this},ellipse:function(e,t,i,r,n,o,a,s){var l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,i,r,n,o,a,s),this},absellipse:function(e,t,i,r,n,o,a,s){var l=new ju(e,t,i,r,n,o,a,s);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(e){return Zu.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Zu.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Zu.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),$u.prototype=Object.assign(Object.create(Ku.prototype),{constructor:$u,getPointsHoles:function(e){for(var t=[],i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Ku.prototype.copy.call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=Ku.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){Ku.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push((new Ku).fromJSON(r))}return this}}),ec.prototype=Object.assign(Object.create(di.prototype),{constructor:ec,isLight:!0,copy:function(e){return di.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=di.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),tc.prototype=Object.assign(Object.create(ec.prototype),{constructor:tc,isHemisphereLight:!0,copy:function(e){return ec.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(ic.prototype,{_projScreenMatrix:new Jt,_lightPositionWorld:new jt,_lookTarget:new jt,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,i=this.matrix,r=this._projScreenMatrix,n=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),n.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(n),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromMatrix(r),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),rc.prototype=Object.assign(Object.create(ic.prototype),{constructor:rc,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,i=2*Mt.RAD2DEG*e.angle,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;i===t.fov&&r===t.aspect&&n===t.far||(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),ic.prototype.updateMatrices.call(this,e)}}),nc.prototype=Object.assign(Object.create(ec.prototype),{constructor:nc,isSpotLight:!0,copy:function(e){return ec.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),oc.prototype=Object.assign(Object.create(ic.prototype),{constructor:oc,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);var i=this.camera,r=this.matrix,n=this._lightPositionWorld,o=this._lookTarget,a=this._projScreenMatrix;n.setFromMatrixPosition(e.matrixWorld),i.position.copy(n),o.copy(i.position),o.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(o),i.updateMatrixWorld(),r.makeTranslation(-n.x,-n.y,-n.z),a.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromMatrix(a)}}),ac.prototype=Object.assign(Object.create(ec.prototype),{constructor:ac,isPointLight:!0,copy:function(e){return ec.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),sc.prototype=Object.assign(Object.create(pn.prototype),{constructor:sc,isOrthographicCamera:!0,copy:function(e,t){return pn.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,r,n,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,o=i+e,a=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(n+=c*(this.view.offsetX/l))+c*(this.view.width/l),s=(a-=h*(this.view.offsetY/u))-h*(this.view.height/u)}this.projectionMatrix.makeOrthographic(n,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=di.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),lc.prototype=Object.assign(Object.create(ic.prototype),{constructor:lc,isDirectionalLightShadow:!0,updateMatrices:function(e){ic.prototype.updateMatrices.call(this,e)}}),uc.prototype=Object.assign(Object.create(ec.prototype),{constructor:uc,isDirectionalLight:!0,copy:function(e){return ec.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),cc.prototype=Object.assign(Object.create(ec.prototype),{constructor:cc,isAmbientLight:!0}),hc.prototype=Object.assign(Object.create(ec.prototype),{constructor:hc,isRectAreaLight:!0,copy:function(e){return ec.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=ec.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),pc.prototype=Object.assign(Object.create(Eu.prototype),{constructor:pc,load:function(e,t,i,r){var n=this,o=new Tu(n.manager);o.setPath(n.path),o.load(e,(function(e){t(n.parse(JSON.parse(e)))}),i,r)},parse:function(e){var t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=new ru[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=(new nr).setHex(e.sheen)),void 0!==e.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.vertexColors&&(r.vertexColors=e.vertexColors),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(r.morphNormals=e.morphNormals),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.uniforms)for(var n in e.uniforms){var o=e.uniforms[n];switch(r.uniforms[n]={},o.type){case"t":r.uniforms[n].value=i(o.value);break;case"c":r.uniforms[n].value=(new nr).setHex(o.value);break;case"v2":r.uniforms[n].value=(new Ct).fromArray(o.value);break;case"v3":r.uniforms[n].value=(new jt).fromArray(o.value);break;case"v4":r.uniforms[n].value=(new It).fromArray(o.value);break;case"m3":r.uniforms[n].value=(new kt).fromArray(o.value);case"m4":r.uniforms[n].value=(new Jt).fromArray(o.value);break;default:r.uniforms[n].value=o.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var a in e.extensions)r.extensions[a]=e.extensions[a];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=i(e.map)),void 0!==e.matcap&&(r.matcap=i(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=i(e.alphaMap),r.transparent=!0),void 0!==e.bumpMap&&(r.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),r.normalScale=(new Ct).fromArray(s)}return void 0!==e.displacementMap&&(r.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=i(e.specularMap)),void 0!==e.envMap&&(r.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Ct).fromArray(e.clearcoatNormalScale)),r},setTextures:function(e){return this.textures=e,this}});var dc={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function fc(){Pr.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function mc(e,t,i,r){"number"==typeof i&&(r=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),pr.call(this,e,t,i),this.meshPerAttribute=r||1}function gc(e){Eu.call(this,e)}fc.prototype=Object.assign(Object.create(Pr.prototype),{constructor:fc,isInstancedBufferGeometry:!0,copy:function(e){return Pr.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=Pr.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),mc.prototype=Object.assign(Object.create(pr.prototype),{constructor:mc,isInstancedBufferAttribute:!0,copy:function(e){return pr.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=pr.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),gc.prototype=Object.assign(Object.create(Eu.prototype),{constructor:gc,load:function(e,t,i,r){var n=this,o=new Tu(n.manager);o.setPath(n.path),o.load(e,(function(e){t(n.parse(JSON.parse(e)))}),i,r)},parse:function(e){var t=e.isInstancedBufferGeometry?new fc:new Pr,i=e.data.index;if(void 0!==i){var r=new vc[i.type](i.array);t.setIndex(new pr(r,1))}var n=e.data.attributes;for(var o in n){var a=n[o],s=(r=new vc[a.type](a.array),new(a.isInstancedBufferAttribute?mc:pr)(r,a.itemSize,a.normalized));void 0!==a.name&&(s.name=a.name),t.setAttribute(o,s)}var l=e.data.morphAttributes;if(l)for(var o in l){for(var u=l[o],c=[],h=0,p=u.length;h<p;h++){a=u[h],s=new pr(r=new vc[a.type](a.array),a.itemSize,a.normalized);void 0!==a.name&&(s.name=a.name),c.push(s)}t.morphAttributes[o]=c}e.data.morphTargetsRelative&&(t.morphTargetsRelative=!0);var d=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==d){h=0;for(var f=d.length;h!==f;++h){var m=d[h];t.addGroup(m.start,m.count,m.materialIndex)}}var g=e.data.boundingSphere;if(void 0!==g){var v=new jt;void 0!==g.center&&v.fromArray(g.center),t.boundingSphere=new Pi(v,g.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var vc={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function yc(e){Eu.call(this,e)}yc.prototype=Object.assign(Object.create(Eu.prototype),{constructor:yc,load:function(e,t,i,r){var n=this,o=""===this.path?dc.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;var a=new Tu(n.manager);a.setPath(this.path),a.load(e,(function(i){var o=null;try{o=JSON.parse(i)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?n.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)}),i,r)},parse:function(e,t){var i=this.parseShape(e.shapes),r=this.parseGeometries(e.geometries,i),n=this.parseImages(e.images,(function(){void 0!==t&&t(s)})),o=this.parseTextures(e.textures,n),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,r,a);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var i=0,r=e.length;i<r;i++){var n=(new $u).fromJSON(e[i]);t[n.uuid]=n}return t},parseGeometries:function(e,t){var i={};if(void 0!==e)for(var r=new gc,n=0,o=e.length;n<o;n++){var a,s=e[n];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Gl[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Gl[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Gl[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Gl[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Gl[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Gl[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Gl[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Gl[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Gl[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Gl[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new Gl[s.type]((new Qu[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Gl[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Gl[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],u=0,c=s.shapes.length;u<c;u++){var h=t[s.shapes[u]];l.push(h)}a=new Gl[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],u=0,c=s.shapes.length;u<c;u++){h=t[s.shapes[u]];l.push(h)}var p=s.options.extrudePath;void 0!==p&&(s.options.extrudePath=(new Qu[p.type]).fromJSON(p)),a=new Gl[s.type](l,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)a=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry;else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),i[s.uuid]=a}return i},parseMaterials:function(e,t){var i={},r={};if(void 0!==e){var n=new pc;n.setTextures(t);for(var o=0,a=e.length;o<a;o++){var s=e[o];if("MultiMaterial"===s.type){for(var l=[],u=0;u<s.materials.length;u++){var c=s.materials[u];void 0===i[c.uuid]&&(i[c.uuid]=n.parse(c)),l.push(i[c.uuid])}r[s.uuid]=l}else void 0===i[s.uuid]&&(i[s.uuid]=n.parse(s)),r[s.uuid]=i[s.uuid]}}return r},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i],n=vu.parse(r);void 0!==r.uuid&&(n.uuid=r.uuid),t.push(n)}return t},parseImages:function(e,t){var i=this,r={};function n(e){return i.manager.itemStart(e),a.load(e,(function(){i.manager.itemEnd(e)}),void 0,(function(){i.manager.itemError(e),i.manager.itemEnd(e)}))}if(void 0!==e&&e.length>0){var o=new _u(t),a=new THREE.ImageLoader(o);a.setCrossOrigin(this.crossOrigin);for(var s=0,l=e.length;s<l;s++){var u=e[s],c=u.url;if(Array.isArray(c)){r[u.uuid]=[];for(var h=0,p=c.length;h<p;h++){var d=c[h],f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:i.resourcePath+d;r[u.uuid].push(n(f))}}else{f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u.url)?u.url:i.resourcePath+u.url;r[u.uuid]=n(f)}}}return r},parseTextures:function(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var n=0,o=e.length;n<o;n++){var a,s=e[n];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(a=Array.isArray(t[s.image])?new Nn(t[s.image]):new Ht(t[s.image])).needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=i(s.mapping,_c)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=i(s.wrap[0],xc),a.wrapT=i(s.wrap[1],xc)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=i(s.minFilter,Ec)),void 0!==s.magFilter&&(a.magFilter=i(s.magFilter,Ec)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),r[s.uuid]=a}return r},parseObject:function(e,t,i){var r;function n(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function o(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,n=e.length;r<n;r++){var o=e[r];void 0===i[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(i[o])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}switch(e.type){case"Scene":r=new fi,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new nr(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new Oa(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new Fa(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new dn(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new sc(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new cc(e.color,e.intensity);break;case"DirectionalLight":r=new uc(e.color,e.intensity);break;case"PointLight":r=new ac(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new hc(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new nc(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new tc(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=n(e.geometry),s=o(e.material);r=a.bones&&a.bones.length>0?new ts(a,s):new Jr(a,s);break;case"InstancedMesh":a=n(e.geometry),s=o(e.material);var l=e.count,u=e.instanceMatrix;(r=new hs(a,s,l)).instanceMatrix=new pr(new Float32Array(u.array),16);break;case"LOD":r=new es;break;case"Line":r=new ys(n(e.geometry),o(e.material),e.mode);break;case"LineLoop":r=new Es(n(e.geometry),o(e.material));break;case"LineSegments":r=new xs(n(e.geometry),o(e.material));break;case"PointCloud":case"Points":r=new Cs(n(e.geometry),o(e.material));break;case"Sprite":r=new Qa(o(e.material));break;case"Group":r=new wa;break;default:r=new di}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.drawMode&&r.setDrawMode(e.drawMode),void 0!==e.children)for(var c=e.children,h=0;h<c.length;h++)r.add(this.parseObject(c[h],t,i));if("LOD"===e.type){void 0!==e.autoUpdate&&(r.autoUpdate=e.autoUpdate);for(var p=e.levels,d=0;d<p.length;d++){var f=p[d],m=r.getObjectByProperty("uuid",f.object);void 0!==m&&r.addLevel(m,f.distance)}}return r}});var bc,_c={UVMapping:300,CubeReflectionMapping:K,CubeRefractionMapping:$,EquirectangularReflectionMapping:ee,EquirectangularRefractionMapping:te,SphericalReflectionMapping:ie,CubeUVReflectionMapping:re,CubeUVRefractionMapping:ne},xc={RepeatWrapping:oe,ClampToEdgeWrapping:ae,MirroredRepeatWrapping:se},Ec={NearestFilter:le,NearestMipmapNearestFilter:ue,NearestMipmapLinearFilter:ce,LinearFilter:he,LinearMipmapNearestFilter:pe,LinearMipmapLinearFilter:de};function wc(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Eu.call(this,e),this.options=void 0}function Tc(){this.type="ShapePath",this.color=new nr,this.subPaths=[],this.currentPath=null}function Sc(e){this.type="Font",this.data=e}function Ac(e,t,i,r,n){var o=n.glyphs[e]||n.glyphs["?"];if(o){var a,s,l,u,c,h,p,d,f=new Tc;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),g=0,v=m.length;g<v;){switch(m[g++]){case"m":a=m[g++]*t+i,s=m[g++]*t+r,f.moveTo(a,s);break;case"l":a=m[g++]*t+i,s=m[g++]*t+r,f.lineTo(a,s);break;case"q":l=m[g++]*t+i,u=m[g++]*t+r,c=m[g++]*t+i,h=m[g++]*t+r,f.quadraticCurveTo(c,h,l,u);break;case"b":l=m[g++]*t+i,u=m[g++]*t+r,c=m[g++]*t+i,h=m[g++]*t+r,p=m[g++]*t+i,d=m[g++]*t+r,f.bezierCurveTo(c,h,p,d,l,u)}}return{offsetX:o.ha*t,path:f}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+n.familyName+".")}function Mc(e){Eu.call(this,e)}wc.prototype=Object.assign(Object.create(Eu.prototype),{constructor:wc,setOptions:function(e){return this.options=e,this},load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=bu.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout((function(){t&&t(o),n.manager.itemEnd(e)}),0),o;fetch(e).then((function(e){return e.blob()})).then((function(e){return void 0===n.options?createImageBitmap(e):createImageBitmap(e,n.options)})).then((function(i){bu.add(e,i),t&&t(i),n.manager.itemEnd(e)})).catch((function(t){r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)})),n.manager.itemStart(e)}}),Object.assign(Tc.prototype,{moveTo:function(e,t){return this.currentPath=new Ku,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,i,r){return this.currentPath.quadraticCurveTo(e,t,i,r),this},bezierCurveTo:function(e,t,i,r,n,o){return this.currentPath.bezierCurveTo(e,t,i,r,n,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function i(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i],o=new $u;o.curves=n.curves,t.push(o)}return t}function r(e,t){for(var i=t.length,r=!1,n=i-1,o=0;o<i;n=o++){var a=t[n],s=t[o],l=s.x-a.x,u=s.y-a.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(a=t[o],l=-l,s=t[n],u=-u),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var c=u*(e.x-a.x)-l*(e.y-a.y);if(0===c)return!0;if(c<0)continue;r=!r}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return r}var n=xl.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return i(o);var a,s,l,u=[];if(1===o.length)return s=o[0],(l=new $u).curves=s.curves,u.push(l),u;var c=!n(o[0].getPoints());c=e?!c:c;var h,p,d=[],f=[],m=[],g=0;f[g]=void 0,m[g]=[];for(var v=0,y=o.length;v<y;v++)a=n(h=(s=o[v]).getPoints()),(a=e?!a:a)?(!c&&f[g]&&g++,f[g]={s:new $u,p:h},f[g].s.curves=s.curves,c&&g++,m[g]=[]):m[g].push({h:s,p:h[0]});if(!f[0])return i(o);if(f.length>1){for(var b=!1,_=[],x=0,E=f.length;x<E;x++)d[x]=[];for(x=0,E=f.length;x<E;x++)for(var w=m[x],T=0;T<w.length;T++){for(var S=w[T],A=!0,M=0;M<f.length;M++)r(S.p,f[M].p)&&(x!==M&&_.push({froms:x,tos:M,hole:T}),A?(A=!1,d[M].push(S)):b=!0);A&&d[x].push(S)}_.length>0&&(b||(m=d))}v=0;for(var C=f.length;v<C;v++){l=f[v].s,u.push(l);for(var R=0,D=(p=m[v]).length;R<D;R++)l.holes.push(p[R].h)}return u}}),Object.assign(Sc.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var i=[],r=function(e,t,i){for(var r=Array.from?Array.from(e):String(e).split(""),n=t/i.resolution,o=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*n,a=[],s=0,l=0,u=0;u<r.length;u++){var c=r[u];if("\n"===c)s=0,l-=o;else{var h=Ac(c,n,s,l,i);s+=h.offsetX,a.push(h.path)}}return a}(e,t,this.data),n=0,o=r.length;n<o;n++)Array.prototype.push.apply(i,r[n].toShapes());return i}}),Mc.prototype=Object.assign(Object.create(Eu.prototype),{constructor:Mc,load:function(e,t,i,r){var n=this,o=new Tu(this.manager);o.setPath(this.path),o.load(e,(function(e){var i;try{i=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}var r=n.parse(i);t&&t(r)}),i,r)},parse:function(e){return new Sc(e)}});var Cc={getContext:function(){return void 0===bc&&(bc=new(window.AudioContext||window.webkitAudioContext)),bc},setContext:function(e){bc=e}};function Rc(e){Eu.call(this,e)}function Dc(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new jt)}function Pc(e,t){ec.call(this,void 0,t),this.sh=void 0!==e?e:new Dc}function jc(e,t,i){Pc.call(this,void 0,i);var r=(new nr).set(e),n=(new nr).set(t),o=new jt(r.r,r.g,r.b),a=new jt(n.r,n.g,n.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}function Fc(e,t){Pc.call(this,void 0,t);var i=(new nr).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}Rc.prototype=Object.assign(Object.create(Eu.prototype),{constructor:Rc,load:function(e,t,i,r){var n=new Tu(this.manager);n.setResponseType("arraybuffer"),n.setPath(this.path),n.load(e,(function(e){var i=e.slice(0);Cc.getContext().decodeAudioData(i,(function(e){t(e)}))}),i,r)}}),Object.assign(Dc.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var i=e.x,r=e.y,n=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScale(o[1],.488603*r),t.addScale(o[2],.488603*n),t.addScale(o[3],.488603*i),t.addScale(o[4],i*r*1.092548),t.addScale(o[5],r*n*1.092548),t.addScale(o[6],.315392*(3*n*n-1)),t.addScale(o[7],i*n*1.092548),t.addScale(o[8],.546274*(i*i-r*r)),t},getIrradianceAt:function(e,t){var i=e.x,r=e.y,n=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScale(o[1],1.023328*r),t.addScale(o[2],1.023328*n),t.addScale(o[3],1.023328*i),t.addScale(o[4],.858086*i*r),t.addScale(o[5],.858086*r*n),t.addScale(o[6],.743125*n*n-.247708),t.addScale(o[7],.858086*i*n),t.addScale(o[8],.429043*(i*i-r*r)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e,t){void 0===t&&(t=0);for(var i=this.coefficients,r=0;r<9;r++)i[r].fromArray(e,t+3*r);return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var i=this.coefficients,r=0;r<9;r++)i[r].toArray(e,t+3*r);return e}}),Object.assign(Dc,{getBasisAt:function(e,t){var i=e.x,r=e.y,n=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*n,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*n,t[6]=.315392*(3*n*n-1),t[7]=1.092548*i*n,t[8]=.546274*(i*i-r*r)}}),Pc.prototype=Object.assign(Object.create(ec.prototype),{constructor:Pc,isLightProbe:!0,copy:function(e){return ec.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return ec.prototype.toJSON.call(this,e)}}),jc.prototype=Object.assign(Object.create(Pc.prototype),{constructor:jc,isHemisphereLightProbe:!0,copy:function(e){return Pc.prototype.copy.call(this,e),this},toJSON:function(e){return Pc.prototype.toJSON.call(this,e)}}),Fc.prototype=Object.assign(Object.create(Pc.prototype),{constructor:Fc,isAmbientLightProbe:!0,copy:function(e){return Pc.prototype.copy.call(this,e),this},toJSON:function(e){return Pc.prototype.toJSON.call(this,e)}});var Oc=new Jt,kc=new Jt;function Lc(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new dn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new dn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Bc(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(Lc.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var i,r,n=e.projectionMatrix.clone(),o=t.eyeSep/2,a=o*t.near/t.focus,s=t.near*Math.tan(Mt.DEG2RAD*t.fov*.5)/t.zoom;kc.elements[12]=-o,Oc.elements[12]=o,i=-s*t.aspect+a,r=s*t.aspect+a,n.elements[0]=2*t.near/(r-i),n.elements[8]=(r+i)/(r-i),this.cameraL.projectionMatrix.copy(n),i=-s*t.aspect-a,r=s*t.aspect-a,n.elements[0]=2*t.near/(r-i),n.elements[8]=(r+i)/(r-i),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(kc),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Oc)}}),Object.assign(Bc.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var Hc=new jt,Ic=new Rt,Nc=new jt,Uc=new jt;function Vc(){di.call(this),this.type="AudioListener",this.context=Cc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Bc}function zc(e){di.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}Vc.prototype=Object.assign(Object.create(di.prototype),{constructor:Vc,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){di.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Hc,Ic,Nc),Uc.set(0,0,-1).applyQuaternion(Ic),t.positionX){var r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Hc.x,r),t.positionY.linearRampToValueAtTime(Hc.y,r),t.positionZ.linearRampToValueAtTime(Hc.z,r),t.forwardX.linearRampToValueAtTime(Uc.x,r),t.forwardY.linearRampToValueAtTime(Uc.y,r),t.forwardZ.linearRampToValueAtTime(Uc.z,r),t.upX.linearRampToValueAtTime(i.x,r),t.upY.linearRampToValueAtTime(i.y,r),t.upZ.linearRampToValueAtTime(i.z,r)}else t.setPosition(Hc.x,Hc.y,Hc.z),t.setOrientation(Uc.x,Uc.y,Uc.z,i.x,i.y,i.z)}}),zc.prototype=Object.assign(Object.create(di.prototype),{constructor:zc,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(void 0===e&&(e=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var qc=new jt,Wc=new Rt,Gc=new jt,Xc=new jt;function Yc(e){zc.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Jc(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function Qc(e,t,i){this.binding=e,this.valueSize=i;var r,n=Float64Array;switch(t){case"quaternion":r=this._slerp;break;case"string":case"bool":n=Array,r=this._select;break;default:r=this._lerp}this.buffer=new n(4*i),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Yc.prototype=Object.assign(Object.create(zc.prototype),{constructor:Yc,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this},updateMatrixWorld:function(e){if(di.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(qc,Wc,Gc),Xc.set(0,0,1).applyQuaternion(Wc);var t=this.panner;if(t.positionX){var i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(qc.x,i),t.positionY.linearRampToValueAtTime(qc.y,i),t.positionZ.linearRampToValueAtTime(qc.z,i),t.orientationX.linearRampToValueAtTime(Xc.x,i),t.orientationY.linearRampToValueAtTime(Xc.y,i),t.orientationZ.linearRampToValueAtTime(Xc.z,i)}else t.setPosition(qc.x,qc.y,qc.z),t.setOrientation(Xc.x,Xc.y,Xc.z)}}}),Object.assign(Jc.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),i=0;i<t.length;i++)e+=t[i];return e/t.length}}),Object.assign(Qc.prototype,{accumulate:function(e,t){var i=this.buffer,r=this.valueSize,n=e*r+r,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==r;++a)i[n+a]=i[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(i,n,0,s,r)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,n<1){var a=3*t;this._mixBufferRegion(i,r,a,1-n,t)}for(var s=t,l=t+t;s!==l;++s)if(i[s]!==i[s+t]){o.setValue(i,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,i=this.valueSize,r=3*i;e.getValue(t,r);for(var n=i,o=r;n!==o;++n)t[n]=t[r+n%i];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,i,r,n){if(r>=.5)for(var o=0;o!==n;++o)e[t+o]=e[i+o]},_slerp:function(e,t,i,r){Rt.slerpFlat(e,t,e,t,e,i,r)},_lerp:function(e,t,i,r,n){for(var o=1-r,a=0;a!==n;++a){var s=t+a;e[s]=e[s]*o+e[i+a]*r}}});var Zc=new RegExp("[\\[\\]\\.:\\/]","g"),Kc="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",$c=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),eh=/(WCOD+)?/.source.replace("WCOD",Kc),th=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),ih=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),rh=new RegExp("^"+$c+eh+th+ih+"$"),nh=["material","materials","bones"];function oh(e,t,i){var r=i||ah.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function ah(e,t,i){this.path=t,this.parsedPath=i||ah.parseTrackName(t),this.node=ah.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function sh(){this.uuid=Mt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function lh(e,t,i){this._mixer=e,this._clip=t,this._localRoot=i||null;for(var r=t.tracks,n=r.length,o=new Array(n),a={endingStart:ot,endingEnd:ot},s=0;s!==n;++s){var l=r[s].createInterpolant(null);o[s]=l,l.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=nt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function uh(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function ch(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function hh(e,t,i){ka.call(this,e,t),this.meshPerAttribute=i||1}function ph(e,t,i,r){this.ray=new Ii(e,t),this.near=i||0,this.far=r||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function dh(e,t){return e.distance-t.distance}function fh(e,t,i,r){if(!1!==e.visible&&(e.raycast(t,i),!0===r))for(var n=e.children,o=0,a=n.length;o<a;o++)fh(n[o],t,i,!0)}function mh(e,t,i){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==i?i:0,this}function gh(e,t,i){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==i?i:0,this}Object.assign(oh.prototype,{getValue:function(e,t){this.bind();var i=this._targetGroup.nCachedObjects_,r=this._bindings[i];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var i=this._bindings,r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}),Object.assign(ah,{Composite:oh,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new ah.Composite(e,t,i):new ah(e,t,i)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Zc,"")},parseTrackName:function(e){var t=rh.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var n=i.nodeName.substring(r+1);-1!==nh.indexOf(n)&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i},findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){var r=function(e){for(var i=0;i<e.length;i++){var n=e[i];if(n.name===t||n.uuid===t)return n;var o=r(n.children);if(o)return o}return null},n=r(e.children);if(n)return n}return null}}),Object.assign(ah.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)e[t++]=i[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(e=ah.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(i){var o=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===o){o=a;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var s=e[r];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(e.geometry.morphAttributes.position[a].name===n){n=a;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(e.geometry.morphTargets[a].name===n){n=a;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}else{var c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(ah.prototype,{_getValue_unbound:ah.prototype.getValue,_setValue_unbound:ah.prototype.setValue}),Object.assign(sh.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,l=void 0,u=0,c=arguments.length;u!==c;++u){var h=arguments[u],p=h.uuid,d=r[p];if(void 0===d){d=t++,r[p]=d,e.push(h);for(var f=0,m=s;f!==m;++f)a[f].push(new ah(h,n[f],o[f]))}else if(d<i){l=e[d];var g=--i,v=e[g];r[v.uuid]=d,e[d]=v,r[p]=g,e[g]=h;for(f=0,m=s;f!==m;++f){var y=a[f],b=y[g],_=y[d];y[d]=b,void 0===_&&(_=new ah(h,n[f],o[f])),y[g]=_}}else e[d]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=i},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,i=this._indicesByUUID,r=this._bindings,n=r.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,u=i[l];if(void 0!==u&&u>=t){var c=t++,h=e[c];i[h.uuid]=u,e[u]=h,i[l]=c,e[c]=s;for(var p=0,d=n;p!==d;++p){var f=r[p],m=f[c],g=f[u];f[u]=m,f[c]=g}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,o=n.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a],u=l.uuid,c=r[u];if(void 0!==c)if(delete r[u],c<i){var h=--i,p=e[h],d=e[y=--t];r[p.uuid]=c,e[c]=p,r[d.uuid]=h,e[h]=d,e.pop();for(var f=0,m=o;f!==m;++f){var g=(b=n[f])[h],v=b[y];b[c]=g,b[h]=v,b.pop()}}else{var y;r[(d=e[y=--t]).uuid]=c,e[c]=d,e.pop();for(f=0,m=o;f!==m;++f){var b;(b=n[f])[c]=b[y],b.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,r=i[e],n=this._bindings;if(void 0!==r)return n[r];var o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,u=this.nCachedObjects_,c=new Array(l);r=n.length,i[e]=r,o.push(e),a.push(t),n.push(c);for(var h=u,p=s.length;h!==p;++h){var d=s[h];c[h]=new ah(d,e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){var r=this._paths,n=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=i,o[i]=s,o.pop(),n[i]=n[a],n.pop(),r[i]=r[a],r.pop()}}}),Object.assign(lh.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){var r=this._clip.duration,n=e._clip.duration,o=n/r,a=r/n;e.warp(1,o,t),this.warp(a,1,t)}return this},crossFadeTo:function(e,t,i){return e.crossFadeFrom(this,t,i)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,i){var r=this._mixer,n=r.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=n,s[1]=n+i,l[0]=e/a,l[1]=t/a,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,i,r){if(this.enabled){var n=this._startTime;if(null!==n){var o=(e-n)*i;if(o<0||0===i)return;this._startTime=null,t=i*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var l=this._interpolants,u=this._propertyBindings,c=0,h=l.length;c!==h;++c)l[c].evaluate(a),u[c].accumulate(r,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(null!==i){var r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i)t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,i=this._clip.duration,r=this.loop,n=this._loopCount,o=2202===r;if(0===e)return-1===n?t:o&&1==(1&n)?i-t:t;if(2200===r){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=i)t=i;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=i||t<0){var a=Math.floor(t/i);t-=i*a,n+=Math.abs(a);var s=this.repetitions-n;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?i:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=n,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=t;if(o&&1==(1&n))return i-t}return t},_setEndings:function(e,t,i){var r=this._interpolantSettings;i?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=e?this.zeroSlopeAtStart?2401:ot:2402,r.endingEnd=t?this.zeroSlopeAtEnd?2401:ot:2402)},_scheduleFading:function(e,t,i){var r=this._mixer,n=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=n,s[0]=t,a[1]=n+e,s[1]=i,this}}),uh.prototype=Object.assign(Object.create(Tt.prototype),{constructor:uh,_bindAction:function(e,t){var i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,o=e._propertyBindings,a=e._interpolants,s=i.uuid,l=this._bindingsByRootAndName,u=l[s];void 0===u&&(u={},l[s]=u);for(var c=0;c!==n;++c){var h=r[c],p=h.name,d=u[p];if(void 0!==d)o[c]=d;else{if(void 0!==(d=o[c])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,p));continue}var f=t&&t._propertyBindings[c].binding.parsedPath;++(d=new Qc(ah.create(i,p,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(d,s,p),o[c]=d}a[c].resultBuffer=d.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,t)}for(var n=e._propertyBindings,o=0,a=n.length;o!==a;++o){var s=n[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){var r=this._actions,n=this._actionsByClip,o=n[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;var n=e._clip.uuid,o=this._actionsByClip,a=o[n],s=a.knownActions,l=s[s.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[n],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_addInactiveBinding:function(e,t,i){var r=this._bindingsByRootAndName,n=r[t],o=this._bindings;void 0===n&&(n={},r[t]=n),n[i]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,o=this._bindingsByRootAndName,a=o[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[n],0===Object.keys(a).length&&delete o[r]},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&((i=new su(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var i=t||this._root,r=i.uuid,n="string"==typeof e?vu.findByName(i,e):e,o=null!==n?n.uuid:e,a=this._actionsByClip[o],s=null;if(void 0!==a){var l=a.actionByRoot[r];if(void 0!==l)return l;s=a.knownActions[0],null===n&&(n=s._clip)}if(null===n)return null;var u=new lh(this,n,t);return this._bindAction(u,s),this._addInactiveAction(u,o,r),u},existingAction:function(e,t){var i=t||this._root,r=i.uuid,n="string"==typeof e?vu.findByName(i,e):e,o=n?n.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,i=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var n=0;n!==t;++n)e[n].reset();for(n=0;n!==r;++n)i[n].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),o=this._accuIndex^=1,a=0;a!==i;++a){t[a]._update(r,e,n,o)}var s=this._bindings,l=this._nActiveBindings;for(a=0;a!==l;++a)s[a].apply(o);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(void 0!==n){for(var o=n.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var u=l._cacheIndex,c=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,t[u]=c,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}},uncacheRoot:function(e){var t=e.uuid,i=this._actionsByClip;for(var r in i){var n=i[r].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}),ch.prototype.clone=function(){return new ch(void 0===this.value.clone?this.value:this.value.clone())},hh.prototype=Object.assign(Object.create(ka.prototype),{constructor:hh,isInstancedInterleavedBuffer:!0,copy:function(e){return ka.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(ph.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,i){var r=i||[];return fh(e,this,r,t),r.sort(dh),r},intersectObjects:function(e,t,i){var r=i||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var n=0,o=e.length;n<o;n++)fh(e[n],this,r,t);return r.sort(dh),r}}),Object.assign(mh.prototype,{set:function(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Mt.clamp(t/this.radius,-1,1))),this}}),Object.assign(gh.prototype,{set:function(e,t,i){return this.radius=e,this.theta=t,this.y=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}});var vh=new Ct;function yh(e,t){this.min=void 0!==e?e:new Ct(1/0,1/0),this.max=void 0!==t?t:new Ct(-1/0,-1/0)}Object.assign(yh.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var i=vh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Ct),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Ct),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Ct),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Ct),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return vh.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var bh=new jt,_h=new jt;function xh(e,t){this.start=void 0!==e?e:new jt,this.end=void 0!==t?t:new jt}function Eh(e){di.call(this),this.material=e,this.render=function(){}}Object.assign(xh.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new jt),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new jt),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new jt),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){bh.subVectors(e,this.start),_h.subVectors(this.end,this.start);var i=_h.dot(_h),r=_h.dot(bh)/i;return t&&(r=Mt.clamp(r,0,1)),r},closestPointToPoint:function(e,t,i){var r=this.closestPointToPointParameter(e,t);return void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new jt),this.delta(i).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Eh.prototype=Object.create(di.prototype),Eh.prototype.constructor=Eh,Eh.prototype.isImmediateRenderObject=!0;var wh=new jt,Th=new jt,Sh=new kt,Ah=["a","b","c"];function Mh(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==i?i:16711680,o=void 0!==r?r:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var l=new Pr,u=new _r(2*a*3,3);l.setAttribute("position",u),xs.call(this,l,new ps({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}Mh.prototype=Object.create(xs.prototype),Mh.prototype.constructor=Mh,Mh.prototype.update=function(){this.object.updateMatrixWorld(!0),Sh.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,t=this.geometry.attributes.position,i=this.object.geometry;if(i&&i.isGeometry)for(var r=i.vertices,n=i.faces,o=0,a=0,s=n.length;a<s;a++)for(var l=n[a],u=0,c=l.vertexNormals.length;u<c;u++){var h=r[l[Ah[u]]],p=l.vertexNormals[u];wh.copy(h).applyMatrix4(e),Th.copy(p).applyMatrix3(Sh).normalize().multiplyScalar(this.size).add(wh),t.setXYZ(o,wh.x,wh.y,wh.z),o+=1,t.setXYZ(o,Th.x,Th.y,Th.z),o+=1}else if(i&&i.isBufferGeometry){var d=i.attributes.position,f=i.attributes.normal;for(o=0,u=0,c=d.count;u<c;u++)wh.set(d.getX(u),d.getY(u),d.getZ(u)).applyMatrix4(e),Th.set(f.getX(u),f.getY(u),f.getZ(u)),Th.applyMatrix3(Sh).normalize().multiplyScalar(this.size).add(wh),t.setXYZ(o,wh.x,wh.y,wh.z),o+=1,t.setXYZ(o,Th.x,Th.y,Th.z),o+=1}t.needsUpdate=!0};var Ch=new jt;function Rh(e,t){di.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var i=new Pr,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],n=0,o=1;n<32;n++,o++){var a=n/32*Math.PI*2,s=o/32*Math.PI*2;r.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}i.setAttribute("position",new _r(r,3));var l=new ps({fog:!1});this.cone=new xs(i,l),this.add(this.cone),this.update()}Rh.prototype=Object.create(di.prototype),Rh.prototype.constructor=Rh,Rh.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Rh.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Ch.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Ch),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var Dh=new jt,Ph=new Jt,jh=new Jt;function Fh(e){for(var t=function e(t){var i=[];t&&t.isBone&&i.push(t);for(var r=0;r<t.children.length;r++)i.push.apply(i,e(t.children[r]));return i}(e),i=new Pr,r=[],n=[],o=new nr(0,0,1),a=new nr(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),n.push(o.r,o.g,o.b),n.push(a.r,a.g,a.b))}i.setAttribute("position",new _r(r,3)),i.setAttribute("color",new _r(n,3));var u=new ps({vertexColors:p,depthTest:!1,depthWrite:!1,transparent:!0});xs.call(this,i,u),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function Oh(e,t,i){this.light=e,this.light.updateMatrixWorld(),this.color=i;var r=new Pl(t,4,2),n=new hr({wireframe:!0,fog:!1});Jr.call(this,r,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function kh(e,t){this.type="RectAreaLightHelper",this.light=e,this.color=t;var i=new Pr;i.setAttribute("position",new _r([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere();var r=new ps({fog:!1});ys.call(this,i,r);var n=new Pr;n.setAttribute("position",new _r([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),n.computeBoundingSphere(),this.add(new Jr(n,new hr({side:l,fog:!1}))),this.update()}Fh.prototype=Object.create(xs.prototype),Fh.prototype.constructor=Fh,Fh.prototype.updateMatrixWorld=function(e){var t=this.bones,i=this.geometry,r=i.getAttribute("position");jh.getInverse(this.root.matrixWorld);for(var n=0,o=0;n<t.length;n++){var a=t[n];a.parent&&a.parent.isBone&&(Ph.multiplyMatrices(jh,a.matrixWorld),Dh.setFromMatrixPosition(Ph),r.setXYZ(o,Dh.x,Dh.y,Dh.z),Ph.multiplyMatrices(jh,a.parent.matrixWorld),Dh.setFromMatrixPosition(Ph),r.setXYZ(o+1,Dh.x,Dh.y,Dh.z),o+=2)}i.getAttribute("position").needsUpdate=!0,di.prototype.updateMatrixWorld.call(this,e)},Oh.prototype=Object.create(Jr.prototype),Oh.prototype.constructor=Oh,Oh.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Oh.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},kh.prototype=Object.create(ys.prototype),kh.prototype.constructor=kh,kh.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},kh.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()};var Lh=new jt,Bh=new nr,Hh=new nr;function Ih(e,t,i){di.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;var r=new Vs(t);r.rotateY(.5*Math.PI),this.material=new hr({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=p);var n=r.getAttribute("position"),o=new Float32Array(3*n.count);r.setAttribute("color",new pr(o,3)),this.add(new Jr(r,this.material)),this.update()}function Nh(e,t){this.lightProbe=e,this.size=t;var i={GAMMA_OUTPUT:""},r=new hn({defines:i,uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","vec3 linearToOutput( in vec3 a ) {","\t#ifdef GAMMA_OUTPUT","\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );","\t#else","\t\treturn a;","\t#endif","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\toutgoingLight = linearToOutput( outgoingLight );","\tgl_FragColor = vec4( outgoingLight, 1.0 );","}"].join("\n")}),n=new Pl(1,32,16);Jr.call(this,n,r),this.onBeforeRender()}function Uh(e,t,i,r){e=e||10,t=t||10,i=new nr(void 0!==i?i:4473924),r=new nr(void 0!==r?r:8947848);for(var n=t/2,o=e/t,a=e/2,s=[],l=[],u=0,c=0,h=-a;u<=t;u++,h+=o){s.push(-a,0,h,a,0,h),s.push(h,0,-a,h,0,a);var d=u===n?i:r;d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3}var f=new Pr;f.setAttribute("position",new _r(s,3)),f.setAttribute("color",new _r(l,3));var m=new ps({vertexColors:p});xs.call(this,f,m)}function Vh(e,t,i,r,n,o){e=e||10,t=t||16,i=i||8,r=r||64,n=new nr(void 0!==n?n:4473924),o=new nr(void 0!==o?o:8947848);var a,s,l,u,c,h,d,f=[],m=[];for(u=0;u<=t;u++)l=u/t*(2*Math.PI),a=Math.sin(l)*e,s=Math.cos(l)*e,f.push(0,0,0),f.push(a,0,s),d=1&u?n:o,m.push(d.r,d.g,d.b),m.push(d.r,d.g,d.b);for(u=0;u<=i;u++)for(d=1&u?n:o,h=e-e/i*u,c=0;c<r;c++)l=c/r*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,f.push(a,0,s),m.push(d.r,d.g,d.b),l=(c+1)/r*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,f.push(a,0,s),m.push(d.r,d.g,d.b);var g=new Pr;g.setAttribute("position",new _r(f,3)),g.setAttribute("color",new _r(m,3));var v=new ps({vertexColors:p});xs.call(this,g,v)}function zh(e,t,i,r){this.audio=e,this.range=t||1,this.divisionsInnerAngle=i||16,this.divisionsOuterAngle=r||2;var n=new Pr,o=this.divisionsInnerAngle+2*this.divisionsOuterAngle,a=new Float32Array(3*(3*o+3));n.setAttribute("position",new pr(a,3));var s=new ps({color:65280}),l=new ps({color:16776960});ys.call(this,n,[l,s]),this.update()}Ih.prototype=Object.create(di.prototype),Ih.prototype.constructor=Ih,Ih.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Ih.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");Bh.copy(this.light.color),Hh.copy(this.light.groundColor);for(var i=0,r=t.count;i<r;i++){var n=i<r/2?Bh:Hh;t.setXYZ(i,n.r,n.g,n.b)}t.needsUpdate=!0}e.lookAt(Lh.setFromMatrixPosition(this.light.matrixWorld).negate())},Nh.prototype=Object.create(Jr.prototype),Nh.prototype.constructor=Nh,Nh.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Nh.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},Uh.prototype=Object.assign(Object.create(xs.prototype),{constructor:Uh,copy:function(e){return xs.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),Vh.prototype=Object.create(xs.prototype),Vh.prototype.constructor=Vh,zh.prototype=Object.create(ys.prototype),zh.prototype.constructor=zh,zh.prototype.update=function(){var e,t,i=this.audio,r=this.range,n=this.divisionsInnerAngle,o=this.divisionsOuterAngle,a=Mt.degToRad(i.panner.coneInnerAngle),s=Mt.degToRad(i.panner.coneOuterAngle),l=a/2,u=s/2,c=0,h=0,p=this.geometry,d=p.attributes.position;function f(i,n,o,a){var s=(n-i)/o;for(d.setXYZ(c,0,0,0),h++,e=i;e<n;e+=s)t=c+h,d.setXYZ(t,Math.sin(e)*r,0,Math.cos(e)*r),d.setXYZ(t+1,Math.sin(Math.min(e+s,n))*r,0,Math.cos(Math.min(e+s,n))*r),d.setXYZ(t+2,0,0,0),h+=3;p.addGroup(c,h,a),c+=h,h=0}p.clearGroups(),f(-u,-l,o,0),f(-l,l,n,1),f(l,u,o,0),d.needsUpdate=!0,a===s&&(this.material[0].visible=!1)},zh.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()};var qh=new jt,Wh=new jt,Gh=new kt;function Xh(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==i?i:16776960,o=void 0!==r?r:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new Pr,u=new _r(2*a*3,3);l.setAttribute("position",u),xs.call(this,l,new ps({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}Xh.prototype=Object.create(xs.prototype),Xh.prototype.constructor=Xh,Xh.prototype.update=function(){this.object.updateMatrixWorld(!0),Gh.getNormalMatrix(this.object.matrixWorld);for(var e=this.object.matrixWorld,t=this.geometry.attributes.position,i=this.object.geometry,r=i.vertices,n=i.faces,o=0,a=0,s=n.length;a<s;a++){var l=n[a],u=l.normal;qh.copy(r[l.a]).add(r[l.b]).add(r[l.c]).divideScalar(3).applyMatrix4(e),Wh.copy(u).applyMatrix3(Gh).normalize().multiplyScalar(this.size).add(qh),t.setXYZ(o,qh.x,qh.y,qh.z),o+=1,t.setXYZ(o,Wh.x,Wh.y,Wh.z),o+=1}t.needsUpdate=!0};var Yh=new jt,Jh=new jt,Qh=new jt;function Zh(e,t,i){di.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1);var r=new Pr;r.setAttribute("position",new _r([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var n=new ps({fog:!1});this.lightPlane=new ys(r,n),this.add(this.lightPlane),(r=new Pr).setAttribute("position",new _r([0,0,0,0,0,1],3)),this.targetLine=new ys(r,n),this.add(this.targetLine),this.update()}Zh.prototype=Object.create(di.prototype),Zh.prototype.constructor=Zh,Zh.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Zh.prototype.update=function(){Yh.setFromMatrixPosition(this.light.matrixWorld),Jh.setFromMatrixPosition(this.light.target.matrixWorld),Qh.subVectors(Jh,Yh),this.lightPlane.lookAt(Jh),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Jh),this.targetLine.scale.z=Qh.length()};var Kh=new jt,$h=new pn;function ep(e){var t=new Pr,i=new ps({color:16777215,vertexColors:h}),r=[],n=[],o={},a=new nr(16755200),s=new nr(16711680),l=new nr(43775),u=new nr(16777215),c=new nr(3355443);function p(e,t,i){d(e,i),d(t,i)}function d(e,t){r.push(0,0,0),n.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}p("n1","n2",a),p("n2","n4",a),p("n4","n3",a),p("n3","n1",a),p("f1","f2",a),p("f2","f4",a),p("f4","f3",a),p("f3","f1",a),p("n1","f1",a),p("n2","f2",a),p("n3","f3",a),p("n4","f4",a),p("p","n1",s),p("p","n2",s),p("p","n3",s),p("p","n4",s),p("u1","u2",l),p("u2","u3",l),p("u3","u1",l),p("c","t",u),p("p","c",c),p("cn1","cn2",c),p("cn3","cn4",c),p("cf1","cf2",c),p("cf3","cf4",c),t.setAttribute("position",new _r(r,3)),t.setAttribute("color",new _r(n,3)),xs.call(this,t,i),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function tp(e,t,i,r,n,o,a){Kh.set(n,o,a).unproject(r);var s=t[e];if(void 0!==s)for(var l=i.getAttribute("position"),u=0,c=s.length;u<c;u++)l.setXYZ(s[u],Kh.x,Kh.y,Kh.z)}ep.prototype=Object.create(xs.prototype),ep.prototype.constructor=ep,ep.prototype.update=function(){var e=this.geometry,t=this.pointMap;$h.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),tp("c",t,e,$h,0,0,-1),tp("t",t,e,$h,0,0,1),tp("n1",t,e,$h,-1,-1,-1),tp("n2",t,e,$h,1,-1,-1),tp("n3",t,e,$h,-1,1,-1),tp("n4",t,e,$h,1,1,-1),tp("f1",t,e,$h,-1,-1,1),tp("f2",t,e,$h,1,-1,1),tp("f3",t,e,$h,-1,1,1),tp("f4",t,e,$h,1,1,1),tp("u1",t,e,$h,.7,1.1,-1),tp("u2",t,e,$h,-.7,1.1,-1),tp("u3",t,e,$h,0,2,-1),tp("cf1",t,e,$h,-1,0,1),tp("cf2",t,e,$h,1,0,1),tp("cf3",t,e,$h,0,-1,1),tp("cf4",t,e,$h,0,1,1),tp("cn1",t,e,$h,-1,0,-1),tp("cn2",t,e,$h,1,0,-1),tp("cn3",t,e,$h,0,-1,-1),tp("cn4",t,e,$h,0,1,-1),e.getAttribute("position").needsUpdate=!0};var ip=new Ci;function rp(e,t){this.object=e,void 0===t&&(t=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),n=new Pr;n.setIndex(new pr(i,1)),n.setAttribute("position",new pr(r,3)),xs.call(this,n,new ps({color:t})),this.matrixAutoUpdate=!1,this.update()}function np(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Pr;r.setIndex(new pr(i,1)),r.setAttribute("position",new _r([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),xs.call(this,r,new ps({color:t})),this.geometry.computeBoundingSphere()}function op(e,t,i){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var r=void 0!==i?i:16776960,n=new Pr;n.setAttribute("position",new _r([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),n.computeBoundingSphere(),ys.call(this,n,new ps({color:r}));var o=new Pr;o.setAttribute("position",new _r([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Jr(o,new hr({color:r,opacity:.2,transparent:!0,depthWrite:!1})))}rp.prototype=Object.create(xs.prototype),rp.prototype.constructor=rp,rp.prototype.update=function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&ip.setFromObject(this.object),!ip.isEmpty()){var t=ip.min,i=ip.max,r=this.geometry.attributes.position,n=r.array;n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=t.x,n[4]=i.y,n[5]=i.z,n[6]=t.x,n[7]=t.y,n[8]=i.z,n[9]=i.x,n[10]=t.y,n[11]=i.z,n[12]=i.x,n[13]=i.y,n[14]=t.z,n[15]=t.x,n[16]=i.y,n[17]=t.z,n[18]=t.x,n[19]=t.y,n[20]=t.z,n[21]=i.x,n[22]=t.y,n[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}},rp.prototype.setFromObject=function(e){return this.object=e,this.update(),this},rp.prototype.copy=function(e){return xs.prototype.copy.call(this,e),this.object=e.object,this},rp.prototype.clone=function(){return(new this.constructor).copy(this)},np.prototype=Object.create(xs.prototype),np.prototype.constructor=np,np.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),di.prototype.updateMatrixWorld.call(this,e))},op.prototype=Object.create(ys.prototype),op.prototype.constructor=op,op.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?l:s,this.lookAt(this.plane.normal),di.prototype.updateMatrixWorld.call(this,e)};var ap,sp,lp=new jt;function up(e,t,i,r,n,o){di.call(this),void 0===e&&(e=new jt(0,0,1)),void 0===t&&(t=new jt(0,0,0)),void 0===i&&(i=1),void 0===r&&(r=16776960),void 0===n&&(n=.2*i),void 0===o&&(o=.2*n),void 0===ap&&((ap=new Pr).setAttribute("position",new _r([0,0,0,0,1,0],3)),(sp=new Ul(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new ys(ap,new ps({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Jr(sp,new hr({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,n,o)}function cp(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new Pr;i.setAttribute("position",new _r(t,3)),i.setAttribute("color",new _r([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var r=new ps({vertexColors:p});xs.call(this,i,r)}up.prototype=Object.create(di.prototype),up.prototype.constructor=up,up.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{lp.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(lp,t)}},up.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},up.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},up.prototype.copy=function(e){return di.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},up.prototype.clone=function(){return(new this.constructor).copy(this)},cp.prototype=Object.create(xs.prototype),cp.prototype.constructor=cp;function hp(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Iu.call(this,e),this.type="catmullrom",this.closed=!0}function pp(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Iu.call(this,e),this.type="catmullrom"}function dp(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Iu.call(this,e),this.type="catmullrom"}Pu.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Pu.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Zu.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new rn,i=0,r=e.length;i<r;i++){var n=e[i];t.vertices.push(new jt(n.x,n.y,n.z||0))}return t}}),Object.assign(Ku.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),hp.prototype=Object.create(Iu.prototype),pp.prototype=Object.create(Iu.prototype),dp.prototype=Object.create(Iu.prototype),Object.assign(dp.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Uh.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Fh.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Eu.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),dc.extractUrlBase(e)}}),Eu.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(yc.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(yh.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Ci.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),xh.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Mt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Mt.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Mt.ceilPowerOfTwo(e)}}),Object.assign(kt.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Jt.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new jt).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,i,r,n,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,i,n,o)}}),zi.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Rt.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Ii.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(er.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(er,{barycoordFromPoint:function(e,t,i,r,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),er.getBarycoord(e,t,i,r,n)},normal:function(e,t,i,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),er.getNormal(e,t,i,r)}}),Object.assign($u.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Tl(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ll(this,e)}}),Object.assign(Ct.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(jt.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(It.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(rn.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(di.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(di.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(es.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(os.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),ts.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Pu.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),dn.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(ec.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(pr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Object.assign(pr.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:wt),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Pr.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new pr(arguments[1],arguments[2])))},addDrawCall:function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)}}),Object.defineProperties(Pr.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(ka.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),35048===this.usage},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(ka.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:wt),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Sl.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(ch.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(cr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new nr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Zl.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(hn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(ja.prototype,{clearTarget:function(e,t,i,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(ja.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}}}),Object.defineProperties(va.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(vn.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(Nt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Ra.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),Object.defineProperties(zc.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new Rc).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Jc.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},gn.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var fp={merge:function(e,t,i){var r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,i)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};Lt.crossOrigin=void 0,Lt.loadTexture=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new Du;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,i,void 0,r);return t&&(o.mapping=t),o},Lt.loadTextureCube=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new Ru;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,i,void 0,r);return t&&(o.mapping=t),o},Lt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Lt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var mp={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"111"}})),e.ACESFilmicToneMapping=Z,e.AddEquation=b,e.AddOperation=W,e.AdditiveBlending=m,e.AlphaFormat=Ae,e.AlwaysDepth=L,e.AlwaysStencilFunc=Et,e.AmbientLight=cc,e.AmbientLightProbe=Fc,e.AnimationClip=vu,e.AnimationLoader=Su,e.AnimationMixer=uh,e.AnimationObjectGroup=sh,e.AnimationUtils=nu,e.ArcCurve=Fu,e.ArrayCamera=Ta,e.ArrowHelper=up,e.Audio=zc,e.AudioAnalyser=Jc,e.AudioContext=Cc,e.AudioListener=Vc,e.AudioLoader=Rc,e.AxesHelper=cp,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new cp(e)},e.BackSide=l,e.BasicDepthPacking=vt,e.BasicShadowMap=0,e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Mu(e)},e.Bone=as,e.BooleanKeyframeTrack=cu,e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new rp(e,t)},e.Box2=yh,e.Box3=Ci,e.Box3Helper=np,e.BoxBufferGeometry=on,e.BoxGeometry=nn,e.BoxHelper=rp,e.BufferAttribute=pr,e.BufferGeometry=Pr,e.BufferGeometryLoader=gc,e.ByteType=me,e.Cache=bu,e.Camera=pn,e.CameraHelper=ep,e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.CanvasTexture=js,e.CatmullRomCurve3=Iu,e.CineonToneMapping=Q,e.CircleBufferGeometry=Wl,e.CircleGeometry=ql,e.ClampToEdgeWrapping=ae,e.Clock=Bc,e.ClosedSplineCurve3=hp,e.Color=nr,e.ColorKeyframeTrack=hu,e.CompressedTexture=Ps,e.CompressedTextureLoader=Au,e.ConeBufferGeometry=zl,e.ConeGeometry=Vl,e.CubeCamera=gn,e.CubeGeometry=nn,e.CubeReflectionMapping=K,e.CubeRefractionMapping=$,e.CubeTexture=Nn,e.CubeTextureLoader=Ru,e.CubeUVReflectionMapping=re,e.CubeUVRefractionMapping=ne,e.CubicBezierCurve=zu,e.CubicBezierCurve3=qu,e.CubicInterpolant=au,e.CullFaceBack=i,e.CullFaceFront=r,e.CullFaceFrontBack=3,e.CullFaceNone=t,e.Curve=Pu,e.CurvePath=Zu,e.CustomBlending=y,e.CylinderBufferGeometry=Ul,e.CylinderGeometry=Nl,e.Cylindrical=gh,e.DataTexture=yn,e.DataTexture2DArray=Un,e.DataTexture3D=Vn,e.DataTextureLoader=Mu,e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=xu,e.DepthFormat=je,e.DepthStencilFormat=Fe,e.DepthTexture=Fs,e.DirectionalLight=uc,e.DirectionalLightHelper=Zh,e.DirectionalLightShadow=lc,e.DiscreteInterpolant=lu,e.DodecahedronBufferGeometry=Gs,e.DodecahedronGeometry=Ws,e.DoubleSide=u,e.DstAlphaFactor=D,e.DstColorFactor=j,e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new pr(e,t).setDynamic(!0)},e.DynamicCopyUsage=35050,e.DynamicDrawUsage=35048,e.DynamicReadUsage=35049,e.EdgesGeometry=Il,e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new xs(new Il(e.geometry),new ps({color:void 0!==t?t:16777215}))},e.EllipseCurve=ju,e.EqualDepth=I,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=ee,e.EquirectangularRefractionMapping=te,e.Euler=Kt,e.EventDispatcher=Tt,e.ExtrudeBufferGeometry=Sl,e.ExtrudeGeometry=Tl,e.Face3=lr,e.Face4=function(e,t,i,r,n,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new lr(e,t,i,n,o,a)},e.FaceColors=h,e.FaceNormalsHelper=Xh,e.FileLoader=Tu,e.FlatShading=1,e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new _r(e,t)},e.Float32BufferAttribute=_r,e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new xr(e,t)},e.Float64BufferAttribute=xr,e.FloatType=_e,e.Fog=Oa,e.FogExp2=Fa,e.Font=Sc,e.FontLoader=Mc,e.FrontFaceDirectionCCW=1,e.FrontFaceDirectionCW=0,e.FrontSide=s,e.Frustum=xn,e.GammaEncoding=ht,e.Geometry=rn,e.GeometryUtils=fp,e.GreaterDepth=U,e.GreaterEqualDepth=N,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=Uh,e.Group=wa,e.HalfFloatType=xe,e.HemisphereLight=tc,e.HemisphereLightHelper=Ih,e.HemisphereLightProbe=jc,e.IcosahedronBufferGeometry=qs,e.IcosahedronGeometry=zs,e.ImageBitmapLoader=wc,e.ImageLoader=Cu,e.ImageUtils=Lt,e.ImmediateRenderObject=Eh,e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=mc,e.InstancedBufferGeometry=fc,e.InstancedInterleavedBuffer=hh,e.InstancedMesh=hs,e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new gr(e,t)},e.Int16BufferAttribute=gr,e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new yr(e,t)},e.Int32BufferAttribute=yr,e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new dr(e,t)},e.Int8BufferAttribute=dr,e.IntType=ye,e.InterleavedBuffer=ka,e.InterleavedBufferAttribute=La,e.Interpolant=ou,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.KeepStencilOp=xt,e.KeyframeTrack=uu,e.LOD=es,e.LatheBufferGeometry=kl,e.LatheGeometry=Ol,e.Layers=$t,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},e.LessDepth=B,e.LessEqualDepth=H,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=ec,e.LightProbe=Pc,e.LightProbeHelper=Nh,e.LightShadow=ic,e.Line=ys,e.Line3=xh,e.LineBasicMaterial=ps,e.LineCurve=Wu,e.LineCurve3=Gu,e.LineDashedMaterial=iu,e.LineLoop=Es,e.LinePieces=1,e.LineSegments=xs,e.LineStrip=0,e.LinearEncoding=ut,e.LinearFilter=he,e.LinearInterpolant=su,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=de,e.LinearMipmapNearestFilter=pe,e.LinearToneMapping=X,e.Loader=Eu,e.LoaderUtils=dc,e.LoadingManager=_u,e.LogLuvEncoding=dt,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=nt,e.LuminanceAlphaFormat=De,e.LuminanceFormat=Re,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.Material=cr,e.MaterialLoader=pc,e.Math=Mt,e.Matrix3=kt,e.Matrix4=Jt,e.MaxEquation=w,e.Mesh=Jr,e.MeshBasicMaterial=hr,e.MeshDepthMaterial=da,e.MeshDistanceMaterial=fa,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MeshLambertMaterial=eu,e.MeshMatcapMaterial=tu,e.MeshNormalMaterial=$l,e.MeshPhongMaterial=Zl,e.MeshPhysicalMaterial=Ql,e.MeshStandardMaterial=Jl,e.MeshToonMaterial=Kl,e.MinEquation=E,e.MirroredRepeatWrapping=se,e.MixOperation=q,e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.MultiplyBlending=v,e.MultiplyOperation=z,e.NearestFilter=le,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=ce,e.NearestMipmapNearestFilter=ue,e.NeverDepth=k,e.NeverStencilFunc=512,e.NoBlending=d,e.NoColors=c,e.NoToneMapping=G,e.NormalBlending=f,e.NotEqualDepth=V,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=pu,e.Object3D=di,e.ObjectLoader=yc,e.ObjectSpaceNormalMap=_t,e.OctahedronBufferGeometry=Vs,e.OctahedronGeometry=Us,e.OneFactor=S,e.OneMinusDstAlphaFactor=P,e.OneMinusDstColorFactor=F,e.OneMinusSrcAlphaFactor=R,e.OneMinusSrcColorFactor=M,e.OrthographicCamera=sc,e.PCFShadowMap=n,e.PCFSoftShadowMap=o,e.ParametricBufferGeometry=Ls,e.ParametricGeometry=ks,e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Qa(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new ws(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Cs(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new ws(e)},e.Path=Ku,e.PerspectiveCamera=dn,e.Plane=zi,e.PlaneBufferGeometry=Cn,e.PlaneGeometry=Mn,e.PlaneHelper=op,e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Cs(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new ws(e)},e.PointLight=ac,e.PointLightHelper=Oh,e.Points=Cs,e.PointsMaterial=ws,e.PolarGridHelper=Vh,e.PolyhedronBufferGeometry=Hs,e.PolyhedronGeometry=Bs,e.PositionalAudio=Yc,e.PositionalAudioHelper=zh,e.PropertyBinding=ah,e.PropertyMixer=Qc,e.QuadraticBezierCurve=Xu,e.QuadraticBezierCurve3=Yu,e.Quaternion=Rt,e.QuaternionKeyframeTrack=fu,e.QuaternionLinearInterpolant=du,e.REVISION="111",e.RGBADepthPacking=yt,e.RGBAFormat=Ce,e.RGBA_ASTC_10x10_Format=tt,e.RGBA_ASTC_10x5_Format=Ke,e.RGBA_ASTC_10x6_Format=$e,e.RGBA_ASTC_10x8_Format=et,e.RGBA_ASTC_12x10_Format=it,e.RGBA_ASTC_12x12_Format=rt,e.RGBA_ASTC_4x4_Format=qe,e.RGBA_ASTC_5x4_Format=We,e.RGBA_ASTC_5x5_Format=Ge,e.RGBA_ASTC_6x5_Format=Xe,e.RGBA_ASTC_6x6_Format=Ye,e.RGBA_ASTC_8x5_Format=Je,e.RGBA_ASTC_8x6_Format=Qe,e.RGBA_ASTC_8x8_Format=Ze,e.RGBA_PVRTC_2BPPV1_Format=Ve,e.RGBA_PVRTC_4BPPV1_Format=Ue,e.RGBA_S3TC_DXT1_Format=Le,e.RGBA_S3TC_DXT3_Format=Be,e.RGBA_S3TC_DXT5_Format=He,e.RGBDEncoding=gt,e.RGBEEncoding=pt,e.RGBEFormat=Pe,e.RGBFormat=Me,e.RGBM16Encoding=mt,e.RGBM7Encoding=ft,e.RGB_ETC1_Format=ze,e.RGB_PVRTC_2BPPV1_Format=Ne,e.RGB_PVRTC_4BPPV1_Format=Ie,e.RGB_S3TC_DXT1_Format=ke,e.RawShaderMaterial=Yl,e.Ray=Ii,e.Raycaster=ph,e.RectAreaLight=hc,e.RectAreaLightHelper=kh,e.RedFormat=Oe,e.ReinhardToneMapping=Y,e.RepeatWrapping=oe,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=x,e.RingBufferGeometry=Fl,e.RingGeometry=jl,e.Scene=fi,e.SceneUtils=mp,e.ShaderChunk=En,e.ShaderLib=Tn,e.ShaderMaterial=hn,e.ShadowMaterial=Xl,e.Shape=$u,e.ShapeBufferGeometry=Bl,e.ShapeGeometry=Ll,e.ShapePath=Tc,e.ShapeUtils=xl,e.ShortType=ge,e.Skeleton=os,e.SkeletonHelper=Fh,e.SkinnedMesh=ts,e.SmoothShading=2,e.Sphere=Pi,e.SphereBufferGeometry=Pl,e.SphereGeometry=Dl,e.Spherical=mh,e.SphericalHarmonics3=Dc,e.SphericalReflectionMapping=ie,e.Spline=dp,e.SplineCurve=Ju,e.SplineCurve3=pp,e.SpotLight=nc,e.SpotLightHelper=Rh,e.SpotLightShadow=rc,e.Sprite=Qa,e.SpriteMaterial=Ba,e.SrcAlphaFactor=C,e.SrcAlphaSaturateFactor=O,e.SrcColorFactor=A,e.StaticCopyUsage=35046,e.StaticDrawUsage=wt,e.StaticReadUsage=35045,e.StereoCamera=Lc,e.StreamCopyUsage=35042,e.StreamDrawUsage=35040,e.StreamReadUsage=35041,e.StringKeyframeTrack=mu,e.SubtractEquation=_,e.SubtractiveBlending=g,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TangentSpaceNormalMap=bt,e.TetrahedronBufferGeometry=Ns,e.TetrahedronGeometry=Is,e.TextBufferGeometry=Rl,e.TextGeometry=Cl,e.Texture=Ht,e.TextureLoader=Du,e.TorusBufferGeometry=Ks,e.TorusGeometry=Zs,e.TorusKnotBufferGeometry=Qs,e.TorusKnotGeometry=Js,e.Triangle=er,e.TriangleFanDrawMode=lt,e.TriangleStripDrawMode=st,e.TrianglesDrawMode=at,e.TubeBufferGeometry=Ys,e.TubeGeometry=Xs,e.UVMapping=300,e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new vr(e,t)},e.Uint16BufferAttribute=vr,e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new br(e,t)},e.Uint32BufferAttribute=br,e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new fr(e,t)},e.Uint8BufferAttribute=fr,e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new mr(e,t)},e.Uint8ClampedBufferAttribute=mr,e.Uncharted2ToneMapping=J,e.Uniform=ch,e.UniformsLib=wn,e.UniformsUtils=ln,e.UnsignedByteType=fe,e.UnsignedInt248Type=Se,e.UnsignedIntType=be,e.UnsignedShort4444Type=Ee,e.UnsignedShort5551Type=we,e.UnsignedShort565Type=Te,e.UnsignedShortType=ve,e.VSMShadowMap=a,e.Vector2=Ct,e.Vector3=jt,e.Vector4=It,e.VectorKeyframeTrack=gu,e.Vertex=function(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new jt(e,t,i)},e.VertexColors=p,e.VertexNormalsHelper=Mh,e.VideoTexture=Ds,e.WebGLMultisampleRenderTarget=Ut,e.WebGLRenderTarget=Nt,e.WebGLRenderTargetCube=vn,e.WebGLRenderer=ja,e.WebGLUtils=_a,e.WireframeGeometry=Os,e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new xs(new Os(e.geometry),new ps({color:void 0!==t?t:16777215}))},e.WrapAroundEnding=2402,e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Tu(e)},e.ZeroCurvatureEnding=ot,e.ZeroFactor=T,e.ZeroSlopeEnding=2401,e.ZeroStencilOp=0,e.sRGBEncoding=ct,Object.defineProperty(e,"__esModule",{value:!0})})),THREE.CombinedCamera=function(e,t,i,r,n,o,a){THREE.Camera.call(this),this.fov=i,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,a),this.cameraP=new THREE.PerspectiveCamera(i,e/t,r,n),this.zoom=1,this.view=null,this.matrixTween=null,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.updateProjectionMatrix(),this.projectionMatrix.copy(this.cameraP.projectionMatrix),this.projectionMatrixInverse.copy(this.cameraP.projectionMatrixInverse),this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){this.fov;var e=this.cameraP.aspect,t=(this.cameraP.near,this.cameraP.far,this.orthoSize.z),i=this.orthoSize.depth,r=i*t*e/2,n=i*t/2;n/=this.zoom,r/=this.zoom,this.cameraO.left=-r,this.cameraO.right=r,this.cameraO.top=n,this.cameraO.bottom=-n,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix.copy(this.cameraO.projectionMatrix),this.projectionMatrixInverse.copy(this.cameraO.projectionMatrixInverse),this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?(this.cameraP.fov=this.fov,this.toPerspective()):this.toOrthographic()},THREE.CombinedCamera.prototype.setViewOffset=function(e,t,i,r,n,o){this.cameraP.setViewOffset(e,t,i,r,n,o),this.cameraO.setViewOffset(e,t,i,r,n,o)},THREE.CombinedCamera.prototype.clearViewOffset=function(){this.cameraP.clearViewOffset(),this.cameraO.clearViewOffset()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t,i,r){void 0===t&&(t=24);var n=0;if(i){var o=parseInt("42EF",16);n=parseInt(r||"nahoanehc")&o}else n=2*THREE.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(n),n},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CSS3DObject=function(e){THREE.Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",(function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)}))},THREE.CSS3DObject.prototype=Object.create(THREE.Object3D.prototype),THREE.CSS3DObject.prototype.constructor=THREE.CSS3DObject,THREE.CSS3DSprite=function(e){THREE.CSS3DObject.call(this,e)},THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype),THREE.CSS3DSprite.prototype.constructor=THREE.CSS3DSprite,THREE.CSS3DRenderer=function(e){var t,i,r,n,o=(e=e||{}).autoFixCamera,a=new THREE.Matrix4,s=new THREE.Matrix4,l=new THREE.Matrix4,u={camera:{fov:0,style:""},objects:{}},c=document.createElement("div");c.style.overflow="hidden",this.domElement=c;var h=document.createElement("div");h.style.WebkitTransformStyle="preserve-3d",h.style.MozTransformStyle="preserve-3d",h.style.transformStyle="preserve-3d",c.appendChild(h);var p=/Trident/i.test(navigator.userAgent);function d(e){return Math.abs(e)<1e-10?0:e}function f(e){var t=e.elements;return"matrix3d("+d(t[0])+","+d(-t[1])+","+d(t[2])+","+d(t[3])+","+d(t[4])+","+d(-t[5])+","+d(t[6])+","+d(t[7])+","+d(t[8])+","+d(-t[9])+","+d(t[10])+","+d(t[11])+","+d(t[12])+","+d(-t[13])+","+d(t[14])+","+d(t[15])+")"}function m(e,t){var i=e.elements,o="matrix3d("+d(i[0])+","+d(i[1])+","+d(i[2])+","+d(i[3])+","+d(-i[4])+","+d(-i[5])+","+d(-i[6])+","+d(-i[7])+","+d(i[8])+","+d(i[9])+","+d(i[10])+","+d(i[11])+","+d(i[12])+","+d(i[13])+","+d(i[14])+","+d(i[15])+")";return p?"translate(-50%,-50%)translate("+r+"px,"+n+"px)"+t+o:"translate(-50%,-50%)"+o}function g(e,t){s.copy(e),s.premultiply(t.matrixWorldInverse);var i=(e=s).elements,o="matrix3d("+d(i[0])+","+d(i[1])+","+d(i[2])+","+d(i[3])+","+d(-i[4])+","+d(-i[5])+","+d(-i[6])+","+d(-i[7])+","+d(i[8])+","+d(i[9])+","+d(i[10])+","+d(i[11])+","+d(i[12])+","+d(i[13])+","+d(i[14])+","+d(i[15])+")";return p?"translate(-50%,-50%)translate("+r+"px,"+n+"px)"+cameraCSSMatrix+o:"translate(-50%,-50%)"+o}this.setClearColor=function(){},this.getSize=function(){return{width:t,height:i}},this.setSize=function(e,o){r=(t=e)/2,n=(i=o)/2,c.style.width=e+"px",c.style.height=o+"px",h.style.width=e+"px",h.style.height=o+"px"};var v,y,b=(v=new THREE.Vector3,y=new THREE.Vector3,function(e,t){return v.setFromMatrixPosition(e.matrixWorld),y.setFromMatrixPosition(t.matrixWorld),v.distanceToSquared(y)});this.render=function(e,t){var s;s=t.isOrthoLerping||t.isOrthographicCamera?.5/Math.tan(THREE.Math.degToRad(.5*t.getEffectiveFOV()))*i:t.projectionMatrix.elements[5]*n,u.camera.fov!==s&&(c.style.WebkitPerspective=s+"px",c.style.MozPerspective=s+"px",c.style.perspective=s+"px",u.camera.fov=s),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld();var d="translateZ("+s+"px)";!t.isPerspectiveLerping&&t.isOrthographicCamera&&(d+="scale("+t.zoom+")");var v=(d+=f(o?l:t.matrixWorldInverse))+"translate("+r+"px,"+n+"px)";u.camera.style===v||p||(h.style.WebkitTransform=v,h.style.MozTransform=v,h.style.transform=v,u.camera.style=v),function e(t,i,r){if(t instanceof THREE.CSS3DObject){var n;t instanceof THREE.CSS3DSprite?(a.copy(i.matrixWorldInverse),a.transpose(),a.copyPosition(t.matrixWorld),a.scale(t.scale),a.elements[3]=0,a.elements[7]=0,a.elements[11]=0,a.elements[15]=1,n=o?g(a,i):m(a,r)):n=o?g(t.matrixWorld,i):m(t.matrixWorld,r);var s=t.element,l=u.objects[t.id]&&u.objects[t.id].style;void 0!==l&&l===n||(s.style.WebkitTransform=n,s.style.MozTransform=n,s.style.transform=n,u.objects[t.id]={style:n},p&&(u.objects[t.id].distanceToCameraSquared=b(i,t))),s.parentNode!==h&&h.appendChild(s)}for(var c=0,d=t.children.length;c<d;c++)e(t.children[c],i,r)}(e,t,d),p&&function(e){var t=Object.keys(u.objects).sort((function(e,t){return u.objects[e].distanceToCameraSquared-u.objects[t].distanceToCameraSquared})),i=t.length;e.traverse((function(e){var r=t.indexOf(e.id+"");-1!==r&&(e.element.style.zIndex=i-r)}))}(e)}},THREE.DeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var i,r,n,o,a=function(e){t.deviceOrientation=e},s=function(){t.screenOrientation=window.orientation||0},l=(i=new THREE.Vector3(0,0,1),r=new THREE.Euler,n=new THREE.Quaternion,o=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,a,s,l){r.set(a,t,-s,"YXZ"),e.setFromEuler(r),e.multiply(o),e.multiply(n.setFromAxisAngle(i,-l))});this.connect=function(){s(),window.addEventListener("orientationchange",s,!1),window.addEventListener("deviceorientation",a,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",s,!1),window.removeEventListener("deviceorientation",a,!1),t.enabled=!1},this.update=function(){if(!1!==t.enabled){var e=t.deviceOrientation;if(e){var i=e.alpha?THREE.Math.degToRad(e.alpha)+t.alphaOffset:0,r=e.beta?THREE.Math.degToRad(e.beta):0,n=e.gamma?THREE.Math.degToRad(e.gamma):0,o=t.screenOrientation?THREE.Math.degToRad(t.screenOrientation):0;l(t.object.quaternion,i,r,n,o)}}},this.dispose=function(){t.disconnect()},this.connect()},THREE.EarthOrbitControls=function(e,t){var i;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.isEarth=!0,this.target=new THREE.Vector3,this._leftInteractive=!0,this._keepTarget=!1,this.minDistance=500,this.maxDistance=11079114.2,this.minZoom=0,this.maxZoom=1/0,this.maxPitchAngle=87,this._minPolarAngle=0,this._maxPolarAngle=THING.Math.degToRad(this.maxPitchAngle),this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.88,this.dampingZoomFactor=.5,this.enableZoom=!0,this.zoomSpeed=1,this.zoomFactor=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.mousePanSpeed=1,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.standardRadius=10216133.731679259,this.targetMaxOffset=6e7,this.panStander=this.maxDistance-6378e3,this.isDispatchEvent=!0,this.enableZoomOnTarget=!0,this.options={},this._isCameraStatic=!0,this.setOptions=function(e){this.options=e,this.mouseButtons={ORBIT:this._parseToThreeMouseKey(e.moveKey),ZOOM:this._parseToThreeMouseKey(e.zoomKey),PAN:this._parseToThreeMouseKey(e.rotationKey)},this.enableZoomOnTarget=e.enableZoomOnTarget},this._parseToThreeMouseKey=function(e){var t;switch(e){case"left":t=THREE.MOUSE.LEFT;break;case"right":t=THREE.MOUSE.RIGHT;break;case"middle":t=THREE.MOUSE.MIDDLE}return t},this._parseToThingMouseKey=function(e){var t;switch(e){case THREE.MOUSE.LEFT:t="left";break;case THREE.MOUSE.RIGHT:t="right";break;case THREE.MOUSE.MIDDLE:t="middle"}return t},this.getOptions=function(e){return this.options.rotationKey=this._parseToThingMouseKey(this.mouseButtons.PAN),this.options.zoomKey=this._parseToThingMouseKey(this.mouseButtons.ZOOM),this.options.moveKey=this._parseToThingMouseKey(this.mouseButtons.ORBIT),this.options.enableZoomOnTarget=this.enableZoomOnTarget,this.options},this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getRotationSpherePhi=function(){return h.phi},this.getSphericalRadius=function(){return c.radius},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(o),r.update(),u=l.NONE},this.goHome=function(){M=!0,r.object.up.set(0,1,0),r.object.position.set(4890109.86328125,9295980.46875,13943610.3515625),c.radius,h.phi=-.01,h.theta=Math.PI/2,h.radius=c.radius-6378e3,r._isCameraStatic=!1,r.update(),r._isCameraStatic=!0},this.setState=function(e){if(r.enabled){var t=r._getIntersectPoint();r.target.copy(t);var i=r.target,n=r.object.position,o=(new THREE.Vector3).subVectors(i,n),a=(new THREE.Vector3).crossVectors(n,o),s=(new THREE.Vector3).crossVectors(o,a);s=s.normalize(),r.object.up.copy(s),r.object.lookAt(i.x,i.y,i.z)}},this.correctUp=function(e){var t=e.time||3e3,i=e.callback,n=r.target,o=r.object.position,a=new THREE.Vector3;a.copy(r.object.up),a.normalize();var s=new THREE.Vector3;s.copy(o),s.normalize();var l=null;requestAnimationFrame((function e(o){l||(l=o);var u=o-l,c=a.lerp(s,u/t);r.object.up=c,r.object.lookAt(n),u/t<1?requestAnimationFrame(e):(i&&i(),console.log("end-correct"))}))},this._getIntersectPoint=function(e){if(void 0===e&&(e=!0),this._isCameraStatic||0===this._getState()||2===this._getState()||this._keepTarget)return this.target;var t=new THREE.Vector3,i=[];if(this.object.getWorldDirection(t),t.normalize(),j._camera=this.object,j.set(this.object.position,t),P.set(this.object.position,t),e){var r=t3djs.buffer.nodeBuffer.get("tiles-root");if(r&&r.ensureVisible()&&(i=j.intersectObjects(r.children,!0)),i.length>0)return i[0].point}var n=new THREE.Vector3;return P.intersectSphere(F,n),n.equals(new THREE.Vector3(0,0,0))?this.target:n},this._getIntersectPointByMouse=function(e,t){var i=[];if(r.isEarth){var n=new THREE.Vector3;this.object.getWorldDirection(n),n.normalize(),P.set(this.object.position,n),j.setFromCamera(new THREE.Vector2(e,t),this.object);var o=t3djs.buffer.nodeBuffer.get("tiles-root");o&&o.ensureVisible()&&(i=j.intersectObjects(o.children,!0));var a=new THREE.Vector3;return P.intersectSphere(F,a),i.length>0?i[0].point:this._getIntersectPoint()}{let e=window.innerWidth*(N.x+1)/2,t=(1-N.y)*window.innerHeight/2,i=this.app.camera.screenToWorld(e,t);return new THREE.Vector3(i[0],i[1],i[2])}},this._getIntersectQuaternion=function(e,t){(new THREE.Vector3).copy(e);var i=new THREE.Vector3;i.copy(e),i.normalize();var r=new THREE.Quaternion;r.setFromUnitVectors(new THREE.Vector3(0,1,0),i);var n=new THREE.Quaternion;return n.setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2+t),r.multiply(n),r.normalize(),r},this._correctCube=function(){var e=this._getIntersectPoint();L.position.copy(e),d.setFromVector3(e),d.radius=6378e3;var t=this._getIntersectQuaternion(e,d.theta);L.rotation.set(0,0,0),L.applyQuaternion(t),L.updateMatrixWorld(!0)},this._correctSphericalRotation=function(e){var t=new THREE.Vector3;if(t.copy(e),L.worldToLocal(t),h.setFromVector3(t),0!=r.target.length()){var i=r.object.position.distanceTo(this._getIntersectPoint());h.radius=i}h.phi=-h.phi,h.theta=Math.PI+h.theta,!1},this._getAngle=function(){if(0!=r.target.length()){var e=new THREE.Vector3;e.copy(r.target),e.normalize();var t=new THREE.Vector3(0,6378e3,0);t.sub(this.object.position),t.normalize();var i=new THREE.Vector3;this.object.getWorldDirection(i),i.projectOnPlane(e),t.projectOnPlane(e);var n=t.angleTo(i);return i.cross(t),i.sub(e),i.length()<=1&&(n*=-1),n}},this.autoFixTarget=function(e){if(!B&&r.app&&(r.app.scene.add(L),L.visible=!1,B=!0,!0),M){if(r.dispatchEvent(o),r.enableDamping||(M=!1),I.multiply(H),e.applyQuaternion(I),r.object.updateMatrixWorld(!0),0!=r.target.length()){(i=new THREE.Vector3).copy(e),i.normalize(),r.object.up.copy(i),r.target.applyQuaternion(I)}else{var t=this._getIntersectPoint();t.y+=100,r.target.copy(t)}r.object.lookAt(r.target)}else if(C){r.dispatchEvent(o),C=!1;var i,n=this._getIntersectPoint();(i=new THREE.Vector3).copy(L.position),i.normalize();var a=new THREE.Vector3;a.setFromSpherical(h),a.applyMatrix4(L.matrixWorld),r.object.up.copy(i),r.object.position.copy(a),r.target.copy(n),r.object.lookAt(r.target)}else if(R||D){r.dispatchEvent(o);var s=r.object.position.distanceTo(this._getIntersectPoint());if(s>r.maxDistance&&D||s<r.minDistance&&R)h.radius=s,f=1;else{var l;l=R&&this.enableZoomOnTarget?this._getIntersectPointByMouse(N.x,N.y):this._getIntersectPointByMouse(0,0);var u=new THREE.Vector3;u.copy(r.object.position),u.sub(l),u.normalize();var p=c.radius*f-c.radius;h.radius+=p;var d=new THREE.Vector3;d.setFromSpherical(h),u.multiplyScalar(p),r.object.position.add(u),this._correctCube(),d.applyMatrix4(L.matrixWorld),r.object.position.copy(d),r.object.up.copy(r.object.position),r.target.copy(L.position),r.object.lookAt(r.target)}r.enableDamping||(R=!1,D=!1)}},this.addEventListener("start",(function(){r._isCameraStatic=!1})),this.addEventListener("end",(function(){r._isCameraStatic=!0})),this.update=(i=new THREE.Vector3,function(){var e=r.object.position;i.copy(e),c.setFromVector3(i),d.setFromVector3(r.target),d.radius=6378e3,r.enabled&&this.autoFixTarget(e),r.object.lookAt(r.target),this._correctCube(),this._correctSphericalRotation(e);var t=r.object.position.distanceTo(this._getIntersectPoint());return r.rotateSpeed=t/3e7,r.zoomSpeed=h.radius/4e6*this.zoomFactor,r.mousePanSpeed=1,!0===r.enableDamping?M?(p.x*=1-r.dampingFactor,p.y*=1-r.dampingFactor,V(p.x),z(p.y),(C||R||D||p.x>-1e-10&&p.x<1e-10||p.y>-1e-10&&p.y<1e-10)&&(M=!1,p.set(0,0))):R?(f+=(1-f)*r.dampingZoomFactor)>.99999999&&(f=1,R=!1):D&&(f-=(f-1)*r.dampingZoomFactor)<1.0000001&&(f=1,D=!1):(p.set(0,0),f=1,M=!1,C=!1),m.set(0,0,0),!1}),this.dispose=function(){r.domElement.removeEventListener("contextmenu",ae,!1),r.domElement.removeEventListener("mousedown",Z,!1),r.domElement.removeEventListener("wheel",te,!1),r.domElement.removeEventListener("touchstart",re,!1),r.domElement.removeEventListener("touchend",oe,!1),r.domElement.removeEventListener("touchmove",ne,!1),document.removeEventListener("mousemove",K,!1),document.removeEventListener("mouseup",$,!1),window.removeEventListener("keydown",ie,!1)};var r=this,n={type:"wheel"},o={type:"change"},a={type:"start"},s={type:"end"},l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},u=l.NONE;r._getState=function(){return u};var c=new THREE.Spherical,h=new THREE.Spherical;h.theta=Math.PI/2,h.phi=-.01,h.radius=this.panStander;var p=new THREE.Vector2,d=(new THREE.Spherical,new THREE.Spherical);d.radius=6378e3;new THREE.Spherical,new THREE.Cylindrical,new THREE.Cylindrical;var f=1,m=new THREE.Vector3,g=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector2,b=new THREE.Vector2,_=new THREE.Vector2,x=new THREE.Vector2,E=new THREE.Vector2,w=new THREE.Vector2,T=new THREE.Vector2,S=new THREE.Vector2,A=new THREE.Vector2,M=(new THREE.Vector3,new THREE.Vector3,!1),C=!1,R=!1,D=!1,P=new THREE.Ray,j=new THREE.Raycaster,F=new THREE.Sphere(new THREE.Vector3(0,0,0),6378e3),O=new THREE.BoxGeometry(1e3,1e3,1e3),k=new THREE.MeshBasicMaterial({color:65280}),L=new THREE.Mesh(O,k),B=!1,H=new THREE.Quaternion,I=new THREE.Quaternion,N={};function U(){return Math.pow(.95,r.zoomSpeed)}function V(e){var t=new THREE.Vector3(0,6378e4,0);t.unproject(r.object),t.normalize(),p.x=e,e*=1-Math.sin(h.phi),I.setFromAxisAngle(t,-e)}function z(e){var t=new THREE.Vector3(6378e3,0,0);t.unproject(r.object),t.normalize(),p.y=e,H.setFromAxisAngle(t,-e)}var q=function(e){h.phi>-.001||(h.theta-=e,h.theta>2*Math.PI&&(h.theta=h.theta-2*Math.PI),h.theta<0&&(h.theta=2*Math.PI+h.theta))},W=function(e){C=!0,h.phi+=e,h.phi>=-.01&&(h.phi=-.01),h.phi<-r.maxPolarAngle&&(h.phi=-r.maxPolarAngle),h.phi>-r.minPolarAngle&&(h.phi=-r.minPolarAngle)},G=function(e,t){var i=r.domElement===document?r.domElement.body:r.domElement;r.object.isPerspectiveCamera?(q(2*Math.PI*e/i.clientWidth*r.mousePanSpeed),W(2*Math.PI*t/i.clientHeight*r.mousePanSpeed)):r.object.isOrthographicCamera?(q(e*(r.object.right-r.object.left)/r.object.zoom/i.clientWidth,r.object.matrix),W(t*(r.object.top-r.object.bottom)/r.object.zoom/i.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)};function X(e){D=!0,r.object.isPerspectiveCamera?f/=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function Y(e){R=!0,r.object.isPerspectiveCamera?f*=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function J(e){b.set(e.touches[0].pageX,e.touches[0].pageY)}function Q(e){_.set(e.touches[0].pageX,e.touches[0].pageY),x.subVectors(_,b),G(x.x,x.y),b.copy(_),r.update()}function Z(e){if(!1!==r.enabled){switch(e.preventDefault(),e.button){case r.mouseButtons.ORBIT:if(!1===r.enableRotate)return;!function(e){g.set(e.clientX,e.clientY)}(e),u=l.ROTATE;break;case r.mouseButtons.ZOOM:if(!1===r.enableZoom)return;!function(e){E.set(e.clientX,e.clientY)}(e),u=l.DOLLY;break;case r.mouseButtons.PAN:if(!1===r.enablePan)return;!function(e){b.set(e.clientX,e.clientY)}(e),u=l.PAN}u!==l.NONE&&(document.addEventListener("mousemove",K,!1),document.addEventListener("mouseup",$,!1),r.dispatchEvent(a))}}function K(e){if(!1!==r.enabled)switch(e.preventDefault(),u){case l.ROTATE:if(!1===r.enableRotate)return;!function(e){M=!0,v.set(e.clientX,e.clientY),y.subVectors(v,g);var t=r.domElement===document?r.domElement.body:r.domElement;V(2*Math.PI*y.x/t.clientWidth*r.rotateSpeed),z(2*Math.PI*y.y/t.clientHeight*r.rotateSpeed),g.copy(v),r.update()}(e);break;case l.DOLLY:if(!1===r.enableZoom)return;!function(e){w.set(e.clientX,e.clientY),T.subVectors(w,E),T.y>0?X(U()):T.y<0&&Y(U()),E.copy(w),r.update()}(e);break;case l.PAN:if(!1===r.enablePan)return;!function(e){_.set(e.clientX,e.clientY),x.subVectors(_,b),G(x.x,x.y),b.copy(_),r.update()}(e)}}function $(e){if(!1===r.enabled)return document.removeEventListener("mousemove",K,!1),void document.removeEventListener("mouseup",$,!1);document.removeEventListener("mousemove",K,!1),document.removeEventListener("mouseup",$,!1),r.dispatchEvent(s),u=l.NONE}r.rotate=function(e,t){switch(t=(t=t||1e3)/180*Math.PI,e){case"up":this.pan(0,t);break;case"down":this.pan(0,-t);break;case"left":this.pan(t,0);break;case"right":this.pan(-t,0)}},r.move=function(e,t){e=e/180*Math.PI,e*=this.rotateSpeed,t=t/180*Math.PI,t*=this.rotateSpeed,I.set(0,0,0,1),H.set(0,0,0,1),M=!0,V(e),z(t)},r.zoom=function(e,t){switch(t=t||.95,t=Math.pow(t,r.zoomSpeed),e){case"in":Y(t);break;case"out":X(t)}},r.earthRotate=function(e,t){switch(t=(t=t||10)/180*Math.PI,t*=this.rotateSpeed,I.set(0,0,0,1),H.set(0,0,0,1),M=!0,e){case"right":V(-t);break;case"left":V(t);break;case"up":z(t);break;case"down":z(-t)}};let ee=function(){let e,t=!1;return function(){t=!0,e&&t&&clearTimeout(e),e=setTimeout((function(){r.dispatchEvent(s),t=!1}),300)}}();function te(e){!1===r.enabled||!1===r.enableZoom||u!==l.NONE&&u!==l.ROTATE||(e.preventDefault(),e.stopPropagation(),r.dispatchEvent(a),function(e){N.x=e.clientX/window.innerWidth*2-1,N.y=-e.clientY/window.innerHeight*2+1,e.deltaY<0?(Y(U()),r.dispatchEvent(n)):e.deltaY>0&&(X(U()),r.dispatchEvent(n)),r.update()}(e),ee())}function ie(e){!1!==r.enabled&&!1!==r.enableKeys&&!1!==r.enablePan&&function(e){switch(e.keyCode){case r.keys.UP:G(0,r.keyPanSpeed),r.update();break;case r.keys.BOTTOM:G(0,-r.keyPanSpeed),r.update();break;case r.keys.LEFT:G(r.keyPanSpeed,0),r.update();break;case r.keys.RIGHT:G(-r.keyPanSpeed,0),r.update()}}(e)}function re(e){if(!1!==r.enabled){switch(e.touches.length){case 1:if(!1===r.enableRotate)return;!function(e){g.set(e.touches[0].pageX,e.touches[0].pageY)}(e),u=l.TOUCH_ROTATE;break;case 3:if(!1===r.enableZoom)return;J(e),u=l.TOUCH_PAN;break;case 2:if(S.set(e.touches[0].pageX,e.touches[0].pageY),A.set(e.touches[1].pageX,e.touches[1].pageY),!1===r.enablePan)return;J(e),function(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);E.set(0,r)}(e),u=l.TOUCH_PAN;break;default:u=l.NONE}u!==l.NONE&&r.dispatchEvent(a)}}function ne(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===r.enableRotate)return;if(u!==l.TOUCH_ROTATE)return;!function(e){M=!0,v.set(e.touches[0].pageX,e.touches[0].pageY),y.subVectors(v,g);var t=r.domElement===document?r.domElement.body:r.domElement;V(2*Math.PI*y.x/t.clientWidth*r.rotateSpeed),z(2*Math.PI*y.y/t.clientHeight*r.rotateSpeed),g.copy(v),r.update()}(e);break;case 3:if(!1===r.enableZoom)return;if(u!==l.TOUCH_PAN)return;Q(e);break;case 2:var t=new THREE.Vector2(e.touches[0].pageX,e.touches[0].pageY),i=new THREE.Vector2(e.touches[1].pageX,e.touches[1].pageY),n=t.sub(S).normalize(),o=i.sub(A).normalize();if(n.dot(o)>0){if(u=l.TOUCH_PAN,!1===r.enablePan)return;Q(e)}else{if(u=l.TOUCH_DOLLY,!1===r.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);w.set(0,n),T.subVectors(w,E),T.y>0?Y(U()):T.y<0&&X(U()),E.copy(w),r.update()}(e)}break;default:u=l.NONE}}function oe(e){!1!==r.enabled&&(r.dispatchEvent(s),u=l.NONE)}function ae(e){!1!==r.enabled&&e.preventDefault()}r.domElement.addEventListener("contextmenu",ae,!1),r.domElement.addEventListener("mousedown",Z,!1),r.domElement.addEventListener("wheel",te,!1),r.domElement.addEventListener("touchstart",re,!1),r.domElement.addEventListener("touchend",oe,!1),r.domElement.addEventListener("touchmove",ne,!1),window.addEventListener("keydown",ie,!1),r.setLeftInteractive=function(e){r.mouseButtons=e?{ORBIT:0,ZOOM:1,PAN:2}:{ORBIT:2,ZOOM:1,PAN:0},r._leftInteractive=e},this.update(),r.pan=G,r.panDelta=x},THREE.EarthOrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.EarthOrbitControls.prototype.constructor=THREE.EarthOrbitControls,Object.defineProperties(THREE.EarthOrbitControls.prototype,{leftInteractive:{get:function(){return this._leftInteractive},set:function(e){this.setLeftInteractive(e)}},center:{get:function(){return console.warn("THREE.EarthOrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.EarthOrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.EarthOrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.EarthOrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.EarthOrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.EarthOrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.EarthOrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.EarthOrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.EarthOrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.EarthOrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.EarthOrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.EarthOrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.EarthOrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}},minPolarAngle:{get:function(){return this._minPolarAngle},set:function(e){this._minPolarAngle=e}},maxPolarAngle:{get:function(){return this._maxPolarAngle},set:function(e){this._maxPolarAngle=e<this.maxPitchAngle*Math.PI/180?e:this.maxPitchAngle*Math.PI/180}}}),THREE.EarthOrbitControls.prototype.setLookAt=function(e){this.object.lookAt(new THREE.Vector3(e[0],e[1],e[2]))},THREE.FreeControls=function(e){this.object=e,this.object.rotation.setRotationOrder("YXZ"),this.movementSpeed=.25,this.rotateSpeed=.25,this.enableMovementDamping=!0,this.movementDampingFactor=.25,this.enableRotateDamping=!0,this.rotateDampingFactor=.25,this.enableFly=!0,this.enableKeyRotate=!1,this.getMoveDirection=function(e){e=e||new THREE.Vector3;var r=t.set(1,0,0).applyQuaternion(this.object.quaternion);return this.enableFly?(t.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.x),e.add(t),t.set(0,1,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.y),e.add(t),t.set(0,0,1).applyQuaternion(this.object.quaternion).multiplyScalar(c.z),e.add(t)):(i.copy(r).multiplyScalar(c.x),e.add(i),i.copy(r).cross(this.object.up).normalize().multiplyScalar(c.z),e.add(i)),e},this.update=function(e){var d=(e=e||.0166)*this.movementSpeed/.0166*(1===h.run?2:1);c.add(l),u.add(s);var f=t.set(1,0,0).applyQuaternion(this.object.quaternion).normalize();return this.enableFly?(t.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.x*d),this.object.position.add(t),t.set(0,1,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.y*d),this.object.position.add(t),t.set(0,0,1).applyQuaternion(this.object.quaternion).multiplyScalar(c.z*d),this.object.position.add(t)):(i.copy(f).multiplyScalar(c.x*d),this.object.position.add(i),i.copy(f).cross(this.object.up).normalize().multiplyScalar(c.z*d),this.object.position.add(i)),this.object.up.equals(p)?(this.object.rotation.x+=e*u.x/.0166,this.object.rotation.y+=e*u.y/.0166,this.object.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.object.rotation.x))):(r.setFromAxisAngle(this.object.up,e*u.y/.0166),this.object.quaternion.premultiply(r),f=t.set(1,0,0).applyQuaternion(this.object.quaternion).normalize(),r.setFromAxisAngle(f,e*u.x/.0166),this.object.quaternion.premultiply(r)),this.enableMovementDamping?c.multiplyScalar(1-this.movementDampingFactor):c.set(0,0,0),this.enableRotateDamping?u.multiplyScalar(1-this.rotateDampingFactor):u.set(0,0),this.enableKeyRotate||s.set(0,0),(n.distanceToSquared(this.object.position)>a||8*(1-o.dot(this.object.quaternion))>a)&&(n.copy(this.object.position),o.copy(this.object.quaternion),!0)};var t=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Quaternion,n=new THREE.Vector3,o=new THREE.Quaternion,a=1e-6,s=new THREE.Vector2,l=new THREE.Vector3,u=new THREE.Vector2,c=new THREE.Vector3,h={up:0,down:0,left:0,right:0,forward:0,back:0,run:0},p=(new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0)),d=this;this.updateMovementVector=function(){d.enableKeyRotate?s.y=-2*Math.PI*.005*(-h.left+h.right)*d.rotateSpeed:l.x=-h.left+h.right,l.y=-h.down+h.up,l.z=-h.forward+h.back},this.rotateDelta=s,this.moveDelta=l,this.moveState=h},THREE.FreeMouseControls=function(e,t){THREE.FreeControls.call(this,e),this.domElement=void 0!==t?t:document,t&&this.domElement.setAttribute("tabindex",-1);var i=new THREE.Vector2,r=new THREE.Vector2,n=this.rotateDelta,o=(this.moveDelta,0),a=this.moveState,s=this;function l(){var e=s.domElement===document?s.domElement.body:s.domElement,t=n.x,i=n.y;n.x=2*Math.PI*i/e.clientHeight,n.y=2*Math.PI*t/e.clientWidth}var u=this.updateMovementVector;function c(e){i.set(e.clientX,e.clientY),o=1}function h(e){0!=o&&(s.enableKeyRotate||(r.set(e.clientX,e.clientY),n.subVectors(r,i).multiplyScalar(-s.rotateSpeed),l(),i.copy(r)))}function p(e){o=0,n.set(0,0)}function d(e){switch(e.keyCode){case 87:a.forward=1;break;case 83:a.back=1;break;case 65:a.left=1;break;case 68:a.right=1;break;case 82:a.up=1;break;case 70:a.down=1;break;case 69:a.up=1;break;case 81:a.down=1;break;case 16:a.run=1}u()}function f(e){switch(e.keyCode){case 87:a.forward=0;break;case 83:a.back=0;break;case 65:a.left=0;break;case 68:a.right=0;break;case 82:a.up=0;break;case 70:a.down=0;break;case 69:a.up=0;break;case 81:a.down=0;break;case 16:a.run=0}u()}this.domElement.addEventListener("mousemove",h,!1),this.domElement.addEventListener("mousedown",c,!1),this.domElement.addEventListener("mouseup",p,!1),window.addEventListener("keydown",d,!1),window.addEventListener("keyup",f,!1),u(),l(),this.dispose=function(){this.domElement.removeEventListener("mousemove",h,!1),this.domElement.removeEventListener("mousedown",c,!1),this.domElement.removeEventListener("mouseup",p,!1),window.removeEventListener("keydown",d,!1),window.removeEventListener("keyup",f,!1)}},THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,i=/^usemtl /;function r(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},i&&i.name&&"function"==typeof i.clone){var r=i.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){var r=this.vertices,n=this.object.geometry.vertices;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){var r=this.normals,n=this.object.geometry.normals;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addColor:function(e,t,i){var r=this.colors,n=this.object.geometry.colors;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addUV:function(e,t,i){var r=this.uvs,n=this.object.geometry.uvs;n.push(r[e+0],r[e+1]),n.push(r[t+0],r[t+1]),n.push(r[i+0],r[i+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,r,n,o,a,s,l){var u=this.vertices.length,c=this.parseVertexIndex(e,u),h=this.parseVertexIndex(t,u),p=this.parseVertexIndex(i,u);if(this.addVertex(c,h,p),void 0!==r&&""!==r){var d=this.uvs.length;c=this.parseUVIndex(r,d),h=this.parseUVIndex(n,d),p=this.parseUVIndex(o,d),this.addUV(c,h,p)}if(void 0!==a&&""!==a){var f=this.normals.length;c=this.parseNormalIndex(a,f),h=a===s?c:this.parseNormalIndex(s,f),p=a===l?c:this.parseNormalIndex(l,f),this.addNormal(c,h,p)}this.colors.length>0&&this.addColor(c,h,p)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,i=0,r=e.length;i<r;i++)this.addVertexPoint(this.parseVertexIndex(e[i],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var i=this.vertices.length,r=this.uvs.length,n=0,o=e.length;n<o;n++)this.addVertexLine(this.parseVertexIndex(e[n],i));var a=0;for(o=t.length;a<o;a++)this.addUVLine(this.parseUVIndex(t[a],r))}};return e.startObject("",!1),e}function n(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null}return n.prototype={constructor:n,load:function(e,t,i,r){var n=this,o=new THREE.FileLoader(n.manager);o.setPath(this.path),o.load(e,(function(e){t(n.parse(e))}),i,r)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(n){console.time("OBJLoader");var o=new r;-1!==n.indexOf("\r\n")&&(n=n.replace(/\r\n/g,"\n")),-1!==n.indexOf("\\\n")&&(n=n.replace(/\\\n/g,""));for(var a=n.split("\n"),s="",l="",u=[],c="function"==typeof"".trimLeft,h=0,p=a.length;h<p;h++)if(s=a[h],0!==(s=c?s.trimLeft():s.trim()).length&&"#"!==(l=s.charAt(0)))if("v"===l){var d=s.split(/\s+/);switch(d[0]){case"v":o.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),8===d.length&&o.colors.push(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6]));break;case"vn":o.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":o.uvs.push(parseFloat(d[1]),parseFloat(d[2]))}}else if("f"===l){for(var f=s.substr(1).trim().split(/\s+/),m=[],g=0,v=f.length;g<v;g++){var y=f[g];if(y.length>0){var b=y.split("/");m.push(b)}}var _=m[0];for(g=1,v=m.length-1;g<v;g++){var x=m[g],E=m[g+1];o.addFace(_[0],x[0],E[0],_[1],x[1],E[1],_[2],x[2],E[2])}}else if("l"===l){var w=s.substring(1).trim().split(" "),T=[],S=[];if(-1===s.indexOf("/"))T=w;else for(var A=0,M=w.length;A<M;A++){var C=w[A].split("/");""!==C[0]&&T.push(C[0]),""!==C[1]&&S.push(C[1])}o.addLineGeometry(T,S)}else if("p"===l){var R=s.substr(1).trim().split(" ");o.addPointGeometry(R)}else if(null!==(u=e.exec(s))){var D=(" "+u[0].substr(1).trim()).substr(1);o.startObject(D)}else if(i.test(s))o.object.startMaterial(s.substring(7).trim(),o.materialLibraries);else if(t.test(s))o.materialLibraries.push(s.substring(7).trim());else{if("s"!==l){if("\0"===s)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+s+'"')}if((u=s.split(" ")).length>1){var P=u[1].trim().toLowerCase();o.object.smooth="0"!==P&&"off"!==P}else o.object.smooth=!0;(W=o.object.currentMaterial())&&(W.smooth=o.object.smooth)}o.finalize();var j=new THREE.Group;j.materialLibraries=[].concat(o.materialLibraries);for(h=0,p=o.objects.length;h<p;h++){var F=o.objects[h],O=F.geometry,k=F.materials,L="Line"===O.type,B="Points"===O.type,H=!1;if(0!==O.vertices.length){var I=new THREE.BufferGeometry;I.addAttribute("position",new THREE.Float32BufferAttribute(O.vertices,3)),O.normals.length>0?I.addAttribute("normal",new THREE.Float32BufferAttribute(O.normals,3)):I.computeVertexNormals(),O.colors.length>0&&(H=!0,I.addAttribute("color",new THREE.Float32BufferAttribute(O.colors,3))),O.uvs.length>0&&I.addAttribute("uv",new THREE.Float32BufferAttribute(O.uvs,2));for(var N,U=[],V=0,z=k.length;V<z;V++){var q=k[V],W=void 0;if(null!==this.materials)if(W=this.materials.create(q.name),!L||!W||W instanceof THREE.LineBasicMaterial){if(B&&W&&!(W instanceof THREE.PointsMaterial)){var G=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});X.copy(W),W=G}}else{var X=new THREE.LineBasicMaterial;X.copy(W),X.lights=!1,W=X}W||((W=L?new THREE.LineBasicMaterial:B?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=q.name),W.flatShading=!q.smooth,W.vertexColors=H?THREE.VertexColors:THREE.NoColors,U.push(W)}if(U.length>1){for(V=0,z=k.length;V<z;V++){q=k[V];I.addGroup(q.groupStart,q.groupCount,V)}N=L?new THREE.LineSegments(I,U):B?new THREE.Points(I,U):new THREE.Mesh(I,U)}else N=L?new THREE.LineSegments(I,U[0]):B?new THREE.Points(I,U[0]):new THREE.Mesh(I,U[0]);N.name=F.name,j.add(N)}}return console.timeEnd("OBJLoader"),j}},n}(),THREE.OrbitControls=function(e,t){var i,r,n,o,a;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoLeftRotate=!1,this.autoUpRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.LEFT,MIDDLE:THREE.MOUSE.MIDDLE,RIGHT:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._getIntersectPoint=function(){return new THREE.Vector3},this.move=function(e,t){N(e,t)},this.getPolarAngle=function(){return y.phi},this.getAzimuthalAngle=function(){return y.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(c),s.update(),g=m.NONE},this.update=(i=new THREE.Vector3,r=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),n=r.clone().inverse(),o=new THREE.Vector3,a=new THREE.Quaternion,function(){var e=s.object.position;return i.copy(e).sub(s.target),i.applyQuaternion(r),y.setFromVector3(i),s.autoRotate&&g===m.NONE&&(s.autoLeftRotate?k(F()):s.autoUpRotate&&L(F())),y.theta+=b.theta,y.phi+=b.phi,y.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,y.theta)),y.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,y.phi)),y.makeSafe(),y.radius*=_,y.radius=Math.max(s.minDistance,Math.min(s.maxDistance,y.radius)),s.target.add(x),i.setFromSpherical(y),i.applyQuaternion(n),e.copy(s.target).add(i),s.object.lookAt(s.target),!0===s.enableDamping?(b.theta*=1-s.dampingFactor,b.phi*=1-s.dampingFactor,x.multiplyScalar(1-s.dampingFactor)):(b.set(0,0,0),x.set(0,0,0)),_=1,!!(E||o.distanceToSquared(s.object.position)>v||8*(1-a.dot(s.object.quaternion))>v)&&(s.dispatchEvent(c),o.copy(s.object.position),a.copy(s.object.quaternion),E=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",$,!1),s.domElement.removeEventListener("mousedown",q,!1),s.domElement.removeEventListener("wheel",X,!1),s.domElement.removeEventListener("touchstart",Q,!1),s.domElement.removeEventListener("touchend",K,!1),s.domElement.removeEventListener("touchmove",Z,!1),s.domElement.removeEventListener("mousemove",J,!1),document.removeEventListener("mousemove",W,!1),document.removeEventListener("mouseup",G,!1),window.removeEventListener("keydown",Y,!1)};var s=this,l={type:"mousemoveevent"},u={type:"wheel",delta:0},c={type:"change"},h={type:"start"},p={type:"end"},d={type:"mousedownpanevent"},f={type:"mouseuppanevent"},m={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},g=m.NONE,v=1e-6,y=new THREE.Spherical,b=new THREE.Spherical,_=1,x=new THREE.Vector3,E=!1,w=new THREE.Vector2,T=new THREE.Vector2,S=new THREE.Vector2,A=new THREE.Vector2,M=new THREE.Vector2,C=new THREE.Vector2,R=new THREE.Vector2,D=new THREE.Vector2,P=new THREE.Vector2,j=null;function F(){return 2*Math.PI/60/60*s.autoRotateSpeed}function O(){return Math.pow(.95,s.zoomSpeed)}function k(e){b.theta-=e}function L(e){b.phi-=e}var B,H=(B=new THREE.Vector3,function(e,t){B.setFromMatrixColumn(t,0),B.multiplyScalar(-e),x.add(B)}),I=function(){var e=new THREE.Vector3;return function(t,i){!0===s.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),x.add(e)}}(),N=function(){var e=new THREE.Vector3;return function(t,i){var r=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){var n=s.object.position;e.copy(n).sub(s.target);var o=e.length();o*=Math.tan(s.object.fov/2*Math.PI/180),H(2*t*o/r.clientHeight,s.object.matrix),I(2*i*o/r.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(H(t*(s.object.right-s.object.left)/s.object.zoom/r.clientWidth,s.object.matrix),I(i*(s.object.top-s.object.bottom)/s.object.zoom/r.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function U(e){s.object.isPerspectiveCamera?_/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function V(e){s.object.isPerspectiveCamera?_*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function z(e){A.set(e.clientX,e.clientY),s.dispatchEvent(d)}function q(e){if(!1!==s.enabled){switch(e.preventDefault(),e.button){case s.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey){if(!1===s.enablePan)return;z(e),g=m.PAN}else{if(!1===s.enableRotate)return;!function(e){w.set(e.clientX,e.clientY)}(e),g=m.ROTATE}break;case s.mouseButtons.MIDDLE:if(!1===s.enableZoom)return;!function(e){R.set(e.clientX,e.clientY)}(e),g=m.DOLLY;break;case s.mouseButtons.RIGHT:if(!1===s.enablePan)return;z(e),g=m.PAN}g!==m.NONE&&(document.addEventListener("mousemove",W,!1),document.addEventListener("mouseup",G,!1),s.dispatchEvent(h))}}function W(e){if(!1!==s.enabled)switch(e.preventDefault(),g){case m.ROTATE:if(!1===s.enableRotate)return;!function(e){T.set(e.clientX,e.clientY),S.subVectors(T,w).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;k(2*Math.PI*S.x/t.clientHeight),L(2*Math.PI*S.y/t.clientHeight),w.copy(T),s.update()}(e);break;case m.DOLLY:if(!1===s.enableZoom)return;!function(e){D.set(e.clientX,e.clientY),P.subVectors(D,R),P.y>0?U(O()):P.y<0&&V(O()),R.copy(D),s.update()}(e);break;case m.PAN:if(!1===s.enablePan)return;!function(e){M.set(e.clientX,e.clientY),C.subVectors(M,A).multiplyScalar(s.panSpeed),N(C.x,C.y),A.copy(M),s.update()}(e)}}function G(e){!1!==s.enabled&&(g==m.PAN&&s.dispatchEvent(f),document.removeEventListener("mousemove",W,!1),document.removeEventListener("mouseup",G,!1),s.dispatchEvent(p),g=m.NONE)}function X(e){!1===s.enabled||!1===s.enableZoom||g!==m.NONE&&g!==m.ROTATE||(e.preventDefault(),e.stopPropagation(),function(e){e.deltaY<0?V(O()):e.deltaY>0&&U(O()),u.x=e.x,u.y=e.y,u.clientX=e.clientX,u.clientY=e.clientY,u.layerX=e.layerX,u.layerX=e.layerX,u.offsetX=e.offsetX,u.offsetY=e.offsetY,u.delta=e.deltaY,s.dispatchEvent(u),s.update()}(e))}function Y(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){switch(e.keyCode){case s.keys.UP:N(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:N(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:N(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:N(-s.keyPanSpeed,0),s.update()}}(e)}function J(e){var t=!1;if(j){var i=j.distanceTo({x:e.x,y:e.y});0!==e.buttons&&i>=2&&(t=!0)}else j=new THREE.Vector2;j.set(e.x,e.y),t&&s.dispatchEvent(l)}function Q(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===s.enableRotate)return;!function(e){w.set(e.touches[0].pageX,e.touches[0].pageY)}(e),g=m.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);R.set(0,r)}if(s.enablePan){var n=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);A.set(n,o)}}(e),g=m.TOUCH_DOLLY_PAN;break;default:g=m.NONE}g!==m.NONE&&s.dispatchEvent(h)}}function Z(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enableRotate)return;if(g!==m.TOUCH_ROTATE)return;!function(e){T.set(e.touches[0].pageX,e.touches[0].pageY),S.subVectors(T,w).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;k(2*Math.PI*S.x/t.clientHeight),L(2*Math.PI*S.y/t.clientHeight),w.copy(T),s.update()}(e);break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;if(g!==m.TOUCH_DOLLY_PAN)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);D.set(0,r),P.set(0,Math.pow(D.y/R.y,s.zoomSpeed)),U(P.y),R.copy(D)}if(s.enablePan){var n=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);M.set(n,o),C.subVectors(M,A).multiplyScalar(s.panSpeed),N(C.x,C.y),A.copy(M)}s.update()}(e);break;default:g=m.NONE}}function K(e){!1!==s.enabled&&(s.dispatchEvent(p),g=m.NONE)}function $(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",$,!1),s.domElement.addEventListener("mousedown",q,!1),s.domElement.addEventListener("wheel",X,!1),s.domElement.addEventListener("touchstart",Q,!1),s.domElement.addEventListener("touchend",K,!1),s.domElement.addEventListener("touchmove",Z,!1),s.domElement.addEventListener("mousemove",J,!1),window.addEventListener("keydown",Y,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),THREE.Reflector=function(e,t){THREE.Mesh.call(this,e),this.type="Reflector";var i=this,r=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),n=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,s=t.shader||THREE.Reflector.ReflectorShader,l=void 0!==t.recursion?t.recursion:0,u=new THREE.Plane,c=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Matrix4,f=new THREE.Vector3(0,0,-1),m=new THREE.Vector4,g=new THREE.Vector4,v=new THREE.Vector3,y=new THREE.Vector3,b=new THREE.Vector4,_=new THREE.Matrix4,x=new THREE.PerspectiveCamera,E={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},w=new THREE.WebGLRenderTarget(n,o,E);THREE.Math.isPowerOfTwo(n)&&THREE.Math.isPowerOfTwo(o)||(w.texture.generateMipmaps=!1);var T=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),fragmentShader:s.fragmentShader,vertexShader:s.vertexShader});T.uniforms.tDiffuse.value=w.texture,T.uniforms.color.value=r,T.uniforms.textureMatrix.value=_,this.material=T,this.renderOrder=-1/0,this.addBeforeRenderFunction("THREE.Reflector",(function(e,t,r){if("recursion"in r.userData){if(r.userData.recursion===l)return;r.userData.recursion++}if(h.setFromMatrixPosition(i.matrixWorld),p.setFromMatrixPosition(r.matrixWorld),d.extractRotation(i.matrixWorld),c.set(0,0,1),c.applyMatrix4(d),v.subVectors(h,p),!(v.dot(c)>0)){v.reflect(c).negate(),v.add(h),d.extractRotation(r.matrixWorld),f.set(0,0,-1),f.applyMatrix4(d),f.add(p),y.subVectors(h,f),y.reflect(c).negate(),y.add(h),x.position.copy(v),x.up.set(0,1,0),x.up.applyMatrix4(d),x.up.reflect(c),x.lookAt(y),x.far=r.far,x.updateMatrixWorld(),x.projectionMatrix.copy(r.getProjectionMatrixAlways?r.getProjectionMatrixAlways():r.projectionMatrix),x.userData.recursion=0,_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(x.projectionMatrix),_.multiply(x.matrixWorldInverse),_.multiply(i.matrixWorld),u.setFromNormalAndCoplanarPoint(c,h),u.applyMatrix4(x.matrixWorldInverse),m.set(u.normal.x,u.normal.y,u.normal.z,u.constant);var n=x.projectionMatrix;b.x=(Math.sign(m.x)+n.elements[8])/n.elements[0],b.y=(Math.sign(m.y)+n.elements[9])/n.elements[5],b.z=-1,b.w=(1+n.elements[10])/n.elements[14],m.multiplyScalar(2/m.dot(b)),n.elements[2]=m.x,n.elements[6]=m.y,n.elements[10]=m.z+1-a,n.elements[14]=m.w,i.visible=!1;var o=e.getRenderTarget(),s=e.vr.enabled,E=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(w),e.clear(),e.render(t,x),e.vr.enabled=s,e.shadowMap.autoUpdate=E,e.setRenderTarget(o);var T=r.bounds;if(void 0!==T){var S=e.getSize(),A=e.getPixelRatio();g.x=T.x*S.width*A,g.y=T.y*S.height*A,g.z=T.z*S.width*A,g.w=T.w*S.height*A,e.state.viewport(g)}i.visible=!0}})),this.getRenderTarget=function(){return w}},THREE.Reflector.prototype=Object.create(THREE.Mesh.prototype),THREE.Reflector.prototype.constructor=THREE.Reflector,THREE.Reflector.ReflectorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},THREE.ReflectorRTT=function(e,t){THREE.Reflector.call(this,e,t),this.geometry.setDrawRange(0,0)},THREE.ReflectorRTT.prototype=Object.create(THREE.Reflector.prototype),THREE.Refractor=function(e,t){THREE.Mesh.call(this,e),this.type="Refractor";var i=this,r=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),n=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,s=t.shader||THREE.Refractor.RefractorShader,l=new THREE.PerspectiveCamera;l.matrixAutoUpdate=!1,l.userData.refractor=!0;var u=new THREE.Plane,c=new THREE.Matrix4,h={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},p=new THREE.WebGLRenderTarget(n,o,h);THREE.Math.isPowerOfTwo(n)&&THREE.Math.isPowerOfTwo(o)||(p.texture.generateMipmaps=!1),this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,transparent:!0}),this.material.uniforms.color.value=r,this.material.uniforms.tDiffuse.value=p.texture,this.material.uniforms.textureMatrix.value=c;var d,f,m,g,v,y,b,_,x=(d=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Matrix4,g=new THREE.Vector3,v=new THREE.Vector3,function(e){return d.setFromMatrixPosition(i.matrixWorld),f.setFromMatrixPosition(e.matrixWorld),g.subVectors(d,f),m.extractRotation(i.matrixWorld),v.set(0,0,1),v.applyMatrix4(m),g.dot(v)<0}),E=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Quaternion,n=new THREE.Vector3;return function(){i.matrixWorld.decompose(t,r,n),e.set(0,0,1).applyQuaternion(r).normalize(),e.negate(),u.setFromNormalAndCoplanarPoint(e,t)}}(),w=(y=new THREE.Plane,b=new THREE.Vector4,_=new THREE.Vector4,function(e){l.matrixWorld.copy(e.matrixWorld),l.matrixWorldInverse.getInverse(l.matrixWorld),l.projectionMatrix.copy(e.getProjectionMatrixAlways?e.getProjectionMatrixAlways():e.projectionMatrix),l.far=e.far,y.copy(u),y.applyMatrix4(l.matrixWorldInverse),b.set(y.normal.x,y.normal.y,y.normal.z,y.constant);var t=l.projectionMatrix;_.x=(Math.sign(b.x)+t.elements[8])/t.elements[0],_.y=(Math.sign(b.y)+t.elements[9])/t.elements[5],_.z=-1,_.w=(1+t.elements[10])/t.elements[14],b.multiplyScalar(2/b.dot(_)),t.elements[2]=b.x,t.elements[6]=b.y,t.elements[10]=b.z+1-a,t.elements[14]=b.w});var T,S=(T=new THREE.Vector4,function(e,t,r){i.visible=!1;var n=e.getRenderTarget(),o=e.vr.enabled,a=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(p),e.clear(),e.render(t,l),e.vr.enabled=o,e.shadowMap.autoUpdate=a,e.setRenderTarget(n);var s=r.bounds;if(void 0!==s){var u=e.getSize(),c=e.getPixelRatio();T.x=s.x*u.width*c,T.y=s.y*u.height*c,T.z=s.z*u.width*c,T.w=s.w*u.height*c,e.state.viewport(T)}i.visible=!0});this.onBeforeRender=function(e,t,r){!0!==r.userData.refractor&&!0!=!x(r)&&(E(),function(e){c.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),c.multiply(e.projectionMatrix),c.multiply(e.matrixWorldInverse),c.multiply(i.matrixWorld)}(r),w(r),S(e,t,r))},this.getRenderTarget=function(){return p}},THREE.Refractor.prototype=Object.create(THREE.Mesh.prototype),THREE.Refractor.prototype.constructor=THREE.Refractor,THREE.Refractor.RefractorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new THREE.Group,r=0,n=t.length;r<n;r++)i.add(new THREE.Mesh(e,t[r]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){e.applyMatrix((new THREE.Matrix4).getInverse(i.matrixWorld)),t.remove(e),i.add(e)}},THREE.SimplifyModifier=function(){},function(){var e=new THREE.Vector3,t=new THREE.Vector3;function i(e,t){var i=e.indexOf(t);i>-1&&e.splice(i,1)}function r(e,t){var i=t.position.distanceTo(e.position),r=0,n=[],o=(e.faces,e.faces.length);for(c=0;c<o;c++)(h=e.faces[c]).hasVertex(t)&&n.push(h);for(c=0;c<o;c++){var a=1;h=e.faces[c];for(var s=0;s<n.length;s++){p=n[s];var l=h.normal.dot(p.normal);a=Math.min(a,(1.001-l)/2)}r=Math.max(r,a)}n.length<2&&(r=1),e.isBorder()&&n.length>1&&(r=1);for(var u=0,c=0;c<o;c++){var h=e.faces[c];for(s=0;s<n.length;s++){var p=n[s];if(h.uvAt(e).equals(p.uvAt(e)))break}s==n.length&&u++}return u&&(r=1),i*r+0}function n(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var t=0;t<e.neighbors.length;t++){var i=r(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=i,e.minCost=i,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=i,i<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=i)}e.collapseCost=e.totalCost/e.costCount}function o(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){i(e.neighbors.pop().neighbors,e)}i(t,e)}function a(e,t){i(t,e),e.v1&&i(e.v1.faces,e),e.v2&&i(e.v2.faces,e),e.v3&&i(e.v3.faces,e);for(var r,n,o=[this.v1,this.v2,this.v3],a=0;a<3;a++)n=o[(a+1)%3],(r=o[a])&&n&&(r.removeIfNonNeighbor(n),n.removeIfNonNeighbor(r))}function s(e,t,i,r){if(r){var s=[];for(c=0;c<i.neighbors.length;c++)s.push(i.neighbors[c]);for(var l=[],u=i.faces.length,c=0;c<u;c++){(h=i.faces[c]).hasVertex(r)&&l.push(h)}for(c=0;c<u;c++){var h;if(!(h=i.faces[c]).hasVertex(r))for(var p=0;p<l.length;p++){var d=l[p];if(h.uvAt(i).equals(d.uvAt(i))){h.setUV(i,d.uvAt(r));break}l.length}}for(c=i.faces.length-1;c>=0;c--)i.faces[c].hasVertex(r)&&a(i.faces[c],t);for(c=i.faces.length-1;c>=0;c--)i.faces[c].replaceVertex(i,r);for(o(i,e),c=0;c<s.length;c++)n(s[c])}else o(i,e)}function l(e){for(var t=e[0],i=0;i<e.length;i++)e[i].collapseCost<t.collapseCost&&(t=e[i]);return t}function u(e,t,i,r,n,o,a,s,l){this.a=r,this.b=n,this.c=o,this.v1=e,this.v2=t,this.v3=i,this.uv1=a,this.uv2=s,this.uv3=l,this.normal=new THREE.Vector3,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(i),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(i),i.faces.push(this),i.addUniqueNeighbor(e),i.addUniqueNeighbor(t)}function c(e,t){this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}u.prototype.computeNormal=function(){var i=this.v1.position,r=this.v2.position,n=this.v3.position;e.subVectors(n,r),t.subVectors(i,r),e.cross(t).normalize(),this.normal.copy(e)},u.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},u.prototype.replaceVertex=function(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),i(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},u.prototype.uvAt=function(e){var t=[this.v1,this.v2,this.v3].reduce((function(t,i,r){return!t.length&&e.position.equals(i)&&t.push(r),t}),[])[0];return[this.uv1,this.uv2,this.uv3][t]},u.prototype.setUV=function(e,t){var i=[this.v1,this.v2,this.v3].reduce((function(t,i,r){return!t.length&&e.position.equals(i)&&t.push(r),t}),[])[0];[this.uv1,this.uv2,this.uv3][i]=t},c.prototype.addUniqueNeighbor=function(e){var t,i;t=this.neighbors,i=e,-1===t.indexOf(i)&&t.push(i)},c.prototype.removeIfNonNeighbor=function(e){var t=this.neighbors,i=this.faces,r=t.indexOf(e);if(-1!==r){for(var n=0;n<i.length;n++)if(i[n].hasVertex(e))return;t.splice(r,1)}},c.prototype.isBorder=function(){for(var e=this.neighbors.length,t=0;t<e;t++){for(var i=0,r=this.faces.length,n=0;n<r;n++)this.faces[n].hasVertex(this.neighbors[t])&&i++;if(1===i)return!0}return!1},THREE.SimplifyModifier.prototype.modify=function(e,t){e instanceof THREE.BufferGeometry&&!e.vertices&&!e.faces&&(console.log("converting BufferGeometry to Geometry"),e=(new THREE.Geometry).fromBufferGeometry(e)),e.mergeVertices();var i,r,o=e.vertices,a=e.faces,h=e.faceVertexUvs[0],p=(new THREE.Geometry,new Array(o.length)),d=new Array(a.length);new Array(h.length);for(i=0,r=o.length;i<r;i++)p[i]=new c(o[i],i);for(i=0,r=a.length;i<r;i++)b=a[i],h[i],d[i]=new u(p[b.a],p[b.b],p[b.c],b.a,b.b,b.c,h[i][0],h[i][1],h[i][2]);for(i=0,r=p.length;i<r;i++)n(p[i]);new Array(p.length),new Array(p.length);for(var f,m=t;m--;){if(!(f=l(p))){console.log("no next vertex");break}s(p,d,f,f.collapseNeighbor)}var g=new THREE.Geometry;for(i=0;i<p.length;i++){var v=p[i];g.vertices.push(v.position)}for(i=0;i<d.length;i++){var y=d[i],b=new THREE.Face3(p.indexOf(y.v1),p.indexOf(y.v2),p.indexOf(y.v3),y.normal);g.faces.push(b),g.faceVertexUvs[0].push([y.uv1,y.uv2,y.uv3])}return g}}(),THREE.SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e},THREE.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-- >0;)this.smooth(e);e.computeFaceNormals(),e.computeVertexNormals()},function(){var e=["a","b","c"];function t(e,t,i){return i[Math.min(e,t)+"_"+Math.max(e,t)]}function i(e,t,i,r,n,o){var a,s=Math.min(e,t),l=Math.max(e,t),u=s+"_"+l;u in r?a=r[u]:(a={a:i[s],b:i[l],newEdge:null,faces:[]},r[u]=a);a.faces.push(n),o[e].edges.push(a),o[t].edges.push(a)}function r(e,t,i,r,n){e.push(new THREE.Face3(t,i,r,void 0,void 0,n))}function n(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function o(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}THREE.SubdivisionModifier.prototype.smooth=function(a){var s,l,u,c,h,p,d,f,m,g,v,y,b,_,x=new THREE.Vector3,E=[];s=a.vertices,l=a.faces;var w,T,S,A,M,C,R,D,P,j,F,O,k,L,B=void 0!==(u=a.faceVertexUvs[0])&&u.length>0;for(d in function(e,t,r,n){var o,a,s;for(o=0,a=e.length;o<a;o++)r[o]={edges:[]};for(o=0,a=t.length;o<a;o++)i((s=t[o]).a,s.b,e,n,s,r),i(s.b,s.c,e,n,s,r),i(s.c,s.a,e,n,s,r)}(s,l,v=new Array(s.length),y={}),b=[],y){for(T=y[d],S=new THREE.Vector3,M=3/8,C=1/8,2!=(R=T.faces.length)&&(M=.5,C=0),S.addVectors(T.a,T.b).multiplyScalar(M),x.set(0,0,0),m=0;m<R;m++){for(A=T.faces[m],g=0;g<3&&((w=s[A[e[g]]])===T.a||w===T.b);g++);x.add(w)}x.multiplyScalar(C),S.add(x),T.newEdge=b.length,b.push(S)}for(_=[],d=0,f=s.length;d<f;d++){for(k=s[d],3==(p=(O=v[d].edges).length)?D=3/16:p>3&&(D=3/(8*p)),P=1-p*D,j=D,p<=2&&2==p&&(P=.75,j=1/8),L=k.clone().multiplyScalar(P),x.set(0,0,0),m=0;m<p;m++)w=(F=O[m]).a!==k?F.a:F.b,x.add(w);x.multiplyScalar(j),L.add(x),_.push(L)}c=_.concat(b);var H,I,N,U,V,z,q,W=_.length;h=[];var G=new THREE.Vector2,X=new THREE.Vector2,Y=new THREE.Vector2;for(d=0,f=l.length;d<f;d++)r(h,H=t((A=l[d]).a,A.b,y).newEdge+W,I=t(A.b,A.c,y).newEdge+W,N=t(A.c,A.a,y).newEdge+W,A.materialIndex),r(h,A.a,H,N,A.materialIndex),r(h,A.b,I,H,A.materialIndex),r(h,A.c,N,I,A.materialIndex),B&&(V=(U=u[d])[0],z=U[1],q=U[2],G.set(n(V.x,z.x),n(V.y,z.y)),X.set(n(z.x,q.x),n(z.y,q.y)),Y.set(n(V.x,q.x),n(V.y,q.y)),o(E,G,X,Y),o(E,V,G,Y),o(E,z,X,G),o(E,q,Y,X));a.vertices=c,a.faces=h,B&&(a.faceVertexUvs[0]=E)}}();var THREEx=THREEx||{};THREEx.HtmlMixer=THREEx.HtmlMixer||{},THREEx.HtmlMixer.Context=function(e,t,i){var r=[];this.update=function(){r.forEach((function(e){e()}))};this.cssFactor=1e3;var n=new THREE.CSS3DRenderer({autoFixCamera:!0});this.rendererCss=n,this.rendererWebgl=e;var o=new THREE.PerspectiveCamera(i.fov,i.aspect,1e3*i.near,1e3*i.far);this.cssCamera=o,this.backupCSSCamera=o;var a=this;r.push((function(){s.children.length&&(a.cssCamera.quaternion.copy(i.quaternion),a.cssCamera.position.copy(i.position).multiplyScalar(1e3))}));var s=new THREE.Scene;this.cssScene=s,this.autoUpdateObjects=!0,r.push(function(){!0===this.autoUpdateObjects&&s.traverse((function(e){if(!e.isScene){var t=e.userData.mixerPlane;void 0!==t&&t.update()}}))}.bind(this)),r.push((function(e,t){s.children.length&&(a.cssCamera.isOrthographicCamera&&(a.cssCamera.zoom=THING.App.current.renderCamera.zoom),n.render(s,a.cssCamera))}))},THREEx.HtmlMixer.Plane=function(e,t,i){(i=i||{}).elementW=void 0!==i.elementW?i.elementW:768,i.planeW=void 0!==i.planeW?i.planeW:1,i.planeH=void 0!==i.planeH?i.planeH:.75,i.object3d=void 0!==i.object3d?i.object3d:null,this.domElement=t;var r=[];this.update=function(){r.forEach((function(e){e()}))};var n=i.planeW,o=i.planeH;if(null===i.object3d)var a=new THREE.MeshBasicMaterial({opacity:0,color:new THREE.Color("black"),blending:THREE.NoBlending,side:THREE.DoubleSide}),s=new THREE.PlaneGeometry(1,1),l=new THREE.Mesh(s,a);else l=i.object3d;this.object3d=l;var u=o/n,c=i.elementW,h=c*u;function p(){t.style.width=c+"px",t.style.height=h+"px"}this.setDomElement=function(e){var i=t;i.parentNode&&i.parentNode.removeChild(i),this.domElement=t=e,d.element=t,p()},p();var d=new THREE.CSS3DObject(t);this.cssObject=d,d.scale.set(n,o,1),d.userData.mixerPlane=this,l.addEventListener("added",(function(t){e.cssScene.add(d)})),l.addEventListener("removed",(function(t){e.cssScene.remove(d)})),r.push((function(){l.updateMatrixWorld();var t=l.matrixWorld,i=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Quaternion;t.decompose(i,n,r),d.quaternion.copy(n),d.position.copy(i).multiplyScalar(e.cssFactor);var o=e.cssFactor/1e3,a=l.geometry.parameters,s=e.cssFactor/(c/(a.width*r.x)),u=e.cssFactor/(h/(a.height*r.y));d.scale.set(s*o,u*o,1)}))},THREE.TransformControls=function(e,t){THREE.Object3D.call(this),t=void 0!==t?t:document,this.visible=!1;var i=new THREE.TransformControlsGizmo;this._gizmo=i,this.add(i);var r=new THREE.TransformControlsPlane;this._plane=r,this.add(r);var n=this;L("camera",e),L("object",void 0),L("enabled",!0),L("axis",null),L("mode","translate"),L("translationSnap",null),L("rotationSnap",null),L("space","world"),L("size",1),L("dragging",!1),L("showX",!0),L("showY",!0),L("showZ",!0);var o={type:"change"},a={type:"mouseDown"},s={type:"mouseUp",mode:n.mode},l={type:"objectChange"},u=new THREE.Raycaster,c=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Quaternion,d={X:new THREE.Vector3(1,0,0),Y:new THREE.Vector3(0,1,0),Z:new THREE.Vector3(0,0,1)},f=new THREE.Quaternion,m=new THREE.Vector3,g=new THREE.Vector3,v=new THREE.Vector3,y=new THREE.Vector3,b=0,_=new THREE.Vector3,x=new THREE.Quaternion,E=new THREE.Vector3,w=new THREE.Vector3,T=new THREE.Quaternion,S=new THREE.Vector3,A=new THREE.Vector3,M=new THREE.Quaternion,C=new THREE.Vector3,R=new THREE.Vector3,D=new THREE.Quaternion,P=new THREE.Vector3,j=new THREE.Vector3,F=new THREE.Vector3,O=new THREE.Quaternion,k=new THREE.Vector3;function L(e,t){var a=t;Object.defineProperty(n,e,{get:function(){return void 0!==a?a:t},set:function(t){a!==t&&(a=t,r[e]=t,i[e]=t,n.dispatchEvent({type:e+"-changed",value:t}),n.dispatchEvent(o))}}),n[e]=t,r[e]=t,i[e]=t}function B(e){var i=e.changedTouches?e.changedTouches[0]:e,r=t.getBoundingClientRect();return{x:(i.clientX-r.left)/r.width*2-1,y:-(i.clientY-r.top)/r.height*2+1,button:e.button}}function H(e){}function I(e){n.enabled&&n.pointerHover(B(e))}function N(e){n.enabled&&(document.addEventListener("mousemove",U,!1),n.pointerHover(B(e)),n.pointerDown(B(e)))}function U(e){n.enabled&&n.pointerMove(B(e))}function V(e){n.enabled&&(document.removeEventListener("mousemove",U,!1),n.pointerUp(B(e)))}L("parentQuaternion",T),L("worldPosition",R),L("worldPositionStart",A),L("worldQuaternion",D),L("worldQuaternionStart",M),L("cameraPosition",_),L("cameraQuaternion",x),L("pointStart",g),L("pointEnd",v),L("rotationAxis",y),L("rotationAngle",b),L("eye",j),t.addEventListener("mousedown",N,!1),t.addEventListener("touchstart",N,!1),t.addEventListener("mousemove",I,!1),t.addEventListener("touchmove",I,!1),t.addEventListener("touchmove",U,!1),document.addEventListener("mouseup",V,!1),t.addEventListener("touchend",V,!1),t.addEventListener("touchcancel",V,!1),t.addEventListener("touchleave",V,!1),t.addEventListener("contextmenu",H,!1),this.dispose=function(){t.removeEventListener("mousedown",N),t.removeEventListener("touchstart",N),t.removeEventListener("mousemove",I),document.removeEventListener("mousemove",U),t.removeEventListener("touchmove",I),t.removeEventListener("touchmove",U),document.removeEventListener("mouseup",V),t.removeEventListener("touchend",V),t.removeEventListener("touchcancel",V),t.removeEventListener("touchleave",V),t.removeEventListener("contextmenu",H)},this.attach=function(e){this.object=e,this.visible=!0},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),this.object.parent.matrixWorld.decompose(w,T,S),this.object.matrixWorld.decompose(R,D,P)),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(_,x,E),this.camera.isPerspectiveCamera?j.copy(_).sub(R).normalize():this.camera.isOrthographicCamera&&j.copy(_).normalize(),THREE.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){u.setFromCamera(e,this.camera);var t=u.intersectObjects(i.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){u.setFromCamera(e,this.camera);var t=u.intersectObjects([r],!0)[0]||!1;if(t){var i=this.space;if("scale"===this.mode?i="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(i="world"),"local"===i&&"rotate"===this.mode){var n=this.rotationSnap;"X"===this.axis&&n&&(this.object.rotation.x=Math.round(this.object.rotation.x/n)*n),"Y"===this.axis&&n&&(this.object.rotation.y=Math.round(this.object.rotation.y/n)*n),"Z"===this.axis&&n&&(this.object.rotation.z=Math.round(this.object.rotation.z/n)*n)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),F.copy(this.object.position),O.copy(this.object.quaternion),k.copy(this.object.scale),this.object.matrixWorld.decompose(A,M,C),g.copy(t.point).sub(A),"local"===i&&g.applyQuaternion(M.clone().inverse())}this.dragging=!0,a.mode=this.mode,this.dispatchEvent(a)}},this.pointerMove=function(e){var t=this.axis,i=this.mode,n=this.object,a=this.space;if("scale"===i?a="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(a="world"),void 0!==n&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){u.setFromCamera(e,this.camera);var s=u.intersectObjects([r],!0)[0]||!1;if(!1!==s){if(v.copy(s.point).sub(A),"local"===a&&v.applyQuaternion(M.clone().inverse()),"translate"===i)-1===t.search("X")&&(v.x=g.x),-1===t.search("Y")&&(v.y=g.y),-1===t.search("Z")&&(v.z=g.z),"local"===a?n.position.copy(v).sub(g).applyQuaternion(O):n.position.copy(v).sub(g),n.position.add(F),this.translationSnap&&("local"===a&&(n.position.applyQuaternion(p.copy(O).inverse()),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(O)),"world"===a&&(n.parent&&n.position.add(c.setFromMatrixPosition(n.parent.matrixWorld)),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(c.setFromMatrixPosition(n.parent.matrixWorld))));else if("scale"===i){if(-1!==t.search("XYZ")){var _=v.length()/g.length();v.dot(g)<0&&(_*=-1),c.set(_,_,_)}else c.copy(v).divide(g),-1===t.search("X")&&(c.x=1),-1===t.search("Y")&&(c.y=1),-1===t.search("Z")&&(c.z=1);n.scale.copy(k).multiply(c)}else if("rotate"===i){var x=20/R.distanceTo(c.setFromMatrixPosition(this.camera.matrixWorld)),E="local"===this.space?D:f,w=d[t];"E"===t?(c.copy(v).cross(g),y.copy(j),b=v.angleTo(g)*(c.dot(j)<0?1:-1)):"XYZE"===t?(c.copy(v).sub(g).cross(j).normalize(),y.copy(c),b=v.sub(g).dot(c.cross(j))*x):"X"!==t&&"Y"!==t&&"Z"!==t||(m.copy(w).applyQuaternion(E),y.copy(w),c=w.clone(),h=v.clone().sub(g),"local"===a&&(c.applyQuaternion(E),h.applyQuaternion(M)),b=h.dot(c.cross(j).normalize())*x),this.rotationSnap&&(b=Math.round(b/this.rotationSnap)*this.rotationSnap),this.rotationAngle=b,"local"===a?(n.quaternion.copy(O),n.quaternion.multiply(p.setFromAxisAngle(y,b))):(n.quaternion.copy(p.setFromAxisAngle(y,b)),n.quaternion.multiply(O))}this.dispatchEvent(o),this.dispatchEvent(l)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(s.mode=this.mode,this.dispatchEvent(s)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return n.mode},this.setMode=function(e){n.mode=e},this.setTranslationSnap=function(e){n.translationSnap=e},this.setRotationSnap=function(e){n.rotationSnap=e},this.setSize=function(e){n.size=e},this.setSpace=function(e){n.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has been depricated.")}},THREE.TransformControls.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControls,isTransformControls:!0}),THREE.TransformControlsGizmo=function(){"use strict";THREE.Object3D.call(this),this.type="TransformControlsGizmo";var e=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:THREE.DoubleSide,fog:!1}),t=new THREE.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),i=e.clone();i.opacity=.15;var r=e.clone();r.opacity=.33;var n=e.clone();n.color.set(16711680);var o=e.clone();o.color.set(65280);var a=e.clone();a.color.set(255);var s=e.clone();s.opacity=.25;var l=s.clone();l.color.set(16776960);var u=s.clone();u.color.set(65535);var c=s.clone();c.color.set(16711935),e.clone().color.set(16776960);var h=t.clone();h.color.set(16711680);var p=t.clone();p.color.set(65280);var d=t.clone();d.color.set(255);var f=t.clone();f.color.set(65535);var m=t.clone();m.color.set(16711935);var g=t.clone();g.color.set(16776960);var v=t.clone();v.color.set(7895160);var y=g.clone();y.opacity=.25;var b=new THREE.CylinderBufferGeometry(0,.05,.2,12,1,!1),_=new THREE.BoxBufferGeometry(.125,.125,.125),x=new THREE.BufferGeometry;x.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var E,w=function(e,t){for(var i=new THREE.BufferGeometry,r=[],n=0;n<=64*t;++n)r.push(0,Math.cos(n/32*Math.PI)*e,Math.sin(n/32*Math.PI)*e);return i.addAttribute("position",new THREE.Float32BufferAttribute(r,3)),i},T={X:[[new THREE.Mesh(b,n),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new THREE.Mesh(b,n),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new THREE.Line(x,h)]],Y:[[new THREE.Mesh(b,o),[0,1,0],null,null,"fwd"],[new THREE.Mesh(b,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new THREE.Line(x,p),null,[0,0,Math.PI/2]]],Z:[[new THREE.Mesh(b,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new THREE.Mesh(b,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new THREE.Line(x,d),null,[0,-Math.PI/2,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.1,0),s),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),l),[.15,.15,0]],[new THREE.Line(x,g),[.18,.3,0],null,[.125,1,1]],[new THREE.Line(x,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),u),[0,.15,.15],[0,Math.PI/2,0]],[new THREE.Line(x,f),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(x,f),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),c),[.15,0,.15],[-Math.PI/2,0,0]],[new THREE.Line(x,m),[.18,0,.3],null,[.125,1,1]],[new THREE.Line(x,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},S={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),i),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),i),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),i),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.2,0),i)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),i),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),i),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),i),[.2,0,.2],[-Math.PI/2,0,0]]]},A={START:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),r),null,null,null,"helper"]],END:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),r),null,null,null,"helper"]],DELTA:[[new THREE.Line((E=new THREE.BufferGeometry,E.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,1,1],3)),E),r),null,null,null,"helper"]],X:[[new THREE.Line(x,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(x,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(x,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={X:[[new THREE.Line(w(1,.5),h)],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),n),[0,0,.99],null,[1,3,1]]],Y:[[new THREE.Line(w(1,.5),p),null,[0,0,-Math.PI/2]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new THREE.Line(w(1,.5),d),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new THREE.Line(w(1.25,1),y),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new THREE.Line(w(1,1),v),null,[0,Math.PI/2,0]]]},C={AXIS:[[new THREE.Line(x,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},R={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.1,2,24),i)]],XYZE:[[new THREE.Mesh(new THREE.SphereBufferGeometry(.7,10,8),i)]]},D={X:[[new THREE.Mesh(_,n),[.8,0,0],[0,0,-Math.PI/2]],[new THREE.Line(x,h),null,null,[.8,1,1]]],Y:[[new THREE.Mesh(_,o),[0,.8,0]],[new THREE.Line(x,p),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new THREE.Mesh(_,a),[0,0,.8],[Math.PI/2,0,0]],[new THREE.Line(x,d),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new THREE.Mesh(_,l),[.85,.85,0],null,[2,2,.2]],[new THREE.Line(x,g),[.855,.98,0],null,[.125,1,1]],[new THREE.Line(x,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(_,u),[0,.85,.85],null,[.2,2,2]],[new THREE.Line(x,f),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(x,f),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(_,c),[.85,0,.85],null,[2,.2,2]],[new THREE.Line(x,m),[.855,0,.98],null,[.125,1,1]],[new THREE.Line(x,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[0,0,1.1]]]},P={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),i),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),i),[0,.5,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),i),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new THREE.Mesh(_,i),[.85,.85,0],null,[3,3,.2]]],YZ:[[new THREE.Mesh(_,i),[0,.85,.85],null,[.2,3,3]]],XZ:[[new THREE.Mesh(_,i),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),i),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),i),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),i),[0,0,1.1]]]},j={X:[[new THREE.Line(x,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(x,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(x,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},F=function(e){var t=new THREE.Object3D;for(var i in e)for(var r=e[i].length;r--;){var n=e[i][r][0].clone(),o=e[i][r][1],a=e[i][r][2],s=e[i][r][3],l=e[i][r][4];n.name=i,n.tag=l,o&&n.position.set(o[0],o[1],o[2]),a&&n.rotation.set(a[0],a[1],a[2]),s&&n.scale.set(s[0],s[1],s[2]),n.updateMatrix();var u=n.geometry.clone();u.applyMatrix(n.matrix),n.geometry=u,n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),t.add(n)}return t},O=new THREE.Vector3(0,0,0),k=new THREE.Euler,L=new THREE.Vector3(0,1,0),B=new THREE.Vector3(0,0,0),H=new THREE.Matrix4,I=new THREE.Quaternion,N=new THREE.Quaternion,U=new THREE.Quaternion,V=new THREE.Vector3(1,0,0),z=new THREE.Vector3(0,1,0),q=new THREE.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=F(T)),this.add(this.gizmo.rotate=F(M)),this.add(this.gizmo.scale=F(D)),this.add(this.picker.translate=F(S)),this.add(this.picker.rotate=F(R)),this.add(this.picker.scale=F(P)),this.add(this.helper.translate=F(A)),this.add(this.helper.rotate=F(C)),this.add(this.helper.scale=F(j)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:U;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var i=[];i=(i=(i=i.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var r=0;r<i.length;r++){var n=i[r];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);var o=this.worldPosition.distanceTo(this.cameraPosition);if(this.camera.isOrthographicCamera&&(o/=this.camera.zoom),n.scale.set(1,1,1).multiplyScalar(o*this.size/7),"helper"!==n.tag){if(n.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==n.name&&"XYZX"!==n.name||Math.abs(L.copy(V).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"!==n.name&&"XYZY"!==n.name||Math.abs(L.copy(z).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"!==n.name&&"XYZZ"!==n.name||Math.abs(L.copy(q).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(L.copy(q).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(L.copy(V).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(L.copy(z).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),-1!==n.name.search("X")&&(L.copy(V).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.x*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Y")&&(L.copy(z).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.y*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Z")&&(L.copy(q).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.z*=-1:"bwd"===n.tag&&(n.visible=!1))}else"rotate"===this.mode&&(N.copy(t),L.copy(this.eye).applyQuaternion(I.copy(t).inverse()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(H.lookAt(this.eye,B,z)),"X"===n.name&&(I.setFromAxisAngle(V,Math.atan2(-L.y,L.z)),I.multiplyQuaternions(N,I),n.quaternion.copy(I)),"Y"===n.name&&(I.setFromAxisAngle(z,Math.atan2(L.x,L.z)),I.multiplyQuaternions(N,I),n.quaternion.copy(I)),"Z"===n.name&&(I.setFromAxisAngle(q,Math.atan2(L.y,L.x)),I.multiplyQuaternions(N,I),n.quaternion.copy(I)));n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material._opacity=n.material._opacity||n.material.opacity,n.material._color=n.material._color||n.material.color.clone(),n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled?this.axis&&(n.name===this.axis?(n.material.opacity=1,n.material.color.lerp(new THREE.Color(1,1,1),.5)):this.axis.split("").some((function(e){return n.name===e}))?(n.material.opacity=1,n.material.color.lerp(new THREE.Color(1,1,1),.5)):(n.material.opacity*=.25,n.material.color.lerp(new THREE.Color(1,1,1),.5))):(n.material.opacity*=.5,n.material.color.lerp(new THREE.Color(1,1,1),.5))}else n.visible=!1,"AXIS"===n.name?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,"X"===this.axis&&(I.setFromEuler(k.set(0,0,0)),n.quaternion.copy(t).multiply(I),Math.abs(L.copy(V).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Y"===this.axis&&(I.setFromEuler(k.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(I),Math.abs(L.copy(z).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Z"===this.axis&&(I.setFromEuler(k.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(I),Math.abs(L.copy(q).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"XYZE"===this.axis&&(I.setFromEuler(k.set(0,Math.PI/2,0)),L.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(H.lookAt(B,L,z)),n.quaternion.multiply(I),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),O.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),O.applyQuaternion(this.worldQuaternionStart.clone().inverse()),n.scale.copy(O),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)))}THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsGizmo.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControlsGizmo,isTransformControlsGizmo:!0}),THREE.TransformControlsPlane=function(){"use strict";THREE.Mesh.call(this,new THREE.PlaneBufferGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var e=new THREE.Vector3(1,0,0),t=new THREE.Vector3(0,1,0),i=new THREE.Vector3(0,0,1),r=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Matrix4,s=new THREE.Quaternion;this.updateMatrixWorld=function(){var l=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(l="local"),e.set(1,0,0).applyQuaternion("local"===l?this.worldQuaternion:s),t.set(0,1,0).applyQuaternion("local"===l?this.worldQuaternion:s),i.set(0,0,1).applyQuaternion("local"===l?this.worldQuaternion:s),o.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":o.copy(this.eye).cross(e),n.copy(e).cross(o);break;case"Y":o.copy(this.eye).cross(t),n.copy(t).cross(o);break;case"Z":o.copy(this.eye).cross(i),n.copy(i).cross(o);break;case"XY":n.copy(i);break;case"YZ":n.copy(e);break;case"XZ":o.copy(i),n.copy(t);break;case"XYZ":case"E":n.set(0,0,0)}break;case"rotate":default:n.set(0,0,0)}0===n.length()?this.quaternion.copy(this.cameraQuaternion):(a.lookAt(r.set(0,0,0),n,o),this.quaternion.setFromRotationMatrix(a)),THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsPlane.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.TransformControlsPlane,isTransformControlsPlane:!0}),THREE.Water=function(e,t){THREE.Mesh.call(this,e),this.type="Water";var i=this,r=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(16777215),n=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,s=t.flowDirection||new THREE.Vector2(1,0),l=t.flowSpeed||.03,u=t.reflectivity||.02,c=t.scale||1,h=t.shader||THREE.Water.WaterShader,p=new THREE.TextureLoader,d=t.flowMap||void 0,f=t.normalMap0||p.load("textures/water/Water_1_M_Normal.jpg"),m=t.normalMap1||p.load("textures/water/Water_2_M_Normal.jpg"),g=.15,v=.5*g,y=new THREE.Matrix4,b=new THREE.Clock;if(void 0!==THREE.Reflector)if(void 0!==THREE.Refractor){var _=new THREE.Reflector(e,{textureWidth:n,textureHeight:o,clipBias:a}),x=new THREE.Refractor(e,{textureWidth:n,textureHeight:o,clipBias:a});_.matrixAutoUpdate=!1,x.matrixAutoUpdate=!1,this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),void 0!==d?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:d}):this.material.uniforms.flowDirection={type:"v2",value:s},f.wrapS=f.wrapT=THREE.RepeatWrapping,m.wrapS=m.wrapT=THREE.RepeatWrapping,this.material.uniforms.tReflectionMap.value=_.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=x.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=f,this.material.uniforms.tNormalMap1.value=m,this.material.uniforms.color.value=r,this.material.uniforms.reflectivity.value=u,this.material.uniforms.textureMatrix.value=y,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=v,this.material.uniforms.config.value.z=v,this.material.uniforms.config.value.w=c,this.addBeforeRenderFunction("THREE.Water",(function(e,t,r){var n,o;!function(e){y.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),y.multiply(e.getProjectionMatrixAlways?e.getProjectionMatrixAlways():e.projectionMatrix),y.multiply(e.matrixWorldInverse),y.multiply(i.matrixWorld)}(r),n=b.getDelta(),(o=i.material.uniforms.config).value.x+=l*n,o.value.y=o.value.x+v,o.value.x>=g?(o.value.x=0,o.value.y=v):o.value.y>=g&&(o.value.y=o.value.y-g),i.visible=!1,_.matrixWorld.copy(i.matrixWorld),x.matrixWorld.copy(i.matrixWorld),_.onBeforeRender(e,t,r),x.onBeforeRender(e,t,r),i.visible=!0}))}else console.error("THREE.Water: Required component THREE.Refractor not found.");else console.error("THREE.Water: Required component THREE.Reflector not found.")},THREE.Water.prototype=Object.create(THREE.Mesh.prototype),THREE.Water.prototype.constructor=THREE.Water,THREE.Water.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new THREE.Vector4}},vertexShader:["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","uniform mat4 textureMatrix;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tvUv = uv;","\tvCoord = textureMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvToEye = cameraPosition - worldPosition.xyz;","\tvec4 mvPosition =  viewMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","\t#include <logdepthbuf_vertex>","\t#include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform sampler2D tReflectionMap;","uniform sampler2D tRefractionMap;","uniform sampler2D tNormalMap0;","uniform sampler2D tNormalMap1;","#ifdef USE_FLOWMAP","\tuniform sampler2D tFlowMap;","#else","\tuniform vec2 flowDirection;","#endif","uniform vec3 color;","uniform float reflectivity;","uniform vec4 config;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\t#include <logdepthbuf_fragment>","\tfloat flowMapOffset0 = config.x;","\tfloat flowMapOffset1 = config.y;","\tfloat halfCycle = config.z;","\tfloat scale = config.w;","\tvec3 toEye = normalize( vToEye );","\tvec2 flow;","\t#ifdef USE_FLOWMAP","\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;","\t#else","\t\tflow = flowDirection;","\t#endif","\tflow.x *= - 1.0;","\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );","\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );","\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;","\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );","\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );","\tfloat theta = max( dot( toEye, normal ), 0.0 );","\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 coord = vCoord.xyz / vCoord.w;","\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;","\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );","\tvec4 refractColor = texture2D( tRefractionMap, uv );","\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","}"].join("\n")},function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EarCut=e()}}((function(){return function e(t,i,r){function n(a,s){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[a]={exports:{}};t[a][0].call(c.exports,(function(e){return n(t[a][1][e]||e)}),c,c.exports,e,t,i,r)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)n(r[a]);return n}({1:[function(e,t,i){"use strict";function r(e,t,i){i=i||2;var r,s,l,u,c,d,m,g=t&&t.length,v=g?t[0]*i:e.length,y=n(e,0,v,i,!0),b=[];if(!y||y.next===y.prev)return b;if(g&&(y=function(e,t,i,r){var a,s,l,u,c,d=[];for(a=0,s=t.length;a<s;a++)l=t[a]*r,u=a<s-1?t[a+1]*r:e.length,(c=n(e,l,u,r,!1))===c.next&&(c.steiner=!0),d.push(f(c));for(d.sort(h),a=0;a<d.length;a++)p(d[a],i),i=o(i,i.next);return i}(e,t,y,i)),e.length>80*i){r=l=e[0],s=u=e[1];for(var _=i;_<v;_+=i)(c=e[_])<r&&(r=c),(d=e[_+1])<s&&(s=d),c>l&&(l=c),d>u&&(u=d);m=0!==(m=Math.max(l-r,u-s))?1/m:0}return a(y,b,i,r,s,m),b}function n(e,t,i,r,n){var o,a;if(n===S(e,t,i,r)>0)for(o=t;o<i;o+=r)a=E(o,e[o],e[o+1],a);else for(o=i-r;o>=t;o-=r)a=E(o,e[o],e[o+1],a);return a&&y(a,a.next)&&(w(a),a=a.next),a}function o(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!y(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(w(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function a(e,t,i,r,n,h,p){if(e){!p&&h&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=d(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,o,a,s,l,u=1;do{for(i=e,e=null,o=null,a=0;i;){for(a++,r=i,s=0,t=0;t<u&&(s++,r=r.nextZ);t++);for(l=u;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,s--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,u*=2}while(a>1)}(n)}(e,r,n,h);for(var f,m,g=e;e.prev!==e.next;)if(f=e.prev,m=e.next,h?l(e,r,n,h):s(e))t.push(f.i/i),t.push(e.i/i),t.push(m.i/i),w(e),e=m.next,g=m.next;else if((e=m)===g){p?1===p?a(e=u(e,t,i),t,i,r,n,h,2):2===p&&c(e,t,i,r,n,h):a(o(e),t,i,r,n,h,1);break}}}function s(e){var t=e.prev,i=e,r=e.next;if(v(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(m(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&v(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function l(e,t,i,r){var n=e.prev,o=e,a=e.next;if(v(n,o,a)>=0)return!1;for(var s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,u=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,c=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,h=d(s,l,t,i,r),p=d(u,c,t,i,r),f=e.prevZ,g=e.nextZ;f&&f.z>=h&&g&&g.z<=p;){if(f!==e.prev&&f!==e.next&&m(n.x,n.y,o.x,o.y,a.x,a.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,g!==e.prev&&g!==e.next&&m(n.x,n.y,o.x,o.y,a.x,a.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&m(n.x,n.y,o.x,o.y,a.x,a.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;g&&g.z<=p;){if(g!==e.prev&&g!==e.next&&m(n.x,n.y,o.x,o.y,a.x,a.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function u(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!y(n,o)&&b(n,r,r.next,o)&&_(n,o)&&_(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),w(r),w(r.next),r=e=o),r=r.next}while(r!==e);return r}function c(e,t,i,r,n,s){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&g(l,u)){var c=x(l,u);return l=o(l,l.next),c=o(c,c.next),a(l,t,i,r,n,s),void a(c,t,i,r,n,s)}u=u.next}l=l.next}while(l!==e)}function h(e,t){return e.x-t.x}function p(e,t){if(t=function(e,t){var i,r=t,n=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>a){if(a=s,s===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===a)return i.prev;var l,u=i,c=i.x,h=i.y,p=1/0;r=i.next;for(;r!==u;)n>=r.x&&r.x>=c&&n!==r.x&&m(o<h?n:a,o,c,h,o<h?a:n,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(n-r.x))<p||l===p&&r.x>i.x)&&_(r,e)&&(i=r,p=l),r=r.next;return i}(e,t)){var i=x(t,e);o(i,i.next)}}function d(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function m(e,t,i,r,n,o,a,s){return(n-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(i-a)*(t-s)>=0&&(i-a)*(o-s)-(n-a)*(r-s)>=0}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&b(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&_(e,t)&&_(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)}function v(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,i,r){return!!(y(e,i)&&y(t,r)||y(e,r)&&y(i,t))||v(e,t,i)>0!=v(e,t,r)>0&&v(i,r,e)>0!=v(i,r,t)>0}function _(e,t){return v(e.prev,e,e.next)<0?v(e,t,e.next)>=0&&v(e,e.prev,t)>=0:v(e,t,e.prev)<0||v(e,e.next,t)<0}function x(e,t){var i=new T(e.i,e.x,e.y),r=new T(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function E(e,t,i,r){var n=new T(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function w(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(e,t,i,r){for(var n=0,o=t,a=i-r;o<i;o+=r)n+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return n}t.exports=r,t.exports.default=r,r.deviation=function(e,t,i,r){var n=t&&t.length,o=n?t[0]*i:e.length,a=Math.abs(S(e,0,o,i));if(n)for(var s=0,l=t.length;s<l;s++){var u=t[s]*i,c=s<l-1?t[s+1]*i:e.length;a-=Math.abs(S(e,u,c,i))}var h=0;for(s=0;s<r.length;s+=3){var p=r[s]*i,d=r[s+1]*i,f=r[s+2]*i;h+=Math.abs((e[p]-e[f])*(e[d+1]-e[p+1])-(e[p]-e[d])*(e[f+1]-e[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},r.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var a=0;a<t;a++)i.vertices.push(e[n][o][a]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i}},{}]},{},[1])(1)}));var Graph=function(e){var t=function(e){var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i},i=function(e,t){return parseFloat(e)-parseFloat(t)},r=function(e,r,n,o){o=o||1/0;var a,s={},l={0:[r]},u={},c=function(e,t){var i=""+e;l[i]||(l[i]=[]),l[i].push(t)};for(s[r]=0;l&&(a=t(l)).length;){a.sort(i);var h=a[0],p=l[h],d=p.shift(),f=parseFloat(h),m=e[d]||{};for(var g in p.length||delete l[h],m)if(Object.prototype.hasOwnProperty.call(m,g)){var v=m[g]+f,y=s[g];(void 0===y||y>v)&&(s[g]=v,c(v,g),u[g]=d)}}return void 0===s[n]?null:u},n=function(e,t){for(var i=[],r=t;void 0!==r;)i.push(r),r=e[r];return i.reverse(),i},o=function(e,t){for(var i,o,a,s=t.shift(),l=[];t.length;){if(i=t.shift(),!(o=r(e,s,i)))return null;if(a=n(o,i),!t.length)return l.concat(a);l.push.apply(l,a.slice(0,-1)),s=i}},a=function(e,t){try{return Array.prototype.slice.call(e,t)}catch(o){for(var i=[],r=t||0,n=e.length;r<n;++r)i.push(e[r]);return i}},s=function(e){this.map=e};return s.prototype.findShortestPath=function(e,t){return"[object Array]"===Object.prototype.toString.call(e)?o(this.map,e):2===arguments.length?o(this.map,[e,t]):o(this.map,a(arguments))},s.findShortestPath=function(e,t,i){return"[object Array]"===Object.prototype.toString.call(t)?o(e,t):3===arguments.length?o(e,[t,i]):o(e,a(arguments,1))},s}();function SimpleIDW(e){if(!(this instanceof SimpleIDW))return new SimpleIDW(e);this._canvas=e="string"==typeof e?document.getElementById(e):e,void 0===this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=128,this._canvas.height=128),this._ctx=this._canvas.getContext("2d"),this._width=this._canvas.width,this._height=this._canvas.height,this._min=0,this._max=1,this._radius=5,this._data=[],this._transformedData=[]}THREE.IFCLoader=function(){function e(e,t){this.campus=e,this.manager=void 0!==t?t:THREE.DefaultLoadingManager,this.eventManager=new THREE.EventDispatcher}function t(){return{geometryBuffer:(t={},{get:function(e){return t[e]},delete:function(e){return delete t[e]},add:function(e,i){t[e]=i},getAll:function(){return t},deleteAll:function(){t={}}}),materialBuffer:function(){var e={};return{get:function(t){return e[t]},delete:function(t){return delete e[t]},add:function(t,i){e[t]=i},getAll:function(){return e},deleteAll:function(){e={}}}}(),meshBuffer:function(){var e={};return{get:function(t){return e[t]},delete:function(t){return delete e[t]},add:function(t,i){e[t]=i},getAll:function(){return e},deleteAll:function(){e={}}}}(),instancedBuffer:(e={},{get:function(t){var i=[];for(var r in e)-1!==r.indexOf(t+":")&&i.push(e[r]);return i},getLength:function(){var t=0;for(var i in e)t+=e[i].length;return t},add:function(t,i){e[t]instanceof Array?e[t].push(i):(e[t]=[],e[t].push(i))},remove:function(t){delete e[t]},removeAll:function(){e={}},getAll:function(){return e}})};var e,t}function i(e,i,r,n,o,a){this.json=e||{},this.extensions=o||{},this.options=a||{},this.type=i,this.recursion=r,this.campus=n,this.app=n.app,this.cache=new t,this.nodeInfo={},this.materialInfo={},this.buffer={},this.gData={},this.url=a.url,this.levels=0,this.datas=57,this.loadingLevels=0,this.loadingDatas=0,this.fileLoader=new THREE.FileLoader(this.options.manager),this.eventManager=this.options.eventManager}e.prototype={constructor:e,crossOrigin:"anonymous",type:"",load:function(e,t,i,r){this.url=e;var n,o=this;n=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),n+="index.json",o.manager.itemStart(e);var a=function(t){r?r(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},s=new THREE.FileLoader(o.manager);s.setPath(this.path),s.load(n,(function(i){try{o.parse(i,n,o.type,o.recursion,o.campus,(function(i){t(i),o.manager.itemEnd(e)}),a)}catch(e){a(e)}}),void 0,a),o.eventManager.addEventListener("progress",(function(e){i(e.progress)}))},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setType:function(e){return this.type=e,this},setRecursion:function(e){this.recursion=e},setResourcePath:function(e){return this.resourcePath=e,this},parse:function(e,t,r,n,o,a,s){var l;l=e;var u=new i(JSON.parse(l),r,n,o,{},{url:this.url||"",crossOrigin:this.crossOrigin,manager:this.manager,eventManager:this.eventManager});this.parser=u,u.parse(a,s)}},i.prototype.parse=function(e,t){this.pendingRoom=[];var i=this,r=i.fileLoader,n=(this.app,[]);n.push(new Promise((function(e,t){r.load(i.url+"node.json",(function(t){i.nodeInfo=JSON.parse(t),i.loadingDatas+=5,i.eventManager.dispatchEvent({type:"progress",progress:.5*i.loadingDatas/i.datas}),e(t)}))}))),n.push(new Promise((function(e,t){r.load(i.url+"gdata.json",(function(t){i.gData=JSON.parse(t),i.loadingDatas++,i.eventManager.dispatchEvent({type:"progress",progress:.5*i.loadingDatas/i.datas}),e(t)}))}))),n.push(new Promise((function(e,t){r.load(i.url+"material.json",(function(t){i.materialInfo=JSON.parse(t),i.loadingDatas++,i.eventManager.dispatchEvent({type:"progress",progress:.5*i.loadingDatas/i.datas}),e(t)}))}))),n.push(new Promise((function(e,t){r.load(i.url+"buffer.json",(function(t){i.buffer=JSON.parse(t),i.loadingDatas+=50,i.eventManager.dispatchEvent({type:"progress",progress:.5*i.loadingDatas/i.datas}),e(t)}))}))),Promise.all(n).then((function(){setTimeout((function(){i.parseSite(i.campus,!0),Promise.all(i.pendingRoom).then((function(){e(i.campus)}))}),10)}))},i.prototype.parseSite=function(e,t){var i=this.app,r=this.json,n=a("ground",r.i,this.nodeInfo,this.gData,this.buffer,this.materialInfo,this.cache);if(n){var o=i.objectManager.create({type:"Thing",name:"Thing",parent:e});o.name=r.n,o.bimData=r,o.node.name=r.n,o.node.add(n)}t&&this.parseBuilding(e,this.json,t)},i.prototype.parseBuilding=function(e,t,i){var r=t.c,n=this.app;for(var o in r){var s=n.objectManager.create({type:"Building",name:o,parent:e}),l=a("Facade",o,this.nodeInfo,this.gData,this.buffer,this.materialInfo,this.cache);if(l){var u=n.objectManager.create({type:"Facade",name:"Facade",parent:s});u.name=r[o].n,u.bimData=r[o],u.node.name=r[o].n,u.node.add(l)}i&&this.parseBuildingstorey(s,r[o],i)}},i.prototype.parseBuildingstorey=function(e,t,i){var r=this.app,n=t.c;this.levels=Object.keys(n).length;for(var o in n){var a=r.objectManager.create({type:"Floor",name:o,parent:e});i&&this.pendingRoom.push(this.parseRoom(a,n[o],o))}},i.prototype.parseRoom=function(e,t,i){var r=this,o=t.c,s=new THREE.Group;return e.wallNode=s,new Promise((function(t,s){setTimeout((function(){var s=[];for(var l in o){var u=a(n(o[l]),l,r.nodeInfo,r.gData,r.buffer,r.materialInfo,r.cache,i,o[l]);s.push(u)}var c=s;r.loadingLevels++,function(e,t,i){for(var r={},n={},o=0,a=e.length;o<a;o++){var s=e[o];if("Wall"===(l=s._thingType))r[s.material.uuid]||(r[s.material.uuid]=[]),(h=s.geometry.clone()).applyMatrix(s.matrix),r[s.material.uuid].push(h),n[s.material.uuid]=s.material;else if(l){var l,u=i.objectManager.create({type:l,name:o,parent:t});u.name=s.name,u.bimData=s.bimData,(l=u.node).name=s.name,l.add(s)}}for(var c in r){var h=THREE.MergeBufferGeometryUtils.mergeBufferGeometries(r[c]);s=new THREE.Mesh(h,n[c]);t.node.add(s)}}(c,e,r.app),r.eventManager.dispatchEvent({type:"progress",progress:.5+.5*r.loadingLevels/r.levels}),t(c)}),0)}))};var r={IfcSite:"Campus",IfcBuilding:"Building",IfcBuildingStorey:"Floor",IfcWall:"Wall",IfcBuildingElementProxy:"Thing",IfcRamp:"Thing",IfcStair:"Stair",IfcDoor:"Door",IfcSlab:"Thing",IfcWallStandardCase:"Wall",IfcCurtainWall:"Wall",IfcWindow:"Wall"};function n(e){for(var t in r)if(-1!==e.t.indexOf(t))return r[t];return"Wall"}var o=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,color:new THREE.Color(1,1,1)});function a(e,t,i,r,n,a,l,u,c){var h,p=l.instancedBuffer;if(i[t]){var d=i[t];if(d.g){if((h=function(e,t,i,r,n){var a,l,u=n.materialBuffer,c=n.geometryBuffer,h=c.get(e.g),p=t[e.g],d=[];if(e.m)for(var f=0;f<e.m.length;f++)d.push(s(e.m[f],r,u));if(p){var m=p.c;if(m&&(a=m),!h){var g=p.ii,v=p.iv,y=p.in;(h=new THREE.BufferGeometry).addAttribute("position",new THREE.Float32BufferAttribute(i[v],3)),h.addAttribute("normal",new THREE.Float32BufferAttribute(i[y],3)),h.setIndex(new THREE.Uint32BufferAttribute(i[g],1)),c.add(e.g,h)}if(d.length)l=d[d.length-1];else{a||(a={x:1,y:1,z:1,w:1});var b=function(e){return"default_"+e.x+"_"+e.y+"_"+e.z+"_"+e.w}(a);(l=u.get(b))||((l=o.clone()).color=new THREE.Color(a.x,a.y,a.z),a.w<1&&(l.opacity=a.w,l.transparent=!0),u.add(b,l))}return new THREE.Mesh(h,l)}}(d,r,n,a,l)).name=d.n,h._thingType=e,h.bimData=c,d.tf){var f=d.tf,m=new THREE.Matrix4;f[12]/=1e3,f[13]/=1e3,f[14]/=1e3,m.fromArray(f),h.applyMatrix(m)}if(void 0!==u)return p.add(u+":"+e+":"+d.g,h),h}}else console.log(t+"这个node没有找到");return h}function s(e,t,i){var r=i.get(e);if(!r){var n=t[e];if(!n)return void console.log(e+"数据查找不到");var o=n.type||"MeshPhongMaterial",a=n.parameters;r=new THREE[o]({color:new THREE.Color(a.color[0],a.color[1],a.color[2]),side:a.side,opacity:1-a.transparency,shininess:a.shininess,transparent:!0}),i.add(e,r)}return r}return e}(),THREE.MergeBufferGeometryUtils={computeTangents:function(e){var t=e.index,i=e.attributes;if(null!==t&&void 0!==i.position&&void 0!==i.normal&&void 0!==i.uv){var r=t.array,n=i.position.array,o=i.normal.array,a=i.uv.array,s=n.length/3;void 0===i.tangent&&e.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*s),4));for(var l=i.tangent.array,u=[],c=[],h=0;h<s;h++)u[h]=new THREE.Vector3,c[h]=new THREE.Vector3;var p=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Vector2,g=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector3,b=new THREE.Vector3,_=e.groups;0===_.length&&(_=[{start:0,count:r.length}]);for(var x=0,E=_.length;x<E;++x)for(var w=F=(j=_[x]).start,T=F+j.count;w<T;w+=3)O(r[w+0],r[w+1],r[w+2]);var S,A,M,C=new THREE.Vector3,R=new THREE.Vector3,D=new THREE.Vector3,P=new THREE.Vector3;for(x=0,E=_.length;x<E;++x){var j,F;for(w=F=(j=_[x]).start,T=F+j.count;w<T;w+=3)k(r[w+0]),k(r[w+1]),k(r[w+2])}}else console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function O(e,t,i){p.fromArray(n,3*e),d.fromArray(n,3*t),f.fromArray(n,3*i),m.fromArray(a,2*e),g.fromArray(a,2*t),v.fromArray(a,2*i);var r=d.x-p.x,o=f.x-p.x,s=d.y-p.y,l=f.y-p.y,h=d.z-p.z,_=f.z-p.z,x=g.x-m.x,E=v.x-m.x,w=g.y-m.y,T=v.y-m.y,S=1/(x*T-E*w);y.set((T*r-w*o)*S,(T*s-w*l)*S,(T*h-w*_)*S),b.set((x*o-E*r)*S,(x*l-E*s)*S,(x*_-E*h)*S),u[e].add(y),u[t].add(y),u[i].add(y),c[e].add(b),c[t].add(b),c[i].add(b)}function k(e){D.fromArray(o,3*e),P.copy(D),A=u[e],C.copy(A),C.sub(D.multiplyScalar(D.dot(A))).normalize(),R.crossVectors(P,A),M=R.dot(c[e]),S=M<0?-1:1,l[4*e]=C.x,l[4*e+1]=C.y,l[4*e+2]=C.z,l[4*e+3]=S}},mergeBufferGeometries:function(e){for(var t=null!==e[0].index,i=new Set(Object.keys(e[0].attributes)),r=new Set(Object.keys(e[0].morphAttributes)),n={},o={},a=new THREE.BufferGeometry,s=0;s<e.length;++s){var l=e[s];if(t!==(null!==l.index))return null;for(var u in l.attributes){if(!i.has(u))return null;void 0===n[u]&&(n[u]=[]),n[u].push(l.attributes[u])}for(var u in l.morphAttributes){if(!r.has(u))return null;void 0===o[u]&&(o[u]=[]),o[u].push(l.morphAttributes[u])}void 0!==l.userData&&(a.userData=a.userData||{},a.userData.mergedUserData=a.userData.mergedUserData||[],a.userData.mergedUserData.push(l.userData))}if(t){var c=0,h=[];for(s=0;s<e.length;++s){var p=e[s].index;if(c>0){p=p.clone();for(var d=0;d<p.count;++d)p.setX(d,p.getX(d)+c)}h.push(p),c+=e[s].attributes.position.count}var f=this.mergeBufferAttributes(h);if(!f)return null;a.index=f}for(var u in n){var m=this.mergeBufferAttributes(n[u]);if(!m)return null;a.addAttribute(u,m)}for(var u in o){var g=o[u][0].length;if(0===g)break;a.morphAttributes=a.morphAttributes||{},a.morphAttributes[u]=[];for(s=0;s<g;++s){var v=[];for(d=0;d<o[u].length;++d)v.push(o[u][d][s]);var y=this.mergeBufferAttributes(v);if(!y)return null;a.morphAttributes[u].push(y)}}return a},mergeBufferAttributes:function(e){for(var t,i,r,n=0,o=0;o<e.length;++o){var a=e[o];if(a.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=a.array.constructor),t!==a.array.constructor)return null;if(void 0===i&&(i=a.itemSize),i!==a.itemSize)return null;if(void 0===r&&(r=a.normalized),r!==a.normalized)return null;n+=a.array.length}for(var s=new t(n),l=0,u=0;u<e.length;++u)s.set(e[u].array,l),l+=e[u].array.length;return new THREE.BufferAttribute(s,i,r)}},SimpleIDW.getInstance=function(){var e=null;return function(){return e||(e=new SimpleIDW),e}}(),SimpleIDW.prototype={defaultCellSize:10,defaultGradient:{0:"#000066",.1:"blue",.2:"cyan",.3:"lime",.4:"yellow",.5:"orange",.6:"red",.7:"Maroon",.8:"#660066",.9:"#990099",1:"#ff66ff"},data:function(e){return this.data!==e&&(this._data=e,this._dataDirty=!0),this},add:function(e){return this._data.push(e),this._dataDirty=!0,this},clear:function(){return this._data=[],this._dataDirty=!0,this},canvas:function(){return this._canvas},setCanvasSize:function(e,t){return this._canvasWidth===e&&this._canvasHeight===t||(this._canvasWidth=this._canvas.width=e,this._canvasHeight=this._canvas.height=t,this._dataDirty=!0),this},setAreaSize:function(e,t){return this._areaWidth===e&&this._areaHeight===t||(this._areaWidth=e,this._areaHeight=t,this._dataDirty=!0),this},min:function(e){return this._min!==e&&(this._min=e),this},max:function(e){return this.max!==e&&(this._max=e),this},alpha:function(e){return this._alpha=e,this},radius:function(e){return this._radius=e,this},opacity:function(e){return this._opacity!==e&&(this._opacity=e),this},exp:function(e){return this._exp=e,this},cellSize:function(e){var t=this._cell=document.createElement("canvas"),i=t.getContext("2d");return this._r=e,t.width=t.height=e,i.beginPath(),i.rect(0,0,e,e),i.fill(),i.closePath(),this},resize:function(){this._canvasWidth=this._canvas.width,this._canvasWidth=this._canvas.height},gradient:function(e){var t=document.createElement("canvas"),i=t.getContext("2d"),r=i.createLinearGradient(0,0,0,256);for(var n in t.width=1,t.height=256,e)r.addColorStop(+n,e[n]);return i.fillStyle=r,i.fillRect(0,0,1,256),this._grad=i.getImageData(0,0,1,256).data,this},_transformData:function(){var e=this._canvasWidth/this._areaWidth,t=this._canvasHeight/this._areaHeight,i=this;this._data.forEach((function(r){var n=r[0],o=r[1];n=n*e+i._canvasWidth/2,o=o*t+i._canvasHeight/2,i._transformedData.push([n,o,r[2]])}))},_redraw:function(){var e,t,i,r,n,o,a,s=[],l=this._r,u=this._exp,c=this._max,h=this._min,p=l/2,d=Math.ceil(this._canvasWidth/l)+1,f=Math.ceil(this._canvasHeight/l)+1;if(this._dataDirty&&this._transformData(),0!==this._transformedData.length){for(e=0,t=f;e<t;e++)for(r=0,n=d;r<n;r++){var m=e*l,g=r*l,v=0,y=0;for(o=0,a=this._transformedData.length;o<a;o++){var b=[g-p,m-p],_=this._transformedData[o],x=Math.sqrt(Math.pow(_[0]-b[0],2)+Math.pow(_[1]-b[1],2)),E=_[2];if(0===x){v=E,y=1;break}x>this._radius&&(v+=0,y+=0);var w=Math.pow(x,u);v+=E/w,y+=1/w}if(i=[r*l,e*l,v/y]){let e=Math.min(i[2],c);e=Math.max(h,e),s.push([Math.round(i[0]),Math.round(i[1]),e])}}this.data(s).draw(),this._frame=null}},draw:function(){this._cell||this.cellSize(this.defaultCellSize),this._grad||this.gradient(this.defaultGradient);var e=this._ctx;e.clearRect(0,0,this._canvasWidth,this._canvasHeight);for(var t,i=0,r=this._data.length;i<r;i++)t=this._data[i],e.globalAlpha=(t[2]-this._min)/this._max,e.drawImage(this._cell,t[0]-this._r,t[1]-this._r);var n=e.getImageData(0,0,this._canvasWidth,this._canvasHeight);return this._colorize(n.data,this._grad,this._opacity),e.putImageData(n,0,0),this},_colorize:function(e,t,i){for(var r,n=0,o=e.length;n<o;n+=4)r=4*e[n+3],e[n]=t[r],e[n+1]=t[r+1],e[n+2]=t[r+2],e[n+3]=256*i}};var MSPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};function SimpleHeatmap(e){this._canvas="string"==typeof e?document.getElementById(e):e,void 0===this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=128,this._canvas.height=128),this._ctx=this._canvas.getContext("2d"),this._max=1,this._min=0,this._dataDirty=!0,this._data=[],this._transformedData=[],this._canvasWidth=this._areaWidth=this._canvas.width,this._canvasHeight=this._areaHeight=this._canvas.height,this._alpha=!1,this._grad={};var t=this._createCanvas();t.width=1,t.height=256,this._gradCtx=t.getContext("2d"),this._gradCache={},this._gradData=null,this._r=0,this._radius=0,this._blur=0,this._circle=this._createCanvas(),this._cirCtx=this._circle.getContext("2d")}"function"==typeof define&&define.amd?define("spe",MSPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=MSPE),MSPE.shaderChunks={defines:[].join("\n"),uniforms:["uniform sampler2D tex;"].join("\n"),attributes:["attribute vec3 mcol0;","attribute vec3 mcol1;","attribute vec3 mcol2;","attribute vec3 mcol3;","attribute vec4 color;"].join("\n"),varyings:["varying vec2 vUv;","varying vec4 varyColor;"].join("\n")},MSPE.shaders={vertex:[THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,MSPE.shaderChunks.uniforms,MSPE.shaderChunks.attributes,MSPE.shaderChunks.varyings,"void main()","{","\tmat4 matrix = mat4(","\t\tvec4( mcol0, 0 ),","\t\tvec4( mcol1, 0 ),","\t\tvec4( mcol2, 0 ),","\t\tvec4( mcol3, 1 )","\t);","\tvaryColor = color;","   vec4 mvPosition = modelViewMatrix * matrix * vec4( position, 1.0 );","   vUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,MSPE.shaderChunks.uniforms,MSPE.shaderChunks.varyings,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"    gl_FragColor = varyColor * texture2D(tex, vUv);",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},MSPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,i){"use strict";return typeof e===t?e:i},ensureArrayTypedArg:function(e,t,i){"use strict";if(Array.isArray(e)){for(var r=e.length-1;r>=0;--r)if(typeof e[r]!==t)return i;return e}return this.ensureTypedArg(e,t,i)},ensureInstanceOf:function(e,t,i){"use strict";return void 0!==t&&e instanceof t?e:i},ensureArrayInstanceOf:function(e,t,i){"use strict";if(Array.isArray(e)){for(var r=e.length-1;r>=0;--r)if(void 0!==t&&e[r]instanceof t==!1)return i;return e}return this.ensureInstanceOf(e,t,i)},ensureValueOverLifetimeCompliance:function(e,t,i){"use strict";t=t||3,i=i||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);var r=this.clamp(e._value.length,t,i),n=this.clamp(e._spread.length,t,i),o=Math.max(r,n);e._value.length!==o&&(e._value=this.interpolateArray(e._value,o)),e._spread.length!==o&&(e._spread=this.interpolateArray(e._spread,o))},interpolateArray:function(e,t){"use strict";for(var i=e.length,r=["function"==typeof e[0].clone?e[0].clone():e[0]],n=(i-1)/(t-1),o=1;o<t-1;++o){var a=o*n,s=Math.floor(a),l=Math.ceil(a),u=a-s;r[o]=this.lerpTypeAgnostic(e[s],e[l],u)}return r.push("function"==typeof e[i-1].clone?e[i-1].clone():e[i-1]),r},clamp:function(e,t,i){"use strict";return Math.max(t,Math.min(e,i))},zeroToEpsilon:function(e,t){"use strict";var i=e;return i=t?1e-5*Math.random()*10:1e-5,e<0&&e>-1e-5&&(i=-i),i},lerpTypeAgnostic:function(e,t,i){"use strict";var r,n=this.types;return typeof e==n.NUMBER&&typeof t==n.NUMBER?e+(t-e)*i:e instanceof THREE.Vector2&&t instanceof THREE.Vector2||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&null==e.z&&null==e.z&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&null==t.z&&null==t.z?(e instanceof THREE.Vector2?r=e.clone():((r={}).x=e.x,r.y=e.y),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r):e instanceof THREE.Vector3&&t instanceof THREE.Vector3||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&null==e.w&&null==e.w&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&null==t.w&&null==t.w?(e instanceof THREE.Vector3?r=e.clone():((r={}).x=e.x,r.y=e.y,r.z=e.z),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r.z=this.lerp(e.z,t.z,i),r):e instanceof THREE.Vector4&&t instanceof THREE.Vector4||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&typeof e.w==n.NUMBER&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&typeof t.w==n.NUMBER?(e instanceof THREE.Vector4?r=e.clone():((r={}).x=e.x,r.y=e.y,r.z=e.z,r.w=e.w),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r.z=this.lerp(e.z,t.z,i),r.w=this.lerp(e.w,t.w,i),r):e instanceof THREE.Color&&t instanceof THREE.Color||typeof e.r==n.NUMBER&&typeof e.g==n.NUMBER&&typeof e.b==n.NUMBER&&typeof t.r==n.NUMBER&&typeof t.g==n.NUMBER&&typeof t.b==n.NUMBER?(e instanceof THREE.Color?r=e.clone():((r={}).r=e.r,r.g=e.g,r.b=e.b),r.r=this.lerp(e.r,t.r,i),r.g=this.lerp(e.g,t.g,i),r.b=this.lerp(e.b,t.b,i),r):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,i){"use strict";return e+(t-e)*i},roundToNearestMultiple:function(e,t){"use strict";var i;return 0===t?e:0===(i=Math.abs(e)%t)?e:e<0?-(Math.abs(e)-i):e+t-i},arrayValuesAreEqual:function(e){"use strict";for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){"use strict";return e+t*(Math.random()-.5)},randomVector3:function(e,t,i,r,n){"use strict";var o=i.x+(Math.random()*r.x-.5*r.x),a=i.y+(Math.random()*r.y-.5*r.y),s=i.z+(Math.random()*r.z-.5*r.z);n&&(o=.5*-n.x+this.roundToNearestMultiple(o,n.x),a=.5*-n.y+this.roundToNearestMultiple(a,n.y),s=.5*-n.z+this.roundToNearestMultiple(s,n.z)),e.typedArray.setVec3Components(t,o,a,s)},getRandomVector3:function(e,t,i){"use strict";var r=e.x+(Math.random()*t.x-.5*t.x),n=e.y+(Math.random()*t.y-.5*t.y),o=e.z+(Math.random()*t.z-.5*t.z);return i&&(r=.5*-i.x+this.roundToNearestMultiple(r,i.x),n=.5*-i.y+this.roundToNearestMultiple(n,i.y),o=.5*-i.z+this.roundToNearestMultiple(o,i.z)),new THREE.Vector3(r,n,o)},randomColor:function(e,t,i,r){"use strict";var n=i.r+Math.random()*r.x,o=i.g+Math.random()*r.y,a=i.b+Math.random()*r.z;n=this.clamp(n,0,1),o=this.clamp(o,0,1),a=this.clamp(a,0,1),e.typedArray.setVec3Components(t,n,o,a)},randomColorAsHex:function(){"use strict";var e=new THREE.Color;return function(t,i,r,n){for(var o=r.length,a=[],s=0;s<o;++s){var l=n[s];e.copy(r[s]),e.r+=Math.random()*l.x-.5*l.x,e.g+=Math.random()*l.y-.5*l.y,e.b+=Math.random()*l.z-.5*l.z,e.r=this.clamp(e.r,0,1),e.g=this.clamp(e.g,0,1),e.b=this.clamp(e.b,0,1),a.push(e.getHex())}t.typedArray.setVec4Components(i,a[0],a[1],a[2],a[3])}}(),getRandomColor:function(e,t){"use strict";for(var i=e.length,r=[],n=0;n<i;++n){var o=t[n],a=new THREE.Color;a.copy(e[n]),a.r+=Math.random()*o.x-.5*o.x,a.g+=Math.random()*o.y-.5*o.y,a.b+=Math.random()*o.z-.5*o.z,a.r=this.clamp(a.r,0,1),a.g=this.clamp(a.g,0,1),a.b=this.clamp(a.b,0,1),r.push(a)}return r},randomVector3OnSphere:function(e,t,i,r,n,o,a,s){"use strict";var l=2*Math.random()-1,u=6.2832*Math.random(),c=Math.sqrt(1-l*l),h=this.randomFloat(r,n),p=0,d=0,f=0;a&&(h=Math.round(h/a)*a),p=c*Math.cos(u)*h,d=c*Math.sin(u)*h,f=l*h,p*=o.x,d*=o.y,f*=o.z,p+=i.x,d+=i.y,f+=i.z,e.typedArray.setVec3Components(t,p,d,f)},getRandomVector3OnSphere:function(e,t,i,r,n,o){"use strict";var a=2*Math.random()-1,s=6.2832*Math.random(),l=Math.sqrt(1-a*a),u=this.randomFloat(t,i),c=0,h=0,p=0;return n&&(u=Math.round(u/n)*n),c=l*Math.cos(s)*u,h=l*Math.sin(s)*u,p=a*u,c*=r.x,h*=r.y,p*=r.z,c+=e.x,h+=e.y,p+=e.z,new THREE.Vector3(c,h,p)},seededRandom:function(e){var t=1e4*Math.sin(e);return t-(0|t)},randomVector3OnDisc:function(e,t,i,r,n,o,a){"use strict";var s=6.2832*Math.random(),l=Math.abs(this.randomFloat(r,n)),u=0,c=0,h=0;a&&(l=Math.round(l/a)*a),u=Math.cos(s)*l,c=Math.sin(s)*l,u*=o.x,c*=o.y,u+=i.x,c+=i.y,h+=i.z,e.typedArray.setVec3Components(t,u,c,h)},getRandomVector3OnDisc:function(e,t,i,r,n){"use strict";var o=6.2832*Math.random(),a=Math.abs(this.randomFloat(t,i)),s=0,l=0,u=0;return n&&(a=Math.round(a/n)*n),s=Math.cos(o)*a,l=Math.sin(o)*a,s*=r.x,l*=r.y,s+=e.x,l+=e.y,u+=e.z,new THREE.Vector3(s,l,u)},randomDirectionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,i,r,n,o,a,s,l){e.copy(a),e.x-=r,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(i,e.x,e.y,e.z)}}(),getRandomDirectionVector3OnSphere:function(e,t,i){"use strict";var r=new THREE.Vector3;return r.copy(e),r.x-=this.randomFloat(0,1),r.y-=this.randomFloat(0,1),r.z-=this.randomFloat(0,1),r.normalize().multiplyScalar(-this.randomFloat(t,i)),r},getDirectionVector3OnSphere:function(e,t,i,r,n,o){"use strict";var a=new THREE.Vector3;a.copy(e),a.normalize().multiplyScalar(this.randomFloat(i,r));var s=this.getRandomVector3(n,o);return a.add(s),a},randomDirectionVector3OnDisc:function(){"use strict";var e=new THREE.Vector3;return function(t,i,r,n,o,a,s,l){e.copy(a),e.x-=r,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(i,e.x,e.y,0)}}(),getPackedRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Color,r=new THREE.Vector3(1,1,1);return function(n,o){return e.copy(n).normalize(),t.copy(o).normalize(),e.x+=.5*-o.x+Math.random()*o.x,e.y+=.5*-o.y+Math.random()*o.y,e.z+=.5*-o.z+Math.random()*o.z,e.normalize().add(r).multiplyScalar(.5),i.setRGB(e.x,e.y,e.z),i.getHex()}}(),getRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,i=(new THREE.Color,new THREE.Vector3(1,1,1));return function(r,n){return e.copy(r).normalize(),t.copy(n).normalize(),e.x+=.5*-n.x+Math.random()*n.x,e.y+=.5*-n.y+Math.random()*n.y,e.z+=.5*-n.z+Math.random()*n.z,e.normalize().add(i).multiplyScalar(.5),e}}(),setMatrix:function(){var e=new THREE.Quaternion;return function(t,i,r,n){e.setFromEuler(i,!1),n.compose(t,e,r)}}(),clock:function(){var e=new THREE.Clock;return function(){return e}}()},MSPE.Group=function(e){"use strict";var t=MSPE.utils,i=t.types;if((e=t.ensureTypedArg(e,i.OBJECT,{})).texture=t.ensureTypedArg(e.texture,i.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,i.NUMBER,.016),this.texture=t.ensureInstanceOf(e.texture.value,THREE.Texture,null),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,i.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,i.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,i.NUMBER,1e3),this.vec4Quaternion=t.ensureInstanceOf(e.vec4Quaternion,THREE.Vector4,new THREE.Vector4(0,0,0,1)),this.vec4Quaternion=this.vec4Quaternion.normalize(),null==e.bufferGeometry||null==e.bufferGeometry||!(e.bufferGeometry instanceof THREE.BufferGeometry))return console.error("[MSPE.js] : [MSPE.Group] : error options.bufferGeometry!"),null;this.instancedBufferGeometry=null,this.mesh=null,this.materialList=[],this.geometryList=[],this.bufferGeometry=e.bufferGeometry,this.bufferGeometry=this.bufferGeometry.toNonIndexed(),this.bufferGeometry.computeBoundingBox(),this.geometryList.push(this.bufferGeometry),this.instancedBufferGeometry=new THREE.InstancedBufferGeometry,this.geometryList.push(this.instancedBufferGeometry);var r=this.bufferGeometry.attributes.position.clone();if(this.instancedBufferGeometry.setAttribute("position",r),null!=this.bufferGeometry.attributes.uv&&null!=this.bufferGeometry.attributes.uv){var n=this.bufferGeometry.attributes.uv.clone();this.instancedBufferGeometry.setAttribute("uv",n)}this.instanceBuffer=new THREE.InstancedInterleavedBuffer(new Float32Array(16*this.maxParticleCount),16,1).setUsage(THREE.DynamicDrawUsage),this.mcol0=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,0),this.mcol1=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,3),this.mcol2=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,6),this.mcol3=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,9),this.colors=new THREE.InterleavedBufferAttribute(this.instanceBuffer,4,12);!function(){var e=new THREE.Vector3(0,0,0),t=new THREE.Euler(0,0,0),i=new THREE.Quaternion,r=new THREE.Vector3(1,1,1)}();for(var o=new THREE.Matrix4,a=o.elements,s=0,l=this.mcol0.count;s<l;s++){var u=new THREE.Vector3(0,0,0),c=new THREE.Euler(0,0,0),h=new THREE.Vector3(0,0,0);t.setMatrix(u,c,h,o),this.mcol0.setXYZ(s,a[0],a[1],a[2]),this.mcol1.setXYZ(s,a[4],a[5],a[6]),this.mcol2.setXYZ(s,a[8],a[9],a[10]),this.mcol3.setXYZ(s,a[12],a[13],a[14]),this.colors.setXYZW(s,1,1,1,1)}this.instancedBufferGeometry.setAttribute("mcol0",this.mcol0),this.instancedBufferGeometry.setAttribute("mcol1",this.mcol1),this.instancedBufferGeometry.setAttribute("mcol2",this.mcol2),this.instancedBufferGeometry.setAttribute("mcol3",this.mcol3),this.instancedBufferGeometry.setAttribute("color",this.colors),this.blending=t.ensureTypedArg(e.blending,i.NUMBER,THREE.AdditiveBlending),this.transparent=t.ensureTypedArg(e.transparent,i.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,i.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,i.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,i.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,i.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,i.NUMBER,300),this.emitters=[],this.emitterIDs=[],this.particleCount=0,this.uniforms={tex:{type:"t",value:this.texture}},this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:MSPE.shaders.vertex,fragmentShader:MSPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,fog:this.fog}),this.materialList.push(this.material),this.mesh=new THREE.Mesh(this.instancedBufferGeometry,this.material),this.bEnableTrail=t.ensureTypedArg(e.bEnableTrail,i.BOOLEAN,!1),this.bEnableTrail&&(this.textureTrail=t.ensureInstanceOf(e.textureTrail,THREE.Texture,null),null!=this.textureTrail&&null!=this.textureTrail||(console.error("[MSPE.js] : [MSPE.Group] : error options.textureTrail!"),this.textureTrail=this.texture),this.fTrailLife=parseFloat(t.ensureTypedArg(e.fTrailLife,i.NUMBER,1)),this.fTrailWidthStart=parseFloat(t.ensureTypedArg(e.fTrailWidthStart,i.NUMBER,1)),this.fTrailWidthEnd=parseFloat(t.ensureTypedArg(e.fTrailWidthEnd,i.NUMBER,1)))},MSPE.Group.constructor=MSPE.Group,MSPE.Group.prototype._updateDefines=function(){},MSPE.Group.prototype.addEmitter=function(e){"use strict";if(e instanceof MSPE.Emitter!=!1)if(this.emitterIDs.indexOf(e.uuid)>-1)console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : Emitter already exists in this group. Will not add again.");else{if(null===e.group){var t,i=this.particleCount;return t=Math.min(i+e.particleCount,this.maxParticleCount),this.particleCount=t,e.particleCount=t-i,e.activationStart=i,e.activationEnd=e.activationStart+e.particleCount,e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e.attach(this),this.emitters.push(e),this.emitterIDs.push(e.uuid),this.material.needsUpdate=!0,this.instanceBuffer.needsUpdate=!0,this}console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : Emitter already belongs to another group. Will not add to requested group.")}else console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : emitter argument must be instance of MSPE.Emitter;")},MSPE.Group.prototype.removeEmitter=function(e){"use strict";var t=this.emitterIDs.indexOf(e.uuid);e instanceof MSPE.Emitter!=!1?-1!==t?(this.emitters[t].dispose(),this.emitters.splice(t,1),this.emitterIDs.splice(t,1),this.particleCount-=e.particleCount,this.material.needsUpdate=!0,this.instanceBuffer.needsUpdate=!0,e.group=null):console.error("[MSPE.js] : [MSPE.Group] : [removeEmitter] : Emitter does not exist in this group. Will not remove."):console.error("[MSPE.js] : [MSPE.Group] : [removeEmitter] : emitter argument must be instance of MSPE.Emitter;")},MSPE.Group.prototype.tick=function(e,t){"use strict";var i=this.emitters,r=i.length,n=e||this.fixedTimeStep;if(0!==r){for(var o=0;o<r;++o)i[o].tick(n,t);this.instanceBuffer.needsUpdate=!0}},MSPE.Group.prototype.dispose=function(){"use strict";return this.materialList.forEach((function(e){e.dispose()})),this.geometryList.forEach((function(e){e.dispose()})),this.materialList=[],this.geometryList=[],this},MSPE.Emitter=function(e){"use strict";var t=MSPE.utils,i=t.types,r=MSPE.valueOverLifetimeLength;for(var n in(e=t.ensureTypedArg(e,i.OBJECT,{})).position=t.ensureTypedArg(e.position,i.OBJECT,{}),e.velocity=t.ensureTypedArg(e.velocity,i.OBJECT,{}),e.acceleration=t.ensureTypedArg(e.acceleration,i.OBJECT,{}),e.radius=t.ensureTypedArg(e.radius,i.OBJECT,{}),e.drag=t.ensureTypedArg(e.drag,i.OBJECT,{}),e.rotation=t.ensureTypedArg(e.rotation,i.OBJECT,{}),e.color=t.ensureTypedArg(e.color,i.OBJECT,{}),e.opacity=t.ensureTypedArg(e.opacity,i.OBJECT,{}),e.size=t.ensureTypedArg(e.size,i.OBJECT,{}),e.angle=t.ensureTypedArg(e.angle,i.OBJECT,{}),e.wiggle=t.ensureTypedArg(e.wiggle,i.OBJECT,{}),e.maxAge=t.ensureTypedArg(e.maxAge,i.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.type=t.ensureTypedArg(e.type,i.NUMBER,SPE.distributions.BOX),this.position={_value:t.ensureInstanceOf(e.position.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.position.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1),_radius:t.ensureTypedArg(e.position.radius,i.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.position.distributionClamp,i.NUMBER,0)},this.velocity={_value:t.ensureInstanceOf(e.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.velocity.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.velocity.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.velocity.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.velocity.randomise,i.BOOLEAN,!1),_radius:t.ensureTypedArg(e.velocity.radius,i.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.velocity.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.velocity.distributionClamp,i.NUMBER,0)},this.acceleration={_value:t.ensureInstanceOf(e.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.acceleration.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.acceleration.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.acceleration.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.acceleration.randomise,i.BOOLEAN,!1),_radius:t.ensureTypedArg(e.acceleration.radius,i.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.acceleration.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.acceleration.distributionClamp,i.NUMBER,0)},this.drag={_value:t.ensureTypedArg(e.drag.value,i.NUMBER,0),_spread:t.ensureTypedArg(e.drag.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.drag.randomise,i.BOOLEAN,!1)},this.wiggle={_value:t.ensureTypedArg(e.wiggle.value,i.NUMBER,0),_spread:t.ensureTypedArg(e.wiggle.spread,i.NUMBER,0)},this.rotation={_axis:t.ensureInstanceOf(e.rotation.axis,THREE.Vector3,new THREE.Vector3(0,1,0)),_axisSpread:t.ensureInstanceOf(e.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:t.ensureTypedArg(e.rotation.angle,i.NUMBER,0),_angleSpread:t.ensureTypedArg(e.rotation.angleSpread,i.NUMBER,0),_static:t.ensureTypedArg(e.rotation.static,i.BOOLEAN,!1),_center:t.ensureInstanceOf(e.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1)},this.maxAge={_value:t.ensureTypedArg(e.maxAge.value,i.NUMBER,2),_spread:t.ensureTypedArg(e.maxAge.spread,i.NUMBER,0)},this.color={_value:t.ensureArrayInstanceOf(e.color.value,THREE.Color,new THREE.Color),_spread:t.ensureArrayInstanceOf(e.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.opacity={_value:t.ensureArrayTypedArg(e.opacity.value,i.NUMBER,1),_spread:t.ensureArrayTypedArg(e.opacity.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.size={_value:t.ensureArrayTypedArg(e.size.value,i.NUMBER,1),_spread:t.ensureArrayTypedArg(e.size.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.angle={_value:t.ensureArrayTypedArg(e.angle.value,i.NUMBER,0),_spread:t.ensureArrayTypedArg(e.angle.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.SHOULD_DRAG_PARTICLES=!!Math.max(this.drag._value,this.drag._spread),this.SHOULD_WIGGLE_PARTICLES=!!Math.max(this.wiggle._value,this.wiggle._spread),this.SHOULD_ROTATE_PARTICLES=!!Math.max(this.rotation._angle,this.rotation._angleSpread),this.SHOULD_COLORIZE_PARTICLES=!0,this.SHOULD_SIZE_PARTICLES=!0,this.SHOULD_ANGLE_PARTICLES=!0,this.particleCount=t.ensureTypedArg(e.particleCount,i.NUMBER,100),this.objPool=new MSPE.BufferAttributeObjPool({iCount:this.particleCount}),this.duration=t.ensureTypedArg(e.duration,i.NUMBER,null),this.isStatic=t.ensureTypedArg(e.isStatic,i.BOOLEAN,!1),this.isLookAtCamera=t.ensureTypedArg(e.isLookAtCamera,i.BOOLEAN,!1),this.isLookAtCameraOnlyY=t.ensureTypedArg(e.isLookAtCameraOnlyY,i.BOOLEAN,!1),this.activeMultiplier=t.ensureTypedArg(e.activeMultiplier,i.NUMBER,1),this.direction=t.ensureTypedArg(e.direction,i.NUMBER,1),this.alive=t.ensureTypedArg(e.alive,i.BOOLEAN,!0),this.particlesPerSecond=0,this.age=0,this.activationStart=t.ensureTypedArg(e.activationStart,i.NUMBER,0),this.activationEnd=this.activationStart+this.particleCount,this._calculatePPSValue(this.maxAge._value+this.maxAge._spread),this.arrayParticles=new Array,this.group=null,this.bInitSpeed=!1,this.bInitSpeedAcc=!1,this.resetFlags={position:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)||t.ensureTypedArg(e.radius.randomise,i.BOOLEAN,!1),velocity:t.ensureTypedArg(e.velocity.randomise,i.BOOLEAN,!1),acceleration:t.ensureTypedArg(e.acceleration.randomise,i.BOOLEAN,!1)||t.ensureTypedArg(e.drag.randomise,i.BOOLEAN,!1),rotation:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),rotationCenter:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),size:t.ensureTypedArg(e.size.randomise,i.BOOLEAN,!1),color:t.ensureTypedArg(e.color.randomise,i.BOOLEAN,!1),opacity:t.ensureTypedArg(e.opacity.randomise,i.BOOLEAN,!1),angle:t.ensureTypedArg(e.angle.randomise,i.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"},this.updateMap)this.updateMap.hasOwnProperty(n)&&(this.updateCounts[this.updateMap[n]]=0,this.updateFlags[this.updateMap[n]]=!1,this._createGetterSetters(this[n],n));t.ensureValueOverLifetimeCompliance(this.color,r,r),t.ensureValueOverLifetimeCompliance(this.opacity,r,r),t.ensureValueOverLifetimeCompliance(this.size,r,r),t.ensureValueOverLifetimeCompliance(this.angle,r,r)},MSPE.Emitter.constructor=MSPE.Emitter,MSPE.Emitter.prototype._createGetterSetters=function(e,t){"use strict";var i=this;for(var r in e)if(e.hasOwnProperty(r)){var n=r.replace("_","");Object.defineProperty(e,n,{get:function(e){return function(){return this[e]}}(r),set:function(e){return function(r){var n=i.updateMap[t],o=this[e],a=MSPE.valueOverLifetimeLength;"_rotationCenter"===e?(i.updateFlags.rotationCenter=!0,i.updateCounts.rotationCenter=0):"_randomise"===e?i.resetFlags[n]=r:(i.updateFlags[n]=!0,i.updateCounts[n]=0),this[e]=r,Array.isArray(o)&&MSPE.utils.ensureValueOverLifetimeCompliance(i[t],a,a)}}(r)})}},MSPE.Emitter.prototype.attach=function(e){this.group=e},MSPE.Emitter.prototype._calculatePPSValue=function(e){"use strict";var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e},MSPE.Emitter.prototype._activateParticles=function(e,t){"use strict";this.direction;for(var i=0;i<e;++i){var r=new MSPE.Particle({emitter:this});null!=r&&null!=r&&this.arrayParticles.push(r)}},MSPE.Emitter.prototype.tick=function(e,t){"use strict";if(!this.isStatic)if(!1!==this.alive)if(null!==this.duration&&this.age>this.duration){for(var i=0,r=this.arrayParticles.length;i<r;++i)this.arrayParticles[i].tick(e,t),this.arrayParticles[i].alive||(this.arrayParticles[i].dispose(),this.arrayParticles.splice(i,1),r=this.arrayParticles.length,i--);this.arrayParticles.length<=0&&(this.alive=!1,this.age=0)}else{if(this.activationIndex=this.arrayParticles.length,this.activationIndex<this.particleCount){var n=this.activationIndex,o=this.particlesPerSecond*this.activeMultiplier*e,a=1===this.particleCount?n:0|n,s=Math.min(a+o,this.activationEnd)-a;s=Math.min(this.particleCount-this.activationIndex,s),this._activateParticles(s)}for(i=0,r=this.arrayParticles.length;i<r;++i)this.arrayParticles[i].tick(e,t),this.arrayParticles[i].alive||(this.arrayParticles[i].dispose(),this.arrayParticles.splice(i,1),r=this.arrayParticles.length,i--);this.age+=e}else this.age=0},MSPE.Emitter.prototype.dispose=function(){"use strict";for(var e=0,t=this.arrayParticles.length;e<t;++e)this.arrayParticles[e].dispose();this.particlesPerSecond=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.age=0,this.objPool.dispose()},MSPE.Particle=function(e){"use strict";var t=MSPE.utils,i=t.types;if(null!=(e=t.ensureTypedArg(e,i.OBJECT,{})).emitter&&null!=e.emitter&&e.emitter instanceof MSPE.Emitter){if(this.emitter=e.emitter,this.position={_value:e.emitter.position.value,_spread:e.emitter.position.spread,_spreadClamp:e.emitter.position.spreadClamp,_distribution:e.emitter.position.distribution,_randomise:e.emitter.position.randomise,_radius:e.emitter.position.radius,_radiusScale:e.emitter.position.radiusScale,_distributionClamp:e.emitter.position.distributionClamp},this.velocity={_value:e.emitter.velocity.value,_spread:e.emitter.velocity.spread,_spreadClamp:e.emitter.velocity.spreadClamp,_distribution:e.emitter.velocity.distribution,_randomise:e.emitter.velocity.randomise,_radius:e.emitter.velocity.radius,_radiusScale:e.emitter.velocity.radiusScale,_distributionClamp:e.emitter.velocity.distributionClamp},this.acceleration={_value:e.emitter.acceleration.value,_spread:e.emitter.acceleration.spread,_spreadClamp:e.emitter.acceleration.spreadClamp,_distribution:e.emitter.acceleration.distribution,_randomise:e.emitter.acceleration.randomise,_radius:e.emitter.acceleration.radius,_radiusScale:e.emitter.acceleration.radiusScale,_distributionClamp:e.emitter.acceleration.distributionClamp},this.drag={_value:e.emitter.drag.value,_spread:e.emitter.drag.spread,_randomise:e.emitter.position.randomise},this.wiggle={_value:e.emitter.wiggle.value,_spread:e.emitter.wiggle.spread},this.rotation={_axis:e.emitter.rotation.axis,_axisSpread:e.emitter.rotation.axisSpread,_angle:e.emitter.rotation.angle,_angleSpread:e.emitter.rotation.angleSpread,_static:e.emitter.rotation.static,_center:e.emitter.rotation.center,_randomise:e.emitter.position.randomise},this.maxAge={_value:e.emitter.maxAge.value,_spread:e.emitter.maxAge.spread},this.color={_value:e.emitter.color.value,_spread:e.emitter.color.spread,_randomise:e.emitter.position.randomise},this.opacity={_value:e.emitter.opacity.value,_spread:e.emitter.opacity.spread,_randomise:e.emitter.position.randomise},this.size={_value:e.emitter.size.value,_spread:e.emitter.size.spread,_randomise:e.emitter.position.randomise},this.angle={_value:e.emitter.angle.value,_spread:e.emitter.angle.spread,_randomise:e.emitter.position.randomise},this.alive=e.emitter.alive,this.age=0,this.vec3RealPosition=this._assignPositionValue(),this.vec3RealVelocity=this._assignVelocityValue(),this.vec3RealAcceleration=this._assignAccelerationValue(),this.arrayRealColor=this._assignColorValue(),this.arrayRealOpacity=this._assignOpacityAbsLifetimeValue(),this.arrayRealSize=this._assignSizeAbsLifetimeValue(),this.arrayRealAngle=this._assignAngleValue(),this.fRealDrag=t.clamp(t.randomFloat(this.drag._value,this.drag._spread),0,1),this.fRealWiggle=t.randomFloat(this.wiggle._value,this.wiggle._spread),this.fRealMaxAge=MSPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread),this.vec3RealRotationAxis=MSPE.utils.getRotationAxis(this.rotation._axis,this.rotation._axisSpread),this.fRealRotationAngle=MSPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.uuidTrial="",this.obj=this.emitter.objPool.takeAnObj(),null==this.obj||null==this.obj)return this.alive=!1,this.dispose(),null;for(var r in this.matrix=new THREE.Matrix4,this.matrixElements=this.matrix.elements,this.vec3Position=new THREE.Vector3(0,0,0),this.vec3Rotation=new THREE.Euler(0,0,0),this.vec3Scale=new THREE.Vector3(.1,.1,.1),this.obj.setUse(!0),this.iBufferIndex=this.obj.iIndex+this.emitter.activationStart,this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"},this.updateMap)this.updateMap.hasOwnProperty(r)&&(this.updateCounts[this.updateMap[r]]=0,this.updateFlags[this.updateMap[r]]=!1,this._createGetterSetters(this[r],r));return this.emitter.group.bEnableTrail&&(this.trailRenderHelper=new TrailRenderHelper,this.trailRenderHelper.onTriggerMeshInited=this.onTriggerMeshInited,this.trailRenderHelper.init({fTimeLong:this.emitter.group.fTrailLife,fTimeStart:MSPE.utils.clock().getElapsedTime(),iStep:0,fWidthStart:this.emitter.group.fTrailWidthStart,fWidthEnd:this.emitter.group.fTrailWidthEnd,shaderColor:new THREE.Vector4(1,1,1,1),shaderTexture:this.emitter.group.textureTrail,shaderTexMode:"Stretch",shaderBlending:this.emitter.group.blending,shaderTransparent:this.emitter.group.transparent,shaderAlphaTest:this.emitter.group.alphaTest,shaderDepthWrite:this.emitter.group.depthWrite,shaderDepthTest:this.emitter.group.depthTest},(function(){})),this.uuidTrial=this.trailRenderHelper.attach((function(e){}))),this}console.error("[MSPE.js] : [MSPE.Particle] : error options.emitter;")},MSPE.Particle.constructor=MSPE.Particle,MSPE.Particle.prototype.onTriggerMeshInited=function(e){this.meshTrial=e},MSPE.Particle.prototype._createGetterSetters=function(e,t){"use strict";var i=this;for(var r in e)if(e.hasOwnProperty(r)){var n=r.replace("_","");Object.defineProperty(e,n,{get:function(e){return function(){return this[e]}}(r),set:function(e){return function(r){var n=i.updateMap[t],o=this[e],a=MSPE.valueOverLifetimeLength;"_rotationCenter"===e?(i.updateFlags.rotationCenter=!0,i.updateCounts.rotationCenter=0):"_randomise"===e?i.resetFlags[n]=r:(i.updateFlags[n]=!0,i.updateCounts[n]=0),this[e]=r,Array.isArray(o)&&MSPE.utils.ensureValueOverLifetimeCompliance(i[t],a,a)}}(r)})}},MSPE.Particle.prototype.tick=function(e,t){"use strict";if(!this.emitter.isStatic){if(!1!==this.emitter.alive&&!1!==this.alive)return null!==this.emitter.duration&&this.age>this.emitter.duration?(this.alive=!1,void(this.age=0)):(this.age+=e,this.running(t),this.age>this.fRealMaxAge?(this.alive=!1,void(this.age=0)):void 0);this.age=0}},MSPE.Particle.prototype._assignPositionValue=function(){"use strict";var e=MSPE.distributions,t=MSPE.utils,i=this.position,r=i._value,n=i._spread,o=this.emitter.type,a=new THREE.Vector3(0,0,0);switch(o){case e.BOX:a=t.getRandomVector3(r,n,i._spreadClamp);break;case e.SPHERE:a=t.getRandomVector3OnSphere(r,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x,i._distributionClamp||this.particleCount);break;case e.DISC:a=t.getRandomVector3OnDisc(r,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}return a},MSPE.Particle.prototype._assignVelocityValue=function(){"use strict";var e=this.emitter.group.vec4Quaternion.clone();e=e.normalize();var t=MSPE.distributions,i=MSPE.utils,r=this.velocity,n=r._value,o=r._spread,a=this.emitter.type;this.emitter.bInitSpeed||(n=n.applyQuaternion(e),o=o.applyQuaternion(e),this.emitter.bInitSpeed=!0);var s=new THREE.Vector3(0,0,0);switch(a){case t.BOX:s=i.getRandomVector3(n,o);break;case t.SPHERE:s=i.getRandomDirectionVector3OnSphere(this.emitter.position.value,n.x,o.x);break;case t.DISC:s=i.getRandomVector3OnDisc(n,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x)}return s},MSPE.Particle.prototype._assignAccelerationValue=function(){"use strict";var e=this.emitter.group.vec4Quaternion.clone();e=e.normalize();var t=MSPE.distributions,i=MSPE.utils,r=this.acceleration,n=r._value,o=r._spread,a=this.emitter.type;this.emitter.bInitSpeedAcc||(n=n.applyQuaternion(e),o=o.applyQuaternion(e),this.emitter.bInitSpeedAcc=!0);var s=new THREE.Vector3(0,0,0);switch(a){case t.BOX:s=i.getRandomVector3(n,o);break;case t.SPHERE:s=i.getDirectionVector3OnSphere(this.vec3RealVelocity,this.emitter.position.value,this.emitter.velocity.value.y,this.emitter.velocity.spread.y,n,o);break;case t.DISC:s=i.getRandomVector3OnDisc(n,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x)}return s},MSPE.Particle.prototype._assignColorValue=function(){"use strict";return MSPE.utils.getRandomColor(this.color._value,this.color._spread)},MSPE.Particle.prototype._assignOpacityAbsLifetimeValue=function(){"use strict";var e,t,i=this.opacity,r=MSPE.utils;return t=new Array,r.arrayValuesAreEqual(i._value)&&r.arrayValuesAreEqual(i._spread)?(e=Math.abs(r.randomFloat(i._value[0],i._spread[0])),t.push(e),t.push(e),t.push(e),t.push(e)):(e=Math.abs(r.randomFloat(i._value[0],i._spread[0])),t.push(e),e=Math.abs(r.randomFloat(i._value[1],i._spread[1])),t.push(e),e=Math.abs(r.randomFloat(i._value[2],i._spread[2])),t.push(e),e=Math.abs(r.randomFloat(i._value[3],i._spread[3])),t.push(e)),t},MSPE.Particle.prototype._assignSizeAbsLifetimeValue=function(){"use strict";var e,t,i=this.size,r=MSPE.utils;return t=new Array,r.arrayValuesAreEqual(i._value)&&r.arrayValuesAreEqual(i._spread)?(e=Math.abs(r.randomFloat(i._value[0],i._spread[0])),t.push(e),t.push(e),t.push(e),t.push(e)):(e=Math.abs(r.randomFloat(i._value[0],i._spread[0])),t.push(e),e=Math.abs(r.randomFloat(i._value[1],i._spread[1])),t.push(e),e=Math.abs(r.randomFloat(i._value[2],i._spread[2])),t.push(e),e=Math.abs(r.randomFloat(i._value[3],i._spread[3])),t.push(e)),t},MSPE.Particle.prototype._assignAngleValue=function(){"use strict";var e,t=new Array,i=this.angle,r=MSPE.utils;return r.arrayValuesAreEqual(i._value)&&r.arrayValuesAreEqual(i._spread)?(e=r.randomFloat(i._value[0],i._spread[0]),t.push(e),t.push(e),t.push(e),t.push(e)):(e=r.randomFloat(i._value[0],i._spread[0]),t.push(e),e=r.randomFloat(i._value[1],i._spread[1]),t.push(e),e=r.randomFloat(i._value[2],i._spread[2]),t.push(e),e=r.randomFloat(i._value[3],i._spread[3]),t.push(e)),t},MSPE.Particle.prototype.getRotationMatrix=function(e,t){e=e.normalize();var i=Math.sin(t),r=Math.cos(t),n=1-r;return(new THREE.Matrix4).set(n*e.x*e.x+r,n*e.x*e.y-e.z*i,n*e.z*e.x+e.y*i,0,n*e.x*e.y+e.z*i,n*e.y*e.y+r,n*e.y*e.z-e.x*i,0,n*e.z*e.x-e.y*i,n*e.y*e.z+e.x*i,n*e.z*e.z+r,0,0,0,0,1)},MSPE.Particle.prototype.when_gt=function(e,t){return Math.max(Math.sign(e-t),0)},MSPE.Particle.prototype.when_lt=function(e,t){return Math.min(Math.max(1-Math.sign(e-t),0),1)},MSPE.Particle.prototype.when_eq=function(e,t){return 1-Math.abs(Math.sign(e-t))},MSPE.Particle.prototype.when_ge=function(e,t){return 1-this.when_lt(e,t)},MSPE.Particle.prototype.when_le=function(e,t){return 1-this.when_gt(e,t)},MSPE.Particle.prototype.and=function(e,t){return e*t},MSPE.Particle.prototype.or=function(e,t){return Math.min(e+t,1)},MSPE.Particle.prototype.getFloatOverLifetime=function(e,t){var i=0,r=e*(MSPE.valueOverLifetimeLength-1),n=0;i+=t[0]*this.when_eq(r,0);for(var o=0;o<MSPE.valueOverLifetimeLength-1;++o)n=o,i+=this.and(this.when_gt(r,n),this.when_le(r,n+1))*MSPE.utils.lerp(t[o],t[o+1],r-n);return i},MSPE.Particle.prototype.getColorOverLifetime=function(e,t,i,r,n){var o=new THREE.Vector3(0,0,0),a=new Array;a.push(t.r),a.push(i.r),a.push(r.r),a.push(n.r);var s=new Array;s.push(t.g),s.push(i.g),s.push(r.g),s.push(n.g);var l=new Array;return l.push(t.b),l.push(i.b),l.push(r.b),l.push(n.b),o.x=this.getFloatOverLifetime(e,a),o.y=this.getFloatOverLifetime(e,s),o.z=this.getFloatOverLifetime(e,l),o},MSPE.Particle.prototype.getRotation=function(e,t){if(0==this.fRealRotationAngle)return e;var i,r,n=new THREE.Vector3(this.vec3RealRotationAxis.x,this.vec3RealRotationAxis.y,this.vec3RealRotationAxis.z),o=new THREE.Vector3(this.rotation._center.x,this.rotation._center.y,this.rotation._center.z),a=0;a+=this.when_eq(this.rotation._static?0:1,0)*this.fRealRotationAngle,a+=this.when_gt(this.rotation._static?0:1,0)*MSPE.utils.lerp(0,this.fRealRotationAngle,t),i=o.sub(e),r=this.getRotationMatrix(n,a);var s=new THREE.Vector4(i.x,i.y,i.z,0);s.applyMatrix4(r);var l=new THREE.Vector3(s.x,s.y,s.z);return o.sub(l)},MSPE.Particle.prototype.running=function(e){var t=this.age,i=this.age/this.fRealMaxAge,r=new THREE.Vector3(this.vec3RealPosition.x,this.vec3RealPosition.y,this.vec3RealPosition.z),n=new THREE.Vector3(this.vec3RealVelocity.x,this.vec3RealVelocity.y,this.vec3RealVelocity.z),o=new THREE.Vector3(this.vec3RealAcceleration.x,this.vec3RealAcceleration.y,this.vec3RealAcceleration.z);if(this.emitter.SHOULD_DRAG_PARTICLES){var a=1-.5*i*this.fRealDrag;o=o.multiplyScalar(a)}var s=new THREE.Vector3;s.copy(n),s.multiplyScalar(t);var l=new THREE.Vector3;l.copy(o),l.multiplyScalar(t*t*.5);var u=new THREE.Vector3;if(u.copy(r),u.add(s.add(l)),this.emitter.SHOULD_WIGGLE_PARTICLES){var c=i*this.fRealWiggle*Math.PI,h=Math.sin(c),p=Math.cos(c);u.x+=h,u.y+=p,u.z+=h}if(this.emitter.SHOULD_ROTATE_PARTICLES&&(u=this.getRotation(u,i)),this.vec3Position=u,this.emitter.SHOULD_SIZE_PARTICLES){var d=this.getFloatOverLifetime(i,this.arrayRealSize);this.vec3Scale=new THREE.Vector3(d,d,d)}if(this.emitter.isLookAtCamera||this.emitter.isLookAtCameraOnlyY){if(this.emitter.isLookAtCamera)f=(f=new THREE.Euler).setFromQuaternion(e.quaternion),this.vec3Rotation=f;else if(this.emitter.isLookAtCameraOnlyY){var f;f=(f=new THREE.Euler).setFromQuaternion(e.quaternion),this.vec3Rotation=new THREE.Euler(0,f.z,0,"XYZ")}}else if(this.emitter.SHOULD_ANGLE_PARTICLES){var m=this.getFloatOverLifetime(i,this.arrayRealAngle);this.vec3Rotation=new THREE.Euler(m,m,m)}if(this.emitter.group.bEnableTrail){var g=MSPE.utils.clock().getElapsedTime();this.trailRenderHelper.tick({uuid:this.uuidTrial,timeNow:g,position:this.vec3Position,rotation:this.vec3Rotation})}if(MSPE.utils.setMatrix(this.vec3Position,this.vec3Rotation,this.vec3Scale,this.matrix),this.emitter.group.mcol0.setXYZ(this.iBufferIndex,this.matrixElements[0],this.matrixElements[1],this.matrixElements[2]),this.emitter.group.mcol1.setXYZ(this.iBufferIndex,this.matrixElements[4],this.matrixElements[5],this.matrixElements[6]),this.emitter.group.mcol2.setXYZ(this.iBufferIndex,this.matrixElements[8],this.matrixElements[9],this.matrixElements[10]),this.emitter.group.mcol3.setXYZ(this.iBufferIndex,this.matrixElements[12],this.matrixElements[13],this.matrixElements[14]),this.emitter.SHOULD_COLORIZE_PARTICLES){var v=this.getColorOverLifetime(i,this.arrayRealColor[0],this.arrayRealColor[1],this.arrayRealColor[2],this.arrayRealColor[3]),y=this.getFloatOverLifetime(i,this.arrayRealOpacity);this.emitter.group.bEnableTrail&&null!=this.trailRenderHelper&&null!=this.trailRenderHelper&&this.trailRenderHelper.updateColor({r:v.x,g:v.y,b:v.z,a:y}),this.emitter.group.colors.setXYZW(this.iBufferIndex,v.x,v.y,v.z,y)}},MSPE.Particle.prototype.dispose=function(){"use strict";this.emitter.group.bEnableTrail&&(this.trailRenderHelper.detach(this.uuidTrial),this.trailRenderHelper.dispose(),this.meshTrial&&this.meshTrial.parent&&this.meshTrial.parent.remove(this.meshTrial)),null!=this.obj&&null!=this.obj&&this.obj.setUse(!1)},MSPE.BufferAttributeObjPool=function(e){"use strict";var t=MSPE.utils,i=t.types;if(null!=(e=t.ensureTypedArg(e,i.OBJECT,{})).iCount&&null!=e.iCount&&"number"==typeof e.iCount){this.iCount=e.iCount,this.objPool=new Array;for(var r=0;r<this.iCount;r++){var n=new MSPE.BufferAttributeObj({iIndex:r});this.objPool.push(n)}}else console.error("[MSPE] : [BufferAttributeObjPool] : error options.iCount;")},MSPE.BufferAttributeObjPool.constructor=MSPE.BufferAttributeObjPool,MSPE.BufferAttributeObjPool.prototype.setUse=function(e,t){"use strict";null!=e&&null!=e&&"number"==typeof e?e+1>this.objPool.length?console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error iIndex; iIndex = "+e+"; while this.objPool.length = "+this.objPool.length):null!=t&&null!=t&&"boolean"==typeof t?this.objPool[e].setUse(t):console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error bU;"):console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error iIndex;")},MSPE.BufferAttributeObjPool.prototype.getUse=function(e){"use strict";if(null!=e&&null!=e&&"number"==typeof e){if(!(e+1>this.objPool.length))return this.objPool[e].getUse();console.error("[MSPE] : [BufferAttributeObjPool] : [getUse] : error iIndex; iIndex = "+e+"; while this.objPool.length = "+this.objPool.length)}else console.error("[MSPE] : [BufferAttributeObjPool] : [getUse] : error iIndex;")},MSPE.BufferAttributeObjPool.prototype.takeAnObj=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)if(!this.objPool[e].getUse())return this.objPool[e];return null},MSPE.BufferAttributeObjPool.prototype.reset=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)this.objPool[e].setUse(!1)},MSPE.BufferAttributeObjPool.prototype.dispose=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)this.objPool[e].dispose()},MSPE.BufferAttributeObj=function(e){"use strict";var t=MSPE.utils,i=t.types;null!=(e=t.ensureTypedArg(e,i.OBJECT,{})).iIndex&&null!=e.iIndex&&"number"==typeof e.iIndex?(this.iIndex=e.iIndex,this.bUsed=!1):console.error("[MSPE] : [BufferAttributeObj] : error options.iIndex;")},MSPE.BufferAttributeObj.constructor=MSPE.BufferAttributeObj,MSPE.BufferAttributeObj.prototype.setUse=function(e){"use strict";this.bUsed=e},MSPE.BufferAttributeObj.prototype.getUse=function(){"use strict";return this.bUsed},MSPE.BufferAttributeObj.prototype.dispose=function(){},function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).poly2tri=e()}}((function(){return function e(t,i,r){function n(a,s){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[a]={exports:{}};t[a][0].call(c.exports,(function(e){return n(t[a][1][e]||e)}),c,c.exports,e,t,i,r)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)n(r[a]);return n}({1:[function(e,t,i){t.exports={version:"1.5.0"}},{}],2:[function(e,t,i){"use strict";var r=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};r.prototype.head=function(){return this.head_},r.prototype.setHead=function(e){this.head_=e},r.prototype.tail=function(){return this.tail_},r.prototype.setTail=function(e){this.tail_=e},r.prototype.search=function(){return this.search_node_},r.prototype.setSearch=function(e){this.search_node_=e},r.prototype.findSearchNode=function(){return this.search_node_},r.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},r.prototype.locatePoint=function(e){var t=e.x,i=this.findSearchNode(t),r=i.point.x;if(t===r){if(e!==i.point)if(e===i.prev.point)i=i.prev;else{if(e!==i.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");i=i.next}}else if(t<r)for(;(i=i.prev)&&e!==i.point;);else for(;(i=i.next)&&e!==i.point;);return i&&(this.search_node_=i),i},t.exports=r,t.exports.Node=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x}},{}],3:[function(e,t,i){"use strict";t.exports=function(e,t){if(!e)throw new Error(t||"Assert Failed")}},{}],4:[function(e,t,i){"use strict";var r=e("./xy"),n=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};n.prototype.toString=function(){return r.toStringBase(this)},n.prototype.toJSON=function(){return{x:this.x,y:this.y}},n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.set_zero=function(){return this.x=0,this.y=0,this},n.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},n.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},n.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},n.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},n.prototype.mul=function(e){return this.x*=e,this.y*=e,this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},n.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},n.negate=function(e){return new n(-e.x,-e.y)},n.add=function(e,t){return new n(e.x+t.x,e.y+t.y)},n.sub=function(e,t){return new n(e.x-t.x,e.y-t.y)},n.mul=function(e,t){return new n(e*t.x,e*t.y)},n.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new n(-e*t.y,e*t.x):"number"==typeof t?new n(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},n.toString=r.toString,n.compare=r.compare,n.cmp=r.compare,n.equals=r.equals,n.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=n},{"./xy":11}],5:[function(e,t,i){"use strict";var r=e("./xy"),n=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var i=0;i<t.length;i++)this.message+=" "+r.toString(t[i])};(n.prototype=new Error).constructor=n,t.exports=n},{"./xy":11}],6:[function(e,t,i){(function(t){"use strict";var r=t.poly2tri;i.noConflict=function(){return t.poly2tri=r,i},i.VERSION=e("../dist/version.json").version,i.PointError=e("./pointerror"),i.Point=e("./point"),i.Triangle=e("./triangle"),i.SweepContext=e("./sweepcontext");var n=e("./sweep");i.triangulate=n.triangulate,i.sweep={Triangulate:n.triangulate}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,i){"use strict";function r(e,t){var i=e.locateNode(t),r=function(e,t,i){var r=new b(t,i.point,i.next.point);r.markNeighbor(i.triangle),e.addToMap(r);var n=new _(t);return n.next=i.next,n.prev=i,i.next.prev=n,i.next=n,l(e,r)||e.mapTriangleToNodes(r),n}(e,t,i);return t.x<=i.point.x+E&&s(e,i),function(e,t){for(var i=t.next;i.next&&!A(i.point,i.next.point,i.prev.point);)s(e,i),i=i.next;for(i=t.prev;i.prev&&!A(i.point,i.next.point,i.prev.point);)s(e,i),i=i.prev;t.next&&t.next.next&&function(e){var t=e.point.x-e.next.next.point.x,i=e.point.y-e.next.next.point.y;return v(i>=0,"unordered y"),t>=0||Math.abs(t)<i}(t)&&function(e,t){for(T(t.point,t.next.point,t.next.next.point)===w.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,function e(t,i){if(!function(e,t){var i;return i=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>i}(t,i)&&(s(t,i),i.prev!==t.basin.left_node||i.next!==t.basin.right_node)){if(i.prev===t.basin.left_node){if(T(i.point,i.next.point,i.next.next.point)===w.CW)return;i=i.next}else if(i.next===t.basin.right_node){if(T(i.point,i.prev.point,i.prev.prev.point)===w.CCW)return;i=i.prev}else i=i.prev.point.y<i.next.point.y?i.prev:i.next;e(t,i)}}(e,e.basin.bottom_node))}}(e,t)}(e,r),r}function n(e,t,i){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,a(i.triangle,t.p,t.q)||(function(e,t,i){e.edge_event.right?function(e,t,i){for(;i.next.point.x<t.p.x;)T(t.q,i.next.point,t.p)===w.CCW?h(e,t,i):i=i.next}(e,t,i):function(e,t,i){for(;i.prev.point.x>t.p.x;)T(t.q,i.prev.point,t.p)===w.CW?d(e,t,i):i=i.prev}(e,t,i)}(e,t,i),o(e,t.p,t.q,i.triangle,t.q))}function o(e,t,i,r,n){if(!a(r,t,i)){var s=r.pointCCW(n),l=T(i,s,t);if(l===w.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[i,s,t]);var u=r.pointCW(n),c=T(i,u,t);if(c===w.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[i,u,t]);l===c?o(e,t,i,r=l===w.CW?r.neighborCCW(n):r.neighborCW(n),n):m(e,t,i,r,n)}}function a(e,t,i){var r=e.edgeIndex(t,i);if(-1!==r){e.markConstrainedEdgeByIndex(r);var n=e.getNeighbor(r);return n&&n.markConstrainedEdgeByPoints(t,i),!0}return!1}function s(e,t){var i=new b(t.prev.point,t.point,t.next.point);i.markNeighbor(t.prev.triangle),i.markNeighbor(t.triangle),e.addToMap(i),t.prev.next=t.next,t.next.prev=t.prev,l(e,i)||e.mapTriangleToNodes(i)}function l(e,t){for(var i=0;i<3;++i)if(!t.delaunay_edge[i]){var r=t.getNeighbor(i);if(r){var n=t.getPoint(i),o=r.oppositePoint(t,n),a=r.index(o);if(r.constrained_edge[a]||r.delaunay_edge[a]){t.constrained_edge[i]=r.constrained_edge[a];continue}if(u(n,t.pointCCW(n),t.pointCW(n),o)){t.delaunay_edge[i]=!0,r.delaunay_edge[a]=!0,c(t,n,r,o);var s=!l(e,t);return s&&e.mapTriangleToNodes(t),(s=!l(e,r))&&e.mapTriangleToNodes(r),t.delaunay_edge[i]=!1,r.delaunay_edge[a]=!1,!0}}}return!1}function u(e,t,i,r){var n=e.x-r.x,o=e.y-r.y,a=t.x-r.x,s=t.y-r.y,l=n*s-a*o;if(l<=0)return!1;var u=i.x-r.x,c=i.y-r.y,h=u*o-n*c;return!(h<=0)&&(n*n+o*o)*(a*c-u*s)+(a*a+s*s)*h+(u*u+c*c)*l>0}function c(e,t,i,r){var n,o,a,s,l,u,c,h,p,d,f,m;n=e.neighborCCW(t),o=e.neighborCW(t),a=i.neighborCCW(r),s=i.neighborCW(r),l=e.getConstrainedEdgeCCW(t),u=e.getConstrainedEdgeCW(t),c=i.getConstrainedEdgeCCW(r),h=i.getConstrainedEdgeCW(r),p=e.getDelaunayEdgeCCW(t),d=e.getDelaunayEdgeCW(t),f=i.getDelaunayEdgeCCW(r),m=i.getDelaunayEdgeCW(r),e.legalize(t,r),i.legalize(r,t),i.setDelaunayEdgeCCW(t,p),e.setDelaunayEdgeCW(t,d),e.setDelaunayEdgeCCW(r,f),i.setDelaunayEdgeCW(r,m),i.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,u),e.setConstrainedEdgeCCW(r,c),i.setConstrainedEdgeCW(r,h),e.clearNeighbors(),i.clearNeighbors(),n&&i.markNeighbor(n),o&&e.markNeighbor(o),a&&e.markNeighbor(a),s&&i.markNeighbor(s),e.markNeighbor(i)}function h(e,t,i){i.point.x<t.p.x&&(T(i.point,i.next.point,i.next.next.point)===w.CCW?p(e,t,i):(function e(t,i,r){T(r.next.point,r.next.next.point,r.next.next.next.point)===w.CCW?p(t,i,r.next):T(i.q,r.next.next.point,i.p)===w.CCW&&e(t,i,r.next)}(e,t,i),h(e,t,i)))}function p(e,t,i){s(e,i.next),i.next.point!==t.p&&T(t.q,i.next.point,t.p)===w.CCW&&T(i.point,i.next.point,i.next.next.point)===w.CCW&&p(e,t,i)}function d(e,t,i){i.point.x>t.p.x&&(T(i.point,i.prev.point,i.prev.prev.point)===w.CW?f(e,t,i):(function e(t,i,r){T(r.prev.point,r.prev.prev.point,r.prev.prev.prev.point)===w.CW?f(t,i,r.prev):T(i.q,r.prev.prev.point,i.p)===w.CW&&e(t,i,r.prev)}(e,t,i),d(e,t,i)))}function f(e,t,i){s(e,i.prev),i.prev.point!==t.p&&T(t.q,i.prev.point,t.p)===w.CW&&T(i.point,i.prev.point,i.prev.prev.point)===w.CW&&f(e,t,i)}function m(e,t,i,r,n){var a=r.neighborAcross(n);v(a,"FLIP failed due to missing triangle!");var s=a.oppositePoint(r,n);if(r.getConstrainedEdgeAcross(n)){var u=r.index(n);throw new y("poly2tri Intersecting Constraints",[n,s,r.getPoint((u+1)%3),r.getPoint((u+2)%3)])}if(S(n,r.pointCCW(n),r.pointCW(n),s))if(c(r,n,a,s),e.mapTriangleToNodes(r),e.mapTriangleToNodes(a),n===i&&s===t)i===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(r.markConstrainedEdgeByPoints(t,i),a.markConstrainedEdgeByPoints(t,i),l(e,r),l(e,a));else{r=function(e,t,i,r,n,o){var a;return t===w.CCW?(a=r.edgeIndex(n,o),r.delaunay_edge[a]=!0,l(e,r),r.clearDelaunayEdges(),i):(a=i.edgeIndex(n,o),i.delaunay_edge[a]=!0,l(e,i),i.clearDelaunayEdges(),r)}(e,T(i,s,t),r,a,n,s),m(e,t,i,r,n)}else(function e(t,i,r,n,o,a){var s=o.neighborAcross(a);v(s,"FLIP failed due to missing triangle");var l=s.oppositePoint(o,a);S(r,n.pointCCW(r),n.pointCW(r),l)?m(t,r,l,s,l):e(t,i,r,n,s,g(i,r,s,l))})(e,t,i,r,a,g(t,i,a,s)),o(e,t,i,r,n)}function g(e,t,i,r){var n=T(t,r,e);if(n===w.CW)return i.pointCCW(r);if(n===w.CCW)return i.pointCW(r);throw new y("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,r,e])}var v=e("./assert"),y=e("./pointerror"),b=e("./triangle"),_=e("./advancingfront").Node,x=e("./utils"),E=x.EPSILON,w=x.Orientation,T=x.orient2d,S=x.inScanArea,A=x.isAngleObtuse;i.triangulate=function(e){e.initTriangulation(),e.createAdvancingFront(),function(e){var t,i=e.pointCount();for(t=1;t<i;++t)for(var o=e.getPoint(t),a=r(e,o),s=o._p2t_edge_list,l=0;s&&l<s.length;++l)n(e,s[l],a)}(e),function(e){for(var t=e.front().head().next.triangle,i=e.front().head().next.point;!t.getConstrainedEdgeCW(i);)t=t.neighborCCW(i);e.meshClean(t)}(e)}},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,i){"use strict";var r=e("./pointerror"),n=e("./point"),o=e("./triangle"),a=e("./sweep"),s=e("./advancingfront"),l=s.Node,u=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new r("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},c=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};c.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var h=function(){this.constrained_edge=null,this.right=!1},p=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new c,this.edge_event=new h,this.initEdges(this.points_)};p.prototype.addHole=function(e){this.initEdges(e);var t,i=e.length;for(t=0;t<i;t++)this.points_.push(e[t]);return this},p.prototype.AddHole=p.prototype.addHole,p.prototype.addHoles=function(e){var t,i=e.length;for(t=0;t<i;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},p.prototype.addPoint=function(e){return this.points_.push(e),this},p.prototype.AddPoint=p.prototype.addPoint,p.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},p.prototype.triangulate=function(){return a.triangulate(this),this},p.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},p.prototype.getTriangles=function(){return this.triangles_},p.prototype.GetTriangles=p.prototype.getTriangles,p.prototype.front=function(){return this.front_},p.prototype.pointCount=function(){return this.points_.length},p.prototype.head=function(){return this.head_},p.prototype.setHead=function(e){this.head_=e},p.prototype.tail=function(){return this.tail_},p.prototype.setTail=function(e){this.tail_=e},p.prototype.getMap=function(){return this.map_},p.prototype.initTriangulation=function(){var e,t=this.points_[0].x,i=this.points_[0].x,r=this.points_[0].y,o=this.points_[0].y,a=this.points_.length;for(e=1;e<a;e++){var s=this.points_[e];s.x>t&&(t=s.x),s.x<i&&(i=s.x),s.y>r&&(r=s.y),s.y<o&&(o=s.y)}this.pmin_=new n(i,o),this.pmax_=new n(t,r);var l=.3*(t-i),u=.3*(r-o);this.head_=new n(t+l,o-u),this.tail_=new n(i-l,o-u),this.points_.sort(n.compare)},p.prototype.initEdges=function(e){var t,i=e.length;for(t=0;t<i;++t)this.edge_list.push(new u(e[t],e[(t+1)%i]))},p.prototype.getPoint=function(e){return this.points_[e]},p.prototype.addToMap=function(e){this.map_.push(e)},p.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},p.prototype.createAdvancingFront=function(){var e,t,i,r=new o(this.points_[0],this.tail_,this.head_);this.map_.push(r),e=new l(r.getPoint(1),r),t=new l(r.getPoint(0),r),i=new l(r.getPoint(2)),this.front_=new s(e,i),e.next=t,t.next=i,t.prev=e,i.prev=t},p.prototype.removeNode=function(e){},p.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var i=this.front_.locatePoint(e.pointCW(e.getPoint(t)));i&&(i.triangle=e)}},p.prototype.removeFromMap=function(e){var t,i=this.map_,r=i.length;for(t=0;t<r;t++)if(i[t]===e){i.splice(t,1);break}},p.prototype.meshClean=function(e){for(var t,i,r=[e];t=r.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),i=0;i<3;i++)t.constrained_edge[i]||r.push(t.getNeighbor(i))},t.exports=p},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,i){"use strict";var r=function(e,t,i){this.points_=[e,t,i],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},n=e("./xy").toString;r.prototype.toString=function(){return"["+n(this.points_[0])+n(this.points_[1])+n(this.points_[2])+"]"},r.prototype.getPoint=function(e){return this.points_[e]},r.prototype.GetPoint=r.prototype.getPoint,r.prototype.getPoints=function(){return this.points_},r.prototype.getNeighbor=function(e){return this.neighbors_[e]},r.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},r.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},r.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},r.prototype.isInterior=function(){return this.interior_},r.prototype.setInterior=function(e){return this.interior_=e,this},r.prototype.markNeighborPointers=function(e,t,i){var r=this.points_;if(e===r[2]&&t===r[1]||e===r[1]&&t===r[2])this.neighbors_[0]=i;else if(e===r[0]&&t===r[2]||e===r[2]&&t===r[0])this.neighbors_[1]=i;else{if(!(e===r[0]&&t===r[1]||e===r[1]&&t===r[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=i}},r.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},r.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},r.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},r.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},r.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},r.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},r.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},r.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},r.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},r.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},r.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},r.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},r.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},r.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},r.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},r.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},r.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},r.prototype.oppositePoint=function(e,t){var i=e.pointCW(t);return this.pointCW(i)},r.prototype.legalize=function(e,t){var i=this.points_;if(e===i[0])i[1]=i[0],i[0]=i[2],i[2]=t;else if(e===i[1])i[2]=i[1],i[1]=i[0],i[0]=t;else{if(e!==i[2])throw new Error("poly2tri Invalid Triangle.legalize() call");i[0]=i[2],i[2]=i[1],i[1]=t}},r.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},r.prototype.edgeIndex=function(e,t){var i=this.points_;if(e===i[0]){if(t===i[1])return 2;if(t===i[2])return 1}else if(e===i[1]){if(t===i[2])return 0;if(t===i[0])return 2}else if(e===i[2]){if(t===i[0])return 1;if(t===i[1])return 0}return-1},r.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},r.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},r.prototype.markConstrainedEdgeByPoints=function(e,t){var i=this.points_;t===i[0]&&e===i[1]||t===i[1]&&e===i[0]?this.constrained_edge[2]=!0:t===i[0]&&e===i[2]||t===i[2]&&e===i[0]?this.constrained_edge[1]=!0:(t===i[1]&&e===i[2]||t===i[2]&&e===i[1])&&(this.constrained_edge[0]=!0)},t.exports=r},{"./xy":11}],10:[function(e,t,i){"use strict";var r=1e-12;i.EPSILON=r;var n={CW:1,CCW:-1,COLLINEAR:0};i.Orientation=n,i.orient2d=function(e,t,i){var o=(e.x-i.x)*(t.y-i.y)-(e.y-i.y)*(t.x-i.x);return o>-r&&o<r?n.COLLINEAR:o>0?n.CCW:n.CW},i.inScanArea=function(e,t,i,n){return!((e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)>=-r||(e.x-i.x)*(n.y-i.y)-(n.x-i.x)*(e.y-i.y)<=r)},i.isAngleObtuse=function(e,t,i){var r=t.x-e.x,n=t.y-e.y;return r*(i.x-e.x)+n*(i.y-e.y)<0}},{}],11:[function(e,t,i){"use strict";function r(e){return"("+e.x+";"+e.y+")"}t.exports={toString:function(e){var t=e.toString();return"[object Object]"===t?r(e):t},toStringBase:r,compare:function(e,t){return e.y===t.y?e.x-t.x:e.y-t.y},equals:function(e,t){return e.x===t.x&&e.y===t.y}}},{}]},{},[6])(6)})),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).polylabel=e()}}((function(){return function e(t,i,r){function n(a,s){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[a]={exports:{}};t[a][0].call(c.exports,(function(e){var i=t[a][1][e];return n(i||e)}),c,c.exports,e,t,i,r)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)n(r[a]);return n}({1:[function(e,t,i){"use strict";var r=e("tinyqueue");function n(e,t,i){var n,s,l,u;t=t||1;for(var c=0;c<e[0].length;c++){var h=e[0][c];(!c||h[0]<n)&&(n=h[0]),(!c||h[1]<s)&&(s=h[1]),(!c||h[0]>l)&&(l=h[0]),(!c||h[1]>u)&&(u=h[1])}var p=l-n,d=u-s,f=Math.min(p,d),m=f/2,g=new r(null,o);if(0===f)return[n,s];for(var v=n;v<l;v+=f)for(var y=s;y<u;y+=f)g.push(new a(v+m,y+m,m,e));var b=function(e){for(var t=0,i=0,r=0,n=e[0],o=0,s=n.length,l=s-1;o<s;l=o++){var u=n[o],c=n[l],h=u[0]*c[1]-c[0]*u[1];i+=(u[0]+c[0])*h,r+=(u[1]+c[1])*h,t+=3*h}return 0===t?new a(n[0][0],n[0][1],0,e):new a(i/t,r/t,0,e)}(e),_=new a(n+p/2,s+d/2,0,e);_.d>b.d&&(b=_);for(var x=g.length;g.length;){var E=g.pop();E.d>b.d&&(b=E,i&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,x)),E.max-b.d<=t||(m=E.h/2,g.push(new a(E.x-m,E.y-m,m,e)),g.push(new a(E.x+m,E.y-m,m,e)),g.push(new a(E.x-m,E.y+m,m,e)),g.push(new a(E.x+m,E.y+m,m,e)),x+=4)}return i&&(console.log("num probes: "+x),console.log("best distance: "+b.d)),[b.x,b.y]}function o(e,t){return t.max-e.max}function a(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=function(e,t,i){for(var r=!1,n=1/0,o=0;o<i.length;o++)for(var a=i[o],l=0,u=a.length,c=u-1;l<u;c=l++){var h=a[l],p=a[c];h[1]>t!=p[1]>t&&e<(p[0]-h[0])*(t-h[1])/(p[1]-h[1])+h[0]&&(r=!r),n=Math.min(n,s(e,t,h,p))}return(r?1:-1)*Math.sqrt(n)}(e,t,r),this.max=this.d+this.h*Math.SQRT2}function s(e,t,i,r){var n=i[0],o=i[1],a=r[0]-n,s=r[1]-o;if(0!==a||0!==s){var l=((e-n)*a+(t-o)*s)/(a*a+s*s);l>1?(n=r[0],o=r[1]):l>0&&(n+=a*l,o+=s*l)}return(a=e-n)*a+(s=t-o)*s}t.exports=n,t.exports.default=n},{tinyqueue:2}],2:[function(e,t,i){"use strict";function r(e,t){if(!(this instanceof r))return new r(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||n,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function n(e,t){return e<t?-1:e>t?1:0}t.exports=r,t.exports.default=r,r.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,i=this.compare,r=t[e];e>0;){var n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r},_down:function(e){for(var t=this.data,i=this.compare,r=this.length>>1,n=t[e];e<r;){var o=1+(e<<1),a=o+1,s=t[o];if(a<this.length&&i(t[a],s)<0&&(o=a,s=t[a]),i(s,n)>=0)break;t[e]=s,e=o}t[e]=n}}},{}]},{},[1])(1)})),SimpleHeatmap.getInstance=function(){var e=null;return function(){return e||(e=new SimpleHeatmap),e}}(),SimpleHeatmap.prototype=Object.assign(Object.create({}),{constructor:SimpleHeatmap,defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},canvas:function(){return this._canvas},data:function(e){return this._data=e,this._dataDirty=!0,this},add:function(e){return this._data.push(e),this._dataDirty=!0,this},clear:function(){return this._data=[],this._dataDirty=!0,this},max:function(e){return this._max!==e&&(this._max=e,this._dataDirty=!0),this},min:function(e){return this._min!==e&&(this._min=e,this._dataDirty=!0),this},setCanvasSize:function(e,t){return this._canvasWidth===e&&this._canvasHeight===t||(this._canvasWidth=this._canvas.width=e,this._canvasHeight=this._canvas.height=t,this._dataDirty=!0),this},setAreaSize:function(e,t){return this._areaWidth===e&&this._areaHeight===t||(this._areaWidth=e,this._areaHeight=t,this._dataDirty=!0),this},alpha:function(e){return this._alpha=e,this},radius:function(e,t){if(t=void 0!==t?t:15,e===this._radius&&t===this._blur)return this;this._radius=e,this._blur=t,this._r=this._radius+this._blur;var i=this._circle,r=this._cirCtx;return i.width=i.height=2*this._r,r.shadowOffsetX=r.shadowOffsetY=2*this._r,r.shadowBlur=t,r.shadowColor="black",r.beginPath(),r.arc(-this._r,-this._r,e,0,2*Math.PI,!0),r.closePath(),r.fill(),this},gradient:function(e){var t=this._getGradientCode(this._grad),i=this._getGradientCode(e);if(t===i)return this;if(this._grad=Object.assign({},e),this._gradCache[i])return this._gradData=this._gradCache[i],this;var r=this._gradCtx.createLinearGradient(0,0,0,256);for(var n in e)r.addColorStop(+n,e[n]);return this._gradCtx.fillStyle=r,this._gradCtx.fillRect(0,0,1,256),this._gradData=this._gradCtx.getImageData(0,0,1,256).data,this._gradCache[i]=this._gradData,this},draw:function(){0===this._r&&this.radius(this.defaultRadius),this._gradData||this.gradient(this.defaultGradient),this._dataDirty&&this._transformData();var e=this._ctx;e.clearRect(0,0,this._canvasWidth,this._canvasHeight);for(var t,i=0,r=this._transformedData.length;i<r;i++)t=this._transformedData[i],e.globalAlpha=t[2],e.drawImage(this._circle,t[0]-this._r,t[1]-this._r);var n=e.getImageData(0,0,this._canvasWidth,this._canvasHeight);return this._colorize(n.data,this._gradData,this._alpha),e.putImageData(n,0,0),this},_transformData:function(){this._transformedData=[];var e=this._canvasWidth/this._areaWidth,t=this._canvasHeight/this._areaHeight,i=this;this._data.map((function(r){var n=r[0],o=r[1];n=n*e+i._canvasWidth/2,o=o*t+i._canvasHeight/2;var a=Math.min(Math.max((r[2]-i._min)/(i._max-i._min),.05),1);i._transformedData.push([n,o,a])}))},_colorize:function(e,t,i){for(var r,n=0,o=e.length;n<o;n+=4)r=4*e[n+3],i&&0===r||(e[n]=t[r],e[n+1]=t[r+1],e[n+2]=t[r+2],i||(e[n+3]=255))},_getGradientCode:function(e){var t="grad:(";for(var i in e)t+=i+":"+e[i]+",";return t+=")"},_createCanvas:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}}),function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;try{t=window}catch(e){t=self}t.SparkMD5=e()}}((function(e){"use strict";var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(e,t){var i=e[0],r=e[1],n=e[2],o=e[3];r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&n|~r&o)+t[0]-680876936|0)<<7|i>>>25)+r|0)&r|~i&n)+t[1]-389564586|0)<<12|o>>>20)+i|0)&i|~o&r)+t[2]+606105819|0)<<17|n>>>15)+o|0)&o|~n&i)+t[3]-1044525330|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&n|~r&o)+t[4]-176418897|0)<<7|i>>>25)+r|0)&r|~i&n)+t[5]+1200080426|0)<<12|o>>>20)+i|0)&i|~o&r)+t[6]-1473231341|0)<<17|n>>>15)+o|0)&o|~n&i)+t[7]-45705983|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&n|~r&o)+t[8]+1770035416|0)<<7|i>>>25)+r|0)&r|~i&n)+t[9]-1958414417|0)<<12|o>>>20)+i|0)&i|~o&r)+t[10]-42063|0)<<17|n>>>15)+o|0)&o|~n&i)+t[11]-1990404162|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&n|~r&o)+t[12]+1804603682|0)<<7|i>>>25)+r|0)&r|~i&n)+t[13]-40341101|0)<<12|o>>>20)+i|0)&i|~o&r)+t[14]-1502002290|0)<<17|n>>>15)+o|0)&o|~n&i)+t[15]+1236535329|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&o|n&~o)+t[1]-165796510|0)<<5|i>>>27)+r|0)&n|r&~n)+t[6]-1069501632|0)<<9|o>>>23)+i|0)&r|i&~r)+t[11]+643717713|0)<<14|n>>>18)+o|0)&i|o&~i)+t[0]-373897302|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&o|n&~o)+t[5]-701558691|0)<<5|i>>>27)+r|0)&n|r&~n)+t[10]+38016083|0)<<9|o>>>23)+i|0)&r|i&~r)+t[15]-660478335|0)<<14|n>>>18)+o|0)&i|o&~i)+t[4]-405537848|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&o|n&~o)+t[9]+568446438|0)<<5|i>>>27)+r|0)&n|r&~n)+t[14]-1019803690|0)<<9|o>>>23)+i|0)&r|i&~r)+t[3]-187363961|0)<<14|n>>>18)+o|0)&i|o&~i)+t[8]+1163531501|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&o|n&~o)+t[13]-1444681467|0)<<5|i>>>27)+r|0)&n|r&~n)+t[2]-51403784|0)<<9|o>>>23)+i|0)&r|i&~r)+t[7]+1735328473|0)<<14|n>>>18)+o|0)&i|o&~i)+t[12]-1926607734|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r^n^o)+t[5]-378558|0)<<4|i>>>28)+r|0)^r^n)+t[8]-2022574463|0)<<11|o>>>21)+i|0)^i^r)+t[11]+1839030562|0)<<16|n>>>16)+o|0)^o^i)+t[14]-35309556|0)<<23|r>>>9)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r^n^o)+t[1]-1530992060|0)<<4|i>>>28)+r|0)^r^n)+t[4]+1272893353|0)<<11|o>>>21)+i|0)^i^r)+t[7]-155497632|0)<<16|n>>>16)+o|0)^o^i)+t[10]-1094730640|0)<<23|r>>>9)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r^n^o)+t[13]+681279174|0)<<4|i>>>28)+r|0)^r^n)+t[0]-358537222|0)<<11|o>>>21)+i|0)^i^r)+t[3]-722521979|0)<<16|n>>>16)+o|0)^o^i)+t[6]+76029189|0)<<23|r>>>9)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r^n^o)+t[9]-640364487|0)<<4|i>>>28)+r|0)^r^n)+t[12]-421815835|0)<<11|o>>>21)+i|0)^i^r)+t[15]+530742520|0)<<16|n>>>16)+o|0)^o^i)+t[2]-995338651|0)<<23|r>>>9)+n|0,r=((r+=((o=((o+=(r^((i=((i+=(n^(r|~o))+t[0]-198630844|0)<<6|i>>>26)+r|0)|~n))+t[7]+1126891415|0)<<10|o>>>22)+i|0)^((n=((n+=(i^(o|~r))+t[14]-1416354905|0)<<15|n>>>17)+o|0)|~i))+t[5]-57434055|0)<<21|r>>>11)+n|0,r=((r+=((o=((o+=(r^((i=((i+=(n^(r|~o))+t[12]+1700485571|0)<<6|i>>>26)+r|0)|~n))+t[3]-1894986606|0)<<10|o>>>22)+i|0)^((n=((n+=(i^(o|~r))+t[10]-1051523|0)<<15|n>>>17)+o|0)|~i))+t[1]-2054922799|0)<<21|r>>>11)+n|0,r=((r+=((o=((o+=(r^((i=((i+=(n^(r|~o))+t[8]+1873313359|0)<<6|i>>>26)+r|0)|~n))+t[15]-30611744|0)<<10|o>>>22)+i|0)^((n=((n+=(i^(o|~r))+t[6]-1560198380|0)<<15|n>>>17)+o|0)|~i))+t[13]+1309151649|0)<<21|r>>>11)+n|0,r=((r+=((o=((o+=(r^((i=((i+=(n^(r|~o))+t[4]-145523070|0)<<6|i>>>26)+r|0)|~n))+t[11]-1120210379|0)<<10|o>>>22)+i|0)^((n=((n+=(i^(o|~r))+t[2]+718787259|0)<<15|n>>>17)+o|0)|~i))+t[9]-343485551|0)<<21|r>>>11)+n|0,e[0]=i+e[0]|0,e[1]=r+e[1]|0,e[2]=n+e[2]|0,e[3]=o+e[3]|0}function r(e){var t,i=[];for(t=0;t<64;t+=4)i[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return i}function n(e){var t,i=[];for(t=0;t<64;t+=4)i[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return i}function o(e){var t,n,o,a,s,l,u=e.length,c=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)i(c,r(e.substring(t-64,t)));for(n=(e=e.substring(t-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(i(c,o),t=0;t<16;t+=1)o[t]=0;return a=(a=8*u).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),l=parseInt(a[1],16)||0,o[14]=s,o[15]=l,i(c,o),c}function a(e){var i,r="";for(i=0;i<4;i+=1)r+=t[e>>8*i+4&15]+t[e>>8*i&15];return r}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=a(e[t]);return e.join("")}function l(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function u(e){var t,i=[],r=e.length;for(t=0;t<r-1;t+=2)i.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,i)}function c(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==s(o("hello"))&&function(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(i,r){var n,o,a,s,l=this.byteLength,u=t(i,l),c=l;return r!==e&&(c=t(r,l)),u>c?new ArrayBuffer(0):(n=c-u,o=new ArrayBuffer(n),a=new Uint8Array(o),s=new Uint8Array(this,u,n),a.set(s),o)}}(),c.prototype.append=function(e){return this.appendBinary(l(e)),this},c.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,n=this._buff.length;for(t=64;t<=n;t+=64)i(this._hash,r(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},c.prototype.end=function(e){var t,i,r=this._buff,n=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<n;t+=1)o[t>>2]|=r.charCodeAt(t)<<(t%4<<3);return this._finish(o,n),i=s(this._hash),e&&(i=u(i)),this.reset(),i},c.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},c.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},c.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},c.prototype._finish=function(e,t){var r,n,o,a=t;if(e[a>>2]|=128<<(a%4<<3),a>55)for(i(this._hash,e),a=0;a<16;a+=1)e[a]=0;r=(r=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(r[2],16),o=parseInt(r[1],16)||0,e[14]=n,e[15]=o,i(this._hash,e)},c.hash=function(e,t){return c.hashBinary(l(e),t)},c.hashBinary=function(e,t){var i=s(o(e));return t?u(i):i},c.ArrayBuffer=function(){this.reset()},c.ArrayBuffer.prototype.append=function(e){var t,r,o,a,s,l=(r=this._buff.buffer,o=e,a=!0,(s=new Uint8Array(r.byteLength+o.byteLength)).set(new Uint8Array(r)),s.set(new Uint8Array(o),r.byteLength),a?s:s.buffer),u=l.length;for(this._length+=e.byteLength,t=64;t<=u;t+=64)i(this._hash,n(l.subarray(t-64,t)));return this._buff=t-64<u?new Uint8Array(l.buffer.slice(t-64)):new Uint8Array(0),this},c.ArrayBuffer.prototype.end=function(e){var t,i,r=this._buff,n=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<n;t+=1)o[t>>2]|=r[t]<<(t%4<<3);return this._finish(o,n),i=s(this._hash),e&&(i=u(i)),this.reset(),i},c.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.ArrayBuffer.prototype.getState=function(){var e,t=c.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},c.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var i,r=e.length,n=new ArrayBuffer(r),o=new Uint8Array(n);for(i=0;i<r;i+=1)o[i]=e.charCodeAt(i);return t?o:n}(e.buff,!0),c.prototype.setState.call(this,e)},c.ArrayBuffer.prototype.destroy=c.prototype.destroy,c.ArrayBuffer.prototype._finish=c.prototype._finish,c.ArrayBuffer.hash=function(e,t){var r=s(function(e){var t,r,o,a,s,l,u=e.length,c=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)i(c,n(e.subarray(t-64,t)));for(r=(e=t-64<u?e.subarray(t-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(i(c,o),t=0;t<16;t+=1)o[t]=0;return a=(a=8*u).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),l=parseInt(a[1],16)||0,o[14]=s,o[15]=l,i(c,o),c}(new Uint8Array(e)));return t?u(r):r},c}));var SPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};function TextEncoderLite(){}function TextDecoderLite(){}"function"==typeof define&&define.amd?define("spe",SPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=SPE),SPE.TypedArrayHelper=function(e,t,i,r){"use strict";this.componentSize=i||1,this.size=t||1,this.TypedArrayConstructor=e||Float32Array,this.array=new e(t*this.componentSize),this.indexOffset=r||0},SPE.TypedArrayHelper.constructor=SPE.TypedArrayHelper,SPE.TypedArrayHelper.prototype.setSize=function(e,t){"use strict";var i=this.array.length;return t||(e*=this.componentSize),e<i?this.shrink(e):e>i?this.grow(e):void console.info("TypedArray is already of size:",e+".","Will not resize.")},SPE.TypedArrayHelper.prototype.shrink=function(e){"use strict";return this.array=this.array.subarray(0,e),this.size=e,this},SPE.TypedArrayHelper.prototype.grow=function(e){"use strict";var t=this.array,i=new this.TypedArrayConstructor(e);return i.set(t),this.array=i,this.size=e,this},SPE.TypedArrayHelper.prototype.splice=function(e,t){"use strict";e*=this.componentSize,t*=this.componentSize;for(var i=[],r=this.array,n=r.length,o=0;o<n;++o)(o<e||o>=t)&&i.push(r[o]);return this.setFromArray(0,i),this},SPE.TypedArrayHelper.prototype.setFromArray=function(e,t){"use strict";var i=e+t.length;return i>this.array.length?this.grow(i):i<this.array.length&&this.shrink(i),this.array.set(t,this.indexOffset+e),this},SPE.TypedArrayHelper.prototype.setVec2=function(e,t){"use strict";return this.setVec2Components(e,t.x,t.y)},SPE.TypedArrayHelper.prototype.setVec2Components=function(e,t,i){"use strict";var r=this.array,n=this.indexOffset+e*this.componentSize;return r[n]=t,r[n+1]=i,this},SPE.TypedArrayHelper.prototype.setVec3=function(e,t){"use strict";return this.setVec3Components(e,t.x,t.y,t.z)},SPE.TypedArrayHelper.prototype.setVec3Components=function(e,t,i,r){"use strict";var n=this.array,o=this.indexOffset+e*this.componentSize;return n[o]=t,n[o+1]=i,n[o+2]=r,this},SPE.TypedArrayHelper.prototype.setVec4=function(e,t){"use strict";return this.setVec4Components(e,t.x,t.y,t.z,t.w)},SPE.TypedArrayHelper.prototype.setVec4Components=function(e,t,i,r,n){"use strict";var o=this.array,a=this.indexOffset+e*this.componentSize;return o[a]=t,o[a+1]=i,o[a+2]=r,o[a+3]=n,this},SPE.TypedArrayHelper.prototype.setMat3=function(e,t){"use strict";return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},SPE.TypedArrayHelper.prototype.setMat4=function(e,t){"use strict";return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},SPE.TypedArrayHelper.prototype.setColor=function(e,t){"use strict";return this.setVec3Components(e,t.r,t.g,t.b)},SPE.TypedArrayHelper.prototype.setNumber=function(e,t){"use strict";return this.array[this.indexOffset+e*this.componentSize]=t,this},SPE.TypedArrayHelper.prototype.getValueAtIndex=function(e){"use strict";return this.array[this.indexOffset+e]},SPE.TypedArrayHelper.prototype.getComponentValueAtIndex=function(e){"use strict";return this.array.subarray(this.indexOffset+e*this.componentSize)},SPE.ShaderAttribute=function(e,t,i){"use strict";var r=SPE.ShaderAttribute.typeSizeMap;this.type="string"==typeof e&&r.hasOwnProperty(e)?e:"f",this.componentSize=r[this.type],this.arrayType=i||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=!!t,this.updateMin=0,this.updateMax=0},SPE.ShaderAttribute.constructor=SPE.ShaderAttribute,SPE.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16},SPE.ShaderAttribute.prototype.setUpdateRange=function(e,t){"use strict";this.updateMin=Math.min(e*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(t*this.componentSize,this.updateMax*this.componentSize)},SPE.ShaderAttribute.prototype.flagUpdate=function(){"use strict";var e=this.bufferAttribute,t=e.updateRange;t.offset=this.updateMin,t.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length),e.needsUpdate=!0},SPE.ShaderAttribute.prototype.resetUpdateRange=function(){"use strict";this.updateMin=0,this.updateMax=0},SPE.ShaderAttribute.prototype.resetDynamic=function(){"use strict";this.bufferAttribute.setUsage(!0===this.dynamicBuffer?THREE.DynamicDrawUsage:THREE.StaticDrawUsage)},SPE.ShaderAttribute.prototype.splice=function(e,t){"use strict";this.typedArray.splice(e,t),this.forceUpdateAll()},SPE.ShaderAttribute.prototype.forceUpdateAll=function(){"use strict";this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.updateRange.offset=0,this.bufferAttribute.updateRange.count=-1,this.bufferAttribute.setUsage(THREE.StaticDrawUsage),this.bufferAttribute.needsUpdate=!0},SPE.ShaderAttribute.prototype._ensureTypedArray=function(e){"use strict";null!==this.typedArray&&this.typedArray.size===e*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==e?this.typedArray.setSize(e):null===this.typedArray&&(this.typedArray=new SPE.TypedArrayHelper(this.arrayType,e,this.componentSize)))},SPE.ShaderAttribute.prototype._createBufferAttribute=function(e){"use strict";if(this._ensureTypedArray(e),null!==this.bufferAttribute)return this.bufferAttribute.array=this.typedArray.array,parseFloat(THREE.REVISION)>=81&&(this.bufferAttribute.count=this.bufferAttribute.array.length/this.bufferAttribute.itemSize),void(this.bufferAttribute.needsUpdate=!0);this.bufferAttribute=new THREE.BufferAttribute(this.typedArray.array,this.componentSize),this.bufferAttribute.setUsage(!0===this.dynamicBuffer?THREE.DynamicDrawUsage:THREE.StaticDrawUsage)},SPE.ShaderAttribute.prototype.getLength=function(){"use strict";return null===this.typedArray?0:this.typedArray.array.length},SPE.shaderChunks={defines:["#define PACKED_COLOR_SIZE 256.0","#define PACKED_COLOR_DIVISOR 255.0"].join("\n"),uniforms:["uniform float deltaTime;","uniform float runTime;","uniform sampler2D tex;","uniform vec4 textureAnimation;","uniform float scale;"].join("\n"),attributes:["attribute vec4 acceleration;","attribute vec3 velocity;","attribute vec4 rotation;","attribute vec3 rotationCenter;","attribute vec4 params;","attribute vec4 size;","attribute vec4 angle;","attribute vec4 color;","attribute vec4 opacity;","attribute vec4 trail;"].join("\n"),varyings:["varying vec4 vColor;","//#ifdef SHOULD_ROTATE_TEXTURE","    varying float vAngle;","//#endif","#ifdef SHOULD_CALCULATE_SPRITE","    varying vec4 vSpriteSheet;","#endif","#ifdef SHOULD_TRAIL_PARTICLES","    varying float fTrailSpeed;","    varying vec4 vec4Path_0;","    varying vec4 vec4Path_1;","    varying vec4 vec4Path_2;","    varying vec4 vec4Path_3;","    varying vec4 vec4Path_4;","    varying vec4 vec4Path_5;","    varying vec4 vec4Path_6;","    varying vec4 vec4Path_7;","    varying vec4 vec4Path_8;","    varying vec4 vec4Path_9;","#endif"].join("\n"),branchAvoidanceFunctions:["float when_gt(float x, float y) {","    return max(sign(x - y), 0.0);","}","float when_lt(float x, float y) {","    return min( max(1.0 - sign(x - y), 0.0), 1.0 );","}","float when_eq( float x, float y ) {","    return 1.0 - abs( sign( x - y ) );","}","float when_ge(float x, float y) {","  return 1.0 - when_lt(x, y);","}","float when_le(float x, float y) {","  return 1.0 - when_gt(x, y);","}","float and(float a, float b) {","    return a * b;","}","float or(float a, float b) {","    return min(a + b, 1.0);","}"].join("\n"),unpackColor:["vec3 unpackColor( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   return c;","}"].join("\n"),unpackRotationAxis:["vec3 unpackRotationAxis( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   c *= vec3( 2.0 );","   c -= vec3( 1.0 );","   return c;","}"].join("\n"),floatOverLifetime:["float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {","    highp float value = 0.0;","    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );","    float fIndex = 0.0;","    float shouldApplyValue = 0.0;","    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );","","    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {","       fIndex = float( i );","       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );","       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );","    }","","    return value;","}"].join("\n"),colorOverLifetime:["vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {","    vec3 value = vec3( 0.0 );","    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );","    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );","    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );","    return value;","}"].join("\n"),paramFetchingFunctions:["float getAlive() {","   return params.x;","}","float getAge() {","   return params.y;","}","float getMaxAge() {","   return params.z;","}","float getWiggle() {","   return params.w;","}"].join("\n"),forceFetchingFunctions:["vec4 getPosition( in float age ) {","   return modelViewMatrix * vec4( position, 1.0 );","}","vec3 getVelocity( in float age ) {","   return velocity * age;","}","vec3 getAcceleration( in float age ) {","   return acceleration.xyz * age;","}"].join("\n"),rotationFunctions:["#ifdef SHOULD_ROTATE_PARTICLES","   mat4 getRotationMatrix( in vec3 axis, in float angle) {","       axis = normalize(axis);","       float s = sin(angle);","       float c = cos(angle);","       float oc = 1.0 - c;","","       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","                   0.0,                                0.0,                                0.0,                                1.0);","   }","","   vec3 getRotation( in vec3 pos, in float positionInTime ) {","      if( rotation.y == 0.0 ) {","           return pos;","      }","","      vec3 axis = unpackRotationAxis( rotation.x );","      vec3 center = rotationCenter;","      vec3 translated;","      mat4 rotationMatrix;","      float angle = 0.0;","      angle += when_eq( rotation.z, 0.0 ) * rotation.y;","      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );","      translated = rotationCenter - pos;","      rotationMatrix = getRotationMatrix( axis, angle );","      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );","   }","#endif"].join("\n"),rotateTexture:["    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );","","    #ifdef SHOULD_ROTATE_TEXTURE","       float x = gl_PointCoord.x - 0.5;","       float y = 1.0 - gl_PointCoord.y - 0.5;","       float c = cos( -vAngle );","       float s = sin( -vAngle );","       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );","    #endif","","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = vSpriteSheet.x;","        float framesY = vSpriteSheet.y;","        float columnNorm = vSpriteSheet.z;","        float rowNorm = vSpriteSheet.w;","        vUv.x = gl_PointCoord.x * framesX + columnNorm;","        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);","       if(vAngle != 0.0)","       {","           lowp float cos50 = cos(-vAngle);","           lowp float sin50 = sin(-vAngle);","           vec2 rotator50 = vUv;","           lowp float fWCeil = 1.0 / textureAnimation.x;","           lowp float fHCeil = 1.0 / textureAnimation.y;","           lowp float fHalfWCeil = fWCeil * 0.5;","           lowp float fHalfHCeil = fHCeil * 0.5;","           lowp float fXCenter = 0.0;","           lowp float fYCenter = 0.0;","           for(lowp float i = 0.0; i < 20.0; i+=1.0)","           {","               if(i >= textureAnimation.x) break;","               for(lowp float j = 0.0; j < 20.0; j+=1.0)","               {","                   if(j >= textureAnimation.y) break;","                   fXCenter = (i) * (fWCeil) + fHalfWCeil;","                   fYCenter = (j) * (fHCeil) + fHalfHCeil;","                   if(pow(((vUv.x - fXCenter)/(fHalfWCeil)), 2.0) + pow(((vUv.y - fYCenter)/(fHalfHCeil)), 2.0) <= 1.0)","                       rotator50 = (mat2( cos50 , -sin50 , sin50 , cos50 ) * (vUv - vec2( fXCenter,fYCenter ))) + vec2( fXCenter,fYCenter );","                   vUv = rotator50;","               }","           }","       }","      #else","       if(vAngle != 0.0)","       {","           lowp float cos50 = cos(-vAngle);","           lowp float sin50 = sin(-vAngle);","           vec2 rotator50 = vUv;","           lowp float fWCeil = 1.0 / textureAnimation.x;","           lowp float fHCeil = 1.0 / textureAnimation.y;","           lowp float fHalfWCeil = fWCeil * 0.5;","           lowp float fHalfHCeil = fHCeil * 0.5;","           lowp float fXCenter = 0.0;","           lowp float fYCenter = 0.0;","           for(lowp float i = 0.0; i < 20.0; i+=1.0)","           {","               if(i >= textureAnimation.x) break;","               for(lowp float j = 0.0; j < 20.0; j+=1.0)","               {","                   if(j >= textureAnimation.y) break;","                   fXCenter = (i) * (fWCeil) + fHalfWCeil;","                   fYCenter = (j) * (fHCeil) + fHalfHCeil;","                   if(pow(((vUv.x - fXCenter)/(fHalfWCeil)), 2.0) + pow(((vUv.y - fYCenter)/(fHalfHCeil)), 2.0) <= 1.0)","                       rotator50 = (mat2( cos50 , -sin50 , sin50 , cos50 ) * (vUv - vec2( fXCenter,fYCenter ))) + vec2( fXCenter,fYCenter );","                   vUv = rotator50;","               }","           }","       }","    #endif","","    vec4 rotatedTexture = texture2D( tex, vUv );","    #ifdef SHOULD_TRAIL_PARTICLES","\t    float fVelocityScale = fTrailSpeed;","\t    vec2 a_0 = (vec4Path_1.xy / vec4Path_1.w) * 0.5 + 0.5;","\t    vec2 b_0 = (vec4Path_0.xy / vec4Path_0.w) * 0.5 + 0.5;","\t    vec2 velocity_0 = fVelocityScale * (a_0 - b_0);","\t    vec2 a_1 = (vec4Path_2.xy / vec4Path_2.w) * 0.5 + 0.5;","\t    vec2 b_1 = (vec4Path_1.xy / vec4Path_1.w) * 0.5 + 0.5;","\t    vec2 velocity_1 = fVelocityScale * (a_1 - b_0);","\t    vec2 a_2 = (vec4Path_3.xy / vec4Path_3.w) * 0.5 + 0.5;","\t    vec2 b_2 = (vec4Path_2.xy / vec4Path_2.w) * 0.5 + 0.5;","\t    vec2 velocity_2 = fVelocityScale * (a_2 - b_0);","\t    vec2 a_3 = (vec4Path_4.xy / vec4Path_4.w) * 0.5 + 0.5;","\t    vec2 b_3 = (vec4Path_3.xy / vec4Path_3.w) * 0.5 + 0.5;","\t    vec2 velocity_3 = fVelocityScale * (a_3 - b_0);","\t    vec2 a_4 = (vec4Path_5.xy / vec4Path_5.w) * 0.5 + 0.5;","\t    vec2 b_4 = (vec4Path_4.xy / vec4Path_4.w) * 0.5 + 0.5;","\t    vec2 velocity_4 = fVelocityScale * (a_4 - b_0);","\t    vec2 a_5 = (vec4Path_6.xy / vec4Path_6.w) * 0.5 + 0.5;","\t    vec2 b_5 = (vec4Path_5.xy / vec4Path_5.w) * 0.5 + 0.5;","\t    vec2 velocity_5 = fVelocityScale * (a_5 - b_0);","\t    vec2 a_6 = (vec4Path_7.xy / vec4Path_7.w) * 0.5 + 0.5;","\t    vec2 b_6 = (vec4Path_6.xy / vec4Path_6.w) * 0.5 + 0.5;","\t    vec2 velocity_6 = fVelocityScale * (a_6 - b_0);","\t    vec2 a_7 = (vec4Path_8.xy / vec4Path_8.w) * 0.5 + 0.5;","\t    vec2 b_7 = (vec4Path_7.xy / vec4Path_7.w) * 0.5 + 0.5;","\t    vec2 velocity_7 = fVelocityScale * (a_7 - b_0);","\t    vec2 a_8 = (vec4Path_9.xy / vec4Path_9.w) * 0.5 + 0.5;","\t    vec2 b_8 = (vec4Path_8.xy / vec4Path_8.w) * 0.5 + 0.5;","\t    vec2 velocity_8 = fVelocityScale * (a_8 - b_0);","\t    vec4 oResult;","\t    oResult = texture2D(tex, vUv);","\t    vec2 offset_0 = velocity_0 * (float(1) / float(9) - 0.5);","\t    vec2 offset_1 = velocity_1 * (float(2) / float(9) - 0.5);","\t    vec2 offset_2 = velocity_2 * (float(3) / float(9) - 0.5);","\t    vec2 offset_3 = velocity_3 * (float(4) / float(9) - 0.5);","\t    vec2 offset_4 = velocity_4 * (float(5) / float(9) - 0.5);","\t    vec2 offset_5 = velocity_5 * (float(6) / float(9) - 0.5);","\t    vec2 offset_6 = velocity_6 * (float(7) / float(9) - 0.5);","\t    vec2 offset_7 = velocity_7 * (float(8) / float(9) - 0.5);","\t    vec2 offset_8 = velocity_8 * (float(9) / float(9) - 0.5);","\t    oResult += texture2D(tex, vUv + offset_0);","\t    oResult += texture2D(tex, vUv + offset_1);","\t    oResult += texture2D(tex, vUv + offset_2);","\t    oResult += texture2D(tex, vUv + offset_3);","\t    oResult += texture2D(tex, vUv + offset_4);","\t    oResult += texture2D(tex, vUv + offset_5);","\t    oResult += texture2D(tex, vUv + offset_6);","\t    oResult += texture2D(tex, vUv + offset_7);","\t    oResult += texture2D(tex, vUv + offset_8);","       rotatedTexture = oResult;","    #endif"].join("\n")},SPE.shaders={vertex:[SPE.shaderChunks.defines,SPE.shaderChunks.uniforms,SPE.shaderChunks.attributes,SPE.shaderChunks.varyings,THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,SPE.shaderChunks.branchAvoidanceFunctions,SPE.shaderChunks.unpackColor,SPE.shaderChunks.unpackRotationAxis,SPE.shaderChunks.floatOverLifetime,SPE.shaderChunks.colorOverLifetime,SPE.shaderChunks.paramFetchingFunctions,SPE.shaderChunks.forceFetchingFunctions,SPE.shaderChunks.rotationFunctions,"void main() {","    highp float age = getAge();","    highp float alive = getAlive();","    highp float maxAge = getMaxAge();","    highp float positionInTime = (age / maxAge);","    highp float isAlive = when_gt( alive, 0.0 );","    #ifdef SHOULD_WIGGLE_PARTICLES","        float wiggleAmount = positionInTime * getWiggle();","        float wiggleSin = isAlive * sin( wiggleAmount );","        float wiggleCos = isAlive * cos( wiggleAmount );","    #endif","    vec3 vel = getVelocity( age );","    vec3 accel = getAcceleration( age );","    vec3 force = vec3( 0.0 );","    vec3 pos = vec3( position );","    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;","    force += vel;","    force *= drag;","    force += accel * age;","    pos += force;","    #ifdef SHOULD_WIGGLE_PARTICLES","        pos.x += wiggleSin;","        pos.y += wiggleCos;","        pos.z += wiggleSin;","    #endif","    #ifdef SHOULD_ROTATE_PARTICLES","        pos = getRotation( pos, positionInTime );","    #endif","    vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );","    #ifdef SHOULD_TRAIL_PARTICLES","    float fTimeStep = trail.x * trail.z;","    fTrailSpeed = trail.y;","    for(int i = 0; i < 10; i++)","    {","       highp float age_i = age - float(i) * fTimeStep;","       highp float positionInTime_i = (age_i / maxAge);","       #ifdef SHOULD_WIGGLE_PARTICLES","           float wiggleAmount_i = positionInTime_i * getWiggle();","           float wiggleSin_i = isAlive * sin( wiggleAmount_i );","           float wiggleCos_i = isAlive * cos( wiggleAmount_i );","       #endif","       vec3 vel_i = getVelocity( age_i );","       vec3 accel_i = getAcceleration( age_i );","       vec3 force_i = vec3( 0.0 );","       vec3 pos_i = vec3( position );","       float drag_i = 1.0 - (positionInTime_i * 0.5) * acceleration.w;","       force_i += vel_i;","       force_i *= drag_i;","       force_i += accel_i * age_i;","       pos_i += force_i;","       #ifdef SHOULD_WIGGLE_PARTICLES","           pos_i.x += wiggleSin_i;","           pos_i.y += wiggleCos_i;","           pos_i.z += wiggleSin_i;","       #endif","       #ifdef SHOULD_ROTATE_PARTICLES","           pos_i = getRotation( pos_i, positionInTime_i );","       #endif","       vec4 mvPosition_i = projectionMatrix * modelViewMatrix * vec4( pos_i, 1.0 );","       if(i == 0) vec4Path_0 = mvPosition_i;","       if(i == 1) vec4Path_1 = mvPosition_i;","       if(i == 2) vec4Path_2 = mvPosition_i;","       if(i == 3) vec4Path_3 = mvPosition_i;","       if(i == 4) vec4Path_4 = mvPosition_i;","       if(i == 5) vec4Path_5 = mvPosition_i;","       if(i == 6) vec4Path_6 = mvPosition_i;","       if(i == 7) vec4Path_7 = mvPosition_i;","       if(i == 8) vec4Path_8 = mvPosition_i;","       if(i == 9) vec4Path_9 = mvPosition_i;","    }","    #endif","    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;","    #ifdef HAS_PERSPECTIVE","        float perspective = scale / length( mvPosition.xyz );","    #else","        float perspective = 1.0;","    #endif","    float pointSizePerspective = pointSize * perspective;","    #ifdef COLORIZE","       vec3 c = isAlive * getColorOverLifetime(","           positionInTime,","           unpackColor( color.x ),","           unpackColor( color.y ),","           unpackColor( color.z ),","           unpackColor( color.w )","       );","    #else","       vec3 c = vec3(1.0);","    #endif","    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );","    vColor = vec4( c, o );","    //#ifdef SHOULD_ROTATE_TEXTURE","        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );","    //#endif","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = textureAnimation.x;","        float framesY = textureAnimation.y;","        float loopCount = textureAnimation.w;","        float totalFrames = textureAnimation.z;","        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );","        float column = floor(mod( frameNumber, framesX ));","        float row = floor( (frameNumber - column) / framesX );","        float columnNorm = column / framesX;","        float rowNorm = row / framesY;","        vSpriteSheet.x = 1.0 / framesX;","        vSpriteSheet.y = 1.0 / framesY;","        vSpriteSheet.z = columnNorm;","        vSpriteSheet.w = rowNorm;","    #endif","    gl_PointSize = pointSizePerspective;","    gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[SPE.shaderChunks.uniforms,THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,SPE.shaderChunks.varyings,SPE.shaderChunks.branchAvoidanceFunctions,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if ( vColor.w < float(ALPHATEST) ) discard;","    #endif",SPE.shaderChunks.rotateTexture,THREE.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},SPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,i){"use strict";return typeof e===t?e:i},ensureArrayTypedArg:function(e,t,i){"use strict";if(Array.isArray(e)){for(var r=e.length-1;r>=0;--r)if(typeof e[r]!==t)return i;return e}return this.ensureTypedArg(e,t,i)},ensureInstanceOf:function(e,t,i){"use strict";return void 0!==t&&e instanceof t?e:i},ensureArrayInstanceOf:function(e,t,i){"use strict";if(Array.isArray(e)){for(var r=e.length-1;r>=0;--r)if(void 0!==t&&e[r]instanceof t==!1)return i;return e}return this.ensureInstanceOf(e,t,i)},ensureValueOverLifetimeCompliance:function(e,t,i){"use strict";t=t||3,i=i||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);var r=this.clamp(e._value.length,t,i),n=this.clamp(e._spread.length,t,i),o=Math.max(r,n);e._value.length!==o&&(e._value=this.interpolateArray(e._value,o)),e._spread.length!==o&&(e._spread=this.interpolateArray(e._spread,o))},interpolateArray:function(e,t){"use strict";for(var i=e.length,r=["function"==typeof e[0].clone?e[0].clone():e[0]],n=(i-1)/(t-1),o=1;o<t-1;++o){var a=o*n,s=Math.floor(a),l=Math.ceil(a),u=a-s;r[o]=this.lerpTypeAgnostic(e[s],e[l],u)}return r.push("function"==typeof e[i-1].clone?e[i-1].clone():e[i-1]),r},clamp:function(e,t,i){"use strict";return Math.max(t,Math.min(e,i))},zeroToEpsilon:function(e,t){"use strict";var i=e;return i=t?1e-5*Math.random()*10:1e-5,e<0&&e>-1e-5&&(i=-i),i},lerpTypeAgnostic:function(e,t,i){"use strict";var r,n=this.types;return typeof e==n.NUMBER&&typeof t==n.NUMBER?e+(t-e)*i:e instanceof THREE.Vector2&&t instanceof THREE.Vector2||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&null==e.z&&null==e.z&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&null==t.z&&null==t.z?(e instanceof THREE.Vector2?r=e.clone():((r={}).x=e.x,r.y=e.y),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r):e instanceof THREE.Vector3&&t instanceof THREE.Vector3||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&null==e.w&&null==e.w&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&null==t.w&&null==t.w?(e instanceof THREE.Vector3?r=e.clone():((r={}).x=e.x,r.y=e.y,r.z=e.z),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r.z=this.lerp(e.z,t.z,i),r):e instanceof THREE.Vector4&&t instanceof THREE.Vector4||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&typeof e.w==n.NUMBER&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&typeof t.w==n.NUMBER?(e instanceof THREE.Vector4?r=e.clone():((r={}).x=e.x,r.y=e.y,r.z=e.z,r.w=e.w),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r.z=this.lerp(e.z,t.z,i),r.w=this.lerp(e.w,t.w,i),r):e instanceof THREE.Color&&t instanceof THREE.Color||typeof e.r==n.NUMBER&&typeof e.g==n.NUMBER&&typeof e.b==n.NUMBER&&typeof t.r==n.NUMBER&&typeof t.g==n.NUMBER&&typeof t.b==n.NUMBER?(e instanceof THREE.Color?r=e.clone():((r={}).r=e.r,r.g=e.g,r.b=e.b),r.r=this.lerp(e.r,t.r,i),r.g=this.lerp(e.g,t.g,i),r.b=this.lerp(e.b,t.b,i),r):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,i){"use strict";return e+(t-e)*i},roundToNearestMultiple:function(e,t){"use strict";var i;return 0===t?e:0===(i=Math.abs(e)%t)?e:e<0?-(Math.abs(e)-i):e+t-i},arrayValuesAreEqual:function(e){"use strict";for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){"use strict";return e+t*(Math.random()-.5)},randomVector3:function(e,t,i,r,n){"use strict";var o=i.x+(Math.random()*r.x-.5*r.x),a=i.y+(Math.random()*r.y-.5*r.y),s=i.z+(Math.random()*r.z-.5*r.z);n&&(o=.5*-n.x+this.roundToNearestMultiple(o,n.x),a=.5*-n.y+this.roundToNearestMultiple(a,n.y),s=.5*-n.z+this.roundToNearestMultiple(s,n.z)),e.typedArray.setVec3Components(t,o,a,s)},getRandomVector3:function(e,t,i){"use strict";var r=e.x+(Math.random()*t.x-.5*t.x),n=e.y+(Math.random()*t.y-.5*t.y),o=e.z+(Math.random()*t.z-.5*t.z);return i&&(r=.5*-i.x+this.roundToNearestMultiple(r,i.x),n=.5*-i.y+this.roundToNearestMultiple(n,i.y),o=.5*-i.z+this.roundToNearestMultiple(o,i.z)),new THREE.Vector3(r,n,o)},randomColor:function(e,t,i,r){"use strict";var n=i.r+Math.random()*r.x,o=i.g+Math.random()*r.y,a=i.b+Math.random()*r.z;n=this.clamp(n,0,1),o=this.clamp(o,0,1),a=this.clamp(a,0,1),e.typedArray.setVec3Components(t,n,o,a)},randomColorAsHex:function(){"use strict";var e=new THREE.Color;return function(t,i,r,n){for(var o=r.length,a=[],s=0;s<o;++s){var l=n[s];e.copy(r[s]),e.r+=Math.random()*l.x-.5*l.x,e.g+=Math.random()*l.y-.5*l.y,e.b+=Math.random()*l.z-.5*l.z,e.r=this.clamp(e.r,0,1),e.g=this.clamp(e.g,0,1),e.b=this.clamp(e.b,0,1),a.push(e.getHex())}t.typedArray.setVec4Components(i,a[0],a[1],a[2],a[3])}}(),randomVector3OnSphere:function(e,t,i,r,n,o,a,s){"use strict";var l=2*Math.random()-1,u=6.2832*Math.random(),c=Math.sqrt(1-l*l),h=this.randomFloat(r,n),p=0,d=0,f=0;a&&(h=Math.round(h/a)*a),p=c*Math.cos(u)*h,d=c*Math.sin(u)*h,f=l*h,p*=o.x,d*=o.y,f*=o.z,p+=i.x,d+=i.y,f+=i.z,e.typedArray.setVec3Components(t,p,d,f)},seededRandom:function(e){var t=1e4*Math.sin(e);return t-(0|t)},randomVector3OnDisc:function(e,t,i,r,n,o,a){"use strict";var s=6.2832*Math.random(),l=Math.abs(this.randomFloat(r,n)),u=0,c=0,h=0;a&&(l=Math.round(l/a)*a),u=Math.cos(s)*l,c=Math.sin(s)*l,u*=o.x,c*=o.y,u+=i.x,c+=i.y,h+=i.z,e.typedArray.setVec3Components(t,u,c,h)},randomDirectionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,i,r,n,o,a,s,l){e.copy(a),e.x-=r,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(i,e.x,e.y,e.z)}}(),directionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,i,r,n,o,a,s,l,u,c){e.copy(a),e.x-=r,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l));var h=this.getRandomVector3(u,c);e.add(h),t.typedArray.setVec3Components(i,e.x,e.y,e.z)}}(),randomDirectionVector3OnDisc:function(){"use strict";var e=new THREE.Vector3;return function(t,i,r,n,o,a,s,l){e.copy(a),e.x-=r,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(i,e.x,e.y,0)}}(),getPackedRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Color,r=new THREE.Vector3(1,1,1);return function(n,o){return e.copy(n).normalize(),t.copy(o).normalize(),e.x+=.5*-o.x+Math.random()*o.x,e.y+=.5*-o.y+Math.random()*o.y,e.z+=.5*-o.z+Math.random()*o.z,e.normalize().add(r).multiplyScalar(.5),i.setRGB(e.x,e.y,e.z),i.getHex()}}()},SPE.Group=function(e){"use strict";var t=SPE.utils,i=t.types;(e=t.ensureTypedArg(e,i.OBJECT,{})).texture=t.ensureTypedArg(e.texture,i.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,i.NUMBER,.016),null!=e.texture.frames&&null!=e.texture.frames&&(e.texture.frames.x=t.ensureTypedArg(e.texture.frames.x,i.NUMBER,1),e.texture.frames.y=t.ensureTypedArg(e.texture.frames.y,i.NUMBER,1)),this.texture=t.ensureInstanceOf(e.texture.value,THREE.Texture,null),this.textureFrames=t.ensureInstanceOf(new THREE.Vector2(e.texture.frames.x,e.texture.frames.y),THREE.Vector2,new THREE.Vector2(1,1)),this.textureFrameCount=t.ensureTypedArg(e.texture.frameCount,i.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=t.ensureTypedArg(e.texture.loop,i.NUMBER,1),this.textureFrames.max(new THREE.Vector2(1,1)),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,i.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,i.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,i.NUMBER,null),this.vec4Quaternion=t.ensureInstanceOf(e.vec4Quaternion,THREE.Vector4,new THREE.Vector4(0,0,0,1)),this.vec4Quaternion=this.vec4Quaternion.normalize(),this.blending=t.ensureTypedArg(e.blending,i.NUMBER,THREE.AdditiveBlending),this.transparent=t.ensureTypedArg(e.transparent,i.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,i.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,i.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,i.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,i.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,i.NUMBER,300),this.emitters=[],this.emitterIDs=[],this._pool=[],this._poolCreationSettings=null,this._createNewWhenPoolEmpty=0,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0,this.uniforms={tex:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new THREE.Vector4(this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}},this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:SPE.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_TRAIL_PARTICLES:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:this.textureFrames.x>1||this.textureFrames.y>1},this.attributes={position:new SPE.ShaderAttribute("v3",!0),acceleration:new SPE.ShaderAttribute("v4",!0),velocity:new SPE.ShaderAttribute("v3",!0),rotation:new SPE.ShaderAttribute("v4",!0),rotationCenter:new SPE.ShaderAttribute("v3",!0),params:new SPE.ShaderAttribute("v4",!0),size:new SPE.ShaderAttribute("v4",!0),angle:new SPE.ShaderAttribute("v4",!0),color:new SPE.ShaderAttribute("v4",!0),opacity:new SPE.ShaderAttribute("v4",!0),trail:new SPE.ShaderAttribute("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:SPE.shaders.vertex,fragmentShader:SPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog}),this.geometry=new THREE.BufferGeometry,this.mesh=new THREE.Points(this.geometry,this.material),null===this.maxParticleCount&&console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")},SPE.Group.constructor=SPE.Group,SPE.Group.prototype._updateDefines=function(){"use strict";for(var e,t=this.emitters,i=t.length-1,r=this.defines;i>=0;--i)e=t[i],r.SHOULD_CALCULATE_SPRITE||(r.SHOULD_ROTATE_TEXTURE=r.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,e.angle.value),Math.max.apply(null,e.angle.spread))),r.SHOULD_ROTATE_PARTICLES=r.SHOULD_ROTATE_PARTICLES||!!Math.max(e.rotation.angle,e.rotation.angleSpread),r.SHOULD_WIGGLE_PARTICLES=r.SHOULD_WIGGLE_PARTICLES||!!Math.max(e.wiggle.value,e.wiggle.spread),r.SHOULD_TRAIL_PARTICLES=r.SHOULD_TRAIL_PARTICLES||!!Math.max(e.trail.value,e.trail.spread);this.material.needsUpdate=!0},SPE.Group.prototype._applyAttributesToGeometry=function(){"use strict";var e,t,i=this.attributes,r=this.geometry,n=r.attributes;for(var o in i)i.hasOwnProperty(o)&&(e=i[o],(t=n[o])?t.array=e.typedArray.array:r.setAttribute(o,e.bufferAttribute),e.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)},SPE.Group.prototype.addEmitter=function(e){"use strict";if(e instanceof SPE.Emitter!=!1)if(this.emitterIDs.indexOf(e.uuid)>-1)console.error("Emitter already exists in this group. Will not add again.");else{if(null===e.group){var t=this.attributes,i=this.particleCount,r=i+e.particleCount;for(var n in this.particleCount=r,null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e._setBufferUpdateRanges(this.attributeKeys),e._setAttributeOffset(i),e.group=this,e.attributes=this.attributes,t)t.hasOwnProperty(n)&&t[n]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);for(var o=i;o<r;++o)e._assignPositionValue(o),e._assignForceValue(o,"velocity"),e._assignAccForceValue(o,"acceleration"),e._assignAbsLifetimeValue(o,"opacity"),e._assignAbsLifetimeValue(o,"size"),e._assignAngleValue(o),e._assignRotationValue(o),e._assignParamsValue(o),e._assignColorValue(o),e._assignTrailValue(o);return this._applyAttributesToGeometry(),this.emitters.push(e),this.emitterIDs.push(e.uuid),this._updateDefines(e),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this}console.error("Emitter already belongs to another group. Will not add to requested group.")}else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e)},SPE.Group.prototype.removeEmitter=function(e){"use strict";var t=this.emitterIDs.indexOf(e.uuid);if(e instanceof SPE.Emitter!=!1)if(-1!==t){for(var i=e.attributeOffset,r=i+e.particleCount,n=this.attributes.params.typedArray,o=i;o<r;++o)n.array[4*o]=0,n.array[4*o+1]=0;for(var a in this.emitters.splice(t,1),this.emitterIDs.splice(t,1),this.attributes)this.attributes.hasOwnProperty(a)&&this.attributes[a].splice(i,r);this.particleCount-=e.particleCount,e._onRemove(),this._attributesNeedRefresh=!0}else console.error("Emitter does not exist in this group. Will not remove.");else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e)},SPE.Group.prototype.getFromPool=function(){"use strict";var e=this._pool,t=this._createNewWhenPoolEmpty;if(e.length)return e.pop();if(t){var i=new SPE.Emitter(this._poolCreationSettings);return this.addEmitter(i),i}return null},SPE.Group.prototype.releaseIntoPool=function(e){"use strict";if(e instanceof SPE.Emitter!=!1)return e.reset(),this._pool.unshift(e),this;console.error("Argument is not instanceof SPE.Emitter:",e)},SPE.Group.prototype.getPool=function(){"use strict";return this._pool},SPE.Group.prototype.addPool=function(e,t,i){"use strict";var r;this._poolCreationSettings=t,this._createNewWhenPoolEmpty=!!i;for(var n=0;n<e;++n)r=Array.isArray(t)?new SPE.Emitter(t[n]):new SPE.Emitter(t),this.addEmitter(r),this.releaseIntoPool(r);return this},SPE.Group.prototype._triggerSingleEmitter=function(e){"use strict";var t=this.getFromPool(),i=this;if(null!==t)return e instanceof THREE.Vector3&&(t.position.value.copy(e),t.position.value=t.position.value),t.enable(),setTimeout((function(){t.disable(),i.releaseIntoPool(t)}),1e3*Math.max(t.duration,t.maxAge.value+t.maxAge.spread)),this;console.log("SPE.Group pool ran out.")},SPE.Group.prototype.triggerPoolEmitter=function(e,t){"use strict";if("number"==typeof e&&e>1)for(var i=0;i<e;++i)this._triggerSingleEmitter(t);else this._triggerSingleEmitter(t);return this},SPE.Group.prototype._updateUniforms=function(e){"use strict";this.uniforms.runTime.value+=e,this.uniforms.deltaTime.value=e},SPE.Group.prototype._resetBufferRanges=function(){"use strict";for(var e=this.attributeKeys,t=this.attributeCount-1,i=this.attributes;t>=0;--t)i[e[t]].resetUpdateRange()},SPE.Group.prototype._updateBuffers=function(e){"use strict";for(var t,i,r,n=this.attributeKeys,o=this.attributeCount-1,a=this.attributes,s=e.bufferUpdateRanges;o>=0;--o)i=s[t=n[o]],(r=a[t]).setUpdateRange(i.min,i.max),r.flagUpdate()},SPE.Group.prototype.tick=function(e){"use strict";var t=this.emitters,i=t.length,r=e||this.fixedTimeStep,n=this.attributeKeys,o=this.attributes;if(this._updateUniforms(r),this._resetBufferRanges(),0!==i||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(var a,s=0;s<i;++s)(a=t[s]).tick(r),this._updateBuffers(a);if(!0===this._attributesNeedDynamicReset){for(s=this.attributeCount-1;s>=0;--s)o[n[s]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(s=this.attributeCount-1;s>=0;--s)o[n[s]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}},SPE.Group.prototype.dispose=function(){"use strict";return this.geometry.dispose(),this.material.dispose(),this},SPE.Emitter=function(e){"use strict";var t=SPE.utils,i=t.types,r=SPE.valueOverLifetimeLength;for(var n in(e=t.ensureTypedArg(e,i.OBJECT,{})).position=t.ensureTypedArg(e.position,i.OBJECT,{}),e.velocity=t.ensureTypedArg(e.velocity,i.OBJECT,{}),e.acceleration=t.ensureTypedArg(e.acceleration,i.OBJECT,{}),e.radius=t.ensureTypedArg(e.radius,i.OBJECT,{}),e.drag=t.ensureTypedArg(e.drag,i.OBJECT,{}),e.rotation=t.ensureTypedArg(e.rotation,i.OBJECT,{}),e.color=t.ensureTypedArg(e.color,i.OBJECT,{}),e.opacity=t.ensureTypedArg(e.opacity,i.OBJECT,{}),e.size=t.ensureTypedArg(e.size,i.OBJECT,{}),e.angle=t.ensureTypedArg(e.angle,i.OBJECT,{}),e.wiggle=t.ensureTypedArg(e.wiggle,i.OBJECT,{}),e.trail=t.ensureTypedArg(e.trail,i.OBJECT,{}),e.maxAge=t.ensureTypedArg(e.maxAge,i.OBJECT,{}),e.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime."),this.uuid=THREE.Math.generateUUID(),this.type=t.ensureTypedArg(e.type,i.NUMBER,SPE.distributions.BOX),this.position={_value:t.ensureInstanceOf(e.position.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.position.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1),_radius:t.ensureTypedArg(e.position.radius,i.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.position.distributionClamp,i.NUMBER,0)},this.velocity={_value:t.ensureInstanceOf(e.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.velocity.spread,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.velocity.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.acceleration={_value:t.ensureInstanceOf(e.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.acceleration.spread,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.acceleration.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.drag={_value:t.ensureTypedArg(e.drag.value,i.NUMBER,0),_spread:t.ensureTypedArg(e.drag.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.wiggle={_value:t.ensureTypedArg(e.wiggle.value,i.NUMBER,0),_spread:t.ensureTypedArg(e.wiggle.spread,i.NUMBER,0)},this.rotation={_axis:t.ensureInstanceOf(e.rotation.axis,THREE.Vector3,new THREE.Vector3(0,1,0)),_axisSpread:t.ensureInstanceOf(e.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:t.ensureTypedArg(e.rotation.angle,i.NUMBER,0),_angleSpread:t.ensureTypedArg(e.rotation.angleSpread,i.NUMBER,0),_static:t.ensureTypedArg(e.rotation.static,i.BOOLEAN,!1),_center:t.ensureInstanceOf(e.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.maxAge={_value:t.ensureTypedArg(e.maxAge.value,i.NUMBER,2),_spread:t.ensureTypedArg(e.maxAge.spread,i.NUMBER,0)},this.color={_value:t.ensureArrayInstanceOf(e.color.value,THREE.Color,new THREE.Color),_spread:t.ensureArrayInstanceOf(e.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.opacity={_value:t.ensureArrayTypedArg(e.opacity.value,i.NUMBER,1),_spread:t.ensureArrayTypedArg(e.opacity.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.size={_value:t.ensureArrayTypedArg(e.size.value,i.NUMBER,1),_spread:t.ensureArrayTypedArg(e.size.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.angle={_value:t.ensureArrayTypedArg(e.angle.value,i.NUMBER,0),_spread:t.ensureArrayTypedArg(e.angle.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.bInitSpeed=!1,this.bInitSpeedAcc=!1,this.particleCount=t.ensureTypedArg(e.particleCount,i.NUMBER,100),this.duration=t.ensureTypedArg(e.duration,i.NUMBER,null),this.isStatic=t.ensureTypedArg(e.isStatic,i.BOOLEAN,!1),this.activeMultiplier=t.ensureTypedArg(e.activeMultiplier,i.NUMBER,1),this.direction=t.ensureTypedArg(e.direction,i.NUMBER,1),this.trail={_value:t.ensureArrayTypedArg(e.trail.value,i.NUMBER,0),_spread:t.ensureArrayTypedArg(e.trail.spread,i.NUMBER,0),_step:t.ensureArrayTypedArg(e.trail.step,i.NUMBER,0),_stepSpread:t.ensureArrayTypedArg(e.trail.stepSpread,i.NUMBER,0),_direction:t.ensureArrayTypedArg(e.trail.direction,i.NUMBER,-1*this.direction)},this.alive=t.ensureTypedArg(e.alive,i.BOOLEAN,!0),this.particlesPerSecond=0,this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.age=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.resetFlags={position:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)||t.ensureTypedArg(e.radius.randomise,i.BOOLEAN,!1),velocity:t.ensureTypedArg(e.velocity.randomise,i.BOOLEAN,!1),acceleration:t.ensureTypedArg(e.acceleration.randomise,i.BOOLEAN,!1)||t.ensureTypedArg(e.drag.randomise,i.BOOLEAN,!1),rotation:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),rotationCenter:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),size:t.ensureTypedArg(e.size.randomise,i.BOOLEAN,!1),color:t.ensureTypedArg(e.color.randomise,i.BOOLEAN,!1),opacity:t.ensureTypedArg(e.opacity.randomise,i.BOOLEAN,!1),angle:t.ensureTypedArg(e.angle.randomise,i.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle",trail:"trail"},this.updateMap)this.updateMap.hasOwnProperty(n)&&(this.updateCounts[this.updateMap[n]]=0,this.updateFlags[this.updateMap[n]]=!1,this._createGetterSetters(this[n],n));this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0,t.ensureValueOverLifetimeCompliance(this.color,r,r),t.ensureValueOverLifetimeCompliance(this.opacity,r,r),t.ensureValueOverLifetimeCompliance(this.size,r,r),t.ensureValueOverLifetimeCompliance(this.angle,r,r)},SPE.Emitter.constructor=SPE.Emitter,SPE.Emitter.prototype._createGetterSetters=function(e,t){"use strict";var i=this;for(var r in e)if(e.hasOwnProperty(r)){var n=r.replace("_","");Object.defineProperty(e,n,{get:function(e){return function(){return this[e]}}(r),set:function(e){return function(r){var n=i.updateMap[t],o=this[e],a=SPE.valueOverLifetimeLength;"_rotationCenter"===e?(i.updateFlags.rotationCenter=!0,i.updateCounts.rotationCenter=0):"_randomise"===e?i.resetFlags[n]=r:(i.updateFlags[n]=!0,i.updateCounts[n]=0),i.group._updateDefines(),this[e]=r,Array.isArray(o)&&SPE.utils.ensureValueOverLifetimeCompliance(i[t],a,a)}}(r)})}},SPE.Emitter.prototype._setBufferUpdateRanges=function(e){"use strict";this.attributeKeys=e,this.attributeCount=e.length;for(var t=this.attributeCount-1;t>=0;--t)this.bufferUpdateRanges[e[t]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}},SPE.Emitter.prototype._calculatePPSValue=function(e){"use strict";var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e},SPE.Emitter.prototype._setAttributeOffset=function(e){this.attributeOffset=e,this.activationIndex=e,this.activationEnd=e+this.particleCount},SPE.Emitter.prototype._assignValue=function(e,t){"use strict";switch(e){case"position":this._assignPositionValue(t);break;case"velocity":this._assignForceValue(t,e);break;case"acceleration":this._assignAccForceValue(t,e);break;case"size":case"opacity":this._assignAbsLifetimeValue(t,e);break;case"angle":this._assignAngleValue(t);break;case"params":this._assignParamsValue(t);break;case"rotation":this._assignRotationValue(t);break;case"color":this._assignColorValue(t);break;case"trail":this._assignTrailValue(t)}},SPE.Emitter.prototype._assignPositionValue=function(e){"use strict";var t=SPE.distributions,i=SPE.utils,r=this.position,n=this.attributes.position,o=r._value,a=r._spread;switch(r._distribution){case t.BOX:i.randomVector3(n,e,o,a,r._spreadClamp);break;case t.SPHERE:i.randomVector3OnSphere(n,e,o,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x,r._distributionClamp||this.particleCount);break;case t.DISC:i.randomVector3OnDisc(n,e,o,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x)}},SPE.Emitter.prototype._assignTrailValue=function(e){"use strict";this.attributes.trail.typedArray.setVec4Components(e,this.trail._direction,SPE.utils.randomFloat(this.trail._value,this.trail._spread),SPE.utils.randomFloat(this.trail._step,this.trail._stepSpread))},SPE.Emitter.prototype._assignForceValue=function(e,t){"use strict";var i=this.group.vec4Quaternion.clone();i=i.normalize();var r,n,o,a,s,l=SPE.distributions,u=SPE.utils,c=this[t],h=c._value,p=c._spread,d=c._distribution;switch(this.bInitSpeed||(h=h.applyQuaternion(i),p=p.applyQuaternion(i),this.bInitSpeed=!0),d){case l.BOX:u.randomVector3(this.attributes[t],e,h,p);break;case l.SPHERE:n=(r=this.attributes.position.typedArray.array)[s=3*e],o=r[s+1],a=r[s+2],u.randomDirectionVector3OnSphere(this.attributes[t],e,n,o,a,this.position._value,c._value.x,c._spread.x);break;case l.DISC:n=(r=this.attributes.position.typedArray.array)[s=3*e],o=r[s+1],a=r[s+2],u.randomDirectionVector3OnDisc(this.attributes[t],e,n,o,a,this.position._value,c._value.x,c._spread.x)}if("acceleration"===t){var f=u.clamp(u.randomFloat(this.drag._value,this.drag._spread),0,2);this.attributes.acceleration.typedArray.array[4*e+3]=f}},SPE.Emitter.prototype._assignAccForceValue=function(e,t){"use strict";var i=this.group.vec4Quaternion.clone();i=i.normalize();var r,n,o,a,s,l=SPE.distributions,u=SPE.utils,c=this[t],h=this.velocity,p=c._value,d=c._spread,f=c._distribution;switch(this.bInitSpeedAcc||(p=p.applyQuaternion(i),d=d.applyQuaternion(i),this.bInitSpeedAcc=!0),f){case l.BOX:u.randomVector3(this.attributes[t],e,p,d);break;case l.SPHERE:n=(r=this.attributes.position.typedArray.array)[s=3*e],o=r[s+1],a=r[s+2],u.directionVector3OnSphere(this.attributes[t],e,n,o,a,this.position._value,h._value.y,h._spread.y,c._value,c._spread);break;case l.DISC:n=(r=this.attributes.position.typedArray.array)[s=3*e],o=r[s+1],a=r[s+2],u.randomDirectionVector3OnDisc(this.attributes[t],e,n,o,a,this.position._value,c._value.x,c._spread.x)}if("acceleration"===t){var m=u.clamp(u.randomFloat(this.drag._value,this.drag._spread),0,2);this.attributes.acceleration.typedArray.array[4*e+3]=m}},SPE.Emitter.prototype._assignAbsLifetimeValue=function(e,t){"use strict";var i,r=this.attributes[t].typedArray,n=this[t],o=SPE.utils;o.arrayValuesAreEqual(n._value)&&o.arrayValuesAreEqual(n._spread)?(i=Math.abs(o.randomFloat(n._value[0],n._spread[0])),r.setVec4Components(e,i,i,i,i)):r.setVec4Components(e,Math.abs(o.randomFloat(n._value[0],n._spread[0])),Math.abs(o.randomFloat(n._value[1],n._spread[1])),Math.abs(o.randomFloat(n._value[2],n._spread[2])),Math.abs(o.randomFloat(n._value[3],n._spread[3])))},SPE.Emitter.prototype._assignAngleValue=function(e){"use strict";var t,i=this.attributes.angle.typedArray,r=this.angle,n=SPE.utils;n.arrayValuesAreEqual(r._value)&&n.arrayValuesAreEqual(r._spread)?(t=n.randomFloat(r._value[0],r._spread[0]),i.setVec4Components(e,t,t,t,t)):i.setVec4Components(e,n.randomFloat(r._value[0],r._spread[0]),n.randomFloat(r._value[1],r._spread[1]),n.randomFloat(r._value[2],r._spread[2]),n.randomFloat(r._value[3],r._spread[3]))},SPE.Emitter.prototype._assignParamsValue=function(e){"use strict";this.attributes.params.typedArray.setVec4Components(e,this.isStatic?1:0,0,Math.abs(SPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),SPE.utils.randomFloat(this.wiggle._value,this.wiggle._spread))},SPE.Emitter.prototype._assignRotationValue=function(e){"use strict";this.attributes.rotation.typedArray.setVec3Components(e,SPE.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),SPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1),this.attributes.rotationCenter.typedArray.setVec3(e,this.rotation._center)},SPE.Emitter.prototype._assignColorValue=function(e){"use strict";SPE.utils.randomColorAsHex(this.attributes.color,e,this.color._value,this.color._spread)},SPE.Emitter.prototype._resetParticle=function(e){"use strict";for(var t,i,r=this.resetFlags,n=this.updateFlags,o=this.updateCounts,a=this.attributeKeys,s=this.attributeCount-1;s>=0;--s)i=n[t=a[s]],!0!==r[t]&&!0!==i||(this._assignValue(t,e),this._updateAttributeUpdateRange(t,e),!0===i&&o[t]===this.particleCount?(n[t]=!1,o[t]=0):1==i&&++o[t])},SPE.Emitter.prototype._updateAttributeUpdateRange=function(e,t){"use strict";var i=this.bufferUpdateRanges[e];i.min=Math.min(t,i.min),i.max=Math.max(t,i.max)},SPE.Emitter.prototype._resetBufferRanges=function(){"use strict";for(var e,t=this.bufferUpdateRanges,i=this.bufferUpdateKeys,r=this.bufferUpdateCount-1;r>=0;--r)t[e=i[r]].min=Number.POSITIVE_INFINITY,t[e].max=Number.NEGATIVE_INFINITY},SPE.Emitter.prototype._onRemove=function(){"use strict";this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0},SPE.Emitter.prototype._decrementParticleCount=function(){"use strict";--this.activeParticleCount},SPE.Emitter.prototype._incrementParticleCount=function(){"use strict";++this.activeParticleCount},SPE.Emitter.prototype._checkParticleAges=function(e,t,i,r){"use strict";for(var n,o,a,s,l=t-1;l>=e;--l)0!==(s=i[n=4*l])&&(a=i[n+1],o=i[n+2],1===this.direction?(a+=r)>=o&&(a=0,s=0,this._decrementParticleCount()):(a-=r)<=0&&(a=o,s=0,this._decrementParticleCount()),i[n]=s,i[n+1]=a,this._updateAttributeUpdateRange("params",l))},SPE.Emitter.prototype._activateParticles=function(e,t,i,r){"use strict";for(var n,o,a=this.direction,s=e;s<t;++s)0!=i[n=4*s]&&1!==this.particleCount||(this._incrementParticleCount(),i[n]=1,this._resetParticle(s),o=r*(s-e),i[n+1]=-1===a?i[n+2]-o:o,this._updateAttributeUpdateRange("params",s))},SPE.Emitter.prototype.tick=function(e){"use strict";if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var t=this.attributeOffset,i=t+this.particleCount,r=this.paramsArray,n=this.particlesPerSecond*this.activeMultiplier*e,o=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(t,i,r,e),!1!==this.alive){if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);var a=1===this.particleCount?o:0|o,s=Math.min(a+n,this.activationEnd),l=s-this.activationIndex|0,u=l>0?e/l:0;this._activateParticles(a,s,r,u),this.activationIndex+=n,this.activationIndex>i&&(this.activationIndex=t),this.age+=e}else this.age=0}},SPE.Emitter.prototype.reset=function(e){"use strict";if(this.age=0,this.alive=!1,!0===e){for(var t,i=this.attributeOffset,r=i+this.particleCount,n=this.paramsArray,o=this.attributes.params.bufferAttribute,a=r-1;a>=i;--a)n[t=4*a]=0,n[t+1]=0;o.updateRange.offset=0,o.updateRange.count=-1,o.needsUpdate=!0}return this},SPE.Emitter.prototype.enable=function(){"use strict";return this.alive=!0,this},SPE.Emitter.prototype.disable=function(){"use strict";return this.alive=!1,this},SPE.Emitter.prototype.remove=function(){"use strict";return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Stats=t()}(this,(function(){var e=function(){function t(e){return n.appendChild(e.dom),e}function i(e){for(var t=0;t<n.children.length;t++)n.children[t].style.display=t===e?"block":"none";r=e}var r=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",(function(e){e.preventDefault(),i(++r%n.children.length)}),!1);var o=(performance||Date).now(),a=o,s=0,l=t(new e.Panel("FPS","#0ff","#002")),u=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new e.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:n,addPanel:t,showPanel:i,begin:function(){o=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(u.update(e-o,200),e>a+1e3&&(l.update(1e3*s/(e-a),100),a=e,s=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:n,setMode:i}};return e.Panel=function(e,t,i){var r=1/0,n=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,l=48*a,u=3*a,c=2*a,h=3*a,p=15*a,d=74*a,f=30*a,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,s,l),g.fillStyle=t,g.fillText(e,u,c),g.fillRect(h,p,d,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(h,p,d,f),{dom:m,update:function(l,v){r=Math.min(r,l),n=Math.max(n,l),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,s,p),g.fillStyle=t,g.fillText(o(l)+" "+e+" ("+o(r)+"-"+o(n)+")",u,c),g.drawImage(m,h+a,p,d-a,f,h,p,d-a,f),g.fillRect(h+d-a,p,a,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(h+d-a,p,a,o((1-l/v)*f))}}},e})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.thingjs={})}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}function o(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.dracoLoader=null}function a(){var e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}o.prototype={constructor:o,crossOrigin:"anonymous",load:function(e,t,i,r){var n,o=this;n=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),o.manager.itemStart(e);var a=function(t){var i=!1;r?i=r(t):console.error(t),i||o.manager.itemError(e),o.manager.itemEnd(e)},s=new THREE.FileLoader(o.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.load(e,(function(i){try{o.parse(i,n,(function(i){t(i),o.manager.itemEnd(e)}),a)}catch(e){a(e)}}),i,a)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(e,t,i,r){var n,o={};if("string"==typeof e)n=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===h){try{o[s.KHR_BINARY_GLTF]=new f(e)}catch(e){return void(r&&r(e))}n=o[s.KHR_BINARY_GLTF].content}else n=THREE.LoaderUtils.decodeText(new Uint8Array(e));var a=JSON.parseX(n,this);if(a)if(void 0===a.asset||a.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(a.extensionsUsed)for(var p=0;p<a.extensionsUsed.length;++p){var d=a.extensionsUsed[p],y=a.extensionsRequired||[];switch(d){case s.KHR_LIGHTS_PUNCTUAL:o[d]=new u(a);break;case s.KHR_MATERIALS_UNLIT:o[d]=new c(a);break;case s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[d]=new v(a);break;case s.KHR_DRACO_MESH_COMPRESSION:o[d]=new m(a,this.dracoLoader);break;case s.MSFT_TEXTURE_DDS:o[s.MSFT_TEXTURE_DDS]=new l(a);break;case s.KHR_TEXTURE_TRANSFORM:o[s.KHR_TEXTURE_TRANSFORM]=new g(a);break;default:y.indexOf(d)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}var b=new W(a,o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});b.parse((function(e,t,r,n,a){b.getDependencies("material").then((function(s){var l={scene:e,scenes:t,cameras:r,animations:n,asset:a.asset,parser:b,userData:{},materials:s};H(o,l,a),i(l)}))}),r)}else r&&r(new Error("THREE.GLTFLoader: Unsupported JSON data."))}};var s={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function l(){if(!THREE.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=s.MSFT_TEXTURE_DDS,this.ddsLoader=new THREE.DDSLoader}function u(e){this.name=s.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[s.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function c(e){this.name=s.KHR_MATERIALS_UNLIT}u.prototype.loadLight=function(e){var t,i=this.lightDefs[e],r=new THREE.Color(16777215);void 0!==i.color&&r.fromArray(i.color);var n=void 0!==i.range?i.range:0;switch(i.type){case"directional":(t=new THREE.DirectionalLight(r)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(r)).distance=n;break;case"spot":(t=new THREE.SpotLight(r)).distance=n,i.spot=i.spot||{},i.spot.innerConeAngle=void 0!==i.spot.innerConeAngle?i.spot.innerConeAngle:0,i.spot.outerConeAngle=void 0!==i.spot.outerConeAngle?i.spot.outerConeAngle:Math.PI/4,t.angle=i.spot.outerConeAngle,t.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+i.type+'".')}return t.decay=2,void 0!==i.intensity&&(t.intensity=i.intensity),t.name=i.name||"light_"+e,Promise.resolve(t)},c.prototype.getMaterialType=function(e){return THREE.MeshBasicMaterial},c.prototype.extendParams=function(e,t,i){var r=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var o=n.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==n.baseColorTexture&&r.push(i.assignTexture(e,"map",n.baseColorTexture))}return Promise.all(r)};var h="glTF",p=12,d={JSON:1313821514,BIN:5130562};function f(e){this.name=s.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,p);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==h)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var i=new DataView(e,p),r=0;r<i.byteLength;){var n=i.getUint32(r,!0);r+=4;var o=i.getUint32(r,!0);if(r+=4,o===d.JSON){var a=new Uint8Array(e,p+r,n);this.content=THREE.LoaderUtils.decodeText(a)}else if(o===d.BIN){var l=p+r;this.body=e.slice(l,l+n)}r+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function m(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=s.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,THREE.DRACOLoader.getDecoderModule()}function g(e){this.name=s.KHR_TEXTURE_TRANSFORM}function v(){return{name:s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,t,i){var r=t.extensions[this.name],n=THREE.ShaderLib.standard,o=THREE.UniformsUtils.clone(n.uniforms),a=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),u=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),c=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),h=n.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",a).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",u).replace("#include <lights_physical_fragment>",c);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new THREE.Color).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},e.vertexShader=n.vertexShader,e.fragmentShader=h,e.uniforms=o,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var p=[];if(Array.isArray(r.diffuseFactor)){var d=r.diffuseFactor;e.color.fromArray(d),e.opacity=d[3]}if(void 0!==r.diffuseTexture&&p.push(i.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var f=r.specularGlossinessTexture;p.push(i.assignTexture(e,"glossinessMap",f)),p.push(i.assignTexture(e,"specularMap",f))}return Promise.all(p)},createMaterial:function(e){var t=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var i=this.specularGlossinessParams,r=0,n=i.length;r<n;r++)t[i[r]]=e[i[r]];return t},refreshUniforms:function(e,t,i,r,n,o){if(!0===n.isGLTFSpecularGlossinessMaterial){var a,s=n.uniforms,l=n.defines;s.opacity.value=n.opacity,s.diffuse.value.copy(n.color),s.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),s.map.value=n.map,s.specularMap.value=n.specularMap,s.alphaMap.value=n.alphaMap,s.lightMap.value=n.lightMap,s.lightMapIntensity.value=n.lightMapIntensity,s.aoMap.value=n.aoMap,s.aoMapIntensity.value=n.aoMapIntensity,n.map?a=n.map:n.specularMap?a=n.specularMap:n.displacementMap?a=n.displacementMap:n.normalMap?a=n.normalMap:n.bumpMap?a=n.bumpMap:n.glossinessMap?a=n.glossinessMap:n.alphaMap?a=n.alphaMap:n.emissiveMap&&(a=n.emissiveMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),s.uvTransform.value.copy(a.matrix)),n.envMap&&(s.envMap.value=n.envMap,s.envMapIntensity.value=n.envMapIntensity,s.flipEnvMap.value=n.envMap.isCubeTexture?-1:1,s.reflectivity.value=n.reflectivity,s.refractionRatio.value=n.refractionRatio,s.maxMipLevel.value=e.properties.get(n.envMap).__maxMipLevel),s.specular.value.copy(n.specular),s.glossiness.value=n.glossiness,s.glossinessMap.value=n.glossinessMap,s.emissiveMap.value=n.emissiveMap,s.bumpMap.value=n.bumpMap,s.normalMap.value=n.normalMap,s.displacementMap.value=n.displacementMap,s.displacementScale.value=n.displacementScale,s.displacementBias.value=n.displacementBias,null!==s.glossinessMap.value&&void 0===l.USE_GLOSSINESSMAP&&(l.USE_GLOSSINESSMAP="",l.USE_ROUGHNESSMAP=""),null===s.glossinessMap.value&&void 0!==l.USE_GLOSSINESSMAP&&(delete l.USE_GLOSSINESSMAP,delete l.USE_ROUGHNESSMAP)}}}}function y(e,t,i,r){THREE.Interpolant.call(this,e,t,i,r)}m.prototype.decodePrimitive=function(e,t){var i=this.json,r=this.dracoLoader,n=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(var u in o)u in D&&(a[D[u]]=o[u]);for(u in e.attributes)if(void 0!==D[u]&&void 0!==o[u]){var c=i.accessors[e.attributes[u]],h=A[c.componentType];l[D[u]]=h,s[D[u]]=!0===c.normalized}return t.getDependency("bufferView",n).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var i in e.attributes){var r=e.attributes[i],n=s[i];void 0!==n&&(r.normalized=n)}t(e)}),a,l)}))}))},g.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},y.prototype=Object.create(THREE.Interpolant.prototype),y.prototype.constructor=y,y.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r*3+r,o=0;o!==r;o++)t[o]=i[n+o];return t},y.prototype.beforeStart_=y.prototype.copySampleValue_,y.prototype.afterEnd_=y.prototype.copySampleValue_,y.prototype.interpolate_=function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,u=r-t,c=(i-t)/u,h=c*c,p=h*c,d=e*l,f=d-l,m=-2*p+3*h,g=p-h,v=1-m,y=g-h+c,b=0;b!==a;b++){var _=o[f+b+a],x=o[f+b+s]*u,E=o[d+b+a],w=o[d+b]*u;n[b]=v*_+y*x+m*E+g*w}return n};var b=0,_=1,x=2,E=3,w=4,T=5,S=6,A=(THREE.Matrix3,THREE.Matrix4,THREE.Vector2,THREE.Vector3,THREE.Vector4,THREE.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),M={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},C={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},R=(THREE.BackSide,THREE.FrontSide,THREE.NeverDepth,THREE.LessDepth,THREE.EqualDepth,THREE.LessEqualDepth,THREE.GreaterEqualDepth,THREE.NotEqualDepth,THREE.GreaterEqualDepth,THREE.AlwaysDepth,THREE.AddEquation,THREE.SubtractEquation,THREE.ReverseSubtractEquation,THREE.ZeroFactor,THREE.OneFactor,THREE.SrcColorFactor,THREE.OneMinusSrcColorFactor,THREE.SrcAlphaFactor,THREE.OneMinusSrcAlphaFactor,THREE.DstAlphaFactor,THREE.OneMinusDstAlphaFactor,THREE.DstColorFactor,THREE.OneMinusDstColorFactor,THREE.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),D={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",TEXCOORD_2:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},P={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},j={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},F="OPAQUE",O="MASK",k="BLEND",L={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function B(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function H(e,t,i){for(var r in i.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=i.extensions[r])}function I(e,i){void 0!==i.extras&&("object"===t(i.extras)?e.userData=i.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+i.extras))}function N(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var i=0,r=t.weights.length;i<r;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(i=0,r=n.length;i<r;i++)e.morphTargetDictionary[n[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function U(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var i in e)if(e[i]!==t[i])return!1;return!0}function V(e,t){if(e.length!==t.length)return!1;for(var i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function z(e,t){for(var i=0,r=e.length;i<r;i++){var n=e[i];if(o=n.primitive,a=t,l=void 0,u=void 0,l=o.extensions?o.extensions[s.KHR_DRACO_MESH_COMPRESSION]:void 0,u=a.extensions?a.extensions[s.KHR_DRACO_MESH_COMPRESSION]:void 0,l&&u?l.bufferView===u.bufferView&&U(l.attributes,u.attributes):o.indices===a.indices&&U(o.attributes,a.attributes))return n.promise}var o,a,l,u;return null}function q(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,i=e.itemSize,r=e.array.slice(0,t*i),n=0;n<t;++n)r[n]=e.getX(n),i>=2&&(r[n+1]=e.getY(n)),i>=3&&(r[n+2]=e.getZ(n)),i>=4&&(r[n+3]=e.getW(n));return new THREE.BufferAttribute(r,i,e.normalized)}return e.clone()}function W(e,t,i){this.json=e||{},this.extensions=t||{},this.options=i||{},this.cache=new a,this.primitiveCache=[],this.multiplePrimitivesCache=[],this.multiPassGeometryCache=[],this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function G(e,t,i){var r=t.attributes,n=[];function o(t,r){return i.getDependency("accessor",t).then((function(t){e.addAttribute(r,t)}))}for(var a in r){var s=D[a];s&&(s in e.attributes||n.push(o(r[a],s)))}if(void 0!==t.indices&&!e.index){var l=i.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));n.push(l)}return I(e,t),Promise.all(n).then((function(){return void 0!==t.targets?function(e,t,i){for(var r=!1,n=!1,o=0,a=t.length;o<a;o++){if(void 0!==(u=t[o]).POSITION&&(r=!0),void 0!==u.NORMAL&&(n=!0),r&&n)break}if(!r&&!n)return Promise.resolve(e);var s=[],l=[];for(o=0,a=t.length;o<a;o++){var u=t[o];if(r){var c=void 0!==u.POSITION?i.getDependency("accessor",u.POSITION).then((function(e){return q(e)})):e.attributes.position;s.push(c)}if(n){c=void 0!==u.NORMAL?i.getDependency("accessor",u.NORMAL).then((function(e){return q(e)})):e.attributes.normal;l.push(c)}}return Promise.all([Promise.all(s),Promise.all(l)]).then((function(i){for(var o=i[0],a=i[1],s=0,l=t.length;s<l;s++){var u=t[s],c="morphTarget"+s;if(r&&void 0!==u.POSITION){var h=o[s];h.name=c;for(var p=e.attributes.position,d=0,f=h.count;d<f;d++)h.setXYZ(d,h.getX(d)+p.getX(d),h.getY(d)+p.getY(d),h.getZ(d)+p.getZ(d))}if(n&&void 0!==u.NORMAL){var m=a[s];m.name=c;var g=e.attributes.normal;for(d=0,f=m.count;d<f;d++)m.setXYZ(d,m.getX(d)+g.getX(d),m.getY(d)+g.getY(d),m.getZ(d)+g.getZ(d))}}return r&&(e.morphAttributes.position=o),n&&(e.morphAttributes.normal=a),e}))}(e,t.targets,i):e}))}W.prototype.parse=function(e,t){var i=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then((function(t){var r=t.scenes||[],n=r[i.scene||0],o=t.animations||[],a=t.cameras||[];e(n,r,a,o,i)})).catch(t)},W.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[],r={},n={},o=0,a=t.length;o<a;o++)for(var s=t[o].joints,l=0,u=s.length;l<u;l++)e[s[l]].isBone=!0;for(var c=0,h=e.length;c<h;c++){var p=e[c];void 0!==p.mesh&&(void 0===r[p.mesh]&&(r[p.mesh]=n[p.mesh]=0),r[p.mesh]++,void 0!==p.skin&&(i[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=r,this.json.meshUses=n},W.prototype.getDependency=function(e,t){var i=e+":"+t,r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this.loadMesh(t);break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this.loadBufferView(t);break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this.loadMaterial(t);break;case"texture":r=this.loadTexture(t);break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;case"light":r=this.extensions[s.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,r)}return r},W.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var i=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return i.getDependency(e,r)}))),this.cache.add(e,t)}return t},W.prototype.getMultiDependencies=function(e){for(var t={},i=[],r=0,n=e.length;r<n;r++){var o=e[r],a=this.getDependencies(o);a=a.then(function(e,i){t[e]=i}.bind(this,o+("mesh"===o?"es":"s"))),i.push(a)}return Promise.all(i).then((function(){return t}))},W.prototype.loadBuffer=function(e){var t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[s.KHR_BINARY_GLTF].body);var r=this.options;return new Promise((function(e,n){i.load(B(t.uri,r.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},W.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var i=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+i)}))},W.prototype.loadAccessor=function(e){var t=this,i=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var n=[];return void 0!==r.bufferView?n.push(this.getDependency("bufferView",r.bufferView)):n.push(null),void 0!==r.sparse&&(n.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(n).then((function(e){var n,o,a=e[0],s=R[r.type],l=A[r.componentType],u=l.BYTES_PER_ELEMENT,c=u*s,h=r.byteOffset||0,p=void 0!==r.bufferView?i.bufferViews[r.bufferView].byteStride:void 0,d=!0===r.normalized;if(p&&p!==c){var f="InterleavedBuffer:"+r.bufferView+":"+r.componentType,m=t.cache.get(f);m||(n=new l(a),m=new THREE.InterleavedBuffer(n,p/u),t.cache.add(f,m)),o=new THREE.InterleavedBufferAttribute(m,s,h/u,d)}else n=null===a?new l(r.count*s):new l(a,h,r.count*s),o=new THREE.BufferAttribute(n,s,d);if(void 0!==r.sparse){var g=R.SCALAR,v=A[r.sparse.indices.componentType],y=r.sparse.indices.byteOffset||0,b=r.sparse.values.byteOffset||0,_=new v(e[1],y,r.sparse.count*g),x=new l(e[2],b,r.sparse.count*s);null!==a&&o.setArray(o.array.slice());for(var E=0,w=_.length;E<w;E++){var T=_[E];if(o.setX(T,x[E*s]),s>=2&&o.setY(T,x[E*s+1]),s>=3&&o.setZ(T,x[E*s+2]),s>=4&&o.setW(T,x[E*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o}))},W.prototype.loadTexture=function(e){var t,i=this,r=this.json,n=this.options,o=this.textureLoader,a=window.URL||window.webkitURL,l=r.textures[e],u=l.extensions||{},c=(t=u[s.MSFT_TEXTURE_DDS]?r.images[u[s.MSFT_TEXTURE_DDS].source]:r.images[l.source]).uri,h=!1;return void 0!==t.bufferView&&(c=i.getDependency("bufferView",t.bufferView).then((function(e){h=!0;var i=new Blob([e],{type:t.mimeType});return c=a.createObjectURL(i)}))),Promise.resolve(c).then((function(e){var t=n.manager.getHandler(e);return t||(t=u[s.MSFT_TEXTURE_DDS]?i.extensions[s.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise((function(i,r){t.load(B(e,n.path),i,void 0,r)}))})).then((function(e){!0===h&&a.revokeObjectURL(c),e.flipY=!1,void 0!==l.name&&(e.name=l.name),t.mimeType in L&&(e.format=L[t.mimeType]);var i=(r.samplers||{})[l.sampler]||{};return e.magFilter=M[i.magFilter]||THREE.LinearFilter,e.minFilter=M[i.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=C[i.wrapS]||THREE.RepeatWrapping,e.wrapT=C[i.wrapT]||THREE.RepeatWrapping,e}))},W.prototype.assignTexture=function(e,t,i){var r=this,n=this;if(void 0!==i.extensions&&i.extensions.textureExtensions){var o=i.extensions.textureExtensions.map((function(e){return r.getDependency("texture",e.index)}));return Promise.all(o).then((function(i){e[t]=i[0],e["_replace_"+t]=i}))}return this.getDependency("texture",i.index).then((function(r){if(n.extensions[s.KHR_TEXTURE_TRANSFORM]){var o=void 0!==i.extensions?i.extensions[s.KHR_TEXTURE_TRANSFORM]:void 0;o&&(r=n.extensions[s.KHR_TEXTURE_TRANSFORM].extendTexture(r,o))}e[t]=r}))},W.prototype.loadMaterial=function(e){var t,i=this.json,r=this.extensions,n=i.materials[e],o={},a=n.extensions||{},l=[];if(a[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=r[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(n),l.push(u.extendParams(o,n,this))}else if(a[s.KHR_MATERIALS_UNLIT]){var c=r[s.KHR_MATERIALS_UNLIT];t=c.getMaterialType(n),l.push(c.extendParams(o,n,this))}else{t=THREE.MeshStandardMaterial;var h=n.pbrMetallicRoughness||{};if(o.color=new THREE.Color(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){var p=h.baseColorFactor;o.color.fromArray(p),o.opacity=p[3]}void 0!==h.baseColorTexture&&(l.push(this.assignTexture(o,"map",h.baseColorTexture)),1==h.baseColorTexture.texCoord&&(o.__useDiffuseUV2=!0)),o.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,o.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(l.push(this.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),l.push(this.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture)))}!0===n.doubleSided&&(o.side=THREE.DoubleSide);var d=n.alphaMode||F;d===k?o.transparent=!0:(o.transparent=!1,d===O&&(o.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new THREE.Vector2(1,1),void 0!==n.normalTexture.scale&&o.normalScale.set(n.normalTexture.scale,n.normalTexture.scale)),void 0!==n.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(o.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(o.emissive=(new THREE.Color).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&t!==THREE.MeshBasicMaterial&&l.push(this.assignTexture(o,"emissiveMap",n.emissiveTexture));var f=[],m=a.blend;if(m)for(var g=0;g<m.length;g++)m[g].maskTexture&&l.push(this.assignTexture(f,g,m[g].maskTexture));return Promise.all(l).then((function(){var e,i=o.__useDiffuseUV2;i&&delete o.__useDiffuseUV2;var l=o._replace_map;for(var u in l&&delete o._replace_map,e=t===THREE.ShaderMaterial?r[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),void 0!==n.name&&(e.name=n.name),e.normalScale&&(e.normalScale.y=-e.normalScale.y),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),e.specularMap&&(e.specularMap.encoding=THREE.sRGBEncoding),I(e,n),n.extensions&&H(r,e,n),a)void 0===r[u]&&("sceneBlend"===u?(e.transparent=!0,e.blending=void 0===THREE[a[u]+"Blending"]?1:THREE[a[u]+"Blending"]):"blend"===u?e.__texture=f:"depthWrite"===u?e.depthWrite=!!a[u]:"wireframe"===u&&(e.wireframe=!!a[u]));l&&(e._replace_map=l);var c=(n.pbrMetallicRoughness||{}).baseColorTexture,h=n.emissiveTexture,p=n.normalTexture;return void 0===e.userData.gltfExtensions&&(e.userData.gltfExtensions={}),c&&c.extensions&&(e.userData.gltfExtensions.baseColorTexture=c.extensions),h&&h.extensions&&(e.userData.gltfExtensions.emissiveTexture=h.extensions),p&&p.extensions&&(e.userData.gltfExtensions.normalTexture=p.extensions),i&&(e.userData.gltfExtensions.useDiffuseUV2=!0),e}))},W.prototype.loadGeometries=function(e){var t,i=this,r=this.extensions,n=this.primitiveCache,o=function(e){if(e.length<2)return!1;var t=e[0],i=t.targets||[];if(void 0===t.indices)return!1;for(var r=1,n=e.length;r<n;r++){var o=e[r];if(t.mode!==o.mode)return!1;if(void 0===o.indices)return!1;if(o.extensions&&o.extensions[s.KHR_DRACO_MESH_COMPRESSION])return!1;if(!U(t.attributes,o.attributes))return!1;var a=o.targets||[];if(i.length!==a.length)return!1;for(var l=0,u=i.length;l<u;l++)if(!U(i[l],a[l]))return!1}return!0}(e);function a(e){return r[s.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,i).then((function(t){return G(t,e,i)}))}o&&(t=e,e=[e[0]]);for(var l=[],u=0,c=e.length;u<c;u++){var h,p=e[u],d=z(n,p);if(d)l.push(d);else h=p.extensions&&p.extensions[s.KHR_DRACO_MESH_COMPRESSION]?a(p):G(new THREE.BufferGeometry,p,i),n.push({primitive:p,promise:h}),l.push(h)}return Promise.all(l).then((function(r){if(r.forEach((function(e){var t=e.attributes.color;if(t&&4===t.itemSize){for(var i=t.count,r=new Float32Array(i),n=0;n<i;n++)r.set([t.getW(n)],n);var o=new THREE.BufferAttribute(r,1);e.addAttribute("alphaIndex",o)}})),o){var n=r[0];if(null!==(p=function(e,t,i){for(var r=0,n=e.length;r<n;r++){var o=e[r];if(t===o.baseGeometry&&V(i,o.primitives))return o.geometry}return null}(h=i.multiPassGeometryCache,n,t)))return[p.geometry];var a=new THREE.BufferGeometry;for(var s in a.name=n.name,a.userData=n.userData,n.attributes)a.addAttribute(s,n.attributes[s]);for(var s in n.morphAttributes)a.morphAttributes[s]=n.morphAttributes[s];for(var l=[],u=0,c=t.length;u<c;u++)l.push(i.getDependency("accessor",t[u].indices));return Promise.all(l).then((function(e){for(var i=[],r=0,o=0,s=t.length;o<s;o++){for(var l=e[o],u=0,c=l.count;u<c;u++)i.push(l.array[u]);a.addGroup(r,l.count,o),r+=l.count}return a.setIndex(i),h.push({geometry:a,baseGeometry:n,primitives:t}),[a]}))}if(r.length>1&&void 0!==THREE.BufferGeometryUtils){for(u=1,c=e.length;u<c;u++)if(e[0].mode!==e[u].mode)return r;var h,p;if(p=function(e,t){for(var i=0,r=e.length;i<r;i++){var n=e[i];if(V(t,n.baseGeometries))return n.geometry}return null}(h=i.multiplePrimitivesCache,r)){if(null!==p.geometry)return[p.geometry]}else{a=THREE.BufferGeometryUtils.mergeBufferGeometries(r,!0);if(h.push({geometry:a,baseGeometries:r}),null!==a)return[a]}}return r}))},W.prototype.loadMesh=function(e){for(var t=this,i=this.json,r=this.extensions,n=i.meshes[e],o=n.primitives,a=[],l=0,u=o.length;l<u;l++){var c=void 0===o[l].material?new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}):this.getDependency("material",o[l].material);a.push(c)}return Promise.all(a).then((function(i){return t.loadGeometries(o).then((function(a){for(var l=1===a.length&&a[0].groups.length>0,u=[],c=0,h=a.length;c<h;c++){var p,d=a[c],f=o[c],m=l?i:i[c];if(f.mode===w||f.mode===T||f.mode===S||void 0===f.mode)!0===(p=!0===n.isSkinnedMesh?new THREE.SkinnedMesh(d,m):new THREE.Mesh(d,m)).isSkinnedMesh&&p.normalizeSkinWeights(),f.mode===T?p.drawMode=THREE.TriangleStripDrawMode:f.mode===S&&(p.drawMode=THREE.TriangleFanDrawMode);else if(f.mode===_)p=new THREE.LineSegments(d,m);else if(f.mode===E)p=new THREE.Line(d,m);else if(f.mode===x)p=new THREE.LineLoop(d,m);else{if(f.mode!==b)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode);p=new THREE.Points(d,m)}Object.keys(p.geometry.morphAttributes).length>0&&N(p,n),p.name=n.name||"mesh_"+e,a.length>1&&(p._wName=0===c?p.name:"_skip_wireframes_",p.name+="_"+c),I(p,n),u.push(p);for(var g=l?p.material:[p.material],v=void 0!==d.attributes.color,y=void 0!==d.attributes.alphaIndex,A=void 0===d.attributes.normal,M=!0===p.isSkinnedMesh,C=Object.keys(d.morphAttributes).length>0,R=C&&void 0!==d.morphAttributes.normal,D=0,P=g.length;D<P;D++){m=g[D];if(p.isPoints){var j="PointsMaterial:"+m.uuid,F=t.cache.get(j);F||(F=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(F,m),F.color.copy(m.color),F.map=m.map,F.lights=!1,t.cache.add(j,F)),m=F}else if(p.isLine){j="LineBasicMaterial:"+m.uuid;var O=t.cache.get(j);O||(O=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(O,m),O.color.copy(m.color),O.lights=!1,t.cache.add(j,O)),m=O}if(v||y||A||M||C){j="ClonedMaterial:"+m.uuid+":";m.isGLTFSpecularGlossinessMaterial&&(j+="specular-glossiness:"),M&&(j+="skinning:"),v&&(j+="vertex-colors:"),y&&(j+="vertex-alpha:"),A&&(j+="flat-shading:"),C&&(j+="morph-targets:"),R&&(j+="morph-normals:");var k=t.cache.get(j);k||(k=m.isGLTFSpecularGlossinessMaterial?r[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(m):m.clone(),M&&(k.skinning=!0),v&&(k.vertexColors=THREE.VertexColors),y&&(k.defines=k.defines||{},k.defines.USE_ALPHAINDEX=!0),A&&(k.flatShading=!0),C&&(k.morphTargets=!0),R&&(k.morphNormals=!0),t.cache.add(j,k)),m=k}g[D]=m,m.aoMap&&void 0===d.attributes.uv2&&void 0!==d.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),d.addAttribute("uv2",new THREE.BufferAttribute(d.attributes.uv.array,2))),m.isGLTFSpecularGlossinessMaterial&&(p.onBeforeRender=r[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms)}p.material=l?g:g[0]}if(1===u.length)return u[0];var L=new THREE.Group;for(c=0,h=u.length;c<h;c++)L.add(u[c]);return L}))}))},W.prototype.loadCamera=function(e){var t,i=this.json.cameras[e],r=i[i.type];if(r)return"perspective"===i.type?t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===i.type&&(t=new THREE.OrthographicCamera(r.xmag/-2,r.xmag/2,r.ymag/2,r.ymag/-2,r.znear,r.zfar)),void 0!==i.name&&(t.name=i.name),I(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},W.prototype.loadSkin=function(e){var t=this.json.skins[e],i={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return i.inverseBindMatrices=e,i}))},W.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],i=[],r=[],n=[],o=[],a=[],s=0,l=t.channels.length;s<l;s++){var u=t.channels[s],c=t.samplers[u.sampler],h=u.target,p=void 0!==h.node?h.node:h.id,d=void 0!==t.parameters?t.parameters[c.input]:c.input,f=void 0!==t.parameters?t.parameters[c.output]:c.output;i.push(this.getDependency("node",p)),r.push(this.getDependency("accessor",d)),n.push(this.getDependency("accessor",f)),o.push(c),a.push(h)}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(n),Promise.all(o),Promise.all(a)]).then((function(i){for(var r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=[],u=0,c=r.length;u<c;u++){var h=r[u],p=n[u],d=o[u],f=a[u],m=s[u];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,P[m.path]){case P.weights:g=THREE.NumberKeyframeTrack;break;case P.rotation:g=THREE.QuaternionKeyframeTrack;break;case P.position:case P.scale:default:g=THREE.VectorKeyframeTrack}var v=h.name?h.name:h.uuid,b=void 0!==f.interpolation?j[f.interpolation]:THREE.InterpolateLinear,_=[];P[m.path]===P.weights?h.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&_.push(e.name?e.name:e.uuid)})):_.push(v);for(var x=0,E=_.length;x<E;x++){var w=new g(_[x]+"."+P[m.path],THREE.AnimationUtils.arraySlice(p.array,0),THREE.AnimationUtils.arraySlice(d.array,0),b);"CUBICSPLINE"===f.interpolation&&(w.createInterpolant=function(e){return new y(this.times,this.values,this.getValueSize()/3,e)},w.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(w)}}}var T=void 0!==t.name?t.name:"animation_"+e;return new THREE.AnimationClip(T,void 0,l)}))},W.prototype.loadNode=function(e){var t=this.json,i=this.extensions,r=this,n=t.meshReferences,o=t.meshUses,a=t.nodes[e];return new Promise((function(e){!0===a.isBone?e(new THREE.Bone):void 0!==a.mesh?r.getDependency("mesh",a.mesh).then((function(t){var i;if(n[a.mesh]>1){var r=o[a.mesh]++;(i=t.clone()).name+="_instance_"+r,i.onBeforeRender=t.onBeforeRender;for(var s=0,l=i.children.length;s<l;s++)i.children[s].name+="_instance_"+r,i.children[s].onBeforeRender=t.children[s].onBeforeRender}else i=t;e(i)})):void 0!==a.camera?r.getDependency("camera",a.camera).then(e):a.extensions&&a.extensions[s.KHR_LIGHTS_PUNCTUAL]&&void 0!==a.extensions[s.KHR_LIGHTS_PUNCTUAL].light?r.getDependency("light",a.extensions[s.KHR_LIGHTS_PUNCTUAL].light).then(e):e(new THREE.Object3D)})).then((function(e){if(void 0!==a.name&&(e.name=THREE.PropertyBinding.sanitizeNodeName(a.name)),I(e,a),a.extensions&&H(i,e,a),void 0!==a.matrix){var t=new THREE.Matrix4;t.fromArray(a.matrix),e.applyMatrix(t)}else void 0!==a.translation&&e.position.fromArray(a.translation),void 0!==a.rotation&&e.quaternion.fromArray(a.rotation),void 0!==a.scale&&e.scale.fromArray(a.scale);return e}))},W.prototype.loadScene=function(){function e(t,i,r,n){var o=r.nodes[t];return n.getDependency("node",t).then((function(e){return void 0===o.skin?e:n.getDependency("skin",o.skin).then((function(e){for(var i=[],r=0,o=(t=e).joints.length;r<o;r++)i.push(n.getDependency("node",t.joints[r]));return Promise.all(i)})).then((function(i){for(var r=!0===e.isGroup?e.children:[e],n=0,o=r.length;n<o;n++){for(var a=r[n],s=[],l=[],u=0,c=i.length;u<c;u++){var h=i[u];if(h){s.push(h);var p=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&p.fromArray(t.inverseBindMatrices.array,16*u),l.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[u])}a.bind(new THREE.Skeleton(s,l),a.matrixWorld)}return e}));var t})).then((function(t){i.add(t);var a=[];if(o.children)for(var s=o.children,l=0,u=s.length;l<u;l++){var c=s[l];a.push(e(c,t,r,n))}return Promise.all(a)}))}return function(t){var i=this.json,r=this.extensions,n=this.json.scenes[t],o=new THREE.Scene;void 0!==n.name&&(o.name=n.name),I(o,n),n.extensions&&H(r,o,n);for(var a=n.nodes||[],s=[],l=0,u=a.length;l<u;l++)s.push(e(a[l],o,i,this));return Promise.all(s).then((function(){return o}))}}();var X=Object.prototype.toString,Y=function(e){return function(t){return X.call(t)=="[object "+e+"]"}},J={isType:Y,isArray:Y("Array"),isObject:Y("Object"),isString:Y("String"),isNumber:Y("Number"),isFunction:Y("Function"),isRegExp:Y("RegExp"),isUndefined:Y("Undefined"),objectKeysToLowerCase:function(e,i,r){var n,o,a,s,l,u,c,h;if(u=J.objectKeysToLowerCase,"undefined"===(c=t(i))||null===i||0===i||!1===i)i=0;else if("object"===c){if(!(i instanceof u))throw new TypeError('Expected "deep" to be a special object')}else if(!0===i)i=1/0;else{if("number"!==c)throw new TypeError('Expected "deep" to be a boolean, number or object, got "'+c+'"');if(isNaN(i)||i<0)throw new RangeError('Expected "deep" to be a positive number, got '+i)}if(null===e||"object"!==t(e))throw new TypeError('Expected "input" to be an object');if(c=t(r),null!==r&&"undefined"!==c&&"function"!==c)throw new TypeError('Expected "filter" to be a function');if(r=r||null,s=(a=Object.keys(e)).length-1,l={},i){if("number"==typeof i)i=Object.seal(Object.create(u.prototype,{input:{value:[]},output:{value:[]},level:{value:-1,writable:!0},max:{value:i,writable:!1}}));else if(~(n=i.input.indexOf(e)))return i.output[n];for(i.level+=1,i.input.push(e),i.output.push(l),n=s+1;n--;)"object"===t(h=e[o=a[s-n]])&&h&&i.level<i.max&&(r?r(h):h.constructor===Object)&&(h=u(h,i,r)),l[o.toLowerCase()]=h;i.level-=1}else for(n=s+1;n--;)l[(o=a[s-n]).toLowerCase()]=e[o];return l}};String.prototype.removeAt=function(e){var t=this.substring(0);return e>=this.length?t:t.slice(0,e)+t.slice(e+1)},String.prototype.getPath=function(){var e=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");return this.substring(0,e)},String.prototype.getExtension=function(){var e=this.split(".");return e.length>1?e.pop():""},String.prototype.getFileName=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");if(-1===t)return e?this:this.split(".")[0];var i=this.substring(t);return 0!==i.indexOf("\\")&&0!==i.indexOf("/")||(i=i.substring(1)),e?i:i.split(".")[0]},String.prototype._trimLeft=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("^["+e+"]+"),"")},String.prototype._trimRight=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("["+e+"]+$"),"")},String.prototype.trimBoth=function(e){return this._trimLeft(e)._trimRight(e)},String.prototype.appendPath=function(e){return this._trimRight("/")+"/"+e._trimLeft("/")._trimRight("/")},String.prototype.replaceAll=function(e,t){if(!this.length)return"";for(var i=this.substring(0);-1!==i.indexOf(e);)i=i.replace(e,t);return i};var Q=function(){function e(t){i(this,e),this._major=0,this._minor=0,this._modified=0;var r=t.split(".");this._major=parseInt(r.length>=1?r[0]:0),this._minor=parseInt(r.length>=2?r[1]:0),this._modified=parseInt(r.length>=3?r[2]:0)}return n(e,[{key:"compare",value:function(t){return J.isString(t)&&(t=new e(t)),this._major!=t._major?this._major>t._major?1:-1:this._minor!=t._minor?this._minor>t._minor?1:-1:this._modified!=t._modified?this._modified>t._modified?1:-1:0}},{key:"major",get:function(){return this._major}},{key:"minor",get:function(){return this._minor}},{key:"modified",get:function(){return this._modified}}]),e}(),Z=function(){function e(t){i(this,e);var r=t.split(" ");this.initYear(r[0]),this.initTime(r[1])}return n(e,[{key:"initYear",value:function(e){var t=e.split("-");this._year=parseInt(t[0],10),this._month=parseInt(t[1],10),this._date=parseInt(t[2],10)}},{key:"initTime",value:function(e){var t=e.split(":");this._hours=parseInt(t[0],10),this._minutes=parseInt(t[1],10),this._seconds=parseInt(t[2],10)}},{key:"getYear",value:function(){return this._year}},{key:"getMonth",value:function(){return this._month-1}},{key:"getDate",value:function(){return this._date}},{key:"getHours",value:function(){return this._hours}},{key:"getMinutes",value:function(){return this._minutes}},{key:"getSeconds",value:function(){return this._seconds}}]),e}(),K=function(){function e(){i(this,e)}return n(e,[{key:"GLTF_decoder_1_count",value:function(e,t,i,r){return 0==e?r-t:e%2?i%2?r+t:r:r-t}},{key:"GLTF_decoder_1_offset",value:function(e,t,i,r){return 0==e?r:e%2?r-(t*=i):r}},{key:"GLTF_decoder_1_length",value:function(e,t,i,r,n){return t*=i,0==e?n-t:e%2?r%2?n+t:n:n-t}},{key:"GLTF_decoder_2_offset",value:function(e,t,i,r){return e%2?r-(t*=i):r}},{key:"GLTF_decoder_2_length",value:function(e,t,i,r,n){return t*=i,e%2?r%2?n+t:n:n-t}},{key:"GLTF_decoder_3_offset",value:function(e,t,i,r){return e%2?r-(t*=i):r}},{key:"GLTF_decoder_3_length",value:function(e,t,i,r,n){return t*=i,e%2?r%2?n+t:n:n-t}}]),e}(),$=function(){function e(t,r){i(this,e),this._decoder={},this._nameDecoder={},r?(r.data=J.objectKeysToLowerCase(t),this._init(r.data)):this._init(t)}return n(e,[{key:"_initDecoder",value:function(e){var t=e.createtime;if(t){var i=new Z(t),r=i.getSeconds();this._decoder.version=Math.floor(r/10);for(var n=e.size,o=1,a=0;a<n.length;a++){var s=n[a].toString();-1!==s.indexOf(".")&&(o+=Math.floor(s.substring(s.length-1)))}this._decoder.randomWeight=o,this._decoder.randomRanges=[i.getHours()+1,i.getDate()+1,i.getSeconds()%13+1,i.getMinutes()%13+1,o%5*(o%5)+1,e.verts%13+1,e.faces%13+1,e.nodes%13+1]}}},{key:"_nodecode_name",value:function(e,t){return e}},{key:"_decode21_name",value:function(e,t){var i=["F7WD3HNR2OPYV6AUS5TKM018ZBJL4EQXIGC9F","A0JQM9PSLXF18647URV3DNHOCY52TEZBWIGKA","B0IE6Q4S3C7OA28UHTPXDW9NYMGLF1K5VJRZB","EQ72MKL3DYNF5RU1PWBT64X9CIZVJHS8G0OAE"],r=e.charAt(0),n=i[1].indexOf(r);if(-1!==n){n++,n=Math.floor(n/2)+1;var o=(e=e.removeAt(n)).getExtension();e=e.getFileName(!1);for(var a="",s=0;s<e.length;s++){var l=e[s],u=i[(s+1+t)%4],c=u.indexOf(l);0===c?c=35:c--,a+=u[c]}return o?a+"."+o:a}}},{key:"_initResourceDecoder",value:function(e,t){var i=t.texfiles;if(i){var r=new Q(e),n=this._nodecode_name;2==r.major&&1==r.minor&&(n=this._decode21_name);var o=Object.keys(i).length,a=t.gltffiles;if(a)for(var s=0;s<a.length;s++)a[s]=n(a[s],o);var l=t.lod;if(l){var u=Object.keys(l);for(s=0;s<u.length;s++){var c=u[s];l[n(c,o)]=l[c],delete l[c]}}this._nameDecoder.version=r,this._nameDecoder.decodeFunc=n}}},{key:"_init",value:function(e){if(e){var t=e.version;if(t)new Q(t).compare("2.0")<=0||(this._initDecoder(e),this._initResourceDecoder(t,e))}}},{key:"decode",value:function(e,t,i){var r=new K,n=this._nameDecoder.version,o=n&&2==n.major&&2==n.minor;switch(this._decoder.version){case 0:case 3:var a=this._decoder.randomWeight;if("_accessors"==t)for(var s=0;s<i.length;s++){var l=i[s];if(!o||void 0!==l.byteType)(u=e.bufferViews[l.bufferView]).factor=Math.floor(u.byteLength/l.count),u.opFactor=l.byteType,l.count=r.GLTF_decoder_1_count(s,a,l.byteType,l.count),delete l.byteType}else if("_bufferViews"==t)for(s=0;s<i.length;s++){var u=i[s];if(!o||void 0!==u.byteType){var c=u.factor;u.byteOffset=r.GLTF_decoder_1_offset(s,a,c,u.byteOffset),u.byteLength=r.GLTF_decoder_1_length(s,a,c,u.opFactor,u.byteLength),delete u.factor,delete u.opFactor}}break;case 1:case 4:var h=this._decoder.randomRanges;if("_accessors"==t)for(s=0;s<i.length;s++){l=i[s];if(!o||void 0!==l.byteType){(u=e.bufferViews[l.bufferView]).factor=Math.floor(u.byteLength/l.count),u.opFactor=l.byteType;a=h[Math.floor(s/2)%8]+(s+1)%7;l.count=r.GLTF_decoder_1_count(s,a,l.byteType,l.count),delete l.byteType}}else if("_bufferViews"==t)for(s=0;s<i.length;s++){u=i[s];if(!o||void 0!==u.byteType){var p=h[Math.floor(s/2)%8]+(s+1)%7;c=u.factor;u.byteOffset=r.GLTF_decoder_2_offset(s,p,c,u.byteOffset),u.byteLength=r.GLTF_decoder_2_length(s,p,c,u.opFactor,u.byteLength),delete u.factor,delete u.opFactor}}break;case 2:case 5:this._decoder.randomRanges3=[this._decoder.randomRanges[7],7*e.materials.length%10];var d=(e.buffers[0].byteLength-999).toString();for(s=0;s<d.length;s++){var f=10-Math.floor(d[s]);this._decoder.randomRanges3.push(f)}this._decoder.randomRanges3.push(this._decoder.randomRanges[3]);h=this._decoder.randomRanges3;if("_accessors"==t)for(s=0;s<i.length;s++){l=i[s];if(!o||void 0!==l.byteType){u=e.bufferViews[l.bufferView],a=h[Math.floor(s/2)%h.length]+Math.floor(s+1)%7;u.factor=Math.floor(u.byteLength/l.count),u.opFactor=l.byteType,l.count=r.GLTF_decoder_1_count(s,a,l.byteType,l.count),delete l.byteType}}else if("_bufferViews"==t)for(s=0;s<i.length;s++){u=i[s];if(!o||void 0!==u.byteType){p=h[Math.floor(s/2)%h.length]+Math.floor(s+1)%7,c=u.factor;u.byteOffset=r.GLTF_decoder_3_offset(s,p,c,u.byteOffset),u.byteLength=r.GLTF_decoder_3_length(s,p,c,u.opFactor,u.byteLength),delete u.factor,delete u.opFactor}}}var m=this._nameDecoder.decodeFunc;if(m&&("_buffers"==t||"_images"==t)){var g=e.buffers.length+e.images.length;for(s=0;s<i.length;s++){var v=m(i[s].uri,g);v&&(i[s].uri=v)}}}},{key:"decodeDracoFile",value:function(e,t,i){}}]),e}();var ee={process:function(e,t){var i=[];e.traverse((function(e){!function(e,t){if(e.material&&e.material.userData&&e.material.userData.gltfExtensions){var i=e.material.userData.gltfExtensions.blend;if(i){var r,n,o,a=e.material.__texture,s=e.geometry.index.count,l=[{materialIndex:0,start:0,count:s}],u=[e.material],c=!1;for(e.material.defines&&e.material.defines.USE_ALPHAINDEX&&(c=!0),r=0;r<i.length;r++)(n=t[i[r].subMaterial].clone())&&(n.transparent=!0,c&&(n.defines=n.defines||{},n.defines.USE_ALPHAINDEX=!0),i[r].maskTexture&&(1===(o=i[r].maskTexture.texCoord||0)&&(n.defines.USE_ALPHA_UV2=""),2===o&&(n.defines.USE_ALPHA_UV3=""),i[r].maskTexture.extensions&&(n.userData.gltfExtensions.alphaTexture=i[r].maskTexture.extensions),n.alphaMap=a[r],n.needsUpdate=!0),u.push(n),l.push({materialIndex:u.length-1,start:0,count:s}));e.material=u,e.geometry.groups=l}}}(e,t),function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}(e),function(e){e.material&&(Array.isArray(e.material)?e.material.forEach((function(e){e.map&&(e.userData.gltfExtensions.useDiffuseUV2&&(e.defines=e.defines||{},e.defines.USE_DIFFUSE_UV2=""),e.map.anisotropy=16,e.map.needsUpdate=!0)})):e.material.map&&(e.material.userData.gltfExtensions.useDiffuseUV2&&(e.material.defines=e.material.defines||{},e.material.defines.USE_DIFFUSE_UV2=""),e.material.map.anisotropy=16,e.material.map.needsUpdate=!0))}(e),function(e){e.userData&&e.userData.gltfExtensions&&(e.userData.gltfExtensions.effects&&(e.technique={},e.userData.gltfExtensions.effects.skipGlow&&(e.technique.glow="skip",e.traverse((function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.glow="skip")}))),(e.userData.gltfExtensions.effects.bloom||e.userData.gltfExtensions.effects.glow)&&(e.technique.glow=!0,e.traverse((function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.glow=!0)}))),e.userData.gltfExtensions.effects.skipInnerGlow&&(e.technique.innerGlow="skip",e.traverse((function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.innerGlow="skip")}))),(e.userData.gltfExtensions.effects.glowInset||e.userData.gltfExtensions.effects.innerGlow)&&(e.technique.innerGlow=!0,e.traverse((function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.innerGlow=!0)}))),delete e.userData.effects),void 0!==e.userData.gltfExtensions.renderOrder&&(e.renderOrder=Number(e.userData.gltfExtensions.renderOrder)),void 0!==e.userData.gltfExtensions.castShadows&&(e.castShadow=!!e.userData.gltfExtensions.castShadows),void 0!==e.userData.gltfExtensions.receiveShadows&&(e.receiveShadow=!!e.userData.gltfExtensions.receiveShadows))}(e),function(e,t){if(e.userData&&e.userData.gltfExtensions&&e.userData.gltfExtensions.wireframe){var i=e.userData.gltfExtensions;if(2==i.wireframe.type){if(i.wireframe.wireframeVerts){var r=[],n=[];i.wireframe.wireframeVerts.forEach((function(e){var t=JSON.parse(e.pos1),i=JSON.parse(e.pos2),o=JSON.parse(e.uv1),a=JSON.parse(e.uv2);r.push(t[0],t[1],t[2],i[0],i[1],i[2]),n.push(o[0],o[1],a[0],a[1])}));var o=new THREE.BufferGeometry;o.addAttribute("position",new THREE.Float32BufferAttribute(r,3)),o.addAttribute("uv",new THREE.Float32BufferAttribute(n,2));var a=e.material;if(!a&&e.children[0]&&(a=e.children[0].material),Array.isArray(a)&&(a=a[0]),a.defines.USE_ALPHAINDEX||a.vertexColors===THREE.VertexColors){var s=a.clone();s.vertexColors=0,s.defines&&delete s.defines.USE_ALPHAINDEX,s.userData=a.userData||{},a=s}var l=new THREE.LineSegments(o,a);l.userData.skipStyle=!0,l.technique=e.technique,l.material.flatShading=!0,l.renderOrder=1,t.push(e),e.parent.add(l)}}else 3==i.wireframe.type&&e.children.slice().forEach((function(r){if(r.isMesh){var n,o=new THREE.EdgesGeometry(r.geometry,i.wireframe.wireframeThreshold||.1);Array.isArray(r.material)?(n=(n=r.material.map((function(e){return new THREE.MeshBasicMaterial({color:e.color,map:e.map,alphaMap:e.alphaMap,transparent:e.transparent,depthWrite:e.depthWrite,blending:e.blending})})))[0]).userData=r.material[0].userData||{}:(n=new THREE.MeshBasicMaterial({color:r.material.color,map:r.material.map,alphaMap:r.material.alphaMap,transparent:r.material.transparent,depthWrite:r.material.depthWrite,blending:r.material.blending})).userData=r.material.userData||{};var a=new THREE.LineSegments(o,n);a.userData.skipStyle=!0,a.name=r.name,a.position.copy(r.position),a.scale.copy(r.scale),a.quaternion.copy(r.quaternion),a.technique=r.technique,a.material.flatShading=!0,a.renderOrder=1,e.add(a),t.push(r)}}));delete i.wireframe}}(e,i)})),i.forEach((function(e){e.parent&&e.parent.remove(e)}))}},te=function(){function e(t){i(this,e),this._manager=e.defaultManager||t,this._loader=new o(this._manager)}return n(e,[{key:"_ProcessProgressCallback",value:function(e,t,i){var r=0;t.lengthComputable&&t.total>0?t.target.readyState>1&&(r=t.loaded/t.total):r=1,i&&1==(r*=(i.cur+1)/i.total)&&i.cur++,e({progress:r})}},{key:"_loadGLTFs",value:function(e,t,i,r,n,o,a,s,l){var u=this,c=this._loader;c.loadingIndex=r,c.setDRACOLoader(e),c.setCrossOrigin("anonymous");var h=i.gltffiles[r],p=t.appendPath(h),d=i.lod;this.load(p,(function(e){if(d){var t=h.getFileName(!1),i=d[t];J.isNumber(i)||(console.error("The '"+t+"' distance is invalid, please check name is existing in index.json"),i=1e4),n.addLevel(e.scene,i)}else n.add(e.scene);o.models=o.models||[],o.models.push({animations:e.animations,materials:e.materials}),e.animations&&e.animations.length&&(o.animations=e.animations),o.loadedNumber++,o.loadedNumber===o.totalNumber&&s&&s({url:p.getPath(),node:n,animations:o.animations})}),(function(e){a&&u._ProcessProgressCallback(a,e,o)}),(function(e){if(l)return l(e)}))}},{key:"loadGLTFs",value:function(e,t,i,r,n,o){var a;t&&null!=i&&i(t),a=t.lod?new THREE.LOD:new THREE.Group;for(var s=t.gltffiles,l={loadedNumber:0,totalNumber:s.length,cur:0,total:s.length},u={},c=new $(t,u),h=0;h<s.length;h++)this._loadGLTFs(c,e,u.data,h,a,l,n,r,o)}},{key:"loadGLTF",value:function(e,t,i,r,n,o){t=t||{};var a,s={},l=this._loader;l.setDRACOLoader(new $(t,s)),l.setCrossOrigin("anonymous"),t=s.data,null!=i&&i(t);var u=t.gltffiles;a=u&&u.length?e.appendPath(u[0]):e.appendPath("scene.gltf");var c=this;this.load(a,(function(e){null!=r&&r({url:a.getPath(),node:e.scene,animations:e.animations,materials:e.materials})}),(function(e){n&&c._ProcessProgressCallback(n,e)}),(function(e){if(o)return o(e)}))}},{key:"downloadGLTF",value:function(e,t,i,r){var n=this;this.load(e,(function(i){null!=t&&t({url:e,node:i.scene,animations:i.animations,materials:i.materials})}),(function(e){i&&n._ProcessProgressCallback(i,e)}),(function(e){if(r)return r(e)}))}},{key:"downloadGLTFPackage",value:function(e,t,i,r,n){var o=e.appendPath("index.json"),a=this;new THREE.FileLoader(this._manager).load(o,(function(o){if(o)try{var s=J.objectKeysToLowerCase(JSON.parse(o)),l=s.gltffiles;if(l&&0!==l.length){for(var u=0;u<l.length;u++)l[u]||l.splice(u--,1);1===l.length?a.loadGLTF(e,s,t,i,r,n):a.loadGLTFs(e,s,t,i,r,n)}else a.loadGLTF(e,s,t,i,r,n)}catch(e){console.error(e),n&&n(e)}}),(function(){}),(function(o){var s=!1;n&&(s=n(o)),s||a.loadGLTF(e,null,t,i,r,n)}))}},{key:"downloadJSON",value:function(e,t){(new THREE.JSONLoader).load(e,(function(i,r){for(var n in r)r[n].skinning=!0;null!=t&&t({url:e,geometry:i,materials:r})}))}},{key:"loadFromURL",value:function(e){var t=e.url,i=e.jsonCallback,r=e.modelCallback,n=e.progressCallback,o=e.errorCallback,a=t.getExtension();"js"==a?this.downloadJSON(t,r):"gltf"==a||"glb"==a?this.downloadGLTF(t,r,n,o):this.downloadGLTFPackage(t,i,r,n,o)}},{key:"load",value:function(e,t,i,r){this._loader.load(e,(function(e){ee.process(e.scene,e.materials),t&&t(e)}),i,r);var n=this;return{then:function(o,a){return n._loader.load(e,(function(e){ee.process(e.scene,e.materials),t&&t(e),o(e)}),i,(function(e){r&&r(e),a(e)})),this}}}},{key:"setCrossOrigin",value:function(e){return this._loader.setCrossOrigin(e),this}},{key:"setPath",value:function(e){return this._loader.setPath(e),this}},{key:"setResourcePath",value:function(e){return this._loader.setResourcePath(e),this}}]),e}(),ie=function(){function e(t,r){i(this,e);var n=JSON.parse(t);this._asset=n.asset,this._scene=n.scene,this._scenes=n.scenes,this._extensionsUsed=n.extensionsUsed,this._extensions=n.extensions,this._nodes=n.nodes,this._accessors=n.accessors,this._images=n.images,this._skins=n.skins,this._meshes=n.meshes,this._textures=n.textures,this._samplers=n.samplers,this._materials=n.materials,this._cameras=n.cameras,this._animations=n.animations,this._buffers=n.buffers,this._bufferViews=n.bufferViews,this._meshReferences=n.meshReferences,this._meshUses=n.meshUses,this._init(r)}return n(e,[{key:"_init",value:function(e){var t=e.dracoLoader;if(t)for(var i=Object.keys(this),r=0;r<i.length;r++){var n=i[r],o=this[n];o&&t.decode(this,n,o)}}},{key:"asset",get:function(){return this._asset}},{key:"scene",get:function(){return this._scene}},{key:"scenes",get:function(){return this._scenes}},{key:"extensionsUsed",get:function(){return this._extensionsUsed}},{key:"extensions",get:function(){return this._extensions}},{key:"nodes",get:function(){return this._nodes}},{key:"accessors",get:function(){return this._accessors}},{key:"images",get:function(){return this._images}},{key:"skins",get:function(){return this._skins}},{key:"meshes",get:function(){return this._meshes}},{key:"textures",get:function(){return this._textures}},{key:"samplers",get:function(){return this._samplers}},{key:"materials",get:function(){return this._materials}},{key:"cameras",get:function(){return this._cameras}},{key:"animations",get:function(){return this._animations}},{key:"buffers",get:function(){return this._buffers}},{key:"bufferViews",get:function(){return this._bufferViews}},{key:"meshReferences",set:function(e){this._meshReferences=e},get:function(){return this._meshReferences}},{key:"meshUses",set:function(e){this._meshUses=e},get:function(){return this._meshUses}}]),e}();JSON.parseX=function(e,t){try{return new ie(e,t)}catch(e){return console.error(e),null}},ie.prototype.toJSON=function(){},THREE&&(THREE.GLTFLoader=te),e.GLTFLoader=te,e.JSONXLoader=ie,Object.defineProperty(e,"__esModule",{value:!0})})),function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}({"./node_modules/escodegen/escodegen.js":
/*!*********************************************!*\
  !*** ./node_modules/escodegen/escodegen.js ***!
  \*********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){(function(e){!function(){"use strict";var r,n,o,a,s,l,u,c,h,p,d,f,m,g,v,y,b,_,x,E,w,T,S,A,M,C;function R(e){return J.Statement.hasOwnProperty(e.type)}s=i(/*! estraverse */"./node_modules/estraverse/estraverse.js"),l=i(/*! esutils */"./node_modules/esutils/lib/utils.js"),r=s.Syntax,o={"||":(n={Sequence:0,Yield:1,Assignment:1,Conditional:2,ArrowFunction:2,LogicalOR:3,LogicalAND:4,BitwiseOR:5,BitwiseXOR:6,BitwiseAND:7,Equality:8,Relational:9,BitwiseSHIFT:10,Additive:11,Multiplicative:12,Await:13,Unary:13,Postfix:14,Call:15,New:16,TaggedTemplate:17,Member:18,Primary:19}).LogicalOR,"&&":n.LogicalAND,"|":n.BitwiseOR,"^":n.BitwiseXOR,"&":n.BitwiseAND,"==":n.Equality,"!=":n.Equality,"===":n.Equality,"!==":n.Equality,is:n.Equality,isnt:n.Equality,"<":n.Relational,">":n.Relational,"<=":n.Relational,">=":n.Relational,in:n.Relational,instanceof:n.Relational,"<<":n.BitwiseSHIFT,">>":n.BitwiseSHIFT,">>>":n.BitwiseSHIFT,"+":n.Additive,"-":n.Additive,"*":n.Multiplicative,"%":n.Multiplicative,"/":n.Multiplicative};var D=7,P=1;function j(e,t){var i="";for(t|=0;t>0;t>>>=1,e+=e)1&t&&(i+=e);return i}function F(e){var t=e.length;return t&&l.code.isLineTerminator(e.charCodeAt(t-1))}function O(e,t){var i;for(i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function k(e,t){var i,r;function n(e){return"object"==typeof e&&e instanceof Object&&!(e instanceof RegExp)}for(i in t)t.hasOwnProperty(i)&&(n(r=t[i])?n(e[i])?k(e[i],r):e[i]=k({},r):e[i]=r);return e}function L(e,t){return 8232==(-2&e)?(t?"u":"\\u")+(8232===e?"2028":"2029"):10===e||13===e?(t?"":"\\")+(10===e?"n":"r"):String.fromCharCode(e)}function B(e,t){var i;return 8===e?"\\b":12===e?"\\f":9===e?"\\t":(i=e.toString(16).toUpperCase(),h||e>255?"\\u"+"0000".slice(i.length)+i:0!==e||l.code.isDecimalDigit(t)?11===e?"\\x0B":"\\x"+"00".slice(i.length)+i:"\\0")}function H(e){if(92===e)return"\\\\";if(10===e)return"\\n";if(13===e)return"\\r";if(8232===e)return"\\u2028";if(8233===e)return"\\u2029";throw new Error("Incorrectly classified character")}function I(e,t){if(!T)return Array.isArray(e)?function e(t){var i,r,n,o="";for(i=0,r=t.length;i<r;++i)n=t[i],o+=Array.isArray(n)?e(n):n;return o}(e):e;if(null==t){if(e instanceof a)return e;t={}}return null==t.loc?new a(null,null,T,e,t.name||null):new a(t.loc.start.line,t.loc.start.column,!0===T?t.loc.source||null:T,e,t.name||null)}function N(){return v||" "}function U(e,t){var i,r,n,o;return 0===(i=I(e).toString()).length?[t]:0===(r=I(t).toString()).length?[e]:(n=i.charCodeAt(i.length-1),o=r.charCodeAt(0),(43===n||45===n)&&n===o||l.code.isIdentifierPartES5(n)&&l.code.isIdentifierPartES5(o)||47===n&&105===o?[e,N(),t]:l.code.isWhiteSpace(n)||l.code.isLineTerminator(n)||l.code.isWhiteSpace(o)||l.code.isLineTerminator(o)?[e,t]:[e,v,t])}function V(e){return[u,e]}function z(e){var t;t=u,e(u+=c),u=t}function q(e,t){if("Line"===e.type){if(F(e.value))return"//"+e.value;var i="//"+e.value;return A||(i+="\n"),i}return E.format.indent.adjustMultilineComment&&/[\n\r]/.test(e.value)?function(e,t){var i,r,n,o,a,s,c,h;for(i=e.split(/\r\n|[\r\n]/),s=Number.MAX_VALUE,r=1,n=i.length;r<n;++r){for(o=i[r],a=0;a<o.length&&l.code.isWhiteSpace(o.charCodeAt(a));)++a;s>a&&(s=a)}for(void 0!==t?(c=u,"*"===i[1][s]&&(t+=" "),u=t):(1&s&&--s,c=u),r=1,n=i.length;r<n;++r)h=I(V(i[r].slice(s))),i[r]=T?h.join(""):h;return u=c,i.join("\n")}("/*"+e.value+"*/",t):"/*"+e.value+"*/"}function W(e,t){var i,n,o,a,s,h,p,d,f,m,g,v;if(e.leadingComments&&e.leadingComments.length>0){if(a=t,A){for(t=[],d=(o=e.leadingComments[0]).extendedRange,f=o.range,(v=((g=S.substring(d[0],f[0])).match(/\n/g)||[]).length)>0?(t.push(j("\n",v)),t.push(V(q(o)))):(t.push(g),t.push(q(o))),m=f,i=1,n=e.leadingComments.length;i<n;i++)f=(o=e.leadingComments[i]).range,v=(S.substring(m[1],f[0]).match(/\n/g)||[]).length,t.push(j("\n",v)),t.push(V(q(o))),m=f;v=(S.substring(f[1],d[1]).match(/\n/g)||[]).length,t.push(j("\n",v))}else for(o=e.leadingComments[0],t=[],_&&e.type===r.Program&&0===e.body.length&&t.push("\n"),t.push(q(o)),F(I(t).toString())||t.push("\n"),i=1,n=e.leadingComments.length;i<n;++i)F(I(p=[q(o=e.leadingComments[i])]).toString())||p.push("\n"),t.push(V(p));t.push(V(a))}if(e.trailingComments)if(A)d=(o=e.trailingComments[0]).extendedRange,f=o.range,(v=((g=S.substring(d[0],f[0])).match(/\n/g)||[]).length)>0?(t.push(j("\n",v)),t.push(V(q(o)))):(t.push(g),t.push(q(o)));else for(s=!F(I(t).toString()),h=j(" ",function(e){var t;for(t=e.length-1;t>=0&&!l.code.isLineTerminator(e.charCodeAt(t));--t);return e.length-1-t}(I([u,t,c]).toString())),i=0,n=e.trailingComments.length;i<n;++i)o=e.trailingComments[i],s?(t=0===i?[t,c]:[t,h]).push(q(o,h)):t=[t,V(q(o))],i===n-1||F(I(t).toString())||(t=[t,"\n"]);return t}function G(e,t,i){var r,n=0;for(r=e;r<t;r++)"\n"===S[r]&&n++;for(r=1;r<n;r++)i.push(g)}function X(e,t,i){return t<i?["(",e,")"]:e}function Y(e){var t,i,r;for(t=1,i=(r=e.split(/\r\n|\n/)).length;t<i;t++)r[t]=g+u+r[t];return r}function J(){}function Q(e){return I(e.name,e)}function Z(e,t){return e.async?"async"+(t?N():v):""}function K(e){return e.generator&&!E.moz.starlessGenerator?"*"+v:""}function $(e){var t=e.value,i="";return t.async&&(i+=Z(t,!e.computed)),t.generator&&(i+=K(t)?"*":""),i}function ee(e){var t;if(t=new J,R(e))return t.generateStatement(e,P);if(function(e){return J.Expression.hasOwnProperty(e.type)}(e))return t.generateExpression(e,n.Sequence,D);throw new Error("Unknown node type: "+e.type)}J.prototype.maybeBlock=function(e,t){var i,n,o=this;return n=!E.comment||!e.leadingComments,e.type===r.BlockStatement&&n?[v,this.generateStatement(e,t)]:e.type===r.EmptyStatement&&n?";":(z((function(){i=[g,V(o.generateStatement(e,t))]})),i)},J.prototype.maybeBlockSuffix=function(e,t){var i=F(I(t).toString());return e.type!==r.BlockStatement||E.comment&&e.leadingComments||i?i?[t,u]:[t,g,u]:[t,v]},J.prototype.generatePattern=function(e,t,i){return e.type===r.Identifier?Q(e):this.generateExpression(e,t,i)},J.prototype.generateFunctionParams=function(e){var t,i,o,a;if(a=!1,e.type!==r.ArrowFunctionExpression||e.rest||e.defaults&&0!==e.defaults.length||1!==e.params.length||e.params[0].type!==r.Identifier){for((o=e.type===r.ArrowFunctionExpression?[Z(e,!1)]:[]).push("("),e.defaults&&(a=!0),t=0,i=e.params.length;t<i;++t)a&&e.defaults[t]?o.push(this.generateAssignment(e.params[t],e.defaults[t],"=",n.Assignment,D)):o.push(this.generatePattern(e.params[t],n.Assignment,D)),t+1<i&&o.push(","+v);e.rest&&(e.params.length&&o.push(","+v),o.push("..."),o.push(Q(e.rest))),o.push(")")}else o=[Z(e,!0),Q(e.params[0])];return o},J.prototype.generateFunctionBody=function(e){var t,i;return t=this.generateFunctionParams(e),e.type===r.ArrowFunctionExpression&&(t.push(v),t.push("=>")),e.expression?(t.push(v),"{"===(i=this.generateExpression(e.body,n.Assignment,D)).toString().charAt(0)&&(i=["(",i,")"]),t.push(i)):t.push(this.maybeBlock(e.body,9)),t},J.prototype.generateIterationForStatement=function(e,t,i){var o=["for"+v+(t.await?"await"+v:"")+"("],a=this;return z((function(){t.left.type===r.VariableDeclaration?z((function(){o.push(t.left.kind+N()),o.push(a.generateStatement(t.left.declarations[0],0))})):o.push(a.generateExpression(t.left,n.Call,D)),o=U(o,e),o=[U(o,a.generateExpression(t.right,n.Assignment,D)),")"]})),o.push(this.maybeBlock(t.body,i)),o},J.prototype.generatePropertyKey=function(e,t){var i=[];return t&&i.push("["),i.push(this.generateExpression(e,n.Sequence,D)),t&&i.push("]"),i},J.prototype.generateAssignment=function(e,t,i,r,o){return n.Assignment<r&&(o|=1),X([this.generateExpression(e,n.Call,o),v+i+v,this.generateExpression(t,n.Assignment,o)],n.Assignment,r)},J.prototype.semicolon=function(e){return!b&&32&e?"":";"},J.Statement={BlockStatement:function(e,t){var i,r,n=["{",g],o=this;return z((function(){var a,s,l,u;for(0===e.body.length&&A&&(i=e.range)[1]-i[0]>2&&("\n"===(r=S.substring(i[0]+1,i[1]-1))[0]&&(n=["{"]),n.push(r)),u=P,8&t&&(u|=16),a=0,s=e.body.length;a<s;++a)A&&(0===a&&(e.body[0].leadingComments&&(i=e.body[0].leadingComments[0].extendedRange,"\n"===(r=S.substring(i[0],i[1]))[0]&&(n=["{"])),e.body[0].leadingComments||G(e.range[0],e.body[0].range[0],n)),a>0&&(e.body[a-1].trailingComments||e.body[a].leadingComments||G(e.body[a-1].range[1],e.body[a].range[0],n))),a===s-1&&(u|=32),l=e.body[a].leadingComments&&A?o.generateStatement(e.body[a],u):V(o.generateStatement(e.body[a],u)),n.push(l),F(I(l).toString())||A&&a<s-1&&e.body[a+1].leadingComments||n.push(g),A&&a===s-1&&(e.body[a].trailingComments||G(e.body[a].range[1],e.range[1],n))})),n.push(V("}")),n},BreakStatement:function(e,t){return e.label?"break "+e.label.name+this.semicolon(t):"break"+this.semicolon(t)},ContinueStatement:function(e,t){return e.label?"continue "+e.label.name+this.semicolon(t):"continue"+this.semicolon(t)},ClassBody:function(e,t){var i=["{",g],r=this;return z((function(t){var o,a;for(o=0,a=e.body.length;o<a;++o)i.push(t),i.push(r.generateExpression(e.body[o],n.Sequence,D)),o+1<a&&i.push(g)})),F(I(i).toString())||i.push(g),i.push(u),i.push("}"),i},ClassDeclaration:function(e,t){var i,r;return i=["class"],e.id&&(i=U(i,this.generateExpression(e.id,n.Sequence,D))),e.superClass&&(r=U("extends",this.generateExpression(e.superClass,n.Assignment,D)),i=U(i,r)),i.push(v),i.push(this.generateStatement(e.body,33)),i},DirectiveStatement:function(e,t){return E.raw&&e.raw?e.raw+this.semicolon(t):function(e){var t,i,r,n;for(n="double"===f?'"':"'",t=0,i=e.length;t<i;++t){if(39===(r=e.charCodeAt(t))){n='"';break}if(34===r){n="'";break}92===r&&++t}return n+e+n}(e.directive)+this.semicolon(t)},DoWhileStatement:function(e,t){var i=U("do",this.maybeBlock(e.body,P));return U(i=this.maybeBlockSuffix(e.body,i),["while"+v+"(",this.generateExpression(e.test,n.Sequence,D),")"+this.semicolon(t)])},CatchClause:function(e,t){var i,r=this;return z((function(){var t;i=["catch"+v+"(",r.generateExpression(e.param,n.Sequence,D),")"],e.guard&&(t=r.generateExpression(e.guard,n.Sequence,D),i.splice(2,0," if ",t))})),i.push(this.maybeBlock(e.body,P)),i},DebuggerStatement:function(e,t){return"debugger"+this.semicolon(t)},EmptyStatement:function(e,t){return";"},ExportDefaultDeclaration:function(e,t){var i,r=["export"];return i=32&t?33:P,r=U(r,"default"),R(e.declaration)?U(r,this.generateStatement(e.declaration,i)):U(r,this.generateExpression(e.declaration,n.Assignment,D)+this.semicolon(t))},ExportNamedDeclaration:function(e,t){var i,o=["export"],a=this;return i=32&t?33:P,e.declaration?U(o,this.generateStatement(e.declaration,i)):(e.specifiers&&(0===e.specifiers.length?o=U(o,"{"+v+"}"):e.specifiers[0].type===r.ExportBatchSpecifier?o=U(o,this.generateExpression(e.specifiers[0],n.Sequence,D)):(o=U(o,"{"),z((function(t){var i,r;for(o.push(g),i=0,r=e.specifiers.length;i<r;++i)o.push(t),o.push(a.generateExpression(e.specifiers[i],n.Sequence,D)),i+1<r&&o.push(","+g)})),F(I(o).toString())||o.push(g),o.push(u+"}")),e.source?o=U(o,["from"+v,this.generateExpression(e.source,n.Sequence,D),this.semicolon(t)]):o.push(this.semicolon(t))),o)},ExportAllDeclaration:function(e,t){return["export"+v,"*"+v,"from"+v,this.generateExpression(e.source,n.Sequence,D),this.semicolon(t)]},ExpressionStatement:function(e,t){var i,o;return 123===(o=I(i=[this.generateExpression(e.expression,n.Sequence,D)]).toString()).charCodeAt(0)||function(e){var t;return"class"===e.slice(0,5)&&(123===(t=e.charCodeAt(5))||l.code.isWhiteSpace(t)||l.code.isLineTerminator(t))}(o)||function(e){var t;return"function"===e.slice(0,8)&&(40===(t=e.charCodeAt(8))||l.code.isWhiteSpace(t)||42===t||l.code.isLineTerminator(t))}(o)||function(e){var t,i,r;if("async"!==e.slice(0,5))return!1;if(!l.code.isWhiteSpace(e.charCodeAt(5)))return!1;for(i=6,r=e.length;i<r&&l.code.isWhiteSpace(e.charCodeAt(i));++i);return i!==r&&"function"===e.slice(i,i+8)&&(40===(t=e.charCodeAt(i+8))||l.code.isWhiteSpace(t)||42===t||l.code.isLineTerminator(t))}(o)||x&&16&t&&e.expression.type===r.Literal&&"string"==typeof e.expression.value?i=["(",i,")"+this.semicolon(t)]:i.push(this.semicolon(t)),i},ImportDeclaration:function(e,t){var i,o,a=this;return 0===e.specifiers.length?["import",v,this.generateExpression(e.source,n.Sequence,D),this.semicolon(t)]:(i=["import"],o=0,e.specifiers[o].type===r.ImportDefaultSpecifier&&(i=U(i,[this.generateExpression(e.specifiers[o],n.Sequence,D)]),++o),e.specifiers[o]&&(0!==o&&i.push(","),e.specifiers[o].type===r.ImportNamespaceSpecifier?i=U(i,[v,this.generateExpression(e.specifiers[o],n.Sequence,D)]):(i.push(v+"{"),e.specifiers.length-o==1?(i.push(v),i.push(this.generateExpression(e.specifiers[o],n.Sequence,D)),i.push(v+"}"+v)):(z((function(t){var r,s;for(i.push(g),r=o,s=e.specifiers.length;r<s;++r)i.push(t),i.push(a.generateExpression(e.specifiers[r],n.Sequence,D)),r+1<s&&i.push(","+g)})),F(I(i).toString())||i.push(g),i.push(u+"}"+v)))),i=U(i,["from"+v,this.generateExpression(e.source,n.Sequence,D),this.semicolon(t)]))},VariableDeclarator:function(e,t){var i=1&t?D:6;return e.init?[this.generateExpression(e.id,n.Assignment,i),v,"=",v,this.generateExpression(e.init,n.Assignment,i)]:this.generatePattern(e.id,n.Assignment,i)},VariableDeclaration:function(e,t){var i,r,n,o,a,s=this;function l(){for(o=e.declarations[0],E.comment&&o.leadingComments?(i.push("\n"),i.push(V(s.generateStatement(o,a)))):(i.push(N()),i.push(s.generateStatement(o,a))),r=1,n=e.declarations.length;r<n;++r)o=e.declarations[r],E.comment&&o.leadingComments?(i.push(","+g),i.push(V(s.generateStatement(o,a)))):(i.push(","+v),i.push(s.generateStatement(o,a)))}return i=[e.kind],a=1&t?P:0,e.declarations.length>1?z(l):l(),i.push(this.semicolon(t)),i},ThrowStatement:function(e,t){return[U("throw",this.generateExpression(e.argument,n.Sequence,D)),this.semicolon(t)]},TryStatement:function(e,t){var i,r,n,o;if(i=["try",this.maybeBlock(e.block,P)],i=this.maybeBlockSuffix(e.block,i),e.handlers)for(r=0,n=e.handlers.length;r<n;++r)i=U(i,this.generateStatement(e.handlers[r],P)),(e.finalizer||r+1!==n)&&(i=this.maybeBlockSuffix(e.handlers[r].body,i));else{for(r=0,n=(o=e.guardedHandlers||[]).length;r<n;++r)i=U(i,this.generateStatement(o[r],P)),(e.finalizer||r+1!==n)&&(i=this.maybeBlockSuffix(o[r].body,i));if(e.handler)if(Array.isArray(e.handler))for(r=0,n=e.handler.length;r<n;++r)i=U(i,this.generateStatement(e.handler[r],P)),(e.finalizer||r+1!==n)&&(i=this.maybeBlockSuffix(e.handler[r].body,i));else i=U(i,this.generateStatement(e.handler,P)),e.finalizer&&(i=this.maybeBlockSuffix(e.handler.body,i))}return e.finalizer&&(i=U(i,["finally",this.maybeBlock(e.finalizer,P)])),i},SwitchStatement:function(e,t){var i,r,o,a,s,l=this;if(z((function(){i=["switch"+v+"(",l.generateExpression(e.discriminant,n.Sequence,D),")"+v+"{"+g]})),e.cases)for(s=P,o=0,a=e.cases.length;o<a;++o)o===a-1&&(s|=32),r=V(this.generateStatement(e.cases[o],s)),i.push(r),F(I(r).toString())||i.push(g);return i.push(V("}")),i},SwitchCase:function(e,t){var i,o,a,s,l,u=this;return z((function(){for(i=e.test?[U("case",u.generateExpression(e.test,n.Sequence,D)),":"]:["default:"],a=0,(s=e.consequent.length)&&e.consequent[0].type===r.BlockStatement&&(o=u.maybeBlock(e.consequent[0],P),i.push(o),a=1),a===s||F(I(i).toString())||i.push(g),l=P;a<s;++a)a===s-1&&32&t&&(l|=32),o=V(u.generateStatement(e.consequent[a],l)),i.push(o),a+1===s||F(I(o).toString())||i.push(g)})),i},IfStatement:function(e,t){var i,o,a=this;return z((function(){i=["if"+v+"(",a.generateExpression(e.test,n.Sequence,D),")"]})),o=P,32&t&&(o|=32),e.alternate?(i.push(this.maybeBlock(e.consequent,P)),i=this.maybeBlockSuffix(e.consequent,i),i=e.alternate.type===r.IfStatement?U(i,["else ",this.generateStatement(e.alternate,o)]):U(i,U("else",this.maybeBlock(e.alternate,o)))):i.push(this.maybeBlock(e.consequent,o)),i},ForStatement:function(e,t){var i,o=this;return z((function(){i=["for"+v+"("],e.init?e.init.type===r.VariableDeclaration?i.push(o.generateStatement(e.init,0)):(i.push(o.generateExpression(e.init,n.Sequence,6)),i.push(";")):i.push(";"),e.test?(i.push(v),i.push(o.generateExpression(e.test,n.Sequence,D)),i.push(";")):i.push(";"),e.update?(i.push(v),i.push(o.generateExpression(e.update,n.Sequence,D)),i.push(")")):i.push(")")})),i.push(this.maybeBlock(e.body,32&t?33:P)),i},ForInStatement:function(e,t){return this.generateIterationForStatement("in",e,32&t?33:P)},ForOfStatement:function(e,t){return this.generateIterationForStatement("of",e,32&t?33:P)},LabeledStatement:function(e,t){return[e.label.name+":",this.maybeBlock(e.body,32&t?33:P)]},Program:function(e,t){var i,r,n,o,a;for(o=e.body.length,i=[_&&o>0?"\n":""],a=17,n=0;n<o;++n)_||n!==o-1||(a|=32),A&&(0===n&&(e.body[0].leadingComments||G(e.range[0],e.body[n].range[0],i)),n>0&&(e.body[n-1].trailingComments||e.body[n].leadingComments||G(e.body[n-1].range[1],e.body[n].range[0],i))),r=V(this.generateStatement(e.body[n],a)),i.push(r),n+1<o&&!F(I(r).toString())&&(A&&e.body[n+1].leadingComments||i.push(g)),A&&n===o-1&&(e.body[n].trailingComments||G(e.body[n].range[1],e.range[1],i));return i},FunctionDeclaration:function(e,t){return[Z(e,!0),"function",K(e)||N(),e.id?Q(e.id):"",this.generateFunctionBody(e)]},ReturnStatement:function(e,t){return e.argument?[U("return",this.generateExpression(e.argument,n.Sequence,D)),this.semicolon(t)]:["return"+this.semicolon(t)]},WhileStatement:function(e,t){var i,r=this;return z((function(){i=["while"+v+"(",r.generateExpression(e.test,n.Sequence,D),")"]})),i.push(this.maybeBlock(e.body,32&t?33:P)),i},WithStatement:function(e,t){var i,r=this;return z((function(){i=["with"+v+"(",r.generateExpression(e.object,n.Sequence,D),")"]})),i.push(this.maybeBlock(e.body,32&t?33:P)),i}},O(J.prototype,J.Statement),J.Expression={SequenceExpression:function(e,t,i){var r,o,a;for(n.Sequence<t&&(i|=1),r=[],o=0,a=e.expressions.length;o<a;++o)r.push(this.generateExpression(e.expressions[o],n.Assignment,i)),o+1<a&&r.push(","+v);return X(r,n.Sequence,t)},AssignmentExpression:function(e,t,i){return this.generateAssignment(e.left,e.right,e.operator,t,i)},ArrowFunctionExpression:function(e,t,i){return X(this.generateFunctionBody(e),n.ArrowFunction,t)},ConditionalExpression:function(e,t,i){return n.Conditional<t&&(i|=1),X([this.generateExpression(e.test,n.LogicalOR,i),v+"?"+v,this.generateExpression(e.consequent,n.Assignment,i),v+":"+v,this.generateExpression(e.alternate,n.Assignment,i)],n.Conditional,t)},LogicalExpression:function(e,t,i){return this.BinaryExpression(e,t,i)},BinaryExpression:function(e,t,i){var r,n,a,s;return(n=o[e.operator])<t&&(i|=1),r=47===(s=(a=this.generateExpression(e.left,n,i)).toString()).charCodeAt(s.length-1)&&l.code.isIdentifierPartES5(e.operator.charCodeAt(0))?[a,N(),e.operator]:U(a,e.operator),a=this.generateExpression(e.right,n+1,i),"/"===e.operator&&"/"===a.toString().charAt(0)||"<"===e.operator.slice(-1)&&"!--"===a.toString().slice(0,3)?(r.push(N()),r.push(a)):r=U(r,a),"in"!==e.operator||1&i?X(r,n,t):["(",r,")"]},CallExpression:function(e,t,i){var r,o,a;for((r=[this.generateExpression(e.callee,n.Call,3)]).push("("),o=0,a=e.arguments.length;o<a;++o)r.push(this.generateExpression(e.arguments[o],n.Assignment,D)),o+1<a&&r.push(","+v);return r.push(")"),2&i?X(r,n.Call,t):["(",r,")"]},NewExpression:function(e,t,i){var r,o,a,s,l;if(o=e.arguments.length,l=4&i&&!y&&0===o?5:1,r=U("new",this.generateExpression(e.callee,n.New,l)),!(4&i)||y||o>0){for(r.push("("),a=0,s=o;a<s;++a)r.push(this.generateExpression(e.arguments[a],n.Assignment,D)),a+1<s&&r.push(","+v);r.push(")")}return X(r,n.New,t)},MemberExpression:function(e,t,i){var o,a;return o=[this.generateExpression(e.object,n.Call,2&i?3:1)],e.computed?(o.push("["),o.push(this.generateExpression(e.property,n.Sequence,2&i?D:5)),o.push("]")):(e.object.type===r.Literal&&"number"==typeof e.object.value&&(a=I(o).toString()).indexOf(".")<0&&!/[eExX]/.test(a)&&l.code.isDecimalDigit(a.charCodeAt(a.length-1))&&!(a.length>=2&&48===a.charCodeAt(0))&&o.push(" "),o.push("."),o.push(Q(e.property))),X(o,n.Member,t)},MetaProperty:function(e,t,i){var r;return(r=[]).push("string"==typeof e.meta?e.meta:Q(e.meta)),r.push("."),r.push("string"==typeof e.property?e.property:Q(e.property)),X(r,n.Member,t)},UnaryExpression:function(e,t,i){var r,o,a,s,u;return o=this.generateExpression(e.argument,n.Unary,D),""===v?r=U(e.operator,o):(r=[e.operator],e.operator.length>2?r=U(r,o):(u=(s=I(r).toString()).charCodeAt(s.length-1),a=o.toString().charCodeAt(0),(43===u||45===u)&&u===a||l.code.isIdentifierPartES5(u)&&l.code.isIdentifierPartES5(a)?(r.push(N()),r.push(o)):r.push(o))),X(r,n.Unary,t)},YieldExpression:function(e,t,i){var r;return r=e.delegate?"yield*":"yield",e.argument&&(r=U(r,this.generateExpression(e.argument,n.Yield,D))),X(r,n.Yield,t)},AwaitExpression:function(e,t,i){return X(U(e.all?"await*":"await",this.generateExpression(e.argument,n.Await,D)),n.Await,t)},UpdateExpression:function(e,t,i){return e.prefix?X([e.operator,this.generateExpression(e.argument,n.Unary,D)],n.Unary,t):X([this.generateExpression(e.argument,n.Postfix,D),e.operator],n.Postfix,t)},FunctionExpression:function(e,t,i){var r=[Z(e,!0),"function"];return e.id?(r.push(K(e)||N()),r.push(Q(e.id))):r.push(K(e)||v),r.push(this.generateFunctionBody(e)),r},ArrayPattern:function(e,t,i){return this.ArrayExpression(e,t,i,!0)},ArrayExpression:function(e,t,i,r){var o,a,s=this;return e.elements.length?(a=!r&&e.elements.length>1,o=["[",a?g:""],z((function(t){var i,r;for(i=0,r=e.elements.length;i<r;++i)e.elements[i]?(o.push(a?t:""),o.push(s.generateExpression(e.elements[i],n.Assignment,D))):(a&&o.push(t),i+1===r&&o.push(",")),i+1<r&&o.push(","+(a?g:v))})),a&&!F(I(o).toString())&&o.push(g),o.push(a?u:""),o.push("]"),o):"[]"},RestElement:function(e,t,i){return"..."+this.generatePattern(e.argument)},ClassExpression:function(e,t,i){var r,o;return r=["class"],e.id&&(r=U(r,this.generateExpression(e.id,n.Sequence,D))),e.superClass&&(o=U("extends",this.generateExpression(e.superClass,n.Assignment,D)),r=U(r,o)),r.push(v),r.push(this.generateStatement(e.body,33)),r},MethodDefinition:function(e,t,i){var r,n;return r=e.static?["static"+v]:[],n="get"===e.kind||"set"===e.kind?[U(e.kind,this.generatePropertyKey(e.key,e.computed)),this.generateFunctionBody(e.value)]:[$(e),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)],U(r,n)},Property:function(e,t,i){return"get"===e.kind||"set"===e.kind?[e.kind,N(),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)]:e.shorthand?"AssignmentPattern"===e.value.type?this.AssignmentPattern(e.value,n.Sequence,D):this.generatePropertyKey(e.key,e.computed):e.method?[$(e),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)]:[this.generatePropertyKey(e.key,e.computed),":"+v,this.generateExpression(e.value,n.Assignment,D)]},ObjectExpression:function(e,t,i){var r,o,a,s,l=this;return e.properties.length?(r=e.properties.length>1,z((function(){a=l.generateExpression(e.properties[0],n.Sequence,D)})),r||(s=I(a).toString(),/[\r\n]/g.test(s))?(z((function(t){var i,s;if(o=["{",g,t,a],r)for(o.push(","+g),i=1,s=e.properties.length;i<s;++i)o.push(t),o.push(l.generateExpression(e.properties[i],n.Sequence,D)),i+1<s&&o.push(","+g)})),F(I(o).toString())||o.push(g),o.push(u),o.push("}"),o):["{",v,a,v,"}"]):"{}"},AssignmentPattern:function(e,t,i){return this.generateAssignment(e.left,e.right,"=",t,i)},ObjectPattern:function(e,t,i){var o,a,s,l,c=this;if(!e.properties.length)return"{}";if(l=!1,1===e.properties.length)e.properties[0].value.type!==r.Identifier&&(l=!0);else for(a=0,s=e.properties.length;a<s;++a)if(!e.properties[a].shorthand){l=!0;break}return o=["{",l?g:""],z((function(t){var i,r;for(i=0,r=e.properties.length;i<r;++i)o.push(l?t:""),o.push(c.generateExpression(e.properties[i],n.Sequence,D)),i+1<r&&o.push(","+(l?g:v))})),l&&!F(I(o).toString())&&o.push(g),o.push(l?u:""),o.push("}"),o},ThisExpression:function(e,t,i){return"this"},Super:function(e,t,i){return"super"},Identifier:function(e,t,i){return Q(e)},ImportDefaultSpecifier:function(e,t,i){return Q(e.id||e.local)},ImportNamespaceSpecifier:function(e,t,i){var r=["*"],n=e.id||e.local;return n&&r.push(v+"as"+N()+Q(n)),r},ImportSpecifier:function(e,t,i){var r=e.imported,n=[r.name],o=e.local;return o&&o.name!==r.name&&n.push(N()+"as"+N()+Q(o)),n},ExportSpecifier:function(e,t,i){var r=e.local,n=[r.name],o=e.exported;return o&&o.name!==r.name&&n.push(N()+"as"+N()+Q(o)),n},Literal:function(e,t,i){var n;if(e.hasOwnProperty("raw")&&w&&E.raw)try{if((n=w(e.raw).body[0].expression).type===r.Literal&&n.value===e.value)return e.raw}catch(e){}return null===e.value?"null":"string"==typeof e.value?function(e){var t,i,r,n,o,a="",s=0,u=0;for(t=0,i=e.length;t<i;++t){if(39===(r=e.charCodeAt(t)))++s;else if(34===r)++u;else if(47===r&&h)a+="\\";else{if(l.code.isLineTerminator(r)||92===r){a+=H(r);continue}if(!l.code.isIdentifierPartES5(r)&&(h&&r<32||!h&&!m&&(r<32||r>126))){a+=B(r,e.charCodeAt(t+1));continue}}a+=String.fromCharCode(r)}if(o=(n=!("double"===f||"auto"===f&&u<s))?"'":'"',!(n?s:u))return o+a+o;for(e=a,a=o,t=0,i=e.length;t<i;++t)(39===(r=e.charCodeAt(t))&&n||34===r&&!n)&&(a+="\\"),a+=String.fromCharCode(r);return a+o}(e.value):"number"==typeof e.value?function(e){var t,i,r,n,o;if(e!=e)throw new Error("Numeric literal whose value is NaN");if(e<0||0===e&&1/e<0)throw new Error("Numeric literal whose value is negative");if(e===1/0)return h?"null":p?"1e400":"1e+400";if(t=""+e,!p||t.length<3)return t;for(i=t.indexOf("."),h||48!==t.charCodeAt(0)||1!==i||(i=0,t=t.slice(1)),r=t,t=t.replace("e+","e"),n=0,(o=r.indexOf("e"))>0&&(n=+r.slice(o+1),r=r.slice(0,o)),i>=0&&(n-=r.length-i-1,r=+(r.slice(0,i)+r.slice(i+1))+""),o=0;48===r.charCodeAt(r.length+o-1);)--o;return 0!==o&&(n-=o,r=r.slice(0,o)),0!==n&&(r+="e"+n),(r.length<t.length||d&&e>1e12&&Math.floor(e)===e&&(r="0x"+e.toString(16)).length<t.length)&&+r===e&&(t=r),t}(e.value):"boolean"==typeof e.value?e.value?"true":"false":e.regex?"/"+e.regex.pattern+"/"+e.regex.flags:function(e){var t,i,r,n,o,a,s,l;if(i=e.toString(),e.source){if(!(t=i.match(/\/([^/]*)$/)))return i;for(r=t[1],i="",s=!1,l=!1,n=0,o=e.source.length;n<o;++n)a=e.source.charCodeAt(n),l?(i+=L(a,l),l=!1):(s?93===a&&(s=!1):47===a?i+="\\":91===a&&(s=!0),i+=L(a,l),l=92===a);return"/"+i+"/"+r}return i}(e.value)},GeneratorExpression:function(e,t,i){return this.ComprehensionExpression(e,t,i)},ComprehensionExpression:function(e,t,i){var o,a,s,l,u=this;return o=e.type===r.GeneratorExpression?["("]:["["],E.moz.comprehensionExpressionStartsWithAssignment&&(l=this.generateExpression(e.body,n.Assignment,D),o.push(l)),e.blocks&&z((function(){for(a=0,s=e.blocks.length;a<s;++a)l=u.generateExpression(e.blocks[a],n.Sequence,D),a>0||E.moz.comprehensionExpressionStartsWithAssignment?o=U(o,l):o.push(l)})),e.filter&&(o=U(o,"if"+v),l=this.generateExpression(e.filter,n.Sequence,D),o=U(o,["(",l,")"])),E.moz.comprehensionExpressionStartsWithAssignment||(l=this.generateExpression(e.body,n.Assignment,D),o=U(o,l)),o.push(e.type===r.GeneratorExpression?")":"]"),o},ComprehensionBlock:function(e,t,i){var o;return o=U(o=e.left.type===r.VariableDeclaration?[e.left.kind,N(),this.generateStatement(e.left.declarations[0],0)]:this.generateExpression(e.left,n.Call,D),e.of?"of":"in"),o=U(o,this.generateExpression(e.right,n.Sequence,D)),["for"+v+"(",o,")"]},SpreadElement:function(e,t,i){return["...",this.generateExpression(e.argument,n.Assignment,D)]},TaggedTemplateExpression:function(e,t,i){var r=3;return 2&i||(r=1),X([this.generateExpression(e.tag,n.Call,r),this.generateExpression(e.quasi,n.Primary,4)],n.TaggedTemplate,t)},TemplateElement:function(e,t,i){return e.value.raw},TemplateLiteral:function(e,t,i){var r,o,a;for(r=["`"],o=0,a=e.quasis.length;o<a;++o)r.push(this.generateExpression(e.quasis[o],n.Primary,D)),o+1<a&&(r.push("${"+v),r.push(this.generateExpression(e.expressions[o],n.Sequence,D)),r.push(v+"}"));return r.push("`"),r},ModuleSpecifier:function(e,t,i){return this.Literal(e,t,i)},ImportExpression:function(e,t,i){return X(["import(",this.generateExpression(e.source,n.Assignment,D),")"],n.Call,t)}},O(J.prototype,J.Expression),J.prototype.generateExpression=function(e,t,i){var o,a;return a=e.type||r.Property,E.verbatim&&e.hasOwnProperty(E.verbatim)?function(e,t){var i;return I("string"==typeof(i=e[E.verbatim])?X(Y(i),n.Sequence,t):X(Y(i.content),null!=i.precedence?i.precedence:n.Sequence,t),e)}(e,t):(o=this[a](e,t,i),E.comment&&(o=W(e,o)),I(o,e))},J.prototype.generateStatement=function(e,t){var i,n;return i=this[e.type](e,t),E.comment&&(i=W(e,i)),n=I(i).toString(),e.type!==r.Program||_||""!==g||"\n"!==n.charAt(n.length-1)||(i=T?I(i).replaceRight(/\s+$/,""):n.replace(/\s+$/,"")),I(i,e)},M={indent:{style:"",base:0},renumber:!0,hexadecimal:!0,quotes:"auto",escapeless:!0,compact:!0,parentheses:!1,semicolons:!1},C={indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:"\n",space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},t.version=i(/*! ./package.json */"./node_modules/escodegen/package.json").version,t.generate=function(r,n){var o,s,l={indent:null,base:null,parse:null,comment:!1,format:{indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:"\n",space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},moz:{comprehensionExpressionStartsWithAssignment:!1,starlessGenerator:!1},sourceMap:null,sourceMapRoot:null,sourceMapWithCode:!1,directive:!1,raw:!0,verbatim:null,sourceCode:null};return null!=n?("string"==typeof n.indent&&(l.format.indent.style=n.indent),"number"==typeof n.base&&(l.format.indent.base=n.base),n=k(l,n),c=n.format.indent.style,u="string"==typeof n.base?n.base:j(c,n.format.indent.base)):(c=(n=l).format.indent.style,u=j(c,n.format.indent.base)),h=n.format.json,p=n.format.renumber,d=!h&&n.format.hexadecimal,f=h?"double":n.format.quotes,m=n.format.escapeless,g=n.format.newline,v=n.format.space,n.format.compact&&(g=v=c=u=""),y=n.format.parentheses,b=n.format.semicolons,_=n.format.safeConcatenation,x=n.directive,w=h?null:n.parse,T=n.sourceMap,S=n.sourceCode,A=n.format.preserveBlankLines&&null!==S,E=n,T&&(a=t.browser?e.sourceMap.SourceNode:i(/*! source-map */"./node_modules/source-map/source-map.js").SourceNode),o=ee(r),T?(s=o.toStringWithSourceMap({file:n.file,sourceRoot:n.sourceMapRoot}),n.sourceContent&&s.map.setSourceContent(n.sourceMap,n.sourceContent),n.sourceMapWithCode?s:s.map.toString()):(s={code:o.toString(),map:null},n.sourceMapWithCode?s:s.code)},t.attachComments=s.attachComments,t.Precedence=k({},n),t.browser=!1,t.FORMAT_MINIFY=M,t.FORMAT_DEFAULTS=C}()}).call(this,i(/*! ./../webpack/buildin/global.js */"./node_modules/webpack/buildin/global.js"))},"./node_modules/escodegen/package.json":
/*!*********************************************!*\
  !*** ./node_modules/escodegen/package.json ***!
  \*********************************************/
/*! exports provided: _from, _id, _inBundle, _integrity, _location, _phantomChildren, _requested, _requiredBy, _resolved, _shasum, _spec, _where, bin, bugs, bundleDependencies, dependencies, deprecated, description, devDependencies, engines, files, homepage, license, main, maintainers, name, optionalDependencies, repository, scripts, version, default */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e){e.exports=JSON.parse('{"_from":"escodegen","_id":"escodegen@1.12.0","_inBundle":false,"_integrity":"sha512-TuA+EhsanGcme5T3R0L80u4t8CpbXQjegRmf7+FPTJrtCTErXFeelblRgHQa1FofEzqYYJmJ/OqjTwREp9qgmg==","_location":"/escodegen","_phantomChildren":{},"_requested":{"type":"tag","registry":true,"raw":"escodegen","name":"escodegen","escapedName":"escodegen","rawSpec":"","saveSpec":null,"fetchSpec":"latest"},"_requiredBy":["#USER","/"],"_resolved":"https://registry.npmjs.org/escodegen/-/escodegen-1.12.0.tgz","_shasum":"f763daf840af172bb3a2b6dd7219c0e17f7ff541","_spec":"escodegen","_where":"D:\\\\SourceCodes\\\\THING.EVAL","bin":{"esgenerate":"./bin/esgenerate.js","escodegen":"./bin/escodegen.js"},"bugs":{"url":"https://github.com/estools/escodegen/issues"},"bundleDependencies":false,"dependencies":{"esprima":"^3.1.3","estraverse":"^4.2.0","esutils":"^2.0.2","optionator":"^0.8.1","source-map":"~0.6.1"},"deprecated":false,"description":"ECMAScript code generator","devDependencies":{"acorn":"^4.0.4","bluebird":"^3.4.7","bower-registry-client":"^1.0.0","chai":"^3.5.0","commonjs-everywhere":"^0.9.7","gulp":"^3.8.10","gulp-eslint":"^3.0.1","gulp-mocha":"^3.0.1","semver":"^5.1.0"},"engines":{"node":">=4.0"},"files":["LICENSE.BSD","README.md","bin","escodegen.js","package.json"],"homepage":"http://github.com/estools/escodegen","license":"BSD-2-Clause","main":"escodegen.js","maintainers":[{"name":"Yusuke Suzuki","email":"utatane.tea@gmail.com","url":"http://github.com/Constellation"}],"name":"escodegen","optionalDependencies":{"source-map":"~0.6.1"},"repository":{"type":"git","url":"git+ssh://git@github.com/estools/escodegen.git"},"scripts":{"build":"cjsify -a path: tools/entry-point.js > escodegen.browser.js","build-min":"cjsify -ma path: tools/entry-point.js > escodegen.browser.min.js","lint":"gulp lint","release":"node tools/release.js","test":"gulp travis","unit-test":"gulp test"},"version":"1.12.0"}')},"./node_modules/esprima/dist/esprima.js":
/*!**********************************************!*\
  !*** ./node_modules/esprima/dist/esprima.js ***!
  \**********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r;r=function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}return i.m=e,i.c=t,i.p="",i(0)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(1),n=i(3),o=i(8),a=i(15);function s(e,t,i){var a=null,s=function(e,t){i&&i(e,t),a&&a.visit(e,t)},l="function"==typeof i?s:null,u=!1;if(t){u="boolean"==typeof t.comment&&t.comment;var c="boolean"==typeof t.attachComment&&t.attachComment;(u||c)&&((a=new r.CommentHandler).attach=c,t.comment=!0,l=s)}var h,p=!1;t&&"string"==typeof t.sourceType&&(p="module"===t.sourceType),h=t&&"boolean"==typeof t.jsx&&t.jsx?new n.JSXParser(e,t,l):new o.Parser(e,t,l);var d=p?h.parseModule():h.parseScript();return u&&a&&(d.comments=a.comments),h.config.tokens&&(d.tokens=h.tokens),h.config.tolerant&&(d.errors=h.errorHandler.errors),d}t.parse=s,t.parseModule=function(e,t,i){var r=t||{};return r.sourceType="module",s(e,r,i)},t.parseScript=function(e,t,i){var r=t||{};return r.sourceType="script",s(e,r,i)},t.tokenize=function(e,t,i){var r,n=new a.Tokenizer(e,t);r=[];try{for(;;){var o=n.getNextToken();if(!o)break;i&&(o=i(o)),r.push(o)}}catch(e){n.errorHandler.tolerate(e)}return n.errorHandler.tolerant&&(r.errors=n.errors()),r};var l=i(2);t.Syntax=l.Syntax,t.version="4.0.1"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(2),n=function(){function e(){this.attach=!1,this.comments=[],this.stack=[],this.leading=[],this.trailing=[]}return e.prototype.insertInnerComments=function(e,t){if(e.type===r.Syntax.BlockStatement&&0===e.body.length){for(var i=[],n=this.leading.length-1;n>=0;--n){var o=this.leading[n];t.end.offset>=o.start&&(i.unshift(o.comment),this.leading.splice(n,1),this.trailing.splice(n,1))}i.length&&(e.innerComments=i)}},e.prototype.findTrailingComments=function(e){var t=[];if(this.trailing.length>0){for(var i=this.trailing.length-1;i>=0;--i){var r=this.trailing[i];r.start>=e.end.offset&&t.unshift(r.comment)}return this.trailing.length=0,t}var n=this.stack[this.stack.length-1];if(n&&n.node.trailingComments){var o=n.node.trailingComments[0];o&&o.range[0]>=e.end.offset&&(t=n.node.trailingComments,delete n.node.trailingComments)}return t},e.prototype.findLeadingComments=function(e){for(var t,i=[];this.stack.length>0&&(o=this.stack[this.stack.length-1])&&o.start>=e.start.offset;)t=o.node,this.stack.pop();if(t){for(var r=(t.leadingComments?t.leadingComments.length:0)-1;r>=0;--r){var n=t.leadingComments[r];n.range[1]<=e.start.offset&&(i.unshift(n),t.leadingComments.splice(r,1))}return t.leadingComments&&0===t.leadingComments.length&&delete t.leadingComments,i}for(r=this.leading.length-1;r>=0;--r){var o;(o=this.leading[r]).start<=e.start.offset&&(i.unshift(o.comment),this.leading.splice(r,1))}return i},e.prototype.visitNode=function(e,t){if(!(e.type===r.Syntax.Program&&e.body.length>0)){this.insertInnerComments(e,t);var i=this.findTrailingComments(t),n=this.findLeadingComments(t);n.length>0&&(e.leadingComments=n),i.length>0&&(e.trailingComments=i),this.stack.push({node:e,start:t.start.offset})}},e.prototype.visitComment=function(e,t){var i="L"===e.type[0]?"Line":"Block",r={type:i,value:e.value};if(e.range&&(r.range=e.range),e.loc&&(r.loc=e.loc),this.comments.push(r),this.attach){var n={comment:{type:i,value:e.value,range:[t.start.offset,t.end.offset]},start:t.start.offset};e.loc&&(n.comment.loc=e.loc),e.type=i,this.leading.push(n),this.trailing.push(n)}},e.prototype.visit=function(e,t){"LineComment"===e.type?this.visitComment(e,t):"BlockComment"===e.type?this.visitComment(e,t):this.attach&&this.visitNode(e,t)},e}();t.CommentHandler=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"}},function(e,t,i){"use strict";var r,n=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(4),a=i(5),s=i(6),l=i(7),u=i(8),c=i(13),h=i(14);function p(e){var t;switch(e.type){case s.JSXSyntax.JSXIdentifier:t=e.name;break;case s.JSXSyntax.JSXNamespacedName:var i=e;t=p(i.namespace)+":"+p(i.name);break;case s.JSXSyntax.JSXMemberExpression:var r=e;t=p(r.object)+"."+p(r.property)}return t}c.TokenName[100]="JSXIdentifier",c.TokenName[101]="JSXText";var d=function(e){function t(t,i,r){return e.call(this,t,i,r)||this}return n(t,e),t.prototype.parsePrimaryExpression=function(){return this.match("<")?this.parseJSXRoot():e.prototype.parsePrimaryExpression.call(this)},t.prototype.startJSX=function(){this.scanner.index=this.startMarker.index,this.scanner.lineNumber=this.startMarker.line,this.scanner.lineStart=this.startMarker.index-this.startMarker.column},t.prototype.finishJSX=function(){this.nextToken()},t.prototype.reenterJSX=function(){this.startJSX(),this.expectJSX("}"),this.config.tokens&&this.tokens.pop()},t.prototype.createJSXNode=function(){return this.collectComments(),{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},t.prototype.createJSXChildNode=function(){return{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},t.prototype.scanXHTMLEntity=function(e){for(var t="&",i=!0,r=!1,n=!1,a=!1;!this.scanner.eof()&&i&&!r;){var s=this.scanner.source[this.scanner.index];if(s===e)break;if(r=";"===s,t+=s,++this.scanner.index,!r)switch(t.length){case 2:n="#"===s;break;case 3:n&&(i=(a="x"===s)||o.Character.isDecimalDigit(s.charCodeAt(0)),n=n&&!a);break;default:i=(i=i&&!(n&&!o.Character.isDecimalDigit(s.charCodeAt(0))))&&!(a&&!o.Character.isHexDigit(s.charCodeAt(0)))}}if(i&&r&&t.length>2){var l=t.substr(1,t.length-2);n&&l.length>1?t=String.fromCharCode(parseInt(l.substr(1),10)):a&&l.length>2?t=String.fromCharCode(parseInt("0"+l.substr(1),16)):n||a||!h.XHTMLEntities[l]||(t=h.XHTMLEntities[l])}return t},t.prototype.lexJSX=function(){var e=this.scanner.source.charCodeAt(this.scanner.index);if(60===e||62===e||47===e||58===e||61===e||123===e||125===e)return{type:7,value:s=this.scanner.source[this.scanner.index++],lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index-1,end:this.scanner.index};if(34===e||39===e){for(var t=this.scanner.index,i=this.scanner.source[this.scanner.index++],r="";!this.scanner.eof()&&(l=this.scanner.source[this.scanner.index++])!==i;)r+="&"===l?this.scanXHTMLEntity(i):l;return{type:8,value:r,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(46===e){var n=this.scanner.source.charCodeAt(this.scanner.index+1),a=this.scanner.source.charCodeAt(this.scanner.index+2),s=46===n&&46===a?"...":".";return t=this.scanner.index,this.scanner.index+=s.length,{type:7,value:s,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(96===e)return{type:10,value:"",lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index,end:this.scanner.index};if(o.Character.isIdentifierStart(e)&&92!==e){for(t=this.scanner.index,++this.scanner.index;!this.scanner.eof();){var l=this.scanner.source.charCodeAt(this.scanner.index);if(o.Character.isIdentifierPart(l)&&92!==l)++this.scanner.index;else{if(45!==l)break;++this.scanner.index}}return{type:100,value:this.scanner.source.slice(t,this.scanner.index),lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}return this.scanner.lex()},t.prototype.nextJSXToken=function(){this.collectComments(),this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;var e=this.lexJSX();return this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.config.tokens&&this.tokens.push(this.convertToken(e)),e},t.prototype.nextJSXText=function(){this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;for(var e=this.scanner.index,t="";!this.scanner.eof();){var i=this.scanner.source[this.scanner.index];if("{"===i||"<"===i)break;++this.scanner.index,t+=i,o.Character.isLineTerminator(i.charCodeAt(0))&&(++this.scanner.lineNumber,"\r"===i&&"\n"===this.scanner.source[this.scanner.index]&&++this.scanner.index,this.scanner.lineStart=this.scanner.index)}this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart;var r={type:101,value:t,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:e,end:this.scanner.index};return t.length>0&&this.config.tokens&&this.tokens.push(this.convertToken(r)),r},t.prototype.peekJSXToken=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.lexJSX();return this.scanner.restoreState(e),t},t.prototype.expectJSX=function(e){var t=this.nextJSXToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},t.prototype.matchJSX=function(e){var t=this.peekJSXToken();return 7===t.type&&t.value===e},t.prototype.parseJSXIdentifier=function(){var e=this.createJSXNode(),t=this.nextJSXToken();return 100!==t.type&&this.throwUnexpectedToken(t),this.finalize(e,new a.JSXIdentifier(t.value))},t.prototype.parseJSXElementName=function(){var e=this.createJSXNode(),t=this.parseJSXIdentifier();if(this.matchJSX(":")){var i=t;this.expectJSX(":");var r=this.parseJSXIdentifier();t=this.finalize(e,new a.JSXNamespacedName(i,r))}else if(this.matchJSX("."))for(;this.matchJSX(".");){var n=t;this.expectJSX(".");var o=this.parseJSXIdentifier();t=this.finalize(e,new a.JSXMemberExpression(n,o))}return t},t.prototype.parseJSXAttributeName=function(){var e,t=this.createJSXNode(),i=this.parseJSXIdentifier();if(this.matchJSX(":")){var r=i;this.expectJSX(":");var n=this.parseJSXIdentifier();e=this.finalize(t,new a.JSXNamespacedName(r,n))}else e=i;return e},t.prototype.parseJSXStringLiteralAttribute=function(){var e=this.createJSXNode(),t=this.nextJSXToken();8!==t.type&&this.throwUnexpectedToken(t);var i=this.getTokenRaw(t);return this.finalize(e,new l.Literal(t.value,i))},t.prototype.parseJSXExpressionAttribute=function(){var e=this.createJSXNode();this.expectJSX("{"),this.finishJSX(),this.match("}")&&this.tolerateError("JSX attributes must only be assigned a non-empty expression");var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new a.JSXExpressionContainer(t))},t.prototype.parseJSXAttributeValue=function(){return this.matchJSX("{")?this.parseJSXExpressionAttribute():this.matchJSX("<")?this.parseJSXElement():this.parseJSXStringLiteralAttribute()},t.prototype.parseJSXNameValueAttribute=function(){var e=this.createJSXNode(),t=this.parseJSXAttributeName(),i=null;return this.matchJSX("=")&&(this.expectJSX("="),i=this.parseJSXAttributeValue()),this.finalize(e,new a.JSXAttribute(t,i))},t.prototype.parseJSXSpreadAttribute=function(){var e=this.createJSXNode();this.expectJSX("{"),this.expectJSX("..."),this.finishJSX();var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new a.JSXSpreadAttribute(t))},t.prototype.parseJSXAttributes=function(){for(var e=[];!this.matchJSX("/")&&!this.matchJSX(">");){var t=this.matchJSX("{")?this.parseJSXSpreadAttribute():this.parseJSXNameValueAttribute();e.push(t)}return e},t.prototype.parseJSXOpeningElement=function(){var e=this.createJSXNode();this.expectJSX("<");var t=this.parseJSXElementName(),i=this.parseJSXAttributes(),r=this.matchJSX("/");return r&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new a.JSXOpeningElement(t,r,i))},t.prototype.parseJSXBoundaryElement=function(){var e=this.createJSXNode();if(this.expectJSX("<"),this.matchJSX("/")){this.expectJSX("/");var t=this.parseJSXElementName();return this.expectJSX(">"),this.finalize(e,new a.JSXClosingElement(t))}var i=this.parseJSXElementName(),r=this.parseJSXAttributes(),n=this.matchJSX("/");return n&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new a.JSXOpeningElement(i,n,r))},t.prototype.parseJSXEmptyExpression=function(){var e=this.createJSXChildNode();return this.collectComments(),this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.finalize(e,new a.JSXEmptyExpression)},t.prototype.parseJSXExpressionContainer=function(){var e,t=this.createJSXNode();return this.expectJSX("{"),this.matchJSX("}")?(e=this.parseJSXEmptyExpression(),this.expectJSX("}")):(this.finishJSX(),e=this.parseAssignmentExpression(),this.reenterJSX()),this.finalize(t,new a.JSXExpressionContainer(e))},t.prototype.parseJSXChildren=function(){for(var e=[];!this.scanner.eof();){var t=this.createJSXChildNode(),i=this.nextJSXText();if(i.start<i.end){var r=this.getTokenRaw(i),n=this.finalize(t,new a.JSXText(i.value,r));e.push(n)}if("{"!==this.scanner.source[this.scanner.index])break;var o=this.parseJSXExpressionContainer();e.push(o)}return e},t.prototype.parseComplexJSXElement=function(e){for(var t=[];!this.scanner.eof();){e.children=e.children.concat(this.parseJSXChildren());var i=this.createJSXChildNode(),r=this.parseJSXBoundaryElement();if(r.type===s.JSXSyntax.JSXOpeningElement){var n=r;if(n.selfClosing){var o=this.finalize(i,new a.JSXElement(n,[],null));e.children.push(o)}else t.push(e),e={node:i,opening:n,closing:null,children:[]}}if(r.type===s.JSXSyntax.JSXClosingElement){e.closing=r;var l=p(e.opening.name);if(l!==p(e.closing.name)&&this.tolerateError("Expected corresponding JSX closing tag for %0",l),!(t.length>0))break;o=this.finalize(e.node,new a.JSXElement(e.opening,e.children,e.closing)),(e=t[t.length-1]).children.push(o),t.pop()}}return e},t.prototype.parseJSXElement=function(){var e=this.createJSXNode(),t=this.parseJSXOpeningElement(),i=[],r=null;if(!t.selfClosing){var n=this.parseComplexJSXElement({node:e,opening:t,closing:r,children:i});i=n.children,r=n.closing}return this.finalize(e,new a.JSXElement(t,i,r))},t.prototype.parseJSXRoot=function(){this.config.tokens&&this.tokens.pop(),this.startJSX();var e=this.parseJSXElement();return this.finishJSX(),e},t.prototype.isStartOfExpression=function(){return e.prototype.isStartOfExpression.call(this)||this.match("<")},t}(u.Parser);t.JSXParser=d},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};t.Character={fromCodePoint:function(e){return e<65536?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10))+String.fromCharCode(56320+(e-65536&1023))},isWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},isIdentifierStart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&i.NonAsciiIdentifierStart.test(t.Character.fromCodePoint(e))},isIdentifierPart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&i.NonAsciiIdentifierPart.test(t.Character.fromCodePoint(e))},isDecimalDigit:function(e){return e>=48&&e<=57},isHexDigit:function(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102},isOctalDigit:function(e){return e>=48&&e<=55}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(6);t.JSXClosingElement=function(e){this.type=r.JSXSyntax.JSXClosingElement,this.name=e};t.JSXElement=function(e,t,i){this.type=r.JSXSyntax.JSXElement,this.openingElement=e,this.children=t,this.closingElement=i};t.JSXEmptyExpression=function(){this.type=r.JSXSyntax.JSXEmptyExpression};t.JSXExpressionContainer=function(e){this.type=r.JSXSyntax.JSXExpressionContainer,this.expression=e};t.JSXIdentifier=function(e){this.type=r.JSXSyntax.JSXIdentifier,this.name=e};t.JSXMemberExpression=function(e,t){this.type=r.JSXSyntax.JSXMemberExpression,this.object=e,this.property=t};t.JSXAttribute=function(e,t){this.type=r.JSXSyntax.JSXAttribute,this.name=e,this.value=t};t.JSXNamespacedName=function(e,t){this.type=r.JSXSyntax.JSXNamespacedName,this.namespace=e,this.name=t};t.JSXOpeningElement=function(e,t,i){this.type=r.JSXSyntax.JSXOpeningElement,this.name=e,this.selfClosing=t,this.attributes=i};t.JSXSpreadAttribute=function(e){this.type=r.JSXSyntax.JSXSpreadAttribute,this.argument=e};t.JSXText=function(e,t){this.type=r.JSXSyntax.JSXText,this.value=e,this.raw=t}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSXSyntax={JSXAttribute:"JSXAttribute",JSXClosingElement:"JSXClosingElement",JSXElement:"JSXElement",JSXEmptyExpression:"JSXEmptyExpression",JSXExpressionContainer:"JSXExpressionContainer",JSXIdentifier:"JSXIdentifier",JSXMemberExpression:"JSXMemberExpression",JSXNamespacedName:"JSXNamespacedName",JSXOpeningElement:"JSXOpeningElement",JSXSpreadAttribute:"JSXSpreadAttribute",JSXText:"JSXText"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(2);t.ArrayExpression=function(e){this.type=r.Syntax.ArrayExpression,this.elements=e};t.ArrayPattern=function(e){this.type=r.Syntax.ArrayPattern,this.elements=e};t.ArrowFunctionExpression=function(e,t,i){this.type=r.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,this.body=t,this.generator=!1,this.expression=i,this.async=!1};t.AssignmentExpression=function(e,t,i){this.type=r.Syntax.AssignmentExpression,this.operator=e,this.left=t,this.right=i};t.AssignmentPattern=function(e,t){this.type=r.Syntax.AssignmentPattern,this.left=e,this.right=t};t.AsyncArrowFunctionExpression=function(e,t,i){this.type=r.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,this.body=t,this.generator=!1,this.expression=i,this.async=!0};t.AsyncFunctionDeclaration=function(e,t,i){this.type=r.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=i,this.generator=!1,this.expression=!1,this.async=!0};t.AsyncFunctionExpression=function(e,t,i){this.type=r.Syntax.FunctionExpression,this.id=e,this.params=t,this.body=i,this.generator=!1,this.expression=!1,this.async=!0};t.AwaitExpression=function(e){this.type=r.Syntax.AwaitExpression,this.argument=e};t.BinaryExpression=function(e,t,i){var n="||"===e||"&&"===e;this.type=n?r.Syntax.LogicalExpression:r.Syntax.BinaryExpression,this.operator=e,this.left=t,this.right=i};t.BlockStatement=function(e){this.type=r.Syntax.BlockStatement,this.body=e};t.BreakStatement=function(e){this.type=r.Syntax.BreakStatement,this.label=e};t.CallExpression=function(e,t){this.type=r.Syntax.CallExpression,this.callee=e,this.arguments=t};t.CatchClause=function(e,t){this.type=r.Syntax.CatchClause,this.param=e,this.body=t};t.ClassBody=function(e){this.type=r.Syntax.ClassBody,this.body=e};t.ClassDeclaration=function(e,t,i){this.type=r.Syntax.ClassDeclaration,this.id=e,this.superClass=t,this.body=i};t.ClassExpression=function(e,t,i){this.type=r.Syntax.ClassExpression,this.id=e,this.superClass=t,this.body=i};t.ComputedMemberExpression=function(e,t){this.type=r.Syntax.MemberExpression,this.computed=!0,this.object=e,this.property=t};t.ConditionalExpression=function(e,t,i){this.type=r.Syntax.ConditionalExpression,this.test=e,this.consequent=t,this.alternate=i};t.ContinueStatement=function(e){this.type=r.Syntax.ContinueStatement,this.label=e};t.DebuggerStatement=function(){this.type=r.Syntax.DebuggerStatement};t.Directive=function(e,t){this.type=r.Syntax.ExpressionStatement,this.expression=e,this.directive=t};t.DoWhileStatement=function(e,t){this.type=r.Syntax.DoWhileStatement,this.body=e,this.test=t};t.EmptyStatement=function(){this.type=r.Syntax.EmptyStatement};t.ExportAllDeclaration=function(e){this.type=r.Syntax.ExportAllDeclaration,this.source=e};t.ExportDefaultDeclaration=function(e){this.type=r.Syntax.ExportDefaultDeclaration,this.declaration=e};t.ExportNamedDeclaration=function(e,t,i){this.type=r.Syntax.ExportNamedDeclaration,this.declaration=e,this.specifiers=t,this.source=i};t.ExportSpecifier=function(e,t){this.type=r.Syntax.ExportSpecifier,this.exported=t,this.local=e};t.ExpressionStatement=function(e){this.type=r.Syntax.ExpressionStatement,this.expression=e};t.ForInStatement=function(e,t,i){this.type=r.Syntax.ForInStatement,this.left=e,this.right=t,this.body=i,this.each=!1};t.ForOfStatement=function(e,t,i){this.type=r.Syntax.ForOfStatement,this.left=e,this.right=t,this.body=i};t.ForStatement=function(e,t,i,n){this.type=r.Syntax.ForStatement,this.init=e,this.test=t,this.update=i,this.body=n};t.FunctionDeclaration=function(e,t,i,n){this.type=r.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=i,this.generator=n,this.expression=!1,this.async=!1};t.FunctionExpression=function(e,t,i,n){this.type=r.Syntax.FunctionExpression,this.id=e,this.params=t,this.body=i,this.generator=n,this.expression=!1,this.async=!1};t.Identifier=function(e){this.type=r.Syntax.Identifier,this.name=e};t.IfStatement=function(e,t,i){this.type=r.Syntax.IfStatement,this.test=e,this.consequent=t,this.alternate=i};t.ImportDeclaration=function(e,t){this.type=r.Syntax.ImportDeclaration,this.specifiers=e,this.source=t};t.ImportDefaultSpecifier=function(e){this.type=r.Syntax.ImportDefaultSpecifier,this.local=e};t.ImportNamespaceSpecifier=function(e){this.type=r.Syntax.ImportNamespaceSpecifier,this.local=e};t.ImportSpecifier=function(e,t){this.type=r.Syntax.ImportSpecifier,this.local=e,this.imported=t};t.LabeledStatement=function(e,t){this.type=r.Syntax.LabeledStatement,this.label=e,this.body=t};t.Literal=function(e,t){this.type=r.Syntax.Literal,this.value=e,this.raw=t};t.MetaProperty=function(e,t){this.type=r.Syntax.MetaProperty,this.meta=e,this.property=t};t.MethodDefinition=function(e,t,i,n,o){this.type=r.Syntax.MethodDefinition,this.key=e,this.computed=t,this.value=i,this.kind=n,this.static=o};t.Module=function(e){this.type=r.Syntax.Program,this.body=e,this.sourceType="module"};t.NewExpression=function(e,t){this.type=r.Syntax.NewExpression,this.callee=e,this.arguments=t};t.ObjectExpression=function(e){this.type=r.Syntax.ObjectExpression,this.properties=e};t.ObjectPattern=function(e){this.type=r.Syntax.ObjectPattern,this.properties=e};t.Property=function(e,t,i,n,o,a){this.type=r.Syntax.Property,this.key=t,this.computed=i,this.value=n,this.kind=e,this.method=o,this.shorthand=a};t.RegexLiteral=function(e,t,i,n){this.type=r.Syntax.Literal,this.value=e,this.raw=t,this.regex={pattern:i,flags:n}};t.RestElement=function(e){this.type=r.Syntax.RestElement,this.argument=e};t.ReturnStatement=function(e){this.type=r.Syntax.ReturnStatement,this.argument=e};t.Script=function(e){this.type=r.Syntax.Program,this.body=e,this.sourceType="script"};t.SequenceExpression=function(e){this.type=r.Syntax.SequenceExpression,this.expressions=e};t.SpreadElement=function(e){this.type=r.Syntax.SpreadElement,this.argument=e};t.StaticMemberExpression=function(e,t){this.type=r.Syntax.MemberExpression,this.computed=!1,this.object=e,this.property=t};t.Super=function(){this.type=r.Syntax.Super};t.SwitchCase=function(e,t){this.type=r.Syntax.SwitchCase,this.test=e,this.consequent=t};t.SwitchStatement=function(e,t){this.type=r.Syntax.SwitchStatement,this.discriminant=e,this.cases=t};t.TaggedTemplateExpression=function(e,t){this.type=r.Syntax.TaggedTemplateExpression,this.tag=e,this.quasi=t};t.TemplateElement=function(e,t){this.type=r.Syntax.TemplateElement,this.value=e,this.tail=t};t.TemplateLiteral=function(e,t){this.type=r.Syntax.TemplateLiteral,this.quasis=e,this.expressions=t};t.ThisExpression=function(){this.type=r.Syntax.ThisExpression};t.ThrowStatement=function(e){this.type=r.Syntax.ThrowStatement,this.argument=e};t.TryStatement=function(e,t,i){this.type=r.Syntax.TryStatement,this.block=e,this.handler=t,this.finalizer=i};t.UnaryExpression=function(e,t){this.type=r.Syntax.UnaryExpression,this.operator=e,this.argument=t,this.prefix=!0};t.UpdateExpression=function(e,t,i){this.type=r.Syntax.UpdateExpression,this.operator=e,this.argument=t,this.prefix=i};t.VariableDeclaration=function(e,t){this.type=r.Syntax.VariableDeclaration,this.declarations=e,this.kind=t};t.VariableDeclarator=function(e,t){this.type=r.Syntax.VariableDeclarator,this.id=e,this.init=t};t.WhileStatement=function(e,t){this.type=r.Syntax.WhileStatement,this.test=e,this.body=t};t.WithStatement=function(e,t){this.type=r.Syntax.WithStatement,this.object=e,this.body=t};t.YieldExpression=function(e,t){this.type=r.Syntax.YieldExpression,this.argument=e,this.delegate=t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(9),n=i(10),o=i(11),a=i(7),s=i(12),l=i(2),u=i(13),c=function(){function e(e,t,i){void 0===t&&(t={}),this.config={range:"boolean"==typeof t.range&&t.range,loc:"boolean"==typeof t.loc&&t.loc,source:null,tokens:"boolean"==typeof t.tokens&&t.tokens,comment:"boolean"==typeof t.comment&&t.comment,tolerant:"boolean"==typeof t.tolerant&&t.tolerant},this.config.loc&&t.source&&null!==t.source&&(this.config.source=String(t.source)),this.delegate=i,this.errorHandler=new n.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new s.Scanner(e,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:2,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={isModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},strict:!1},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}return e.prototype.throwError=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=Array.prototype.slice.call(arguments,1),o=e.replace(/%(\d)/g,(function(e,t){return r.assert(t<n.length,"Message reference must be in range"),n[t]})),a=this.lastMarker.index,s=this.lastMarker.line,l=this.lastMarker.column+1;throw this.errorHandler.createError(a,s,l,o)},e.prototype.tolerateError=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=Array.prototype.slice.call(arguments,1),o=e.replace(/%(\d)/g,(function(e,t){return r.assert(t<n.length,"Message reference must be in range"),n[t]})),a=this.lastMarker.index,s=this.scanner.lineNumber,l=this.lastMarker.column+1;this.errorHandler.tolerateError(a,s,l,o)},e.prototype.unexpectedTokenError=function(e,t){var i,r=t||o.Messages.UnexpectedToken;if(e?(t||(r=2===e.type?o.Messages.UnexpectedEOS:3===e.type?o.Messages.UnexpectedIdentifier:6===e.type?o.Messages.UnexpectedNumber:8===e.type?o.Messages.UnexpectedString:10===e.type?o.Messages.UnexpectedTemplate:o.Messages.UnexpectedToken,4===e.type&&(this.scanner.isFutureReservedWord(e.value)?r=o.Messages.UnexpectedReserved:this.context.strict&&this.scanner.isStrictModeReservedWord(e.value)&&(r=o.Messages.StrictReservedWord))),i=e.value):i="ILLEGAL",r=r.replace("%0",i),e&&"number"==typeof e.lineNumber){var n=e.start,a=e.lineNumber,s=this.lastMarker.index-this.lastMarker.column,l=e.start-s+1;return this.errorHandler.createError(n,a,l,r)}return n=this.lastMarker.index,a=this.lastMarker.line,l=this.lastMarker.column+1,this.errorHandler.createError(n,a,l,r)},e.prototype.throwUnexpectedToken=function(e,t){throw this.unexpectedTokenError(e,t)},e.prototype.tolerateUnexpectedToken=function(e,t){this.errorHandler.tolerate(this.unexpectedTokenError(e,t))},e.prototype.collectComments=function(){if(this.config.comment){var e=this.scanner.scanComments();if(e.length>0&&this.delegate)for(var t=0;t<e.length;++t){var i=e[t],r=void 0;r={type:i.multiLine?"BlockComment":"LineComment",value:this.scanner.source.slice(i.slice[0],i.slice[1])},this.config.range&&(r.range=i.range),this.config.loc&&(r.loc=i.loc);var n={start:{line:i.loc.start.line,column:i.loc.start.column,offset:i.range[0]},end:{line:i.loc.end.line,column:i.loc.end.column,offset:i.range[1]}};this.delegate(r,n)}}else this.scanner.scanComments()},e.prototype.getTokenRaw=function(e){return this.scanner.source.slice(e.start,e.end)},e.prototype.convertToken=function(e){var t={type:u.TokenName[e.type],value:this.getTokenRaw(e)};if(this.config.range&&(t.range=[e.start,e.end]),this.config.loc&&(t.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),9===e.type){var i=e.pattern,r=e.flags;t.regex={pattern:i,flags:r}}return t},e.prototype.nextToken=function(){var e=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);var t=this.scanner.lex();return this.hasLineTerminator=e.lineNumber!==t.lineNumber,t&&this.context.strict&&3===t.type&&this.scanner.isStrictModeReservedWord(t.value)&&(t.type=4),this.lookahead=t,this.config.tokens&&2!==t.type&&this.tokens.push(this.convertToken(t)),e},e.prototype.nextRegexToken=function(){this.collectComments();var e=this.scanner.scanRegExp();return this.config.tokens&&(this.tokens.pop(),this.tokens.push(this.convertToken(e))),this.lookahead=e,this.nextToken(),e},e.prototype.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},e.prototype.startNode=function(e,t){void 0===t&&(t=0);var i=e.start-e.lineStart,r=e.lineNumber;return i<0&&(i+=t,r--),{index:e.start,line:r,column:i}},e.prototype.finalize=function(e,t){if(this.config.range&&(t.range=[e.index,this.lastMarker.index]),this.config.loc&&(t.loc={start:{line:e.line,column:e.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(t.loc.source=this.config.source)),this.delegate){var i={start:{line:e.line,column:e.column,offset:e.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(t,i)}return t},e.prototype.expect=function(e){var t=this.nextToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.expectCommaSeparator=function(){if(this.config.tolerant){var e=this.lookahead;7===e.type&&","===e.value?this.nextToken():7===e.type&&";"===e.value?(this.nextToken(),this.tolerateUnexpectedToken(e)):this.tolerateUnexpectedToken(e,o.Messages.UnexpectedToken)}else this.expect(",")},e.prototype.expectKeyword=function(e){var t=this.nextToken();4===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.match=function(e){return 7===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchKeyword=function(e){return 4===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchContextualKeyword=function(e){return 3===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchAssign=function(){if(7!==this.lookahead.type)return!1;var e=this.lookahead.value;return"="===e||"*="===e||"**="===e||"/="===e||"%="===e||"+="===e||"-="===e||"<<="===e||">>="===e||">>>="===e||"&="===e||"^="===e||"|="===e},e.prototype.isolateCoverGrammar=function(e){var t=this.context.isBindingElement,i=this.context.isAssignmentTarget,r=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var n=e.call(this);return null!==this.context.firstCoverInitializedNameError&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=t,this.context.isAssignmentTarget=i,this.context.firstCoverInitializedNameError=r,n},e.prototype.inheritCoverGrammar=function(e){var t=this.context.isBindingElement,i=this.context.isAssignmentTarget,r=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var n=e.call(this);return this.context.isBindingElement=this.context.isBindingElement&&t,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&i,this.context.firstCoverInitializedNameError=r||this.context.firstCoverInitializedNameError,n},e.prototype.consumeSemicolon=function(){this.match(";")?this.nextToken():this.hasLineTerminator||(2===this.lookahead.type||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)},e.prototype.parsePrimaryExpression=function(){var e,t,i,r=this.createNode();switch(this.lookahead.type){case 3:(this.context.isModule||this.context.await)&&"await"===this.lookahead.value&&this.tolerateUnexpectedToken(this.lookahead),e=this.matchAsyncFunction()?this.parseFunctionExpression():this.finalize(r,new a.Identifier(this.nextToken().value));break;case 6:case 8:this.context.strict&&this.lookahead.octal&&this.tolerateUnexpectedToken(this.lookahead,o.Messages.StrictOctalLiteral),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),i=this.getTokenRaw(t),e=this.finalize(r,new a.Literal(t.value,i));break;case 1:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),i=this.getTokenRaw(t),e=this.finalize(r,new a.Literal("true"===t.value,i));break;case 5:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),i=this.getTokenRaw(t),e=this.finalize(r,new a.Literal(null,i));break;case 10:e=this.parseTemplateLiteral();break;case 7:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,e=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":e=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":e=this.inheritCoverGrammar(this.parseObjectInitializer);break;case"/":case"/=":this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.scanner.index=this.startMarker.index,t=this.nextRegexToken(),i=this.getTokenRaw(t),e=this.finalize(r,new a.RegexLiteral(t.regex,i,t.pattern,t.flags));break;default:e=this.throwUnexpectedToken(this.nextToken())}break;case 4:!this.context.strict&&this.context.allowYield&&this.matchKeyword("yield")?e=this.parseIdentifierName():!this.context.strict&&this.matchKeyword("let")?e=this.finalize(r,new a.Identifier(this.nextToken().value)):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.matchKeyword("function")?e=this.parseFunctionExpression():this.matchKeyword("this")?(this.nextToken(),e=this.finalize(r,new a.ThisExpression)):e=this.matchKeyword("class")?this.parseClassExpression():this.throwUnexpectedToken(this.nextToken()));break;default:e=this.throwUnexpectedToken(this.nextToken())}return e},e.prototype.parseSpreadElement=function(){var e=this.createNode();this.expect("...");var t=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.finalize(e,new a.SpreadElement(t))},e.prototype.parseArrayInitializer=function(){var e=this.createNode(),t=[];for(this.expect("[");!this.match("]");)if(this.match(","))this.nextToken(),t.push(null);else if(this.match("...")){var i=this.parseSpreadElement();this.match("]")||(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.expect(",")),t.push(i)}else t.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(",");return this.expect("]"),this.finalize(e,new a.ArrayExpression(t))},e.prototype.parsePropertyMethod=function(e){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var t=this.context.strict,i=this.context.allowStrictDirective;this.context.allowStrictDirective=e.simple;var r=this.isolateCoverGrammar(this.parseFunctionSourceElements);return this.context.strict&&e.firstRestricted&&this.tolerateUnexpectedToken(e.firstRestricted,e.message),this.context.strict&&e.stricted&&this.tolerateUnexpectedToken(e.stricted,e.message),this.context.strict=t,this.context.allowStrictDirective=i,r},e.prototype.parsePropertyMethodFunction=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var i=this.parseFormalParameters(),r=this.parsePropertyMethod(i);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,i.params,r,!1))},e.prototype.parsePropertyMethodAsyncFunction=function(){var e=this.createNode(),t=this.context.allowYield,i=this.context.await;this.context.allowYield=!1,this.context.await=!0;var r=this.parseFormalParameters(),n=this.parsePropertyMethod(r);return this.context.allowYield=t,this.context.await=i,this.finalize(e,new a.AsyncFunctionExpression(null,r.params,n))},e.prototype.parseObjectPropertyKey=function(){var e,t=this.createNode(),i=this.nextToken();switch(i.type){case 8:case 6:this.context.strict&&i.octal&&this.tolerateUnexpectedToken(i,o.Messages.StrictOctalLiteral);var r=this.getTokenRaw(i);e=this.finalize(t,new a.Literal(i.value,r));break;case 3:case 1:case 5:case 4:e=this.finalize(t,new a.Identifier(i.value));break;case 7:"["===i.value?(e=this.isolateCoverGrammar(this.parseAssignmentExpression),this.expect("]")):e=this.throwUnexpectedToken(i);break;default:e=this.throwUnexpectedToken(i)}return e},e.prototype.isPropertyKey=function(e,t){return e.type===l.Syntax.Identifier&&e.name===t||e.type===l.Syntax.Literal&&e.value===t},e.prototype.parseObjectProperty=function(e){var t,i=this.createNode(),r=this.lookahead,n=null,s=null,l=!1,u=!1,c=!1,h=!1;if(3===r.type){var p=r.value;this.nextToken(),l=this.match("["),n=(h=!(this.hasLineTerminator||"async"!==p||this.match(":")||this.match("(")||this.match("*")||this.match(",")))?this.parseObjectPropertyKey():this.finalize(i,new a.Identifier(p))}else this.match("*")?this.nextToken():(l=this.match("["),n=this.parseObjectPropertyKey());var d=this.qualifiedPropertyName(this.lookahead);if(3===r.type&&!h&&"get"===r.value&&d)t="get",l=this.match("["),n=this.parseObjectPropertyKey(),this.context.allowYield=!1,s=this.parseGetterMethod();else if(3===r.type&&!h&&"set"===r.value&&d)t="set",l=this.match("["),n=this.parseObjectPropertyKey(),s=this.parseSetterMethod();else if(7===r.type&&"*"===r.value&&d)t="init",l=this.match("["),n=this.parseObjectPropertyKey(),s=this.parseGeneratorMethod(),u=!0;else if(n||this.throwUnexpectedToken(this.lookahead),t="init",this.match(":")&&!h)!l&&this.isPropertyKey(n,"__proto__")&&(e.value&&this.tolerateError(o.Messages.DuplicateProtoProperty),e.value=!0),this.nextToken(),s=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(this.match("("))s=h?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),u=!0;else if(3===r.type)if(p=this.finalize(i,new a.Identifier(r.value)),this.match("=")){this.context.firstCoverInitializedNameError=this.lookahead,this.nextToken(),c=!0;var f=this.isolateCoverGrammar(this.parseAssignmentExpression);s=this.finalize(i,new a.AssignmentPattern(p,f))}else c=!0,s=p;else this.throwUnexpectedToken(this.nextToken());return this.finalize(i,new a.Property(t,n,l,s,u,c))},e.prototype.parseObjectInitializer=function(){var e=this.createNode();this.expect("{");for(var t=[],i={value:!1};!this.match("}");)t.push(this.parseObjectProperty(i)),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(e,new a.ObjectExpression(t))},e.prototype.parseTemplateHead=function(){r.assert(this.lookahead.head,"Template literal must start with a template head");var e=this.createNode(),t=this.nextToken(),i=t.value,n=t.cooked;return this.finalize(e,new a.TemplateElement({raw:i,cooked:n},t.tail))},e.prototype.parseTemplateElement=function(){10!==this.lookahead.type&&this.throwUnexpectedToken();var e=this.createNode(),t=this.nextToken(),i=t.value,r=t.cooked;return this.finalize(e,new a.TemplateElement({raw:i,cooked:r},t.tail))},e.prototype.parseTemplateLiteral=function(){var e=this.createNode(),t=[],i=[],r=this.parseTemplateHead();for(i.push(r);!r.tail;)t.push(this.parseExpression()),r=this.parseTemplateElement(),i.push(r);return this.finalize(e,new a.TemplateLiteral(i,t))},e.prototype.reinterpretExpressionAsPattern=function(e){switch(e.type){case l.Syntax.Identifier:case l.Syntax.MemberExpression:case l.Syntax.RestElement:case l.Syntax.AssignmentPattern:break;case l.Syntax.SpreadElement:e.type=l.Syntax.RestElement,this.reinterpretExpressionAsPattern(e.argument);break;case l.Syntax.ArrayExpression:e.type=l.Syntax.ArrayPattern;for(var t=0;t<e.elements.length;t++)null!==e.elements[t]&&this.reinterpretExpressionAsPattern(e.elements[t]);break;case l.Syntax.ObjectExpression:for(e.type=l.Syntax.ObjectPattern,t=0;t<e.properties.length;t++)this.reinterpretExpressionAsPattern(e.properties[t].value);break;case l.Syntax.AssignmentExpression:e.type=l.Syntax.AssignmentPattern,delete e.operator,this.reinterpretExpressionAsPattern(e.left)}},e.prototype.parseGroupExpression=function(){var e;if(this.expect("("),this.match(")"))this.nextToken(),this.match("=>")||this.expect("=>"),e={type:"ArrowParameterPlaceHolder",params:[],async:!1};else{var t=this.lookahead,i=[];if(this.match("..."))e=this.parseRestElement(i),this.expect(")"),this.match("=>")||this.expect("=>"),e={type:"ArrowParameterPlaceHolder",params:[e],async:!1};else{var r=!1;if(this.context.isBindingElement=!0,e=this.inheritCoverGrammar(this.parseAssignmentExpression),this.match(",")){var n=[];for(this.context.isAssignmentTarget=!1,n.push(e);2!==this.lookahead.type&&this.match(",");){if(this.nextToken(),this.match(")")){this.nextToken();for(var o=0;o<n.length;o++)this.reinterpretExpressionAsPattern(n[o]);r=!0,e={type:"ArrowParameterPlaceHolder",params:n,async:!1}}else if(this.match("...")){for(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),n.push(this.parseRestElement(i)),this.expect(")"),this.match("=>")||this.expect("=>"),this.context.isBindingElement=!1,o=0;o<n.length;o++)this.reinterpretExpressionAsPattern(n[o]);r=!0,e={type:"ArrowParameterPlaceHolder",params:n,async:!1}}else n.push(this.inheritCoverGrammar(this.parseAssignmentExpression));if(r)break}r||(e=this.finalize(this.startNode(t),new a.SequenceExpression(n)))}if(!r){if(this.expect(")"),this.match("=>")&&(e.type===l.Syntax.Identifier&&"yield"===e.name&&(r=!0,e={type:"ArrowParameterPlaceHolder",params:[e],async:!1}),!r)){if(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),e.type===l.Syntax.SequenceExpression)for(o=0;o<e.expressions.length;o++)this.reinterpretExpressionAsPattern(e.expressions[o]);else this.reinterpretExpressionAsPattern(e);e={type:"ArrowParameterPlaceHolder",params:e.type===l.Syntax.SequenceExpression?e.expressions:[e],async:!1}}this.context.isBindingElement=!1}}}return e},e.prototype.parseArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAssignmentExpression);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},e.prototype.isIdentifierName=function(e){return 3===e.type||4===e.type||1===e.type||5===e.type},e.prototype.parseIdentifierName=function(){var e=this.createNode(),t=this.nextToken();return this.isIdentifierName(t)||this.throwUnexpectedToken(t),this.finalize(e,new a.Identifier(t.value))},e.prototype.parseNewExpression=function(){var e,t=this.createNode(),i=this.parseIdentifierName();if(r.assert("new"===i.name,"New expression must start with `new`"),this.match("."))if(this.nextToken(),3===this.lookahead.type&&this.context.inFunctionBody&&"target"===this.lookahead.value){var n=this.parseIdentifierName();e=new a.MetaProperty(i,n)}else this.throwUnexpectedToken(this.lookahead);else{var o=this.isolateCoverGrammar(this.parseLeftHandSideExpression),s=this.match("(")?this.parseArguments():[];e=new a.NewExpression(o,s),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return this.finalize(t,e)},e.prototype.parseAsyncArgument=function(){var e=this.parseAssignmentExpression();return this.context.firstCoverInitializedNameError=null,e},e.prototype.parseAsyncArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAsyncArgument);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},e.prototype.parseLeftHandSideExpressionAllowCall=function(){var e,t=this.lookahead,i=this.matchContextualKeyword("async"),r=this.context.allowIn;for(this.context.allowIn=!0,this.matchKeyword("super")&&this.context.inFunctionBody?(e=this.createNode(),this.nextToken(),e=this.finalize(e,new a.Super),this.match("(")||this.match(".")||this.match("[")||this.throwUnexpectedToken(this.lookahead)):e=this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");var n=this.parseIdentifierName();e=this.finalize(this.startNode(t),new a.StaticMemberExpression(e,n))}else if(this.match("(")){var o=i&&t.lineNumber===this.lookahead.lineNumber;this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;var s=o?this.parseAsyncArguments():this.parseArguments();if(e=this.finalize(this.startNode(t),new a.CallExpression(e,s)),o&&this.match("=>")){for(var l=0;l<s.length;++l)this.reinterpretExpressionAsPattern(s[l]);e={type:"ArrowParameterPlaceHolder",params:s,async:!0}}}else if(this.match("["))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("["),n=this.isolateCoverGrammar(this.parseExpression),this.expect("]"),e=this.finalize(this.startNode(t),new a.ComputedMemberExpression(e,n));else{if(10!==this.lookahead.type||!this.lookahead.head)break;var u=this.parseTemplateLiteral();e=this.finalize(this.startNode(t),new a.TaggedTemplateExpression(e,u))}return this.context.allowIn=r,e},e.prototype.parseSuper=function(){var e=this.createNode();return this.expectKeyword("super"),this.match("[")||this.match(".")||this.throwUnexpectedToken(this.lookahead),this.finalize(e,new a.Super)},e.prototype.parseLeftHandSideExpression=function(){r.assert(this.context.allowIn,"callee of new expression always allow in keyword.");for(var e=this.startNode(this.lookahead),t=this.matchKeyword("super")&&this.context.inFunctionBody?this.parseSuper():this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");var i=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),t=this.finalize(e,new a.ComputedMemberExpression(t,i))}else if(this.match("."))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("."),i=this.parseIdentifierName(),t=this.finalize(e,new a.StaticMemberExpression(t,i));else{if(10!==this.lookahead.type||!this.lookahead.head)break;var n=this.parseTemplateLiteral();t=this.finalize(e,new a.TaggedTemplateExpression(t,n))}return t},e.prototype.parseUpdateExpression=function(){var e,t=this.lookahead;if(this.match("++")||this.match("--")){var i=this.startNode(t),r=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(o.Messages.StrictLHSPrefix),this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment);var n=!0;e=this.finalize(i,new a.UpdateExpression(r.value,e,n)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(e=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&7===this.lookahead.type&&(this.match("++")||this.match("--"))){this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(o.Messages.StrictLHSPostfix),this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var s=this.nextToken().value;n=!1,e=this.finalize(this.startNode(t),new a.UpdateExpression(s,e,n))}return e},e.prototype.parseAwaitExpression=function(){var e=this.createNode();this.nextToken();var t=this.parseUnaryExpression();return this.finalize(e,new a.AwaitExpression(t))},e.prototype.parseUnaryExpression=function(){var e;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")||this.matchKeyword("delete")||this.matchKeyword("void")||this.matchKeyword("typeof")){var t=this.startNode(this.lookahead),i=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),e=this.finalize(t,new a.UnaryExpression(i.value,e)),this.context.strict&&"delete"===e.operator&&e.argument.type===l.Syntax.Identifier&&this.tolerateError(o.Messages.StrictDelete),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else e=this.context.await&&this.matchContextualKeyword("await")?this.parseAwaitExpression():this.parseUpdateExpression();return e},e.prototype.parseExponentiationExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseUnaryExpression);if(t.type!==l.Syntax.UnaryExpression&&this.match("**")){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var i=t,r=this.isolateCoverGrammar(this.parseExponentiationExpression);t=this.finalize(this.startNode(e),new a.BinaryExpression("**",i,r))}return t},e.prototype.binaryPrecedence=function(e){var t=e.value;return 7===e.type?this.operatorPrecedence[t]||0:4===e.type&&("instanceof"===t||this.context.allowIn&&"in"===t)?7:0},e.prototype.parseBinaryExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseExponentiationExpression),i=this.lookahead,r=this.binaryPrecedence(i);if(r>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;for(var n=[e,this.lookahead],o=t,s=this.isolateCoverGrammar(this.parseExponentiationExpression),l=[o,i.value,s],u=[r];!((r=this.binaryPrecedence(this.lookahead))<=0);){for(;l.length>2&&r<=u[u.length-1];){s=l.pop();var c=l.pop();u.pop(),o=l.pop(),n.pop();var h=this.startNode(n[n.length-1]);l.push(this.finalize(h,new a.BinaryExpression(c,o,s)))}l.push(this.nextToken().value),u.push(r),n.push(this.lookahead),l.push(this.isolateCoverGrammar(this.parseExponentiationExpression))}var p=l.length-1;t=l[p];for(var d=n.pop();p>1;){var f=n.pop(),m=d&&d.lineStart;h=this.startNode(f,m),c=l[p-1],t=this.finalize(h,new a.BinaryExpression(c,l[p-2],t)),p-=2,d=f}}return t},e.prototype.parseConditionalExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.match("?")){this.nextToken();var i=this.context.allowIn;this.context.allowIn=!0;var r=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=i,this.expect(":");var n=this.isolateCoverGrammar(this.parseAssignmentExpression);t=this.finalize(this.startNode(e),new a.ConditionalExpression(t,r,n)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return t},e.prototype.checkPatternParam=function(e,t){switch(t.type){case l.Syntax.Identifier:this.validateParam(e,t,t.name);break;case l.Syntax.RestElement:this.checkPatternParam(e,t.argument);break;case l.Syntax.AssignmentPattern:this.checkPatternParam(e,t.left);break;case l.Syntax.ArrayPattern:for(var i=0;i<t.elements.length;i++)null!==t.elements[i]&&this.checkPatternParam(e,t.elements[i]);break;case l.Syntax.ObjectPattern:for(i=0;i<t.properties.length;i++)this.checkPatternParam(e,t.properties[i].value)}e.simple=e.simple&&t instanceof a.Identifier},e.prototype.reinterpretAsCoverFormalsList=function(e){var t,i=[e],r=!1;switch(e.type){case l.Syntax.Identifier:break;case"ArrowParameterPlaceHolder":i=e.params,r=e.async;break;default:return null}t={simple:!0,paramSet:{}};for(var n=0;n<i.length;++n)(a=i[n]).type===l.Syntax.AssignmentPattern?a.right.type===l.Syntax.YieldExpression&&(a.right.argument&&this.throwUnexpectedToken(this.lookahead),a.right.type=l.Syntax.Identifier,a.right.name="yield",delete a.right.argument,delete a.right.delegate):r&&a.type===l.Syntax.Identifier&&"await"===a.name&&this.throwUnexpectedToken(this.lookahead),this.checkPatternParam(t,a),i[n]=a;if(this.context.strict||!this.context.allowYield)for(n=0;n<i.length;++n){var a;(a=i[n]).type===l.Syntax.YieldExpression&&this.throwUnexpectedToken(this.lookahead)}if(t.message===o.Messages.StrictParamDupe){var s=this.context.strict?t.stricted:t.firstRestricted;this.throwUnexpectedToken(s,t.message)}return{simple:t.simple,params:i,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.parseAssignmentExpression=function(){var e;if(!this.context.allowYield&&this.matchKeyword("yield"))e=this.parseYieldExpression();else{var t=this.lookahead,i=t;if(e=this.parseConditionalExpression(),3===i.type&&i.lineNumber===this.lookahead.lineNumber&&"async"===i.value&&(3===this.lookahead.type||this.matchKeyword("yield"))){var r=this.parsePrimaryExpression();this.reinterpretExpressionAsPattern(r),e={type:"ArrowParameterPlaceHolder",params:[r],async:!0}}if("ArrowParameterPlaceHolder"===e.type||this.match("=>")){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var n=e.async,s=this.reinterpretAsCoverFormalsList(e);if(s){this.hasLineTerminator&&this.tolerateUnexpectedToken(this.lookahead),this.context.firstCoverInitializedNameError=null;var u=this.context.strict,c=this.context.allowStrictDirective;this.context.allowStrictDirective=s.simple;var h=this.context.allowYield,p=this.context.await;this.context.allowYield=!0,this.context.await=n;var d=this.startNode(t);this.expect("=>");var f=void 0;if(this.match("{")){var m=this.context.allowIn;this.context.allowIn=!0,f=this.parseFunctionSourceElements(),this.context.allowIn=m}else f=this.isolateCoverGrammar(this.parseAssignmentExpression);var g=f.type!==l.Syntax.BlockStatement;this.context.strict&&s.firstRestricted&&this.throwUnexpectedToken(s.firstRestricted,s.message),this.context.strict&&s.stricted&&this.tolerateUnexpectedToken(s.stricted,s.message),e=n?this.finalize(d,new a.AsyncArrowFunctionExpression(s.params,f,g)):this.finalize(d,new a.ArrowFunctionExpression(s.params,f,g)),this.context.strict=u,this.context.allowStrictDirective=c,this.context.allowYield=h,this.context.await=p}}else if(this.matchAssign()){if(this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment),this.context.strict&&e.type===l.Syntax.Identifier){var v=e;this.scanner.isRestrictedWord(v.name)&&this.tolerateUnexpectedToken(i,o.Messages.StrictLHSAssignment),this.scanner.isStrictModeReservedWord(v.name)&&this.tolerateUnexpectedToken(i,o.Messages.StrictReservedWord)}this.match("=")?this.reinterpretExpressionAsPattern(e):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1);var y=(i=this.nextToken()).value,b=this.isolateCoverGrammar(this.parseAssignmentExpression);e=this.finalize(this.startNode(t),new a.AssignmentExpression(y,e,b)),this.context.firstCoverInitializedNameError=null}}return e},e.prototype.parseExpression=function(){var e=this.lookahead,t=this.isolateCoverGrammar(this.parseAssignmentExpression);if(this.match(",")){var i=[];for(i.push(t);2!==this.lookahead.type&&this.match(",");)this.nextToken(),i.push(this.isolateCoverGrammar(this.parseAssignmentExpression));t=this.finalize(this.startNode(e),new a.SequenceExpression(i))}return t},e.prototype.parseStatementListItem=function(){var e;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,4===this.lookahead.type)switch(this.lookahead.value){case"export":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,o.Messages.IllegalExportDeclaration),e=this.parseExportDeclaration();break;case"import":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,o.Messages.IllegalImportDeclaration),e=this.parseImportDeclaration();break;case"const":e=this.parseLexicalDeclaration({inFor:!1});break;case"function":e=this.parseFunctionDeclaration();break;case"class":e=this.parseClassDeclaration();break;case"let":e=this.isLexicalDeclaration()?this.parseLexicalDeclaration({inFor:!1}):this.parseStatement();break;default:e=this.parseStatement()}else e=this.parseStatement();return e},e.prototype.parseBlock=function(){var e=this.createNode();this.expect("{");for(var t=[];!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.finalize(e,new a.BlockStatement(t))},e.prototype.parseLexicalBinding=function(e,t){var i=this.createNode(),r=this.parsePattern([],e);this.context.strict&&r.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(r.name)&&this.tolerateError(o.Messages.StrictVarName);var n=null;return"const"===e?this.matchKeyword("in")||this.matchContextualKeyword("of")||(this.match("=")?(this.nextToken(),n=this.isolateCoverGrammar(this.parseAssignmentExpression)):this.throwError(o.Messages.DeclarationMissingInitializer,"const")):(!t.inFor&&r.type!==l.Syntax.Identifier||this.match("="))&&(this.expect("="),n=this.isolateCoverGrammar(this.parseAssignmentExpression)),this.finalize(i,new a.VariableDeclarator(r,n))},e.prototype.parseBindingList=function(e,t){for(var i=[this.parseLexicalBinding(e,t)];this.match(",");)this.nextToken(),i.push(this.parseLexicalBinding(e,t));return i},e.prototype.isLexicalDeclaration=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.scanner.lex();return this.scanner.restoreState(e),3===t.type||7===t.type&&"["===t.value||7===t.type&&"{"===t.value||4===t.type&&"let"===t.value||4===t.type&&"yield"===t.value},e.prototype.parseLexicalDeclaration=function(e){var t=this.createNode(),i=this.nextToken().value;r.assert("let"===i||"const"===i,"Lexical declaration must be either let or const");var n=this.parseBindingList(i,e);return this.consumeSemicolon(),this.finalize(t,new a.VariableDeclaration(n,i))},e.prototype.parseBindingRestElement=function(e,t){var i=this.createNode();this.expect("...");var r=this.parsePattern(e,t);return this.finalize(i,new a.RestElement(r))},e.prototype.parseArrayPattern=function(e,t){var i=this.createNode();this.expect("[");for(var r=[];!this.match("]");)if(this.match(","))this.nextToken(),r.push(null);else{if(this.match("...")){r.push(this.parseBindingRestElement(e,t));break}r.push(this.parsePatternWithDefault(e,t)),this.match("]")||this.expect(",")}return this.expect("]"),this.finalize(i,new a.ArrayPattern(r))},e.prototype.parsePropertyPattern=function(e,t){var i,r,n=this.createNode(),o=!1,s=!1;if(3===this.lookahead.type){var l=this.lookahead;i=this.parseVariableIdentifier();var u=this.finalize(n,new a.Identifier(l.value));if(this.match("=")){e.push(l),s=!0,this.nextToken();var c=this.parseAssignmentExpression();r=this.finalize(this.startNode(l),new a.AssignmentPattern(u,c))}else this.match(":")?(this.expect(":"),r=this.parsePatternWithDefault(e,t)):(e.push(l),s=!0,r=u)}else o=this.match("["),i=this.parseObjectPropertyKey(),this.expect(":"),r=this.parsePatternWithDefault(e,t);return this.finalize(n,new a.Property("init",i,o,r,!1,s))},e.prototype.parseObjectPattern=function(e,t){var i=this.createNode(),r=[];for(this.expect("{");!this.match("}");)r.push(this.parsePropertyPattern(e,t)),this.match("}")||this.expect(",");return this.expect("}"),this.finalize(i,new a.ObjectPattern(r))},e.prototype.parsePattern=function(e,t){var i;return this.match("[")?i=this.parseArrayPattern(e,t):this.match("{")?i=this.parseObjectPattern(e,t):(!this.matchKeyword("let")||"const"!==t&&"let"!==t||this.tolerateUnexpectedToken(this.lookahead,o.Messages.LetInLexicalBinding),e.push(this.lookahead),i=this.parseVariableIdentifier(t)),i},e.prototype.parsePatternWithDefault=function(e,t){var i=this.lookahead,r=this.parsePattern(e,t);if(this.match("=")){this.nextToken();var n=this.context.allowYield;this.context.allowYield=!0;var o=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowYield=n,r=this.finalize(this.startNode(i),new a.AssignmentPattern(r,o))}return r},e.prototype.parseVariableIdentifier=function(e){var t=this.createNode(),i=this.nextToken();return 4===i.type&&"yield"===i.value?this.context.strict?this.tolerateUnexpectedToken(i,o.Messages.StrictReservedWord):this.context.allowYield||this.throwUnexpectedToken(i):3!==i.type?this.context.strict&&4===i.type&&this.scanner.isStrictModeReservedWord(i.value)?this.tolerateUnexpectedToken(i,o.Messages.StrictReservedWord):(this.context.strict||"let"!==i.value||"var"!==e)&&this.throwUnexpectedToken(i):(this.context.isModule||this.context.await)&&3===i.type&&"await"===i.value&&this.tolerateUnexpectedToken(i),this.finalize(t,new a.Identifier(i.value))},e.prototype.parseVariableDeclaration=function(e){var t=this.createNode(),i=this.parsePattern([],"var");this.context.strict&&i.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(i.name)&&this.tolerateError(o.Messages.StrictVarName);var r=null;return this.match("=")?(this.nextToken(),r=this.isolateCoverGrammar(this.parseAssignmentExpression)):i.type===l.Syntax.Identifier||e.inFor||this.expect("="),this.finalize(t,new a.VariableDeclarator(i,r))},e.prototype.parseVariableDeclarationList=function(e){var t={inFor:e.inFor},i=[];for(i.push(this.parseVariableDeclaration(t));this.match(",");)this.nextToken(),i.push(this.parseVariableDeclaration(t));return i},e.prototype.parseVariableStatement=function(){var e=this.createNode();this.expectKeyword("var");var t=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(e,new a.VariableDeclaration(t,"var"))},e.prototype.parseEmptyStatement=function(){var e=this.createNode();return this.expect(";"),this.finalize(e,new a.EmptyStatement)},e.prototype.parseExpressionStatement=function(){var e=this.createNode(),t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new a.ExpressionStatement(t))},e.prototype.parseIfClause=function(){return this.context.strict&&this.matchKeyword("function")&&this.tolerateError(o.Messages.StrictFunction),this.parseStatement()},e.prototype.parseIfStatement=function(){var e,t=this.createNode(),i=null;this.expectKeyword("if"),this.expect("(");var r=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new a.EmptyStatement)):(this.expect(")"),e=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),i=this.parseIfClause())),this.finalize(t,new a.IfStatement(r,e,i))},e.prototype.parseDoWhileStatement=function(){var e=this.createNode();this.expectKeyword("do");var t=this.context.inIteration;this.context.inIteration=!0;var i=this.parseStatement();this.context.inIteration=t,this.expectKeyword("while"),this.expect("(");var r=this.parseExpression();return!this.match(")")&&this.config.tolerant?this.tolerateUnexpectedToken(this.nextToken()):(this.expect(")"),this.match(";")&&this.nextToken()),this.finalize(e,new a.DoWhileStatement(i,r))},e.prototype.parseWhileStatement=function(){var e,t=this.createNode();this.expectKeyword("while"),this.expect("(");var i=this.parseExpression();if(!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new a.EmptyStatement);else{this.expect(")");var r=this.context.inIteration;this.context.inIteration=!0,e=this.parseStatement(),this.context.inIteration=r}return this.finalize(t,new a.WhileStatement(i,e))},e.prototype.parseForStatement=function(){var e,t,i,r=null,n=null,s=null,u=!0,c=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){r=this.createNode(),this.nextToken();var h=this.context.allowIn;this.context.allowIn=!1;var p=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=h,1===p.length&&this.matchKeyword("in")){var d=p[0];d.init&&(d.id.type===l.Syntax.ArrayPattern||d.id.type===l.Syntax.ObjectPattern||this.context.strict)&&this.tolerateError(o.Messages.ForInOfLoopInitializer,"for-in"),r=this.finalize(r,new a.VariableDeclaration(p,"var")),this.nextToken(),e=r,t=this.parseExpression(),r=null}else 1===p.length&&null===p[0].init&&this.matchContextualKeyword("of")?(r=this.finalize(r,new a.VariableDeclaration(p,"var")),this.nextToken(),e=r,t=this.parseAssignmentExpression(),r=null,u=!1):(r=this.finalize(r,new a.VariableDeclaration(p,"var")),this.expect(";"))}else if(this.matchKeyword("const")||this.matchKeyword("let")){r=this.createNode();var f=this.nextToken().value;this.context.strict||"in"!==this.lookahead.value?(h=this.context.allowIn,this.context.allowIn=!1,p=this.parseBindingList(f,{inFor:!0}),this.context.allowIn=h,1===p.length&&null===p[0].init&&this.matchKeyword("in")?(r=this.finalize(r,new a.VariableDeclaration(p,f)),this.nextToken(),e=r,t=this.parseExpression(),r=null):1===p.length&&null===p[0].init&&this.matchContextualKeyword("of")?(r=this.finalize(r,new a.VariableDeclaration(p,f)),this.nextToken(),e=r,t=this.parseAssignmentExpression(),r=null,u=!1):(this.consumeSemicolon(),r=this.finalize(r,new a.VariableDeclaration(p,f)))):(r=this.finalize(r,new a.Identifier(f)),this.nextToken(),e=r,t=this.parseExpression(),r=null)}else{var m=this.lookahead;if(h=this.context.allowIn,this.context.allowIn=!1,r=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=h,this.matchKeyword("in"))this.context.isAssignmentTarget&&r.type!==l.Syntax.AssignmentExpression||this.tolerateError(o.Messages.InvalidLHSInForIn),this.nextToken(),this.reinterpretExpressionAsPattern(r),e=r,t=this.parseExpression(),r=null;else if(this.matchContextualKeyword("of"))this.context.isAssignmentTarget&&r.type!==l.Syntax.AssignmentExpression||this.tolerateError(o.Messages.InvalidLHSInForLoop),this.nextToken(),this.reinterpretExpressionAsPattern(r),e=r,t=this.parseAssignmentExpression(),r=null,u=!1;else{if(this.match(",")){for(var g=[r];this.match(",");)this.nextToken(),g.push(this.isolateCoverGrammar(this.parseAssignmentExpression));r=this.finalize(this.startNode(m),new a.SequenceExpression(g))}this.expect(";")}}if(void 0===e&&(this.match(";")||(n=this.parseExpression()),this.expect(";"),this.match(")")||(s=this.parseExpression())),!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),i=this.finalize(this.createNode(),new a.EmptyStatement);else{this.expect(")");var v=this.context.inIteration;this.context.inIteration=!0,i=this.isolateCoverGrammar(this.parseStatement),this.context.inIteration=v}return void 0===e?this.finalize(c,new a.ForStatement(r,n,s,i)):u?this.finalize(c,new a.ForInStatement(e,t,i)):this.finalize(c,new a.ForOfStatement(e,t,i))},e.prototype.parseContinueStatement=function(){var e=this.createNode();this.expectKeyword("continue");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var i=this.parseVariableIdentifier();t=i;var r="$"+i.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,r)||this.throwError(o.Messages.UnknownLabel,i.name)}return this.consumeSemicolon(),null!==t||this.context.inIteration||this.throwError(o.Messages.IllegalContinue),this.finalize(e,new a.ContinueStatement(t))},e.prototype.parseBreakStatement=function(){var e=this.createNode();this.expectKeyword("break");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var i=this.parseVariableIdentifier(),r="$"+i.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,r)||this.throwError(o.Messages.UnknownLabel,i.name),t=i}return this.consumeSemicolon(),null!==t||this.context.inIteration||this.context.inSwitch||this.throwError(o.Messages.IllegalBreak),this.finalize(e,new a.BreakStatement(t))},e.prototype.parseReturnStatement=function(){this.context.inFunctionBody||this.tolerateError(o.Messages.IllegalReturn);var e=this.createNode();this.expectKeyword("return");var t=(this.match(";")||this.match("}")||this.hasLineTerminator||2===this.lookahead.type)&&8!==this.lookahead.type&&10!==this.lookahead.type?null:this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new a.ReturnStatement(t))},e.prototype.parseWithStatement=function(){this.context.strict&&this.tolerateError(o.Messages.StrictModeWith);var e,t=this.createNode();this.expectKeyword("with"),this.expect("(");var i=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new a.EmptyStatement)):(this.expect(")"),e=this.parseStatement()),this.finalize(t,new a.WithStatement(i,e))},e.prototype.parseSwitchCase=function(){var e,t=this.createNode();this.matchKeyword("default")?(this.nextToken(),e=null):(this.expectKeyword("case"),e=this.parseExpression()),this.expect(":");for(var i=[];!(this.match("}")||this.matchKeyword("default")||this.matchKeyword("case"));)i.push(this.parseStatementListItem());return this.finalize(t,new a.SwitchCase(e,i))},e.prototype.parseSwitchStatement=function(){var e=this.createNode();this.expectKeyword("switch"),this.expect("(");var t=this.parseExpression();this.expect(")");var i=this.context.inSwitch;this.context.inSwitch=!0;var r=[],n=!1;for(this.expect("{");!this.match("}");){var s=this.parseSwitchCase();null===s.test&&(n&&this.throwError(o.Messages.MultipleDefaultsInSwitch),n=!0),r.push(s)}return this.expect("}"),this.context.inSwitch=i,this.finalize(e,new a.SwitchStatement(t,r))},e.prototype.parseLabelledStatement=function(){var e,t=this.createNode(),i=this.parseExpression();if(i.type===l.Syntax.Identifier&&this.match(":")){this.nextToken();var r=i,n="$"+r.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,n)&&this.throwError(o.Messages.Redeclaration,"Label",r.name),this.context.labelSet[n]=!0;var s=void 0;if(this.matchKeyword("class"))this.tolerateUnexpectedToken(this.lookahead),s=this.parseClassDeclaration();else if(this.matchKeyword("function")){var u=this.lookahead,c=this.parseFunctionDeclaration();this.context.strict?this.tolerateUnexpectedToken(u,o.Messages.StrictFunction):c.generator&&this.tolerateUnexpectedToken(u,o.Messages.GeneratorInLegacyContext),s=c}else s=this.parseStatement();delete this.context.labelSet[n],e=new a.LabeledStatement(r,s)}else this.consumeSemicolon(),e=new a.ExpressionStatement(i);return this.finalize(t,e)},e.prototype.parseThrowStatement=function(){var e=this.createNode();this.expectKeyword("throw"),this.hasLineTerminator&&this.throwError(o.Messages.NewlineAfterThrow);var t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new a.ThrowStatement(t))},e.prototype.parseCatchClause=function(){var e=this.createNode();this.expectKeyword("catch"),this.expect("("),this.match(")")&&this.throwUnexpectedToken(this.lookahead);for(var t=[],i=this.parsePattern(t),r={},n=0;n<t.length;n++){var s="$"+t[n].value;Object.prototype.hasOwnProperty.call(r,s)&&this.tolerateError(o.Messages.DuplicateBinding,t[n].value),r[s]=!0}this.context.strict&&i.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(i.name)&&this.tolerateError(o.Messages.StrictCatchVariable),this.expect(")");var u=this.parseBlock();return this.finalize(e,new a.CatchClause(i,u))},e.prototype.parseFinallyClause=function(){return this.expectKeyword("finally"),this.parseBlock()},e.prototype.parseTryStatement=function(){var e=this.createNode();this.expectKeyword("try");var t=this.parseBlock(),i=this.matchKeyword("catch")?this.parseCatchClause():null,r=this.matchKeyword("finally")?this.parseFinallyClause():null;return i||r||this.throwError(o.Messages.NoCatchOrFinally),this.finalize(e,new a.TryStatement(t,i,r))},e.prototype.parseDebuggerStatement=function(){var e=this.createNode();return this.expectKeyword("debugger"),this.consumeSemicolon(),this.finalize(e,new a.DebuggerStatement)},e.prototype.parseStatement=function(){var e;switch(this.lookahead.type){case 1:case 5:case 6:case 8:case 10:case 9:e=this.parseExpressionStatement();break;case 7:var t=this.lookahead.value;e="{"===t?this.parseBlock():"("===t?this.parseExpressionStatement():";"===t?this.parseEmptyStatement():this.parseExpressionStatement();break;case 3:e=this.matchAsyncFunction()?this.parseFunctionDeclaration():this.parseLabelledStatement();break;case 4:switch(this.lookahead.value){case"break":e=this.parseBreakStatement();break;case"continue":e=this.parseContinueStatement();break;case"debugger":e=this.parseDebuggerStatement();break;case"do":e=this.parseDoWhileStatement();break;case"for":e=this.parseForStatement();break;case"function":e=this.parseFunctionDeclaration();break;case"if":e=this.parseIfStatement();break;case"return":e=this.parseReturnStatement();break;case"switch":e=this.parseSwitchStatement();break;case"throw":e=this.parseThrowStatement();break;case"try":e=this.parseTryStatement();break;case"var":e=this.parseVariableStatement();break;case"while":e=this.parseWhileStatement();break;case"with":e=this.parseWithStatement();break;default:e=this.parseExpressionStatement()}break;default:e=this.throwUnexpectedToken(this.lookahead)}return e},e.prototype.parseFunctionSourceElements=function(){var e=this.createNode();this.expect("{");var t=this.parseDirectivePrologues(),i=this.context.labelSet,r=this.context.inIteration,n=this.context.inSwitch,o=this.context.inFunctionBody;for(this.context.labelSet={},this.context.inIteration=!1,this.context.inSwitch=!1,this.context.inFunctionBody=!0;2!==this.lookahead.type&&!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.context.labelSet=i,this.context.inIteration=r,this.context.inSwitch=n,this.context.inFunctionBody=o,this.finalize(e,new a.BlockStatement(t))},e.prototype.validateParam=function(e,t,i){var r="$"+i;this.context.strict?(this.scanner.isRestrictedWord(i)&&(e.stricted=t,e.message=o.Messages.StrictParamName),Object.prototype.hasOwnProperty.call(e.paramSet,r)&&(e.stricted=t,e.message=o.Messages.StrictParamDupe)):e.firstRestricted||(this.scanner.isRestrictedWord(i)?(e.firstRestricted=t,e.message=o.Messages.StrictParamName):this.scanner.isStrictModeReservedWord(i)?(e.firstRestricted=t,e.message=o.Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(e.paramSet,r)&&(e.stricted=t,e.message=o.Messages.StrictParamDupe)),"function"==typeof Object.defineProperty?Object.defineProperty(e.paramSet,r,{value:!0,enumerable:!0,writable:!0,configurable:!0}):e.paramSet[r]=!0},e.prototype.parseRestElement=function(e){var t=this.createNode();this.expect("...");var i=this.parsePattern(e);return this.match("=")&&this.throwError(o.Messages.DefaultRestParameter),this.match(")")||this.throwError(o.Messages.ParameterAfterRestParameter),this.finalize(t,new a.RestElement(i))},e.prototype.parseFormalParameter=function(e){for(var t=[],i=this.match("...")?this.parseRestElement(t):this.parsePatternWithDefault(t),r=0;r<t.length;r++)this.validateParam(e,t[r],t[r].value);e.simple=e.simple&&i instanceof a.Identifier,e.params.push(i)},e.prototype.parseFormalParameters=function(e){var t;if(t={simple:!0,params:[],firstRestricted:e},this.expect("("),!this.match(")"))for(t.paramSet={};2!==this.lookahead.type&&(this.parseFormalParameter(t),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),{simple:t.simple,params:t.params,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.matchAsyncFunction=function(){var e=this.matchContextualKeyword("async");if(e){var t=this.scanner.saveState();this.scanner.scanComments();var i=this.scanner.lex();this.scanner.restoreState(t),e=t.lineNumber===i.lineNumber&&4===i.type&&"function"===i.value}return e},e.prototype.parseFunctionDeclaration=function(e){var t=this.createNode(),i=this.matchContextualKeyword("async");i&&this.nextToken(),this.expectKeyword("function");var r,n=!i&&this.match("*");n&&this.nextToken();var s=null,l=null;if(!e||!this.match("(")){var u=this.lookahead;s=this.parseVariableIdentifier(),this.context.strict?this.scanner.isRestrictedWord(u.value)&&this.tolerateUnexpectedToken(u,o.Messages.StrictFunctionName):this.scanner.isRestrictedWord(u.value)?(l=u,r=o.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(u.value)&&(l=u,r=o.Messages.StrictReservedWord)}var c=this.context.await,h=this.context.allowYield;this.context.await=i,this.context.allowYield=!n;var p=this.parseFormalParameters(l),d=p.params,f=p.stricted;l=p.firstRestricted,p.message&&(r=p.message);var m=this.context.strict,g=this.context.allowStrictDirective;this.context.allowStrictDirective=p.simple;var v=this.parseFunctionSourceElements();return this.context.strict&&l&&this.throwUnexpectedToken(l,r),this.context.strict&&f&&this.tolerateUnexpectedToken(f,r),this.context.strict=m,this.context.allowStrictDirective=g,this.context.await=c,this.context.allowYield=h,i?this.finalize(t,new a.AsyncFunctionDeclaration(s,d,v)):this.finalize(t,new a.FunctionDeclaration(s,d,v,n))},e.prototype.parseFunctionExpression=function(){var e=this.createNode(),t=this.matchContextualKeyword("async");t&&this.nextToken(),this.expectKeyword("function");var i,r=!t&&this.match("*");r&&this.nextToken();var n,s=null,l=this.context.await,u=this.context.allowYield;if(this.context.await=t,this.context.allowYield=!r,!this.match("(")){var c=this.lookahead;s=this.context.strict||r||!this.matchKeyword("yield")?this.parseVariableIdentifier():this.parseIdentifierName(),this.context.strict?this.scanner.isRestrictedWord(c.value)&&this.tolerateUnexpectedToken(c,o.Messages.StrictFunctionName):this.scanner.isRestrictedWord(c.value)?(n=c,i=o.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(c.value)&&(n=c,i=o.Messages.StrictReservedWord)}var h=this.parseFormalParameters(n),p=h.params,d=h.stricted;n=h.firstRestricted,h.message&&(i=h.message);var f=this.context.strict,m=this.context.allowStrictDirective;this.context.allowStrictDirective=h.simple;var g=this.parseFunctionSourceElements();return this.context.strict&&n&&this.throwUnexpectedToken(n,i),this.context.strict&&d&&this.tolerateUnexpectedToken(d,i),this.context.strict=f,this.context.allowStrictDirective=m,this.context.await=l,this.context.allowYield=u,t?this.finalize(e,new a.AsyncFunctionExpression(s,p,g)):this.finalize(e,new a.FunctionExpression(s,p,g,r))},e.prototype.parseDirective=function(){var e=this.lookahead,t=this.createNode(),i=this.parseExpression(),r=i.type===l.Syntax.Literal?this.getTokenRaw(e).slice(1,-1):null;return this.consumeSemicolon(),this.finalize(t,r?new a.Directive(i,r):new a.ExpressionStatement(i))},e.prototype.parseDirectivePrologues=function(){for(var e=null,t=[];;){var i=this.lookahead;if(8!==i.type)break;var r=this.parseDirective();t.push(r);var n=r.directive;if("string"!=typeof n)break;"use strict"===n?(this.context.strict=!0,e&&this.tolerateUnexpectedToken(e,o.Messages.StrictOctalLiteral),this.context.allowStrictDirective||this.tolerateUnexpectedToken(i,o.Messages.IllegalLanguageModeDirective)):!e&&i.octal&&(e=i)}return t},e.prototype.qualifiedPropertyName=function(e){switch(e.type){case 3:case 8:case 1:case 5:case 6:case 4:return!0;case 7:return"["===e.value}return!1},e.prototype.parseGetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var i=this.parseFormalParameters();i.params.length>0&&this.tolerateError(o.Messages.BadGetterArity);var r=this.parsePropertyMethod(i);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,i.params,r,!1))},e.prototype.parseSetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var i=this.parseFormalParameters();1!==i.params.length?this.tolerateError(o.Messages.BadSetterArity):i.params[0]instanceof a.RestElement&&this.tolerateError(o.Messages.BadSetterRestParameter);var r=this.parsePropertyMethod(i);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,i.params,r,!1))},e.prototype.parseGeneratorMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var i=this.parseFormalParameters();this.context.allowYield=!1;var r=this.parsePropertyMethod(i);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,i.params,r,!0))},e.prototype.isStartOfExpression=function(){var e=!0,t=this.lookahead.value;switch(this.lookahead.type){case 7:e="["===t||"("===t||"{"===t||"+"===t||"-"===t||"!"===t||"~"===t||"++"===t||"--"===t||"/"===t||"/="===t;break;case 4:e="class"===t||"delete"===t||"function"===t||"let"===t||"new"===t||"super"===t||"this"===t||"typeof"===t||"void"===t||"yield"===t}return e},e.prototype.parseYieldExpression=function(){var e=this.createNode();this.expectKeyword("yield");var t=null,i=!1;if(!this.hasLineTerminator){var r=this.context.allowYield;this.context.allowYield=!1,(i=this.match("*"))?(this.nextToken(),t=this.parseAssignmentExpression()):this.isStartOfExpression()&&(t=this.parseAssignmentExpression()),this.context.allowYield=r}return this.finalize(e,new a.YieldExpression(t,i))},e.prototype.parseClassElement=function(e){var t=this.lookahead,i=this.createNode(),r="",n=null,s=null,l=!1,u=!1,c=!1,h=!1;if(this.match("*"))this.nextToken();else if(l=this.match("["),"static"===(n=this.parseObjectPropertyKey()).name&&(this.qualifiedPropertyName(this.lookahead)||this.match("*"))&&(t=this.lookahead,c=!0,l=this.match("["),this.match("*")?this.nextToken():n=this.parseObjectPropertyKey()),3===t.type&&!this.hasLineTerminator&&"async"===t.value){var p=this.lookahead.value;":"!==p&&"("!==p&&"*"!==p&&(h=!0,t=this.lookahead,n=this.parseObjectPropertyKey(),3===t.type&&"constructor"===t.value&&this.tolerateUnexpectedToken(t,o.Messages.ConstructorIsAsync))}var d=this.qualifiedPropertyName(this.lookahead);return 3===t.type?"get"===t.value&&d?(r="get",l=this.match("["),n=this.parseObjectPropertyKey(),this.context.allowYield=!1,s=this.parseGetterMethod()):"set"===t.value&&d&&(r="set",l=this.match("["),n=this.parseObjectPropertyKey(),s=this.parseSetterMethod()):7===t.type&&"*"===t.value&&d&&(r="init",l=this.match("["),n=this.parseObjectPropertyKey(),s=this.parseGeneratorMethod(),u=!0),!r&&n&&this.match("(")&&(r="init",s=h?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),u=!0),r||this.throwUnexpectedToken(this.lookahead),"init"===r&&(r="method"),l||(c&&this.isPropertyKey(n,"prototype")&&this.throwUnexpectedToken(t,o.Messages.StaticPrototype),!c&&this.isPropertyKey(n,"constructor")&&(("method"!==r||!u||s&&s.generator)&&this.throwUnexpectedToken(t,o.Messages.ConstructorSpecialMethod),e.value?this.throwUnexpectedToken(t,o.Messages.DuplicateConstructor):e.value=!0,r="constructor")),this.finalize(i,new a.MethodDefinition(n,l,s,r,c))},e.prototype.parseClassElementList=function(){var e=[],t={value:!1};for(this.expect("{");!this.match("}");)this.match(";")?this.nextToken():e.push(this.parseClassElement(t));return this.expect("}"),e},e.prototype.parseClassBody=function(){var e=this.createNode(),t=this.parseClassElementList();return this.finalize(e,new a.ClassBody(t))},e.prototype.parseClassDeclaration=function(e){var t=this.createNode(),i=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var r=e&&3!==this.lookahead.type?null:this.parseVariableIdentifier(),n=null;this.matchKeyword("extends")&&(this.nextToken(),n=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var o=this.parseClassBody();return this.context.strict=i,this.finalize(t,new a.ClassDeclaration(r,n,o))},e.prototype.parseClassExpression=function(){var e=this.createNode(),t=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var i=3===this.lookahead.type?this.parseVariableIdentifier():null,r=null;this.matchKeyword("extends")&&(this.nextToken(),r=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var n=this.parseClassBody();return this.context.strict=t,this.finalize(e,new a.ClassExpression(i,r,n))},e.prototype.parseModule=function(){this.context.strict=!0,this.context.isModule=!0,this.scanner.isModule=!0;for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new a.Module(t))},e.prototype.parseScript=function(){for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new a.Script(t))},e.prototype.parseModuleSpecifier=function(){var e=this.createNode();8!==this.lookahead.type&&this.throwError(o.Messages.InvalidModuleSpecifier);var t=this.nextToken(),i=this.getTokenRaw(t);return this.finalize(e,new a.Literal(t.value,i))},e.prototype.parseImportSpecifier=function(){var e,t,i=this.createNode();return 3===this.lookahead.type?(t=e=this.parseVariableIdentifier(),this.matchContextualKeyword("as")&&(this.nextToken(),t=this.parseVariableIdentifier())):(t=e=this.parseIdentifierName(),this.matchContextualKeyword("as")?(this.nextToken(),t=this.parseVariableIdentifier()):this.throwUnexpectedToken(this.nextToken())),this.finalize(i,new a.ImportSpecifier(t,e))},e.prototype.parseNamedImports=function(){this.expect("{");for(var e=[];!this.match("}");)e.push(this.parseImportSpecifier()),this.match("}")||this.expect(",");return this.expect("}"),e},e.prototype.parseImportDefaultSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName();return this.finalize(e,new a.ImportDefaultSpecifier(t))},e.prototype.parseImportNamespaceSpecifier=function(){var e=this.createNode();this.expect("*"),this.matchContextualKeyword("as")||this.throwError(o.Messages.NoAsAfterImportNamespace),this.nextToken();var t=this.parseIdentifierName();return this.finalize(e,new a.ImportNamespaceSpecifier(t))},e.prototype.parseImportDeclaration=function(){this.context.inFunctionBody&&this.throwError(o.Messages.IllegalImportDeclaration);var e,t=this.createNode();this.expectKeyword("import");var i=[];if(8===this.lookahead.type)e=this.parseModuleSpecifier();else{if(this.match("{")?i=i.concat(this.parseNamedImports()):this.match("*")?i.push(this.parseImportNamespaceSpecifier()):this.isIdentifierName(this.lookahead)&&!this.matchKeyword("default")?(i.push(this.parseImportDefaultSpecifier()),this.match(",")&&(this.nextToken(),this.match("*")?i.push(this.parseImportNamespaceSpecifier()):this.match("{")?i=i.concat(this.parseNamedImports()):this.throwUnexpectedToken(this.lookahead))):this.throwUnexpectedToken(this.nextToken()),!this.matchContextualKeyword("from")){var r=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause;this.throwError(r,this.lookahead.value)}this.nextToken(),e=this.parseModuleSpecifier()}return this.consumeSemicolon(),this.finalize(t,new a.ImportDeclaration(i,e))},e.prototype.parseExportSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName(),i=t;return this.matchContextualKeyword("as")&&(this.nextToken(),i=this.parseIdentifierName()),this.finalize(e,new a.ExportSpecifier(t,i))},e.prototype.parseExportDeclaration=function(){this.context.inFunctionBody&&this.throwError(o.Messages.IllegalExportDeclaration);var e,t=this.createNode();if(this.expectKeyword("export"),this.matchKeyword("default"))if(this.nextToken(),this.matchKeyword("function")){var i=this.parseFunctionDeclaration(!0);e=this.finalize(t,new a.ExportDefaultDeclaration(i))}else this.matchKeyword("class")?(i=this.parseClassDeclaration(!0),e=this.finalize(t,new a.ExportDefaultDeclaration(i))):this.matchContextualKeyword("async")?(i=this.matchAsyncFunction()?this.parseFunctionDeclaration(!0):this.parseAssignmentExpression(),e=this.finalize(t,new a.ExportDefaultDeclaration(i))):(this.matchContextualKeyword("from")&&this.throwError(o.Messages.UnexpectedToken,this.lookahead.value),i=this.match("{")?this.parseObjectInitializer():this.match("[")?this.parseArrayInitializer():this.parseAssignmentExpression(),this.consumeSemicolon(),e=this.finalize(t,new a.ExportDefaultDeclaration(i)));else if(this.match("*")){if(this.nextToken(),!this.matchContextualKeyword("from")){var r=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause;this.throwError(r,this.lookahead.value)}this.nextToken();var n=this.parseModuleSpecifier();this.consumeSemicolon(),e=this.finalize(t,new a.ExportAllDeclaration(n))}else if(4===this.lookahead.type){switch(i=void 0,this.lookahead.value){case"let":case"const":i=this.parseLexicalDeclaration({inFor:!1});break;case"var":case"class":case"function":i=this.parseStatementListItem();break;default:this.throwUnexpectedToken(this.lookahead)}e=this.finalize(t,new a.ExportNamedDeclaration(i,[],null))}else if(this.matchAsyncFunction())i=this.parseFunctionDeclaration(),e=this.finalize(t,new a.ExportNamedDeclaration(i,[],null));else{var s=[],l=null,u=!1;for(this.expect("{");!this.match("}");)u=u||this.matchKeyword("default"),s.push(this.parseExportSpecifier()),this.match("}")||this.expect(",");this.expect("}"),this.matchContextualKeyword("from")?(this.nextToken(),l=this.parseModuleSpecifier(),this.consumeSemicolon()):u?(r=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause,this.throwError(r,this.lookahead.value)):this.consumeSemicolon(),e=this.finalize(t,new a.ExportNamedDeclaration(null,s,l))}return e},e}();t.Parser=c},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assert=function(e,t){if(!e)throw new Error("ASSERT: "+t)}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.errors=[],this.tolerant=!1}return e.prototype.recordError=function(e){this.errors.push(e)},e.prototype.tolerate=function(e){if(!this.tolerant)throw e;this.recordError(e)},e.prototype.constructError=function(e,t){var i=new Error(e);try{throw i}catch(e){Object.create&&Object.defineProperty&&(i=Object.create(e),Object.defineProperty(i,"column",{value:t}))}return i},e.prototype.createError=function(e,t,i,r){var n="Line "+t+": "+r,o=this.constructError(n,i);return o.index=e,o.lineNumber=t,o.description=r,o},e.prototype.throwError=function(e,t,i,r){throw this.createError(e,t,i,r)},e.prototype.tolerateError=function(e,t,i,r){var n=this.createError(e,t,i,r);if(!this.tolerant)throw n;this.recordError(n)},e}();t.ErrorHandler=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Messages={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(9),n=i(4),o=i(11);function a(e){return"0123456789abcdef".indexOf(e.toLowerCase())}function s(e){return"01234567".indexOf(e)}var l=function(){function e(e,t){this.source=e,this.errorHandler=t,this.trackComment=!1,this.isModule=!1,this.length=e.length,this.index=0,this.lineNumber=e.length>0?1:0,this.lineStart=0,this.curlyStack=[]}return e.prototype.saveState=function(){return{index:this.index,lineNumber:this.lineNumber,lineStart:this.lineStart}},e.prototype.restoreState=function(e){this.index=e.index,this.lineNumber=e.lineNumber,this.lineStart=e.lineStart},e.prototype.eof=function(){return this.index>=this.length},e.prototype.throwUnexpectedToken=function(e){return void 0===e&&(e=o.Messages.UnexpectedTokenIllegal),this.errorHandler.throwError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.tolerateUnexpectedToken=function(e){void 0===e&&(e=o.Messages.UnexpectedTokenIllegal),this.errorHandler.tolerateError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.skipSingleLineComment=function(e){var t,i,r=[];for(this.trackComment&&(r=[],t=this.index-e,i={start:{line:this.lineNumber,column:this.index-this.lineStart-e},end:{}});!this.eof();){var o=this.source.charCodeAt(this.index);if(++this.index,n.Character.isLineTerminator(o)){if(this.trackComment){i.end={line:this.lineNumber,column:this.index-this.lineStart-1};var a={multiLine:!1,slice:[t+e,this.index-1],range:[t,this.index-1],loc:i};r.push(a)}return 13===o&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,r}}return this.trackComment&&(i.end={line:this.lineNumber,column:this.index-this.lineStart},a={multiLine:!1,slice:[t+e,this.index],range:[t,this.index],loc:i},r.push(a)),r},e.prototype.skipMultiLineComment=function(){var e,t,i=[];for(this.trackComment&&(i=[],e=this.index-2,t={start:{line:this.lineNumber,column:this.index-this.lineStart-2},end:{}});!this.eof();){var r=this.source.charCodeAt(this.index);if(n.Character.isLineTerminator(r))13===r&&10===this.source.charCodeAt(this.index+1)&&++this.index,++this.lineNumber,++this.index,this.lineStart=this.index;else if(42===r){if(47===this.source.charCodeAt(this.index+1)){if(this.index+=2,this.trackComment){t.end={line:this.lineNumber,column:this.index-this.lineStart};var o={multiLine:!0,slice:[e+2,this.index-2],range:[e,this.index],loc:t};i.push(o)}return i}++this.index}else++this.index}return this.trackComment&&(t.end={line:this.lineNumber,column:this.index-this.lineStart},o={multiLine:!0,slice:[e+2,this.index],range:[e,this.index],loc:t},i.push(o)),this.tolerateUnexpectedToken(),i},e.prototype.scanComments=function(){var e;this.trackComment&&(e=[]);for(var t=0===this.index;!this.eof();){var i=this.source.charCodeAt(this.index);if(n.Character.isWhiteSpace(i))++this.index;else if(n.Character.isLineTerminator(i))++this.index,13===i&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,t=!0;else if(47===i)if(47===(i=this.source.charCodeAt(this.index+1))){this.index+=2;var r=this.skipSingleLineComment(2);this.trackComment&&(e=e.concat(r)),t=!0}else{if(42!==i)break;this.index+=2,r=this.skipMultiLineComment(),this.trackComment&&(e=e.concat(r))}else if(t&&45===i){if(45!==this.source.charCodeAt(this.index+1)||62!==this.source.charCodeAt(this.index+2))break;this.index+=3,r=this.skipSingleLineComment(3),this.trackComment&&(e=e.concat(r))}else{if(60!==i||this.isModule)break;if("!--"!==this.source.slice(this.index+1,this.index+4))break;this.index+=4,r=this.skipSingleLineComment(4),this.trackComment&&(e=e.concat(r))}}return e},e.prototype.isFutureReservedWord=function(e){switch(e){case"enum":case"export":case"import":case"super":return!0;default:return!1}},e.prototype.isStrictModeReservedWord=function(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}},e.prototype.isRestrictedWord=function(e){return"eval"===e||"arguments"===e},e.prototype.isKeyword=function(e){switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}},e.prototype.codePointAt=function(e){var t=this.source.charCodeAt(e);if(t>=55296&&t<=56319){var i=this.source.charCodeAt(e+1);i>=56320&&i<=57343&&(t=1024*(t-55296)+i-56320+65536)}return t},e.prototype.scanHexEscape=function(e){for(var t="u"===e?4:2,i=0,r=0;r<t;++r){if(this.eof()||!n.Character.isHexDigit(this.source.charCodeAt(this.index)))return null;i=16*i+a(this.source[this.index++])}return String.fromCharCode(i)},e.prototype.scanUnicodeCodePointEscape=function(){var e=this.source[this.index],t=0;for("}"===e&&this.throwUnexpectedToken();!this.eof()&&(e=this.source[this.index++],n.Character.isHexDigit(e.charCodeAt(0)));)t=16*t+a(e);return(t>1114111||"}"!==e)&&this.throwUnexpectedToken(),n.Character.fromCodePoint(t)},e.prototype.getIdentifier=function(){for(var e=this.index++;!this.eof();){var t=this.source.charCodeAt(this.index);if(92===t)return this.index=e,this.getComplexIdentifier();if(t>=55296&&t<57343)return this.index=e,this.getComplexIdentifier();if(!n.Character.isIdentifierPart(t))break;++this.index}return this.source.slice(e,this.index)},e.prototype.getComplexIdentifier=function(){var e,t=this.codePointAt(this.index),i=n.Character.fromCodePoint(t);for(this.index+=i.length,92===t&&(117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this.scanUnicodeCodePointEscape()):null!==(e=this.scanHexEscape("u"))&&"\\"!==e&&n.Character.isIdentifierStart(e.charCodeAt(0))||this.throwUnexpectedToken(),i=e);!this.eof()&&(t=this.codePointAt(this.index),n.Character.isIdentifierPart(t));)i+=e=n.Character.fromCodePoint(t),this.index+=e.length,92===t&&(i=i.substr(0,i.length-1),117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this.scanUnicodeCodePointEscape()):null!==(e=this.scanHexEscape("u"))&&"\\"!==e&&n.Character.isIdentifierPart(e.charCodeAt(0))||this.throwUnexpectedToken(),i+=e);return i},e.prototype.octalToDecimal=function(e){var t="0"!==e,i=s(e);return!this.eof()&&n.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(t=!0,i=8*i+s(this.source[this.index++]),"0123".indexOf(e)>=0&&!this.eof()&&n.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(i=8*i+s(this.source[this.index++]))),{code:i,octal:t}},e.prototype.scanIdentifier=function(){var e,t=this.index,i=92===this.source.charCodeAt(t)?this.getComplexIdentifier():this.getIdentifier();if(3!=(e=1===i.length?3:this.isKeyword(i)?4:"null"===i?5:"true"===i||"false"===i?1:3)&&t+i.length!==this.index){var r=this.index;this.index=t,this.tolerateUnexpectedToken(o.Messages.InvalidEscapedReservedWord),this.index=r}return{type:e,value:i,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.scanPunctuator=function(){var e=this.index,t=this.source[this.index];switch(t){case"(":case"{":"{"===t&&this.curlyStack.push("{"),++this.index;break;case".":++this.index,"."===this.source[this.index]&&"."===this.source[this.index+1]&&(this.index+=2,t="...");break;case"}":++this.index,this.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;default:">>>="===(t=this.source.substr(this.index,4))?this.index+=4:"==="===(t=t.substr(0,3))||"!=="===t||">>>"===t||"<<="===t||">>="===t||"**="===t?this.index+=3:"&&"===(t=t.substr(0,2))||"||"===t||"=="===t||"!="===t||"+="===t||"-="===t||"*="===t||"/="===t||"++"===t||"--"===t||"<<"===t||">>"===t||"&="===t||"|="===t||"^="===t||"%="===t||"<="===t||">="===t||"=>"===t||"**"===t?this.index+=2:(t=this.source[this.index],"<>=!+-*%&|^/".indexOf(t)>=0&&++this.index)}return this.index===e&&this.throwUnexpectedToken(),{type:7,value:t,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanHexLiteral=function(e){for(var t="";!this.eof()&&n.Character.isHexDigit(this.source.charCodeAt(this.index));)t+=this.source[this.index++];return 0===t.length&&this.throwUnexpectedToken(),n.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseInt("0x"+t,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanBinaryLiteral=function(e){for(var t,i="";!this.eof()&&("0"===(t=this.source[this.index])||"1"===t);)i+=this.source[this.index++];return 0===i.length&&this.throwUnexpectedToken(),this.eof()||(t=this.source.charCodeAt(this.index),(n.Character.isIdentifierStart(t)||n.Character.isDecimalDigit(t))&&this.throwUnexpectedToken()),{type:6,value:parseInt(i,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanOctalLiteral=function(e,t){var i="",r=!1;for(n.Character.isOctalDigit(e.charCodeAt(0))?(r=!0,i="0"+this.source[this.index++]):++this.index;!this.eof()&&n.Character.isOctalDigit(this.source.charCodeAt(this.index));)i+=this.source[this.index++];return r||0!==i.length||this.throwUnexpectedToken(),(n.Character.isIdentifierStart(this.source.charCodeAt(this.index))||n.Character.isDecimalDigit(this.source.charCodeAt(this.index)))&&this.throwUnexpectedToken(),{type:6,value:parseInt(i,8),octal:r,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.isImplicitOctalLiteral=function(){for(var e=this.index+1;e<this.length;++e){var t=this.source[e];if("8"===t||"9"===t)return!1;if(!n.Character.isOctalDigit(t.charCodeAt(0)))return!0}return!0},e.prototype.scanNumericLiteral=function(){var e=this.index,t=this.source[e];r.assert(n.Character.isDecimalDigit(t.charCodeAt(0))||"."===t,"Numeric literal must start with a decimal digit or a decimal point");var i="";if("."!==t){if(i=this.source[this.index++],t=this.source[this.index],"0"===i){if("x"===t||"X"===t)return++this.index,this.scanHexLiteral(e);if("b"===t||"B"===t)return++this.index,this.scanBinaryLiteral(e);if("o"===t||"O"===t)return this.scanOctalLiteral(t,e);if(t&&n.Character.isOctalDigit(t.charCodeAt(0))&&this.isImplicitOctalLiteral())return this.scanOctalLiteral(t,e)}for(;n.Character.isDecimalDigit(this.source.charCodeAt(this.index));)i+=this.source[this.index++];t=this.source[this.index]}if("."===t){for(i+=this.source[this.index++];n.Character.isDecimalDigit(this.source.charCodeAt(this.index));)i+=this.source[this.index++];t=this.source[this.index]}if("e"===t||"E"===t)if(i+=this.source[this.index++],"+"!==(t=this.source[this.index])&&"-"!==t||(i+=this.source[this.index++]),n.Character.isDecimalDigit(this.source.charCodeAt(this.index)))for(;n.Character.isDecimalDigit(this.source.charCodeAt(this.index));)i+=this.source[this.index++];else this.throwUnexpectedToken();return n.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseFloat(i),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanStringLiteral=function(){var e=this.index,t=this.source[e];r.assert("'"===t||'"'===t,"String literal must starts with a quote"),++this.index;for(var i=!1,a="";!this.eof();){var s=this.source[this.index++];if(s===t){t="";break}if("\\"===s)if((s=this.source[this.index++])&&n.Character.isLineTerminator(s.charCodeAt(0)))++this.lineNumber,"\r"===s&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(s){case"u":if("{"===this.source[this.index])++this.index,a+=this.scanUnicodeCodePointEscape();else{var l=this.scanHexEscape(s);null===l&&this.throwUnexpectedToken(),a+=l}break;case"x":var u=this.scanHexEscape(s);null===u&&this.throwUnexpectedToken(o.Messages.InvalidHexEscapeSequence),a+=u;break;case"n":a+="\n";break;case"r":a+="\r";break;case"t":a+="\t";break;case"b":a+="\b";break;case"f":a+="\f";break;case"v":a+="\v";break;case"8":case"9":a+=s,this.tolerateUnexpectedToken();break;default:if(s&&n.Character.isOctalDigit(s.charCodeAt(0))){var c=this.octalToDecimal(s);i=c.octal||i,a+=String.fromCharCode(c.code)}else a+=s}else{if(n.Character.isLineTerminator(s.charCodeAt(0)))break;a+=s}}return""!==t&&(this.index=e,this.throwUnexpectedToken()),{type:8,value:a,octal:i,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanTemplate=function(){var e="",t=!1,i=this.index,r="`"===this.source[i],a=!1,s=2;for(++this.index;!this.eof();){var l=this.source[this.index++];if("`"===l){s=1,a=!0,t=!0;break}if("$"===l){if("{"===this.source[this.index]){this.curlyStack.push("${"),++this.index,t=!0;break}e+=l}else if("\\"===l)if(l=this.source[this.index++],n.Character.isLineTerminator(l.charCodeAt(0)))++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(l){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"u":if("{"===this.source[this.index])++this.index,e+=this.scanUnicodeCodePointEscape();else{var u=this.index,c=this.scanHexEscape(l);null!==c?e+=c:(this.index=u,e+=l)}break;case"x":var h=this.scanHexEscape(l);null===h&&this.throwUnexpectedToken(o.Messages.InvalidHexEscapeSequence),e+=h;break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:"0"===l?(n.Character.isDecimalDigit(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(o.Messages.TemplateOctalLiteral),e+="\0"):n.Character.isOctalDigit(l.charCodeAt(0))?this.throwUnexpectedToken(o.Messages.TemplateOctalLiteral):e+=l}else n.Character.isLineTerminator(l.charCodeAt(0))?(++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index,e+="\n"):e+=l}return t||this.throwUnexpectedToken(),r||this.curlyStack.pop(),{type:10,value:this.source.slice(i+1,this.index-s),cooked:e,head:r,tail:a,lineNumber:this.lineNumber,lineStart:this.lineStart,start:i,end:this.index}},e.prototype.testRegExp=function(e,t){var i=e,r=this;t.indexOf("u")>=0&&(i=i.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,(function(e,t,i){var n=parseInt(t||i,16);return n>1114111&&r.throwUnexpectedToken(o.Messages.InvalidRegExp),n<=65535?String.fromCharCode(n):"￿"})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"￿"));try{RegExp(i)}catch(e){this.throwUnexpectedToken(o.Messages.InvalidRegExp)}try{return new RegExp(e,t)}catch(e){return null}},e.prototype.scanRegExpBody=function(){var e=this.source[this.index];r.assert("/"===e,"Regular expression literal must start with a slash");for(var t=this.source[this.index++],i=!1,a=!1;!this.eof();)if(t+=e=this.source[this.index++],"\\"===e)e=this.source[this.index++],n.Character.isLineTerminator(e.charCodeAt(0))&&this.throwUnexpectedToken(o.Messages.UnterminatedRegExp),t+=e;else if(n.Character.isLineTerminator(e.charCodeAt(0)))this.throwUnexpectedToken(o.Messages.UnterminatedRegExp);else if(i)"]"===e&&(i=!1);else{if("/"===e){a=!0;break}"["===e&&(i=!0)}return a||this.throwUnexpectedToken(o.Messages.UnterminatedRegExp),t.substr(1,t.length-2)},e.prototype.scanRegExpFlags=function(){for(var e="";!this.eof();){var t=this.source[this.index];if(!n.Character.isIdentifierPart(t.charCodeAt(0)))break;if(++this.index,"\\"!==t||this.eof())e+=t;else if("u"===(t=this.source[this.index])){++this.index;var i=this.index,r=this.scanHexEscape("u");if(null!==r)for(e+=r;i<this.index;++i)this.source[i];else this.index=i,e+="u";this.tolerateUnexpectedToken()}else this.tolerateUnexpectedToken()}return e},e.prototype.scanRegExp=function(){var e=this.index,t=this.scanRegExpBody(),i=this.scanRegExpFlags();return{type:9,value:"",pattern:t,flags:i,regex:this.testRegExp(t,i),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.lex=function(){if(this.eof())return{type:2,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};var e=this.source.charCodeAt(this.index);return n.Character.isIdentifierStart(e)?this.scanIdentifier():40===e||41===e||59===e?this.scanPunctuator():39===e||34===e?this.scanStringLiteral():46===e?n.Character.isDecimalDigit(this.source.charCodeAt(this.index+1))?this.scanNumericLiteral():this.scanPunctuator():n.Character.isDecimalDigit(e)?this.scanNumericLiteral():96===e||125===e&&"${"===this.curlyStack[this.curlyStack.length-1]?this.scanTemplate():e>=55296&&e<57343&&n.Character.isIdentifierStart(this.codePointAt(this.index))?this.scanIdentifier():this.scanPunctuator()},e}();t.Scanner=l},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenName={},t.TokenName[1]="Boolean",t.TokenName[2]="<end>",t.TokenName[3]="Identifier",t.TokenName[4]="Keyword",t.TokenName[5]="Null",t.TokenName[6]="Numeric",t.TokenName[7]="Punctuator",t.TokenName[8]="String",t.TokenName[9]="RegularExpression",t.TokenName[10]="Template"},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XHTMLEntities={quot:'"',amp:"&",apos:"'",gt:">",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",times:"×",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",divide:"÷",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",frasl:"⁄",euro:"€",image:"ℑ",weierp:"℘",real:"ℜ",trade:"™",alefsym:"ℵ",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lArr:"⇐",uArr:"⇑",rArr:"⇒",dArr:"⇓",hArr:"⇔",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦",lang:"⟨",rang:"⟩"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(10),n=i(12),o=i(13),a=function(){function e(){this.values=[],this.curly=this.paren=-1}return e.prototype.beforeFunctionExpression=function(e){return["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","**","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="].indexOf(e)>=0},e.prototype.isRegexStart=function(){var e=this.values[this.values.length-1],t=null!==e;switch(e){case"this":case"]":t=!1;break;case")":var i=this.values[this.paren-1];t="if"===i||"while"===i||"for"===i||"with"===i;break;case"}":if(t=!1,"function"===this.values[this.curly-3])t=!!(r=this.values[this.curly-4])&&!this.beforeFunctionExpression(r);else if("function"===this.values[this.curly-4]){var r;t=!(r=this.values[this.curly-5])||!this.beforeFunctionExpression(r)}}return t},e.prototype.push=function(e){7===e.type||4===e.type?("{"===e.value?this.curly=this.values.length:"("===e.value&&(this.paren=this.values.length),this.values.push(e.value)):this.values.push(null)},e}(),s=function(){function e(e,t){this.errorHandler=new r.ErrorHandler,this.errorHandler.tolerant=!!t&&"boolean"==typeof t.tolerant&&t.tolerant,this.scanner=new n.Scanner(e,this.errorHandler),this.scanner.trackComment=!!t&&"boolean"==typeof t.comment&&t.comment,this.trackRange=!!t&&"boolean"==typeof t.range&&t.range,this.trackLoc=!!t&&"boolean"==typeof t.loc&&t.loc,this.buffer=[],this.reader=new a}return e.prototype.errors=function(){return this.errorHandler.errors},e.prototype.getNextToken=function(){if(0===this.buffer.length){var e=this.scanner.scanComments();if(this.scanner.trackComment)for(var t=0;t<e.length;++t){var i=e[t],r=this.scanner.source.slice(i.slice[0],i.slice[1]),n={type:i.multiLine?"BlockComment":"LineComment",value:r};this.trackRange&&(n.range=i.range),this.trackLoc&&(n.loc=i.loc),this.buffer.push(n)}if(!this.scanner.eof()){var a=void 0;this.trackLoc&&(a={start:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},end:{}});var s="/"===this.scanner.source[this.scanner.index]&&this.reader.isRegexStart()?this.scanner.scanRegExp():this.scanner.lex();this.reader.push(s);var l={type:o.TokenName[s.type],value:this.scanner.source.slice(s.start,s.end)};if(this.trackRange&&(l.range=[s.start,s.end]),this.trackLoc&&(a.end={line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},l.loc=a),9===s.type){var u=s.pattern,c=s.flags;l.regex={pattern:u,flags:c}}this.buffer.push(l)}}return this.buffer.shift()},e}();t.Tokenizer=s}])},e.exports=r()},"./node_modules/estraverse/estraverse.js":
/*!***********************************************!*\
  !*** ./node_modules/estraverse/estraverse.js ***!
  \***********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){!function e(t){"use strict";var r,n,o,a,s,l;function u(e){var t,i,r={};for(t in e)e.hasOwnProperty(t)&&(i=e[t],r[t]="object"==typeof i&&null!==i?u(i):i);return r}function c(e,t){this.parent=e,this.key=t}function h(e,t,i,r){this.node=e,this.path=t,this.wrap=i,this.ref=r}function p(){}function d(e){return null!=e&&"object"==typeof e&&"string"==typeof e.type}function f(e,t){return(e===r.ObjectExpression||e===r.ObjectPattern)&&"properties"===t}function m(e,t){return(new p).traverse(e,t)}function g(e,t){var i;return i=function(e,t){var i,r,n,o;for(r=e.length,n=0;r;)t(e[o=n+(i=r>>>1)])?r=i:(n=o+1,r-=i+1);return n}(t,(function(t){return t.range[0]>e.range[0]})),e.extendedRange=[e.range[0],e.range[1]],i!==t.length&&(e.extendedRange[1]=t[i].range[0]),(i-=1)>=0&&(e.extendedRange[0]=t[i].range[1]),e}return r={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportExpression:"ImportExpression",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"},o={AssignmentExpression:["left","right"],AssignmentPattern:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","superClass","body"],ClassExpression:["id","superClass","body"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportAllDeclaration:["source"],ExportDefaultDeclaration:["declaration"],ExportNamedDeclaration:["declaration","specifiers","source"],ExportSpecifier:["exported","local"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","body"],FunctionExpression:["id","params","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportExpression:["source"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["local"],ImportNamespaceSpecifier:["local"],ImportSpecifier:["imported","local"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MetaProperty:["meta","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],RestElement:["argument"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],Super:[],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handler","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]},n={Break:a={},Skip:s={},Remove:l={}},c.prototype.replace=function(e){this.parent[this.key]=e},c.prototype.remove=function(){return Array.isArray(this.parent)?(this.parent.splice(this.key,1),!0):(this.replace(null),!1)},p.prototype.path=function(){var e,t,i,r,n;function o(e,t){if(Array.isArray(t))for(i=0,r=t.length;i<r;++i)e.push(t[i]);else e.push(t)}if(!this.__current.path)return null;for(n=[],e=2,t=this.__leavelist.length;e<t;++e)o(n,this.__leavelist[e].path);return o(n,this.__current.path),n},p.prototype.type=function(){return this.current().type||this.__current.wrap},p.prototype.parents=function(){var e,t,i;for(i=[],e=1,t=this.__leavelist.length;e<t;++e)i.push(this.__leavelist[e].node);return i},p.prototype.current=function(){return this.__current.node},p.prototype.__execute=function(e,t){var i,r;return r=void 0,i=this.__current,this.__current=t,this.__state=null,e&&(r=e.call(this,t.node,this.__leavelist[this.__leavelist.length-1].node)),this.__current=i,r},p.prototype.notify=function(e){this.__state=e},p.prototype.skip=function(){this.notify(s)},p.prototype.break=function(){this.notify(a)},p.prototype.remove=function(){this.notify(l)},p.prototype.__initialize=function(e,t){this.visitor=t,this.root=e,this.__worklist=[],this.__leavelist=[],this.__current=null,this.__state=null,this.__fallback=null,"iteration"===t.fallback?this.__fallback=Object.keys:"function"==typeof t.fallback&&(this.__fallback=t.fallback),this.__keys=o,t.keys&&(this.__keys=Object.assign(Object.create(this.__keys),t.keys))},p.prototype.traverse=function(e,t){var i,r,n,o,l,u,c,p,m,g,v,y;for(this.__initialize(e,t),y={},i=this.__worklist,r=this.__leavelist,i.push(new h(e,null,null,null)),r.push(new h(null,null,null,null));i.length;)if((n=i.pop())!==y){if(n.node){if(u=this.__execute(t.enter,n),this.__state===a||u===a)return;if(i.push(y),r.push(n),this.__state===s||u===s)continue;if(l=(o=n.node).type||n.wrap,!(g=this.__keys[l])){if(!this.__fallback)throw new Error("Unknown node type "+l+".");g=this.__fallback(o)}for(p=g.length;(p-=1)>=0;)if(v=o[c=g[p]])if(Array.isArray(v)){for(m=v.length;(m-=1)>=0;)if(v[m]){if(f(l,g[p]))n=new h(v[m],[c,m],"Property",null);else{if(!d(v[m]))continue;n=new h(v[m],[c,m],null,null)}i.push(n)}}else d(v)&&i.push(new h(v,c,null,null))}}else if(n=r.pop(),u=this.__execute(t.leave,n),this.__state===a||u===a)return},p.prototype.replace=function(e,t){var i,r,n,o,u,p,m,g,v,y,b,_,x;function E(e){var t,r,n,o;if(e.ref.remove())for(r=e.ref.key,o=e.ref.parent,t=i.length;t--;)if((n=i[t]).ref&&n.ref.parent===o){if(n.ref.key<r)break;--n.ref.key}}for(this.__initialize(e,t),b={},i=this.__worklist,r=this.__leavelist,p=new h(e,null,null,new c(_={root:e},"root")),i.push(p),r.push(p);i.length;)if((p=i.pop())!==b){if(void 0!==(u=this.__execute(t.enter,p))&&u!==a&&u!==s&&u!==l&&(p.ref.replace(u),p.node=u),this.__state!==l&&u!==l||(E(p),p.node=null),this.__state===a||u===a)return _.root;if((n=p.node)&&(i.push(b),r.push(p),this.__state!==s&&u!==s)){if(o=n.type||p.wrap,!(v=this.__keys[o])){if(!this.__fallback)throw new Error("Unknown node type "+o+".");v=this.__fallback(n)}for(m=v.length;(m-=1)>=0;)if(y=n[x=v[m]])if(Array.isArray(y)){for(g=y.length;(g-=1)>=0;)if(y[g]){if(f(o,v[m]))p=new h(y[g],[x,g],"Property",new c(y,g));else{if(!d(y[g]))continue;p=new h(y[g],[x,g],null,new c(y,g))}i.push(p)}}else d(y)&&i.push(new h(y,x,null,new c(n,x)))}}else if(p=r.pop(),void 0!==(u=this.__execute(t.leave,p))&&u!==a&&u!==s&&u!==l&&p.ref.replace(u),this.__state!==l&&u!==l||E(p),this.__state===a||u===a)return _.root;return _.root},t.version=i(/*! ./package.json */"./node_modules/estraverse/package.json").version,t.Syntax=r,t.traverse=m,t.replace=function(e,t){return(new p).replace(e,t)},t.attachComments=function(e,t,i){var r,o,a,s,l=[];if(!e.range)throw new Error("attachComments needs range information");if(!i.length){if(t.length){for(a=0,o=t.length;a<o;a+=1)(r=u(t[a])).extendedRange=[0,e.range[0]],l.push(r);e.leadingComments=l}return e}for(a=0,o=t.length;a<o;a+=1)l.push(g(u(t[a]),i));return s=0,m(e,{enter:function(e){for(var t;s<l.length&&!((t=l[s]).extendedRange[1]>e.range[0]);)t.extendedRange[1]===e.range[0]?(e.leadingComments||(e.leadingComments=[]),e.leadingComments.push(t),l.splice(s,1)):s+=1;return s===l.length?n.Break:l[s].extendedRange[0]>e.range[1]?n.Skip:void 0}}),s=0,m(e,{leave:function(e){for(var t;s<l.length&&(t=l[s],!(e.range[1]<t.extendedRange[0]));)e.range[1]===t.extendedRange[0]?(e.trailingComments||(e.trailingComments=[]),e.trailingComments.push(t),l.splice(s,1)):s+=1;return s===l.length?n.Break:l[s].extendedRange[0]>e.range[1]?n.Skip:void 0}}),e},t.VisitorKeys=o,t.VisitorOption=n,t.Controller=p,t.cloneEnvironment=function(){return e({})},t}(t)},"./node_modules/estraverse/package.json":
/*!**********************************************!*\
  !*** ./node_modules/estraverse/package.json ***!
  \**********************************************/
/*! exports provided: _from, _id, _inBundle, _integrity, _location, _phantomChildren, _requested, _requiredBy, _resolved, _shasum, _spec, _where, bugs, bundleDependencies, deprecated, description, devDependencies, engines, homepage, license, main, maintainers, name, repository, scripts, version, default */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e){e.exports=JSON.parse('{"_from":"estraverse@^4.1.1","_id":"estraverse@4.3.0","_inBundle":false,"_integrity":"sha512-39nnKffWz8xN1BU/2c79n9nB9HDzo0niYUqx6xyqUnyoAnQyyWpOTdZEeiCch8BBu515t4wp9ZmgVfVhn9EBpw==","_location":"/estraverse","_phantomChildren":{},"_requested":{"type":"range","registry":true,"raw":"estraverse@^4.1.1","name":"estraverse","escapedName":"estraverse","rawSpec":"^4.1.1","saveSpec":null,"fetchSpec":"^4.1.1"},"_requiredBy":["/eslint-scope","/esquery","/esrecurse"],"_resolved":"https://registry.npmjs.org/estraverse/-/estraverse-4.3.0.tgz","_shasum":"398ad3f3c5a24948be7725e83d11a7de28cdbd1d","_spec":"estraverse@^4.1.1","_where":"D:\\\\SourceCodes\\\\THING.EVAL\\\\node_modules\\\\eslint-scope","bugs":{"url":"https://github.com/estools/estraverse/issues"},"bundleDependencies":false,"deprecated":false,"description":"ECMAScript JS AST traversal functions","devDependencies":{"babel-preset-env":"^1.6.1","babel-register":"^6.3.13","chai":"^2.1.1","espree":"^1.11.0","gulp":"^3.8.10","gulp-bump":"^0.2.2","gulp-filter":"^2.0.0","gulp-git":"^1.0.1","gulp-tag-version":"^1.3.0","jshint":"^2.5.6","mocha":"^2.1.0"},"engines":{"node":">=4.0"},"homepage":"https://github.com/estools/estraverse","license":"BSD-2-Clause","main":"estraverse.js","maintainers":[{"name":"Yusuke Suzuki","email":"utatane.tea@gmail.com","url":"http://github.com/Constellation"}],"name":"estraverse","repository":{"type":"git","url":"git+ssh://git@github.com/estools/estraverse.git"},"scripts":{"lint":"jshint estraverse.js","test":"npm run-script lint && npm run-script unit-test","unit-test":"mocha --compilers js:babel-register"},"version":"4.3.0"}')},"./node_modules/esutils/lib/ast.js":
/*!*****************************************!*\
  !*** ./node_modules/esutils/lib/ast.js ***!
  \*****************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){!function(){"use strict";function t(e){if(null==e)return!1;switch(e.type){case"BlockStatement":case"BreakStatement":case"ContinueStatement":case"DebuggerStatement":case"DoWhileStatement":case"EmptyStatement":case"ExpressionStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"ReturnStatement":case"SwitchStatement":case"ThrowStatement":case"TryStatement":case"VariableDeclaration":case"WhileStatement":case"WithStatement":return!0}return!1}function i(e){switch(e.type){case"IfStatement":return null!=e.alternate?e.alternate:e.consequent;case"LabeledStatement":case"ForStatement":case"ForInStatement":case"WhileStatement":case"WithStatement":return e.body}return null}e.exports={isExpression:function(e){if(null==e)return!1;switch(e.type){case"ArrayExpression":case"AssignmentExpression":case"BinaryExpression":case"CallExpression":case"ConditionalExpression":case"FunctionExpression":case"Identifier":case"Literal":case"LogicalExpression":case"MemberExpression":case"NewExpression":case"ObjectExpression":case"SequenceExpression":case"ThisExpression":case"UnaryExpression":case"UpdateExpression":return!0}return!1},isStatement:t,isIterationStatement:function(e){if(null==e)return!1;switch(e.type){case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"WhileStatement":return!0}return!1},isSourceElement:function(e){return t(e)||null!=e&&"FunctionDeclaration"===e.type},isProblematicIfStatement:function(e){var t;if("IfStatement"!==e.type)return!1;if(null==e.alternate)return!1;t=e.consequent;do{if("IfStatement"===t.type&&null==t.alternate)return!0;t=i(t)}while(t);return!1},trailingStatement:i}}()},"./node_modules/esutils/lib/code.js":
/*!******************************************!*\
  !*** ./node_modules/esutils/lib/code.js ***!
  \******************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){!function(){"use strict";var t,i,r,n,o,a;function s(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(Math.floor((e-65536)/1024)+55296)+String.fromCharCode((e-65536)%1024+56320)}for(i={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,NonAsciiIdentifierPart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/},t={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},r=[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279],n=new Array(128),a=0;a<128;++a)n[a]=a>=97&&a<=122||a>=65&&a<=90||36===a||95===a;for(o=new Array(128),a=0;a<128;++a)o[a]=a>=97&&a<=122||a>=65&&a<=90||a>=48&&a<=57||36===a||95===a;e.exports={isDecimalDigit:function(e){return 48<=e&&e<=57},isHexDigit:function(e){return 48<=e&&e<=57||97<=e&&e<=102||65<=e&&e<=70},isOctalDigit:function(e){return e>=48&&e<=55},isWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&r.indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},isIdentifierStartES5:function(e){return e<128?n[e]:i.NonAsciiIdentifierStart.test(s(e))},isIdentifierPartES5:function(e){return e<128?o[e]:i.NonAsciiIdentifierPart.test(s(e))},isIdentifierStartES6:function(e){return e<128?n[e]:t.NonAsciiIdentifierStart.test(s(e))},isIdentifierPartES6:function(e){return e<128?o[e]:t.NonAsciiIdentifierPart.test(s(e))}}}()},"./node_modules/esutils/lib/keyword.js":
/*!*********************************************!*\
  !*** ./node_modules/esutils/lib/keyword.js ***!
  \*********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){!function(){"use strict";var t=i(/*! ./code */"./node_modules/esutils/lib/code.js");function r(e,t){return!(!t&&"yield"===e)&&n(e,t)}function n(e,t){if(t&&function(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return!0;default:return!1}}(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}function o(e,t){return"null"===e||"true"===e||"false"===e||r(e,t)}function a(e,t){return"null"===e||"true"===e||"false"===e||n(e,t)}function s(e){var i,r,n;if(0===e.length)return!1;if(n=e.charCodeAt(0),!t.isIdentifierStartES5(n))return!1;for(i=1,r=e.length;i<r;++i)if(n=e.charCodeAt(i),!t.isIdentifierPartES5(n))return!1;return!0}function l(e){var i,r,n,o,a;if(0===e.length)return!1;for(a=t.isIdentifierStartES6,i=0,r=e.length;i<r;++i){if(55296<=(n=e.charCodeAt(i))&&n<=56319){if(++i>=r)return!1;if(!(56320<=(o=e.charCodeAt(i))&&o<=57343))return!1;n=1024*(n-55296)+(o-56320)+65536}if(!a(n))return!1;a=t.isIdentifierPartES6}return!0}e.exports={isKeywordES5:r,isKeywordES6:n,isReservedWordES5:o,isReservedWordES6:a,isRestrictedWord:function(e){return"eval"===e||"arguments"===e},isIdentifierNameES5:s,isIdentifierNameES6:l,isIdentifierES5:function(e,t){return s(e)&&!o(e,t)},isIdentifierES6:function(e,t){return l(e)&&!a(e,t)}}}()},"./node_modules/esutils/lib/utils.js":
/*!*******************************************!*\
  !*** ./node_modules/esutils/lib/utils.js ***!
  \*******************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){!function(){"use strict";t.ast=i(/*! ./ast */"./node_modules/esutils/lib/ast.js"),t.code=i(/*! ./code */"./node_modules/esutils/lib/code.js"),t.keyword=i(/*! ./keyword */"./node_modules/esutils/lib/keyword.js")}()},"./node_modules/source-map/lib/array-set.js":
/*!**************************************************!*\
  !*** ./node_modules/source-map/lib/array-set.js ***!
  \**************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./util */"./node_modules/source-map/lib/util.js"),n=Object.prototype.hasOwnProperty,o="undefined"!=typeof Map;function a(){this._array=[],this._set=o?new Map:Object.create(null)}a.fromArray=function(e,t){for(var i=new a,r=0,n=e.length;r<n;r++)i.add(e[r],t);return i},a.prototype.size=function(){return o?this._set.size:Object.getOwnPropertyNames(this._set).length},a.prototype.add=function(e,t){var i=o?e:r.toSetString(e),a=o?this.has(e):n.call(this._set,i),s=this._array.length;a&&!t||this._array.push(e),a||(o?this._set.set(e,s):this._set[i]=s)},a.prototype.has=function(e){if(o)return this._set.has(e);var t=r.toSetString(e);return n.call(this._set,t)},a.prototype.indexOf=function(e){if(o){var t=this._set.get(e);if(t>=0)return t}else{var i=r.toSetString(e);if(n.call(this._set,i))return this._set[i]}throw new Error('"'+e+'" is not in the set.')},a.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},a.prototype.toArray=function(){return this._array.slice()},t.ArraySet=a},"./node_modules/source-map/lib/base64-vlq.js":
/*!***************************************************!*\
  !*** ./node_modules/source-map/lib/base64-vlq.js ***!
  \***************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./base64 */"./node_modules/source-map/lib/base64.js");t.encode=function(e){var t,i="",n=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{t=31&n,(n>>>=5)>0&&(t|=32),i+=r.encode(t)}while(n>0);return i},t.decode=function(e,t,i){var n,o,a,s,l=e.length,u=0,c=0;do{if(t>=l)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(o=r.decode(e.charCodeAt(t++))))throw new Error("Invalid base64 digit: "+e.charAt(t-1));n=!!(32&o),u+=(o&=31)<<c,c+=5}while(n);i.value=(s=(a=u)>>1,1==(1&a)?-s:s),i.rest=t}},"./node_modules/source-map/lib/base64.js":
/*!***********************************************!*\
  !*** ./node_modules/source-map/lib/base64.js ***!
  \***********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");t.encode=function(e){if(0<=e&&e<i.length)return i[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){return 65<=e&&e<=90?e-65:97<=e&&e<=122?e-97+26:48<=e&&e<=57?e-48+52:43==e?62:47==e?63:-1}},"./node_modules/source-map/lib/binary-search.js":
/*!******************************************************!*\
  !*** ./node_modules/source-map/lib/binary-search.js ***!
  \******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2,t.search=function(e,i,r,n){if(0===i.length)return-1;var o=function e(i,r,n,o,a,s){var l=Math.floor((r-i)/2)+i,u=a(n,o[l],!0);return 0===u?l:u>0?r-l>1?e(l,r,n,o,a,s):s==t.LEAST_UPPER_BOUND?r<o.length?r:-1:l:l-i>1?e(i,l,n,o,a,s):s==t.LEAST_UPPER_BOUND?l:i<0?-1:i}(-1,i.length,e,i,r,n||t.GREATEST_LOWER_BOUND);if(o<0)return-1;for(;o-1>=0&&0===r(i[o],i[o-1],!0);)--o;return o}},"./node_modules/source-map/lib/mapping-list.js":
/*!*****************************************************!*\
  !*** ./node_modules/source-map/lib/mapping-list.js ***!
  \*****************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./util */"./node_modules/source-map/lib/util.js");function n(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}n.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},n.prototype.add=function(e){var t,i,n,o,a,s;i=e,n=(t=this._last).generatedLine,o=i.generatedLine,a=t.generatedColumn,s=i.generatedColumn,o>n||o==n&&s>=a||r.compareByGeneratedPositionsInflated(t,i)<=0?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))},n.prototype.toArray=function(){return this._sorted||(this._array.sort(r.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},t.MappingList=n},"./node_modules/source-map/lib/quick-sort.js":
/*!***************************************************!*\
  !*** ./node_modules/source-map/lib/quick-sort.js ***!
  \***************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){function i(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}t.quickSort=function(e,t){!function e(t,r,n,o){if(n<o){var a=n-1;i(t,(c=n,h=o,Math.round(c+Math.random()*(h-c))),o);for(var s=t[o],l=n;l<o;l++)r(t[l],s)<=0&&i(t,a+=1,l);i(t,a+1,l);var u=a+1;e(t,r,n,u-1),e(t,r,u+1,o)}var c,h}(e,t,0,e.length-1)}},"./node_modules/source-map/lib/source-map-consumer.js":
/*!************************************************************!*\
  !*** ./node_modules/source-map/lib/source-map-consumer.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./util */"./node_modules/source-map/lib/util.js"),n=i(/*! ./binary-search */"./node_modules/source-map/lib/binary-search.js"),o=i(/*! ./array-set */"./node_modules/source-map/lib/array-set.js").ArraySet,a=i(/*! ./base64-vlq */"./node_modules/source-map/lib/base64-vlq.js"),s=i(/*! ./quick-sort */"./node_modules/source-map/lib/quick-sort.js").quickSort;function l(e,t){var i=e;return"string"==typeof e&&(i=r.parseSourceMapInput(e)),null!=i.sections?new h(i,t):new u(i,t)}function u(e,t){var i=e;"string"==typeof e&&(i=r.parseSourceMapInput(e));var n=r.getArg(i,"version"),a=r.getArg(i,"sources"),s=r.getArg(i,"names",[]),l=r.getArg(i,"sourceRoot",null),u=r.getArg(i,"sourcesContent",null),c=r.getArg(i,"mappings"),h=r.getArg(i,"file",null);if(n!=this._version)throw new Error("Unsupported version: "+n);l&&(l=r.normalize(l)),a=a.map(String).map(r.normalize).map((function(e){return l&&r.isAbsolute(l)&&r.isAbsolute(e)?r.relative(l,e):e})),this._names=o.fromArray(s.map(String),!0),this._sources=o.fromArray(a,!0),this._absoluteSources=this._sources.toArray().map((function(e){return r.computeSourceURL(l,e,t)})),this.sourceRoot=l,this.sourcesContent=u,this._mappings=c,this._sourceMapURL=t,this.file=h}function c(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function h(e,t){var i=e;"string"==typeof e&&(i=r.parseSourceMapInput(e));var n=r.getArg(i,"version"),a=r.getArg(i,"sections");if(n!=this._version)throw new Error("Unsupported version: "+n);this._sources=new o,this._names=new o;var s={line:-1,column:0};this._sections=a.map((function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var i=r.getArg(e,"offset"),n=r.getArg(i,"line"),o=r.getArg(i,"column");if(n<s.line||n===s.line&&o<s.column)throw new Error("Section offsets must be ordered and non-overlapping.");return s=i,{generatedOffset:{generatedLine:n+1,generatedColumn:o+1},consumer:new l(r.getArg(e,"map"),t)}}))}l.fromSourceMap=function(e,t){return u.fromSourceMap(e,t)},l.prototype._version=3,l.prototype.__generatedMappings=null,Object.defineProperty(l.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),l.prototype.__originalMappings=null,Object.defineProperty(l.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),l.prototype._charIsMappingSeparator=function(e,t){var i=e.charAt(t);return";"===i||","===i},l.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},l.GENERATED_ORDER=1,l.ORIGINAL_ORDER=2,l.GREATEST_LOWER_BOUND=1,l.LEAST_UPPER_BOUND=2,l.prototype.eachMapping=function(e,t,i){var n,o=t||null;switch(i||l.GENERATED_ORDER){case l.GENERATED_ORDER:n=this._generatedMappings;break;case l.ORIGINAL_ORDER:n=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var a=this.sourceRoot;n.map((function(e){var t=null===e.source?null:this._sources.at(e.source);return{source:t=r.computeSourceURL(a,t,this._sourceMapURL),generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}}),this).forEach(e,o)},l.prototype.allGeneratedPositionsFor=function(e){var t=r.getArg(e,"line"),i={source:r.getArg(e,"source"),originalLine:t,originalColumn:r.getArg(e,"column",0)};if(i.source=this._findSourceIndex(i.source),i.source<0)return[];var o=[],a=this._findMapping(i,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,n.LEAST_UPPER_BOUND);if(a>=0){var s=this._originalMappings[a];if(void 0===e.column)for(var l=s.originalLine;s&&s.originalLine===l;)o.push({line:r.getArg(s,"generatedLine",null),column:r.getArg(s,"generatedColumn",null),lastColumn:r.getArg(s,"lastGeneratedColumn",null)}),s=this._originalMappings[++a];else for(var u=s.originalColumn;s&&s.originalLine===t&&s.originalColumn==u;)o.push({line:r.getArg(s,"generatedLine",null),column:r.getArg(s,"generatedColumn",null),lastColumn:r.getArg(s,"lastGeneratedColumn",null)}),s=this._originalMappings[++a]}return o},t.SourceMapConsumer=l,u.prototype=Object.create(l.prototype),u.prototype.consumer=l,u.prototype._findSourceIndex=function(e){var t,i=e;if(null!=this.sourceRoot&&(i=r.relative(this.sourceRoot,i)),this._sources.has(i))return this._sources.indexOf(i);for(t=0;t<this._absoluteSources.length;++t)if(this._absoluteSources[t]==e)return t;return-1},u.fromSourceMap=function(e,t){var i=Object.create(u.prototype),n=i._names=o.fromArray(e._names.toArray(),!0),a=i._sources=o.fromArray(e._sources.toArray(),!0);i.sourceRoot=e._sourceRoot,i.sourcesContent=e._generateSourcesContent(i._sources.toArray(),i.sourceRoot),i.file=e._file,i._sourceMapURL=t,i._absoluteSources=i._sources.toArray().map((function(e){return r.computeSourceURL(i.sourceRoot,e,t)}));for(var l=e._mappings.toArray().slice(),h=i.__generatedMappings=[],p=i.__originalMappings=[],d=0,f=l.length;d<f;d++){var m=l[d],g=new c;g.generatedLine=m.generatedLine,g.generatedColumn=m.generatedColumn,m.source&&(g.source=a.indexOf(m.source),g.originalLine=m.originalLine,g.originalColumn=m.originalColumn,m.name&&(g.name=n.indexOf(m.name)),p.push(g)),h.push(g)}return s(i.__originalMappings,r.compareByOriginalPositions),i},u.prototype._version=3,Object.defineProperty(u.prototype,"sources",{get:function(){return this._absoluteSources.slice()}}),u.prototype._parseMappings=function(e,t){for(var i,n,o,l,u,h=1,p=0,d=0,f=0,m=0,g=0,v=e.length,y=0,b={},_={},x=[],E=[];y<v;)if(";"===e.charAt(y))h++,y++,p=0;else if(","===e.charAt(y))y++;else{for((i=new c).generatedLine=h,l=y;l<v&&!this._charIsMappingSeparator(e,l);l++);if(o=b[n=e.slice(y,l)])y+=n.length;else{for(o=[];y<l;)a.decode(e,y,_),u=_.value,y=_.rest,o.push(u);if(2===o.length)throw new Error("Found a source, but no line and column");if(3===o.length)throw new Error("Found a source and line, but no column");b[n]=o}i.generatedColumn=p+o[0],p=i.generatedColumn,o.length>1&&(i.source=m+o[1],m+=o[1],i.originalLine=d+o[2],d=i.originalLine,i.originalLine+=1,i.originalColumn=f+o[3],f=i.originalColumn,o.length>4&&(i.name=g+o[4],g+=o[4])),E.push(i),"number"==typeof i.originalLine&&x.push(i)}s(E,r.compareByGeneratedPositionsDeflated),this.__generatedMappings=E,s(x,r.compareByOriginalPositions),this.__originalMappings=x},u.prototype._findMapping=function(e,t,i,r,o,a){if(e[i]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[i]);if(e[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[r]);return n.search(e,t,o,a)},u.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var i=this._generatedMappings[e+1];if(t.generatedLine===i.generatedLine){t.lastGeneratedColumn=i.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},u.prototype.originalPositionFor=function(e){var t={generatedLine:r.getArg(e,"line"),generatedColumn:r.getArg(e,"column")},i=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",r.compareByGeneratedPositionsDeflated,r.getArg(e,"bias",l.GREATEST_LOWER_BOUND));if(i>=0){var n=this._generatedMappings[i];if(n.generatedLine===t.generatedLine){var o=r.getArg(n,"source",null);null!==o&&(o=this._sources.at(o),o=r.computeSourceURL(this.sourceRoot,o,this._sourceMapURL));var a=r.getArg(n,"name",null);return null!==a&&(a=this._names.at(a)),{source:o,line:r.getArg(n,"originalLine",null),column:r.getArg(n,"originalColumn",null),name:a}}}return{source:null,line:null,column:null,name:null}},u.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some((function(e){return null==e}))},u.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;var i=this._findSourceIndex(e);if(i>=0)return this.sourcesContent[i];var n,o=e;if(null!=this.sourceRoot&&(o=r.relative(this.sourceRoot,o)),null!=this.sourceRoot&&(n=r.urlParse(this.sourceRoot))){var a=o.replace(/^file:\/\//,"");if("file"==n.scheme&&this._sources.has(a))return this.sourcesContent[this._sources.indexOf(a)];if((!n.path||"/"==n.path)&&this._sources.has("/"+o))return this.sourcesContent[this._sources.indexOf("/"+o)]}if(t)return null;throw new Error('"'+o+'" is not in the SourceMap.')},u.prototype.generatedPositionFor=function(e){var t=r.getArg(e,"source");if((t=this._findSourceIndex(t))<0)return{line:null,column:null,lastColumn:null};var i={source:t,originalLine:r.getArg(e,"line"),originalColumn:r.getArg(e,"column")},n=this._findMapping(i,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,r.getArg(e,"bias",l.GREATEST_LOWER_BOUND));if(n>=0){var o=this._originalMappings[n];if(o.source===i.source)return{line:r.getArg(o,"generatedLine",null),column:r.getArg(o,"generatedColumn",null),lastColumn:r.getArg(o,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},t.BasicSourceMapConsumer=u,h.prototype=Object.create(l.prototype),h.prototype.constructor=l,h.prototype._version=3,Object.defineProperty(h.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var i=0;i<this._sections[t].consumer.sources.length;i++)e.push(this._sections[t].consumer.sources[i]);return e}}),h.prototype.originalPositionFor=function(e){var t={generatedLine:r.getArg(e,"line"),generatedColumn:r.getArg(e,"column")},i=n.search(t,this._sections,(function(e,t){return e.generatedLine-t.generatedOffset.generatedLine||e.generatedColumn-t.generatedOffset.generatedColumn})),o=this._sections[i];return o?o.consumer.originalPositionFor({line:t.generatedLine-(o.generatedOffset.generatedLine-1),column:t.generatedColumn-(o.generatedOffset.generatedLine===t.generatedLine?o.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},h.prototype.hasContentsOfAllSources=function(){return this._sections.every((function(e){return e.consumer.hasContentsOfAllSources()}))},h.prototype.sourceContentFor=function(e,t){for(var i=0;i<this._sections.length;i++){var r=this._sections[i].consumer.sourceContentFor(e,!0);if(r)return r}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},h.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var i=this._sections[t];if(-1!==i.consumer._findSourceIndex(r.getArg(e,"source"))){var n=i.consumer.generatedPositionFor(e);if(n)return{line:n.line+(i.generatedOffset.generatedLine-1),column:n.column+(i.generatedOffset.generatedLine===n.line?i.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},h.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var i=0;i<this._sections.length;i++)for(var n=this._sections[i],o=n.consumer._generatedMappings,a=0;a<o.length;a++){var l=o[a],u=n.consumer._sources.at(l.source);u=r.computeSourceURL(n.consumer.sourceRoot,u,this._sourceMapURL),this._sources.add(u),u=this._sources.indexOf(u);var c=null;l.name&&(c=n.consumer._names.at(l.name),this._names.add(c),c=this._names.indexOf(c));var h={source:u,generatedLine:l.generatedLine+(n.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(n.generatedOffset.generatedLine===l.generatedLine?n.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:c};this.__generatedMappings.push(h),"number"==typeof h.originalLine&&this.__originalMappings.push(h)}s(this.__generatedMappings,r.compareByGeneratedPositionsDeflated),s(this.__originalMappings,r.compareByOriginalPositions)},t.IndexedSourceMapConsumer=h},"./node_modules/source-map/lib/source-map-generator.js":
/*!*************************************************************!*\
  !*** ./node_modules/source-map/lib/source-map-generator.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./base64-vlq */"./node_modules/source-map/lib/base64-vlq.js"),n=i(/*! ./util */"./node_modules/source-map/lib/util.js"),o=i(/*! ./array-set */"./node_modules/source-map/lib/array-set.js").ArraySet,a=i(/*! ./mapping-list */"./node_modules/source-map/lib/mapping-list.js").MappingList;function s(e){e||(e={}),this._file=n.getArg(e,"file",null),this._sourceRoot=n.getArg(e,"sourceRoot",null),this._skipValidation=n.getArg(e,"skipValidation",!1),this._sources=new o,this._names=new o,this._mappings=new a,this._sourcesContents=null}s.prototype._version=3,s.fromSourceMap=function(e){var t=e.sourceRoot,i=new s({file:e.file,sourceRoot:t});return e.eachMapping((function(e){var r={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(r.source=e.source,null!=t&&(r.source=n.relative(t,r.source)),r.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(r.name=e.name)),i.addMapping(r)})),e.sources.forEach((function(r){var o=r;null!==t&&(o=n.relative(t,r)),i._sources.has(o)||i._sources.add(o);var a=e.sourceContentFor(r);null!=a&&i.setSourceContent(r,a)})),i},s.prototype.addMapping=function(e){var t=n.getArg(e,"generated"),i=n.getArg(e,"original",null),r=n.getArg(e,"source",null),o=n.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,i,r,o),null!=r&&(r=String(r),this._sources.has(r)||this._sources.add(r)),null!=o&&(o=String(o),this._names.has(o)||this._names.add(o)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=i&&i.line,originalColumn:null!=i&&i.column,source:r,name:o})},s.prototype.setSourceContent=function(e,t){var i=e;null!=this._sourceRoot&&(i=n.relative(this._sourceRoot,i)),null!=t?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[n.toSetString(i)]=t):this._sourcesContents&&(delete this._sourcesContents[n.toSetString(i)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},s.prototype.applySourceMap=function(e,t,i){var r=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');r=e.file}var a=this._sourceRoot;null!=a&&(r=n.relative(a,r));var s=new o,l=new o;this._mappings.unsortedForEach((function(t){if(t.source===r&&null!=t.originalLine){var o=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=o.source&&(t.source=o.source,null!=i&&(t.source=n.join(i,t.source)),null!=a&&(t.source=n.relative(a,t.source)),t.originalLine=o.line,t.originalColumn=o.column,null!=o.name&&(t.name=o.name))}var u=t.source;null==u||s.has(u)||s.add(u);var c=t.name;null==c||l.has(c)||l.add(c)}),this),this._sources=s,this._names=l,e.sources.forEach((function(t){var r=e.sourceContentFor(t);null!=r&&(null!=i&&(t=n.join(i,t)),null!=a&&(t=n.relative(a,t)),this.setSourceContent(t,r))}),this)},s.prototype._validateMapping=function(e,t,i,r){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||i||r)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&i))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:i,original:t,name:r}))},s.prototype._serializeMappings=function(){for(var e,t,i,o,a=0,s=1,l=0,u=0,c=0,h=0,p="",d=this._mappings.toArray(),f=0,m=d.length;f<m;f++){if(e="",(t=d[f]).generatedLine!==s)for(a=0;t.generatedLine!==s;)e+=";",s++;else if(f>0){if(!n.compareByGeneratedPositionsInflated(t,d[f-1]))continue;e+=","}e+=r.encode(t.generatedColumn-a),a=t.generatedColumn,null!=t.source&&(o=this._sources.indexOf(t.source),e+=r.encode(o-h),h=o,e+=r.encode(t.originalLine-1-u),u=t.originalLine-1,e+=r.encode(t.originalColumn-l),l=t.originalColumn,null!=t.name&&(i=this._names.indexOf(t.name),e+=r.encode(i-c),c=i)),p+=e}return p},s.prototype._generateSourcesContent=function(e,t){return e.map((function(e){if(!this._sourcesContents)return null;null!=t&&(e=n.relative(t,e));var i=n.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null}),this)},s.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},s.prototype.toString=function(){return JSON.stringify(this.toJSON())},t.SourceMapGenerator=s},"./node_modules/source-map/lib/source-node.js":
/*!****************************************************!*\
  !*** ./node_modules/source-map/lib/source-node.js ***!
  \****************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./source-map-generator */"./node_modules/source-map/lib/source-map-generator.js").SourceMapGenerator,n=i(/*! ./util */"./node_modules/source-map/lib/util.js"),o=/(\r?\n)/,a="$$$isSourceNode$$$";function s(e,t,i,r,n){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==i?null:i,this.name=null==n?null:n,this[a]=!0,null!=r&&this.add(r)}s.fromStringWithSourceMap=function(e,t,i){var r=new s,a=e.split(o),l=0,u=function(){return e()+(e()||"");function e(){return l<a.length?a[l++]:void 0}},c=1,h=0,p=null;return t.eachMapping((function(e){if(null!==p){if(!(c<e.generatedLine)){var t=(i=a[l]||"").substr(0,e.generatedColumn-h);return a[l]=i.substr(e.generatedColumn-h),h=e.generatedColumn,d(p,t),void(p=e)}d(p,u()),c++,h=0}for(;c<e.generatedLine;)r.add(u()),c++;if(h<e.generatedColumn){var i=a[l]||"";r.add(i.substr(0,e.generatedColumn)),a[l]=i.substr(e.generatedColumn),h=e.generatedColumn}p=e}),this),l<a.length&&(p&&d(p,u()),r.add(a.splice(l).join(""))),t.sources.forEach((function(e){var o=t.sourceContentFor(e);null!=o&&(null!=i&&(e=n.join(i,e)),r.setSourceContent(e,o))})),r;function d(e,t){if(null===e||void 0===e.source)r.add(t);else{var o=i?n.join(i,e.source):e.source;r.add(new s(e.originalLine,e.originalColumn,o,t,e.name))}}},s.prototype.add=function(e){if(Array.isArray(e))e.forEach((function(e){this.add(e)}),this);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},s.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},s.prototype.walk=function(e){for(var t,i=0,r=this.children.length;i<r;i++)(t=this.children[i])[a]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},s.prototype.join=function(e){var t,i,r=this.children.length;if(r>0){for(t=[],i=0;i<r-1;i++)t.push(this.children[i]),t.push(e);t.push(this.children[i]),this.children=t}return this},s.prototype.replaceRight=function(e,t){var i=this.children[this.children.length-1];return i[a]?i.replaceRight(e,t):"string"==typeof i?this.children[this.children.length-1]=i.replace(e,t):this.children.push("".replace(e,t)),this},s.prototype.setSourceContent=function(e,t){this.sourceContents[n.toSetString(e)]=t},s.prototype.walkSourceContents=function(e){for(var t=0,i=this.children.length;t<i;t++)this.children[t][a]&&this.children[t].walkSourceContents(e);var r=Object.keys(this.sourceContents);for(t=0,i=r.length;t<i;t++)e(n.fromSetString(r[t]),this.sourceContents[r[t]])},s.prototype.toString=function(){var e="";return this.walk((function(t){e+=t})),e},s.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},i=new r(e),n=!1,o=null,a=null,s=null,l=null;return this.walk((function(e,r){t.code+=e,null!==r.source&&null!==r.line&&null!==r.column?(o===r.source&&a===r.line&&s===r.column&&l===r.name||i.addMapping({source:r.source,original:{line:r.line,column:r.column},generated:{line:t.line,column:t.column},name:r.name}),o=r.source,a=r.line,s=r.column,l=r.name,n=!0):n&&(i.addMapping({generated:{line:t.line,column:t.column}}),o=null,n=!1);for(var u=0,c=e.length;u<c;u++)10===e.charCodeAt(u)?(t.line++,t.column=0,u+1===c?(o=null,n=!1):n&&i.addMapping({source:r.source,original:{line:r.line,column:r.column},generated:{line:t.line,column:t.column},name:r.name})):t.column++})),this.walkSourceContents((function(e,t){i.setSourceContent(e,t)})),{code:t.code,map:i}},t.SourceNode=s},"./node_modules/source-map/lib/util.js":
/*!*********************************************!*\
  !*** ./node_modules/source-map/lib/util.js ***!
  \*********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){t.getArg=function(e,t,i){if(t in e)return e[t];if(3===arguments.length)return i;throw new Error('"'+t+'" is a required argument.')};var i=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function n(e){var t=e.match(i);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function o(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function a(e){var i=e,r=n(e);if(r){if(!r.path)return e;i=r.path}for(var a,s=t.isAbsolute(i),l=i.split(/\/+/),u=0,c=l.length-1;c>=0;c--)"."===(a=l[c])?l.splice(c,1):".."===a?u++:u>0&&(""===a?(l.splice(c+1,u),u=0):(l.splice(c,2),u--));return""===(i=l.join("/"))&&(i=s?"/":"."),r?(r.path=i,o(r)):i}function s(e,t){""===e&&(e="."),""===t&&(t=".");var i=n(t),s=n(e);if(s&&(e=s.path||"/"),i&&!i.scheme)return s&&(i.scheme=s.scheme),o(i);if(i||t.match(r))return t;if(s&&!s.host&&!s.path)return s.host=t,o(s);var l="/"===t.charAt(0)?t:a(e.replace(/\/+$/,"")+"/"+t);return s?(s.path=l,o(s)):l}t.urlParse=n,t.urlGenerate=o,t.normalize=a,t.join=s,t.isAbsolute=function(e){return"/"===e.charAt(0)||i.test(e)},t.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var i=0;0!==t.indexOf(e+"/");){var r=e.lastIndexOf("/");if(r<0)return t;if((e=e.slice(0,r)).match(/^([^\/]+:\/)?\/*$/))return t;++i}return Array(i+1).join("../")+t.substr(e.length+1)};var l=!("__proto__"in Object.create(null));function u(e){return e}function c(e){if(!e)return!1;var t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var i=t-10;i>=0;i--)if(36!==e.charCodeAt(i))return!1;return!0}function h(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}t.toSetString=l?u:function(e){return c(e)?"$"+e:e},t.fromSetString=l?u:function(e){return c(e)?e.slice(1):e},t.compareByOriginalPositions=function(e,t,i){var r=h(e.source,t.source);return 0!==r?r:0!=(r=e.originalLine-t.originalLine)?r:0!=(r=e.originalColumn-t.originalColumn)||i?r:0!=(r=e.generatedColumn-t.generatedColumn)?r:0!=(r=e.generatedLine-t.generatedLine)?r:h(e.name,t.name)},t.compareByGeneratedPositionsDeflated=function(e,t,i){var r=e.generatedLine-t.generatedLine;return 0!==r?r:0!=(r=e.generatedColumn-t.generatedColumn)||i?r:0!==(r=h(e.source,t.source))?r:0!=(r=e.originalLine-t.originalLine)?r:0!=(r=e.originalColumn-t.originalColumn)?r:h(e.name,t.name)},t.compareByGeneratedPositionsInflated=function(e,t){var i=e.generatedLine-t.generatedLine;return 0!==i?i:0!=(i=e.generatedColumn-t.generatedColumn)?i:0!==(i=h(e.source,t.source))?i:0!=(i=e.originalLine-t.originalLine)?i:0!=(i=e.originalColumn-t.originalColumn)?i:h(e.name,t.name)},t.parseSourceMapInput=function(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))},t.computeSourceURL=function(e,t,i){if(t=t||"",e&&("/"!==e[e.length-1]&&"/"!==t[0]&&(e+="/"),t=e+t),i){var r=n(i);if(!r)throw new Error("sourceMapURL could not be parsed");if(r.path){var l=r.path.lastIndexOf("/");l>=0&&(r.path=r.path.substring(0,l+1))}t=s(o(r),t)}return a(t)}},"./node_modules/source-map/source-map.js":
/*!***********************************************!*\
  !*** ./node_modules/source-map/source-map.js ***!
  \***********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){t.SourceMapGenerator=i(/*! ./lib/source-map-generator */"./node_modules/source-map/lib/source-map-generator.js").SourceMapGenerator,t.SourceMapConsumer=i(/*! ./lib/source-map-consumer */"./node_modules/source-map/lib/source-map-consumer.js").SourceMapConsumer,t.SourceNode=i(/*! ./lib/source-node */"./node_modules/source-map/lib/source-node.js").SourceNode},"./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},"./src/eval/index.js":
/*!***************************!*\
  !*** ./src/eval/index.js ***!
  \***************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! escodegen */"./node_modules/escodegen/escodegen.js").generate;e.exports=function(e,t){t||(t={});var i={},n=function e(n,o){if("Literal"===n.type)return n.value;if("UnaryExpression"===n.type){var a=e(n.argument);return"+"===n.operator?+a:"-"===n.operator?-a:"~"===n.operator?~a:"!"===n.operator?!a:i}if("ArrayExpression"===n.type){for(var s=[],l=0,u=n.elements.length;l<u;l++){if((v=e(n.elements[l]))===i)return i;s.push(v)}return s}if("ObjectExpression"===n.type){var c={};for(l=0;l<n.properties.length;l++){var h=null===(y=n.properties[l]).value?y.value:e(y.value);if(h===i)return i;c[y.key.value||y.key.name]=h}return c}if("BinaryExpression"===n.type||"LogicalExpression"===n.type){if((u=e(n.left))===i)return i;var p=e(n.right);if(p===i)return i;var d=n.operator;return"=="===d?u==p:"==="===d?u===p:"!="===d?u!=p:"!=="===d?u!==p:"+"===d?u+p:"-"===d?u-p:"*"===d?u*p:"/"===d?u/p:"%"===d?u%p:"<"===d?u<p:"<="===d?u<=p:">"===d?u>p:">="===d?u>=p:"|"===d?u|p:"&"===d?u&p:"^"===d?u^p:"&&"===d?u&&p:"||"===d?u||p:i}if("Identifier"===n.type)return{}.hasOwnProperty.call(t,n.name)?t[n.name]:i;if("ThisExpression"===n.type)return{}.hasOwnProperty.call(t,"this")?t.this:i;if("CallExpression"===n.type){var f=e(n.callee);if(f===i)return i;if("function"!=typeof f)return i;var m=n.callee.object?e(n.callee.object):i;m===i&&(m=null);var g=[];for(l=0,u=n.arguments.length;l<u;l++){var v;if((v=e(n.arguments[l]))===i)return i;g.push(v)}return f.apply(m,g)}var y;if("MemberExpression"===n.type)return(c=e(n.object))===i||"function"==typeof c?i:"Identifier"===n.property.type?c[n.property.name]:(y=e(n.property))===i?i:c[y];if("ConditionalExpression"===n.type)return(a=e(n.test))===i?i:e(a?n.consequent:n.alternate);if("ExpressionStatement"===n.type)return(a=e(n.expression))===i?i:a;if("ReturnStatement"===n.type)return e(n.argument);if("FunctionExpression"===n.type){var b=n.body.body,_={};for(Object.keys(t).forEach((function(e){_[e]=t[e]})),l=0;l<n.params.length;l++){var x=n.params[l];if("Identifier"!=x.type)return i;t[x.name]=null}for(var l in b)if(e(b[l])===i)return i;t=_;var E=Object.keys(t),w=E.map((function(e){return t[e]}));return Function(E.join(", "),"return "+r(n)).apply(null,w)}if("TemplateLiteral"===n.type){var T="";for(l=0;l<n.expressions.length;l++)T+=e(n.quasis[l]),T+=e(n.expressions[l]);return T+e(n.quasis[l])}if("TaggedTemplateExpression"===n.type){var S=e(n.tag),A=n.quasi,M=A.quasis.map(e),C=A.expressions.map(e);return S.apply(null,[M].concat(C))}return"TemplateElement"===n.type?n.value.cooked:i}(e);return n===i?void 0:n}},"./src/main.js":
/*!*********************************!*\
  !*** ./src/main.js + 1 modules ***!
  \*********************************/
/*! no exports provided */
/*! all exports used */function(e,t,i){"use strict";i.r(t);var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i(/*! ./ */"./src/eval/index.js"),o=i(/*! esprima */"./node_modules/esprima/dist/esprima.js").parse,a=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.expression=o(t).body[0].expression,this}return r(e,[{key:"evaluate",value:function(e){return e=e||{},n(this.expression,e)}}]),e}();window.THING=window.THING||{},window.THING.Plugins=window.THING.Plugins||{},window.THING.Plugins.EVAL={Eval:a}},0:
/*!***************************!*\
  !*** multi ./src/main.js ***!
  \***************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports=i(/*! ./src/main.js */"./src/main.js")}}),function(){"use strict";var e="undefined"!=typeof require,t=this.THREE||e&&require("three");if(!t)throw new Error("MeshLine requires three.js");var i=i||t;function r(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new t.BufferGeometry,this.widthCallback=null}function n(e,t,i,r,n){var o;if(e=e.subarray||e.slice?e:e.buffer,i=i.subarray||i.slice?i:i.buffer,e=t?e.subarray?e.subarray(t,n&&t+n):e.slice(t,n&&t+n):e,i.set)i.set(e,r);else for(o=0;o<e.length;o++)i[o+r]=e[o];return i}function o(e){function i(e,t){return void 0===e?t:e}t.Material.call(this),e=e||{},this.lineWidth=i(e.lineWidth,1),this.map=i(e.map,null),this.useMap=i(e.useMap,0),this.alphaMap=i(e.alphaMap,null),this.useAlphaMap=i(e.useAlphaMap,0),this.color=i(e.color,new t.Color(16777215)),this.opacity=i(e.opacity,1),this.resolution=i(e.resolution,new t.Vector2(1,1)),this.sizeAttenuation=i(e.sizeAttenuation,1),this.near=i(e.near,1),this.far=i(e.far,1),this.dashArray=i(e.dashArray,[]),this.useDash=this.dashArray!==[]?1:0,this.visibility=i(e.visibility,1),this.alphaTest=i(e.alphaTest,0),this.repeat=i(e.repeat,new t.Vector2(1,1));var r=new t.RawShaderMaterial({uniforms:{lineWidth:{type:"f",value:this.lineWidth},map:{type:"t",value:this.map},useMap:{type:"f",value:this.useMap},alphaMap:{type:"t",value:this.alphaMap},useAlphaMap:{type:"f",value:this.useAlphaMap},color:{type:"c",value:this.color},opacity:{type:"f",value:this.opacity},resolution:{type:"v2",value:this.resolution},sizeAttenuation:{type:"f",value:this.sizeAttenuation},near:{type:"f",value:this.near},far:{type:"f",value:this.far},dashArray:{type:"v2",value:new t.Vector2(this.dashArray[0],this.dashArray[1])},useDash:{type:"f",value:this.useDash},visibility:{type:"f",value:this.visibility},alphaTest:{type:"f",value:this.alphaTest},repeat:{type:"v2",value:this.repeat},uvTransform:{type:"m3",value:this.map?this.map.matrix:new t.Matrix3}},vertexShader:["precision highp float;","","attribute vec3 position;","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute vec2 uv;","attribute float counters;","","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","uniform mat3 uvTransform;","#ifdef USE_GPUPICKER","uniform float baseId;","varying vec4 worldId;","#endif","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","\t float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color, opacity );","    //vUV = uv;","    vUV = ( uvTransform * vec3( uv, 1 ) ).xy;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","\t float pixelWidth = finalPosition.w * pixelWidthRatio;","    float w = 1.8 * pixelWidth * lineWidth * width;","","    if( sizeAttenuation == 1. ) {","        w = 1.8 * lineWidth * width;","    }","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","        w = w / max(dot( miter, perp ), 0.2);","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec2 normal = vec2( -dir.y, dir.x );","    normal.x /= aspect;","    normal *= .5 * w;","","    vec4 offset = vec4( normal * side, 0.0, 1.0 );","    finalPosition.xy += offset.xy;","","    gl_Position = finalPosition;","#ifdef USE_GPUPICKER","vec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);","a -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);","worldId = vec4(a,1);","#endif","","}"].join("\r\n"),fragmentShader:["precision mediump float;","","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform vec2 dashArray;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","#ifdef USE_GPUPICKER","varying vec4 worldId;","#endif","","void main() {","","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","\t if( c.a < alphaTest ) discard;","\t if( useDash == 1. ){","\t \t ","\t }","    gl_FragColor = c;","\t gl_FragColor.a *= step(vCounters,visibility);","\t #ifdef USE_GPUPICKER","\t \tgl_FragColor = worldId;","\t #endif","}"].join("\r\n")});return delete e.lineWidth,delete e.map,delete e.useMap,delete e.alphaMap,delete e.useAlphaMap,delete e.color,delete e.opacity,delete e.resolution,delete e.sizeAttenuation,delete e.near,delete e.far,delete e.dashArray,delete e.visibility,delete e.alphaTest,delete e.repeat,r.type="MeshLineMaterial",r.setValues(e),r}r.prototype.setGeometry=function(e,i){if(this.widthCallback=i,this.positions=[],this.counters=[],e instanceof t.Geometry)for(var r=0;r<e.vertices.length;r++){var n=e.vertices[r];i=r/e.vertices.length;this.positions.push(n.x,n.y,n.z),this.positions.push(n.x,n.y,n.z),this.counters.push(i),this.counters.push(i)}if(t.BufferGeometry,e instanceof Float32Array||e instanceof Array)for(r=0;r<e.length;r+=3){i=r/e.length;this.positions.push(e[r],e[r+1],e[r+2]),this.positions.push(e[r],e[r+1],e[r+2]),this.counters.push(i),this.counters.push(i)}this.process()},r.prototype.compareV3=function(e,t){var i=6*e,r=6*t;return this.positions[i]===this.positions[r]&&this.positions[i+1]===this.positions[r+1]&&this.positions[i+2]===this.positions[r+2]},r.prototype.copyV3=function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},r.prototype.process=function(){var e,i,r=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(var n=0;n<r;n++)this.side.push(1),this.side.push(-1);for(n=0;n<r;n++)e=this.widthCallback?this.widthCallback(n/(r-1)):1,this.width.push(e),this.width.push(e);for(n=0;n<r;n++)this.uvs.push(n/(r-1),0),this.uvs.push(n/(r-1),1);i=this.compareV3(0,r-1)?this.copyV3(r-2):this.copyV3(0),this.previous.push(i[0],i[1],i[2]),this.previous.push(i[0],i[1],i[2]);for(n=0;n<r-1;n++)i=this.copyV3(n),this.previous.push(i[0],i[1],i[2]),this.previous.push(i[0],i[1],i[2]);for(n=1;n<r;n++)i=this.copyV3(n),this.next.push(i[0],i[1],i[2]),this.next.push(i[0],i[1],i[2]);i=this.compareV3(r-1,0)?this.copyV3(1):this.copyV3(r-1),this.next.push(i[0],i[1],i[2]),this.next.push(i[0],i[1],i[2]);for(n=0;n<r-1;n++){var o=2*n;this.indices_array.push(o,o+1,o+2),this.indices_array.push(o+2,o+1,o+3)}this.attributes?(this.attributes.position.copyArray(new Float32Array(this.positions)),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(new Float32Array(this.previous)),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(new Float32Array(this.next)),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(new Float32Array(this.side)),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(new Float32Array(this.width)),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(new Float32Array(this.uvs)),this.attributes.uv.needsUpdate=!0,this.attributes.index.copyArray(new Uint16Array(this.indices_array)),this.attributes.index.needsUpdate=!0):this.attributes={position:new t.BufferAttribute(new Float32Array(this.positions),3),previous:new t.BufferAttribute(new Float32Array(this.previous),3),next:new t.BufferAttribute(new Float32Array(this.next),3),side:new t.BufferAttribute(new Float32Array(this.side),1),width:new t.BufferAttribute(new Float32Array(this.width),1),uv:new t.BufferAttribute(new Float32Array(this.uvs),2),index:new t.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new t.BufferAttribute(new Float32Array(this.counters),1)},this.geometry.addAttribute("position",this.attributes.position),this.geometry.addAttribute("previous",this.attributes.previous),this.geometry.addAttribute("next",this.attributes.next),this.geometry.addAttribute("side",this.attributes.side),this.geometry.addAttribute("width",this.attributes.width),this.geometry.addAttribute("uv",this.attributes.uv),this.geometry.addAttribute("counters",this.attributes.counters),this.geometry.setIndex(this.attributes.index)},r.prototype.advance=function(e){var t=this.attributes.position.array,i=this.attributes.previous.array,r=this.attributes.next.array,o=t.length;n(t,0,i,0,o),n(t,6,t,0,o-6),t[o-6]=e.x,t[o-5]=e.y,t[o-4]=e.z,t[o-3]=e.x,t[o-2]=e.y,t[o-1]=e.z,n(t,6,r,0,o-6),r[o-6]=e.x,r[o-5]=e.y,r[o-4]=e.z,r[o-3]=e.x,r[o-2]=e.y,r[o-1]=e.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0},o.prototype=Object.create(t.Material.prototype),o.prototype.constructor=o,o.prototype.copy=function(e){return t.Material.prototype.copy.call(this,e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.near=e.near,this.far=e.far,this.dashArray.copy(e.dashArray),this.useDash=e.useDash,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this},void 0!==i?("undefined"!=typeof module&&module.exports&&(i=module.exports={MeshLine:r,MeshLineMaterial:o}),i.MeshLine=r,i.MeshLineMaterial=o):(this.MeshLine=r,this.MeshLineMaterial=o)}.call(this),function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}({"./node_modules/babel-runtime/core-js/map.js":
/*!***************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/map.js ***!
  \***************************************************/
/*! no static exports found */
/*! exports used: default */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports={default:i(/*! core-js/library/fn/map */"./node_modules/core-js/library/fn/map.js"),__esModule:!0}},"./node_modules/babel-runtime/core-js/object/create.js":
/*!*************************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/object/create.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports={default:i(/*! core-js/library/fn/object/create */"./node_modules/core-js/library/fn/object/create.js"),__esModule:!0}},"./node_modules/babel-runtime/core-js/object/keys.js":
/*!***********************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/object/keys.js ***!
  \***********************************************************/
/*! no static exports found */
/*! exports used: default */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports={default:i(/*! core-js/library/fn/object/keys */"./node_modules/core-js/library/fn/object/keys.js"),__esModule:!0}},"./node_modules/babel-runtime/core-js/object/set-prototype-of.js":
/*!***********************************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/object/set-prototype-of.js ***!
  \***********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports={default:i(/*! core-js/library/fn/object/set-prototype-of */"./node_modules/core-js/library/fn/object/set-prototype-of.js"),__esModule:!0}},"./node_modules/babel-runtime/core-js/promise.js":
/*!*******************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/promise.js ***!
  \*******************************************************/
/*! no static exports found */
/*! exports used: default */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports={default:i(/*! core-js/library/fn/promise */"./node_modules/core-js/library/fn/promise.js"),__esModule:!0}},"./node_modules/babel-runtime/core-js/symbol.js":
/*!******************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/symbol.js ***!
  \******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports={default:i(/*! core-js/library/fn/symbol */"./node_modules/core-js/library/fn/symbol/index.js"),__esModule:!0}},"./node_modules/babel-runtime/core-js/symbol/iterator.js":
/*!***************************************************************!*\
  !*** ./node_modules/babel-runtime/core-js/symbol/iterator.js ***!
  \***************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports={default:i(/*! core-js/library/fn/symbol/iterator */"./node_modules/core-js/library/fn/symbol/iterator.js"),__esModule:!0}},"./node_modules/babel-runtime/helpers/classCallCheck.js":
/*!**************************************************************!*\
  !*** ./node_modules/babel-runtime/helpers/classCallCheck.js ***!
  \**************************************************************/
/*! no static exports found */
/*! exports used: default */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},"./node_modules/babel-runtime/helpers/inherits.js":
/*!********************************************************!*\
  !*** ./node_modules/babel-runtime/helpers/inherits.js ***!
  \********************************************************/
/*! no static exports found */
/*! exports used: default */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";t.__esModule=!0;var r=a(i(/*! ../core-js/object/set-prototype-of */"./node_modules/babel-runtime/core-js/object/set-prototype-of.js")),n=a(i(/*! ../core-js/object/create */"./node_modules/babel-runtime/core-js/object/create.js")),o=a(i(/*! ../helpers/typeof */"./node_modules/babel-runtime/helpers/typeof.js"));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,o.default)(t)));e.prototype=(0,n.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(r.default?(0,r.default)(e,t):e.__proto__=t)}},"./node_modules/babel-runtime/helpers/possibleConstructorReturn.js":
/*!*************************************************************************!*\
  !*** ./node_modules/babel-runtime/helpers/possibleConstructorReturn.js ***!
  \*************************************************************************/
/*! no static exports found */
/*! exports used: default */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";t.__esModule=!0;var r,n=(r=i(/*! ../helpers/typeof */"./node_modules/babel-runtime/helpers/typeof.js"))&&r.__esModule?r:{default:r};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,n.default)(t))&&"function"!=typeof t?e:t}},"./node_modules/babel-runtime/helpers/typeof.js":
/*!******************************************************!*\
  !*** ./node_modules/babel-runtime/helpers/typeof.js ***!
  \******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";t.__esModule=!0;var r=a(i(/*! ../core-js/symbol/iterator */"./node_modules/babel-runtime/core-js/symbol/iterator.js")),n=a(i(/*! ../core-js/symbol */"./node_modules/babel-runtime/core-js/symbol.js")),o="function"==typeof n.default&&"symbol"==typeof r.default?function(e){return typeof e}:function(e){return e&&"function"==typeof n.default&&e.constructor===n.default&&e!==n.default.prototype?"symbol":typeof e};function a(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof n.default&&"symbol"===o(r.default)?function(e){return void 0===e?"undefined":o(e)}:function(e){return e&&"function"==typeof n.default&&e.constructor===n.default&&e!==n.default.prototype?"symbol":void 0===e?"undefined":o(e)}},"./node_modules/core-js/library/fn/map.js":
/*!************************************************!*\
  !*** ./node_modules/core-js/library/fn/map.js ***!
  \************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){i(/*! ../modules/es6.object.to-string */"./node_modules/core-js/library/modules/es6.object.to-string.js"),i(/*! ../modules/es6.string.iterator */"./node_modules/core-js/library/modules/es6.string.iterator.js"),i(/*! ../modules/web.dom.iterable */"./node_modules/core-js/library/modules/web.dom.iterable.js"),i(/*! ../modules/es6.map */"./node_modules/core-js/library/modules/es6.map.js"),i(/*! ../modules/es7.map.to-json */"./node_modules/core-js/library/modules/es7.map.to-json.js"),i(/*! ../modules/es7.map.of */"./node_modules/core-js/library/modules/es7.map.of.js"),i(/*! ../modules/es7.map.from */"./node_modules/core-js/library/modules/es7.map.from.js"),e.exports=i(/*! ../modules/_core */"./node_modules/core-js/library/modules/_core.js").Map},"./node_modules/core-js/library/fn/object/create.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/library/fn/object/create.js ***!
  \**********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){i(/*! ../../modules/es6.object.create */"./node_modules/core-js/library/modules/es6.object.create.js");var r=i(/*! ../../modules/_core */"./node_modules/core-js/library/modules/_core.js").Object;e.exports=function(e,t){return r.create(e,t)}},"./node_modules/core-js/library/fn/object/keys.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/library/fn/object/keys.js ***!
  \********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){i(/*! ../../modules/es6.object.keys */"./node_modules/core-js/library/modules/es6.object.keys.js"),e.exports=i(/*! ../../modules/_core */"./node_modules/core-js/library/modules/_core.js").Object.keys},"./node_modules/core-js/library/fn/object/set-prototype-of.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/library/fn/object/set-prototype-of.js ***!
  \********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){i(/*! ../../modules/es6.object.set-prototype-of */"./node_modules/core-js/library/modules/es6.object.set-prototype-of.js"),e.exports=i(/*! ../../modules/_core */"./node_modules/core-js/library/modules/_core.js").Object.setPrototypeOf},"./node_modules/core-js/library/fn/promise.js":
/*!****************************************************!*\
  !*** ./node_modules/core-js/library/fn/promise.js ***!
  \****************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){i(/*! ../modules/es6.object.to-string */"./node_modules/core-js/library/modules/es6.object.to-string.js"),i(/*! ../modules/es6.string.iterator */"./node_modules/core-js/library/modules/es6.string.iterator.js"),i(/*! ../modules/web.dom.iterable */"./node_modules/core-js/library/modules/web.dom.iterable.js"),i(/*! ../modules/es6.promise */"./node_modules/core-js/library/modules/es6.promise.js"),i(/*! ../modules/es7.promise.finally */"./node_modules/core-js/library/modules/es7.promise.finally.js"),i(/*! ../modules/es7.promise.try */"./node_modules/core-js/library/modules/es7.promise.try.js"),e.exports=i(/*! ../modules/_core */"./node_modules/core-js/library/modules/_core.js").Promise},"./node_modules/core-js/library/fn/symbol/index.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/fn/symbol/index.js ***!
  \*********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){i(/*! ../../modules/es6.symbol */"./node_modules/core-js/library/modules/es6.symbol.js"),i(/*! ../../modules/es6.object.to-string */"./node_modules/core-js/library/modules/es6.object.to-string.js"),i(/*! ../../modules/es7.symbol.async-iterator */"./node_modules/core-js/library/modules/es7.symbol.async-iterator.js"),i(/*! ../../modules/es7.symbol.observable */"./node_modules/core-js/library/modules/es7.symbol.observable.js"),e.exports=i(/*! ../../modules/_core */"./node_modules/core-js/library/modules/_core.js").Symbol},"./node_modules/core-js/library/fn/symbol/iterator.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/fn/symbol/iterator.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){i(/*! ../../modules/es6.string.iterator */"./node_modules/core-js/library/modules/es6.string.iterator.js"),i(/*! ../../modules/web.dom.iterable */"./node_modules/core-js/library/modules/web.dom.iterable.js"),e.exports=i(/*! ../../modules/_wks-ext */"./node_modules/core-js/library/modules/_wks-ext.js").f("iterator")},"./node_modules/core-js/library/modules/_a-function.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_a-function.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},"./node_modules/core-js/library/modules/_add-to-unscopables.js":
/*!*********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_add-to-unscopables.js ***!
  \*********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=function(){}},"./node_modules/core-js/library/modules/_an-instance.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_an-instance.js ***!
  \**************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=function(e,t,i,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(i+": incorrect invocation!");return e}},"./node_modules/core-js/library/modules/_an-object.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_an-object.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_is-object */"./node_modules/core-js/library/modules/_is-object.js");e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},"./node_modules/core-js/library/modules/_array-from-iterable.js":
/*!**********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_array-from-iterable.js ***!
  \**********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_for-of */"./node_modules/core-js/library/modules/_for-of.js");e.exports=function(e,t){var i=[];return r(e,!1,i.push,i,t),i}},"./node_modules/core-js/library/modules/_array-includes.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_array-includes.js ***!
  \*****************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_to-iobject */"./node_modules/core-js/library/modules/_to-iobject.js"),n=i(/*! ./_to-length */"./node_modules/core-js/library/modules/_to-length.js"),o=i(/*! ./_to-absolute-index */"./node_modules/core-js/library/modules/_to-absolute-index.js");e.exports=function(e){return function(t,i,a){var s,l=r(t),u=n(l.length),c=o(a,u);if(e&&i!=i){for(;u>c;)if((s=l[c++])!=s)return!0}else for(;u>c;c++)if((e||c in l)&&l[c]===i)return e||c||0;return!e&&-1}}},"./node_modules/core-js/library/modules/_array-methods.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_array-methods.js ***!
  \****************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_ctx */"./node_modules/core-js/library/modules/_ctx.js"),n=i(/*! ./_iobject */"./node_modules/core-js/library/modules/_iobject.js"),o=i(/*! ./_to-object */"./node_modules/core-js/library/modules/_to-object.js"),a=i(/*! ./_to-length */"./node_modules/core-js/library/modules/_to-length.js"),s=i(/*! ./_array-species-create */"./node_modules/core-js/library/modules/_array-species-create.js");e.exports=function(e,t){var i=1==e,l=2==e,u=3==e,c=4==e,h=6==e,p=5==e||h,d=t||s;return function(t,s,f){for(var m,g,v=o(t),y=n(v),b=r(s,f,3),_=a(y.length),x=0,E=i?d(t,_):l?d(t,0):void 0;_>x;x++)if((p||x in y)&&(g=b(m=y[x],x,v),e))if(i)E[x]=g;else if(g)switch(e){case 3:return!0;case 5:return m;case 6:return x;case 2:E.push(m)}else if(c)return!1;return h?-1:u||c?c:E}}},"./node_modules/core-js/library/modules/_array-species-constructor.js":
/*!****************************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_array-species-constructor.js ***!
  \****************************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_is-object */"./node_modules/core-js/library/modules/_is-object.js"),n=i(/*! ./_is-array */"./node_modules/core-js/library/modules/_is-array.js"),o=i(/*! ./_wks */"./node_modules/core-js/library/modules/_wks.js")("species");e.exports=function(e){var t;return n(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!n(t.prototype)||(t=void 0),r(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},"./node_modules/core-js/library/modules/_array-species-create.js":
/*!***********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_array-species-create.js ***!
  \***********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_array-species-constructor */"./node_modules/core-js/library/modules/_array-species-constructor.js");e.exports=function(e,t){return new(r(e))(t)}},"./node_modules/core-js/library/modules/_classof.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_classof.js ***!
  \**********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_cof */"./node_modules/core-js/library/modules/_cof.js"),n=i(/*! ./_wks */"./node_modules/core-js/library/modules/_wks.js")("toStringTag"),o="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,i,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),n))?i:o?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},"./node_modules/core-js/library/modules/_cof.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_cof.js ***!
  \******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){var i={}.toString;e.exports=function(e){return i.call(e).slice(8,-1)}},"./node_modules/core-js/library/modules/_collection-strong.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_collection-strong.js ***!
  \********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=i(/*! ./_object-dp */"./node_modules/core-js/library/modules/_object-dp.js").f,n=i(/*! ./_object-create */"./node_modules/core-js/library/modules/_object-create.js"),o=i(/*! ./_redefine-all */"./node_modules/core-js/library/modules/_redefine-all.js"),a=i(/*! ./_ctx */"./node_modules/core-js/library/modules/_ctx.js"),s=i(/*! ./_an-instance */"./node_modules/core-js/library/modules/_an-instance.js"),l=i(/*! ./_for-of */"./node_modules/core-js/library/modules/_for-of.js"),u=i(/*! ./_iter-define */"./node_modules/core-js/library/modules/_iter-define.js"),c=i(/*! ./_iter-step */"./node_modules/core-js/library/modules/_iter-step.js"),h=i(/*! ./_set-species */"./node_modules/core-js/library/modules/_set-species.js"),p=i(/*! ./_descriptors */"./node_modules/core-js/library/modules/_descriptors.js"),d=i(/*! ./_meta */"./node_modules/core-js/library/modules/_meta.js").fastKey,f=i(/*! ./_validate-collection */"./node_modules/core-js/library/modules/_validate-collection.js"),m=p?"_s":"size",g=function(e,t){var i,r=d(t);if("F"!==r)return e._i[r];for(i=e._f;i;i=i.n)if(i.k==t)return i};e.exports={getConstructor:function(e,t,i,u){var c=e((function(e,r){s(e,c,t,"_i"),e._t=t,e._i=n(null),e._f=void 0,e._l=void 0,e[m]=0,null!=r&&l(r,i,e[u],e)}));return o(c.prototype,{clear:function(){for(var e=f(this,t),i=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete i[r.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var i=f(this,t),r=g(i,e);if(r){var n=r.n,o=r.p;delete i._i[r.i],r.r=!0,o&&(o.n=n),n&&(n.p=o),i._f==r&&(i._f=n),i._l==r&&(i._l=o),i[m]--}return!!r},forEach:function(e){f(this,t);for(var i,r=a(e,arguments.length>1?arguments[1]:void 0,3);i=i?i.n:this._f;)for(r(i.v,i.k,this);i&&i.r;)i=i.p},has:function(e){return!!g(f(this,t),e)}}),p&&r(c.prototype,"size",{get:function(){return f(this,t)[m]}}),c},def:function(e,t,i){var r,n,o=g(e,t);return o?o.v=i:(e._l=o={i:n=d(t,!0),k:t,v:i,p:r=e._l,n:void 0,r:!1},e._f||(e._f=o),r&&(r.n=o),e[m]++,"F"!==n&&(e._i[n]=o)),e},getEntry:g,setStrong:function(e,t,i){u(e,t,(function(e,i){this._t=f(e,t),this._k=i,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?c(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,c(1))}),i?"entries":"values",!i,!0),h(t)}}},"./node_modules/core-js/library/modules/_collection-to-json.js":
/*!*********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_collection-to-json.js ***!
  \*********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_classof */"./node_modules/core-js/library/modules/_classof.js"),n=i(/*! ./_array-from-iterable */"./node_modules/core-js/library/modules/_array-from-iterable.js");e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return n(this)}}},"./node_modules/core-js/library/modules/_collection.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_collection.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=i(/*! ./_global */"./node_modules/core-js/library/modules/_global.js"),n=i(/*! ./_export */"./node_modules/core-js/library/modules/_export.js"),o=i(/*! ./_meta */"./node_modules/core-js/library/modules/_meta.js"),a=i(/*! ./_fails */"./node_modules/core-js/library/modules/_fails.js"),s=i(/*! ./_hide */"./node_modules/core-js/library/modules/_hide.js"),l=i(/*! ./_redefine-all */"./node_modules/core-js/library/modules/_redefine-all.js"),u=i(/*! ./_for-of */"./node_modules/core-js/library/modules/_for-of.js"),c=i(/*! ./_an-instance */"./node_modules/core-js/library/modules/_an-instance.js"),h=i(/*! ./_is-object */"./node_modules/core-js/library/modules/_is-object.js"),p=i(/*! ./_set-to-string-tag */"./node_modules/core-js/library/modules/_set-to-string-tag.js"),d=i(/*! ./_object-dp */"./node_modules/core-js/library/modules/_object-dp.js").f,f=i(/*! ./_array-methods */"./node_modules/core-js/library/modules/_array-methods.js")(0),m=i(/*! ./_descriptors */"./node_modules/core-js/library/modules/_descriptors.js");e.exports=function(e,t,i,g,v,y){var b=r[e],_=b,x=v?"set":"add",E=_&&_.prototype,w={};return m&&"function"==typeof _&&(y||E.forEach&&!a((function(){(new _).entries().next()})))?(_=t((function(t,i){c(t,_,e,"_c"),t._c=new b,null!=i&&u(i,v,t[x],t)})),f("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(e){var t="add"==e||"set"==e;e in E&&(!y||"clear"!=e)&&s(_.prototype,e,(function(i,r){if(c(this,_,e),!t&&y&&!h(i))return"get"==e&&void 0;var n=this._c[e](0===i?0:i,r);return t?this:n}))})),y||d(_.prototype,"size",{get:function(){return this._c.size}})):(_=g.getConstructor(t,e,v,x),l(_.prototype,i),o.NEED=!0),p(_,e),w[e]=_,n(n.G+n.W+n.F,w),y||g.setStrong(_,e,v),_}},"./node_modules/core-js/library/modules/_core.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_core.js ***!
  \*******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){var i=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=i)},"./node_modules/core-js/library/modules/_ctx.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_ctx.js ***!
  \******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_a-function */"./node_modules/core-js/library/modules/_a-function.js");e.exports=function(e,t,i){if(r(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,r){return e.call(t,i,r)};case 3:return function(i,r,n){return e.call(t,i,r,n)}}return function(){return e.apply(t,arguments)}}},"./node_modules/core-js/library/modules/_defined.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_defined.js ***!
  \**********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},"./node_modules/core-js/library/modules/_descriptors.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_descriptors.js ***!
  \**************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports=!i(/*! ./_fails */"./node_modules/core-js/library/modules/_fails.js")((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},"./node_modules/core-js/library/modules/_dom-create.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_dom-create.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_is-object */"./node_modules/core-js/library/modules/_is-object.js"),n=i(/*! ./_global */"./node_modules/core-js/library/modules/_global.js").document,o=r(n)&&r(n.createElement);e.exports=function(e){return o?n.createElement(e):{}}},"./node_modules/core-js/library/modules/_enum-bug-keys.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_enum-bug-keys.js ***!
  \****************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},"./node_modules/core-js/library/modules/_enum-keys.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_enum-keys.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_object-keys */"./node_modules/core-js/library/modules/_object-keys.js"),n=i(/*! ./_object-gops */"./node_modules/core-js/library/modules/_object-gops.js"),o=i(/*! ./_object-pie */"./node_modules/core-js/library/modules/_object-pie.js");e.exports=function(e){var t=r(e),i=n.f;if(i)for(var a,s=i(e),l=o.f,u=0;s.length>u;)l.call(e,a=s[u++])&&t.push(a);return t}},"./node_modules/core-js/library/modules/_export.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_export.js ***!
  \*********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_global */"./node_modules/core-js/library/modules/_global.js"),n=i(/*! ./_core */"./node_modules/core-js/library/modules/_core.js"),o=i(/*! ./_ctx */"./node_modules/core-js/library/modules/_ctx.js"),a=i(/*! ./_hide */"./node_modules/core-js/library/modules/_hide.js"),s=i(/*! ./_has */"./node_modules/core-js/library/modules/_has.js"),l=function(e,t,i){var u,c,h,p=e&l.F,d=e&l.G,f=e&l.S,m=e&l.P,g=e&l.B,v=e&l.W,y=d?n:n[t]||(n[t]={}),b=y.prototype,_=d?r:f?r[t]:(r[t]||{}).prototype;for(u in d&&(i=t),i)(c=!p&&_&&void 0!==_[u])&&s(y,u)||(h=c?_[u]:i[u],y[u]=d&&"function"!=typeof _[u]?i[u]:g&&c?o(h,r):v&&_[u]==h?function(e){var t=function(t,i,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,i)}return new e(t,i,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(h):m&&"function"==typeof h?o(Function.call,h):h,m&&((y.virtual||(y.virtual={}))[u]=h,e&l.R&&b&&!b[u]&&a(b,u,h)))};l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},"./node_modules/core-js/library/modules/_fails.js":
/*!********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_fails.js ***!
  \********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},"./node_modules/core-js/library/modules/_for-of.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_for-of.js ***!
  \*********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_ctx */"./node_modules/core-js/library/modules/_ctx.js"),n=i(/*! ./_iter-call */"./node_modules/core-js/library/modules/_iter-call.js"),o=i(/*! ./_is-array-iter */"./node_modules/core-js/library/modules/_is-array-iter.js"),a=i(/*! ./_an-object */"./node_modules/core-js/library/modules/_an-object.js"),s=i(/*! ./_to-length */"./node_modules/core-js/library/modules/_to-length.js"),l=i(/*! ./core.get-iterator-method */"./node_modules/core-js/library/modules/core.get-iterator-method.js"),u={},c={};(t=e.exports=function(e,t,i,h,p){var d,f,m,g,v=p?function(){return e}:l(e),y=r(i,h,t?2:1),b=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(o(v)){for(d=s(e.length);d>b;b++)if((g=t?y(a(f=e[b])[0],f[1]):y(e[b]))===u||g===c)return g}else for(m=v.call(e);!(f=m.next()).done;)if((g=n(m,y,f.value,t))===u||g===c)return g}).BREAK=u,t.RETURN=c},"./node_modules/core-js/library/modules/_global.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_global.js ***!
  \*********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){var i=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},"./node_modules/core-js/library/modules/_has.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_has.js ***!
  \******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){var i={}.hasOwnProperty;e.exports=function(e,t){return i.call(e,t)}},"./node_modules/core-js/library/modules/_hide.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_hide.js ***!
  \*******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_object-dp */"./node_modules/core-js/library/modules/_object-dp.js"),n=i(/*! ./_property-desc */"./node_modules/core-js/library/modules/_property-desc.js");e.exports=i(/*! ./_descriptors */"./node_modules/core-js/library/modules/_descriptors.js")?function(e,t,i){return r.f(e,t,n(1,i))}:function(e,t,i){return e[t]=i,e}},"./node_modules/core-js/library/modules/_html.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_html.js ***!
  \*******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_global */"./node_modules/core-js/library/modules/_global.js").document;e.exports=r&&r.documentElement},"./node_modules/core-js/library/modules/_ie8-dom-define.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_ie8-dom-define.js ***!
  \*****************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports=!i(/*! ./_descriptors */"./node_modules/core-js/library/modules/_descriptors.js")&&!i(/*! ./_fails */"./node_modules/core-js/library/modules/_fails.js")((function(){return 7!=Object.defineProperty(i(/*! ./_dom-create */"./node_modules/core-js/library/modules/_dom-create.js")("div"),"a",{get:function(){return 7}}).a}))},"./node_modules/core-js/library/modules/_invoke.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_invoke.js ***!
  \*********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=function(e,t,i){var r=void 0===i;switch(t.length){case 0:return r?e():e.call(i);case 1:return r?e(t[0]):e.call(i,t[0]);case 2:return r?e(t[0],t[1]):e.call(i,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(i,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(i,t[0],t[1],t[2],t[3])}return e.apply(i,t)}},"./node_modules/core-js/library/modules/_iobject.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_iobject.js ***!
  \**********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_cof */"./node_modules/core-js/library/modules/_cof.js");e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},"./node_modules/core-js/library/modules/_is-array-iter.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_is-array-iter.js ***!
  \****************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_iterators */"./node_modules/core-js/library/modules/_iterators.js"),n=i(/*! ./_wks */"./node_modules/core-js/library/modules/_wks.js")("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[n]===e)}},"./node_modules/core-js/library/modules/_is-array.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_is-array.js ***!
  \***********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_cof */"./node_modules/core-js/library/modules/_cof.js");e.exports=Array.isArray||function(e){return"Array"==r(e)}},"./node_modules/core-js/library/modules/_is-object.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_is-object.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},"./node_modules/core-js/library/modules/_iter-call.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_iter-call.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_an-object */"./node_modules/core-js/library/modules/_an-object.js");e.exports=function(e,t,i,n){try{return n?t(r(i)[0],i[1]):t(i)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},"./node_modules/core-js/library/modules/_iter-create.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_iter-create.js ***!
  \**************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=i(/*! ./_object-create */"./node_modules/core-js/library/modules/_object-create.js"),n=i(/*! ./_property-desc */"./node_modules/core-js/library/modules/_property-desc.js"),o=i(/*! ./_set-to-string-tag */"./node_modules/core-js/library/modules/_set-to-string-tag.js"),a={};i(/*! ./_hide */"./node_modules/core-js/library/modules/_hide.js")(a,i(/*! ./_wks */"./node_modules/core-js/library/modules/_wks.js")("iterator"),(function(){return this})),e.exports=function(e,t,i){e.prototype=r(a,{next:n(1,i)}),o(e,t+" Iterator")}},"./node_modules/core-js/library/modules/_iter-define.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_iter-define.js ***!
  \**************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=i(/*! ./_library */"./node_modules/core-js/library/modules/_library.js"),n=i(/*! ./_export */"./node_modules/core-js/library/modules/_export.js"),o=i(/*! ./_redefine */"./node_modules/core-js/library/modules/_redefine.js"),a=i(/*! ./_hide */"./node_modules/core-js/library/modules/_hide.js"),s=i(/*! ./_iterators */"./node_modules/core-js/library/modules/_iterators.js"),l=i(/*! ./_iter-create */"./node_modules/core-js/library/modules/_iter-create.js"),u=i(/*! ./_set-to-string-tag */"./node_modules/core-js/library/modules/_set-to-string-tag.js"),c=i(/*! ./_object-gpo */"./node_modules/core-js/library/modules/_object-gpo.js"),h=i(/*! ./_wks */"./node_modules/core-js/library/modules/_wks.js")("iterator"),p=!([].keys&&"next"in[].keys()),d=function(){return this};e.exports=function(e,t,i,f,m,g,v){l(i,t,f);var y,b,_,x=function(e){if(!p&&e in S)return S[e];switch(e){case"keys":case"values":return function(){return new i(this,e)}}return function(){return new i(this,e)}},E=t+" Iterator",w="values"==m,T=!1,S=e.prototype,A=S[h]||S["@@iterator"]||m&&S[m],M=A||x(m),C=m?w?x("entries"):M:void 0,R="Array"==t&&S.entries||A;if(R&&(_=c(R.call(new e)))!==Object.prototype&&_.next&&(u(_,E,!0),r||"function"==typeof _[h]||a(_,h,d)),w&&A&&"values"!==A.name&&(T=!0,M=function(){return A.call(this)}),r&&!v||!p&&!T&&S[h]||a(S,h,M),s[t]=M,s[E]=d,m)if(y={values:w?M:x("values"),keys:g?M:x("keys"),entries:C},v)for(b in y)b in S||o(S,b,y[b]);else n(n.P+n.F*(p||T),t,y);return y}},"./node_modules/core-js/library/modules/_iter-detect.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_iter-detect.js ***!
  \**************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_wks */"./node_modules/core-js/library/modules/_wks.js")("iterator"),n=!1;try{var o=[7][r]();o.return=function(){n=!0},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!n)return!1;var i=!1;try{var o=[7],a=o[r]();a.next=function(){return{done:i=!0}},o[r]=function(){return a},e(o)}catch(e){}return i}},"./node_modules/core-js/library/modules/_iter-step.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_iter-step.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},"./node_modules/core-js/library/modules/_iterators.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_iterators.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports={}},"./node_modules/core-js/library/modules/_library.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_library.js ***!
  \**********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=!0},"./node_modules/core-js/library/modules/_meta.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_meta.js ***!
  \*******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_uid */"./node_modules/core-js/library/modules/_uid.js")("meta"),n=i(/*! ./_is-object */"./node_modules/core-js/library/modules/_is-object.js"),o=i(/*! ./_has */"./node_modules/core-js/library/modules/_has.js"),a=i(/*! ./_object-dp */"./node_modules/core-js/library/modules/_object-dp.js").f,s=0,l=Object.isExtensible||function(){return!0},u=!i(/*! ./_fails */"./node_modules/core-js/library/modules/_fails.js")((function(){return l(Object.preventExtensions({}))})),c=function(e){a(e,r,{value:{i:"O"+ ++s,w:{}}})},h=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!n(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,r)){if(!l(e))return"F";if(!t)return"E";c(e)}return e[r].i},getWeak:function(e,t){if(!o(e,r)){if(!l(e))return!0;if(!t)return!1;c(e)}return e[r].w},onFreeze:function(e){return u&&h.NEED&&l(e)&&!o(e,r)&&c(e),e}}},"./node_modules/core-js/library/modules/_microtask.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_microtask.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_global */"./node_modules/core-js/library/modules/_global.js"),n=i(/*! ./_task */"./node_modules/core-js/library/modules/_task.js").set,o=r.MutationObserver||r.WebKitMutationObserver,a=r.process,s=r.Promise,l="process"==i(/*! ./_cof */"./node_modules/core-js/library/modules/_cof.js")(a);e.exports=function(){var e,t,i,u=function(){var r,n;for(l&&(r=a.domain)&&r.exit();e;){n=e.fn,e=e.next;try{n()}catch(r){throw e?i():t=void 0,r}}t=void 0,r&&r.enter()};if(l)i=function(){a.nextTick(u)};else if(!o||r.navigator&&r.navigator.standalone)if(s&&s.resolve){var c=s.resolve(void 0);i=function(){c.then(u)}}else i=function(){n.call(r,u)};else{var h=!0,p=document.createTextNode("");new o(u).observe(p,{characterData:!0}),i=function(){p.data=h=!h}}return function(r){var n={fn:r,next:void 0};t&&(t.next=n),e||(e=n,i()),t=n}}},"./node_modules/core-js/library/modules/_new-promise-capability.js":
/*!*************************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_new-promise-capability.js ***!
  \*************************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=i(/*! ./_a-function */"./node_modules/core-js/library/modules/_a-function.js");function n(e){var t,i;this.promise=new e((function(e,r){if(void 0!==t||void 0!==i)throw TypeError("Bad Promise constructor");t=e,i=r})),this.resolve=r(t),this.reject=r(i)}e.exports.f=function(e){return new n(e)}},"./node_modules/core-js/library/modules/_object-create.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-create.js ***!
  \****************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_an-object */"./node_modules/core-js/library/modules/_an-object.js"),n=i(/*! ./_object-dps */"./node_modules/core-js/library/modules/_object-dps.js"),o=i(/*! ./_enum-bug-keys */"./node_modules/core-js/library/modules/_enum-bug-keys.js"),a=i(/*! ./_shared-key */"./node_modules/core-js/library/modules/_shared-key.js")("IE_PROTO"),s=function(){},l=function(){var e,t=i(/*! ./_dom-create */"./node_modules/core-js/library/modules/_dom-create.js")("iframe"),r=o.length;for(t.style.display="none",i(/*! ./_html */"./node_modules/core-js/library/modules/_html.js").appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),l=e.F;r--;)delete l.prototype[o[r]];return l()};e.exports=Object.create||function(e,t){var i;return null!==e?(s.prototype=r(e),i=new s,s.prototype=null,i[a]=e):i=l(),void 0===t?i:n(i,t)}},"./node_modules/core-js/library/modules/_object-dp.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-dp.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_an-object */"./node_modules/core-js/library/modules/_an-object.js"),n=i(/*! ./_ie8-dom-define */"./node_modules/core-js/library/modules/_ie8-dom-define.js"),o=i(/*! ./_to-primitive */"./node_modules/core-js/library/modules/_to-primitive.js"),a=Object.defineProperty;t.f=i(/*! ./_descriptors */"./node_modules/core-js/library/modules/_descriptors.js")?Object.defineProperty:function(e,t,i){if(r(e),t=o(t,!0),r(i),n)try{return a(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},"./node_modules/core-js/library/modules/_object-dps.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-dps.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_object-dp */"./node_modules/core-js/library/modules/_object-dp.js"),n=i(/*! ./_an-object */"./node_modules/core-js/library/modules/_an-object.js"),o=i(/*! ./_object-keys */"./node_modules/core-js/library/modules/_object-keys.js");e.exports=i(/*! ./_descriptors */"./node_modules/core-js/library/modules/_descriptors.js")?Object.defineProperties:function(e,t){n(e);for(var i,a=o(t),s=a.length,l=0;s>l;)r.f(e,i=a[l++],t[i]);return e}},"./node_modules/core-js/library/modules/_object-gopd.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-gopd.js ***!
  \**************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_object-pie */"./node_modules/core-js/library/modules/_object-pie.js"),n=i(/*! ./_property-desc */"./node_modules/core-js/library/modules/_property-desc.js"),o=i(/*! ./_to-iobject */"./node_modules/core-js/library/modules/_to-iobject.js"),a=i(/*! ./_to-primitive */"./node_modules/core-js/library/modules/_to-primitive.js"),s=i(/*! ./_has */"./node_modules/core-js/library/modules/_has.js"),l=i(/*! ./_ie8-dom-define */"./node_modules/core-js/library/modules/_ie8-dom-define.js"),u=Object.getOwnPropertyDescriptor;t.f=i(/*! ./_descriptors */"./node_modules/core-js/library/modules/_descriptors.js")?u:function(e,t){if(e=o(e),t=a(t,!0),l)try{return u(e,t)}catch(e){}if(s(e,t))return n(!r.f.call(e,t),e[t])}},"./node_modules/core-js/library/modules/_object-gopn-ext.js":
/*!******************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-gopn-ext.js ***!
  \******************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_to-iobject */"./node_modules/core-js/library/modules/_to-iobject.js"),n=i(/*! ./_object-gopn */"./node_modules/core-js/library/modules/_object-gopn.js").f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return n(e)}catch(e){return a.slice()}}(e):n(r(e))}},"./node_modules/core-js/library/modules/_object-gopn.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-gopn.js ***!
  \**************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_object-keys-internal */"./node_modules/core-js/library/modules/_object-keys-internal.js"),n=i(/*! ./_enum-bug-keys */"./node_modules/core-js/library/modules/_enum-bug-keys.js").concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,n)}},"./node_modules/core-js/library/modules/_object-gops.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-gops.js ***!
  \**************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){t.f=Object.getOwnPropertySymbols},"./node_modules/core-js/library/modules/_object-gpo.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-gpo.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_has */"./node_modules/core-js/library/modules/_has.js"),n=i(/*! ./_to-object */"./node_modules/core-js/library/modules/_to-object.js"),o=i(/*! ./_shared-key */"./node_modules/core-js/library/modules/_shared-key.js")("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=n(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},"./node_modules/core-js/library/modules/_object-keys-internal.js":
/*!***********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-keys-internal.js ***!
  \***********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_has */"./node_modules/core-js/library/modules/_has.js"),n=i(/*! ./_to-iobject */"./node_modules/core-js/library/modules/_to-iobject.js"),o=i(/*! ./_array-includes */"./node_modules/core-js/library/modules/_array-includes.js")(!1),a=i(/*! ./_shared-key */"./node_modules/core-js/library/modules/_shared-key.js")("IE_PROTO");e.exports=function(e,t){var i,s=n(e),l=0,u=[];for(i in s)i!=a&&r(s,i)&&u.push(i);for(;t.length>l;)r(s,i=t[l++])&&(~o(u,i)||u.push(i));return u}},"./node_modules/core-js/library/modules/_object-keys.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-keys.js ***!
  \**************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_object-keys-internal */"./node_modules/core-js/library/modules/_object-keys-internal.js"),n=i(/*! ./_enum-bug-keys */"./node_modules/core-js/library/modules/_enum-bug-keys.js");e.exports=Object.keys||function(e){return r(e,n)}},"./node_modules/core-js/library/modules/_object-pie.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-pie.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){t.f={}.propertyIsEnumerable},"./node_modules/core-js/library/modules/_object-sap.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_object-sap.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_export */"./node_modules/core-js/library/modules/_export.js"),n=i(/*! ./_core */"./node_modules/core-js/library/modules/_core.js"),o=i(/*! ./_fails */"./node_modules/core-js/library/modules/_fails.js");e.exports=function(e,t){var i=(n.Object||{})[e]||Object[e],a={};a[e]=t(i),r(r.S+r.F*o((function(){i(1)})),"Object",a)}},"./node_modules/core-js/library/modules/_perform.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_perform.js ***!
  \**********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},"./node_modules/core-js/library/modules/_promise-resolve.js":
/*!******************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_promise-resolve.js ***!
  \******************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_an-object */"./node_modules/core-js/library/modules/_an-object.js"),n=i(/*! ./_is-object */"./node_modules/core-js/library/modules/_is-object.js"),o=i(/*! ./_new-promise-capability */"./node_modules/core-js/library/modules/_new-promise-capability.js");e.exports=function(e,t){if(r(e),n(t)&&t.constructor===e)return t;var i=o.f(e);return(0,i.resolve)(t),i.promise}},"./node_modules/core-js/library/modules/_property-desc.js":
/*!****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_property-desc.js ***!
  \****************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},"./node_modules/core-js/library/modules/_redefine-all.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_redefine-all.js ***!
  \***************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_hide */"./node_modules/core-js/library/modules/_hide.js");e.exports=function(e,t,i){for(var n in t)i&&e[n]?e[n]=t[n]:r(e,n,t[n]);return e}},"./node_modules/core-js/library/modules/_redefine.js":
/*!***********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_redefine.js ***!
  \***********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports=i(/*! ./_hide */"./node_modules/core-js/library/modules/_hide.js")},"./node_modules/core-js/library/modules/_set-collection-from.js":
/*!**********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_set-collection-from.js ***!
  \**********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=i(/*! ./_export */"./node_modules/core-js/library/modules/_export.js"),n=i(/*! ./_a-function */"./node_modules/core-js/library/modules/_a-function.js"),o=i(/*! ./_ctx */"./node_modules/core-js/library/modules/_ctx.js"),a=i(/*! ./_for-of */"./node_modules/core-js/library/modules/_for-of.js");e.exports=function(e){r(r.S,e,{from:function(e){var t,i,r,s,l=arguments[1];return n(this),(t=void 0!==l)&&n(l),null==e?new this:(i=[],t?(r=0,s=o(l,arguments[2],2),a(e,!1,(function(e){i.push(s(e,r++))}))):a(e,!1,i.push,i),new this(i))}})}},"./node_modules/core-js/library/modules/_set-collection-of.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_set-collection-of.js ***!
  \********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=i(/*! ./_export */"./node_modules/core-js/library/modules/_export.js");e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},"./node_modules/core-js/library/modules/_set-proto.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_set-proto.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_is-object */"./node_modules/core-js/library/modules/_is-object.js"),n=i(/*! ./_an-object */"./node_modules/core-js/library/modules/_an-object.js"),o=function(e,t){if(n(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=i(/*! ./_ctx */"./node_modules/core-js/library/modules/_ctx.js")(Function.call,i(/*! ./_object-gopd */"./node_modules/core-js/library/modules/_object-gopd.js").f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,i){return o(e,i),t?e.__proto__=i:r(e,i),e}}({},!1):void 0),check:o}},"./node_modules/core-js/library/modules/_set-species.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_set-species.js ***!
  \**************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=i(/*! ./_global */"./node_modules/core-js/library/modules/_global.js"),n=i(/*! ./_core */"./node_modules/core-js/library/modules/_core.js"),o=i(/*! ./_object-dp */"./node_modules/core-js/library/modules/_object-dp.js"),a=i(/*! ./_descriptors */"./node_modules/core-js/library/modules/_descriptors.js"),s=i(/*! ./_wks */"./node_modules/core-js/library/modules/_wks.js")("species");e.exports=function(e){var t="function"==typeof n[e]?n[e]:r[e];a&&t&&!t[s]&&o.f(t,s,{configurable:!0,get:function(){return this}})}},"./node_modules/core-js/library/modules/_set-to-string-tag.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_set-to-string-tag.js ***!
  \********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_object-dp */"./node_modules/core-js/library/modules/_object-dp.js").f,n=i(/*! ./_has */"./node_modules/core-js/library/modules/_has.js"),o=i(/*! ./_wks */"./node_modules/core-js/library/modules/_wks.js")("toStringTag");e.exports=function(e,t,i){e&&!n(e=i?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},"./node_modules/core-js/library/modules/_shared-key.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_shared-key.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_shared */"./node_modules/core-js/library/modules/_shared.js")("keys"),n=i(/*! ./_uid */"./node_modules/core-js/library/modules/_uid.js");e.exports=function(e){return r[e]||(r[e]=n(e))}},"./node_modules/core-js/library/modules/_shared.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_shared.js ***!
  \*********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_core */"./node_modules/core-js/library/modules/_core.js"),n=i(/*! ./_global */"./node_modules/core-js/library/modules/_global.js"),o=n["__core-js_shared__"]||(n["__core-js_shared__"]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:i(/*! ./_library */"./node_modules/core-js/library/modules/_library.js")?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},"./node_modules/core-js/library/modules/_species-constructor.js":
/*!**********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_species-constructor.js ***!
  \**********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_an-object */"./node_modules/core-js/library/modules/_an-object.js"),n=i(/*! ./_a-function */"./node_modules/core-js/library/modules/_a-function.js"),o=i(/*! ./_wks */"./node_modules/core-js/library/modules/_wks.js")("species");e.exports=function(e,t){var i,a=r(e).constructor;return void 0===a||null==(i=r(a)[o])?t:n(i)}},"./node_modules/core-js/library/modules/_string-at.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_string-at.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_to-integer */"./node_modules/core-js/library/modules/_to-integer.js"),n=i(/*! ./_defined */"./node_modules/core-js/library/modules/_defined.js");e.exports=function(e){return function(t,i){var o,a,s=String(n(t)),l=r(i),u=s.length;return l<0||l>=u?e?"":void 0:(o=s.charCodeAt(l))<55296||o>56319||l+1===u||(a=s.charCodeAt(l+1))<56320||a>57343?e?s.charAt(l):o:e?s.slice(l,l+2):a-56320+(o-55296<<10)+65536}}},"./node_modules/core-js/library/modules/_task.js":
/*!*******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_task.js ***!
  \*******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,n,o,a=i(/*! ./_ctx */"./node_modules/core-js/library/modules/_ctx.js"),s=i(/*! ./_invoke */"./node_modules/core-js/library/modules/_invoke.js"),l=i(/*! ./_html */"./node_modules/core-js/library/modules/_html.js"),u=i(/*! ./_dom-create */"./node_modules/core-js/library/modules/_dom-create.js"),c=i(/*! ./_global */"./node_modules/core-js/library/modules/_global.js"),h=c.process,p=c.setImmediate,d=c.clearImmediate,f=c.MessageChannel,m=c.Dispatch,g=0,v={},y=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},b=function(e){y.call(e.data)};p&&d||(p=function(e){for(var t=[],i=1;arguments.length>i;)t.push(arguments[i++]);return v[++g]=function(){s("function"==typeof e?e:Function(e),t)},r(g),g},d=function(e){delete v[e]},"process"==i(/*! ./_cof */"./node_modules/core-js/library/modules/_cof.js")(h)?r=function(e){h.nextTick(a(y,e,1))}:m&&m.now?r=function(e){m.now(a(y,e,1))}:f?(o=(n=new f).port2,n.port1.onmessage=b,r=a(o.postMessage,o,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(r=function(e){c.postMessage(e+"","*")},c.addEventListener("message",b,!1)):r="onreadystatechange"in u("script")?function(e){l.appendChild(u("script")).onreadystatechange=function(){l.removeChild(this),y.call(e)}}:function(e){setTimeout(a(y,e,1),0)}),e.exports={set:p,clear:d}},"./node_modules/core-js/library/modules/_to-absolute-index.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_to-absolute-index.js ***!
  \********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_to-integer */"./node_modules/core-js/library/modules/_to-integer.js"),n=Math.max,o=Math.min;e.exports=function(e,t){return(e=r(e))<0?n(e+t,0):o(e,t)}},"./node_modules/core-js/library/modules/_to-integer.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_to-integer.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){var i=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:i)(e)}},"./node_modules/core-js/library/modules/_to-iobject.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_to-iobject.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_iobject */"./node_modules/core-js/library/modules/_iobject.js"),n=i(/*! ./_defined */"./node_modules/core-js/library/modules/_defined.js");e.exports=function(e){return r(n(e))}},"./node_modules/core-js/library/modules/_to-length.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_to-length.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_to-integer */"./node_modules/core-js/library/modules/_to-integer.js"),n=Math.min;e.exports=function(e){return e>0?n(r(e),9007199254740991):0}},"./node_modules/core-js/library/modules/_to-object.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_to-object.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_defined */"./node_modules/core-js/library/modules/_defined.js");e.exports=function(e){return Object(r(e))}},"./node_modules/core-js/library/modules/_to-primitive.js":
/*!***************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_to-primitive.js ***!
  \***************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_is-object */"./node_modules/core-js/library/modules/_is-object.js");e.exports=function(e,t){if(!r(e))return e;var i,n;if(t&&"function"==typeof(i=e.toString)&&!r(n=i.call(e)))return n;if("function"==typeof(i=e.valueOf)&&!r(n=i.call(e)))return n;if(!t&&"function"==typeof(i=e.toString)&&!r(n=i.call(e)))return n;throw TypeError("Can't convert object to primitive value")}},"./node_modules/core-js/library/modules/_uid.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_uid.js ***!
  \******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){var i=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++i+r).toString(36))}},"./node_modules/core-js/library/modules/_user-agent.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_user-agent.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_global */"./node_modules/core-js/library/modules/_global.js").navigator;e.exports=r&&r.userAgent||""},"./node_modules/core-js/library/modules/_validate-collection.js":
/*!**********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_validate-collection.js ***!
  \**********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_is-object */"./node_modules/core-js/library/modules/_is-object.js");e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},"./node_modules/core-js/library/modules/_wks-define.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/_wks-define.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_global */"./node_modules/core-js/library/modules/_global.js"),n=i(/*! ./_core */"./node_modules/core-js/library/modules/_core.js"),o=i(/*! ./_library */"./node_modules/core-js/library/modules/_library.js"),a=i(/*! ./_wks-ext */"./node_modules/core-js/library/modules/_wks-ext.js"),s=i(/*! ./_object-dp */"./node_modules/core-js/library/modules/_object-dp.js").f;e.exports=function(e){var t=n.Symbol||(n.Symbol=o?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},"./node_modules/core-js/library/modules/_wks-ext.js":
/*!**********************************************************!*\
  !*** ./node_modules/core-js/library/modules/_wks-ext.js ***!
  \**********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){t.f=i(/*! ./_wks */"./node_modules/core-js/library/modules/_wks.js")},"./node_modules/core-js/library/modules/_wks.js":
/*!******************************************************!*\
  !*** ./node_modules/core-js/library/modules/_wks.js ***!
  \******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_shared */"./node_modules/core-js/library/modules/_shared.js")("wks"),n=i(/*! ./_uid */"./node_modules/core-js/library/modules/_uid.js"),o=i(/*! ./_global */"./node_modules/core-js/library/modules/_global.js").Symbol,a="function"==typeof o;(e.exports=function(e){return r[e]||(r[e]=a&&o[e]||(a?o:n)("Symbol."+e))}).store=r},"./node_modules/core-js/library/modules/core.get-iterator-method.js":
/*!**************************************************************************!*\
  !*** ./node_modules/core-js/library/modules/core.get-iterator-method.js ***!
  \**************************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_classof */"./node_modules/core-js/library/modules/_classof.js"),n=i(/*! ./_wks */"./node_modules/core-js/library/modules/_wks.js")("iterator"),o=i(/*! ./_iterators */"./node_modules/core-js/library/modules/_iterators.js");e.exports=i(/*! ./_core */"./node_modules/core-js/library/modules/_core.js").getIteratorMethod=function(e){if(null!=e)return e[n]||e["@@iterator"]||o[r(e)]}},"./node_modules/core-js/library/modules/es6.array.iterator.js":
/*!********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.array.iterator.js ***!
  \********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=i(/*! ./_add-to-unscopables */"./node_modules/core-js/library/modules/_add-to-unscopables.js"),n=i(/*! ./_iter-step */"./node_modules/core-js/library/modules/_iter-step.js"),o=i(/*! ./_iterators */"./node_modules/core-js/library/modules/_iterators.js"),a=i(/*! ./_to-iobject */"./node_modules/core-js/library/modules/_to-iobject.js");e.exports=i(/*! ./_iter-define */"./node_modules/core-js/library/modules/_iter-define.js")(Array,"Array",(function(e,t){this._t=a(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,n(1)):n(0,"keys"==t?i:"values"==t?e[i]:[i,e[i]])}),"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},"./node_modules/core-js/library/modules/es6.map.js":
/*!*********************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.map.js ***!
  \*********************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=i(/*! ./_collection-strong */"./node_modules/core-js/library/modules/_collection-strong.js"),n=i(/*! ./_validate-collection */"./node_modules/core-js/library/modules/_validate-collection.js");e.exports=i(/*! ./_collection */"./node_modules/core-js/library/modules/_collection.js")("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=r.getEntry(n(this,"Map"),e);return t&&t.v},set:function(e,t){return r.def(n(this,"Map"),0===e?0:e,t)}},r,!0)},"./node_modules/core-js/library/modules/es6.object.create.js":
/*!*******************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.object.create.js ***!
  \*******************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_export */"./node_modules/core-js/library/modules/_export.js");r(r.S,"Object",{create:i(/*! ./_object-create */"./node_modules/core-js/library/modules/_object-create.js")})},"./node_modules/core-js/library/modules/es6.object.keys.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.object.keys.js ***!
  \*****************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_to-object */"./node_modules/core-js/library/modules/_to-object.js"),n=i(/*! ./_object-keys */"./node_modules/core-js/library/modules/_object-keys.js");i(/*! ./_object-sap */"./node_modules/core-js/library/modules/_object-sap.js")("keys",(function(){return function(e){return n(r(e))}}))},"./node_modules/core-js/library/modules/es6.object.set-prototype-of.js":
/*!*****************************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.object.set-prototype-of.js ***!
  \*****************************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_export */"./node_modules/core-js/library/modules/_export.js");r(r.S,"Object",{setPrototypeOf:i(/*! ./_set-proto */"./node_modules/core-js/library/modules/_set-proto.js").set})},"./node_modules/core-js/library/modules/es6.object.to-string.js":
/*!**********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.object.to-string.js ***!
  \**********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){},"./node_modules/core-js/library/modules/es6.promise.js":
/*!*************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.promise.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r,n,o,a,s=i(/*! ./_library */"./node_modules/core-js/library/modules/_library.js"),l=i(/*! ./_global */"./node_modules/core-js/library/modules/_global.js"),u=i(/*! ./_ctx */"./node_modules/core-js/library/modules/_ctx.js"),c=i(/*! ./_classof */"./node_modules/core-js/library/modules/_classof.js"),h=i(/*! ./_export */"./node_modules/core-js/library/modules/_export.js"),p=i(/*! ./_is-object */"./node_modules/core-js/library/modules/_is-object.js"),d=i(/*! ./_a-function */"./node_modules/core-js/library/modules/_a-function.js"),f=i(/*! ./_an-instance */"./node_modules/core-js/library/modules/_an-instance.js"),m=i(/*! ./_for-of */"./node_modules/core-js/library/modules/_for-of.js"),g=i(/*! ./_species-constructor */"./node_modules/core-js/library/modules/_species-constructor.js"),v=i(/*! ./_task */"./node_modules/core-js/library/modules/_task.js").set,y=i(/*! ./_microtask */"./node_modules/core-js/library/modules/_microtask.js")(),b=i(/*! ./_new-promise-capability */"./node_modules/core-js/library/modules/_new-promise-capability.js"),_=i(/*! ./_perform */"./node_modules/core-js/library/modules/_perform.js"),x=i(/*! ./_user-agent */"./node_modules/core-js/library/modules/_user-agent.js"),E=i(/*! ./_promise-resolve */"./node_modules/core-js/library/modules/_promise-resolve.js"),w=l.TypeError,T=l.process,S=T&&T.versions,A=S&&S.v8||"",M=l.Promise,C="process"==c(T),R=function(){},D=n=b.f,P=!!function(){try{var e=M.resolve(1),t=(e.constructor={})[i(/*! ./_wks */"./node_modules/core-js/library/modules/_wks.js")("species")]=function(e){e(R,R)};return(C||"function"==typeof PromiseRejectionEvent)&&e.then(R)instanceof t&&0!==A.indexOf("6.6")&&-1===x.indexOf("Chrome/66")}catch(e){}}(),j=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},F=function(e,t){if(!e._n){e._n=!0;var i=e._c;y((function(){for(var r=e._v,n=1==e._s,o=0,a=function(t){var i,o,a,s=n?t.ok:t.fail,l=t.resolve,u=t.reject,c=t.domain;try{s?(n||(2==e._h&&L(e),e._h=1),!0===s?i=r:(c&&c.enter(),i=s(r),c&&(c.exit(),a=!0)),i===t.promise?u(w("Promise-chain cycle")):(o=j(i))?o.call(i,l,u):l(i)):u(r)}catch(e){c&&!a&&c.exit(),u(e)}};i.length>o;)a(i[o++]);e._c=[],e._n=!1,t&&!e._h&&O(e)}))}},O=function(e){v.call(l,(function(){var t,i,r,n=e._v,o=k(e);if(o&&(t=_((function(){C?T.emit("unhandledRejection",n,e):(i=l.onunhandledrejection)?i({promise:e,reason:n}):(r=l.console)&&r.error&&r.error("Unhandled promise rejection",n)})),e._h=C||k(e)?2:1),e._a=void 0,o&&t.e)throw t.v}))},k=function(e){return 1!==e._h&&0===(e._a||e._c).length},L=function(e){v.call(l,(function(){var t;C?T.emit("rejectionHandled",e):(t=l.onrejectionhandled)&&t({promise:e,reason:e._v})}))},B=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),F(t,!0))},H=function(e){var t,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===e)throw w("Promise can't be resolved itself");(t=j(e))?y((function(){var r={_w:i,_d:!1};try{t.call(e,u(H,r,1),u(B,r,1))}catch(e){B.call(r,e)}})):(i._v=e,i._s=1,F(i,!1))}catch(e){B.call({_w:i,_d:!1},e)}}};P||(M=function(e){f(this,M,"Promise","_h"),d(e),r.call(this);try{e(u(H,this,1),u(B,this,1))}catch(e){B.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=i(/*! ./_redefine-all */"./node_modules/core-js/library/modules/_redefine-all.js")(M.prototype,{then:function(e,t){var i=D(g(this,M));return i.ok="function"!=typeof e||e,i.fail="function"==typeof t&&t,i.domain=C?T.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&F(this,!1),i.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new r;this.promise=e,this.resolve=u(H,e,1),this.reject=u(B,e,1)},b.f=D=function(e){return e===M||e===a?new o(e):n(e)}),h(h.G+h.W+h.F*!P,{Promise:M}),i(/*! ./_set-to-string-tag */"./node_modules/core-js/library/modules/_set-to-string-tag.js")(M,"Promise"),i(/*! ./_set-species */"./node_modules/core-js/library/modules/_set-species.js")("Promise"),a=i(/*! ./_core */"./node_modules/core-js/library/modules/_core.js").Promise,h(h.S+h.F*!P,"Promise",{reject:function(e){var t=D(this);return(0,t.reject)(e),t.promise}}),h(h.S+h.F*(s||!P),"Promise",{resolve:function(e){return E(s&&this===a?M:this,e)}}),h(h.S+h.F*!(P&&i(/*! ./_iter-detect */"./node_modules/core-js/library/modules/_iter-detect.js")((function(e){M.all(e).catch(R)}))),"Promise",{all:function(e){var t=this,i=D(t),r=i.resolve,n=i.reject,o=_((function(){var i=[],o=0,a=1;m(e,!1,(function(e){var s=o++,l=!1;i.push(void 0),a++,t.resolve(e).then((function(e){l||(l=!0,i[s]=e,--a||r(i))}),n)})),--a||r(i)}));return o.e&&n(o.v),i.promise},race:function(e){var t=this,i=D(t),r=i.reject,n=_((function(){m(e,!1,(function(e){t.resolve(e).then(i.resolve,r)}))}));return n.e&&r(n.v),i.promise}})},"./node_modules/core-js/library/modules/es6.string.iterator.js":
/*!*********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.string.iterator.js ***!
  \*********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=i(/*! ./_string-at */"./node_modules/core-js/library/modules/_string-at.js")(!0);i(/*! ./_iter-define */"./node_modules/core-js/library/modules/_iter-define.js")(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,i=this._i;return i>=t.length?{value:void 0,done:!0}:(e=r(t,i),this._i+=e.length,{value:e,done:!1})}))},"./node_modules/core-js/library/modules/es6.symbol.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es6.symbol.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=i(/*! ./_global */"./node_modules/core-js/library/modules/_global.js"),n=i(/*! ./_has */"./node_modules/core-js/library/modules/_has.js"),o=i(/*! ./_descriptors */"./node_modules/core-js/library/modules/_descriptors.js"),a=i(/*! ./_export */"./node_modules/core-js/library/modules/_export.js"),s=i(/*! ./_redefine */"./node_modules/core-js/library/modules/_redefine.js"),l=i(/*! ./_meta */"./node_modules/core-js/library/modules/_meta.js").KEY,u=i(/*! ./_fails */"./node_modules/core-js/library/modules/_fails.js"),c=i(/*! ./_shared */"./node_modules/core-js/library/modules/_shared.js"),h=i(/*! ./_set-to-string-tag */"./node_modules/core-js/library/modules/_set-to-string-tag.js"),p=i(/*! ./_uid */"./node_modules/core-js/library/modules/_uid.js"),d=i(/*! ./_wks */"./node_modules/core-js/library/modules/_wks.js"),f=i(/*! ./_wks-ext */"./node_modules/core-js/library/modules/_wks-ext.js"),m=i(/*! ./_wks-define */"./node_modules/core-js/library/modules/_wks-define.js"),g=i(/*! ./_enum-keys */"./node_modules/core-js/library/modules/_enum-keys.js"),v=i(/*! ./_is-array */"./node_modules/core-js/library/modules/_is-array.js"),y=i(/*! ./_an-object */"./node_modules/core-js/library/modules/_an-object.js"),b=i(/*! ./_is-object */"./node_modules/core-js/library/modules/_is-object.js"),_=i(/*! ./_to-object */"./node_modules/core-js/library/modules/_to-object.js"),x=i(/*! ./_to-iobject */"./node_modules/core-js/library/modules/_to-iobject.js"),E=i(/*! ./_to-primitive */"./node_modules/core-js/library/modules/_to-primitive.js"),w=i(/*! ./_property-desc */"./node_modules/core-js/library/modules/_property-desc.js"),T=i(/*! ./_object-create */"./node_modules/core-js/library/modules/_object-create.js"),S=i(/*! ./_object-gopn-ext */"./node_modules/core-js/library/modules/_object-gopn-ext.js"),A=i(/*! ./_object-gopd */"./node_modules/core-js/library/modules/_object-gopd.js"),M=i(/*! ./_object-gops */"./node_modules/core-js/library/modules/_object-gops.js"),C=i(/*! ./_object-dp */"./node_modules/core-js/library/modules/_object-dp.js"),R=i(/*! ./_object-keys */"./node_modules/core-js/library/modules/_object-keys.js"),D=A.f,P=C.f,j=S.f,F=r.Symbol,O=r.JSON,k=O&&O.stringify,L=d("_hidden"),B=d("toPrimitive"),H={}.propertyIsEnumerable,I=c("symbol-registry"),N=c("symbols"),U=c("op-symbols"),V=Object.prototype,z="function"==typeof F&&!!M.f,q=r.QObject,W=!q||!q.prototype||!q.prototype.findChild,G=o&&u((function(){return 7!=T(P({},"a",{get:function(){return P(this,"a",{value:7}).a}})).a}))?function(e,t,i){var r=D(V,t);r&&delete V[t],P(e,t,i),r&&e!==V&&P(V,t,r)}:P,X=function(e){var t=N[e]=T(F.prototype);return t._k=e,t},Y=z&&"symbol"==typeof F.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof F},J=function(e,t,i){return e===V&&J(U,t,i),y(e),t=E(t,!0),y(i),n(N,t)?(i.enumerable?(n(e,L)&&e[L][t]&&(e[L][t]=!1),i=T(i,{enumerable:w(0,!1)})):(n(e,L)||P(e,L,w(1,{})),e[L][t]=!0),G(e,t,i)):P(e,t,i)},Q=function(e,t){y(e);for(var i,r=g(t=x(t)),n=0,o=r.length;o>n;)J(e,i=r[n++],t[i]);return e},Z=function(e){var t=H.call(this,e=E(e,!0));return!(this===V&&n(N,e)&&!n(U,e))&&(!(t||!n(this,e)||!n(N,e)||n(this,L)&&this[L][e])||t)},K=function(e,t){if(e=x(e),t=E(t,!0),e!==V||!n(N,t)||n(U,t)){var i=D(e,t);return!i||!n(N,t)||n(e,L)&&e[L][t]||(i.enumerable=!0),i}},$=function(e){for(var t,i=j(x(e)),r=[],o=0;i.length>o;)n(N,t=i[o++])||t==L||t==l||r.push(t);return r},ee=function(e){for(var t,i=e===V,r=j(i?U:x(e)),o=[],a=0;r.length>a;)!n(N,t=r[a++])||i&&!n(V,t)||o.push(N[t]);return o};z||(s((F=function(){if(this instanceof F)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function(i){this===V&&t.call(U,i),n(this,L)&&n(this[L],e)&&(this[L][e]=!1),G(this,e,w(1,i))};return o&&W&&G(V,e,{configurable:!0,set:t}),X(e)}).prototype,"toString",(function(){return this._k})),A.f=K,C.f=J,i(/*! ./_object-gopn */"./node_modules/core-js/library/modules/_object-gopn.js").f=S.f=$,i(/*! ./_object-pie */"./node_modules/core-js/library/modules/_object-pie.js").f=Z,M.f=ee,o&&!i(/*! ./_library */"./node_modules/core-js/library/modules/_library.js")&&s(V,"propertyIsEnumerable",Z,!0),f.f=function(e){return X(d(e))}),a(a.G+a.W+a.F*!z,{Symbol:F});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ie=0;te.length>ie;)d(te[ie++]);for(var re=R(d.store),ne=0;re.length>ne;)m(re[ne++]);a(a.S+a.F*!z,"Symbol",{for:function(e){return n(I,e+="")?I[e]:I[e]=F(e)},keyFor:function(e){if(!Y(e))throw TypeError(e+" is not a symbol!");for(var t in I)if(I[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),a(a.S+a.F*!z,"Object",{create:function(e,t){return void 0===t?T(e):Q(T(e),t)},defineProperty:J,defineProperties:Q,getOwnPropertyDescriptor:K,getOwnPropertyNames:$,getOwnPropertySymbols:ee});var oe=u((function(){M.f(1)}));a(a.S+a.F*oe,"Object",{getOwnPropertySymbols:function(e){return M.f(_(e))}}),O&&a(a.S+a.F*(!z||u((function(){var e=F();return"[null]"!=k([e])||"{}"!=k({a:e})||"{}"!=k(Object(e))}))),"JSON",{stringify:function(e){for(var t,i,r=[e],n=1;arguments.length>n;)r.push(arguments[n++]);if(i=t=r[1],(b(t)||void 0!==e)&&!Y(e))return v(t)||(t=function(e,t){if("function"==typeof i&&(t=i.call(this,e,t)),!Y(t))return t}),r[1]=t,k.apply(O,r)}}),F.prototype[B]||i(/*! ./_hide */"./node_modules/core-js/library/modules/_hide.js")(F.prototype,B,F.prototype.valueOf),h(F,"Symbol"),h(Math,"Math",!0),h(r.JSON,"JSON",!0)},"./node_modules/core-js/library/modules/es7.map.from.js":
/*!**************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.map.from.js ***!
  \**************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){i(/*! ./_set-collection-from */"./node_modules/core-js/library/modules/_set-collection-from.js")("Map")},"./node_modules/core-js/library/modules/es7.map.of.js":
/*!************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.map.of.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){i(/*! ./_set-collection-of */"./node_modules/core-js/library/modules/_set-collection-of.js")("Map")},"./node_modules/core-js/library/modules/es7.map.to-json.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.map.to-json.js ***!
  \*****************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./_export */"./node_modules/core-js/library/modules/_export.js");r(r.P+r.R,"Map",{toJSON:i(/*! ./_collection-to-json */"./node_modules/core-js/library/modules/_collection-to-json.js")("Map")})},"./node_modules/core-js/library/modules/es7.promise.finally.js":
/*!*********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.promise.finally.js ***!
  \*********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=i(/*! ./_export */"./node_modules/core-js/library/modules/_export.js"),n=i(/*! ./_core */"./node_modules/core-js/library/modules/_core.js"),o=i(/*! ./_global */"./node_modules/core-js/library/modules/_global.js"),a=i(/*! ./_species-constructor */"./node_modules/core-js/library/modules/_species-constructor.js"),s=i(/*! ./_promise-resolve */"./node_modules/core-js/library/modules/_promise-resolve.js");r(r.P+r.R,"Promise",{finally:function(e){var t=a(this,n.Promise||o.Promise),i="function"==typeof e;return this.then(i?function(i){return s(t,e()).then((function(){return i}))}:e,i?function(i){return s(t,e()).then((function(){throw i}))}:e)}})},"./node_modules/core-js/library/modules/es7.promise.try.js":
/*!*****************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.promise.try.js ***!
  \*****************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=i(/*! ./_export */"./node_modules/core-js/library/modules/_export.js"),n=i(/*! ./_new-promise-capability */"./node_modules/core-js/library/modules/_new-promise-capability.js"),o=i(/*! ./_perform */"./node_modules/core-js/library/modules/_perform.js");r(r.S,"Promise",{try:function(e){var t=n.f(this),i=o(e);return(i.e?t.reject:t.resolve)(i.v),t.promise}})},"./node_modules/core-js/library/modules/es7.symbol.async-iterator.js":
/*!***************************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.symbol.async-iterator.js ***!
  \***************************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){i(/*! ./_wks-define */"./node_modules/core-js/library/modules/_wks-define.js")("asyncIterator")},"./node_modules/core-js/library/modules/es7.symbol.observable.js":
/*!***********************************************************************!*\
  !*** ./node_modules/core-js/library/modules/es7.symbol.observable.js ***!
  \***********************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){i(/*! ./_wks-define */"./node_modules/core-js/library/modules/_wks-define.js")("observable")},"./node_modules/core-js/library/modules/web.dom.iterable.js":
/*!******************************************************************!*\
  !*** ./node_modules/core-js/library/modules/web.dom.iterable.js ***!
  \******************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){i(/*! ./es6.array.iterator */"./node_modules/core-js/library/modules/es6.array.iterator.js");for(var r=i(/*! ./_global */"./node_modules/core-js/library/modules/_global.js"),n=i(/*! ./_hide */"./node_modules/core-js/library/modules/_hide.js"),o=i(/*! ./_iterators */"./node_modules/core-js/library/modules/_iterators.js"),a=i(/*! ./_wks */"./node_modules/core-js/library/modules/_wks.js")("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),l=0;l<s.length;l++){var u=s[l],c=r[u],h=c&&c.prototype;h&&!h[a]&&n(h,a,u),o[u]=o.Array}},"./node_modules/worker-loader/dist/workers/InlineWorker.js":
/*!*****************************************************************!*\
  !*** ./node_modules/worker-loader/dist/workers/InlineWorker.js ***!
  \*****************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var i;try{(i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),i=i.getBlob()}catch(t){i=new Blob([e])}return new Worker(r.createObjectURL(i))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},"./src/main.js":
/*!*********************************!*\
  !*** ./src/main.js + 4 modules ***!
  \*********************************/
/*! no exports provided */
/*! all exports used */
/*! ModuleConcatenation bailout: Cannot concat with ./src/workers/FileLoader.worker.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./src/workers/ImageLoader.worker.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/babel-runtime/core-js/map.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/babel-runtime/core-js/object/keys.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/babel-runtime/core-js/promise.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/babel-runtime/helpers/classCallCheck.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/babel-runtime/helpers/inherits.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/babel-runtime/helpers/possibleConstructorReturn.js (<- Module is not an ECMAScript module) */function(e,t,i){"use strict";i.r(t);var r=i("./node_modules/babel-runtime/helpers/classCallCheck.js"),n=i.n(r),o=i("./node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),a=i.n(o),s=i("./node_modules/babel-runtime/helpers/inherits.js"),l=i.n(s),u=i("./node_modules/babel-runtime/core-js/map.js"),c=i.n(u),h=function(){return("undefined"==typeof performance?Date:performance).now()},p=function(e,t,i){var r,n;(void 0===e&&(e=""),void 0!==t&&(e=t+e),i&&(e=i(e)),e.startsWith("./"))&&(n=(r=window.location.origin+window.location.pathname).indexOf("\\")>=0?r.lastIndexOf("\\"):r.lastIndexOf("/"),e=r.substring(0,n)+"/"+e.substring(2));return e},d=i("./node_modules/babel-runtime/core-js/object/keys.js"),f=i.n(d),m=function(){function e(t,i){var r=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";n()(this,e),this.maxCount=t,this.workers={},this.name=o,this.internval=i||-1,-1!==this.internval&&setInterval((function(){for(var e in r.workers){var t=r.workers[e];t&&(t.busyRefCount||h()-t.time>=r.internval&&(t.terminate(),delete r.workers[e]))}}),Math.max(this.internval,15e3))}return e.prototype.startWorker=function(e){e.time=h(),e.busyRefCount++},e.prototype.finishWorker=function(e){e.time=h(),e.busyRefCount--},e.prototype.tryUseExistingWorker=function(){var e;for(var t in this.workers){var i=this.workers[t];i&&(i.busyRefCount||(e=i))}return e},e.prototype.createWorker=function(e,t){var i=this.tryUseExistingWorker();if(i)return this.startWorker(i),i;var r=f()(this.workers).length;if(r==this.maxCount){var n=Math.round(Math.random()*(this.maxCount-1));return i=this.workers[n],this.startWorker(i),i}return(i=new e).busyRefCount=0,this.startWorker(i),i.onmessage=function(e){t.call(this,e)},this.workers[r]=i,i},e}(),g=i("./src/workers/FileLoader.worker.js"),v=i.n(g),y=i(/*! three */"three"),b=new c.a,_=1,x=new m(2,1e4,"ResourceFileLoader"),E=function(e){function t(i){var r;n()(this,t);var o=a()(this,e.call(this,i));return r=o,a()(o,r)}return l()(t,e),t.prototype.resolveURL=function(e){var t=this;return p(e,this.path,(function(e){return t.manager.resolveURL(e)}))},t.prototype.load=function(e,t,i,r){e=this.resolveURL(e),this.manager.itemStart(e);var n=_++;b.set(n,{url:e,onLoad:t||function(){},onProgress:i||function(){},onError:r||function(){},fileLoader:this}),x.createWorker(v.a,(function(e){var t=e.data,i=b.get(t.id),r=i.url,n=i.fileLoader.manager,o=t.action;"load"==o?(i.onLoad(t.response),n.itemEnd(r),x.finishWorker(this),b.delete(t.id)):"progress"==o?i.onProgress(t.progress):"error"==o?(i.onError(t.error),n.itemError(r),n.itemEnd(r),x.finishWorker(this),b.delete(t.id)):"abort"==o&&(i.onError(t.error),n.itemError(r),n.itemEnd(r),x.finishWorker(this),b.delete(t.id))})).postMessage({id:n,url:e,responseType:this.responseType,withCredentials:this.withCredentials,mimeType:this.mimeType,requestHeader:this.requestHeader})},t}(y.FileLoader),w=(i("./node_modules/babel-runtime/core-js/promise.js"),i("./src/workers/ImageLoader.worker.js")),T=i.n(w),S=i(/*! three */"three"),A=new c.a,M=1,C=new m(2,1e4,"ResourceImageLoader"),R=function(e){function t(i){var r;n()(this,t);var o=a()(this,e.call(this,i));return r=o,a()(o,r)}return l()(t,e),t.prototype.resolveURL=function(e){var t=this;return p(e,this.path,(function(e){return t.manager.resolveURL(e)}))},t.prototype.load=function(e,i,r,n){e=this.resolveURL(e),this.manager.itemStart(e);var o=t.staticImage;if(o)i&&i(o),this.manager.itemEnd(e);else{var a=M++;A.set(a,{url:e,onLoad:i||function(){},onProgress:r||function(){},onError:n||function(){},fileLoader:this}),C.createWorker(T.a,(function(e){var t=e.data,i=A.get(t.id),r=i.url,n=i.fileLoader.manager,o=t.action;if("load"==o){var a=t.id,s=t.blob,l=this,u=new Image;u.onload=function(){i.onLoad(u),n.itemEnd(r),C.finishWorker(l),A.delete(a)},function(e,t){var i=new FileReader;i.onload=function(e){!function(e){u.src=e}(e.target.result)},i.readAsDataURL(e)}(s)}else"error"==o&&(i.onError(t.error),n.itemError(r),n.itemEnd(r),C.finishWorker(this),A.delete(t.id))})).postMessage({id:a,url:e})}},t}(S.ImageLoader);window.THING=window.THING||{},window.THING.Plugins=window.THING.Plugins||{},window.THING.Plugins.THREE=window.THING.Plugins.THREE||{},window.THING.Plugins.THREE.FileLoader=E,window.THING.Plugins.THREE.ImageLoader=R},"./src/workers/FileLoader.worker.js":
/*!******************************************!*\
  !*** ./src/workers/FileLoader.worker.js ***!
  \******************************************/
/*! no static exports found */
/*! exports used: default */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports=function(){return i(/*! !./node_modules/worker-loader/dist/workers/InlineWorker.js */"./node_modules/worker-loader/dist/workers/InlineWorker.js")('!function(e){var r={};function t(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}t.m=e,t.c=r,t.d=function(e,r,o){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)t.d(o,n,function(r){return e[r]}.bind(null,n));return o},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s="./src/workers/FileLoader.worker.js")}({"./src/workers/FileLoader.worker.js":\n/*!******************************************!*\\\n  !*** ./src/workers/FileLoader.worker.js ***!\n  \\******************************************/\n/*! no static exports found */\n/*! all exports used */\n/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,r){self.addEventListener("message",(function(e){var r=e.data,t=r.id,o=r.url,n=new XMLHttpRequest;try{n.open("GET",o,!0)}catch(e){self.postMessage({id:t,url:o,error:`open \'${o}\' failed`,action:"error"})}n.addEventListener("load",(function(e){var r=this.response;200===this.status||0===this.status?self.postMessage({id:t,url:o,response:r,error:null,status:this.status,action:"load"}):self.postMessage({id:t,url:o,error:"",action:"error"})}),!1),n.addEventListener("progress",(function(e){if(e.total){var r=e.loaded/e.total;self.postMessage({id:t,url:o,progress:r,action:"progress"})}}),!1),n.addEventListener("error",(function(e){self.postMessage({id:t,url:o,error:"",action:"error"})}),!1),n.addEventListener("abort",(function(e){self.postMessage({id:t,url:o,error:"",action:"abort"})}),!1);var s=r.responseType;void 0!==s&&(n.responseType=s);var i=r.withCredentials;if(void 0!==i&&(n.withCredentials=i),n.overrideMimeType){var a=r.mimeType;n.overrideMimeType(void 0!==a?a:"text/plain")}var u=r.requestHeader;for(var l in u)n.setRequestHeader(l,u[l]);try{n.send(null)}catch(e){self.postMessage({id:t,url:o,error:`send \'${o}\' failed`,action:"error"})}}),!1)}});',null)}},"./src/workers/ImageLoader.worker.js":
/*!*******************************************!*\
  !*** ./src/workers/ImageLoader.worker.js ***!
  \*******************************************/
/*! no static exports found */
/*! exports used: default */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports=function(){return i(/*! !./node_modules/worker-loader/dist/workers/InlineWorker.js */"./node_modules/worker-loader/dist/workers/InlineWorker.js")('!function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s="./src/workers/ImageLoader.worker.js")}({"./src/workers/ImageLoader.worker.js":\n/*!*******************************************!*\\\n  !*** ./src/workers/ImageLoader.worker.js ***!\n  \\*******************************************/\n/*! no static exports found */\n/*! all exports used */\n/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,r){self.addEventListener("message",(function(e){var r=e.data,t=r.id,n=r.url;fetch(n,{mode:"cors"}).then(e=>e.blob()).then(e=>{self.postMessage({id:t,url:n,blob:e,error:null,action:"load"})})}),!1)}});',null)}},0:
/*!***************************!*\
  !*** multi ./src/main.js ***!
  \***************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports=i(/*! ./src/main.js */"./src/main.js")},three:
/*!************************!*\
  !*** external "THREE" ***!
  \************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=THREE}}),TrailRenderHelper=function(){var e="[TrailRenderHelper.js] : ";this.fTimeLong=0,this.fTimeStart=0,this.iStep=0,this.iCount=0,this.fWidthStart=.5,this.fWidthEnd=.5,this.fWidthOffset=0,this.arrayPosHistory=new Array,this.shaderColor=null,this.shaderTexture=null,this.shaderTexMode=null,this.blending=null,this.transparent=null,this.alphaTest=null,this.depthWrite=null,this.depthTest=null,this.arrayUuid=new Array,this.arrayCfg=new Array,this.bAllStable=!1,this.bStable=!1,this.iMaxArrayPosHistoryNo=0,this.iMaxArrayPosHistoryNo_last=0,this.iCurrentIndex=0,this.iSumArrayPosHistoryCount=0,this.instanceBuffer=null,this.bufferGeometry=null,this.attributesVertices=null,this.material=null,this.mesh=null,this.vertices=null,this.indices=null,this.uvs=null,this.onTriggerMeshInited=null;var t=this,i={vertex:["precision highp float;","uniform sampler2D texture;","uniform vec4 color;","varying vec2 vUv;","varying vec4 varyColor;","void main()","{","\tvaryColor = color;","   vUv = vec2( uv.x, uv.y );","\tvec3 positionEye = ( modelViewMatrix * vec4( position, 1.0 ) ).xyz;","\tgl_Position = projectionMatrix * vec4( positionEye, 1.0 );","}"].join("\n"),fragment:["precision highp float;","uniform sampler2D texture;","varying vec2 vUv;","varying vec4 varyColor;","void main() {","    gl_FragColor = varyColor * texture2D(texture, vUv);","}"].join("\n")};this.init=function(r,n){if(null!=n&&null!=n){if(null==r||null==r||"object"!=typeof r)return console.error(e+"[init] : options == null;"),void n();if(null==r.fTimeLong||null==r.fTimeLong||"number"!=typeof r.fTimeLong)return console.error(e+"[init] : options.fTimeLong == null;"),void n();if(null==r.fTimeStart||null==r.fTimeStart||"number"!=typeof r.fTimeStart)return console.error(e+"[init] : options.fTimeStart == null;"),void n();if(null==r.iStep||null==r.iStep||"number"!=typeof r.iStep)return console.error(e+"[init] : options.iStep == null;"),void n();if(null==r.fWidthStart||null==r.fWidthStart||"number"!=typeof r.fWidthStart)return console.error(e+"[init] : options.fWidthStart == null;"),void n();if(null==r.fWidthEnd||null==r.fWidthEnd||"number"!=typeof r.fWidthEnd)return console.error(e+"[init] : options.fWidthStart == null;"),void n();null!=r.shaderColor&&null!=r.shaderColor&&r.shaderColor instanceof THREE.Vector4?t.shaderColor=new THREE.Vector4(r.shaderColor.x,r.shaderColor.y,r.shaderColor.z,r.shaderColor.w):(console.warn(e+"[init] : options.shaderColor == null; set shader color as default;"),t.shaderColor=new THREE.Vector4(.5,.5,1,1)),null!=r.shaderTexture&&null!=r.shaderTexture&&r.shaderTexture instanceof THREE.Texture?t.shaderTexture=r.shaderTexture:(console.warn(e+"[init] : options.shaderColor == null; set shader texture as default;"),t.shaderTexture=null),null==r.shaderTexMode||null==r.shaderTexMode||"string"!=typeof r.shaderTexMode?(console.warn(e+"[init] : options.shaderTexMode == null; set shader mode as default;"),t.shaderTexMode="Stretch"):t.shaderTexMode="Stretch"==r.shaderTexMode?"Stretch":"Tile",null==r.shaderBlending||null==r.shaderBlending||"number"!=typeof r.shaderBlending?(console.warn(e+"[init] : options.shaderBlending == null; set shader blending as default;"),t.blending=THREE.AdditiveBlending):t.blending=r.shaderBlending,null==r.shaderTransparent||null==r.shaderTransparent||"boolean"!=typeof r.shaderTransparent?(console.warn(e+"[init] : options.shaderTransparent == null; set shader transparent as default;"),t.transparent=!1):t.transparent=r.shaderTransparent,null==r.shaderAlphaTest||null==r.shaderAlphaTest||"number"!=typeof r.shaderAlphaTest?(console.warn(e+"[init] : options.shaderAlphaTest == null; set shader alphaTest as default;"),t.alphaTest=0):t.alphaTest=r.shaderAlphaTest,null==r.shaderDepthWrite||null==r.shaderDepthWrite||"boolean"!=typeof r.shaderDepthWrite?(console.warn(e+"[init] : options.shaderDepthWrite == null; set shader depthWrite as default;"),t.depthWrite=!0):t.depthWrite=r.shaderDepthWrite,null==r.shaderDepthTest||null==r.shaderDepthTest||"boolean"!=typeof r.shaderDepthTest?(console.warn(e+"[init] : options.shaderDepthTest == null; set shader depthTest as default;"),t.depthTest=!0):t.depthTest=r.shaderDepthTest,t.uniforms={texture:{type:"t",value:t.shaderTexture},color:{type:"v4",value:new THREE.Vector4(0,0,0,0)}},t.material=new THREE.ShaderMaterial({uniforms:t.uniforms,vertexShader:i.vertex,fragmentShader:i.fragment,blending:t.blending,transparent:t.transparent,alphaTest:t.alphaTest,depthWrite:t.depthWrite,depthTest:t.depthTest}),t.fTimeLong=r.fTimeLong,t.fTimeStart=r.fTimeStart,t.iStep=r.iStep,t.iCount=0,t.fWidthStart=r.fWidthStart,t.fWidthEnd=r.fWidthEnd,t.fWidthOffset=-t.fWidthStart+t.fWidthEnd,n()}else console.error(e+"[init] : onFinished == null;")},this.attach=function(i){if(null==i||null==i)return console.error(e+"[attach] : onFinished == null;"),null;var r=THREE.Math.generateUUID();t.arrayPosHistory[r]=new Array;return t.arrayCfg[r]={bActived:!0,bStable:!1,iMaxArrayPosHistoryNo_last:0,iMaxArrayPosHistoryNo:0,iStartIndex:0},t.arrayUuid.push(r),i(r),r},this.detach=function(i){null!=i&&null!=i&&"string"==typeof i?(t.arrayUuid.includes(i)&&delete t.arrayUuid[i],t.arrayCfg.includes(i)&&(t.iCurrentIndex-=t.arrayCfg[i].iMaxArrayPosHistoryNo,delete t.arrayCfg[i]),t.arrayPosHistory.includes(i)&&delete t.arrayPosHistory[i]):console.error(e+"[detach] : uuid == null;")},this.dispose=function(){t.instanceBuffer&&t.instanceBuffer.dispose(),t.bufferGeometry&&t.bufferGeometry.dispose(),GlobalsVariables.scene.remove(t.mesh),t.material.dispose(),t.arrayUuid.forEach((function(e){})),t.arrayCfg.forEach((function(e){})),t.arrayPosHistory.forEach((function(e){})),t.arrayUuid=[],t.arrayCfg=[],t.arrayPosHistory=[]},this.setActive=function(i,r,n){if(null!=n&&null!=n){if(null==i||null==i||"string"!=typeof i)return console.error(e+"[setActive] : uuid == null;"),void n(!1);if(!t.arrayUuid.includes(i))return console.error(e+"[setActive] : uuid do not includes;"),void n(!1);if(null==r||null==r||"boolean"!=typeof r)return console.error(e+"[setActive] : bActived == null;"),void n(!1);t.arrayCfg[i].bActived=r,n(!0)}else console.error(e+"[setActive] : onFinished == null;")},this.tick=function(e){if(t.bAllStable)for(var i=t.arrayUuid.length,r=0;r<i;r++)t.arrayCfg[t.arrayUuid[r]].bActived&&t.updateMesh(t.arrayUuid[r]);if(t.arrayCfg[e.uuid].bActived&&(t.arrayPosHistory[e.uuid].push({time:e.timeNow,pos:new THREE.Vector3(e.position.x,e.position.y,e.position.z),rot:new THREE.Vector3(e.rotation.x,e.rotation.y,e.rotation.z)}),t.checkPosHistory(e.uuid,e.timeNow)),!t.bAllStable&&!t.arrayCfg[e.uuid].bStable){i=t.arrayPosHistory[e.uuid].length;t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo<=i&&(t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo_last=t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo,t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo=i,t.arrayCfg[e.uuid].bStable||t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo_last!=t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo||(t.arrayCfg[e.uuid].bStable=!0,t.checkAllPosHistory()))}},this.checkPosHistory=function(e,i){for(var r=t.arrayPosHistory[e].length,n=0;n<r&&i-t.arrayPosHistory[e][n].time>t.fTimeLong;n++)t.arrayPosHistory[e].splice(n,1),r=t.arrayPosHistory[e].length,n--},this.checkAllPosHistory=function(){var e=t.arrayUuid.length,i=!0;t.iSumArrayPosHistoryCount=0;for(var r=0;r<e;r++){if(!t.arrayCfg[t.arrayUuid[r]].bStable)return void(i=!1);t.iSumArrayPosHistoryCount+=t.arrayCfg[t.arrayUuid[r]].iMaxArrayPosHistoryNo}if(i){t.bAllStable=!0;for(r=0;r<e;r++)0==r?1==e?t.initMesh(t.arrayUuid[r],"start|end"):t.initMesh(t.arrayUuid[r],"start"):r+1==e?t.initMesh(t.arrayUuid[r],"end"):t.initMesh(t.arrayUuid[r],"default")}},this.initMesh=function(e,i){if(null!=t.mesh&&GlobalsVariables.scene.remove(t.mesh),null==t.bufferGeometry&&(t.bufferGeometry=new THREE.BufferGeometry),t.arrayCfg[e].iStartIndex=t.iCurrentIndex,i.indexOf("start")>=0){var r=2*t.iSumArrayPosHistoryCount;t.iSumArrayPosHistoryCount;t.vertices=new Float32Array(3*r),t.indices=new Uint32Array(2*(t.iSumArrayPosHistoryCount-t.arrayCfg.length)*2*3),t.uvs=new Float32Array(2*r)}for(var n=new THREE.Quaternion,o=t.arrayCfg[e].iStartIndex,a=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;o<a;o++){var s=t.fWidthEnd+(o-t.arrayCfg[e].iStartIndex)/t.arrayCfg[e].iMaxArrayPosHistoryNo*t.fWidthOffset,l=t.arrayPosHistory[e][o-t.arrayCfg[e].iStartIndex].pos.clone(),u=l.clone(),c=t.arrayPosHistory[e][o-t.arrayCfg[e].iStartIndex].rot.clone();c=c.normalize(),n.setFromEuler(new THREE.Euler(c.x,c.y,c.z));var h=new THREE.Vector3(s,0,0);h.applyQuaternion(n);var p=a-1-o,d=l.add(h);t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+0]=d.x,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+1]=d.y,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+2]=d.z;var f=u.sub(h);t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+3]=f.x,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+4]=f.y,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+5]=f.z}var m=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo-1;for(o=t.arrayCfg[e].iStartIndex;o<m;o++)t.indices[12*o+0]=2*o+0,t.indices[12*o+1]=2*o+1,t.indices[12*o+2]=2*o+2,t.indices[12*o+3]=2*o+2,t.indices[12*o+4]=2*o+1,t.indices[12*o+5]=2*o+3,t.indices[12*o+6]=2*o+0,t.indices[12*o+7]=2*o+2,t.indices[12*o+8]=2*o+1,t.indices[12*o+9]=2*o+2,t.indices[12*o+10]=2*o+3,t.indices[12*o+11]=2*o+1;var g=1/t.arrayCfg[e].iMaxArrayPosHistoryNo;if("Stretch"==t.shaderTexMode)for(o=t.arrayCfg[e].iStartIndex,a=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;o<a;o++)t.uvs[4*o+0]=(o-t.arrayCfg[e].iStartIndex)*g,t.uvs[4*o+1]=0,t.uvs[4*o+2]=(o-t.arrayCfg[e].iStartIndex)*g,t.uvs[4*o+3]=1;else for(o=t.arrayCfg[e].iStartIndex,a=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;o<a;o++)t.uvs[4*o+0]=(o-t.arrayCfg[e].iStartIndex)%2,t.uvs[4*o+1]=0,t.uvs[4*o+2]=(o-t.arrayCfg[e].iStartIndex)%2,t.uvs[4*o+3]=1;t.iCurrentIndex+=t.arrayCfg[e].iMaxArrayPosHistoryNo,i.indexOf("end")>=0&&(t.bufferGeometry.addAttribute("position",new THREE.BufferAttribute(t.vertices,3)),t.attributesVertices=this.bufferGeometry.attributes.position.array,t.bufferGeometry.addAttribute("uv",new THREE.BufferAttribute(t.uvs,2)),t.bufferGeometry.setIndex(new THREE.BufferAttribute(t.indices,1)),t.mesh=new THREE.Mesh(t.bufferGeometry,t.material),GlobalsVariables.scene.add(t.mesh),null!=t.onTriggerMeshInited&&null!=t.onTriggerMeshInited&&t.onTriggerMeshInited(t.mesh))},this.updateColor=function(e){null!=t.material&&null!=t.material&&(t.material.uniforms.color.value.x=e.r,t.material.uniforms.color.value.y=e.g,t.material.uniforms.color.value.z=e.b,t.material.uniforms.color.value.w=e.a,t.material.needsUpdate=!0)},this.updateMesh=function(e){for(var i=t.arrayPosHistory[e].length,r=new THREE.Quaternion,n=t.arrayCfg[e].iStartIndex,o=t.arrayCfg[e].iStartIndex+i;n<o;n++){var a=t.fWidthEnd+(n-t.arrayCfg[e].iStartIndex)/i*t.fWidthOffset,s=(h=t.arrayPosHistory[e][n-t.arrayCfg[e].iStartIndex].pos.clone()).clone();p=(p=t.arrayPosHistory[e][n-t.arrayCfg[e].iStartIndex].rot.clone()).normalize(),r.setFromEuler(new THREE.Euler(p.x,p.y,p.z)),(d=new THREE.Vector3(a,0,0)).applyQuaternion(r);var l=o-1-n;l=6*(t.arrayCfg[e].iStartIndex+l);var u=h.add(d);t.attributesVertices[l+0]=u.x,t.attributesVertices[l+1]=u.y,t.attributesVertices[l+2]=u.z;var c=s.sub(d);t.attributesVertices[l+3]=c.x,t.attributesVertices[l+4]=c.y,t.attributesVertices[l+5]=c.z}if(i<t.arrayCfg[e].iMaxArrayPosHistoryNo)for(n=t.arrayCfg[e].iStartIndex+i,o=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;n<o;n++){var h,p,d;s=(h=t.arrayPosHistory[e][i-1].pos.clone()).clone();p=(p=t.arrayPosHistory[e][i-1].rot.clone()).normalize(),r.setFromEuler(new THREE.Euler(p.x,p.y,p.z)),(d=new THREE.Vector3(0,0,0)).applyQuaternion(r);l=6*(t.arrayCfg[e].iStartIndex+n),u=h.add(d);t.attributesVertices[l+0]=u.x,t.attributesVertices[l+1]=u.y,t.attributesVertices[l+2]=u.z;c=s.sub(d);t.attributesVertices[l+3]=c.x,t.attributesVertices[l+4]=c.y,t.attributesVertices[l+5]=c.z}t.bufferGeometry.attributes.position.needsUpdate=!0}},function(){"use strict";function e(e,t){t=t||1/0;for(var i,r=e.length,n=null,o=[],a=0;a<r;a++){if(55295<(i=e.charCodeAt(a))&&57344>i){if(!n){if(56319<i){-1<(t-=3)&&o.push(239,191,189);continue}if(a+1===r){-1<(t-=3)&&o.push(239,191,189);continue}n=i;continue}if(56320>i){-1<(t-=3)&&o.push(239,191,189),n=i;continue}i=n-55296<<10|i-56320|65536,n=null}else n&&(-1<(t-=3)&&o.push(239,191,189),n=null);if(128>i){if(0>(t-=1))break;o.push(i)}else if(2048>i){if(0>(t-=2))break;o.push(192|i>>6,128|63&i)}else if(65536>i){if(0>(t-=3))break;o.push(224|i>>12,128|63&i>>6,128|63&i)}else{if(!(2097152>i))throw new Error("Invalid code point");if(0>(t-=4))break;o.push(240|i>>18,128|63&i>>12,128|63&i>>6,128|63&i)}}return o}function t(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}TextEncoderLite.prototype.encode=function(t){return"undefined"==typeof Uint8Array?e(t):new Uint8Array(e(t))},TextDecoderLite.prototype.decode=function(e){return function(e,i,r){var n="",o="";r=Math.min(e.length,r||1/0);for(var a=i=i||0;a<r;a++)127>=e[a]?(n+=t(o)+String.fromCharCode(e[a]),o=""):o+="%"+e[a].toString(16);return n+t(o)}(e,0,e.length)}}();var _Group=function(){this._tweens={},this._tweensAddedDuringUpdate={}};_Group.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var i=Object.keys(this._tweens);if(0===i.length)return!1;for(e=void 0!==e?e:TWEEN.now();i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var n=this._tweens[i[r]];n&&!1===n.update(e)&&(n._isPlaying=!1,t||delete this._tweens[i[r]])}i=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var TWEEN=new _Group;TWEEN.Group=_Group,TWEEN._nextId=0,TWEEN.nextId=function(){return TWEEN._nextId++},"undefined"==typeof window&&"undefined"!=typeof process?TWEEN.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?TWEEN.now=window.performance.now.bind(window.performance):void 0!==Date.now?TWEEN.now=Date.now:TWEEN.now=function(){return(new Date).getTime()},TWEEN.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=TWEEN.Easing.Linear.None,this._interpolationFunction=TWEEN.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||TWEEN,this._id=TWEEN.nextId()},TWEEN.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=e,void 0!==t&&(this._duration=t),this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?TWEEN.now()+parseFloat(e):e:TWEEN.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==0&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,i,r;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(e-this._startTime)/this._duration,i=0===this._duration||i>1?1:i,r=this._easingFunction(i),this._valuesEnd)if(void 0!==this._valuesStart[t]){var n=this._valuesStart[t]||0,o=this._valuesEnd[t];o instanceof Array?this._object[t]=this._interpolationFunction(o,r):("string"==typeof o&&(o="+"===o.charAt(0)||"-"===o.charAt(0)?n+parseFloat(o):parseFloat(o)),"number"==typeof o&&(this._object[t]=n+(o-n)*r))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===i){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var a=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=a}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},TWEEN.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*TWEEN.Easing.Bounce.In(2*e):.5*TWEEN.Easing.Bounce.Out(2*e-1)+.5}}},TWEEN.Interpolation={Linear:function(e,t){var i=e.length-1,r=i*t,n=Math.floor(r),o=TWEEN.Interpolation.Utils.Linear;return t<0?o(e[0],e[1],r):t>1?o(e[i],e[i-1],i-r):o(e[n],e[n+1>i?i:n+1],r-n)},Bezier:function(e,t){for(var i=0,r=e.length-1,n=Math.pow,o=TWEEN.Interpolation.Utils.Bernstein,a=0;a<=r;a++)i+=n(1-t,r-a)*n(t,a)*e[a]*o(r,a);return i},CatmullRom:function(e,t){var i=e.length-1,r=i*t,n=Math.floor(r),o=TWEEN.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(n=Math.floor(r=i*(1+t))),o(e[(n-1+i)%i],e[n],e[(n+1)%i],e[(n+2)%i],r-n)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[i]-(o(e[i],e[i],e[i-1],e[i-1],r-i)-e[i]):o(e[n?n-1:0],e[n],e[i<n+1?i:n+1],e[i<n+2?i:n+2],r-n)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=TWEEN.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i=1;if(e[t])return e[t];for(var r=t;r>1;r--)i*=r;return e[t]=i,i}}(),CatmullRom:function(e,t,i,r,n){var o=.5*(i-e),a=.5*(r-t),s=n*n;return(2*t-2*i+o+a)*(n*s)+(-3*t+3*i-2*o-a)*s+o*n+t}}},function(e){"function"==typeof define&&define.amd?define([],(function(){return TWEEN})):"undefined"!=typeof module&&"object"==typeof exports?module.exports=TWEEN:void 0!==e&&(e.TWEEN=TWEEN)}(this),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).json2mesh={})}(this,(function(e){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},s="function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?function(e){return void 0===e?"undefined":t(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":t(e)},l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},u=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),c="function"==typeof Symbol&&"symbol"===s(Symbol.iterator)?function(e){return void 0===e?"undefined":s(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":s(e)},h=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},p=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":s(t))&&"function"!=typeof t?e:t},f="function"==typeof Symbol&&"symbol"===c(Symbol.iterator)?function(e){return void 0===e?"undefined":c(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":c(e)},m=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},g=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),v=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},y=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":c(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},b=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":c(t))&&"function"!=typeof t?e:t},_=new(function(){function e(t){m(this,e),this.config=null}return g(e,[{key:"createObject",value:function(e){var t=new(this.config.getClass(e.creatorType))(e),i=t.create();return t.parseChildren(),i}}]),e}()),x=new(function(){function e(){m(this,e),this.objects=[],this._objectTypeConfig=null}return g(e,[{key:"create",value:function(e){var t=e.type;return new(0,this.objectTypeConfig[t])}},{key:"objectTypeConfig",set:function(e){this._objectTypeConfig=e},get:function(){return this._objectTypeConfig}}]),e}()),E=function(){function e(){m(this,e)}return g(e,null,[{key:"uuid",value:function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var i=e.join("");return i}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var a in i){o=!0;for(var s=i[a].skeleton,l=n[a],u=[],c=0;c<s.bones.length;++c){var h=r[s.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":f(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}}]),e}(),w=function(){function e(t){m(this,e),this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=t.jsonData,this.objectParent=null,t.parent&&(this.objectParent=t.parent),this.createType=null,this.resourceManager=t.resourceManager}return g(e,[{key:"create",value:function(){var e=this._getCreateParams();if(this.object=x.create(e),this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.jsonData=this.jsonData,e.parent&&(this.object.parent=e.parent),this.jsonData.position){var t=this.jsonData.position;this.object.position.set(t[0],t[1],-t[2])}if(this.jsonData.scale){var i=this.jsonData.scale,r=this.object.scale;0===i[0]&&(i[0]=.01),0===i[1]&&(i[1]=.01),0===i[2]&&(i[2]=.01),r.set(i[0],i[1],i[2])}if(this.jsonData.rotation){var n=this.jsonData.rotation;this.object.rotation.set(n[0],n[1],-n[2],-n[3])}if(this.jsonData.properties&&(this.object.properties=this.jsonData.properties),E.checkValueEmpty(this.jsonData.isshow)||(this.object.isShow=this.jsonData.isshow),this.jsonData.caminfo){var o=this.jsonData.caminfo.eye,a=this.jsonData.caminfo.target;o[2]=-o[2],a[2]=-a[2],this.object.camInfo={eye:o,target:a}}return this.object}},{key:"parseChildren",value:function(){}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,_.createObject(e)}}]),e}(),T=0,S=1,A=2,M=3,C=4,R=5,D=6,P=7,j=8,F=9,O=10,k=11,L=12,B=13,H=14,I=15,N=16,U=17,V=18,z=19,q=20,W=21,G=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return y(t,e),g(t,[{key:"parseChildren",value:function(){var e=this.jsonData;if(e.buildings&&this._parseJsonDataChildren({jsonData:e.buildings,creatorType:S}),e.outdoors){var t=this._parseJsonDataChild({jsonData:e.outdoors,creatorType:O});this.object.outdoors=t}}}]),t}(w),X=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),E.checkValueEmpty(this.jsonData.structshow)||(this.object.structShow=this.jsonData.structshow),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.facades&&this._parseJsonDataChildren({jsonData:e.facades,creatorType:k}),e.facadegroups&&this._parseJsonDataChildren({jsonData:e.facadegroups,creatorType:L}),e.plans&&this._parseJsonDataChildren({jsonData:e.plans,creatorType:A})}}]),t}(w),Y=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),E.checkValueEmpty(this.jsonData.alwaysshowinsideobjs)||(this.object.alwaysShowInsideObjs=this.jsonData.alwaysshowinsideobjs),E.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.corners&&this._parseCorners(e.corners),e.walls&&this._parseWalls(e.walls),e.placements&&this._parseJsonDataChildren({jsonData:e.placements,creatorType:D}),e.rooms&&(this._parseJsonDataChildren({jsonData:e.rooms,creatorType:F}),this.object.calRoomsUV2()),e.groups&&this._parseJsonDataChildren({jsonData:e.groups,creatorType:P}),e.curvelines&&this._parseJsonDataChildren({jsonData:e.curvelines,creatorType:B}),e.routelines&&this._parseJsonDataChildren({jsonData:e.routelines,creatorType:V}),e.leakwaterlines&&this._parseJsonDataChildren({jsonData:e.leakwaterlines,creatorType:H}),e.arrowlines&&this._parseJsonDataChildren({jsonData:e.arrowlines,creatorType:I}),e.arrowdatalines&&this._parseJsonDataChildren({jsonData:e.arrowdatalines,creatorType:N}),e.pipelines&&this._parseJsonDataChildren({jsonData:e.pipelines,creatorType:U}),e.videoprobes&&this._parseJsonDataChildren({jsonData:e.videoprobes,creatorType:z}),e.grounds&&this._parseJsonDataChildren({jsonData:e.grounds,creatorType:W})}},{key:"_parseCorners",value:function(e){for(var t=0;t<e.length;t++){var i=e[t],r=i[0],n=i[1],o=-i[2];this.object.existsCorner(r,n,o)?console.error("repeat corner"):this._parseJsonDataChild({jsonData:i,creatorType:M})}}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var i=e[t],r=null;0===i.type?r=this._parseJsonDataChild({jsonData:i,creatorType:R}):1===i.type?r=this._parseJsonDataChild({jsonData:i,creatorType:C}):2===i.type&&(r=this._parseJsonDataChild({jsonData:i,creatorType:q})),i.doororwindows&&this._parseDoorOrWindows(i.doororwindows,r)}}},{key:"_parseDoorOrWindows",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i];this._parseJsonDataChild({jsonData:r,attachWall:t,creatorType:j})}}}]),t}(w),J=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="WallCorner",i}return y(t,e),g(t,[{key:"create",value:function(){v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=this.jsonData[0],i=this.jsonData[1],r=-this.jsonData[2];this.object.position=new THREE.Vector3(e,i,r)}}]),t}(w),Q=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ModelWall",i}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),E.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),E.checkValueEmpty(this.jsonData.isshow)||(this.object.isShow=this.jsonData.isshow),E.checkValueEmpty(this.jsonData.height)?this.object.height=this.object.resource.modelSize.y:this.object.height=this.jsonData.height,E.checkValueEmpty(this.jsonData.thick)||(this.object.thick=this.jsonData.thick),this.object}},{key:"_parseCorners",value:function(){var e=this.jsonData.corners;this.object.startCorner=this.objectParent.corners[e[0]],this.object.endCorner=this.objectParent.corners[e[1]],this.object.startCorner.addWall(this.object),this.object.endCorner.addWall(this.object)}}]),t}(w),Z=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="StraightManualWall",i}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),this._parseResources(),this.jsonData.uvmultiple&&(this.object.uvMultiple=this.jsonData.uvmultiple),E.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),E.checkValueEmpty(this.jsonData.thick)||(this.object.thick=this.jsonData.thick),this.object}},{key:"_parseCorners",value:function(){var e=this.jsonData.corners;this.object.startCorner=this.objectParent.corners[e[0]],this.object.endCorner=this.objectParent.corners[e[1]],this.object.startCorner.addWall(this.object),this.object.endCorner.addWall(this.object)}},{key:"_parseResources",value:function(){E.checkValueEmpty(this.jsonData.lefttexture)||(this.object.leftResource=this.resourceManager.textures[this.jsonData.lefttexture]),E.checkValueEmpty(this.jsonData.righttexture)||(this.object.rightResource=this.resourceManager.textures[this.jsonData.righttexture]),E.checkValueEmpty(this.jsonData.edgetexture)||(this.object.edgeResource=this.resourceManager.textures[this.jsonData.edgetexture])}}]),t}(w),K=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Placement",i}return y(t,e),g(t,[{key:"create",value:function(){if(v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],E.checkValueEmpty(this.jsonData.texture)||(this.object.customTextureResource=this.resourceManager.textures[this.jsonData.texture]),this.jsonData.color){var e=this.jsonData.color;this.object.customColor=new THREE.Color(e[0],e[1],e[2]),4===e.length&&(this.object.opacity=e[3])}return E.checkValueEmpty(this.jsonData.rendermode)||(this.object.renderMode=this.jsonData.rendermode),this.jsonData.animinfo&&(this.object.isPlayAnim=this.jsonData.animinfo.isplay,this.object.animClip=this.jsonData.animinfo.clip),E.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(w),$=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementGroup",i}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.placements&&this._parseJsonDataChildren({jsonData:this.jsonData.placements,creatorType:D}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:P}),E.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object.collectChildrenResources(),this.object}}]),t}(w),ee=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.attachWall=e.attachWall,i.createType="DoorOrWindow",i}return y(t,e),g(t,[{key:"create",value:function(){if(v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],E.checkValueEmpty(this.jsonData.suspendpercent)||(this.object.suspendPercent=this.jsonData.suspendpercent),E.checkValueEmpty(this.jsonData.isopen)||(this.object.isOpen=this.jsonData.isopen),E.checkValueEmpty(this.jsonData.diridx)||(this.object.openDirIndex=this.jsonData.diridx),!E.checkValueEmpty(this.jsonData.iswindow)){var e=this.jsonData.iswindow;"string"==typeof e&&(e="false"!==e.toLocaleString()),this.object.isWindow=e}return this.object.attachWall=this.attachWall,this.attachWall.doorOrWindows.push(this.object),this.object.fitAttachWall(),this.object}}]),t}(w),te=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),this._parsePoints(),0===this.object.points.length&&console.warn("room points is null"),this._parseHolesCorners(),this._parseHolesPoints(),this._parseRoomResources(),this._parseRoomHeight(),this._parseRoomBlockSize(),this._parseRoomVisible(),this._parseRoomBlockAngle(),this._setOutdoorFloorHeight(),this.object.initShapePathPoints(),this.object.initShapeHolePoints(),this.object}},{key:"_parseCorners",value:function(){if(this.jsonData.corners){for(var e=[],t=0;t<this.jsonData.corners.length;t++){var i=this.jsonData.corners[t],r=this.objectParent.corners[i].position.clone();e.push(r)}this.object.points=e}}},{key:"_parsePoints",value:function(){if(this.jsonData.points){for(var e=[],t=0;t<this.jsonData.points.length;t++){var i=this.jsonData.points[t],r=i[0],n=i[1],o=-i[2],a=new THREE.Vector3(r,n,o);e.push(a)}this.object.points=e}}},{key:"_parseHolesCorners",value:function(){if(this.jsonData.holescorners){for(var e=[],t=0;t<this.jsonData.holescorners.length;t++){for(var i=this.jsonData.holescorners[t],r=[],n=0;n<i.length;n++){var o=i[n];r.push(this.objectParent.corners[o].position.clone())}e.push(r)}this.object.holes=e}}},{key:"_parseHolesPoints",value:function(){if(this.jsonData.holespoints){for(var e=[],t=0;t<this.jsonData.holespoints.length;t++){for(var i=this.jsonData.holespoints[t],r=[],n=0;n<i.length;n++){var o=i[n],a=o[0],s=o[1],l=-o[2],u=new THREE.Vector3(a,s,l);r.push(u)}e.push(r)}this.object.holes=e}}},{key:"_parseRoomResources",value:function(){null!==this.jsonData.floortexture&&void 0!==this.jsonData.floortexture&&(this.object.floorResource=this.resourceManager.textures[this.jsonData.floortexture],this.object.floor.resource=this.object.floorResource),null!==this.jsonData.ceilingtexture&&void 0!==this.jsonData.ceilingtexture&&(this.object.ceilingResource=this.resourceManager.textures[this.jsonData.ceilingtexture],this.object.ceiling.resource=this.object.ceilingResource),null!==this.jsonData.rooftexture&&void 0!==this.jsonData.rooftexture&&(this.object.roofResource=this.resourceManager.textures[this.jsonData.rooftexture],this.object.roof.resource=this.object.roofResource)}},{key:"_parseRoomHeight",value:function(){var e=this.jsonData,t=this.object;void 0!==e.ceilingheight?t.ceiling.height=e.ceilingheight:(t.ceiling.DefaultHeight=this.objectParent.height-.1,t.ceiling.height=t.ceiling.DefaultHeight),void 0!==e.roofheight?t.roof.height=e.roofheight:(t.roof.defaultHeight=this.objectParent.height,t.roof.height=t.roof.defaultHeight),void 0!==e.floorheight&&(t.floor.height=e.floorheight)}},{key:"_parseRoomVisible",value:function(){var e=this.jsonData,t=this.object;void 0!==e.isshowfloor&&(t.floor.isShow=e.isshowfloor),void 0!==e.isshowceiling&&(t.ceiling.isShow=e.isshowceiling),void 0!==e.isshowroof&&(t.roof.isShow=e.isshowroof)}},{key:"_parseRoomBlockSize",value:function(){var e=this.jsonData,t=this.object;if(e.floorblocksize){var i=e.floorblocksize;t.floor.blockSize=new THREE.Vector2(i[0],i[1])}if(e.ceilingblocksize){i=e.ceilingblocksize;t.ceiling.blockSize=new THREE.Vector2(i[0],i[1])}if(e.roofblocksize){i=e.roofblocksize;t.roof.blockSize=new THREE.Vector2(i[0],i[1])}}},{key:"_parseRoomBlockAngle",value:function(){var e=this.jsonData,t=this.object;e.floorblockangle&&(t.floor.blockAngle=e.floorblockangle),e.ceilingblockangle&&(t.ceiling.blockAngle=e.ceilingblockangle),e.roofblockangle&&(t.roof.blockAngle=e.roofblockangle)}},{key:"_setOutdoorFloorHeight",value:function(){var e=this.objectParent,t=this.object;"Outdoors"===e.type&&t.floor.height===t.floor.DefaultHeight&&(t.floor.height=0,t.floor.DefaultHeight=0)}}]),t}(w),ie=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return y(t,e),t}(Y),re=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Facade",i}return y(t,e),t}(K),ne=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FacadeGroup",i}return y(t,e),t}($),oe=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CurveLine",i}return y(t,e),g(t,[{key:"create",value:function(){v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=this.jsonData;if(E.checkValueEmpty(this.jsonData.texture)?this.object.resource=this.resourceManager.emptyTextureResource:this.object.resource=this.resourceManager.textures[this.jsonData.texture],this.jsonData.color){var i=this.jsonData.color;this.object.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(this.object.opacity=i[3])}if(void 0!==e.textiling){var r=e.textiling;this.object.textureTiling=new THREE.Vector2(r[0],r[1])}if(void 0!==e.texoffset){var n=e.texoffset;this.object.textureOffset=new THREE.Vector2(n[0],n[1])}!E.checkValueEmpty(this.jsonData.width)&&(this.object.width=this.jsonData.width),this.jsonData.enableanim&&(this.object.enableMaterialAnimation=this.jsonData.enableanim),!E.checkValueEmpty(this.jsonData.matanimspeed)&&(this.object.materialAnimationSpeed=this.jsonData.matanimspeed);for(var o=this.jsonData.path,a=0;a<o.length;a++){var s=o[a],l=s[0],u=s[1],c=-s[2],h=new THREE.Vector3(l,u,c);this.object.points.push(h)}return this.object}}]),t}(w),ae=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PipeLine",i}return y(t,e),g(t,[{key:"create",value:function(){if(v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),E.checkValueEmpty(this.jsonData.texture)?this.object.resource=this.resourceManager.emptyTextureResource:this.object.resource=this.resourceManager.textures[this.jsonData.texture],this.jsonData.color){var e=this.jsonData.color;this.object.color=new THREE.Color(e[0],e[1],e[2]),4===e.length&&(this.object.opacity=e[3])}this.jsonData.sectionType&&(this.object.sectionType=this.jsonData.sectionType),!E.checkValueEmpty(this.jsonData.rendermode)&&(this.object.renderMode=this.jsonData.rendermode),!E.checkValueEmpty(this.jsonData.radius)&&(this.object.radius=this.jsonData.radius),this.jsonData.enableanim&&(this.object.enableMaterialAnimation=this.jsonData.enableanim),!E.checkValueEmpty(this.jsonData.matanimspeed)&&(this.object.materialAnimationSpeed=this.jsonData.matanimspeed);for(var i=this.jsonData.path,r=0;r<i.length;r++){var n=i[r],o=n[0],a=n[1],s=-n[2],l=new THREE.Vector3(o,a,s);this.object.points.push(l)}return this.object}}]),t}(w),se=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="LeakWaterLine",i}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.alarmlength&&(this.object.alarmLength=this.jsonData.alarmlength),this.object}}]),t}(ae),le=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ArrowLine",i}return y(t,e),g(t,[{key:"create",value:function(){v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=this.object,i=this.jsonData;return null!==e.width&&(e.arrowWidth=3*e.width,e.arrowHeight=2*e.width),i.arrow?(i.arrow.texture?e.arrowResource=this.resourceManager.textures[i.arrow.texture]:e.arrowResource=this.resourceManager.emptyTextureResource,i.arrow.width&&(e.arrowWidth=i.arrow.width),i.arrow.height&&(e.arrowHeight=i.arrow.height)):e.arrowResource=this.resourceManager.emptyTextureResource,this.object}}]),t}(oe),ue=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ArrowDataLine",i}return y(t,e),g(t,[{key:"create",value:function(){v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=this.object,i=this.jsonData;if(i.pointuserids){var r=i.pointuserids;e.pointUserIDs=r}if(i.pointproperteis){var n=i.pointproperteis;e.pointProperteis=n}return this.object}}]),t}(le),ce=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="RouteLine",i}return y(t,e),t}(oe),he=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="VideoProbe",i}return y(t,e),t}(K),pe=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementWall",i}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}}]),t}(K),de=function(e){function t(e){m(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementGround",i}return y(t,e),t}(K),fe=function(){function e(t){m(this,e),this._map={0:G,1:X,2:Y,3:J,4:Q,5:Z,6:K,7:$,8:ee,9:te,10:ie,11:re,12:ne,13:oe,14:se,15:le,16:ue,17:ae,18:ce,19:he,20:pe,21:de}}return g(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),me=function(){function e(t){m(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl}return g(e,[{key:"createResource",value:function(e){var t=x.create({type:e});return t.manager=this.manager,t}},{key:"loadTextures",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];t=r.localurl?this._loadLocalCustomTextureResource(r):this._loadTextureResource(r),this.manager.textures.push(t)}}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource("LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource("Resource");return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];if((t=r.model?this.createResource("CustomResource"):r.localurl?this.createResource("CustomModelResource"):this.createResource("Resource")).baseUrl=this.baseModelUrl,r.localurl){if(t.localUrl=r.localurl,t.id=r.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,r.title&&(t.modelName=r.title),t.modelID=r.id,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.color){var n=r.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}}else if(r.id){if(t.id=r.id,t.modelID=r.id,t.version=r.version,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.model&&(t.modelID=r.model),r.title&&(t.modelName=r.title),r.color){n=r.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}if(r.size){var o=r.size;t.modelSize=new THREE.Vector3(o[0],o[1],o[2])}r.hasanimation&&(t.hasAnim=r.hasanimation),r.url&&(t.url=r.url)}for(var a=0;a<this.manager.ableToSupportFootAndHeadModelWalls.length;a++){var s=this.manager.ableToSupportFootAndHeadModelWalls[a];if(t.id===s){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var i=e.color;t.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(t.opacity=i[3])}if(e.size){var r=e.size;t.modelSize=new THREE.Vector3(r[0],r[1],r[2])}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),ge=function(){function e(){m(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new fe}return g(e,[{key:"setObjectTypeConfig",value:function(e){x.objectTypeConfig=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"loadLightMaps",value:function(e){var t=null,i="18091219l1g1hnjt",r="png";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(i=e.straightmanualwall.lightingtexture.id,r=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource("Resource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=i,t.ext=r,this.defaultResource.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource("Resource")).baseUrl=this.resourceManager.baseTextureUrl,t.id="18091216vjlgtwbh",t.ext="jpg",this.defaultResource.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=x.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++){i+=t[r]+"/"}return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,i){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,(function(i){e.sceneJson=JSON.parse(i),t()}),(function(){}),(function(t){i("can not load "+e.sceneURL)}))}else i("load scene json error")}))}},{key:"getResourceLoader",value:function(){return new me(this.resourceManager)}},{key:"parseSceneJson",value:function(){var e=this.getResourceLoader();this.loadLightMaps(this.sceneJson.materialsetting),e.loadTextures(this.sceneJson.textures),e.loadModels(this.sceneJson.models),this.parseWorld(this.sceneJson)}},{key:"parseWorld",value:function(e){_.config=this.creatorTypeConfig,this.world=_.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:T})}}]),e}(),ve=(new ge,function(e){function t(e){return h(this,t),d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),p(t,[{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl?this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl:this.resourceManager.localCustomModelBaseUrl="https://www.thingjs.com",this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}}]),t}(ge)),ye=new(function(){function e(t){l(this,e),this._map={0:new ge,1:new ve},this._versions=[0,1]}return u(e,[{key:"getLoaderManager",value:function(e){return null!=e?this._map[e]:this._map[this._versions.length-1]}}]),e}()),be=function(){function e(t){l(this,e),this.resourceManager=t.resourceManager,this.defaultSetting=t.defaultSetting,this.defaultResource=t.defaultResource,this.objectTypeConfig=t.objectTypeConfig}return u(e,[{key:"load",value:function(e){var t=ye.getLoaderManager(e.version);return t.setDefaultSetting(this.defaultSetting),t.setDefaultResource(this.defaultResource),t.setResourceManager(this.resourceManager),t.setObjectTypeConfig(this.objectTypeConfig),t.parseObjects(e)}}]),e}(),_e="function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?function(e){return void 0===e?"undefined":t(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":t(e)},xe=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ee=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),we=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},Te=function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+(void 0===i?"undefined":t(i)));e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i)},Se=function(e,i){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!==(void 0===i?"undefined":t(i))&&"function"!=typeof i?e:i},Ae=function e(){xe(this,e)};Ae.wallTexture=null,Ae.wallEdgeTexture=null,Ae.floorTexture=null,Ae.ceilingTexture=null,Ae.roofTexture=null,Ae.wallLigthMapTexture=null,Ae.floorLightMapTexture=null,Ae.wallMaterial=null,Ae.wallEdgeMaterial=null,Ae.floorMaterial=null,Ae.ceilingMaterial=null,Ae.roofMaterial=null;var Me=function e(){xe(this,e)};Me.StraightManualWallHeight=3,Me.StraightManualWallThick=.15,Me.enableDelayLoadMode=!0,Me.enableManaulWallLightMap=!0,Me.enableFloorLightMap=!0,Me.wallLightMapIntensity=3.8,Me.enableUseHighestVersionResource=!0,Me.enableCombine=!0,Me.ableToSupportFootAndHeadModelWalls=["C9FB3F9A29C842F79F02CECC4037FEA1"];var Ce=function(){function e(){xe(this,e)}return Ee(e,null,[{key:"uuid",value:function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var i=e.join("");return i}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var a in i){o=!0;for(var s=i[a].skeleton,l=n[a],u=[],c=0;c<s.bones.length;++c){var h=r[s.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":_e(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}}]),e}(),Re=function(){function e(){xe(this,e),this.id=Ce.uuid(),this.name=null,this.userID=null,this.resource=null,this.type="BaseObject",this.position=new THREE.Vector3(0,0,0),this.rotation=new THREE.Quaternion(0,0,0,1),this.scale=new THREE.Vector3(1,1,1),this._parent=null,this.properties=null,this.isShow=!0,this._mesh=null,this._isBuilded=!1,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this._boundingBox=null,this.isContainer=!1,this._childrenResources=null,this._children=null,this._isMultiResources=!1,this._resources=null,this.initCompleteCallback=null,this._delayObject=null,this._size=null,this._boxMesh=null}return Ee(e,[{key:"isRepeat",value:function(){}},{key:"findObjectByID",value:function(e){if(this.id===e)return this;if(this.children)for(var t=0;t<this.children.length;t++){var i=this.children[t];if(i.id===e)return i;var r=i.findObjectByID(e);if(r)return r}return null}},{key:"addToParentCollector",value:function(){}},{key:"childBuildedCallback",value:function(e){}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);this.createMesh(),this.processWhenBuildFinish()}}},{key:"createMesh",value:function(){this.mesh=new THREE.Object3D}},{key:"processWhenBuildFinish",value:function(){null!==this._delayObject&&null!==this._mesh&&this._delayObject.add(this._mesh),this._isBuilded=!0,this.notifyBuildCompleteListeners(),this.parent&&this.parent.childBuildedCallback(this),this.initCompleteCallback&&this.initCompleteCallback(this)}},{key:"notifyBuildCompleteListeners",value:function(){for(var e=0;e<this.buildCompleteCallbacks.length;e++){(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}}},{key:"checkResourceReady",value:function(){if(this.isMultiResources){for(var e=0;e<this.resources.length;e++){if(!this.resources[e].ready)return!1}return!0}return!!this.resource.ready}},{key:"checkChildrenResourcesReady",value:function(){for(var e=0;e<this.childrenResources.length;e++){if(!this.childrenResources[e].ready)return!1}return!0}},{key:"resourceCallback",value:function(e){this.build()}},{key:"initResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"_dispose",value:function(e){if(e instanceof THREE.Mesh){var t=e;if(t){var i=t.material,r=t.geometry;i&&this._disposeMaterial(i),r&&r.dispose()}}for(var n=e.children,o=0;o<n.length;o++){var a=n[o];this._dispose(a)}}},{key:"_disposeMaterial",value:function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var i=e[t];this._disposeMaterial(i)}else{if(e.map){var r=e.map;r&&r.dispose()}e.dispose()}}},{key:"clear",value:function(){if(this.isContainer)for(var e=0;e<this.children.length;e++){this.children[e].clear()}else{var t=this.mesh;if(t){this._dispose(t);for(var i=t.children.length-1;i>=0;i--){var r=t.children[i];t.remove(r)}}}this._isBuilded=!1}},{key:"delayObject",get:function(){return null===this._delayObject&&(this._delayObject=new THREE.Object3D),this.isBuilded&&null!==this._mesh&&this._delayObject.add(this._mesh),this._delayObject}},{key:"mesh",get:function(){return this._mesh},set:function(e){this._mesh=e}},{key:"isBuilded",get:function(){if(this.isContainer){if(this.children.length>0){for(var e=0;e<this.children.length;e++){if(!this.children[e].isBuilded)return!1}return!0}return this._isBuilded}return this._isBuilded}},{key:"isMultiResources",get:function(){return this._isMultiResources}},{key:"children",get:function(){return this._children}},{key:"resources",get:function(){return this._resources}},{key:"childrenResources",get:function(){if(null===this._childrenResources){for(var e=[],t=0;t<this.children.length;t++){var i=this.children[t];if(i.isContainer)e=e.concat(i.childrenResources);else if(i.isMultiResources)e=e.concat(i.resources);else{for(var r=!1,n=0;n<e.length;n++){if(e[n]===i.resource){r=!0;break}}r||e.push(i.resource)}}this._childrenResources=e}return this._childrenResources}},{key:"size",get:function(){if(null===this._size){var e=new THREE.Vector3;this.resource&&this.resource.modelSize&&e.multiplyVectors(this.resource.modelSize,this.scale),this._size=e}return this._size}},{key:"boundingBox",get:function(){return null===this._boundingBox&&(this._boundingBox=new THREE.Box3,this._boundingBox.setFromObject(this.boxMesh)),this._boundingBox}},{key:"boxMesh",get:function(){if(null===this._boxMesh){var e=new THREE.BoxBufferGeometry(1,1,1),t=new THREE.MeshBasicMaterial,i=new THREE.Mesh(e,t);i.scale.copy(this.size),i.quaternion.copy(this.rotation),i.position.copy(this.position),i.position.y=(this.position.y+this.size.y)/2,this._boxMesh=i}return this._boxMesh}},{key:"parent",get:function(){return this._parent},set:function(e){this._parent=e,this.addToParentCollector()}},{key:"worldPosition",get:function(){if(this.parent){var e=new THREE.Vector3;return e.addVectors(this.parent.worldPosition,this.position),e}return this.position}}]),e}(),De=function(e){function t(e){xe(this,t);var i=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.shapePath=[],i.holePaths=[],i.room=e,i.isDoubleSide=!1,i.texture=Ae.floorTexture,i.enableLightMap=Me.enableFloorLightMap,i.material=null,i.geometry=null,i.resource=null,i.blockSize=new THREE.Vector2(.6,.6),i.blockAngle=0,i.DefaultHeight=.01,i.height=i.DefaultHeight,i.type="Floor",i.parent=e,i}return Te(t,e),Ee(t,[{key:"resourceCallback",value:function(e){this.texture=e.texture,this.mesh&&(this.mesh.material.map=this.texture,this.mesh.material.needsUpdate=!0)}},{key:"initResource",value:function(){var e=this.room.floorResource;e&&(e.ready?(this.texture=e.texture,this.material=e.material):(!Me.enableCombine||this.room.userID||this.room.name||this.room.properties)&&e.registerListener(this))}},{key:"build",value:function(){this.initResource(),this.calGeometry();var e=this.geometry,t=null;if(null===this.height&&(this.height=this.DefaultHeight),this.room.lightMapResource&&this.enableLightMap?this.calLightMapUV(e):t=this.resource.roomMaterial,t.side=THREE.DoubleSide,t.defines=t.defines||{},t.defines.FLOOR_AO=!0,this.mesh=new THREE.Mesh(e,t),this.mesh.name="floor",this.mesh.position.y=this.height,this.mesh.rotateX(-Math.PI/2),this.room.center){var i=this.room.center;this.mesh.position.set(i.x,0,i.z)}this.mesh.visible=this.isShow,this.mesh.roomID=this.room.id}},{key:"calGeometry",value:function(){4===this.shapePath.length&&0===this.holePaths.length||(this.enableLightMap=!1);for(var e,t=new THREE.Vector3,i=0;i<this.shapePath.length;i++){var r=this.shapePath[i];t.x+=r.x,t.z+=r.y}if(t.x/=this.shapePath.length,t.z/=this.shapePath.length,e=0===this.shapePath.length?new THREE.Shape:new THREE.Shape(this.shapePath),this.holePaths)for(i=0;i<this.holePaths.length;i++){var n=this.holePaths[i];e.holes.push(new THREE.Path(n))}var o=new THREE.ShapeGeometry(e);for(i=0;i<o.faceVertexUvs.length;i++)for(var a=o.faceVertexUvs[i],s=0;s<a.length;s++)for(var l=a[s],u=0;u<l.length;u++){var c=l[u],h=void 0,p=void 0;h=c.x-t.x,p=c.y-t.z,this.blockSize&&(h/=this.blockSize.x,p/=this.blockSize.y),c.set(h,p)}o.uvsNeedUpdate=!0,this.room.uv2&&(o.faceVertexUvs[1]=this.room.uv2),this.rotateUV(o),this.geometry=o}},{key:"calLightMapUV",value:function(e){var t,i,r,n,o=e.faceVertexUvs;o[1]=[];for(var a=0;a<o.length;a++)for(var s=o[a],l=0;l<s.length;l++)for(var u=s[l],c=0;c<u.length;c++){var h=u[c];void 0!==t?(h.x>t&&(t=h.x),h.x<r&&(r=h.x),h.y>i&&(i=h.y),h.y<n&&(n=h.y)):(t=h.x,i=h.y,r=h.x,n=h.y)}var p=o[0],d=[];for(l=0;l<p.length;l++){u=p[l];var f=[];for(c=0;c<u.length;c++){h=u[c];var m=new THREE.Vector2,g=h.x===t?1:0,v=h.y===i?1:0;m.set(g,v),f.push(m)}d.push(f)}o[1]=d}},{key:"reCalUV",value:function(e){for(var t,i,r,n,o=e.faceVertexUvs,a=0;a<o.length;a++)for(var s=o[a],l=0;l<s.length;l++)for(var u=s[l],c=0;c<u.length;c++){var h=u[c];void 0!==t?(h.x>t&&(t=h.x),h.x<r&&(r=h.x),h.y>i&&(i=h.y),h.y<n&&(n=h.y)):(t=h.x,i=h.y,r=h.x,n=h.y)}var p=Math.abs(r),d=Math.abs(n);t+=p,i+=d;var f=[];for(a=0;a<o.length;a++){var m=o[a],g=[];for(l=0;l<m.length;l++){u=m[l];var v=[];for(c=0;c<u.length;c++){h=u[c];var y=new THREE.Vector2;y.set((h.x+p)/t,(h.y+d)/i),v.push(y)}g.push(v)}f.push(g)}return f}},{key:"rotateUV",value:function(e){for(var t=this.blockAngle*Math.PI/180,i=new THREE.Vector2(.5,.5),r=e.faceVertexUvs[0],n=0;n<r.length;n++)for(var o=r[n],a=0;a<o.length;a++){var s=o[a];s.sub(i),(s=new THREE.Vector2(s.x*Math.cos(t)-s.y*Math.sin(t),s.x*Math.sin(t)+s.y*Math.cos(t))).add(i),o[a]=s}}}]),t}(Re),Pe=function(e){function t(e){xe(this,t);var i=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.shapePath=[],i.holePaths=[],i.center=null,i.room=e,i.material=null,i.geometry=null,i.resource=null,i.height=null,i.blockSize=new THREE.Vector2(.6,.6),i.blockAngle=0,i.DefaultHeight=2.9,i.height=i.DefaultHeight,i.type="Ceiling",i.parent=e,i}return Te(t,e),Ee(t,[{key:"initResource",value:function(){var e=this.room.ceilingResource;e&&(e.ready?(this.texture=e.texture,this.material=e.material):(!Me.enableCombine||this.room.userID||this.room.name||this.room.properties)&&e.registerListener(this))}},{key:"resourceCallback",value:function(e){if(this.texture=e.texture,this.mesh){var t=this.texture.clone();t.flipY=!1,this.mesh.material.map=t,this.mesh.material.needsUpdate=!0}}},{key:"build",value:function(){this.enableDelayLoadMode||this.initResource(),this.calGeometry();var e=this.resource.roomMaterial;if(this.mesh=new THREE.Mesh(this.geometry,e),this.mesh.name="ceiling",this.mesh.rotateX(Math.PI/2),null===this.height){var t=2.9;this.room.parent&&(t=this.room.parent.height),this.height=t}if(this.mesh.position.y=this.height,this.mesh.updateMatrixWorld(),this.room.center){var i=this.room.center;this.mesh.position.set(i.x,3,i.z)}this.mesh.visible=this.isShow}},{key:"calGeometry",value:function(){for(var e,t=new THREE.Vector3,i=0;i<this.shapePath.length;i++){var r=this.shapePath[i];t.x+=r.x,t.z+=r.y}if(t.x/=this.shapePath.length,t.z/=this.shapePath.length,e=0===this.shapePath.length?new THREE.Shape:new THREE.Shape(this.shapePath),this.holePaths)for(i=0;i<this.holePaths.length;i++){var n=this.holePaths[i];e.holes.push(new THREE.Path(n))}var o=new THREE.ShapeGeometry(e);this.material=this.resource.roomMaterial,this.geometry=o;for(i=0;i<o.faceVertexUvs.length;i++)for(var a=o.faceVertexUvs[i],s=0;s<a.length;s++)for(var l=a[s],u=0;u<l.length;u++){var c=l[u],h=void 0,p=void 0;h=c.x-t.x,p=c.y-t.z,this.blockSize&&(h/=this.blockSize.x,p/=this.blockSize.y),c.set(h,-p)}this.rotateUV(this.geometry),o.uvsNeedUpdate=!0}},{key:"rotateUV",value:function(e){for(var t=this.blockAngle*Math.PI/180,i=new THREE.Vector2(.5,.5),r=e.faceVertexUvs[0],n=0;n<r.length;n++)for(var o=r[n],a=0;a<o.length;a++){var s=o[a];s.sub(i),(s=new THREE.Vector2(s.x*Math.cos(t)-s.y*Math.sin(t),s.x*Math.sin(t)+s.y*Math.cos(t))).add(i),o[a]=s}}}]),t}(Re),je=function(e){function t(e){xe(this,t);var i=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.shapePath=[],i.holePaths=[],i.center=null,i.room=e,i.material=null,i.geometry=null,i.resource=null,i.DefaultHeight=3,i.height=i.DefaultHeight,i.blockSize=new THREE.Vector2(2,2),i.blockAngle=0,i.type="Roof",i.parent=e,i}return Te(t,e),Ee(t,[{key:"resourceCallback",value:function(e){this.texture=e.texture,this.mesh&&(this.mesh.material.map=this.texture,this.mesh.material.needsUpdate=!0)}},{key:"initResource",value:function(){var e=this.room.roofResource;e&&(e.ready?(this.texture=e.texture,this.material=e.material):(!Me.enableCombine||this.room.userID||this.room.name||this.room.properties)&&e.registerListener(this))}},{key:"build",value:function(){this.enableDelayLoadMode||this.initResource(),this.calGeometry();var e;if(e=this.resource.roomMaterial,this.mesh=new THREE.Mesh(this.geometry,e),null===this.height){var t=3;this.room.parent&&(t=this.room.parent.height),this.height=t}if(this.mesh.position.y=this.height+.001,this.mesh.name="roof",this.mesh.rotateX(-Math.PI/2),this.room.center){var i=this.room.center;this.mesh.position.set(i.x,this.height,i.z)}this.mesh.updateMatrixWorld(),this.mesh.visible=this.isShow,this.mesh.name="roof"+this.room.id}},{key:"calGeometry",value:function(){for(var e,t=new THREE.Vector3,i=0;i<this.shapePath.length;i++){var r=this.shapePath[i];t.x+=r.x,t.z+=r.y}if(t.x/=this.shapePath.length,t.z/=this.shapePath.length,e=0===this.shapePath.length?new THREE.Shape:new THREE.Shape(this.shapePath),this.holePaths)for(i=0;i<this.holePaths.length;i++){var n=this.holePaths[i];e.holes.push(new THREE.Path(n))}var o=new THREE.ShapeGeometry(e);this.geometry=o,this.material=this.resource.roomMaterial;for(i=0;i<o.faceVertexUvs.length;i++)for(var a=o.faceVertexUvs[i],s=0;s<a.length;s++)for(var l=a[s],u=0;u<l.length;u++){var c=l[u],h=void 0,p=void 0;h=c.x-t.x,p=c.y-t.z,this.blockSize&&(h/=this.blockSize.x,p/=this.blockSize.y),c.set(h,p)}this.rotateUV(this.geometry),o.uvsNeedUpdate=!0}},{key:"rotateUV",value:function(e){for(var t=this.blockAngle*Math.PI/180,i=new THREE.Vector2(.5,.5),r=e.faceVertexUvs[0],n=0;n<r.length;n++)for(var o=r[n],a=0;a<o.length;a++){var s=o[a];s.sub(i),(s=new THREE.Vector2(s.x*Math.cos(t)-s.y*Math.sin(t),s.x*Math.sin(t)+s.y*Math.cos(t))).add(i),o[a]=s}}}]),t}(Re),Fe=function(e){function t(e){xe(this,t);var i=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.dataJson=e,i.shapePath=[],i.reverseZShapPath=[],i.holePaths=[],i.reverseZHolePaths=[],i._points=[],i._holes=[],i._uv2=[],i.center=null,i.meshGroup=null,i.offset=null,i.parentPosition=null,i.position=new THREE.Vector3,i.floor=new De(i),i.roof=new je(i),i.ceiling=new Pe(i),i.floorResource=null,i.ceilingResource=null,i.roofResource=null,i.isOnlyFloor=!1,i._isMultiResources=!0,i.type="Room",i}return Te(t,e),Ee(t,[{key:"initShapePathPoints",value:function(){var e=this.points;this.shapePath.length=0,this.reverseZShapPath.length=0;for(var t=0;t<e.length;t++){var i=e[t].clone();this.shapePath.push(new THREE.Vector2(i.x,i.z)),this.reverseZShapPath.push(new THREE.Vector2(i.x,-i.z))}this.floor.shapePath=this.reverseZShapPath,this.ceiling.shapePath=this.shapePath,this.roof.shapePath=this.reverseZShapPath}},{key:"initShapeHolePoints",value:function(){var e=this.holes;this.holePaths.length=0,this.reverseZHolePaths.length=0;for(var t=0;t<e.length;t++){for(var i=e[t],r=i.length,n=[],o=[],a=0;a<r;a++){var s=i[a].clone();n.push(new THREE.Vector2(s.x,s.z)),o.push(new THREE.Vector2(s.x,-s.z))}this.holePaths.push(n),this.reverseZHolePaths.push(o)}this.floor.holePaths=this.reverseZHolePaths,this.ceiling.holePaths=this.holePaths,this.roof.holePaths=this.reverseZHolePaths}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource();if(this.createMesh(),this.parentPosition&&this.offset){var e=new THREE.Vector3;e.add(this.parentPosition),e.add(this.offset),this.center=e}else this.center=null;this.isOnlyFloor?(this.floor.build(),this.meshGroup=new THREE.Object3D("room"),this.meshGroup.add(this.floor.mesh)):(this.floor.build(),this.ceiling.build(),this.roof.build(),this.meshGroup=new THREE.Object3D("room"),this.meshGroup.add(this.floor.mesh),this.meshGroup.add(this.ceiling.mesh),this.meshGroup.add(this.roof.mesh)),this.mesh=this.meshGroup,this.mesh.roomid=this.id,this.meshGroup.position.set(this.position.x,this.position.y,this.position.z),this.processWhenBuildFinish()}}},{key:"checkResourceReady",value:function(){return!!(this.floor.resource.ready&&this.ceiling.resource.ready&&this.roof.resource.ready)}},{key:"initResource",value:function(){this.downloadResource(this.floor.resource),this.downloadResource(this.ceiling.resource),this.downloadResource(this.roof.resource)}},{key:"downloadResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"resourceCallback",value:function(e){this.checkResourceReady()&&this.build()}},{key:"addToParentCollector",value:function(){we(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.rooms.push(this)}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this._resources.push(this.ceiling.resource),this._resources.push(this.floor.resource),this._resources.push(this.roof.resource)),this._resources}},{key:"points",set:function(e){this._points=e},get:function(){return this._points}},{key:"holes",set:function(e){this._holes=e},get:function(){return this._holes}},{key:"uv2",set:function(e){this._uv2=e},get:function(){return this._uv2}}]),t}(Re),Oe=function(e){function t(e,i,r){xe(this,t);var n=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.walls=[],n.position=new THREE.Vector3(e,i,r),n.type="WallCorner",n}return Te(t,e),Ee(t,[{key:"addWall",value:function(e){for(var t=0,i=this.walls.length;t<i;t++)if(this.walls[t]===e)return void console.error("repeat wall"+e);this.walls.push(e)}},{key:"build",value:function(){if(!this.isBuilded){var e=this.getSameHeightWalls();for(var t in e)this.calWallsVertices(e[t]);this.processWhenBuildFinish()}}},{key:"isFirstWallShouldNotCal",value:function(e){return!("StraightManualWall"===e.type)||"SubStraightManualWall"===e}},{key:"isSecondWallShouldNotCal",value:function(e){return null!=e&&(e.resource&&e.resource.isModel||"SubStraightManualWall"===e.type)}},{key:"checkWallsSameHeight",value:function(){for(var e=null,t=0;t<this.walls.length;t++){var i=this.walls[t];if(null===e)e=i.height;else if(e!==i.height)return!1}return!0}},{key:"containModelWall",value:function(){for(var e=0;e<this.walls.length;e++){if("ModelWall"===this.walls[e].type)return!0}return!1}},{key:"getSameHeightWalls",value:function(){for(var e={},t=0;t<this.walls.length;t++){var i=this.walls[t];this.isStraightManualWall(i)&&(void 0===e[i.height]&&(e[i.height]=[]),e[i.height].push(i))}return e}},{key:"isStraightManualWall",value:function(e){return"StraightManualWall"===e.type}},{key:"calWallsVertices",value:function(e){var t=new THREE.Vector3(0,-1,0);if(1===e.length){var i=e[0];"StraightManualWall"===i.type&&this.setDefaultCornerVertices(i)}else{this.sortWalls(e);for(var r=0;r<e.length;r++){var n=e[r];if(!this.isFirstWallShouldNotCal(n)){for(var o=null,a=r;null==o&&(a===e.length-1?a=0:a+=1,e[a]!==n);)o=e[a],this.isSecondWallShouldNotCal(o)&&(o=null);if(o){var s=n.getWallOtherCorner(this).position,l=new THREE.Vector3;l.subVectors(s,this.position),s=o.getWallOtherCorner(this).position;var u=new THREE.Vector3;if(u.subVectors(s,this.position),l.normalize(),u.normalize(),0!==l.length()&&0!==u.length()){var c=n.thick/2,h=new THREE.Vector3;h.crossVectors(t,l),h.normalize();var p=h.clone();p.multiplyScalar(c),p.add(this.position),c=o.thick/2;var d=u.clone();d.cross(t),d.normalize();var f=d.clone();if(f.multiplyScalar(c),f.add(this.position),this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1),l.normalize(),u.normalize(),this.calAngle(l,u)>30){var m;if(Ce.approximatelyNumberEqual(Math.abs(l.dot(u)),1)){var g=l.clone();g.cross(t),g.normalize(),this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!0);continue}if(0!==(m=this.getIntersectPosition(p,l,f,u)).x||0!==m.y||0!==m.z)m.clone().y=this.position.y+this.getWallHeight(),this.setCornersVertices(n,m,!0),this.setCornersVertices(o,m,!1)}else this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1)}else this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!1)}else this.setDefaultCornerVertices(n)}}}}},{key:"sortWalls",value:function(e){if(e.length>1)for(var t,i,r=e[0],n=0,o=e.length-1;n<o;){for(i=n;i<o;++i)this.angleBetween(r,e[i])>this.angleBetween(r,e[i+1])&&(t=e[i],e[i]=e[i+1],e[i+1]=t);for(i=--o;i>n;--i)this.angleBetween(r,e[i])<this.angleBetween(r,e[i-1])&&(t=e[i],e[i]=e[i-1],e[i-1]=t);++n}}},{key:"angleBetween",value:function(e,t){var i=e.getWallOtherCorner(this).position.clone();i.sub(this.position);var r=t.getWallOtherCorner(this).position.clone();return r.sub(this.position),this.calAngle(i,r)}},{key:"calAngle",value:function(e,t){e.normalize(),t.normalize();var i=e.angleTo(t);i*=180/Math.PI;var r=e.clone();return r.cross(t),r.y>0&&(i=360-i),i}},{key:"getWallHeight",value:function(){for(var e=99999,t=0;t<this.walls.length;t++){var i=this.walls[t];e>i.height&&(e=i.height)}return e}},{key:"setCornersVertices",value:function(e,t,i){var r=new THREE.Vector3(0,0,0);r.x=t.x-e.position.x,r.y=t.y-e.position.y,r.z=t.z-e.position.z,e.startCorner===this?i?(e.cornersVertices[0].x=r.x,e.cornersVertices[0].y=r.y,e.cornersVertices[0].z=r.z):(e.cornersVertices[1].x=r.x,e.cornersVertices[1].y=r.y,e.cornersVertices[1].z=r.z):i?(e.cornersVertices[2].x=r.x,e.cornersVertices[2].y=r.y,e.cornersVertices[2].z=r.z):(e.cornersVertices[3].x=r.x,e.cornersVertices[3].y=r.y,e.cornersVertices[3].z=r.z)}},{key:"setDefaultCornerVertices",value:function(e,t){var i=new THREE.Vector3(0,-1,0),r=e.getWallOtherCorner(this).position.clone();r.sub(this.position),r.normalize();var n=e.thick/2,o=i.clone();o.cross(r),o.normalize(),o.multiplyScalar(n);var a=new THREE.Vector3;a.addVectors(this.position,o);var s=new THREE.Vector3;s.subVectors(this.position,o),void 0===t?(this.setCornersVertices(e,a,!0),this.setCornersVertices(e,s,!1)):t?this.setCornersVertices(e,a,!0):this.setCornersVertices(e,s,!1)}},{key:"getIntersectPosition",value:function(e,t,i,r){if(e.x===i.x&&e.y===i.y&&e.z===i.z)return e;var n=e.y;if(1===t.dot(r))throw"two line in same direction ,can not cal intersected position!";var o=new THREE.Vector3,a=new THREE.Vector3;o.addVectors(e,t),a.addVectors(i,r);var s=new THREE.Vector2(e.x,e.z),l=new THREE.Vector2(o.x,o.z),u=new THREE.Vector2(i.x,i.z),c=new THREE.Vector2(a.x,a.z),h=(l.y-s.y)*(c.x-u.x)-(s.x-l.x)*(u.y-c.y);if(0==h)return new THREE.Vector3;var p=((l.x-s.x)*(c.x-u.x)*(u.y-s.y)+(l.y-s.y)*(c.x-u.x)*s.x-(c.y-u.y)*(l.x-s.x)*u.x)/h,d=-((l.y-s.y)*(c.y-u.y)*(u.x-s.x)+(l.x-s.x)*(c.y-u.y)*s.y-(c.x-u.x)*(l.y-s.y)*u.y)/h;return new THREE.Vector3(p,n,d)}},{key:"addToParentCollector",value:function(){this.parent.corners.push(this)}},{key:"size",get:function(){return new THREE.Vector3(0,0,0)}},{key:"boundingBox",get:function(){return null===this._boundingBox&&(this._boundingBox=new THREE.Box3),this._boundingBox}},{key:"boxMesh",get:function(){if(null===this._boxMesh){var e=new THREE.Object3D;e.position.copy(this.position),this._boxMesh=e}return this._boxMesh}}]),t}(Re),ke=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="SubWallCorner",e}return Te(t,e),Ee(t,[{key:"isFirstWallShouldNotCal",value:function(e){return!("SubStraightManualWall"===e)}},{key:"isSecondWallShouldNotCal",value:function(e){return e&&!("SubStraightManualWall"===e.type)}}],[{key:"createSubWallCorner",value:function(e,i,r){var n=new t;return n.id=e,n.position=i,n.parent=r.parent,n}}]),t}(Oe),Le=function e(){xe(this,e),this.positionArray=null,this.normalArray=null,this.uvArray=null,this.colorArray=null,this.uv2Array=null,this.indexArray=null,this.material=null,this.resource=null},Be=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.startCorner=null,e.endCorner=null,e.thick=-1,e.height=-1,e._length=null,e.pathPoints=[],e._direction=null,e.doorOrWindows=[],e.subWalls=[],e.subCorners=[],e.suspend=0,e.mesh=null,e.isShow=!0,e.isContainer=!1,e}return Te(t,e),Ee(t,[{key:"baseBuild",value:function(){this.pathPoints.push(this.startCorner.position),this.pathPoints.push(this.endCorner.position),this.position.addVectors(this.endCorner.position,this.startCorner.position),this.position.divideScalar(2)}},{key:"build",value:function(){}},{key:"getWallOtherCorner",value:function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null}},{key:"sortDoorOrWins",value:function(){var e=this.startCorner.position,t=this.endCorner.position,i=t.x-e.x>0?1:-1,r=t.z-e.z>0?1:-1,n=!0;Math.abs(t.x-e.x)<.001&&(n=!1);for(var o=[],a=0;a<this.doorOrWindows.length;a++){for(var s=this.doorOrWindows[a],l=0;l<o.length;l++){var u=o[l];if((n?(u.position.x-s.position.x)*i:(u.position.z-s.position.z)*r)>=0){o.splice(l,0,s);break}if(l==o.length-1){o.push(s);break}}0===o.length&&o.push(s)}return o}},{key:"getWallCornerByPos",value:function(e){for(var t=null,i=-1,r=this.subCorners,n=0;n<r.length;n++){var o=e.distanceTo(r[n].position);o<.01&&(null===t?(t=r[n],i=o):o<i&&(i=o,t=r[n]))}return t}},{key:"getDoorOrWinStartAndEndPos",value:function(e){var t=e.size,i=this.direction,r=e.position.clone();r.y=0;var n=r.clone(),o=r.clone(),a=t.x/2;return n.subVectors(n,i.clone().multiplyScalar(a)),o.addVectors(o,i.clone().multiplyScalar(a)),[n,o]}},{key:"addSubWallCorner",value:function(e){for(var t=0;t<this.subCorners.length;t++){if(this.subCorners[t]===e)return}this.subCorners.push(e)}},{key:"addToParentCollector",value:function(){we(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.walls.push(this)}},{key:"clear",value:function(){for(var e=0;e<this.subWalls.length;e++){this.subWalls[e].clear()}this.subWalls=[],we(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"length",get:function(){if(null===this._length){var e=new THREE.Vector3;e.subVectors(this.endCorner.position,this.startCorner.position),this._length=e.length()}return this._length}},{key:"direction",get:function(){return null===this._direction&&(this._direction=new THREE.Vector3,this._direction.subVectors(this.endCorner.position,this.startCorner.position),this._direction.normalize()),this._direction}},{key:"size",get:function(){if(null===this._size){var e=new THREE.Vector3,t=this.startCorner.position,i=this.endCorner.position;e.x=Math.abs(t.x-i.x),e.z=Math.abs(t.z-i.z),e.y=this.height,0===e.x&&(e.x=this.thick),0===e.z&&(e.z=this.thick),this._size=e}return this._size}},{key:"boundingBox",get:function(){if(null===this._boundingBox){this._boundingBox=new THREE.Box3;this.startCorner.position,this.endCorner.position;var e=this.position.clone();e.y=this.height/2,this._boundingBox.setFromCenterAndSize(e,this.size)}return this._boundingBox}},{key:"worldPosition",get:function(){var e=this.startCorner.worldPosition,t=this.endCorner.worldPosition,i=new THREE.Vector3;return i.addVectors(e,t),i.divideScalar(2),i}}]),t}(Re),He=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.startCorner=null,e.endCorner=null,e.thick=Me.StraightManualWallThick,e.height=Me.StraightManualWallHeight,e.cornersVertices=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],e.pathPoints=[],e.selfPathPoints=[],e.upDirection=new THREE.Vector3(0,1,0),e.downDirection=new THREE.Vector3(0,-1,0),e.basePoints=null,e.repeatUV=[],e.uvMultiple=[1,1],e.rightSideLength=null,e.leftSideLength=null,e.floorPlanHeight=3,e.rightSideMeshInfo=new Le,e.leftSideMeshInfo=new Le,e.edgeSideMeshInfo=new Le,e.defaultWallTexture=null,e.rightWallTexture=null,e.leftWallTexture=null,e.startUVPercent=[0,0,0,0],e.endUVPercent=[1,1,1,1],e.wallGroup=null,e.leftResource=null,e.rightResource=null,e.edgeResource=null,e.resource=null,e.lightMapResource=Ae.wallLightMapResource,e.vectorUp=new THREE.Vector3(0,1,0),e.enableLightMap=Me.enableManaulWallLightMap,e.aoMapIntensity=Me.wallLightMapIntensity,e._resources=null,e._isMultiResources=!0,e.type="StraightManualWall",e}return Te(t,e),Ee(t,[{key:"leftResourceCallback",value:function(e){}},{key:"rightResourceCallback",value:function(e){this.rigthWallTexture=e,this.isBuilded&&(this.wallGroup[0].material.texture=this.rigthWallTexture)}},{key:"resourceCallback",value:function(e){this.checkResourceReady()&&this.build()}},{key:"initMaterial",value:function(){this.leftResource?this.leftResource.ready?this.leftWallTexture=this.leftResource.texture:this.leftResource.callbackObjects.push(this):this.leftWallTexture||(this.leftWallTexture=Ae.wallTexture),this.rightResource?this.rightResource.ready?this.rightWallTexture=this.rightResource.texture:this.rightResource.callbackObjects.push(this):this.rightWallTexture||(this.rightWallTexture=Ae.wallTexture),this.leftResource?(this.leftSideMeshInfo.resource=this.leftResource,this.leftSideMeshInfo.material=this.leftResource.material):this.leftSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.rightResource?(this.rightSideMeshInfo.resource=this.rightResource,this.rightSideMeshInfo.material=this.rightResource.material):this.rightSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.edgeResource?(this.edgeSideMeshInfo.resource=this.edgeResource,this.edgeSideMeshInfo.material=this.edgeResource.material):this.edgeSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.initLightMap()}},{key:"initLightMap",value:function(){this.lightMapResource&&this.enableLightMap&&(this.rightResource.ready&&this.rightResource.isDefault&&(void 0===this.rightResource.wallLightMaterial&&(this.rightResource.wallLightMaterial=this.rightResource.wallMaterial.clone()),this.rightSideMeshInfo.material=this.rightResource.wallLightMaterial,this.rightSideMeshInfo.material.aoMap=this.lightMapResource.texture),this.leftResource.ready&&this.leftResource.isDefault&&(void 0===this.leftResource.wallLightMaterial&&(this.leftResource.wallLightMaterial=this.leftResource.wallMaterial.clone()),this.leftSideMeshInfo.material=this.leftResource.wallLightMaterial,this.leftSideMeshInfo.material.aoMap=this.lightMapResource.texture))}},{key:"initMeshInfo",value:function(){this.baseBuild(),this.calPosInfo(),this.calEachSideLen(),this.calRepeatUV(),this.calBasePoints(),this.fillMesh()}},{key:"checkResourceReady",value:function(){for(var e=0;e<this.resources.length;e++){if(!this.resources[e].ready)return!1}return!0}},{key:"initResource",value:function(){this.downloadResource(this.lightMapResource),this.downloadResource(this.leftResource),this.downloadResource(this.rightResource),this.downloadResource(this.edgeResource)}},{key:"downloadResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"baseBuild",value:function(){this.pathPoints.push(this.startCorner.position),this.pathPoints.push(this.endCorner.position)}},{key:"calEachSideLen",value:function(){var e=new THREE.Vector3;e.subVectors(this.endCorner.position,this.startCorner.position),e.normalize();var t=this.thick/2,i=new THREE.Vector3;i.crossVectors(this.downDirection,e),i.normalize();var r=i.clone();r.negate();var n=i.clone();n.multiplyScalar(t);var o=r.clone();o.multiplyScalar(t);var a=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,u=new THREE.Vector3;Ce.equalVectorZero(this.cornersVertices[0])?a.addVectors(this.selfPathPoints[0],n):a.copy(this.cornersVertices[0]),Ce.equalVectorZero(this.cornersVertices[3])?s.addVectors(this.selfPathPoints[1],n):s.copy(this.cornersVertices[3]),Ce.equalVectorZero(this.cornersVertices[1])?l.addVectors(this.selfPathPoints[0],o):l.copy(this.cornersVertices[1]),Ce.equalVectorZero(this.cornersVertices[2])?u.addVectors(this.selfPathPoints[1],o):u.copy(this.cornersVertices[2]),this.rightSideLength=new THREE.Vector3,this.leftSideLength=new THREE.Vector3,this.rightSideLength.subVectors(a,s),this.leftSideLength.subVectors(l,u),this.rightSideLength=this.rightSideLength.length(),this.leftSideLength=this.leftSideLength.length()}},{key:"calRepeatUV",value:function(){this.repeatUV[0]=this.uvMultiple[0]*this.rightSideLength/this.floorPlanHeight,this.repeatUV[1]=this.uvMultiple[1]*this.height/this.floorPlanHeight,this.repeatUV[2]=this.uvMultiple[0]*this.leftSideLength/this.floorPlanHeight,this.repeatUV[3]=this.uvMultiple[1]*this.height/this.floorPlanHeight}},{key:"calPosInfo",value:function(){var e=new THREE.Vector3;this.selfPathPoints.push(e.subVectors(this.startCorner.position,this.position)),e=new THREE.Vector3,this.selfPathPoints.push(e.subVectors(this.endCorner.position,this.position)),this.selfPathPoints[0].y=0,this.selfPathPoints[1].y=0}},{key:"calBasePoints",value:function(){if(null===this.basePoints){this.basePoints=[];for(var e=0;e<12;e++)this.basePoints.push(new THREE.Vector3)}var t=this.thick/2,i=new THREE.Vector3;i.crossVectors(this.downDirection,this.direction),i.normalize();var r=i.clone();r.negate();var n=i.multiplyScalar(t);Ce.equalVectorZero(this.cornersVertices[0])?(this.basePoints[4].x=this.selfPathPoints[0].x+n.x,this.basePoints[4].y=0,this.basePoints[4].z=this.selfPathPoints[0].z+n.z):(this.basePoints[4].x=this.cornersVertices[0].x,this.basePoints[4].y=0,this.basePoints[4].z=this.cornersVertices[0].z),Ce.equalVectorZero(this.cornersVertices[1])?(n=r.multiplyScalar(t),this.basePoints[5].x=this.selfPathPoints[0].x+n.x,this.basePoints[5].y=0,this.basePoints[5].z=this.selfPathPoints[0].z+n.z):(this.basePoints[5].x=this.cornersVertices[1].x,this.basePoints[5].y=0,this.basePoints[5].z=this.cornersVertices[1].z);var o=this.direction.clone();i.crossVectors(this.downDirection,o.negate()),i.normalize(),(r=i.clone()).negate(),Ce.equalVectorZero(this.cornersVertices[2])?((n=i.clone()).multiplyScalar(t),this.basePoints[6].x=this.selfPathPoints[1].x+n.x,this.basePoints[6].y=0,this.basePoints[6].z=this.selfPathPoints[1].z+n.z):(this.basePoints[6].x=this.cornersVertices[2].x,this.basePoints[6].y=0,this.basePoints[6].z=this.cornersVertices[2].z),Ce.equalVectorZero(this.cornersVertices[3])?((n=r.clone()).multiplyScalar(t),this.basePoints[7].x=this.selfPathPoints[1].x+n.x,this.basePoints[7].y=0,this.basePoints[7].z=this.selfPathPoints[1].z+n.z):(this.basePoints[7].x=this.cornersVertices[3].x,this.basePoints[7].y=0,this.basePoints[7].z=this.cornersVertices[3].z),this.basePoints[0].x=this.basePoints[4].x,this.basePoints[0].y=this.basePoints[4].y+this.height,this.basePoints[0].z=this.basePoints[4].z,this.basePoints[1].x=this.basePoints[5].x,this.basePoints[1].y=this.basePoints[5].y+this.height,this.basePoints[1].z=this.basePoints[5].z,this.basePoints[2].x=this.basePoints[6].x,this.basePoints[2].y=this.basePoints[6].y+this.height,this.basePoints[2].z=this.basePoints[6].z,this.basePoints[3].x=this.basePoints[7].x,this.basePoints[3].y=this.basePoints[7].y+this.height,this.basePoints[3].z=this.basePoints[7].z,this.basePoints[8].x=this.selfPathPoints[0].x,this.basePoints[8].y=this.selfPathPoints[0].y+this.height,this.basePoints[8].z=this.selfPathPoints[0].z,this.basePoints[9].x=this.selfPathPoints[1].x,this.basePoints[9].y=this.selfPathPoints[1].y+this.height,this.basePoints[9].z=this.selfPathPoints[1].z}},{key:"fillMesh",value:function(){this.fillEdgeSideMeshInfo(),this.fillLeftMeshInfo(),this.fillRightMeshInfo()}},{key:"fillRightMeshInfo",value:function(){this.rightSideMeshInfo.positionArray=new Float32Array(12),this.rightSideMeshInfo.normalArray=new Float32Array(12),this.rightSideMeshInfo.indexArray=[],this.rightSideMeshInfo.uvArray=new Float32Array(8),this.rightSideMeshInfo.parentPosition=this.position;var e=this.basePoints,t=[e[0],e[4],e[7],e[3]];this.rightSideMeshInfo.indexArray=[0,2,3,0,1,2];var i,r,n,o,a=new THREE.Vector3;a.crossVectors(this.downDirection,this.direction),a.normalize(),this.rightResource.isDefault?(i=this.startUVPercent[0],r=this.startUVPercent[1],n=this.endUVPercent[0],o=this.endUVPercent[1]):(i=this.startUVPercent[0]*this.repeatUV[0],r=this.startUVPercent[1]*this.repeatUV[1],n=this.endUVPercent[0]*this.repeatUV[0],o=this.endUVPercent[1]*this.repeatUV[1]);for(var s=[i,o,i,r,n,r,n,o],l=0;l<s.length;l++){var u=s[l];this.rightSideMeshInfo.uvArray[l]=u}if(this.lightMapResource){i=this.startUVPercent[0],r=this.startUVPercent[1],n=this.endUVPercent[0],o=this.endUVPercent[1],this.rightSideMeshInfo.uv2Array=new Float32Array(8);for(var c=[i,o,i,r,n,r,n,o],h=0;h<c.length;h++){var p=c[h];this.rightSideMeshInfo.uv2Array[h]=p}}for(var d=0;d<t.length;d++){var f=t[d],m=3*d;this.rightSideMeshInfo.positionArray[m]=f.x,this.rightSideMeshInfo.positionArray[m+1]=f.y+this.suspend,this.rightSideMeshInfo.positionArray[m+2]=f.z}for(var g=0;g<t.length;g++){var v=a,y=3*g;this.rightSideMeshInfo.normalArray[y]=v.x,this.rightSideMeshInfo.normalArray[y+1]=v.y,this.rightSideMeshInfo.normalArray[y+2]=v.z}}},{key:"fillLeftMeshInfo",value:function(){this.leftSideMeshInfo.positionArray=new Float32Array(12),this.leftSideMeshInfo.normalArray=new Float32Array(12),this.leftSideMeshInfo.uvArray=new Float32Array(8),this.leftSideMeshInfo.indexArray=[3,1,0,3,2,1],this.leftSideMeshInfo.parentPosition=this.position;var e,t,i,r,n=this.basePoints,o=[n[1],n[5],n[6],n[2]],a=new THREE.Vector3;a.crossVectors(this.direction,this.downDirection),a.normalize(),this.leftResource.isDefault?(e=this.startUVPercent[2],t=this.startUVPercent[3],i=this.endUVPercent[2],r=this.endUVPercent[3]):(e=this.startUVPercent[2]*this.repeatUV[2],t=this.startUVPercent[3]*this.repeatUV[3],i=this.endUVPercent[2]*this.repeatUV[2],r=this.endUVPercent[3]*this.repeatUV[3]);for(var s=[e,r,e,t,i,t,i,r],l=0;l<s.length;l++){var u=s[l];this.leftSideMeshInfo.uvArray[l]=u}if(this.lightMapResource){e=this.startUVPercent[0],t=this.startUVPercent[1],i=this.endUVPercent[0],r=this.endUVPercent[1],this.leftSideMeshInfo.uv2Array=new Float32Array(8);for(var c=[e,r,e,t,i,t,i,r],h=0;h<c.length;h++){var p=c[h];this.leftSideMeshInfo.uv2Array[h]=p}}for(var d=0;d<o.length;d++){var f=o[d],m=3*d;this.leftSideMeshInfo.positionArray[m]=f.x,this.leftSideMeshInfo.positionArray[m+1]=f.y+this.suspend,this.leftSideMeshInfo.positionArray[m+2]=f.z}for(var g=0;g<o.length;g++){var v=a,y=3*g;this.leftSideMeshInfo.normalArray[y]=v.x,this.leftSideMeshInfo.normalArray[y+1]=v.y,this.leftSideMeshInfo.normalArray[y+2]=v.z}}},{key:"fillEdgeSideMeshInfo",value:function(){this.edgeSideMeshInfo.indexArray=[].concat([0,2,1,0,3,2]),this.shouldAddSideIndexes(this.startCorner)&&(this.edgeSideMeshInfo.indexArray=this.edgeSideMeshInfo.indexArray.concat([1,4,0,1,5,4])),this.shouldAddSideIndexes(this.endCorner)&&(this.edgeSideMeshInfo.indexArray=this.edgeSideMeshInfo.indexArray.concat([3,7,2,2,7,6])),this.startCorner.walls.length>2&&(this.edgeSideMeshInfo.indexArray=this.edgeSideMeshInfo.indexArray.concat([1,8,0])),this.endCorner.walls.length>2&&(this.edgeSideMeshInfo.indexArray=this.edgeSideMeshInfo.indexArray.concat([3,9,2])),0!==this.suspend&&(this.edgeSideMeshInfo.indexArray=this.edgeSideMeshInfo.indexArray.concat([4,5,6,4,6,7])),this.edgeSideMeshInfo.positionArray=new Float32Array(30),this.edgeSideMeshInfo.normalArray=new Float32Array(30),this.edgeSideMeshInfo.uvArray=new Uint16Array(20),this.edgeSideMeshInfo.parentPosition=this.position;for(var e=this.basePoints,t=[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9]],i=this.edgeSideMeshInfo.uvArray,r=0;r<i.length;r++)i[r]=0;for(var n=0;n<t.length;n++){var o=t[n],a=3*n;this.edgeSideMeshInfo.positionArray[a]=o.x,this.edgeSideMeshInfo.positionArray[a+1]=o.y+this.suspend,this.edgeSideMeshInfo.positionArray[a+2]=o.z}for(var s=0;s<t.length;s++){var l=this.upDirection,u=3*s;this.edgeSideMeshInfo.normalArray[u]=l.x,this.edgeSideMeshInfo.normalArray[u+1]=l.y,this.edgeSideMeshInfo.normalArray[u+2]=l.z}}},{key:"shouldAddSideIndexes",value:function(e){return 1===e.walls.length||0===e.walls.length||!(e.checkWallsSameHeight()&&!e.containModelWall())}},{key:"fillUV",value:function(){var e,t,i,r,n,o=0;this.rightResource.isDefault?(e=this.startUVPercent[0],t=this.startUVPercent[1],i=this.endUVPercent[0],r=this.endUVPercent[1]):(e=this.startUVPercent[0]*this.repeatUV[0],t=this.startUVPercent[1]*this.repeatUV[1],i=this.endUVPercent[0]*this.repeatUV[0],r=this.endUVPercent[1]*this.repeatUV[1]),(n=this.rightSideMeshInfo.uvArray)[o++]=e,n[o++]=r,n[o++]=i,n[o++]=t,n[o++]=i,n[o++]=r,n[o++]=e,n[o++]=r,n[o++]=e,n[o++]=t,n[o++]=i,n[o++]=t,this.leftResource.isDefault?(e=this.startUVPercent[2],t=this.startUVPercent[3],i=this.endUVPercent[2],r=this.endUVPercent[3]):(e=this.startUVPercent[2]*this.repeatUV[2],t=this.startUVPercent[3]*this.repeatUV[3],i=this.endUVPercent[2]*this.repeatUV[2],r=this.endUVPercent[3]*this.repeatUV[3]),o=0,(n=this.leftSideMeshInfo.uvArray)[o++]=i,n[o++]=r,n[o++]=e,n[o++]=t,n[o++]=e,n[o++]=r,n[o++]=i,n[o++]=r,n[o++]=i,n[o++]=t,n[o++]=e,n[o++]=t,o=0,(n=this.edgeSideMeshInfo.uvArray)[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,this.lightMapResource&&(e=this.startUVPercent[0],t=this.startUVPercent[1],i=this.endUVPercent[0],r=this.endUVPercent[1],o=0,(n=this.rightSideMeshInfo.uv2Array)[o++]=e,n[o++]=r,n[o++]=i,n[o++]=t,n[o++]=i,n[o++]=r,n[o++]=e,n[o++]=r,n[o++]=e,n[o++]=t,n[o++]=i,n[o++]=t,o=0,(n=this.leftSideMeshInfo.uv2Array)[o++]=i,n[o++]=r,n[o++]=e,n[o++]=t,n[o++]=e,n[o++]=r,n[o++]=i,n[o++]=r,n[o++]=i,n[o++]=t,n[o++]=e,n[o++]=t)}},{key:"getWallOtherCorner",value:function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null}},{key:"createMesh",value:function(e){var t=new THREE.BufferGeometry;t.setIndex(e.indexArray),t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var i=e.material;return this.lightMapResource&&e.uv2Array&&this.enableLightMap&&t.addAttribute("uv2",new THREE.BufferAttribute(e.uv2Array,2)),e.material=i,new THREE.Mesh(t,i)}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this._resources.push(this.lightMapResource),this._resources.push(this.leftResource),this._resources.push(this.rightResource),this._resources.push(this.edgeResource)),this._resources}},{key:"position",get:function(){var e=this.startCorner.position,t=this.endCorner.position,i=new THREE.Vector3;return i.addVectors(e,t),i.divideScalar(2),i},set:function(e){}}]),t}(Be),Ie=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="SubStraightManualWall",e}return Te(t,e),Ee(t,[{key:"build",value:function(){if(this.initMeshInfo(),this.initMaterial(),!this.enableDelayLoadMode){var e=this.position,t=new THREE.Group("wall");t.add(this.createMesh(this.leftSideMeshInfo)),t.add(this.createMesh(this.rightSideMeshInfo)),t.add(this.createMesh(this.edgeSideMeshInfo)),t.position.set(e.x,e.y,e.z),this.wallGroup=t,this.mesh=this.wallGroup}this._isBuilded=!0}},{key:"initMeshInfo",value:function(){this.baseBuild(),this.calPosInfo(),this.calBasePoints(),this.fillMesh()}},{key:"addToParentCollector",value:function(){this.parent.subWalls.push(this)}}]),t}(He),Ne=function(e){function t(){return xe(this,t),Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return Te(t,e),Ee(t,[{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource();if(this.doorOrWindows.length>0){this.baseBuild(),this.calPosInfo(),this.calEachSideLen(),this.calRepeatUV(),this.initSimpleCornersAndWalls(),this.mesh=new THREE.Object3D;for(var e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.mesh.add(t.mesh),this.wallGroup=this.mesh}}else{this.initMeshInfo(),this.initMaterial();var i=this.position,r=new THREE.Group("wall");r.add(this.createMesh(this.leftSideMeshInfo)),r.add(this.createMesh(this.rightSideMeshInfo)),r.add(this.createMesh(this.edgeSideMeshInfo)),r.position.set(i.x,i.y,i.z),this.wallGroup=r,this.mesh=this.wallGroup}this.processWhenBuildFinish()}}},{key:"initSimpleCornersAndWalls",value:function(){var e=this.position;(new THREE.Vector3).crossVectors(this.direction,this.vectorUp);for(var t=this.sortDoorOrWins(),i=0;i<t.length;i++){var r=t[i],n=this.getDoorOrWinStartAndEndPos(r),o=this.getDoorOrWinRectPoints(r),a=ke.createSubWallCorner(this.id+"_"+i+"_1",n[0],this),s=ke.createSubWallCorner(this.id+"_"+i+"_2",n[1],this);if(this.addSubWallCorner(a),this.addSubWallCorner(s),0===i){var l=new Ie;l.startCorner=this.startCorner,l.endCorner=a,l.startCorner.build(),l.endCorner.build(),this.setCornerVertices(l,!0),l.calPosInfo(),l.calEachSideLen(),l.endUVPercent[0]=l.rightSideLength/this.rightSideLength,l.endUVPercent[2]=l.leftSideLength/this.leftSideLength,l.repeatUV=this.repeatUV,l.leftResource=this.leftResource,l.rightResource=this.rightResource,l.edgeResource=this.edgeResource,l.lightMapResource=this.lightMapResource,l.height=this.height,l.thick=this.thick,l.parentWall=this,l.parent=this}else{var u=t[i-1],c=this.getDoorOrWinStartAndEndPos(u),h=this.getDoorOrWinRectPoints(u),p=this.getWallCornerByPos(c[1]),d=new Ie;d.startCorner=p,d.endCorner=a;var f=new THREE.Vector3;f.subVectors(p.position,a.position);var m=f.length();d.startCorner.build(),d.endCorner.build(),d.calPosInfo(),d.calEachSideLen();var g=h[3].distanceTo(e.clone().addVectors(this.cornersVertices[0],e)),v=h[2].distanceTo(e.clone().addVectors(this.cornersVertices[1],e));d.startUVPercent[0]=g/this.rightSideLength,d.startUVPercent[2]=v/this.leftSideLength,d.endUVPercent[0]=(g+m)/this.rightSideLength,d.endUVPercent[2]=(v+m)/this.leftSideLength,d.repeatUV=this.repeatUV,d.leftResource=this.leftResource,d.rightResource=this.rightResource,d.edgeResource=this.edgeResource,d.lightMapResource=this.lightMapResource,d.height=this.height,d.thick=this.thick,d.parentWall=this,d.parent=this}if(i==t.length-1){var y=new Ie;y.parent=this,y.startCorner=s,y.endCorner=this.endCorner,y.startCorner.build(),this.setCornerVertices(y,!1),y.calPosInfo(),y.calEachSideLen();g=o[3].distanceTo(e.clone().addVectors(this.cornersVertices[0],e)),v=o[2].distanceTo(e.clone().addVectors(this.cornersVertices[1],e));y.startUVPercent[0]=g/this.rightSideLength,y.startUVPercent[2]=v/this.leftSideLength,y.repeatUV=this.repeatUV,y.leftResource=this.leftResource,y.rightResource=this.rightResource,y.edgeResource=this.edgeResource,y.lightMapResource=this.lightMapResource,y.height=this.height,y.thick=this.thick,y.parentWall=this}this.buildHeadAndFootWall(r,a,s)}}},{key:"buildSimpleCornersAndWalls",value:function(){this.enableDelayLoadMode||(this.wallGroup=new THREE.Object3D);for(var e=0;e<this.subCorners.length;e++){this.subCorners[e].build()}for(e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.enableDelayLoadMode||this.wallGroup.add(t.wallGroup)}this.mesh=this.wallGroup}},{key:"buildHeadAndFootWall",value:function(e,t,i){var r=this.position,n=this.getDoorOrWinRectPoints(e),o=n[0].distanceTo(r.clone().addVectors(this.cornersVertices[0],r)),a=n[1].distanceTo(r.clone().addVectors(this.cornersVertices[1],r)),s=e.suspendPercent;(new THREE.Vector3).crossVectors(this.direction,this.vectorUp);var l=e.size.y+this.height*s;if(0!==e.suspendPercent){var u=new Ie;u.parent=this,u.startCorner=t,u.endCorner=i,(h=new THREE.Vector3).subVectors(i.position,t.position);var c=h.length();u.height=this.height*s,u.thick=this.thick,u.startUVPercent=[o/this.rightSideLength,0,a/this.leftSideLength,0],u.endUVPercent[0]=(o+c)/this.rightSideLength,u.endUVPercent[1]=u.height/this.height,u.endUVPercent[2]=(a+c)/this.leftSideLength,u.endUVPercent[3]=u.height/this.height,u.uvMultiple=this.uvMultiple,u.repeatUV=this.repeatUV,u.leftResource=this.leftResource,u.rightResource=this.rightResource,u.edgeResource=this.edgeResource,u.lightMapResource=this.lightMapResource,u.parentWall=this}if(l<this.height){var h,p=new Ie;p.parent=this,p.startCorner=t,p.endCorner=i,(h=new THREE.Vector3).subVectors(i.position,t.position);c=h.length();p.suspend=l,p.height=this.height-l,p.thick=this.thick,p.startUVPercent=[o/this.rightSideLength,l/this.height,a/this.leftSideLength,l/this.height],p.endUVPercent[0]=(o+c)/this.rightSideLength,p.endUVPercent[2]=(a+c)/this.leftSideLength,p.uvMultiple=this.uvMultiple,p.repeatUV=this.repeatUV,p.leftResource=this.leftResource,p.rightResource=this.rightResource,p.edgeResource=this.edgeResource,p.lightMapResource=this.lightMapResource,p.parentWall=this}}},{key:"setCornerVertices",value:function(e,t){var i,r;t?((i=new THREE.Vector3).addVectors(this.cornersVertices[0],this.position),i.sub(e.position),(r=new THREE.Vector3).addVectors(this.cornersVertices[1],this.position),r.sub(e.position),e.cornersVertices[0]=i,e.cornersVertices[1]=r):((i=new THREE.Vector3).addVectors(this.cornersVertices[2],this.position),i.sub(e.position),(r=new THREE.Vector3).addVectors(this.cornersVertices[3],this.position),r.sub(e.position),e.cornersVertices[2]=i,e.cornersVertices[3]=r)}},{key:"getDoorOrWinRectPoints",value:function(e){var t=this.thick/2,i=new THREE.Vector3;i.crossVectors(this.vectorUp,this.direction),i.normalize();var r=i.clone();r.negate(),this.vectorUp.clone().multiplyScalar(t);var n=e.size,o=this.direction,a=e.position,s=n.x/2,l=new THREE.Vector3,u=new THREE.Vector3;return l.subVectors(a,o.clone().multiplyScalar(s)),u.addVectors(a,o.clone().multiplyScalar(s)),[l.clone().addVectors(l,i.clone().multiplyScalar(t)),l.clone().addVectors(l,r.clone().multiplyScalar(t)),u.clone().addVectors(u,r.clone().multiplyScalar(t)),u.clone().addVectors(u,i.clone().multiplyScalar(t))]}}]),t}(He),Ue=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.model=null,e.objPositions=[],e.objLocalPositions=[],e.objRotations=[],e.objScales=[],e.modelSize=new THREE.Vector3,e.box=new THREE.Box3,e.heightRatio=1,e.modelNumber=-1,e.models=[],e.mesh=new THREE.Object3D,e.wallGroup=e.mesh,e.subWalls=[],e.subCorners=[],e.type="SubModelWall",e}return Te(t,e),Ee(t,[{key:"build",value:function(){this.baseBuild(),this.resource&&(this.resource.ready||Me.enableCombine?this.model=this.resource.model:this.resource.registerListener(this)),null!==this.resource.model&&(this.calObjInfo(),this.instanceModels())}},{key:"resourceCallback",value:function(e){this.model=e.model,this.calObjInfo(),this.instanceModels()}},{key:"instanceModels",value:function(){if(null!==this.model){this.models=[];for(var e=this.modelNumber,t=0;t<e;t++){var i=this.model.clone(),r=this.objPositions[t],n=this.objRotations[t],o=this.objScales[t];i.position.set(r.x,r.y,r.z),i.quaternion.set(n.x,n.y,n.z,n.w),i.scale.set(o.x,o.y,o.z),this.mesh.add(i),this.models.push(i)}}}},{key:"calObjInfo",value:function(){if(this.objPositions=[],this.objRotations=[],this.objScales=[],null!==this.resource.model){this.modelSize=this.resource.modelSize,-1===this.height?this.height=this.modelSize.y:0!==this.modelSize.y?this.heightRatio=this.height/this.modelSize.y:(console.warn("model size is zero "+this.resource.id),this.height=3);var e=new THREE.Vector3(0,-1,0),t=this.modelSize.x,i=(this.modelSize.z,this.modelSize.y),r=this.length/t,n=parseInt(r),o=Math.ceil(r);this.modelNumber=o;var a=o*t,s=new THREE.Vector3,l=this.direction.clone();s.addVectors(this.startCorner.position,l.multiplyScalar(a));var u=new THREE.Vector3;u.crossVectors(this.direction,e),u.normalize();var c=new THREE.Quaternion;0===u.x&&0===u.y&&0===u.z||c.setFromUnitVectors(new THREE.Vector3(0,0,-1),u);var h=.5*t,p=new THREE.Vector3(h,0,0);this.position;p.applyQuaternion(c),c.multiply(new THREE.Quaternion(0,1,0,0));for(var d=0;d<o;d++){var f=d/o,m=new THREE.Vector3;m.lerpVectors(this.startCorner.position,s,f);var g=new THREE.Vector3;g.addVectors(p,m),g.y+=this.suspend,this.objPositions.push(g),this.objRotations.push(c);var v=new THREE.Vector3(1,this.height/i,1);this.objScales.push(v)}var y=(r-n)*t,b=y/t;if(o>0&&y>0){this.objScales[o-1]=new THREE.Vector3(b,this.height/i,1);var _=h,x=new THREE.Vector3(_*(1-b),0,0);x.applyQuaternion(c),this.objPositions[o-1].add(x),this.objPositions[o-1].y=this.suspend}}}}]),t}(Be),Ve=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.model=null,e.objPositions=[],e.objLocalPositions=[],e.objRotations=[],e.objScales=[],e.modelSize=new THREE.Vector3,e.box=new THREE.Box3,e.heightRatio=1,e.modelNumber=-1,e.models=[],e.subWalls=[],e.subCorners=[],e.isContainer=!1,e.type="ModelWall",e}return Te(t,e),Ee(t,[{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);if(this.createMesh(),this.doorOrWindows.length>0){this.baseBuild(),this.initSimpleCornersAndWalls(),this.mesh=new THREE.Object3D;for(var e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.mesh.add(t.mesh),this.wallGroup=this.mesh}}else this.baseBuild(),this.calObjInfo(),this.instanceModels();this.processWhenBuildFinish()}}},{key:"resourceCallback",value:function(e){this.model=e.model,this.build()}},{key:"instanceModels",value:function(){if(null!==this.model){this.models=[];for(var e=this.modelNumber,t=0;t<e;t++){var i=this.model.clone(),r=this.objPositions[t],n=this.objRotations[t],o=this.objScales[t];i.position.set(r.x,r.y,r.z),i.quaternion.set(n.x,n.y,n.z,n.w),i.scale.set(o.x,o.y,o.z),this.mesh.add(i),this.models.push(i)}}}},{key:"calObjInfo",value:function(){if(this.objPositions=[],this.objRotations=[],this.objScales=[],null!==this.resource.model){this.modelSize=this.resource.modelSize,-1===this.height?this.height=this.modelSize.y:0!==this.modelSize.y?this.heightRatio=this.height/this.modelSize.y:(console.warn("model size is zero "+this.resource.id),this.height=3);var e=new THREE.Vector3(0,-1,0),t=this.modelSize.x,i=(this.modelSize.z,this.modelSize.y),r=this.length/t,n=parseInt(r),o=Math.ceil(r);this.modelNumber=o;var a=o*t,s=new THREE.Vector3,l=this.direction.clone();s.addVectors(this.startCorner.position,l.multiplyScalar(a));var u=new THREE.Vector3;u.crossVectors(this.direction,e),u.normalize();var c=new THREE.Quaternion;0===u.x&&0===u.y&&0===u.z||c.setFromUnitVectors(new THREE.Vector3(0,0,-1),u);var h=.5*t,p=new THREE.Vector3(h,0,0);this.position;p.applyQuaternion(c),c.multiply(new THREE.Quaternion(0,1,0,0));for(var d=0;d<o;d++){var f=d/o,m=new THREE.Vector3;m.lerpVectors(this.startCorner.position,s,f);var g=new THREE.Vector3;g.addVectors(p,m),this.objPositions.push(g),this.objRotations.push(c);var v=new THREE.Vector3(1,this.height/i,1);this.objScales.push(v)}var y=(r-n)*t,b=y/t;if(o>0&&y>0){this.objScales[o-1]=new THREE.Vector3(b,this.height/i,1);var _=h,x=new THREE.Vector3(_*(1-b),0,0);x.applyQuaternion(c),this.objPositions[o-1].add(x)}}}},{key:"initSimpleCornersAndWalls",value:function(){for(var e=this.sortDoorOrWins(),t=0;t<e.length;t++){var i=e[t],r=this.getDoorOrWinStartAndEndPos(i),n=ke.createSubWallCorner(this.id+"_"+t+"_1",r[0],this),o=ke.createSubWallCorner(this.id+"_"+t+"_2",r[1],this);if(this.addSubWallCorner(n),this.addSubWallCorner(o),0===t){var a=new Ue;a.resource=this.resource,this.subWalls.push(a),a.startCorner=this.startCorner,a.endCorner=n,a.startCorner.build(),a.endCorner.build(),a.parentWall=this,a.height=this.height}else{var s=e[t-1],l=this.getDoorOrWinStartAndEndPos(s),u=this.getWallCornerByPos(l[1]),c=new Ue;c.resource=this.resource,this.subWalls.push(c),c.startCorner=u,c.endCorner=n,c.startCorner.build(),c.endCorner.build(),c.parentWall=this,c.height=this.height}if(t===e.length-1){var h=new Ue;h.resource=this.resource,this.subWalls.push(h),h.startCorner=o,h.endCorner=this.endCorner,h.startCorner.build(),h.parentWall=this,h.height=this.height}this.buildHeadAndFootWall(i,n,o)}}},{key:"buildSimpleCornersAndWalls",value:function(){this.wallGroup=new THREE.Object3D;for(var e=0;e<this.subCorners.length;e++){this.subCorners[e].build()}for(e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.wallGroup.add(t.wallGroup)}}},{key:"buildHeadAndFootWall",value:function(e,t,i){if(!this.resource.isSupportHeadAndFootModelWall)return!1;var r=e.suspendPercent;if(0!==r){var n=new Ue;this.subWalls.push(n),n.resource=this.resource,n.parentWall=this,n.startCorner=t,n.endCorner=i,n.height=this.height*r}e.size;var o=e.size.y+this.height*r;if(o<this.height){var a=new Ue;this.subWalls.push(a),a.resource=this.resource,a.parentWall=this,a.startCorner=t,a.endCorner=i,a.suspend=o,a.height=this.height-o}}},{key:"addToParentCollector",value:function(){this.parent.walls.push(this)}},{key:"clear",value:function(){we(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this);for(var e=0;e<this.models.length;e++){var i=this.models[e];this._dispose(i)}this.models=[]}}]),t}(Be),ze=(function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.model=null,e.objPositions=[],e.objLocalPositions=[],e.objRotations=[],e.objScales=[],e.modelSize=new THREE.Vector3,e.box=new THREE.Box3,e.heightRatio=1,e.modelNumber=-1,e.models=[],e.mesh=new THREE.Object3D,e.wallGroup=e.mesh,e.subWalls=[],e.subCorners=[],e.type="SubDoorOrWinModelWall",e}Te(t,e),Ee(t,[{key:"build",value:function(){this.baseBuild(),this.resource&&(this.resource.ready||Me.enableCombine?this.model=this.resource.model:this.resource.registerListener(this)),null!==this.model&&(this.calObjInfo(),this.enableBuildMesh&&this.instanceModels())}},{key:"resourceCallback",value:function(e){this.model=e.model,this.calObjInfo(),this.instanceModels()}},{key:"instanceModels",value:function(){if(null!==this.model){this.models=[];for(var e=this.modelNumber,t=0;t<e;t++){var i=this.model.clone(),r=this.objPositions[t],n=this.objRotations[t],o=this.objScales[t];i.position.set(r.x,r.y,r.z),i.quaternion.set(n.x,n.y,n.z,n.w),i.scale.set(o.x,o.y,o.z),this.mesh.add(i),this.models.push(i)}}}},{key:"calObjInfo",value:function(){if(this.objPositions=[],this.objRotations=[],this.objScales=[],null!==this.model){this.box.makeEmpty(),this.box=this.box.setFromObject(this.model),this.modelSize=this.box.getSize(new THREE.Vector3(0,0,0)),-1===this.height?this.height=this.modelSize.y:0!==this.modelSize.y?this.heightRatio=this.height/this.modelSize.y:(console.warn("model size is zero "+this.resource.id),this.height=3);var e=new THREE.Vector3(0,-1,0),t=this.modelSize.x,i=(this.modelSize.z,this.modelSize.y),r=this.length/t,n=parseInt(r),o=Math.ceil(r);this.modelNumber=o;var a=o*t,s=new THREE.Vector3,l=this.direction.clone();s.addVectors(this.startCorner.position,l.multiplyScalar(a));var u=new THREE.Vector3;u.crossVectors(this.direction,e),u.normalize();var c=new THREE.Quaternion;0===u.x&&0===u.y&&0===u.z||c.setFromUnitVectors(new THREE.Vector3(0,0,-1),u);var h=.5*t,p=new THREE.Vector3(h,0,0);this.position;p.applyQuaternion(c),c.multiply(new THREE.Quaternion(0,1,0,0));for(var d=0;d<o;d++){var f=d/o,m=new THREE.Vector3;m.lerpVectors(this.startCorner.position,s,f);var g=new THREE.Vector3;g.addVectors(p,m),this.objPositions.push(g),this.objRotations.push(c);var v=new THREE.Vector3(1,this.height/i,1);this.objScales.push(v)}var y=(r-n)*t,b=y/t;if(o>0&&y>0){this.objScales[o-1]=new THREE.Vector3(b,this.height/i,1);var _=h,x=new THREE.Vector3(_*(1-b),0,0);x.applyQuaternion(c),this.objPositions[o-1].add(x)}}}}])}(Be),function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.floorplans=[],e.facades=[],e.facadeGroups=[],e.isContainer=!0,e.type="Building",e.structShow=!1,e}return Te(t,e),Ee(t,[{key:"build",value:function(){this.createMesh();for(var e=0;e<this.children.length;e++){this.children[e].build()}}},{key:"registerBuildedCallbackToChildren",value:function(){for(var e=0;e<this.children.length;e++){this.children[e].registerBuildCallbackListener(this.childBuildedCallback)}}},{key:"childBuildedCallback",value:function(e){for(var t=e.parent,i=0;i<t.children.length;i++){if(!t.children[i].isBuilded)return}t.processWhenBuildFinish()}},{key:"addToParentCollector",value:function(){we(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.buildings.push(this)}},{key:"children",get:function(){return null===this._children&&(this._children=[],this._children=this._children.concat(this.facades).concat(this.facadeGroups).concat(this.floorplans)),this._children}},{key:"size",get:function(){return null===this._size&&(this._size=new THREE.Vector3,this.boundingBox.isEmpty()||this.boundingBox.getSize(this._size)),this._size}},{key:"boxMesh",get:function(){if(null===this._boxMesh){for(var e=new THREE.Object3D,t=0;t<this.children.length;t++){var i=this.children[t];e.attach(i.boxMesh)}e.scale.copy(this.scale),e.quaternion.copy(this.rotation),e.position.copy(this.position),e.position.y=(this.position.y+this.scale.y)/2,this._boxMesh=e}return this._boxMesh}}]),t}(Re)),qe=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.points=[],e.resource=null,e.color=null,e.mesh=null,e.texture=null,e.initCompleteCallback=null,e.width=null,e.type="CurveLine",e.enableMaterialAnimation=!1,e.materialAnimationSpeed=1,e.textureTiling=new THREE.Vector2(1,1),e.textureOffset=new THREE.Vector2(0,0),e}return Te(t,e),Ee(t,[{key:"initResource",value:function(){this.resource&&(this.resource.ready?this.texture=this.resource.texture:this.resource.registerListener(this))}},{key:"resourceCallback",value:function(e){this.mesh||(this.texture=e.texture,this.initCompleteCallback&&this.initCompleteCallback(this))}},{key:"addToParentCollector",value:function(){this.parent.curvelines.push(this)}}]),t}(Re),We=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.arrowResource=null,e.arrowWidth=null,e.arrowHeight=null,e._isMultiResources=!0,e._resources=null,e.type="ArrowLine",e}return Te(t,e),Ee(t,[{key:"initResource",value:function(){this.downloadResource(this.resource),this.downloadResource(this.arrowResource)}},{key:"downloadResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"checkResourceReady",value:function(){for(var e=0;e<this.resources.length;e++){if(!this.resources[e].ready)return!1}return!0}},{key:"resourceCallback",value:function(e){this.checkResourceReady()&&this.build()}},{key:"addToParentCollector",value:function(){this.parent.arrowLines.push(this)}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this._resources.push(this.resource),this._resources.push(this.arrowResource)),this._resources}}]),t}(qe),Ge=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="ArrowDataLine",e}return Te(t,e),Ee(t,[{key:"addToParentCollector",value:function(){this.parent.arrowDataLines.push(this)}}]),t}(We),Xe=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.model=null,e.customColor=null,e.opacity=null,e.renderMode=null,e.initCompleteCallback=null,e.customTextureResource=null,e.hasSkin=!1,e.isPlayAnim=!1,e.animClip=null,e.isResouceRegistered=!1,e.belongRoomUserID=null,e._size=null,e.type="Placement",e}return Te(t,e),Ee(t,[{key:"createMesh",value:function(){we(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"createMesh",this).call(this),this.instanceModel()}},{key:"instanceModel",value:function(){this.mesh=Ce.clone(this.resource.model),this.hasSkin=this.mesh.hasSkin,this.mesh.name="placement",this.mesh.position.set(this.position.x,this.position.y,this.position.z),this.mesh.quaternion.set(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w),this.mesh.scale.set(this.scale.x,this.scale.y,this.scale.z),this.mesh.visible=this.isShow,this.mesh.name="plc"+this.id,null!==this.renderMode&&this.changeRenderMode(this.mesh),this.customTextureResource&&this.changeWithCustomTexture(this.mesh),this.customColor&&this.changeWithCustomColor(this.mesh)}},{key:"changeRenderMode",value:function(e){if(e instanceof THREE.Mesh&&(e.material.color=this.customColor,null!==this.renderMode))switch(this.renderMode){case 1:e.material.transparent=!1,e.material.alphaTest=.5;break;case 3:case 2:e.material.transparent=!0;break;default:console.error("can not find renderMode "+this.renderMode)}for(var t=0;t<e.children.length;t++){var i=e.children[t];this.changeRenderMode(i)}}},{key:"changeWithCustomColor",value:function(e){e instanceof THREE.Mesh&&(e.material.color=this.customColor,null!==this.opacity&&(e.material.opacity=this.opacity,e.material.transparent=!0));for(var t=0;t<e.children.length;t++){var i=e.children[t];this.changeWithCustomColor(i)}}},{key:"changeWithCustomTexture",value:function(e){e instanceof THREE.Mesh&&(e.material.map=this.customTextureResource.texture);for(var t=0;t<e.children.length;t++){var i=e.children[t];this.changeWithCustomTexture(i)}}},{key:"addToParentCollector",value:function(){we(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.placements.push(this)}},{key:"isMultiResources",get:function(){return this.customTextureResource?this._isMultiResources=!0:this._isMultiResources=!1,this._isMultiResources}},{key:"resources",get:function(){return[this.resource,this.customTextureResource]}}]),t}(Re),Ye=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.groups=[],e.placements=[],e.belongRoomUserID=null,e._isMultiResources=!0,e.isContainer=!0,e.type="PlacementGroup",e.enableCreateMesh=!0,e}return Te(t,e),Ee(t,[{key:"build",value:function(){if(!this.isBuilded){if(!this.checkChildrenResourcesReady())return void this.initChildrenResource();this.createMesh(),this._isBuilded=!0}}},{key:"childBuildedCallback",value:function(e){var t=e.parent;t.isBuilded&&(this.createMesh(),t.processWhenBuildFinish())}},{key:"createMesh",value:function(){we(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"createMesh",this).call(this);for(var e=0;e<this.groups.length;e++){var i=this.groups[e];i.build(),this.enableCreateMesh&&this.mesh.add(i.mesh)}for(e=0;e<this.placements.length;e++){var r=this.placements[e];r.build(),this.enableCreateMesh&&this.mesh.add(r.mesh)}this.enableCreateMesh&&(this.mesh.position.set(this.position.x,this.position.y,this.position.z),this.mesh.quaternion.set(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w),this.mesh.scale.set(this.scale.x,this.scale.y,this.scale.z),this.mesh.visible=this.isShow)}},{key:"collectChildrenResources",value:function(){this._childrenResources=[];for(var e=0;e<this.placements.length;e++){var t=this.placements[e];this._checkResourceRepeat(t.resource)||this._childrenResources.push(t.resource)}for(var i=0;i<this.groups.length;i++){var r=this.groups[i];r.collectChildrenResources();for(var n=0;n<r.childrenResources.length;n++){var o=r.childrenResources[n];this._checkResourceRepeat(o)||this._childrenResources.push(o)}}}},{key:"_checkResourceRepeat",value:function(e){for(var t=0;t<this.childrenResources.length;t++){if(this.childrenResources[t]===e)return!0}return!1}},{key:"checkChildrenResourcesReady",value:function(){for(var e=0;e<this.childrenResources.length;e++){if(!this.childrenResources[e].ready)return!1}return!0}},{key:"initChildrenResource",value:function(){for(var e=0;e<this.childrenResources.length;e++){var t=this.childrenResources[e];this.initResource(t)}}},{key:"resourceCallback",value:function(e){this.checkChildrenResourcesReady()&&this.build()}},{key:"addToParentCollector",value:function(){we(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.groups.push(this)}},{key:"belongRoomUserID",set:function(e){this._belongRoomUserID=e;for(var t=0;t<this.placements.length;t++){this.placements[t].belongRoomUserID=e}for(var i=0;i<this.groups.length;i++){this.groups[i].belongRoomUserID=e}},get:function(){return this._belongRoomUserID}},{key:"children",get:function(){return null===this._children&&(this._children=[],this._children=this._children.concat(this.groups).concat(this.placements)),this._children}},{key:"size",get:function(){return null===this._size&&(this._size=new THREE.Vector3,this.boundingBox.isEmpty()||this.boundingBox.getSize(this._size)),this._size}},{key:"boxMesh",get:function(){if(null===this._boxMesh){for(var e=new THREE.Object3D,t=0;t<this.placements.length;t++){var i=this.placements[t];e.add(i.boxMesh)}for(var r=0;r<this.groups.length;r++){var n=this.groups[r];e.add(n.boxMesh)}e.scale.copy(this.scale),e.quaternion.copy(this.rotation),e.position.copy(this.position),e.position.y=(this.position.y+this.scale.y)/2,this._boxMesh=e}return this._boxMesh}},{key:"resources",get:function(){return this.childrenResources}}]),t}(Re),Je=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="FacadeGroup",e}return Te(t,e),Ee(t,[{key:"build",value:function(){we(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"build",this).call(this)}},{key:"addToParentCollector",value:function(){var e=this.parent;e instanceof ze?e.facadeGroups.push(this):e.groups.push(this)}}]),t}(Ye),Qe=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Facade",e}return Te(t,e),Ee(t,[{key:"build",value:function(){we(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"build",this).call(this)}},{key:"addToParentCollector",value:function(){this.parent instanceof Je?this.parent.placements.push(this):this.parent.facades.push(this)}}]),t}(Xe),Ze=0,Ke=1,$e=2,et=3,tt=0,it=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.suspendPercent=0,e.attachWall=null,e.isOpen=!1,e.openDirIndex=0,e.modelSize=null,e.isWindow=!1,e.type="DoorOrWindow",e}return Te(t,e),Ee(t,[{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);this.initModelSize(),this.createMesh(),this.fitAttachWall(),this.instanceModel(),this.changeOpenDirection(),this.processWhenBuildFinish()}}},{key:"resourceCallback",value:function(e){this.build()}},{key:"fitAttachWall",value:function(){if(this.attachWall){var e=this.attachWall.direction,t=new THREE.Vector3;t.crossVectors(new THREE.Vector3(0,-1,0),e),this.rotation.setFromUnitVectors(new THREE.Vector3(0,0,-1),t),this.position.y=this.attachWall.height*this.suspendPercent}}},{key:"getOpenController",value:function(){return this.mesh?this.mesh.getObjectByName("Controller"):null}},{key:"isSingleOpen",value:function(){var e=this.getOpenController();return!!e&&1===e.children.length}},{key:"changeOpenDirection",value:function(){(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI);var e=this.getOpenController(),t=this.mesh.getObjectByName("RootNode");if(t&&e)if(this.isSingleOpen())switch(this.openDirIndex){case Ze:t.rotateY(Math.PI),e.scale.set(-1,1,1);break;case Ke:t.rotateY(Math.PI);break;case $e:break;case et:e.scale.set(-1,1,1)}else switch(this.openDirIndex){case tt:t.rotateY(Math.PI)}}},{key:"initModelSize",value:function(){this.modelSize=this.resource.modelSize,this.resource.model&&this.size.set(this.modelSize.x*this.scale.x,this.modelSize.y*this.scale.y,this.modelSize.z*this.scale.z)}},{key:"addToParentCollector",value:function(){this.parent.doorOrWindows.push(this)}}]),t}(Xe),rt=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.walls=[],e.corners=[],e.rooms=[],e.placements=[],e.videoprobes=[],e.curvelines=[],e.arrowLines=[],e.arrowDataLines=[],e.leakWaterLines=[],e.pipelines=[],e.text3Ds=[],e.doorOrWindows=[],e.routeLines=[],e.placementGrounds=[],e.groups=[],e.height=3,e.alwaysShowInsideObjs=!1,e.combinePlacements=[],e.combineStraightManualWalls=[],e.combineModelWalls=[],e.combineRoofs=[],e.combineCeilings=[],e.combineFloors=[],e.combineDoorOrWins=[],e.combinePlacementObjects=[],e.combineStraightManualWallObjects=[],e.combineModelWallObjects=[],e.combineRoofObjects=[],e.combineCeilingObjects=[],e.combineFloorObjects=[],e.combineDoorOrWindowObjects=[],e.combinePlacementWallObjects=[],e.isContainer=!0,e.type="FloorPlan",e}return Te(t,e),Ee(t,[{key:"build",value:function(){if(this.createMesh(),this.children.length>0)for(var e=0;e<this.children.length;e++){this.children[e].build()}else this._isBuilded=!0}},{key:"fillChildren",value:function(){this._children=[],this._children=this._children.concat(this.corners).concat(this.combineStraightManualWallObjects).concat(this.combineModelWallObjects).concat(this.combinePlacementWallObjects).concat(this.rooms).concat(this.walls).concat(this.combineFloorObjects).concat(this.combineRoofObjects).concat(this.combineCeilingObjects).concat(this.combinePlacementObjects).concat(this.combineDoorOrWindowObjects).concat(this.doorOrWindows).concat(this.placements).concat(this.groups).concat(this.videoprobes).concat(this.curvelines).concat(this.leakWaterLines).concat(this.arrowLines).concat(this.arrowDataLines).concat(this.pipelines).concat(this.placementGrounds).concat(this.routeLines)}},{key:"registerBuildedCallbackToChildren",value:function(){for(var e=0;e<this.children.length;e++){this.children[e].registerBuildCallbackListener(this.childBuildedCallback)}}},{key:"childBuildedCallback",value:function(e){var t=e.parent;t.isBuilded&&t.processWhenBuildFinish()}},{key:"existsCorner",value:function(e,t,i){for(var r=0,n=this.corners.length;r<n;r++){var o=this.corners[r].position;if(o.x===e&&o.y===t&&o.z===i)return!0}return!1}},{key:"addCorner",value:function(e,t,i){var r=new Oe(e,t,i);return r.parent=this,r}},{key:"getCorner",value:function(e,t,i){for(var r=0,n=this.corners.length;r<n;r++){var o=this.corners[r].position;if(o.x===e&&o.y===t&&o.z===i)return this.corners[r]}return null}},{key:"exportTestXS",value:function(){for(var e={points:[],edges:[]},t=[],i=[],r=0;r<this.corners.length;r++){var n=this.corners[r];t.push([n.position.x,n.position.z])}for(r=0;r<this.walls.length;r++){var o=this.walls[r];i.push([this.corners.indexOf(o.startCorner),this.corners.indexOf(o.endCorner)])}return e.points=t,e.edges=i,e}},{key:"addToParentCollector",value:function(){we(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent instanceof ze&&this.parent.floorplans.push(this)}},{key:"calRoomsUV2",value:function(){for(var e=0;e<this.rooms.length;e++){this.rooms[e].floor.calGeometry()}var t=this._calAllFloorBox2(this);this._fillUV2ToRooms(this.rooms,t);for(var i=0;i<this.rooms.length;i++){this.rooms[i].floor.clear()}}},{key:"_fillUV2ToRooms",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=this._calFloorUV2(r,t);this._fillUV2ToFloor(r,n)}}},{key:"_calFloorUV2",value:function(e,t){var i=[],r=new THREE.Vector2;t.getSize(r);for(var n=e.floor.geometry.vertices,o=this._getFloorPosition(e),a=0;a<n.length;a++){var s=n[a].clone();s.x+=o.x,s.y+=o.z;var l=(s.x-t.min.x)/r.x,u=(s.y-t.min.y)/r.y;i.push(new THREE.Vector2(parseFloat(l.toFixed(2)),parseFloat(u.toFixed(2))))}return i}},{key:"_fillUV2ToFloor",value:function(e,t){for(var i=e.floor.geometry.faces,r=[],n=0;n<i.length;n++){var o=i[n],a=[t[o.a],t[o.b],t[o.c]];r.push(a)}e.uv2=r}},{key:"_calAllFloorBox2",value:function(e){for(var t=new THREE.Box2,i=0;i<e.rooms.length;i++){var r=e.rooms[i];null===r.floor.geometry&&r.floor.calGeometry();for(var n=this._getFloorPosition(r),o=r.floor.geometry.vertices,a=0;a<o.length;a++){var s=o[a].clone();s.x+=n.x,s.y+=n.z,t.expandByPoint(s)}}return t}},{key:"_getFloorPosition",value:function(e){var t=e.position.clone();return t.z=-t.z,t}},{key:"children",get:function(){return null===this._children&&this.fillChildren(),this._children}},{key:"size",get:function(){return null===this._size&&(this._size=new THREE.Vector3,this.boundingBox.isEmpty()||this.boundingBox.getSize(this._size)),this._size}},{key:"boxMesh",get:function(){if(null===this._boxMesh){for(var e=new THREE.Geometry,t=new THREE.PointsMaterial({color:8947848}),i=new THREE.Points(e,t),r=0;r<this.children.length;r++){var n=this.children[r];if("WallCorner"===n.type){e.vertices.push(n.position);var o=n.position.clone();o.y=this.height,e.vertices.push(o)}}if(0===e.vertices.length){e.vertices.push(this.position);var a=this.position.clone();a.y=this.height,e.vertices.push(a)}i.position.copy(this.position),this._boxMesh=i}return this._boxMesh}}]),t}(Re),nt=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Outdoors",e}return Te(t,e),Ee(t,[{key:"build",value:function(){for(var e=0;e<this.rooms.length;e++){this.rooms[e].isOnlyFloor=!0}we(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"build",this).call(this)}}]),t}(rt),ot=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.points=[],e.resource=null,e.color=new THREE.Color(0,0,1),e.mesh=null,e.texture=null,e.initCompleteCallback=null,e.renderMode=null,e.opacity=null,e.radius=null,e.sectionType=null,e.type="PipeLine",e.enableMaterialAnimation=!1,e.materialAnimationSpeed=1,e.textureTiling=new THREE.Vector2(.5,.5),e.textureOffset=new THREE.Vector2(0,0),e}return Te(t,e),Ee(t,[{key:"initResource",value:function(){this.resource&&(this.resource.ready?this.texture=this.resource.texture:this.resource.registerListener(this))}},{key:"resourceCallback",value:function(e){this.mesh||(this.texture=e.texture,this.initCompleteCallback&&this.initCompleteCallback(this))}},{key:"addToParentCollector",value:function(){this.parent.pipelines.push(this)}}]),t}(Re),at=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.radius=.2,e.color=new THREE.Color(1,1,1),e.type="LeakWaterLine",e.alarmLength=null,e}return Te(t,e),Ee(t,[{key:"addToParentCollector",value:function(){this.parent.leakWaterLines.push(this)}}]),t}(ot),st=(function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.text=null,e.color=null,e.font=null,e.opacity=null,e.mesh=null,e.type="Text3D",e}Te(t,e),Ee(t,[{key:"build",value:function(){var e=new THREE.TextGeometry(this.text,{font:t.getFont(),size:80,height:1,curveSegments:2});e.computeBoundingBox();var i=-.5*(e.boundingBox.max.x-e.boundingBox.min.x),r=[new THREE.MeshBasicMaterial({color:16777215*Math.random(),overdraw:.5}),new THREE.MeshBasicMaterial({color:0,overdraw:.5})],n=new THREE.Mesh(e,r);n.position.x=i,n.position.y=100,n.position.z=0,n.rotation.x=0,n.rotation.y=2*Math.PI,this.mesh=n}}],[{key:"getFont",value:function(){return t.font?t.font:new THREE.Font({glyphs:{"ο":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 96 88 192 -25 q 0 368 0 201 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 "},S:{x_min:0,x_max:788,ha:890,o:"m 788 291 q 662 54 788 144 q 397 -26 550 -26 q 116 68 226 -26 q 0 337 0 168 l 131 337 q 200 152 131 220 q 384 85 269 85 q 557 129 479 85 q 650 270 650 183 q 490 429 650 379 q 194 513 341 470 q 33 739 33 584 q 142 964 33 881 q 388 1041 242 1041 q 644 957 543 1041 q 756 716 756 867 l 625 716 q 561 874 625 816 q 395 933 497 933 q 243 891 309 933 q 164 759 164 841 q 325 609 164 656 q 625 526 475 568 q 788 291 788 454 "},"¦":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"/":{x_min:183.25,x_max:608.328125,ha:792,o:"m 608 1041 l 266 -129 l 183 -129 l 520 1041 l 608 1041 "},"Τ":{x_min:-.4375,x_max:777.453125,ha:839,o:"m 777 893 l 458 893 l 458 0 l 319 0 l 319 892 l 0 892 l 0 1013 l 777 1013 l 777 893 "},y:{x_min:0,x_max:684.78125,ha:771,o:"m 684 738 l 388 -83 q 311 -216 356 -167 q 173 -279 252 -279 q 97 -266 133 -279 l 97 -149 q 132 -155 109 -151 q 168 -160 155 -160 q 240 -114 213 -160 q 274 -26 248 -98 l 0 738 l 137 737 l 341 139 l 548 737 l 684 738 "},"Π":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 803 1012 l 803 0 "},"ΐ":{x_min:-111,x_max:339,ha:361,o:"m 339 800 l 229 800 l 229 925 l 339 925 l 339 800 m -1 800 l -111 800 l -111 925 l -1 925 l -1 800 m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 m 302 1040 l 113 819 l 30 819 l 165 1040 l 302 1040 "},g:{x_min:0,x_max:686,ha:838,o:"m 686 34 q 586 -213 686 -121 q 331 -306 487 -306 q 131 -252 216 -306 q 31 -84 31 -190 l 155 -84 q 228 -174 166 -138 q 345 -207 284 -207 q 514 -109 454 -207 q 564 89 564 -27 q 461 6 521 36 q 335 -23 401 -23 q 88 100 184 -23 q 0 370 0 215 q 87 634 0 522 q 330 758 183 758 q 457 728 398 758 q 564 644 515 699 l 564 737 l 686 737 l 686 34 m 582 367 q 529 560 582 481 q 358 652 468 652 q 189 561 250 652 q 135 369 135 482 q 189 176 135 255 q 361 85 251 85 q 529 176 468 85 q 582 367 582 255 "},"²":{x_min:0,x_max:442,ha:539,o:"m 442 383 l 0 383 q 91 566 0 492 q 260 668 176 617 q 354 798 354 727 q 315 875 354 845 q 227 905 277 905 q 136 869 173 905 q 99 761 99 833 l 14 761 q 82 922 14 864 q 232 974 141 974 q 379 926 316 974 q 442 797 442 878 q 351 635 442 704 q 183 539 321 611 q 92 455 92 491 l 442 455 l 442 383 "},"–":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},"Κ":{x_min:0,x_max:819.5625,ha:893,o:"m 819 0 l 650 0 l 294 509 l 139 356 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},"ƒ":{x_min:-46.265625,x_max:392,ha:513,o:"m 392 651 l 259 651 l 79 -279 l -46 -278 l 134 651 l 14 651 l 14 751 l 135 751 q 151 948 135 900 q 304 1041 185 1041 q 334 1040 319 1041 q 392 1034 348 1039 l 392 922 q 337 931 360 931 q 271 883 287 931 q 260 793 260 853 l 260 751 l 392 751 l 392 651 "},e:{x_min:0,x_max:714,ha:813,o:"m 714 326 l 140 326 q 200 157 140 227 q 359 87 260 87 q 488 130 431 87 q 561 245 545 174 l 697 245 q 577 48 670 123 q 358 -26 484 -26 q 97 85 195 -26 q 0 363 0 197 q 94 642 0 529 q 358 765 195 765 q 626 627 529 765 q 714 326 714 503 m 576 429 q 507 583 564 522 q 355 650 445 650 q 206 583 266 650 q 140 429 152 522 l 576 429 "},"ό":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 94 91 194 -25 q 0 368 0 202 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 m 576 1040 l 387 819 l 303 819 l 438 1040 l 576 1040 "},J:{x_min:0,x_max:588,ha:699,o:"m 588 279 q 287 -26 588 -26 q 58 73 126 -26 q 0 327 0 158 l 133 327 q 160 172 133 227 q 288 96 198 96 q 426 171 391 96 q 449 336 449 219 l 449 1013 l 588 1013 l 588 279 "},"»":{x_min:-1,x_max:503,ha:601,o:"m 503 302 l 280 136 l 281 256 l 429 373 l 281 486 l 280 608 l 503 440 l 503 302 m 221 302 l 0 136 l 0 255 l 145 372 l 0 486 l -1 608 l 221 440 l 221 302 "},"©":{x_min:-3,x_max:1008,ha:1106,o:"m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 741 394 q 661 246 731 302 q 496 190 591 190 q 294 285 369 190 q 228 497 228 370 q 295 714 228 625 q 499 813 370 813 q 656 762 588 813 q 733 625 724 711 l 634 625 q 589 704 629 673 q 498 735 550 735 q 377 666 421 735 q 334 504 334 597 q 374 340 334 408 q 490 272 415 272 q 589 304 549 272 q 638 394 628 337 l 741 394 "},"ώ":{x_min:0,x_max:922,ha:1030,o:"m 687 1040 l 498 819 l 415 819 l 549 1040 l 687 1040 m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 338 0 202 q 45 551 0 444 q 161 737 84 643 l 302 737 q 175 552 219 647 q 124 336 124 446 q 155 179 124 248 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 341 797 257 q 745 555 797 450 q 619 737 705 637 l 760 737 q 874 551 835 640 q 922 339 922 444 "},"^":{x_min:193.0625,x_max:598.609375,ha:792,o:"m 598 772 l 515 772 l 395 931 l 277 772 l 193 772 l 326 1013 l 462 1013 l 598 772 "},"«":{x_min:0,x_max:507.203125,ha:604,o:"m 506 136 l 284 302 l 284 440 l 506 608 l 507 485 l 360 371 l 506 255 l 506 136 m 222 136 l 0 302 l 0 440 l 222 608 l 221 486 l 73 373 l 222 256 l 222 136 "},D:{x_min:0,x_max:828,ha:935,o:"m 389 1013 q 714 867 593 1013 q 828 521 828 729 q 712 161 828 309 q 382 0 587 0 l 0 0 l 0 1013 l 389 1013 m 376 124 q 607 247 523 124 q 681 510 681 355 q 607 771 681 662 q 376 896 522 896 l 139 896 l 139 124 l 376 124 "},"∙":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"ÿ":{x_min:0,x_max:47,ha:125,o:"m 47 3 q 37 -7 47 -7 q 28 0 30 -7 q 39 -4 32 -4 q 45 3 45 -1 l 37 0 q 28 9 28 0 q 39 19 28 19 l 47 16 l 47 19 l 47 3 m 37 1 q 44 8 44 1 q 37 16 44 16 q 30 8 30 16 q 37 1 30 1 m 26 1 l 23 22 l 14 0 l 3 22 l 3 3 l 0 25 l 13 1 l 22 25 l 26 1 "},w:{x_min:0,x_max:1009.71875,ha:1100,o:"m 1009 738 l 783 0 l 658 0 l 501 567 l 345 0 l 222 0 l 0 738 l 130 738 l 284 174 l 432 737 l 576 738 l 721 173 l 881 737 l 1009 738 "},$:{x_min:0,x_max:700,ha:793,o:"m 664 717 l 542 717 q 490 825 531 785 q 381 872 450 865 l 381 551 q 620 446 540 522 q 700 241 700 370 q 618 45 700 116 q 381 -25 536 -25 l 381 -152 l 307 -152 l 307 -25 q 81 62 162 -25 q 0 297 0 149 l 124 297 q 169 146 124 204 q 307 81 215 89 l 307 441 q 80 536 148 469 q 13 725 13 603 q 96 910 13 839 q 307 982 180 982 l 307 1077 l 381 1077 l 381 982 q 574 917 494 982 q 664 717 664 845 m 307 565 l 307 872 q 187 831 233 872 q 142 724 142 791 q 180 618 142 656 q 307 565 218 580 m 381 76 q 562 237 562 96 q 517 361 562 313 q 381 423 472 409 l 381 76 "},"\\":{x_min:-.015625,x_max:425.0625,ha:522,o:"m 425 -129 l 337 -129 l 0 1041 l 83 1041 l 425 -129 "},"µ":{x_min:0,x_max:697.21875,ha:747,o:"m 697 -4 q 629 -14 658 -14 q 498 97 513 -14 q 422 9 470 41 q 313 -23 374 -23 q 207 4 258 -23 q 119 81 156 32 l 119 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 173 124 246 q 308 83 216 83 q 452 178 402 83 q 493 359 493 255 l 493 738 l 617 738 l 617 214 q 623 136 617 160 q 673 92 637 92 q 697 96 684 92 l 697 -4 "},"Ι":{x_min:42,x_max:181,ha:297,o:"m 181 0 l 42 0 l 42 1013 l 181 1013 l 181 0 "},"Ύ":{x_min:0,x_max:1144.5,ha:1214,o:"m 1144 1012 l 807 416 l 807 0 l 667 0 l 667 416 l 325 1012 l 465 1012 l 736 533 l 1004 1012 l 1144 1012 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"’":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"Ν":{x_min:0,x_max:801,ha:915,o:"m 801 0 l 651 0 l 131 822 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 191 l 670 1013 l 801 1013 l 801 0 "},"-":{x_min:8.71875,x_max:350.390625,ha:478,o:"m 350 317 l 8 317 l 8 428 l 350 428 l 350 317 "},Q:{x_min:0,x_max:968,ha:1072,o:"m 954 5 l 887 -79 l 744 35 q 622 -11 687 2 q 483 -26 556 -26 q 127 130 262 -26 q 0 504 0 279 q 127 880 0 728 q 484 1041 262 1041 q 841 884 708 1041 q 968 507 968 735 q 933 293 968 398 q 832 104 899 188 l 954 5 m 723 191 q 802 330 777 248 q 828 499 828 412 q 744 790 828 673 q 483 922 650 922 q 228 791 322 922 q 142 505 142 673 q 227 221 142 337 q 487 91 323 91 q 632 123 566 91 l 520 215 l 587 301 l 723 191 "},"ς":{x_min:1,x_max:676.28125,ha:740,o:"m 676 460 l 551 460 q 498 595 542 546 q 365 651 448 651 q 199 578 263 651 q 136 401 136 505 q 266 178 136 241 q 508 106 387 142 q 640 -50 640 62 q 625 -158 640 -105 q 583 -278 611 -211 l 465 -278 q 498 -182 490 -211 q 515 -80 515 -126 q 381 12 515 -15 q 134 91 197 51 q 1 388 1 179 q 100 651 1 542 q 354 761 199 761 q 587 680 498 761 q 676 460 676 599 "},M:{x_min:0,x_max:954,ha:1067,o:"m 954 0 l 819 0 l 819 869 l 537 0 l 405 0 l 128 866 l 128 0 l 0 0 l 0 1013 l 200 1013 l 472 160 l 757 1013 l 954 1013 l 954 0 "},"Ψ":{x_min:0,x_max:1006,ha:1094,o:"m 1006 678 q 914 319 1006 429 q 571 200 814 200 l 571 0 l 433 0 l 433 200 q 92 319 194 200 q 0 678 0 429 l 0 1013 l 139 1013 l 139 679 q 191 417 139 492 q 433 326 255 326 l 433 1013 l 571 1013 l 571 326 l 580 326 q 813 423 747 326 q 868 679 868 502 l 868 1013 l 1006 1013 l 1006 678 "},C:{x_min:0,x_max:886,ha:944,o:"m 886 379 q 760 87 886 201 q 455 -26 634 -26 q 112 136 236 -26 q 0 509 0 283 q 118 882 0 737 q 469 1041 245 1041 q 748 955 630 1041 q 879 708 879 859 l 745 708 q 649 862 724 805 q 473 920 573 920 q 219 791 312 920 q 136 509 136 675 q 217 229 136 344 q 470 99 311 99 q 672 179 591 99 q 753 379 753 259 l 886 379 "},"!":{x_min:0,x_max:138,ha:236,o:"m 138 684 q 116 409 138 629 q 105 244 105 299 l 33 244 q 16 465 33 313 q 0 684 0 616 l 0 1013 l 138 1013 l 138 684 m 138 0 l 0 0 l 0 151 l 138 151 l 138 0 "},"{":{x_min:0,x_max:480.5625,ha:578,o:"m 480 -286 q 237 -213 303 -286 q 187 -45 187 -159 q 194 48 187 -15 q 201 141 201 112 q 164 264 201 225 q 0 314 118 314 l 0 417 q 164 471 119 417 q 201 605 201 514 q 199 665 201 644 q 193 772 193 769 q 241 941 193 887 q 480 1015 308 1015 l 480 915 q 336 866 375 915 q 306 742 306 828 q 310 662 306 717 q 314 577 314 606 q 288 452 314 500 q 176 365 256 391 q 289 275 257 337 q 314 143 314 226 q 313 84 314 107 q 310 -11 310 -5 q 339 -131 310 -94 q 480 -182 377 -182 l 480 -286 "},X:{x_min:-.015625,x_max:854.15625,ha:940,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 428 637 l 675 1013 l 836 1013 l 504 520 l 854 0 "},"#":{x_min:0,x_max:963.890625,ha:1061,o:"m 963 690 l 927 590 l 719 590 l 655 410 l 876 410 l 840 310 l 618 310 l 508 -3 l 393 -2 l 506 309 l 329 310 l 215 -2 l 102 -3 l 212 310 l 0 310 l 36 410 l 248 409 l 312 590 l 86 590 l 120 690 l 347 690 l 459 1006 l 573 1006 l 462 690 l 640 690 l 751 1006 l 865 1006 l 754 690 l 963 690 m 606 590 l 425 590 l 362 410 l 543 410 l 606 590 "},"ι":{x_min:42,x_max:284,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 738 l 167 738 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 "},"Ά":{x_min:0,x_max:906.953125,ha:982,o:"m 283 1040 l 88 799 l 5 799 l 145 1040 l 283 1040 m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1012 l 529 1012 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},")":{x_min:0,x_max:318,ha:415,o:"m 318 365 q 257 25 318 191 q 87 -290 197 -141 l 0 -290 q 140 21 93 -128 q 193 360 193 189 q 141 704 193 537 q 0 1024 97 850 l 87 1024 q 257 706 197 871 q 318 365 318 542 "},"ε":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 314 0 265 q 128 390 67 353 q 56 460 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 "},"Δ":{x_min:0,x_max:952.78125,ha:1028,o:"m 952 0 l 0 0 l 400 1013 l 551 1013 l 952 0 m 762 124 l 476 867 l 187 124 l 762 124 "},"}":{x_min:0,x_max:481,ha:578,o:"m 481 314 q 318 262 364 314 q 282 136 282 222 q 284 65 282 97 q 293 -58 293 -48 q 241 -217 293 -166 q 0 -286 174 -286 l 0 -182 q 143 -130 105 -182 q 171 -2 171 -93 q 168 81 171 22 q 165 144 165 140 q 188 275 165 229 q 306 365 220 339 q 191 455 224 391 q 165 588 165 505 q 168 681 165 624 q 171 742 171 737 q 141 865 171 827 q 0 915 102 915 l 0 1015 q 243 942 176 1015 q 293 773 293 888 q 287 675 293 741 q 282 590 282 608 q 318 466 282 505 q 481 417 364 417 l 481 314 "},"‰":{x_min:-3,x_max:1672,ha:1821,o:"m 846 0 q 664 76 732 0 q 603 244 603 145 q 662 412 603 344 q 846 489 729 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 846 0 962 0 m 845 103 q 945 143 910 103 q 981 243 981 184 q 947 340 981 301 q 845 385 910 385 q 745 342 782 385 q 709 243 709 300 q 742 147 709 186 q 845 103 781 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 m 1428 0 q 1246 76 1314 0 q 1185 244 1185 145 q 1244 412 1185 344 q 1428 489 1311 489 q 1610 412 1542 489 q 1672 244 1672 343 q 1612 76 1672 144 q 1428 0 1545 0 m 1427 103 q 1528 143 1492 103 q 1564 243 1564 184 q 1530 340 1564 301 q 1427 385 1492 385 q 1327 342 1364 385 q 1291 243 1291 300 q 1324 147 1291 186 q 1427 103 1363 103 "},a:{x_min:0,x_max:698.609375,ha:794,o:"m 698 0 q 661 -12 679 -7 q 615 -17 643 -17 q 536 12 564 -17 q 500 96 508 41 q 384 6 456 37 q 236 -25 312 -25 q 65 31 130 -25 q 0 194 0 88 q 118 390 0 334 q 328 435 180 420 q 488 483 476 451 q 495 523 495 504 q 442 619 495 584 q 325 654 389 654 q 209 617 257 654 q 152 513 161 580 l 33 513 q 123 705 33 633 q 332 772 207 772 q 528 712 448 772 q 617 531 617 645 l 617 163 q 624 108 617 126 q 664 90 632 90 l 698 94 l 698 0 m 491 262 l 491 372 q 272 329 350 347 q 128 201 128 294 q 166 113 128 144 q 264 83 205 83 q 414 130 346 83 q 491 262 491 183 "},"—":{x_min:0,x_max:941.671875,ha:1039,o:"m 941 334 l 0 334 l 0 410 l 941 410 l 941 334 "},"=":{x_min:8.71875,x_max:780.953125,ha:792,o:"m 780 510 l 8 510 l 8 606 l 780 606 l 780 510 m 780 235 l 8 235 l 8 332 l 780 332 l 780 235 "},N:{x_min:0,x_max:801,ha:914,o:"m 801 0 l 651 0 l 131 823 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 193 l 670 1013 l 801 1013 l 801 0 "},"ρ":{x_min:0,x_max:712,ha:797,o:"m 712 369 q 620 94 712 207 q 362 -26 521 -26 q 230 2 292 -26 q 119 83 167 30 l 119 -278 l 0 -278 l 0 362 q 91 643 0 531 q 355 764 190 764 q 617 647 517 764 q 712 369 712 536 m 583 366 q 530 559 583 480 q 359 651 469 651 q 190 562 252 651 q 135 370 135 483 q 189 176 135 257 q 359 85 250 85 q 528 175 466 85 q 583 366 583 254 "},2:{x_min:59,x_max:731,ha:792,o:"m 731 0 l 59 0 q 197 314 59 188 q 457 487 199 315 q 598 691 598 580 q 543 819 598 772 q 411 867 488 867 q 272 811 328 867 q 209 630 209 747 l 81 630 q 182 901 81 805 q 408 986 271 986 q 629 909 536 986 q 731 694 731 826 q 613 449 731 541 q 378 316 495 383 q 201 122 235 234 l 731 122 l 731 0 "},"¯":{x_min:0,x_max:941.671875,ha:938,o:"m 941 1033 l 0 1033 l 0 1109 l 941 1109 l 941 1033 "},Z:{x_min:0,x_max:779,ha:849,o:"m 779 0 l 0 0 l 0 113 l 621 896 l 40 896 l 40 1013 l 779 1013 l 778 887 l 171 124 l 779 124 l 779 0 "},u:{x_min:0,x_max:617,ha:729,o:"m 617 0 l 499 0 l 499 110 q 391 10 460 45 q 246 -25 322 -25 q 61 58 127 -25 q 0 258 0 136 l 0 738 l 125 738 l 125 284 q 156 148 125 202 q 273 82 197 82 q 433 165 369 82 q 493 340 493 243 l 493 738 l 617 738 l 617 0 "},k:{x_min:0,x_max:612.484375,ha:697,o:"m 612 738 l 338 465 l 608 0 l 469 0 l 251 382 l 121 251 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 402 l 456 738 l 612 738 "},"Η":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"Α":{x_min:0,x_max:906.953125,ha:985,o:"m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},s:{x_min:0,x_max:604,ha:697,o:"m 604 217 q 501 36 604 104 q 292 -23 411 -23 q 86 43 166 -23 q 0 238 0 114 l 121 237 q 175 122 121 164 q 300 85 223 85 q 415 112 363 85 q 479 207 479 147 q 361 309 479 276 q 140 372 141 370 q 21 544 21 426 q 111 708 21 647 q 298 761 190 761 q 492 705 413 761 q 583 531 583 643 l 462 531 q 412 625 462 594 q 298 657 363 657 q 199 636 242 657 q 143 558 143 608 q 262 454 143 486 q 484 394 479 397 q 604 217 604 341 "},B:{x_min:0,x_max:778,ha:876,o:"m 580 546 q 724 469 670 535 q 778 311 778 403 q 673 83 778 171 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 892 q 691 633 732 693 q 580 546 650 572 m 393 899 l 139 899 l 139 588 l 379 588 q 521 624 462 588 q 592 744 592 667 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 303 635 219 q 559 436 635 389 q 402 477 494 477 l 139 477 l 139 124 l 419 124 "},"…":{x_min:0,x_max:614,ha:708,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 m 378 0 l 236 0 l 236 151 l 378 151 l 378 0 m 614 0 l 472 0 l 472 151 l 614 151 l 614 0 "},"?":{x_min:0,x_max:607,ha:704,o:"m 607 777 q 543 599 607 674 q 422 474 482 537 q 357 272 357 391 l 236 272 q 297 487 236 395 q 411 619 298 490 q 474 762 474 691 q 422 885 474 838 q 301 933 371 933 q 179 880 228 933 q 124 706 124 819 l 0 706 q 94 963 0 872 q 302 1044 177 1044 q 511 973 423 1044 q 607 777 607 895 m 370 0 l 230 0 l 230 151 l 370 151 l 370 0 "},H:{x_min:0,x_max:803,ha:915,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"ν":{x_min:0,x_max:675,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 738 l 340 147 l 541 738 l 675 738 "},c:{x_min:1,x_max:701.390625,ha:775,o:"m 701 264 q 584 53 681 133 q 353 -26 487 -26 q 91 91 188 -26 q 1 370 1 201 q 92 645 1 537 q 353 761 190 761 q 572 688 479 761 q 690 493 666 615 l 556 493 q 487 606 545 562 q 356 650 428 650 q 186 563 246 650 q 134 372 134 487 q 188 179 134 258 q 359 88 250 88 q 492 136 437 88 q 566 264 548 185 l 701 264 "},"¶":{x_min:0,x_max:566.671875,ha:678,o:"m 21 892 l 52 892 l 98 761 l 145 892 l 176 892 l 178 741 l 157 741 l 157 867 l 108 741 l 88 741 l 40 871 l 40 741 l 21 741 l 21 892 m 308 854 l 308 731 q 252 691 308 691 q 227 691 240 691 q 207 696 213 695 l 207 712 l 253 706 q 288 733 288 706 l 288 763 q 244 741 279 741 q 193 797 193 741 q 261 860 193 860 q 287 860 273 860 q 308 854 302 855 m 288 842 l 263 843 q 213 796 213 843 q 248 756 213 756 q 288 796 288 756 l 288 842 m 566 988 l 502 988 l 502 -1 l 439 -1 l 439 988 l 317 988 l 317 -1 l 252 -1 l 252 602 q 81 653 155 602 q 0 805 0 711 q 101 989 0 918 q 309 1053 194 1053 l 566 1053 l 566 988 "},"β":{x_min:0,x_max:660,ha:745,o:"m 471 550 q 610 450 561 522 q 660 280 660 378 q 578 64 660 151 q 367 -22 497 -22 q 239 5 299 -22 q 126 82 178 32 l 126 -278 l 0 -278 l 0 593 q 54 903 0 801 q 318 1042 127 1042 q 519 964 436 1042 q 603 771 603 887 q 567 644 603 701 q 471 550 532 586 m 337 79 q 476 138 418 79 q 535 279 535 198 q 427 437 535 386 q 226 477 344 477 l 226 583 q 398 620 329 583 q 486 762 486 668 q 435 884 486 833 q 312 935 384 935 q 169 861 219 935 q 126 698 126 797 l 126 362 q 170 169 126 242 q 337 79 224 79 "},"Μ":{x_min:0,x_max:954,ha:1068,o:"m 954 0 l 819 0 l 819 868 l 537 0 l 405 0 l 128 865 l 128 0 l 0 0 l 0 1013 l 199 1013 l 472 158 l 758 1013 l 954 1013 l 954 0 "},"Ό":{x_min:.109375,x_max:1120,ha:1217,o:"m 1120 505 q 994 132 1120 282 q 642 -29 861 -29 q 290 130 422 -29 q 167 505 167 280 q 294 883 167 730 q 650 1046 430 1046 q 999 882 868 1046 q 1120 505 1120 730 m 977 504 q 896 784 977 669 q 644 915 804 915 q 391 785 484 915 q 307 504 307 669 q 391 224 307 339 q 644 95 486 95 q 894 224 803 95 q 977 504 977 339 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"Ή":{x_min:0,x_max:1158,ha:1275,o:"m 1158 0 l 1022 0 l 1022 475 l 496 475 l 496 0 l 356 0 l 356 1012 l 496 1012 l 496 599 l 1022 599 l 1022 1012 l 1158 1012 l 1158 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"•":{x_min:0,x_max:663.890625,ha:775,o:"m 663 529 q 566 293 663 391 q 331 196 469 196 q 97 294 194 196 q 0 529 0 393 q 96 763 0 665 q 331 861 193 861 q 566 763 469 861 q 663 529 663 665 "},"¥":{x_min:.1875,x_max:819.546875,ha:886,o:"m 563 561 l 697 561 l 696 487 l 520 487 l 482 416 l 482 380 l 697 380 l 695 308 l 482 308 l 482 0 l 342 0 l 342 308 l 125 308 l 125 380 l 342 380 l 342 417 l 303 487 l 125 487 l 125 561 l 258 561 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 l 563 561 "},"(":{x_min:0,x_max:318.0625,ha:415,o:"m 318 -290 l 230 -290 q 61 23 122 -142 q 0 365 0 190 q 62 712 0 540 q 230 1024 119 869 l 318 1024 q 175 705 219 853 q 125 360 125 542 q 176 22 125 187 q 318 -290 223 -127 "},U:{x_min:0,x_max:796,ha:904,o:"m 796 393 q 681 93 796 212 q 386 -25 566 -25 q 101 95 208 -25 q 0 393 0 211 l 0 1013 l 138 1013 l 138 391 q 204 191 138 270 q 394 107 276 107 q 586 191 512 107 q 656 391 656 270 l 656 1013 l 796 1013 l 796 393 "},"γ":{x_min:.5,x_max:744.953125,ha:822,o:"m 744 737 l 463 54 l 463 -278 l 338 -278 l 338 54 l 154 495 q 104 597 124 569 q 13 651 67 651 l 0 651 l 0 751 l 39 753 q 168 711 121 753 q 242 594 207 676 l 403 208 l 617 737 l 744 737 "},"α":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 728 407 760 q 563 637 524 696 l 563 739 l 685 739 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 96 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 "},F:{x_min:0,x_max:683.328125,ha:717,o:"m 683 888 l 140 888 l 140 583 l 613 583 l 613 458 l 140 458 l 140 0 l 0 0 l 0 1013 l 683 1013 l 683 888 "},"­":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},":":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"Χ":{x_min:0,x_max:854.171875,ha:935,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 427 637 l 675 1013 l 836 1013 l 504 521 l 854 0 "},"*":{x_min:116,x_max:674,ha:792,o:"m 674 768 l 475 713 l 610 544 l 517 477 l 394 652 l 272 478 l 178 544 l 314 713 l 116 766 l 153 876 l 341 812 l 342 1013 l 446 1013 l 446 811 l 635 874 l 674 768 "},"†":{x_min:0,x_max:777,ha:835,o:"m 458 804 l 777 804 l 777 683 l 458 683 l 458 0 l 319 0 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 "},"°":{x_min:0,x_max:347,ha:444,o:"m 173 802 q 43 856 91 802 q 0 977 0 905 q 45 1101 0 1049 q 173 1153 90 1153 q 303 1098 255 1153 q 347 977 347 1049 q 303 856 347 905 q 173 802 256 802 m 173 884 q 238 910 214 884 q 262 973 262 937 q 239 1038 262 1012 q 173 1064 217 1064 q 108 1037 132 1064 q 85 973 85 1010 q 108 910 85 937 q 173 884 132 884 "},V:{x_min:0,x_max:862.71875,ha:940,o:"m 862 1013 l 505 0 l 361 0 l 0 1013 l 143 1013 l 434 165 l 718 1012 l 862 1013 "},"Ξ":{x_min:0,x_max:734.71875,ha:763,o:"m 723 889 l 9 889 l 9 1013 l 723 1013 l 723 889 m 673 463 l 61 463 l 61 589 l 673 589 l 673 463 m 734 0 l 0 0 l 0 124 l 734 124 l 734 0 "}," ":{x_min:0,x_max:0,ha:853},"Ϋ":{x_min:.328125,x_max:819.515625,ha:889,o:"m 588 1046 l 460 1046 l 460 1189 l 588 1189 l 588 1046 m 360 1046 l 232 1046 l 232 1189 l 360 1189 l 360 1046 m 819 1012 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1012 l 140 1012 l 411 533 l 679 1012 l 819 1012 "},0:{x_min:73,x_max:715,ha:792,o:"m 394 -29 q 153 129 242 -29 q 73 479 73 272 q 152 829 73 687 q 394 989 241 989 q 634 829 545 989 q 715 479 715 684 q 635 129 715 270 q 394 -29 546 -29 m 394 89 q 546 211 489 89 q 598 479 598 322 q 548 748 598 640 q 394 871 491 871 q 241 748 298 871 q 190 479 190 637 q 239 211 190 319 q 394 89 296 89 "},"”":{x_min:0,x_max:347,ha:454,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 m 347 851 q 310 737 347 784 q 208 669 273 690 l 208 734 q 267 787 250 741 q 280 873 280 821 l 208 873 l 208 1013 l 347 1013 l 347 851 "},"@":{x_min:0,x_max:1260,ha:1357,o:"m 1098 -45 q 877 -160 1001 -117 q 633 -203 752 -203 q 155 -29 327 -203 q 0 360 0 127 q 176 802 0 616 q 687 1008 372 1008 q 1123 854 969 1008 q 1260 517 1260 718 q 1155 216 1260 341 q 868 82 1044 82 q 772 106 801 82 q 737 202 737 135 q 647 113 700 144 q 527 82 594 82 q 367 147 420 82 q 314 312 314 212 q 401 565 314 452 q 639 690 498 690 q 810 588 760 690 l 849 668 l 938 668 q 877 441 900 532 q 833 226 833 268 q 853 182 833 198 q 902 167 873 167 q 1088 272 1012 167 q 1159 512 1159 372 q 1051 793 1159 681 q 687 925 925 925 q 248 747 415 925 q 97 361 97 586 q 226 26 97 159 q 627 -122 370 -122 q 856 -87 737 -122 q 1061 8 976 -53 l 1098 -45 m 786 488 q 738 580 777 545 q 643 615 700 615 q 483 517 548 615 q 425 322 425 430 q 457 203 425 250 q 552 156 490 156 q 722 273 665 156 q 786 488 738 309 "},"Ί":{x_min:0,x_max:499,ha:613,o:"m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 m 499 0 l 360 0 l 360 1012 l 499 1012 l 499 0 "},i:{x_min:14,x_max:136,ha:275,o:"m 136 873 l 14 873 l 14 1013 l 136 1013 l 136 873 m 136 0 l 14 0 l 14 737 l 136 737 l 136 0 "},"Β":{x_min:0,x_max:778,ha:877,o:"m 580 545 q 724 468 671 534 q 778 310 778 402 q 673 83 778 170 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 891 q 691 632 732 692 q 580 545 650 571 m 393 899 l 139 899 l 139 587 l 379 587 q 521 623 462 587 q 592 744 592 666 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 302 635 219 q 559 435 635 388 q 402 476 494 476 l 139 476 l 139 124 l 419 124 "},"υ":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 94 617 199 q 308 -24 455 -24 q 76 94 161 -24 q 0 352 0 199 l 0 739 l 126 739 l 126 355 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 355 492 257 l 492 739 l 617 739 l 617 352 "},"]":{x_min:0,x_max:275,ha:372,o:"m 275 -281 l 0 -281 l 0 -187 l 151 -187 l 151 920 l 0 920 l 0 1013 l 275 1013 l 275 -281 "},m:{x_min:0,x_max:1019,ha:1128,o:"m 1019 0 l 897 0 l 897 454 q 860 591 897 536 q 739 660 816 660 q 613 586 659 660 q 573 436 573 522 l 573 0 l 447 0 l 447 455 q 412 591 447 535 q 294 657 372 657 q 165 586 213 657 q 122 437 122 521 l 122 0 l 0 0 l 0 738 l 117 738 l 117 640 q 202 730 150 697 q 316 763 254 763 q 437 730 381 763 q 525 642 494 697 q 621 731 559 700 q 753 763 682 763 q 943 694 867 763 q 1019 512 1019 625 l 1019 0 "},"χ":{x_min:8.328125,x_max:780.5625,ha:815,o:"m 780 -278 q 715 -294 747 -294 q 616 -257 663 -294 q 548 -175 576 -227 l 379 133 l 143 -277 l 9 -277 l 313 254 l 163 522 q 127 586 131 580 q 36 640 91 640 q 8 637 27 640 l 8 752 l 52 757 q 162 719 113 757 q 236 627 200 690 l 383 372 l 594 737 l 726 737 l 448 250 l 625 -69 q 670 -153 647 -110 q 743 -188 695 -188 q 780 -184 759 -188 l 780 -278 "},8:{x_min:55,x_max:736,ha:792,o:"m 571 527 q 694 424 652 491 q 736 280 736 358 q 648 71 736 158 q 395 -26 551 -26 q 142 69 238 -26 q 55 279 55 157 q 96 425 55 359 q 220 527 138 491 q 120 615 153 562 q 88 726 88 668 q 171 904 88 827 q 395 986 261 986 q 618 905 529 986 q 702 727 702 830 q 670 616 702 667 q 571 527 638 565 m 394 565 q 519 610 475 565 q 563 717 563 655 q 521 823 563 781 q 392 872 474 872 q 265 824 312 872 q 224 720 224 783 q 265 613 224 656 q 394 565 312 565 m 395 91 q 545 150 488 91 q 597 280 597 204 q 546 408 597 355 q 395 465 492 465 q 244 408 299 465 q 194 280 194 356 q 244 150 194 203 q 395 91 299 91 "},"ί":{x_min:42,x_max:326.71875,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 102 239 101 q 284 112 257 104 l 284 3 m 326 1040 l 137 819 l 54 819 l 189 1040 l 326 1040 "},"Ζ":{x_min:0,x_max:779.171875,ha:850,o:"m 779 0 l 0 0 l 0 113 l 620 896 l 40 896 l 40 1013 l 779 1013 l 779 887 l 170 124 l 779 124 l 779 0 "},R:{x_min:0,x_max:781.953125,ha:907,o:"m 781 0 l 623 0 q 587 242 590 52 q 407 433 585 433 l 138 433 l 138 0 l 0 0 l 0 1013 l 396 1013 q 636 946 539 1013 q 749 731 749 868 q 711 597 749 659 q 608 502 674 534 q 718 370 696 474 q 729 207 722 352 q 781 26 736 62 l 781 0 m 373 551 q 533 594 465 551 q 614 731 614 645 q 532 859 614 815 q 373 896 465 896 l 138 896 l 138 551 l 373 551 "},o:{x_min:0,x_max:713,ha:821,o:"m 357 -25 q 94 91 194 -25 q 0 368 0 202 q 93 642 0 533 q 357 761 193 761 q 618 644 518 761 q 713 368 713 533 q 619 91 713 201 q 357 -25 521 -25 m 357 85 q 528 175 465 85 q 584 369 584 255 q 529 562 584 484 q 357 651 467 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 357 85 250 85 "},5:{x_min:54.171875,x_max:738,ha:792,o:"m 738 314 q 626 60 738 153 q 382 -23 526 -23 q 155 47 248 -23 q 54 256 54 125 l 183 256 q 259 132 204 174 q 382 91 314 91 q 533 149 471 91 q 602 314 602 213 q 538 469 602 411 q 386 528 475 528 q 284 506 332 528 q 197 439 237 484 l 81 439 l 159 958 l 684 958 l 684 840 l 254 840 l 214 579 q 306 627 258 612 q 407 643 354 643 q 636 552 540 643 q 738 314 738 457 "},7:{x_min:58.71875,x_max:730.953125,ha:792,o:"m 730 839 q 469 448 560 641 q 335 0 378 255 l 192 0 q 328 441 235 252 q 593 830 421 630 l 58 830 l 58 958 l 730 958 l 730 839 "},K:{x_min:0,x_max:819.46875,ha:906,o:"m 819 0 l 649 0 l 294 509 l 139 355 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},",":{x_min:0,x_max:142,ha:239,o:"m 142 -12 q 105 -132 142 -82 q 0 -205 68 -182 l 0 -138 q 57 -82 40 -124 q 70 0 70 -51 l 0 0 l 0 151 l 142 151 l 142 -12 "},d:{x_min:0,x_max:683,ha:796,o:"m 683 0 l 564 0 l 564 93 q 456 6 516 38 q 327 -25 395 -25 q 87 100 181 -25 q 0 365 0 215 q 90 639 0 525 q 343 763 187 763 q 564 647 486 763 l 564 1013 l 683 1013 l 683 0 m 582 373 q 529 562 582 484 q 361 653 468 653 q 190 561 253 653 q 135 365 135 479 q 189 175 135 254 q 358 85 251 85 q 529 178 468 85 q 582 373 582 258 "},"¨":{x_min:-109,x_max:247,ha:232,o:"m 247 1046 l 119 1046 l 119 1189 l 247 1189 l 247 1046 m 19 1046 l -109 1046 l -109 1189 l 19 1189 l 19 1046 "},E:{x_min:0,x_max:736.109375,ha:789,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},Y:{x_min:0,x_max:820,ha:886,o:"m 820 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 534 l 679 1012 l 820 1013 "},'"':{x_min:0,x_max:299,ha:396,o:"m 299 606 l 203 606 l 203 988 l 299 988 l 299 606 m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"‹":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"„":{x_min:0,x_max:364,ha:467,o:"m 141 -12 q 104 -132 141 -82 q 0 -205 67 -182 l 0 -138 q 56 -82 40 -124 q 69 0 69 -51 l 0 0 l 0 151 l 141 151 l 141 -12 m 364 -12 q 327 -132 364 -82 q 222 -205 290 -182 l 222 -138 q 279 -82 262 -124 q 292 0 292 -51 l 222 0 l 222 151 l 364 151 l 364 -12 "},"δ":{x_min:1,x_max:710,ha:810,o:"m 710 360 q 616 87 710 196 q 356 -28 518 -28 q 99 82 197 -28 q 1 356 1 192 q 100 606 1 509 q 355 703 199 703 q 180 829 288 754 q 70 903 124 866 l 70 1012 l 643 1012 l 643 901 l 258 901 q 462 763 422 794 q 636 592 577 677 q 710 360 710 485 m 584 365 q 552 501 584 447 q 451 602 521 555 q 372 611 411 611 q 197 541 258 611 q 136 355 136 472 q 190 171 136 245 q 358 85 252 85 q 528 173 465 85 q 584 365 584 252 "},"έ":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 313 0 265 q 128 390 67 352 q 56 459 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 m 520 1040 l 331 819 l 248 819 l 383 1040 l 520 1040 "},"ω":{x_min:0,x_max:922,ha:1031,o:"m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 339 0 203 q 45 551 0 444 q 161 738 84 643 l 302 738 q 175 553 219 647 q 124 336 124 446 q 155 179 124 249 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 342 797 257 q 745 556 797 450 q 619 738 705 638 l 760 738 q 874 551 835 640 q 922 339 922 444 "},"´":{x_min:0,x_max:96,ha:251,o:"m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"±":{x_min:11,x_max:781,ha:792,o:"m 781 490 l 446 490 l 446 255 l 349 255 l 349 490 l 11 490 l 11 586 l 349 586 l 349 819 l 446 819 l 446 586 l 781 586 l 781 490 m 781 21 l 11 21 l 11 115 l 781 115 l 781 21 "},"|":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"ϋ":{x_min:0,x_max:617,ha:725,o:"m 482 800 l 372 800 l 372 925 l 482 925 l 482 800 m 239 800 l 129 800 l 129 925 l 239 925 l 239 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 "},"§":{x_min:0,x_max:593,ha:690,o:"m 593 425 q 554 312 593 369 q 467 233 516 254 q 537 83 537 172 q 459 -74 537 -12 q 288 -133 387 -133 q 115 -69 184 -133 q 47 96 47 -6 l 166 96 q 199 7 166 40 q 288 -26 232 -26 q 371 -5 332 -26 q 420 60 420 21 q 311 201 420 139 q 108 309 210 255 q 0 490 0 383 q 33 602 0 551 q 124 687 66 654 q 75 743 93 712 q 58 812 58 773 q 133 984 58 920 q 300 1043 201 1043 q 458 987 394 1043 q 529 814 529 925 l 411 814 q 370 908 404 877 q 289 939 336 939 q 213 911 246 939 q 180 841 180 883 q 286 720 180 779 q 484 612 480 615 q 593 425 593 534 m 467 409 q 355 544 467 473 q 196 630 228 612 q 146 587 162 609 q 124 525 124 558 q 239 387 124 462 q 398 298 369 315 q 448 345 429 316 q 467 409 467 375 "},b:{x_min:0,x_max:685,ha:783,o:"m 685 372 q 597 99 685 213 q 347 -25 501 -25 q 219 5 277 -25 q 121 93 161 36 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 634 q 214 723 157 692 q 341 754 272 754 q 591 637 493 754 q 685 372 685 526 m 554 356 q 499 550 554 470 q 328 644 437 644 q 162 556 223 644 q 108 369 108 478 q 160 176 108 256 q 330 83 221 83 q 498 169 435 83 q 554 356 554 245 "},q:{x_min:0,x_max:683,ha:876,o:"m 683 -278 l 564 -278 l 564 97 q 474 8 533 39 q 345 -23 415 -23 q 91 93 188 -23 q 0 364 0 203 q 87 635 0 522 q 337 760 184 760 q 466 727 408 760 q 564 637 523 695 l 564 737 l 683 737 l 683 -278 m 582 375 q 527 564 582 488 q 358 652 466 652 q 190 565 253 652 q 135 377 135 488 q 189 179 135 261 q 361 84 251 84 q 530 179 469 84 q 582 375 582 260 "},"Ω":{x_min:-.171875,x_max:969.5625,ha:1068,o:"m 969 0 l 555 0 l 555 123 q 744 308 675 194 q 814 558 814 423 q 726 812 814 709 q 484 922 633 922 q 244 820 334 922 q 154 567 154 719 q 223 316 154 433 q 412 123 292 199 l 412 0 l 0 0 l 0 124 l 217 124 q 68 327 122 210 q 15 572 15 444 q 144 911 15 781 q 484 1041 274 1041 q 822 909 691 1041 q 953 569 953 777 q 899 326 953 443 q 750 124 846 210 l 969 124 l 969 0 "},"ύ":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 535 1040 l 346 819 l 262 819 l 397 1040 l 535 1040 "},z:{x_min:-.015625,x_max:613.890625,ha:697,o:"m 613 0 l 0 0 l 0 100 l 433 630 l 20 630 l 20 738 l 594 738 l 593 636 l 163 110 l 613 110 l 613 0 "},"™":{x_min:0,x_max:894,ha:1e3,o:"m 389 951 l 229 951 l 229 503 l 160 503 l 160 951 l 0 951 l 0 1011 l 389 1011 l 389 951 m 894 503 l 827 503 l 827 939 l 685 503 l 620 503 l 481 937 l 481 503 l 417 503 l 417 1011 l 517 1011 l 653 580 l 796 1010 l 894 1011 l 894 503 "},"ή":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 721 124 755 q 200 630 193 687 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 m 479 1040 l 290 819 l 207 819 l 341 1040 l 479 1040 "},"Θ":{x_min:0,x_max:960,ha:1056,o:"m 960 507 q 833 129 960 280 q 476 -32 698 -32 q 123 129 255 -32 q 0 507 0 280 q 123 883 0 732 q 476 1045 255 1045 q 832 883 696 1045 q 960 507 960 732 m 817 500 q 733 789 817 669 q 476 924 639 924 q 223 792 317 924 q 142 507 142 675 q 222 222 142 339 q 476 89 315 89 q 730 218 636 89 q 817 500 817 334 m 716 449 l 243 449 l 243 571 l 716 571 l 716 449 "},"®":{x_min:-3,x_max:1008,ha:1106,o:"m 503 532 q 614 562 566 532 q 672 658 672 598 q 614 747 672 716 q 503 772 569 772 l 338 772 l 338 532 l 503 532 m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 788 146 l 678 146 q 653 316 655 183 q 527 449 652 449 l 338 449 l 338 146 l 241 146 l 241 854 l 518 854 q 688 808 621 854 q 766 658 766 755 q 739 563 766 607 q 668 497 713 519 q 751 331 747 472 q 788 164 756 190 l 788 146 "},"~":{x_min:0,x_max:833,ha:931,o:"m 833 958 q 778 753 833 831 q 594 665 716 665 q 402 761 502 665 q 240 857 302 857 q 131 795 166 857 q 104 665 104 745 l 0 665 q 54 867 0 789 q 237 958 116 958 q 429 861 331 958 q 594 765 527 765 q 704 827 670 765 q 729 958 729 874 l 833 958 "},"Ε":{x_min:0,x_max:736.21875,ha:778,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},"³":{x_min:0,x_max:450,ha:547,o:"m 450 552 q 379 413 450 464 q 220 366 313 366 q 69 414 130 366 q 0 567 0 470 l 85 567 q 126 470 85 504 q 225 437 168 437 q 320 467 280 437 q 360 552 360 498 q 318 632 360 608 q 213 657 276 657 q 195 657 203 657 q 176 657 181 657 l 176 722 q 279 733 249 722 q 334 815 334 752 q 300 881 334 856 q 220 907 267 907 q 133 875 169 907 q 97 781 97 844 l 15 781 q 78 926 15 875 q 220 972 135 972 q 364 930 303 972 q 426 817 426 888 q 344 697 426 733 q 421 642 392 681 q 450 552 450 603 "},"[":{x_min:0,x_max:273.609375,ha:371,o:"m 273 -281 l 0 -281 l 0 1013 l 273 1013 l 273 920 l 124 920 l 124 -187 l 273 -187 l 273 -281 "},L:{x_min:0,x_max:645.828125,ha:696,o:"m 645 0 l 0 0 l 0 1013 l 140 1013 l 140 126 l 645 126 l 645 0 "},"σ":{x_min:0,x_max:803.390625,ha:894,o:"m 803 628 l 633 628 q 713 368 713 512 q 618 93 713 204 q 357 -25 518 -25 q 94 91 194 -25 q 0 368 0 201 q 94 644 0 533 q 356 761 194 761 q 481 750 398 761 q 608 739 564 739 l 803 739 l 803 628 m 360 85 q 529 180 467 85 q 584 374 584 262 q 527 566 584 490 q 352 651 463 651 q 187 559 247 651 q 135 368 135 478 q 189 175 135 254 q 360 85 251 85 "},"ζ":{x_min:0,x_max:573,ha:642,o:"m 573 -40 q 553 -162 573 -97 q 510 -278 543 -193 l 400 -278 q 441 -187 428 -219 q 462 -90 462 -132 q 378 -14 462 -14 q 108 45 197 -14 q 0 290 0 117 q 108 631 0 462 q 353 901 194 767 l 55 901 l 55 1012 l 561 1012 l 561 924 q 261 669 382 831 q 128 301 128 489 q 243 117 128 149 q 458 98 350 108 q 573 -40 573 80 "},"θ":{x_min:0,x_max:674,ha:778,o:"m 674 496 q 601 160 674 304 q 336 -26 508 -26 q 73 153 165 -26 q 0 485 0 296 q 72 840 0 683 q 343 1045 166 1045 q 605 844 516 1045 q 674 496 674 692 m 546 579 q 498 798 546 691 q 336 935 437 935 q 178 798 237 935 q 126 579 137 701 l 546 579 m 546 475 l 126 475 q 170 233 126 348 q 338 80 230 80 q 504 233 447 80 q 546 475 546 346 "},"Ο":{x_min:0,x_max:958,ha:1054,o:"m 485 1042 q 834 883 703 1042 q 958 511 958 735 q 834 136 958 287 q 481 -26 701 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 729 q 485 1042 263 1042 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 670 q 480 913 640 913 q 226 785 321 913 q 142 504 142 671 q 226 224 142 339 q 480 98 319 98 "},"Γ":{x_min:0,x_max:705.28125,ha:749,o:"m 705 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 705 1012 l 705 886 "}," ":{x_min:0,x_max:0,ha:375},"%":{x_min:-3,x_max:1089,ha:1186,o:"m 845 0 q 663 76 731 0 q 602 244 602 145 q 661 412 602 344 q 845 489 728 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 845 0 962 0 m 844 103 q 945 143 909 103 q 981 243 981 184 q 947 340 981 301 q 844 385 909 385 q 744 342 781 385 q 708 243 708 300 q 741 147 708 186 q 844 103 780 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 "},P:{x_min:0,x_max:726,ha:806,o:"m 424 1013 q 640 931 555 1013 q 726 719 726 850 q 637 506 726 587 q 413 426 548 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 379 889 l 140 889 l 140 548 l 372 548 q 522 589 459 548 q 593 720 593 637 q 528 845 593 801 q 379 889 463 889 "},"Έ":{x_min:0,x_max:1078.21875,ha:1118,o:"m 1078 0 l 342 0 l 342 1013 l 1067 1013 l 1067 889 l 481 889 l 481 585 l 1019 585 l 1019 467 l 481 467 l 481 125 l 1078 125 l 1078 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"Ώ":{x_min:.125,x_max:1136.546875,ha:1235,o:"m 1136 0 l 722 0 l 722 123 q 911 309 842 194 q 981 558 981 423 q 893 813 981 710 q 651 923 800 923 q 411 821 501 923 q 321 568 321 720 q 390 316 321 433 q 579 123 459 200 l 579 0 l 166 0 l 166 124 l 384 124 q 235 327 289 210 q 182 572 182 444 q 311 912 182 782 q 651 1042 441 1042 q 989 910 858 1042 q 1120 569 1120 778 q 1066 326 1120 443 q 917 124 1013 210 l 1136 124 l 1136 0 m 277 1040 l 83 800 l 0 800 l 140 1041 l 277 1040 "},_:{x_min:0,x_max:705.5625,ha:803,o:"m 705 -334 l 0 -334 l 0 -234 l 705 -234 l 705 -334 "},"Ϊ":{x_min:-110,x_max:246,ha:275,o:"m 246 1046 l 118 1046 l 118 1189 l 246 1189 l 246 1046 m 18 1046 l -110 1046 l -110 1189 l 18 1189 l 18 1046 m 136 0 l 0 0 l 0 1012 l 136 1012 l 136 0 "},"+":{x_min:23,x_max:768,ha:792,o:"m 768 372 l 444 372 l 444 0 l 347 0 l 347 372 l 23 372 l 23 468 l 347 468 l 347 840 l 444 840 l 444 468 l 768 468 l 768 372 "},"½":{x_min:0,x_max:1050,ha:1149,o:"m 1050 0 l 625 0 q 712 178 625 108 q 878 277 722 187 q 967 385 967 328 q 932 456 967 429 q 850 484 897 484 q 759 450 798 484 q 721 352 721 416 l 640 352 q 706 502 640 448 q 851 551 766 551 q 987 509 931 551 q 1050 385 1050 462 q 976 251 1050 301 q 829 179 902 215 q 717 68 740 133 l 1050 68 l 1050 0 m 834 985 l 215 -28 l 130 -28 l 750 984 l 834 985 m 224 422 l 142 422 l 142 811 l 0 811 l 0 867 q 104 889 62 867 q 164 973 157 916 l 224 973 l 224 422 "},"Ρ":{x_min:0,x_max:720,ha:783,o:"m 424 1013 q 637 933 554 1013 q 720 723 720 853 q 633 508 720 591 q 413 426 546 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 378 889 l 140 889 l 140 548 l 371 548 q 521 589 458 548 q 592 720 592 637 q 527 845 592 801 q 378 889 463 889 "},"'":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"ª":{x_min:0,x_max:350,ha:397,o:"m 350 625 q 307 616 328 616 q 266 631 281 616 q 247 673 251 645 q 190 628 225 644 q 116 613 156 613 q 32 641 64 613 q 0 722 0 669 q 72 826 0 800 q 247 866 159 846 l 247 887 q 220 934 247 916 q 162 953 194 953 q 104 934 129 953 q 76 882 80 915 l 16 882 q 60 976 16 941 q 166 1011 104 1011 q 266 979 224 1011 q 308 891 308 948 l 308 706 q 311 679 308 688 q 331 670 315 670 l 350 672 l 350 625 m 247 757 l 247 811 q 136 790 175 798 q 64 726 64 773 q 83 682 64 697 q 132 667 103 667 q 207 690 174 667 q 247 757 247 718 "},"΅":{x_min:0,x_max:450,ha:553,o:"m 450 800 l 340 800 l 340 925 l 450 925 l 450 800 m 406 1040 l 212 800 l 129 800 l 269 1040 l 406 1040 m 110 800 l 0 800 l 0 925 l 110 925 l 110 800 "},T:{x_min:0,x_max:777,ha:835,o:"m 777 894 l 458 894 l 458 0 l 319 0 l 319 894 l 0 894 l 0 1013 l 777 1013 l 777 894 "},"Φ":{x_min:0,x_max:915,ha:997,o:"m 527 0 l 389 0 l 389 122 q 110 231 220 122 q 0 509 0 340 q 110 785 0 677 q 389 893 220 893 l 389 1013 l 527 1013 l 527 893 q 804 786 693 893 q 915 509 915 679 q 805 231 915 341 q 527 122 696 122 l 527 0 m 527 226 q 712 310 641 226 q 779 507 779 389 q 712 705 779 627 q 527 787 641 787 l 527 226 m 389 226 l 389 787 q 205 698 275 775 q 136 505 136 620 q 206 308 136 391 q 389 226 276 226 "},"⁋":{x_min:0,x_max:0,ha:694},j:{x_min:-77.78125,x_max:167,ha:349,o:"m 167 871 l 42 871 l 42 1013 l 167 1013 l 167 871 m 167 -80 q 121 -231 167 -184 q -26 -278 76 -278 l -77 -278 l -77 -164 l -41 -164 q 26 -143 11 -164 q 42 -65 42 -122 l 42 737 l 167 737 l 167 -80 "},"Σ":{x_min:0,x_max:756.953125,ha:819,o:"m 756 0 l 0 0 l 0 107 l 395 523 l 22 904 l 22 1013 l 745 1013 l 745 889 l 209 889 l 566 523 l 187 125 l 756 125 l 756 0 "},1:{x_min:215.671875,x_max:574,ha:792,o:"m 574 0 l 442 0 l 442 697 l 215 697 l 215 796 q 386 833 330 796 q 475 986 447 875 l 574 986 l 574 0 "},"›":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},"<":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"£":{x_min:0,x_max:704.484375,ha:801,o:"m 704 41 q 623 -10 664 5 q 543 -26 583 -26 q 359 15 501 -26 q 243 36 288 36 q 158 23 197 36 q 73 -21 119 10 l 6 76 q 125 195 90 150 q 175 331 175 262 q 147 443 175 383 l 0 443 l 0 512 l 108 512 q 43 734 43 623 q 120 929 43 854 q 358 1010 204 1010 q 579 936 487 1010 q 678 729 678 857 l 678 684 l 552 684 q 504 838 552 780 q 362 896 457 896 q 216 852 263 896 q 176 747 176 815 q 199 627 176 697 q 248 512 217 574 l 468 512 l 468 443 l 279 443 q 297 356 297 398 q 230 194 297 279 q 153 107 211 170 q 227 133 190 125 q 293 142 264 142 q 410 119 339 142 q 516 96 482 96 q 579 105 550 96 q 648 142 608 115 l 704 41 "},t:{x_min:0,x_max:367,ha:458,o:"m 367 0 q 312 -5 339 -2 q 262 -8 284 -8 q 145 28 183 -8 q 108 143 108 64 l 108 638 l 0 638 l 0 738 l 108 738 l 108 944 l 232 944 l 232 738 l 367 738 l 367 638 l 232 638 l 232 185 q 248 121 232 140 q 307 102 264 102 q 345 104 330 102 q 367 107 360 107 l 367 0 "},"¬":{x_min:0,x_max:706,ha:803,o:"m 706 411 l 706 158 l 630 158 l 630 335 l 0 335 l 0 411 l 706 411 "},"λ":{x_min:0,x_max:750,ha:803,o:"m 750 -7 q 679 -15 716 -15 q 538 59 591 -15 q 466 214 512 97 l 336 551 l 126 0 l 0 0 l 270 705 q 223 837 247 770 q 116 899 190 899 q 90 898 100 899 l 90 1004 q 152 1011 125 1011 q 298 938 244 1011 q 373 783 326 901 l 605 192 q 649 115 629 136 q 716 95 669 95 l 736 95 q 750 97 745 97 l 750 -7 "},W:{x_min:0,x_max:1263.890625,ha:1351,o:"m 1263 1013 l 995 0 l 859 0 l 627 837 l 405 0 l 265 0 l 0 1013 l 136 1013 l 342 202 l 556 1013 l 701 1013 l 921 207 l 1133 1012 l 1263 1013 "},">":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},v:{x_min:0,x_max:675.15625,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 737 l 340 147 l 541 737 l 675 738 "},"τ":{x_min:.28125,x_max:644.5,ha:703,o:"m 644 628 l 382 628 l 382 179 q 388 120 382 137 q 436 91 401 91 q 474 94 447 91 q 504 97 501 97 l 504 0 q 454 -9 482 -5 q 401 -14 426 -14 q 278 67 308 -14 q 260 233 260 118 l 260 628 l 0 628 l 0 739 l 644 739 l 644 628 "},"ξ":{x_min:0,x_max:624.9375,ha:699,o:"m 624 -37 q 608 -153 624 -96 q 563 -278 593 -211 l 454 -278 q 491 -183 486 -200 q 511 -83 511 -126 q 484 -23 511 -44 q 370 1 452 1 q 323 0 354 1 q 283 -1 293 -1 q 84 76 169 -1 q 0 266 0 154 q 56 431 0 358 q 197 538 108 498 q 94 613 134 562 q 54 730 54 665 q 77 823 54 780 q 143 901 101 867 l 27 901 l 27 1012 l 576 1012 l 576 901 l 380 901 q 244 863 303 901 q 178 745 178 820 q 312 600 178 636 q 532 582 380 582 l 532 479 q 276 455 361 479 q 118 281 118 410 q 165 173 118 217 q 274 120 208 133 q 494 101 384 110 q 624 -37 624 76 "},"&":{x_min:-3,x_max:894.25,ha:992,o:"m 894 0 l 725 0 l 624 123 q 471 0 553 40 q 306 -41 390 -41 q 168 -7 231 -41 q 62 92 105 26 q 14 187 31 139 q -3 276 -3 235 q 55 433 -3 358 q 248 581 114 508 q 170 689 196 640 q 137 817 137 751 q 214 985 137 922 q 384 1041 284 1041 q 548 988 483 1041 q 622 824 622 928 q 563 666 622 739 q 431 556 516 608 l 621 326 q 649 407 639 361 q 663 493 653 426 l 781 493 q 703 229 781 352 l 894 0 m 504 818 q 468 908 504 877 q 384 940 433 940 q 293 907 331 940 q 255 818 255 875 q 289 714 255 767 q 363 628 313 678 q 477 729 446 682 q 504 818 504 771 m 556 209 l 314 499 q 179 395 223 449 q 135 283 135 341 q 146 222 135 253 q 183 158 158 192 q 333 80 241 80 q 556 209 448 80 "},"Λ":{x_min:0,x_max:862.5,ha:942,o:"m 862 0 l 719 0 l 426 847 l 143 0 l 0 0 l 356 1013 l 501 1013 l 862 0 "},I:{x_min:41,x_max:180,ha:293,o:"m 180 0 l 41 0 l 41 1013 l 180 1013 l 180 0 "},G:{x_min:0,x_max:921,ha:1011,o:"m 921 0 l 832 0 l 801 136 q 655 15 741 58 q 470 -28 568 -28 q 126 133 259 -28 q 0 499 0 284 q 125 881 0 731 q 486 1043 259 1043 q 763 957 647 1043 q 905 709 890 864 l 772 709 q 668 866 747 807 q 486 926 589 926 q 228 795 322 926 q 142 507 142 677 q 228 224 142 342 q 483 94 323 94 q 712 195 625 94 q 796 435 796 291 l 477 435 l 477 549 l 921 549 l 921 0 "},"ΰ":{x_min:0,x_max:617,ha:725,o:"m 524 800 l 414 800 l 414 925 l 524 925 l 524 800 m 183 800 l 73 800 l 73 925 l 183 925 l 183 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 489 1040 l 300 819 l 216 819 l 351 1040 l 489 1040 "},"`":{x_min:0,x_max:138.890625,ha:236,o:"m 138 699 l 0 699 l 0 861 q 36 974 0 929 q 138 1041 72 1020 l 138 977 q 82 931 95 969 q 69 839 69 893 l 138 839 l 138 699 "},"·":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"Υ":{x_min:.328125,x_max:819.515625,ha:889,o:"m 819 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 "},r:{x_min:0,x_max:355.5625,ha:432,o:"m 355 621 l 343 621 q 179 569 236 621 q 122 411 122 518 l 122 0 l 0 0 l 0 737 l 117 737 l 117 604 q 204 719 146 686 q 355 753 262 753 l 355 621 "},x:{x_min:0,x_max:675,ha:764,o:"m 675 0 l 525 0 l 331 286 l 144 0 l 0 0 l 256 379 l 12 738 l 157 737 l 336 473 l 516 738 l 661 738 l 412 380 l 675 0 "},"μ":{x_min:0,x_max:696.609375,ha:747,o:"m 696 -4 q 628 -14 657 -14 q 498 97 513 -14 q 422 8 470 41 q 313 -24 374 -24 q 207 3 258 -24 q 120 80 157 31 l 120 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 172 124 246 q 308 82 216 82 q 451 177 402 82 q 492 358 492 254 l 492 738 l 616 738 l 616 214 q 623 136 616 160 q 673 92 636 92 q 696 95 684 92 l 696 -4 "},h:{x_min:0,x_max:615,ha:724,o:"m 615 472 l 615 0 l 490 0 l 490 454 q 456 590 490 535 q 338 654 416 654 q 186 588 251 654 q 122 436 122 522 l 122 0 l 0 0 l 0 1013 l 122 1013 l 122 633 q 218 727 149 694 q 362 760 287 760 q 552 676 484 760 q 615 472 615 600 "},".":{x_min:0,x_max:142,ha:239,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"φ":{x_min:-2,x_max:878,ha:974,o:"m 496 -279 l 378 -279 l 378 -17 q 101 88 204 -17 q -2 367 -2 194 q 68 626 -2 510 q 283 758 151 758 l 283 646 q 167 537 209 626 q 133 373 133 462 q 192 177 133 254 q 378 93 259 93 l 378 758 q 445 764 426 763 q 476 765 464 765 q 765 659 653 765 q 878 377 878 553 q 771 96 878 209 q 496 -17 665 -17 l 496 -279 m 496 93 l 514 93 q 687 183 623 93 q 746 380 746 265 q 691 569 746 491 q 522 658 629 658 l 496 656 l 496 93 "},";":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 -12 q 105 -132 142 -82 q 0 -206 68 -182 l 0 -138 q 58 -82 43 -123 q 68 0 68 -56 l 0 0 l 0 151 l 142 151 l 142 -12 "},f:{x_min:0,x_max:378,ha:472,o:"m 378 638 l 246 638 l 246 0 l 121 0 l 121 638 l 0 638 l 0 738 l 121 738 q 137 935 121 887 q 290 1028 171 1028 q 320 1027 305 1028 q 378 1021 334 1026 l 378 908 q 323 918 346 918 q 257 870 273 918 q 246 780 246 840 l 246 738 l 378 738 l 378 638 "},"“":{x_min:1,x_max:348.21875,ha:454,o:"m 140 670 l 1 670 l 1 830 q 37 943 1 897 q 140 1011 74 990 l 140 947 q 82 900 97 940 q 68 810 68 861 l 140 810 l 140 670 m 348 670 l 209 670 l 209 830 q 245 943 209 897 q 348 1011 282 990 l 348 947 q 290 900 305 940 q 276 810 276 861 l 348 810 l 348 670 "},A:{x_min:.03125,x_max:906.953125,ha:1008,o:"m 906 0 l 756 0 l 648 303 l 251 303 l 142 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 610 421 l 452 867 l 293 421 l 610 421 "},6:{x_min:53,x_max:739,ha:792,o:"m 739 312 q 633 62 739 162 q 400 -31 534 -31 q 162 78 257 -31 q 53 439 53 206 q 178 859 53 712 q 441 986 284 986 q 643 912 559 986 q 732 713 732 833 l 601 713 q 544 830 594 786 q 426 875 494 875 q 268 793 331 875 q 193 517 193 697 q 301 597 240 570 q 427 624 362 624 q 643 540 552 624 q 739 312 739 451 m 603 298 q 540 461 603 400 q 404 516 484 516 q 268 461 323 516 q 207 300 207 401 q 269 137 207 198 q 405 83 325 83 q 541 137 486 83 q 603 298 603 197 "},"‘":{x_min:1,x_max:139.890625,ha:236,o:"m 139 670 l 1 670 l 1 830 q 37 943 1 897 q 139 1011 74 990 l 139 947 q 82 900 97 940 q 68 810 68 861 l 139 810 l 139 670 "},"ϊ":{x_min:-70,x_max:283,ha:361,o:"m 283 800 l 173 800 l 173 925 l 283 925 l 283 800 m 40 800 l -70 800 l -70 925 l 40 925 l 40 800 m 283 3 q 232 -10 257 -5 q 181 -15 206 -15 q 84 26 118 -15 q 41 200 41 79 l 41 737 l 166 737 l 167 215 q 171 141 167 157 q 225 101 182 101 q 247 103 238 101 q 283 112 256 104 l 283 3 "},"π":{x_min:-.21875,x_max:773.21875,ha:857,o:"m 773 -7 l 707 -11 q 575 40 607 -11 q 552 174 552 77 l 552 226 l 552 626 l 222 626 l 222 0 l 97 0 l 97 626 l 0 626 l 0 737 l 773 737 l 773 626 l 676 626 l 676 171 q 695 103 676 117 q 773 90 714 90 l 773 -7 "},"ά":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 727 407 760 q 563 637 524 695 l 563 738 l 685 738 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 95 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 m 604 1040 l 415 819 l 332 819 l 466 1040 l 604 1040 "},O:{x_min:0,x_max:958,ha:1057,o:"m 485 1041 q 834 882 702 1041 q 958 512 958 734 q 834 136 958 287 q 481 -26 702 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 728 q 485 1041 263 1041 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 669 q 480 912 640 912 q 226 784 321 912 q 142 504 142 670 q 226 224 142 339 q 480 98 319 98 "},n:{x_min:0,x_max:615,ha:724,o:"m 615 463 l 615 0 l 490 0 l 490 454 q 453 592 490 537 q 331 656 410 656 q 178 585 240 656 q 117 421 117 514 l 117 0 l 0 0 l 0 738 l 117 738 l 117 630 q 218 728 150 693 q 359 764 286 764 q 552 675 484 764 q 615 463 615 593 "},3:{x_min:54,x_max:737,ha:792,o:"m 737 284 q 635 55 737 141 q 399 -25 541 -25 q 156 52 248 -25 q 54 308 54 140 l 185 308 q 245 147 185 202 q 395 96 302 96 q 539 140 484 96 q 602 280 602 190 q 510 429 602 390 q 324 454 451 454 l 324 565 q 487 584 441 565 q 565 719 565 617 q 515 835 565 791 q 395 879 466 879 q 255 824 307 879 q 203 661 203 769 l 78 661 q 166 909 78 822 q 387 992 250 992 q 603 921 513 992 q 701 723 701 844 q 669 607 701 656 q 578 524 637 558 q 696 434 655 499 q 737 284 737 369 "},9:{x_min:53,x_max:739,ha:792,o:"m 739 524 q 619 94 739 241 q 362 -32 516 -32 q 150 47 242 -32 q 59 244 59 126 l 191 244 q 246 129 191 176 q 373 82 301 82 q 526 161 466 82 q 597 440 597 255 q 363 334 501 334 q 130 432 216 334 q 53 650 53 521 q 134 880 53 786 q 383 986 226 986 q 659 841 566 986 q 739 524 739 719 m 388 449 q 535 514 480 449 q 585 658 585 573 q 535 805 585 744 q 388 873 480 873 q 242 809 294 873 q 191 658 191 745 q 239 514 191 572 q 388 449 292 449 "},l:{x_min:41,x_max:166,ha:279,o:"m 166 0 l 41 0 l 41 1013 l 166 1013 l 166 0 "},"¤":{x_min:40.09375,x_max:728.796875,ha:825,o:"m 728 304 l 649 224 l 512 363 q 383 331 458 331 q 256 363 310 331 l 119 224 l 40 304 l 177 441 q 150 553 150 493 q 184 673 150 621 l 40 818 l 119 898 l 267 749 q 321 766 291 759 q 384 773 351 773 q 447 766 417 773 q 501 749 477 759 l 649 898 l 728 818 l 585 675 q 612 618 604 648 q 621 553 621 587 q 591 441 621 491 l 728 304 m 384 682 q 280 643 318 682 q 243 551 243 604 q 279 461 243 499 q 383 423 316 423 q 487 461 449 423 q 525 553 525 500 q 490 641 525 605 q 384 682 451 682 "},"κ":{x_min:0,x_max:632.328125,ha:679,o:"m 632 0 l 482 0 l 225 384 l 124 288 l 124 0 l 0 0 l 0 738 l 124 738 l 124 446 l 433 738 l 596 738 l 312 466 l 632 0 "},4:{x_min:48,x_max:742.453125,ha:792,o:"m 742 243 l 602 243 l 602 0 l 476 0 l 476 243 l 48 243 l 48 368 l 476 958 l 602 958 l 602 354 l 742 354 l 742 243 m 476 354 l 476 792 l 162 354 l 476 354 "},p:{x_min:0,x_max:685,ha:786,o:"m 685 364 q 598 96 685 205 q 350 -23 504 -23 q 121 89 205 -23 l 121 -278 l 0 -278 l 0 738 l 121 738 l 121 633 q 220 726 159 691 q 351 761 280 761 q 598 636 504 761 q 685 364 685 522 m 557 371 q 501 560 557 481 q 330 651 437 651 q 162 559 223 651 q 108 366 108 479 q 162 177 108 254 q 333 87 224 87 q 502 178 441 87 q 557 371 557 258 "},"‡":{x_min:0,x_max:777,ha:835,o:"m 458 238 l 458 0 l 319 0 l 319 238 l 0 238 l 0 360 l 319 360 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 l 777 804 l 777 683 l 458 683 l 458 360 l 777 360 l 777 238 l 458 238 "},"ψ":{x_min:0,x_max:808,ha:907,o:"m 465 -278 l 341 -278 l 341 -15 q 87 102 180 -15 q 0 378 0 210 l 0 739 l 133 739 l 133 379 q 182 195 133 275 q 341 98 242 98 l 341 922 l 465 922 l 465 98 q 623 195 563 98 q 675 382 675 278 l 675 742 l 808 742 l 808 381 q 720 104 808 213 q 466 -13 627 -13 l 465 -278 "},"η":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 720 124 755 q 200 630 193 686 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 "}},cssFontWeight:"normal",ascender:1189,underlinePosition:-100,cssFontStyle:"normal",boundingBox:{yMin:-334,xMin:-111,yMax:1189,xMax:1672},resolution:1e3,original_font_information:{postscript_name:"Helvetiker-Regular",version_string:"Version 1.00 2004 initial release",vendor_url:"http://www.magenta.gr/",full_font_name:"Helvetiker",font_family_name:"Helvetiker",copyright:"Copyright (c) Μagenta ltd, 2004",description:"",trademark:"",designer:"",designer_url:"",unique_font_identifier:"Μagenta ltd:Helvetiker:22-10-104",license_url:"http://www.ellak.gr/fonts/MgOpen/license.html",license_description:'Copyright (c) 2004 by MAGENTA Ltd. All Rights Reserved.\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of the fonts accompanying this license ("Fonts") and associated documentation files (the "Font Software"), to reproduce and distribute the Font Software, including without limitation the rights to use, copy, merge, publish, distribute, and/or sell copies of the Font Software, and to permit persons to whom the Font Software is furnished to do so, subject to the following conditions: \r\n\r\nThe above copyright and this permission notice shall be included in all copies of one or more of the Font Software typefaces.\r\n\r\nThe Font Software may be modified, altered, or added to, and in particular the designs of glyphs or characters in the Fonts may be modified and additional glyphs or characters may be added to the Fonts, only if the fonts are renamed to names not containing the word "MgOpen", or if the modifications are accepted for inclusion in the Font Software itself by the each appointed Administrator.\r\n\r\nThis License becomes null and void to the extent applicable to Fonts or Font Software that has been modified and is distributed under the "MgOpen" name.\r\n\r\nThe Font Software may be sold as part of a larger software package but no copy of one or more of the Font Software typefaces may be sold by itself. \r\n\r\nTHE FONT SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL MAGENTA OR PERSONS OR BODIES IN CHARGE OF ADMINISTRATION AND MAINTENANCE OF THE FONT SOFTWARE BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM OTHER DEALINGS IN THE FONT SOFTWARE.',manufacturer_name:"Μagenta ltd",font_sub_family_name:"Regular"},descender:-334,familyName:"Helvetiker",lineHeight:1522,underlineThickness:50})}}])}(Re),function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="VideoProbe",e}return Te(t,e),Ee(t,[{key:"addToParentCollector",value:function(){this.parent.videoprobes.push(this)}}]),t}(Xe)),lt=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.outdoors=null,e.buildings=[],e.isContainer=!0,e.type="World",e}return Te(t,e),Ee(t,[{key:"build",value:function(){this.createMesh();for(var e=0;e<this.buildings.length;e++){this.buildings[e].build()}this.outdoors&&this.outdoors.build()}},{key:"childBuildedCallback",value:function(e){for(var t=e.parent,i=0;i<t.children.length;i++){if(!t.children[i].isBuilded)return}t.processWhenBuildFinish()}},{key:"children",get:function(){return null===this._children&&(this._children=[],this.outdoors&&this._children.push(this.outdoors),this._children=this._children.concat(this.buildings)),this._children}},{key:"size",get:function(){return null===this._size&&(this._size=new THREE.Vector3,this.boundingBox.isEmpty()||this.boundingBox.getSize(this._size)),this._size}},{key:"boundingBox",get:function(){if(null===this._boundingBox){this._boundingBox=new THREE.Box3;for(var e=0;e<this.buildings.length;e++){var t=this.buildings[e].boundingBox;this._boundingBox.expandByPoint(t.min),this._boundingBox.expandByPoint(t.max)}this._boundingBox.expandByPoint(this.outdoors.boundingBox.min),this._boundingBox.expandByPoint(this.outdoors.boundingBox.max)}return this._boundingBox}}]),t}(Re),ut=function e(t,i,r,n){xe(this,e),this.positionArray=t.geometry.getAttribute("position").array.slice();var o=t.geometry.getAttribute("normal");o?this.normalArray=o.array.slice():console.warn("not has normal");var a=t.geometry.getAttribute("uv");a&&(this.uvArray=a.array);var s=t.geometry.getAttribute("uv2");s&&(this.uv2Array=s.array);var l=t.geometry.getAttribute("uv3");l&&(this.uv3Array=l.array);var u=t.geometry.getAttribute("color");u&&(this.colorArray=u.array),this.indexArray=t.geometry.index.array,this.material=t.material;for(var c=this.positionArray,h=this.normalArray,p=0;p<c.length;){for(var d=n.length-1;d>-1;d--){var f=i[d],m=r[d],g=n[d];c[p]*=f.x,c[p+1]*=f.y,c[p+2]*=f.z;var v=new THREE.Vector3(c[p],c[p+1],c[p+2]);if((v=v.applyQuaternion(m)).x+=g.x,v.y+=g.y,v.z+=g.z,c[p]=v.x,c[p+1]=v.y,c[p+2]=v.z,h){var y=new THREE.Vector3(h[p],h[p+1],h[p+2]);y=y.applyQuaternion(m),h[p]=y.x,h[p+1]=y.y,h[p+2]=y.z}}p+=3}this.vertexCount=this.positionArray.length/3,this.indexCount=this.indexArray.length,this.groups=t.geometry.groups},ct=function(){function e(t){xe(this,e),this.bundeObj=t,this.materialMap=new Map,this.combineBundleMeshs=[],this.vertexCount=0}return Ee(e,[{key:"combine",value:function(){this._combine(this.bundeObj,[],[],[])}},{key:"_combine",value:function(e,t,i,r){if(t.push(e.scale),r.push(e.position),i.push(e.quaternion),e instanceof THREE.Mesh){var n=new ut(e,t,i,r);0!==n.vertexCount&&(this.combineBundleMeshs.push(n),void 0===this.materialMap.get(n.material)&&this.materialMap.set(n.material,[]),this.materialMap.get(n.material).push(n)),this.vertexCount+=n.vertexCount}if(0!==e.children.length)for(var o=0;o<e.children.length;o++){var a=i.slice(),s=t.slice(),l=r.slice();this._combine(e.children[o],s,a,l)}}}]),e}(),ht=new function e(){xe(this,e),this.isDebug=!1,this.isTesting=!1},pt=function(){function e(t){xe(this,e),this.url=null,this.isEmpty=!1,this.callbackObjects=[],this.ready=!1,this.texture=null,this.model=null,this.modelName=null,this.modelID=null,this.id=null,this.ext=null,this.baseUrl=null,this.version=null,this.isDefault=!1,this.animations=null,this.isCombine=!1,this.combineBundleObj=null,this.manager=t,this.modelSize=null,this.animations=null,this.tryHightedtVersion=!1,this.debug=!1,this.gltfRoot=null,this.isStartDownload=!1,this.material=null,this.wallMaterial=null,this.roomMaterial=null,this.useStaticImage=!1,this.isSupportHeadAndFootModelWall=!1}return Ee(e,[{key:"initMaterial",value:function(){this.material=new THREE.MeshStandardMaterial,this.wallMaterial=new THREE.MeshStandardMaterial({color:16777215}),this.isDefault?Me.userDefaultWallLightMap&&(this.wallMaterial.defines=this.wallMaterial.defines||{},this.wallMaterial.defines.WALL_AO=!0,this.wallMaterial.metalness=.2,this.wallMaterial.roughness=.8):(this.wallMaterial.metalness=0,this.wallMaterial.roughness=1),this.roomMaterial=new THREE.MeshLambertMaterial({color:16777215,reflectivity:.1}),this.roomMaterial.defines=this.roomMaterial.defines||{},this.roomMaterial.defines.FLOOR_AO=!0}},{key:"registerListener",value:function(e){this.callbackObjects.push(e)}},{key:"requestToDownload",value:function(){this.isStartDownload=!0,this.manager.addResourceDownloadRequest(this)}},{key:"combine",value:function(){this.model&&(this.combineBundleObj=new ct(this.model),this.combineBundleObj.combine(),this.combineBundleObj.vertexCount>=6e4?(this.isCombine=!1,console.warn("combine "+this.id+" exceed max vectex")):this.isCombine=!0)}},{key:"hasAnimation",value:function(){return void 0!==this.animations&&(null!==this.animations&&(!Array.isArray(this.animations)||0!==this.animations.length))}},{key:"getTextureUrl",value:function(){return this.baseUrl+this.id+"."+(null===this.ext?"jpg":this.ext)}},{key:"getModelUrl",value:function(){if(this.url)return this.url;var e=0;return this.manager.enableUserHighestVersionResource||(e=this.version),this.baseUrl+this.modelID+"/"+e+"/gltf/"}},{key:"downloadTexture",value:function(e){if(this.initMaterial(),ht.isTesting)this.downloadTestTexture(e);else{var t=this;if("bundle"===this.ext)return t.ready=!0,console.warn("not support bundle texture"),void e();var i=new THREE.TextureLoader;i.setCrossOrigin("anonymous");var r=null;r=this.url?this.url:this.baseUrl+this.id+"."+(null===this.ext?"jpg":this.ext),i.load(r,(function(i){i.wrapS=THREE.RepeatWrapping,i.wrapT=THREE.RepeatWrapping,t.texture=i,t.material.map=i,t.wallMaterial.map=i,t.roomMaterial.map=i,t.ready=!0,t.material.roughness=1,t.debug&&console.log(t.id+" download complete"),t.downloadCallback(e)}),(function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")}),(function(i){t.ready=!0,console.error("download error "+r),t.downloadCallback(e)}))}}},{key:"downloadModel",value:function(e){if(ht.isTesting)this.downloadTestModel(e);else{var t=this,i=new thingjs.GLTFLoader,r=null,n=0;this.manager.enableUserHighestVersionResource||(n=this.version),r=this.url?this.url:this.baseUrl+this.id+"/"+n+"/gltf/",i.loadFromURL({url:r,useStaticImage:this.useStaticImage,jsonCallback:function(e){t.indexJson=e},modelCallback:function(i){t.animations=i.animations,t.model=i.node,t.ready=!0,t.downloadCallback(e),t.debug&&console.log(t.id+" download complete")},errorCallback:function(){console.error("download error "+r),t.ready=!0,t.model=new THREE.Object3D,t.isEmpty=!0,t.downloadCallback(e)}})}}},{key:"downloadCallback",value:function(e){try{for(var t=0;t<this.callbackObjects.length;t++){this.callbackObjects[t].resourceCallback(this)}e&&e()}catch(e){console.error(e)}}},{key:"downloadTestModel",value:function(e){this.ready=!0;var t=(new THREE.TextureLoader).load("../textures/water.jpg"),i=new THREE.BoxBufferGeometry(200,200,200),r=new THREE.MeshBasicMaterial({map:t});this.model=new THREE.Mesh(i,r),this.downloadCallback(e)}},{key:"downloadTestTexture",value:function(e){var t=(new THREE.TextureLoader).load("../textures/water.jpg");t.wrapS=THREE.RepeatWrapping,t.wrapT=THREE.RepeatWrapping,t.repeat.set(4,4),this.texture=t,this.material.map=t,this.wallMaterial.map=t,this.roomMaterial.map=t,this.ready=!0,this.downloadCallback(e)}},{key:"dispose",value:function(){this.texture&&(this.texture.dispose(),this.texture=null),this.model&&(this._disposeModel(this.model),this.model=null),this.combineBundleObj&&(this._disposeModel(this.combineBundleObj),this.combineBundleObj=null),this.wallMaterial&&this.wallMaterial.dispose(),this.roomMaterial&&this.roomMaterial.dispose(),this.material&&this.material.dispose(),this.wallMaterial=null,this.roomMaterial=null,this.material=null,this.animations=null,this.isStartDownload=!1,this.combineBundleObj=null,this.isCombine=!1,this.ready=!1}},{key:"_disposeModel",value:function(e){for(var t=0;t<e.children.length;t++){var i=e.children[t];this._disposeModel(i)}if(e instanceof THREE.Mesh){var r=e.material,n=e.geometry,o=e.material.texture;r&&r.dispose(),n&&n.dispose(),o&&o.dispose()}}},{key:"isModel",get:function(){return null===this.ext}}]),e}(),dt=function(e){function t(e){xe(this,t);var i=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.customTexture=null,i.color=null,i.renderMode=null,i.modelID=null,i}return Te(t,e),Ee(t,[{key:"combine",value:function(){this.model&&(null!==this.customTexture&&this.changeWithCustomTexture(this.model),null!==this.color&&this.changeWithCustomColor(this.model),null!==this.renderMode&&this.changeRenderMode(this.model),this.combineBundleObj=new ct(this.model),this.combineBundleObj.combine(),this.isCombine=!0)}},{key:"changeRenderMode",value:function(e){var t=this;e instanceof THREE.Mesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){if(e.color=t.color,null!==t.renderMode)switch(t.renderMode){case 1:e.transparent=!1,e.alphaTest=.5;break;case 3:case 2:e.transparent=!0;break;default:console.error("can not find renderMode "+t.renderMode)}}));for(var i=0;i<e.children.length;i++){var r=e.children[i];this.changeRenderMode(r)}}},{key:"changeWithCustomColor",value:function(e){var t=this;e instanceof THREE.Mesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.color=t.color,null!==t.opacity&&(e.opacity=t.opacity,e.transparent=!0)}));for(var i=0;i<e.children.length;i++){var r=e.children[i];this.changeWithCustomColor(r)}}},{key:"changeWithCustomTexture",value:function(e){var t=this;e instanceof THREE.Mesh&&(this.customTexture&&this.customTexture.texture&&(this.customTexture.texture.flipY=!1),(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.map=t.customTexture.texture})));for(var i=0;i<e.children.length;i++){var r=e.children[i];this.changeWithCustomTexture(r)}}},{key:"downloadModel",value:function(e){if(ht.isTesting)this.downloadTestModel(e);else{var t=this,i=new thingjs.GLTFLoader,r=null,n=0;this.manager.enableUserHighestVersionResource||(n=this.version),r=this.url?this.url:this.baseUrl+this.modelID+"/"+n+"/gltf/",i.loadFromURL({url:r,useStaticImage:this.useStaticImage,jsonCallback:function(e){t.indexJson=e},modelCallback:function(i){t.model=i.node.children[0],t.animations=i.animations,null!==t.customTexture?t.customTexture.downloadTexture((function(){null!==t.customTexture&&t.changeWithCustomTexture(t.model),null!==t.color&&t.changeWithCustomColor(t.model),null!==t.renderMode&&t.changeRenderMode(t.model),t.ready=!0,t.downloadCallback(e)})):(null!==t.color&&t.changeWithCustomColor(t.model),null!==t.renderMode&&t.changeRenderMode(t.model),t.ready=!0,t.downloadCallback(e))},errorCallback:function(){console.error("download error "+r),t.ready=!0,t.model=new THREE.Object3D,t.isEmpty=!0,t.downloadCallback(e)}})}}}]),t}(pt),ft=function(e){function t(e){xe(this,t);var i=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.customTexture=null,i.color=null,i.renderMode=null,i.modelID=null,i.localBaseUrl=null,i.localUrl=null,i}return Te(t,e),Ee(t,[{key:"combine",value:function(){this.model&&(null!==this.customTexture&&this.changeWithCustomTexture(this.model),null!==this.color&&this.changeWithCustomColor(this.model),null!==this.renderMode&&this.changeRenderMode(this.model),this.combineBundleObj=new ct(this.model),this.combineBundleObj.combine(),this.isCombine=!0)}},{key:"changeRenderMode",value:function(e){var t=this,i=this;e instanceof THREE.Mesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){if(e.color=t.color,null!==i.renderMode)switch(i.renderMode){case 1:e.transparent=!1,e.alphaTest=.5;break;case 3:case 2:e.transparent=!0;break;default:console.error("can not find renderMode "+t.renderMode)}}));for(var r=0;r<e.children.length;r++){var n=e.children[r];this.changeRenderMode(n)}}},{key:"changeWithCustomColor",value:function(e){var t=this;e instanceof THREE.Mesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.color=t.color,null!==t.opacity&&(e.opacity=t.opacity,e.transparent=!0)}));for(var i=0;i<e.children.length;i++){var r=e.children[i];this.changeWithCustomColor(r)}}},{key:"changeWithCustomTexture",value:function(e){var t=this;e instanceof THREE.Mesh&&(this.customTexture&&this.customTexture.texture&&(this.customTexture.texture.flipY=!1),(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.map=t.customTexture.texture})));for(var i=0;i<e.children.length;i++){var r=e.children[i];this.changeWithCustomTexture(r)}}},{key:"getModelUrl",value:function(){if(this.url)return this.url;var e=null;return this.localUrl&&(e=this.localBaseUrl+this.localUrl),e}},{key:"downloadModel",value:function(e){if(ht.isTesting)this.downloadTestModel(e);else{var t=this,i=(new THREE.FileLoader,null);this.localUrl?(i=this.localBaseUrl+this.localUrl,(new thingjs.GLTFLoader).load(i,(function(i){t.model=i.scene,t.animations=i.animations;var r=new THREE.Box3;r.makeEmpty(),r=r.setFromObject(t.model),t.modelSize=r.getSize(new THREE.Vector3),null!==t.customTexture?t.customTexture.downloadTexture((function(){null!==t.customTexture&&t.changeWithCustomTexture(t.model),null!==t.color&&t.changeWithCustomColor(t.model),null!==t.renderMode&&t.changeRenderMode(t.model),t.ready=!0,t.downloadCallback(e)})):(null!==t.color&&t.changeWithCustomColor(t.model),null!==t.renderMode&&t.changeRenderMode(t.model),t.ready=!0,t.downloadCallback(e))}),void 0,(function(r){console.error("download error "+i+"  "+r),t.ready=!0,t.model=new THREE.Object3D,t.isEmpty=!0,t.downloadCallback(e)}))):console.error("can not find url")}}}]),t}(pt),mt=function(e){function t(e){xe(this,t);var i=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.localBaseUrl=null,i.localUrl=null,i}return Te(t,e),Ee(t,[{key:"registerListener",value:function(e){this.callbackObjects.push(e)}},{key:"downloadTexture",value:function(e){if(this.initMaterial(),ht.isTesting)this.downloadTestTexture(e);else{var t=this;if("bundle"===this.ext)return t.ready=!0,console.warn("not support bundle texture"),void e();var i=new THREE.TextureLoader;i.setCrossOrigin("anonymous");var r=null;this.localUrl?(r=this.localBaseUrl+this.localUrl,i.load(r,(function(i){i.wrapS=THREE.RepeatWrapping,i.wrapT=THREE.RepeatWrapping,i.flipY=!0,t.texture=i,t.material.map=i,t.wallMaterial.map=i,t.roomMaterial.map=i,t.ready=!0,t.material.roughness=1,t.debug&&console.log(t.id+" download complete"),t.downloadCallback(e)}),(function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")}),(function(i){t.ready=!0,console.error("download error "+r),t.downloadCallback(e)}))):console.error("can not find url")}}}]),t}(pt),gt=function(){function e(){xe(this,e),this.textures=[],this.models=[],this.baseTextureUrl="https://static.3dmomoda.com/textures/",this.baseModelUrl="https://model.3dmomoda.com/models/",this.localCustomModelBaseUrl=null,this.wallTextures=[],this.wallModels=[],this.roomTextures=[],this.commonTextures=[],this.doorOrWindowModels=[],this.placementModels=[],this.isStartedDonwloadResouces=!1,this.allResouces=[],this.curDonwloadResIndex=-1,this.alreadyResouceCount=0,this.downloadResMaxCount=10,this.downloadResCompleteCallback=null,this.delayDownload=!1,this.resourceMap={},this.downloadResProgess=0,this.opacity=null,this.currentDownloadResMap=new Map,this.enableUserHighestVersionResource=Me.enableUseHighestVersionResource,this.requestDownloadResources=[],this.ableToSupportFootAndHeadModelWalls=Me.ableToSupportFootAndHeadModelWalls,this.emptyTextureResource=null,this.emptyModelResource=null,this.createEmptyModelResource(),this.createEmptyTextureResource()}return Ee(e,[{key:"addCommonTextureResource",value:function(e){this._addResource(e,this.commonTextures)}},{key:"addWallTextureResource",value:function(e){for(var t=0;t<this.wallTextures.length;t++){if(this.wallTextures[t].id===e.id)return}this.wallTextures.push(e)}},{key:"addWallModelResource",value:function(e){for(var t=0;t<this.wallModels.length;t++){if(this.wallModels[t].id===e.id)return}this.wallModels.push(e)}},{key:"addPlacementResource",value:function(e){this._addResource(e,this.placementModels)}},{key:"addRoomResource",value:function(e){this._addResource(e,this.roomTextures)}},{key:"_addResource",value:function(e,t){for(var i=0;i<t.length;i++){if(t[i].id===e.id)return}t.push(e)}},{key:"checkAllResourcesIsReady",value:function(){for(var e=0;e<this.textures.length;e++){var t=this.textures[e];if(!t.ready)return console.log(t.url),!1}for(e=0;e<this.models.length;e++){var i=this.models[e];if(!i.ready)return console.log(i.url),!1}return!0}},{key:"resourceCallback",value:function(){this.alreadyResouceCount++,this.alreadyResouceCount===this.downloadResMaxCount&&this.downloadResources()}},{key:"downloadResources",value:function(e){var t=this;if(this.isStartedDonwloadResouces){if(this.curDonwloadResIndex===this.allResouces.length-1)return this.downloadResProgess=1,void e()}else{var i=[];this.downloadResProgess=0,i=i.concat(this.wallTextures).concat(this.wallModels).concat(this.roomTextures).concat(this.doorOrWindowModels).concat(this.placementModels).concat(this.commonTextures),this.allResouces=i,this.isStartedDonwloadResouces=!0,this.curDonwloadResIndex=0}if(0===this.allResouces.length)return this.downloadResProgess=1,void e();for(var r=0,n=[],o=this.curDonwloadResIndex;o<this.allResouces.length;o++,r++){var a=this.allResouces[o];if(null===a.ext){var s=new Promise((function(e,t){a.downloadModel((function(){e()}))}));n.push(s)}else{s=new Promise((function(e,t){a.downloadTexture((function(){e()}))}));n.push(s)}if(this.curDonwloadResIndex++,r===this.downloadResMaxCount){this.curDonwloadResIndex=o;break}o===this.allResouces.length-1&&(this.curDonwloadResIndex=o)}Promise.all(n).then((function(){t.downloadResProgess=t.curDonwloadResIndex/(t.allResouces.length-1),t.downloadResources(e)})).catch((function(e){console.log(e)}))}},{key:"downloadResourcesWithQueue",value:function(e){var t=this;if(0!==t.allResouces.length&&(this.downloadResProgess=(this.curDonwloadResIndex-this.currentDownloadResMap.size)/t.allResouces.length),this.isStartedDonwloadResouces){if(this.curDonwloadResIndex===this.allResouces.length&&0===this.currentDownloadResMap.size)return this.downloadResProgess=1,void e()}else{var i=[];this.downloadResProgess=0,i=Me.enableCombine?i.concat(this.wallTextures).concat(this.wallModels).concat(this.roomTextures).concat(this.doorOrWindowModels).concat(this.placementModels).concat(this.commonTextures):i.concat(this.textures).concat(this.models),this.allResouces=i,this.isStartedDonwloadResouces=!0,this.curDonwloadResIndex=0,this.currentDownloadResMap=new Map}if(0===this.allResouces.length)return this.downloadResProgess=1,void e();if(!(this.curDonwloadResIndex>this.allResouces.length-1)&&0!==this.downloadResMaxCount-this.currentDownloadResMap.size){var r=this.allResouces[this.curDonwloadResIndex];if(null===r.ext)new Promise((function(e,t){r.downloadModel((function(){e(r)}))})).then((function(i){t.currentDownloadResMap.delete(i.id),t.downloadResourcesWithQueue(e)})),this.currentDownloadResMap.set(r.id,r);else new Promise((function(e,t){r.downloadTexture((function(){e(r)}))})).then((function(i){t.currentDownloadResMap.delete(i.id),t.downloadResourcesWithQueue(e)})),this.currentDownloadResMap.set(r.id,r);this.curDonwloadResIndex++,this.downloadResourcesWithQueue(e)}}},{key:"downloadSplitSceneResourcesWithQueue",value:function(e){this.downloadResourcesWithQueue(e)}},{key:"resetDownloadResources",value:function(){this.allResouces=[],this.wallTextures=[],this.wallModels=[],this.roomTextures=[],this.doorOrWindowModels=[],this.placementModels=[],this.commonTextures=[],this.isStartedDonwloadResouces=!1}},{key:"disposeModels",value:function(){for(var e=0;e<this.models.length;e++){this.models[e].dispose()}}},{key:"disposeTextures",value:function(){for(var e=0;e<this.textures.length;e++){this.textures[e].dispose()}}},{key:"addResourceDownloadRequest",value:function(e){this.requestDownloadResources.push(e)}},{key:"startToDownloadRequestResources",value:function(e){var t=this;if(0!==t.requestDownloadResources.length&&(this.downloadResProgess=(this.curDonwloadResIndex-this.currentDownloadResMap.size)/t.requestDownloadResources.length,e&&e(this.downloadResProgess)),this.isStartedDonwloadResouces){if(this.curDonwloadResIndex===this.requestDownloadResources.length&&0===this.currentDownloadResMap.size)return this.downloadResProgess=1,void(e&&e(this.downloadResProgess))}else{t.requestDownloadResources;this.isStartedDonwloadResouces=!0,this.curDonwloadResIndex=0,this.currentDownloadResMap=new Map}if(0===this.requestDownloadResources.length)return this.downloadResProgess=1,void(e&&e(this.downloadResProgess));if(!(this.curDonwloadResIndex>this.requestDownloadResources.length-1)&&0!==this.downloadResMaxCount-this.currentDownloadResMap.size){var i=this.requestDownloadResources[this.curDonwloadResIndex];if(null===i.ext)new Promise((function(e,t){i.downloadModel((function(){e(i)}))})).then((function(i){t.currentDownloadResMap.delete(i.id),t.startToDownloadRequestResources(e)})),this.currentDownloadResMap.set(i.id,i);else new Promise((function(e,t){i.downloadTexture((function(){e(i)}))})).then((function(i){t.currentDownloadResMap.delete(i.id),t.startToDownloadRequestResources(e)})),this.currentDownloadResMap.set(i.id,i);this.curDonwloadResIndex++,this.startToDownloadRequestResources(e)}}},{key:"createEmptyTextureResource",value:function(){this.emptyTextureResource=new pt,this.emptyTextureResource.ready=!0,this.emptyTextureResource.texture=new THREE.Texture,this.emptyTextureResource.isEmpty=!0}},{key:"createEmptyModelResource",value:function(){this.emptyModelResource=new pt,this.emptyModelResource.ready=!0,this.emptyModelResource.model=new THREE.Object3D,this.emptyModelResource.isEmpty=!0}}]),e}(),vt=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="RouteLine",e.color=new THREE.Color(0,0,1),e}return Te(t,e),t}(qe),yt=function(e){function t(e){xe(this,t);var i=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="PlacementWall",i}return Te(t,e),Ee(t,[{key:"addToParentCollector",value:function(){this.parent.walls.push(this)}}]),t}(Xe),bt=function(e){function t(){xe(this,t);var e=Se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="PlacementGround",e}return Te(t,e),Ee(t,[{key:"addToParentCollector",value:function(){this.parent.placementGrounds.push(this)}}]),t}(Xe),_t={Resource:pt,CustomModelResource:ft,CustomResource:dt,LocalCustomTextureResource:mt,World:lt,Building:ze,FloorPlan:rt,Room:Fe,Floor:De,Ceiling:Pe,Roof:je,StraightManualWall:Ne,ModelWall:Ve,WallCorner:Oe,Placement:Xe,PlacementGroup:Ye,DoorOrWindow:it,Outdoors:nt,Facade:Qe,FacadeGroup:Je,VideoProbe:st,CurveLine:qe,LeakWaterLine:at,ArrowLine:We,ArrowDataLine:Ge,RouteLine:vt,PipeLine:ot,PlacementWall:yt,PlacementGround:bt},xt=function(){function e(t,r){i(this,e),this.vertexCount=0,this.indexCount=0,this.material=t,this.bundeMeshs=[],this.groups=[],this.transformations=[],this.maxCount=65534,this.combineMesh=null,this.combineManager=r}return r(e,[{key:"isExceed",value:function(e){return this.vertexCount+e>this.maxCount}},{key:"build",value:function(){for(var e=this.bundeMeshs,t=this.indexCount,i=this.vertexCount,r=new Float32Array(3*i),n=new Float32Array(3*i),o=new Float32Array(2*i),a=new Float32Array(4*i),s=new Float32Array(2*i),l=new Uint16Array(t),u=0,c=0,h=0,p=0,d=0,f=new THREE.BufferGeometry,m=0;m<e.length;m++){for(var g=e[m],v=this.transformations[m],y=v.positions,b=v.scales,_=v.quaternions,x=g.indexArray,E=0;E<x.length;E++)l[E+p]=u/3+x[E];p+=x.length;var w=g.positionArray;for(E=0;E<w.length;){for(var T=new THREE.Vector3(w[E],w[E+1],w[E+2]),S=y.length-1;S>-1;S--){var A=y[S],M=b[S],C=_[S];T.x*=M.x,T.y*=M.y,T.z*=M.z,(T=T.applyQuaternion(C)).x+=A.x,T.y+=A.y,T.z+=A.z}r[E+u]=T.x,r[E+u+1]=T.y,r[E+u+2]=T.z,E+=3}u+=w.length;var R=g.normalArray;for(E=0;E<R.length;){var D=new THREE.Vector3(R[E],R[E+1],R[E+2]);for(S=_.length-1;S>-1;S--){C=_[S];D=D.applyQuaternion(C)}n[E+c]=D.x,n[E+c+1]=D.y,n[E+c+2]=D.z,E+=3}c+=R.length;var P=g.uvArray;if(P)for(E=0;E<P.length;E++)o[E+h]=P[E];var j=g.uv2Array;if(j)for(E=0;E<j.length;E++)s[E+h]=j[E];P&&(h+=P.length);var F=g.colorArray;if(F){for(E=0;E<F.length;E++)a[E+d]=F[E];d+=F.length}}f.addAttribute("position",new THREE.BufferAttribute(r,3)),f.addAttribute("normal",new THREE.BufferAttribute(n,3)),f.addAttribute("uv",new THREE.BufferAttribute(o,2)),0!==s.length&&f.addAttribute("uv2",new THREE.BufferAttribute(s,2)),0!==a.length&&f.addAttribute("color",new THREE.BufferAttribute(a,4)),f.setIndex(new THREE.BufferAttribute(l,1));var O=new THREE.Mesh(f,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,O.name="combine",this.combineMesh=O}}]),e}(),Et=function(e){function t(e,r){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.meshInfos=[],n}return o(t,e),r(t,[{key:"add",value:function(e){if(this.isExceed(e.indexArray.length))return console.warn("combine exceed vertex count "),!1;this.vertexCount+=e.positionArray.length/3,this.indexCount+=e.indexArray.length,this.meshInfos.push(e)}},{key:"build",value:function(){for(var e=this.meshInfos,t=this.indexCount,i=this.vertexCount,r=new Float32Array(3*i),n=new Float32Array(3*i),o=new Float32Array(2*i),a=new Float32Array(4*i),s=new Float32Array(2*i),l=new Uint16Array(t),u=0,c=0,h=0,p=0,d=0,f=new THREE.BufferGeometry,m=0;m<e.length;m++){for(var g=e[m],v=g.parentPosition,y=g.indexArray,b=0;b<y.length;b++)l[b+p]=u/3+y[b];p+=y.length;var _=g.positionArray;for(b=0;b<_.length;){var x=new THREE.Vector3(_[b]+v.x,_[b+1]+v.y,_[b+2]+v.z);r[b+u]=x.x,r[b+u+1]=x.y,r[b+u+2]=x.z,b+=3}u+=_.length;var E=g.normalArray;for(b=0;b<E.length;){var w=new THREE.Vector3(E[b],E[b+1],E[b+2]);n[b+c]=w.x,n[b+c+1]=w.y,n[b+c+2]=w.z,b+=3}c+=E.length;var T=g.uvArray;if(T)for(b=0;b<T.length;b++)o[b+h]=T[b];var S=g.uv2Array;if(S)for(b=0;b<S.length;b++)s[b+h]=S[b];T&&(h+=T.length);var A=g.colorArray;if(A){for(b=0;b<A.length;b++)a[b+d]=A[b];d+=A.length}}f.addAttribute("position",new THREE.BufferAttribute(r,3)),f.addAttribute("normal",new THREE.BufferAttribute(n,3)),f.addAttribute("uv",new THREE.BufferAttribute(o,2)),0!==s.length&&f.addAttribute("uv2",new THREE.BufferAttribute(s,2)),0!==a.length&&f.addAttribute("color",new THREE.BufferAttribute(a,4)),f.setIndex(new THREE.BufferAttribute(l,1));var M=new THREE.Mesh(f,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,M.name="combine",this.combineMesh=M,this.combineMesh.name="manualWall",r=null,n=null,o=null,a=null,s=null,l=null,f=null}},{key:"clear",value:function(){}}]),t}(xt),wt=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.meshInfos=[],e.resource=null,e.vertexCount=0,e.indexCount=0,e.transformations=[],e.maxCount=65534,e.mesh=new THREE.Object3D,e.processors=[],e.lightMapResource=null,e.type="CombineStraightManualWall",e}return o(t,e),r(t,[{key:"getPointsFromMeshInfo",value:function(e){for(var t=[],i=e.positionArray,r=e.parentPosition,n=0;n<i.length;){var o=i[n]+r.x,a=i[n+1]+r.y,s=i[n+2]+r.z;t.push(new THREE.Vector3(o,a,s)),n+=3}return t}},{key:"addMeshInfo",value:function(e){this.vertexCount+=e.indexArray.length,this.indexCount+=e.indexArray.length,this.meshInfos.push(e)}},{key:"resourceCallback",value:function(e){this.checkResourceReady()&&this.build()}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return this.initResource(this.resource),void(this.lightMapResource&&this.initResource(this.lightMapResource));this.createMesh(),this.lightMapResource&&this.resource.isDefault&&(this.resource.wallMaterial.aoMap=this.lightMapResource.texture);for(var e=void 0,t=0;t<this.meshInfos.length;t++){var i=this.meshInfos[t];e&&!e.isExceed(i.indexArray.length)||(e=new Et(this.resource.wallMaterial,null),this.processors.push(e)),e.add(i)}for(var r=0;r<this.processors.length;r++){var n=this.processors[r];n.build(),this.mesh.add(n.combineMesh)}this.processWhenBuildFinish()}}},{key:"checkResourceReady",value:function(){for(var e=0;e<this.resources.length;e++){if(!this.resources[e].ready)return!1}return!0}},{key:"initResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"addToParentCollector",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.combineStraightManualWallObjects.push(this)}},{key:"clear",value:function(){for(var e=0;e<this.processors.length;e++){var i=this.processors[e];this._dispose(i.combineMesh)}this.combineProcessors=[],n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"isMultiResources",get:function(){return!!this.lightMapResource}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this._resources.push(this.resource),this.lightMapResource&&this._resources.push(this.lightMapResource)),this._resources}},{key:"size",get:function(){return null===this._size&&(this._size=new THREE.Vector3,this.boundingBox.getSize(this._size)),this._size}},{key:"boundingBox",get:function(){if(null===this._boundingBox){this._boundingBox=new THREE.Box3;for(var e=0;e<this.meshInfos.length;e++)for(var t=this.getPointsFromMeshInfo(this.meshInfos[e]),i=0;i<t.length;i++){var r=t[i];this._boundingBox.expandByPoint(r)}}return this._boundingBox}}]),t}(Re),Tt=function(){function e(){i(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return r(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),St=function(){function e(){i(this,e)}return r(e,null,[{key:"compatibilityProcessWorld",value:function(e){this.compatibilityProcessPlan(e.outdoors);for(var t=e.buildings,i=0;i<t.length;i++)for(var r=t[i].floorplans,n=0;n<r.length;n++){var o=r[n];this.compatibilityProcessPlan(o)}}},{key:"compatibilityProcessPlan",value:function(e){for(var t=0;t<e.combineStraightManualWallObjects.length;t++){var i=e.combineStraightManualWallObjects[t];e.combineStraightManualWalls.push(i.delayObject)}for(var r=0;r<e.combineCeilingObjects.length;r++){var n=e.combineCeilingObjects[r];e.combineCeilings.push(n.delayObject)}for(var o=0;o<e.combineFloorObjects.length;o++){var a=e.combineFloorObjects[o];e.combineFloors.push(a.delayObject)}for(var s=0;s<e.combineRoofObjects.length;s++){var l=e.combineRoofObjects[s];e.combineRoofs.push(l.delayObject)}for(var u=0;u<e.combineModelWallObjects.length;u++){var c=e.combineModelWallObjects[u];e.combineModelWalls.push(c.delayObject)}for(var h=0;h<e.combineDoorOrWindowObjects.length;h++){var p=e.combineDoorOrWindowObjects[h];e.combineDoorOrWins.push(p.delayObject)}for(var d=0;d<e.combinePlacementObjects.length;d++){var f=e.combinePlacementObjects[d];e.combinePlacements.push(f.delayObject)}}},{key:"combineObjectBuildCallback",value:function(e){var t=null;-1!==e.constructor.name.indexOf("Ceiling")?t=e.parent.combineCeilings:-1!==e.constructor.name.indexOf("DoorOrWindow")?t=e.parent.combineDoorOrWins:-1!==e.constructor.name.indexOf("Floor")?t=e.parent.combineFloors:-1!==e.constructor.name.indexOf("ModelWall")?t=e.parent.combineModelWalls:-1!==e.constructor.name.indexOf("Placement")?t=e.parent.combinePlacements:-1!==e.constructor.name.indexOf("Roof")?t=e.parent.combineRoofs:-1!==e.constructor.name.indexOf("Straight")&&(t=e.parent.combineStraightManualWalls),t.push(e.mesh)}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var a in i){o=!0;for(var s=i[a].skeleton,l=n[a],u=[],c=0;c<s.bones.length;++c){var h=r[s.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(i){if(null===i||"object"!==(void 0===i?"undefined":t(i)))return i;if(i instanceof Date)return(r=new Date).setTime(i.getTime()),r;if(i instanceof Array|i instanceof Object){var r=i instanceof Array?[]:{};for(var n in i)i.hasOwnProperty(n)&&(r[n]=e.cloneJSObject(i[n]));return r}throw new Error("Unable to clone obj! Its type isn't supported.")}}]),e}(),At=function(e){function t(e,r){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return o(t,e),r(t,[{key:"add",value:function(e,t){if(this.isExceed(e.vertexCount))return console.warn("combine exceed vertex count "),!1;this.vertexCount+=e.vertexCount,this.indexCount+=e.indexCount,this.bundeMeshs.push(e),this.transformations.push(t)}},{key:"cloneGroups",value:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];t.push(St.cloneJSObject(r))}return t}},{key:"build",value:function(){for(var e=this.bundeMeshs,t=this.indexCount,i=this.vertexCount,r=[],n=new Float32Array(3*i),o=new Float32Array(3*i),a=new Float32Array(2*i),s=new Float32Array(4*i),l=new Float32Array(1*i),u=new Float32Array(2*i),c=new Float32Array(2*i),h=new Uint16Array(t),p=0,d=0,f=0,m=0,g=0,v=0,y=new THREE.BufferGeometry,b=0,_=0;_<e.length;_++){var x=e[_],E=this.transformations[_],w=E.positions,T=E.scales,S=E.quaternions,A=x.indexArray;if(x.groups.length>0){var M=this.cloneGroups(x.groups);M.forEach((function(e){e.start+=b})),r=r.concat(M)}b+=A.length;for(var C=0;C<A.length;C++)h[C+m]=p/3+A[C];m+=A.length;var R=x.positionArray;for(C=0;C<R.length;){for(var D=new THREE.Vector3(R[C],R[C+1],R[C+2]),P=w.length-1;P>-1;P--){var j=w[P],F=T[P],O=S[P];D.x*=F.x,D.y*=F.y,D.z*=F.z,(D=D.applyQuaternion(O)).x+=j.x,D.y+=j.y,D.z+=j.z}n[C+p]=D.x,n[C+p+1]=D.y,n[C+p+2]=D.z,C+=3}p+=R.length;var k=x.normalArray;if(k){for(C=0;C<k.length;){var L=new THREE.Vector3(k[C],k[C+1],k[C+2]);for(P=S.length-1;P>-1;P--){O=S[P];L=L.applyQuaternion(O)}o[C+d]=L.x,o[C+d+1]=L.y,o[C+d+2]=L.z,C+=3}d+=k.length}var B=x.uvArray;if(B)for(C=0;C<B.length;C++)a[C+f]=B[C];var H=x.uv2Array;if(H)for(C=0;C<H.length;C++)u[C+f]=H[C];var I=x.uv3Array;if(I)for(C=0;C<I.length;C++)c[C+f]=I[C];B&&(f+=B.length);var N=x.colorArray;if(N){for(C=0;C<N.length;C++)s[C+g]=N[C];g+=N.length;for(C=3;C<N.length;C+=4)l[(C-3)/4+v]=N[C];v+=N.length/4}}y.addAttribute("position",new THREE.BufferAttribute(n,3)),y.addAttribute("normal",new THREE.BufferAttribute(o,3)),y.addAttribute("uv",new THREE.BufferAttribute(a,2)),0!==u.length&&y.addAttribute("uv2",new THREE.BufferAttribute(u,2)),0!==c.length&&y.addAttribute("uv3",new THREE.BufferAttribute(c,2)),0!==s.length&&y.addAttribute("color",new THREE.BufferAttribute(s,4)),0!==l.length&&y.addAttribute("alphaIndex",new THREE.BufferAttribute(l,1)),y.setIndex(new THREE.BufferAttribute(h,1)),y.groups=r;var U=new THREE.Mesh(y,this.material);U.name="combine",this.combineMesh=U,this.combineMesh.name="mesh",r=null,n=null,o=null,a=null,s=null,l=null,u=null,c=null,h=null,p=0,d=0,f=0,m=0,g=0,v=0,y=null}}]),t}(xt);Me.enableCombinePlacementsByRoom=!1,Me.enableCombinePlacementToBuildMesh=!0;var Mt=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.placements=[],e.transformations=[],e.combineProcessorMap=new Map,e.combineProcessors=[],e.mesh=new THREE.Object3D,e.belongRoomUserID=null,e.type="CombinePlacement",e}return o(t,e),r(t,[{key:"add",value:function(e,t){this.placements.push(e),void 0===t&&(t=new Tt),t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),this.transformations.push(t)}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);if(this.createMesh(),Me.enableCombinePlacementToBuildMesh){if(this.resource.isCombine||this.resource.combine(),!this.resource.combineBundleObj&&this.resource.isCombine)return;this.resource.isCombine?this.combinePlacements():this.resource.model&&this.instancePlacements()}this.processWhenBuildFinish()}}},{key:"checkResourceReady",value:function(){return!!this.resource.ready}},{key:"initResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"instancePlacements",value:function(){for(var e=0;e<this.placements.length;e++){var t=this.placements[e];t.initResource(t.resource),t.instanceModel();var i=this.transformations[e],r=null;if(i&&i.length>1)for(var n=i.positions.length-2;n>-1;n--){var o=new THREE.Object3D,a=i.positions[n],s=i.scales[n],l=i.quaternions[n];o.position.set(a.x,a.y,a.z),o.scale.set(s.x,s.y,s.z),o.quaternion.set(l.x,l.y,l.z,l.w),null!==r?o.add(r):o.add(t.mesh),r=o}else r=t.mesh;this.mesh.add(r)}}},{key:"combinePlacements",value:function(){for(var e=0;e<this.placements.length;e++){this.placements[e];var t=this.transformations[e],i=this.combineProcessorMap,r=this.combineProcessors;this.resource.combineBundleObj.materialMap.forEach((function(e,n,o){for(var a=e,s=n,l=0;l<a.length;l++){var u=a[l],c=i.get(s);c&&!c.isExceed(u.vertexCount)||(c=new At(s,this),i.set(s,c),r.push(c)),c.add(u,t)}}))}for(var n=0;n<this.combineProcessors.length;n++){var o=this.combineProcessors[n];o.build(),this.mesh.add(o.combineMesh)}}},{key:"resourceCallback",value:function(e){this.build()}},{key:"addToParentCollector",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.combinePlacementObjects.push(this)}},{key:"clear",value:function(){this.combineProcessorMap.clear();for(var e=0;e<this.combineProcessors.length;e++){var i=this.combineProcessors[e];this._dispose(i.combineMesh)}this.combineProcessors=[],n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"size",get:function(){return null===this._size&&(this._size=new THREE.Vector3,this.boundingBox.getSize(this._size)),this._size}},{key:"boundingBox",get:function(){if(null===this._boundingBox){this._boundingBox=new THREE.Box3;for(var e=0;e<this.placements.length;e++){var t=this.placements[e].boundingBox;this._boundingBox.expandByPoint(t.min),this._boundingBox.expandByPoint(t.max)}}return this._boundingBox}}]),t}(Re),Ct=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.floors=[],e._height=.01,e.type="CombineFloor",e.rotation.setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2),e.position.y=e._height,e}return o(t,e),r(t,[{key:"add",value:function(e){this.floors.push(e)}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);this.resource.isCombine||this.resource.combine(),this.createMesh();var e=null;this.resource.ready?e=this.resource.roomMaterial:(e=new THREE.MeshBasicMaterial,this.resource.registerListener(this)),e.side=THREE.DoubleSide;for(var t=new THREE.Geometry,i=0;i<this.floors.length;i++){var r=this.floors[i];r.calGeometry();var n=r.geometry;t.merge(n)}var o=new THREE.Mesh(t,e);o.name="combine",o.quaternion.set(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w),o.position.set(this.position.x,this.position.y,this.position.z),this.combineMesh=o,this.combineMesh.name="floor",this.mesh=this.combineMesh,this.processWhenBuildFinish()}}},{key:"checkResourceReady",value:function(){return!!this.resource.ready}},{key:"initResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"resourceCallback",value:function(e){this.build()}},{key:"addToParentCollector",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.combineFloorObjects.push(this)}},{key:"height",set:function(e){this._height=e,this.position.y=this._height},get:function(){return this._height}}]),t}(Re),Rt=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.ceilings=[],e.meshInfos=[],e.geometrys=[],e._height=3,e.type="CombineCeiling",e.rotation.setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2),e.position.y=e._height,e}return o(t,e),r(t,[{key:"add",value:function(e){this.ceilings.push(e)}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);this.createMesh();var e=null;this.resource.ready?e=this.resource.roomMaterial:(e=new THREE.MeshBasicMaterial({color:16777215}),this.resource.registerListener(this));for(var t=new THREE.Geometry,i=0;i<this.ceilings.length;i++){var r=this.ceilings[i];r.calGeometry();var n=r.geometry;t.merge(n)}var o=new THREE.Mesh(t,e);o.name="combine",o.quaternion.set(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w),o.position.set(this.position.x,this.position.y,this.position.z),this.combineMesh=o,this.combineMesh.name="ceiling",this.mesh=this.combineMesh,this.processWhenBuildFinish()}}},{key:"resourceCallback",value:function(e){this.build()}},{key:"addToParentCollector",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.combineCeilingObjects.push(this)}},{key:"height",set:function(e){this._height=e,this.position.y=this._height},get:function(){return this._height}}]),t}(Re),Dt=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.roofs=[],e._height=3,e.meshInfos=[],e.geometrys=[],e.type="CombineRoof",e.rotation.setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2),e.position.y=e._height+.005,e}return o(t,e),r(t,[{key:"add",value:function(e){this.roofs.push(e)}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);this.createMesh();var e=null;this.resource.ready?e=this.resource.roomMaterial:(e=new THREE.MeshBasicMaterial,this.resource.registerListener(this));for(var t=new THREE.Geometry,i=0;i<this.roofs.length;i++){var r=this.roofs[i];r.calGeometry();var n=r.geometry;t.merge(n)}var o=new THREE.Mesh(t,e);o.name="combine",o.quaternion.set(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w),o.position.set(this.position.x,this.position.y,this.position.z),this.combineMesh=o,this.combineMesh.name="roof",this.mesh=this.combineMesh,this.processWhenBuildFinish()}}},{key:"checkResourceReady",value:function(){return!!this.resource.ready}},{key:"initResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"resourceCallback",value:function(e){this.build()}},{key:"addToParentCollector",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.combineRoofObjects.push(this)}},{key:"height",set:function(e){this._height=e,this.position.y=this._height+.005},get:function(){return this._height}}]),t}(Re),Pt=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.combineProcessorMap=new Map,e.combineProcessors=[],e.walls=[],e.type="CombineModelWall",e}return o(t,e),r(t,[{key:"addWall",value:function(e){this.walls.push(e)}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);this.createMesh(),this.resource.isCombine||this.resource.combine();for(var e=0;e<this.walls.length;e++){var t=this.walls[e];if(t.baseBuild(),0===t.doorOrWindows.length)t.calObjInfo(),this.combineWall(t);else{t.initSimpleCornersAndWalls();for(var i=0;i<t.subWalls.length;i++){var r=t.subWalls[i];r.baseBuild(),r.calObjInfo(),this.combineWall(r)}}}for(var n=0;n<this.combineProcessors.length;n++){var o=this.combineProcessors[n];o.build(),this.mesh.add(o.combineMesh)}this.processWhenBuildFinish()}}},{key:"combineWall",value:function(e){for(var t=this.combineProcessorMap,i=this.combineProcessors,r=this.resource.combineBundleObj,n=0;n<e.modelNumber;n++){var o=e.objPositions[n],a=e.objRotations[n],s=e.objScales[n],l=new Tt;l.positions.push(o),l.scales.push(s),l.quaternions.push(a),r.materialMap.forEach((function(e,r,n){for(var o=e,a=r,s=0;s<o.length;s++){var u=o[s],c=t.get(a);c&&!c.isExceed(u.vertexCount)||(c=new At(a,this),t.set(a,c),i.push(c)),c.add(u,l)}}))}}},{key:"resourceCallback",value:function(e){this.build()}},{key:"addToParentCollector",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.combineModelWallObjects.push(this)}},{key:"clear",value:function(){for(var e=0;e<this.walls.length;e++){this.walls[e].clear()}this.combineProcessorMap.clear();for(var i=0;i<this.combineProcessors.length;i++){var r=this.combineProcessors[i];this._dispose(r.combineMesh)}this.combineProcessors=[],n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"size",get:function(){return null===this._size&&(this._size=new THREE.Vector3,this.boundingBox.getSize(this._size)),this._size}},{key:"boundingBox",get:function(){if(null===this._boundingBox){this._boundingBox=new THREE.Box3;for(var e=0;e<this.walls.length;e++){var t=this.walls[e].boundingBox;this._boundingBox.expandByPoint(t.min),this._boundingBox.expandByPoint(t.max)}}return this._boundingBox}}]),t}(Re),jt=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.combineProcessorMap=new Map,e.combineProcessors=[],e.doorOrWindows=[],e.transformations=[],e.type="CombineDoorOrWindow",e}return o(t,e),r(t,[{key:"add",value:function(e,t){this.doorOrWindows.push(e),this.transformations.push(t)}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);if(this.resource.isCombine||this.resource.combine(),!this.resource.combineBundleObj&&this.resource.isCombine)return;this.createMesh(),this.resource.isCombine?this.combinePlacements():this.resource.model&&this.instancePlacements(),this.processWhenBuildFinish()}}},{key:"instancePlacements",value:function(){for(var e=0;e<this.doorOrWindows.length;e++){var t=this.doorOrWindows[e];t.fitAttachWall(),t.instanceModel();var i=this.transformations[e],r=null;if(i)for(var n=i.positions.length-1;n>-1;n--){var o=new THREE.Object3D,a=i.positions[n],s=i.scales[n],l=i.quaternions[n];o.position.set(a.x,a.y,a.z),o.scale.set(s.x,s.y,s.z),o.quaternion.set(l.x,l.y,l.z,l.w),null!==r?o.add(r):o.add(t.mesh),r=o}else r=t.mesh;this.combineMesh.add(r)}}},{key:"combinePlacements",value:function(){for(var e=0;e<this.doorOrWindows.length;e++){var t=this.doorOrWindows[e];t.fitAttachWall();var i=this.transformations[e];void 0===i&&(i=new Tt);var r=this.combineProcessorMap,n=this.combineProcessors,o=this.resource.combineBundleObj;i.positions.push(t.position),i.scales.push(t.scale),i.quaternions.push(t.rotation),o.materialMap.forEach((function(e,t,o){for(var a=e,s=t,l=0;l<a.length;l++){var u=a[l],c=r.get(s);c&&!c.isExceed(u.vertexCount)||(c=new At(s,this),r.set(s,c),n.push(c)),c.add(u,i)}}))}for(var a=0;a<this.combineProcessors.length;a++){var s=this.combineProcessors[a];s.build(),this.mesh.add(s.combineMesh)}}},{key:"resourceCallback",value:function(e){this.build()}},{key:"addToParentCollector",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.combineDoorOrWindowObjects.push(this)}},{key:"clear",value:function(){this.combineProcessorMap.clear();for(var e=0;e<this.combineProcessors.length;e++){var i=this.combineProcessors[e];this._dispose(i.combineMesh)}this.combineProcessors=[],n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(Re);function Ft(e,t){if(!(this instanceof Ft))return new Ft(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||Ot,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function Ot(e,t){return e<t?-1:e>t?1:0}function kt(e,t,i){var r,n,o,a;t=t||1;for(var s=0;s<e[0].length;s++){var l=e[0][s];(!s||l[0]<r)&&(r=l[0]),(!s||l[1]<n)&&(n=l[1]),(!s||l[0]>o)&&(o=l[0]),(!s||l[1]>a)&&(a=l[1])}var u=o-r,c=a-n,h=Math.min(u,c),p=h/2,d=new Ft(null,Lt);if(0===h)return[r,n];for(var f=r;f<o;f+=h)for(var m=n;m<a;m+=h)d.push(new Bt(f+p,m+p,p,e));var g=function(e){for(var t=0,i=0,r=0,n=e[0],o=0,a=n.length,s=a-1;o<a;s=o++){var l=n[o],u=n[s],c=l[0]*u[1]-u[0]*l[1];i+=(l[0]+u[0])*c,r+=(l[1]+u[1])*c,t+=3*c}return 0===t?new Bt(n[0][0],n[0][1],0,e):new Bt(i/t,r/t,0,e)}(e),v=new Bt(r+u/2,n+c/2,0,e);v.d>g.d&&(g=v);for(var y=d.length;d.length;){var b=d.pop();b.d>g.d&&(g=b,i&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,y)),b.max-g.d<=t||(p=b.h/2,d.push(new Bt(b.x-p,b.y-p,p,e)),d.push(new Bt(b.x+p,b.y-p,p,e)),d.push(new Bt(b.x-p,b.y+p,p,e)),d.push(new Bt(b.x+p,b.y+p,p,e)),y+=4)}return i&&(console.log("num probes: "+y),console.log("best distance: "+g.d)),[g.x,g.y]}function Lt(e,t){return t.max-e.max}function Bt(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=function(e,t,i){for(var r=!1,n=1/0,o=0;o<i.length;o++)for(var a=i[o],s=0,l=a.length,u=l-1;s<l;u=s++){var c=a[s],h=a[u];c[1]>t!=h[1]>t&&e<(h[0]-c[0])*(t-c[1])/(h[1]-c[1])+c[0]&&(r=!r),n=Math.min(n,Ht(e,t,c,h))}return(r?1:-1)*Math.sqrt(n)}(e,t,r),this.max=this.d+this.h*Math.SQRT2}function Ht(e,t,i,r){var n=i[0],o=i[1],a=r[0]-n,s=r[1]-o;if(0!==a||0!==s){var l=((e-n)*a+(t-o)*s)/(a*a+s*s);l>1?(n=r[0],o=r[1]):l>0&&(n+=a*l,o+=s*l)}return(a=e-n)*a+(s=t-o)*s}Ft.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,i=this.compare,r=t[e];e>0;){var n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r},_down:function(e){for(var t=this.data,i=this.compare,r=this.length>>1,n=t[e];e<r;){var o=1+(e<<1),a=o+1,s=t[o];if(a<this.length&&i(t[a],s)<0&&(o=a,s=t[a]),i(s,n)>=0)break;t[e]=s,e=o}t[e]=n}};var It=function(e){function t(e){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.type="CombinePlacementWall",r}return o(t,e),r(t,[{key:"addToParentCollector",value:function(){this.parent.combinePlacementWallObjects.push(this)}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);if(this.createMesh(),this.resource.isCombine||this.resource.combine(),!this.resource.combineBundleObj&&this.resource.isCombine)return;this.resource.isCombine?this.combinePlacements():this.resource.model&&this.instancePlacements()}this.processWhenBuildFinish()}}]),t}(Mt),Nt=function(){function e(t){i(this,e),this.plan=t,this.straightManualCombineWallMap=new Map,this.combinePlacementMap=new Map,this.combineFloorMap=new Map,this.combineRoofMap=new Map,this.combineCeilingMap=new Map,this.combineModelWallMap=new Map,this.combineDoorOrWindowMap=new Map,this.combinePlacementWallMap=new Map,this.combineWalls=[],this.combinePlacements=[],this.combineFloors=[],this.combineCeilings=[],this.combineRoofs=[],this.differentHeightRoomMap=new Map,this.curPlacementCombineProcessorInRoomMap=new Map}return r(e,[{key:"parser",value:function(){for(var e=this.plan,t=this.plan.placements,i=this.plan.walls,r=this.plan.rooms,n=[],o=[],a=[],s=0;s<e.corners.length;s++){e.corners[s].build()}for(var l=0;l<t.length;l++){var u=t[l];this.isPlacementShouldCombine(u)?this.addPlacementToCollector(u):n.push(u)}e.placements=n;for(var c=0;c<e.groups.length;c++){var h=e.groups[c];this.isGroupShouldCombine(h)?this.addPlacementGroupToCollector(h):o.push(h)}e.groups=o;for(var p=0;p<i.length;p++){var d=i[p];if(d.isShow)if("StraightManualWall"===d.type)if(0===d.doorOrWindows.length)this.addStraightManualWall(d);else{d.initMeshInfo(),d.initSimpleCornersAndWalls();for(var f=0;f<d.subCorners.length;f++){d.subCorners[f].build()}for(var m=0;m<d.subWalls.length;m++){var g=d.subWalls[m];this.addStraightManualWall(g)}}else if("ModelWall"===d.type){this.getCombineObjectFromMap(d.resource,Pt,this.combineModelWallMap).addWall(d)}else if("PlacementWall"===d.type){this.getCombineObjectFromMap(d.resource,It,this.combinePlacementWallMap).add(d)}}for(var v=0;v<e.doorOrWindows.length;v++){var y=e.doorOrWindows[v];this.isPlacementShouldCombine(y)?this.addDoorOrWindowToCollector(y):a.push(y)}e.doorOrWindows=a,this.clearPlanWalls(e),this.parseRooms(r),e.size,e.corners=[],e.fillChildren()}},{key:"parseRooms",value:function(e){for(var t=new Map,i=new Map,r=new Map,n=[],o=0;o<e.length;o++){var a=e[o];if(a.properties||a.userID||a.name)(a.properties||a.userID||a.name)&&n.push(a);else{if(a.floor.isShow)this.getHeightRoomInfoListFromMap(a.floor.height,t).push(a.floor);if(a.ceiling.isShow)this.getHeightRoomInfoListFromMap(a.ceiling.height,i).push(a.ceiling);if(a.roof.isShow)this.getHeightRoomInfoListFromMap(a.roof.height,r).push(a.roof)}}var s=!0,l=!1,u=void 0;try{for(var c,h=t.keys()[Symbol.iterator]();!(s=(c=h.next()).done);s=!0)for(var p=c.value,d=t.get(p),f=0;f<d.length;f++){var m=d[f];this.addFloorToCollector(m,p)}}catch(e){l=!0,u=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw u}}var g=!0,v=!1,y=void 0;try{for(var b,_=i.keys()[Symbol.iterator]();!(g=(b=_.next()).done);g=!0)for(var x=b.value,E=i.get(x),w=0;w<E.length;w++){var T=E[w];this.addCeilingToCollector(T,x)}}catch(e){v=!0,y=e}finally{try{!g&&_.return&&_.return()}finally{if(v)throw y}}var S=!0,A=!1,M=void 0;try{for(var C,R=r.keys()[Symbol.iterator]();!(S=(C=R.next()).done);S=!0)for(var D=C.value,P=r.get(D),j=0;j<P.length;j++){var F=P[j];this.addRoofToCollector(F,D)}}catch(e){A=!0,M=e}finally{try{!S&&R.return&&R.return()}finally{if(A)throw M}}this.plan.rooms=n;for(var O=0;O<n.length;O++){var k=n[O],L=this.calRoomPosition(k);k.position=L,this.subRoomHolesPointsByPosition(k,L),this.subRoomPointsByPosition(k,L),k.initShapePathPoints(),k.initShapeHolePoints()}}},{key:"calRoomPosition",value:function(e){for(var t=e.points,i=e.holes,r=[],n=[],o=0;o<t.length;o++){var a=t[o];r.push([a.x,a.z])}if(i.length>2&&!this.isSamePoints(i))for(o=0;o<i.length;o++){for(var s=i[o],l=[],u=0;u<s.length;u++){a=s[u];l.push([a.x,a.z])}n.push(l)}var c=this.getLabelPosition(r,n);return c?new THREE.Vector3(c[0],0,c[1]):new THREE.Vector3}},{key:"isSamePoints",value:function(e){for(var t=e[0],i=1;i<e.length;i++){var r=e[i];if(t.x!==r.x||t.y!==r.y||t.z!==r.z)return!1}return!0}},{key:"getLabelPosition",value:function(e,t){if(!e||!e.length)return null;var i=[];if(i.push(e),t&&0!=t.length)for(var r=0;r<t.length;r++){var n=[t[r][0],t[r][1],t[r][2],t[r][3]];i.push(n)}var o=kt(i);return[o[0],o[1]]}},{key:"subRoomPointsByPosition",value:function(e,t){for(var i=e.points,r=0;r<i.length;r++){i[r].sub(t)}}},{key:"subRoomHolesPointsByPosition",value:function(e,t){for(var i=e.holes,r=0;r<i.length;r++)for(var n=i[r],o=0;o<n.length;o++){n[o].sub(t)}}},{key:"getHeightRoomInfoListFromMap",value:function(e,t){return t.has(e)||t.set(e,[]),t.get(e)}},{key:"addStraightManualWall",value:function(e){e.initMeshInfo(),this.addToStraightManualWallCollector(e)}},{key:"addToStraightManualWallCollector",value:function(e){var t=this.getCombineObjectFromMap(e.leftResource,wt,this.straightManualCombineWallMap),i=this.getCombineObjectFromMap(e.rightResource,wt,this.straightManualCombineWallMap),r=this.getCombineObjectFromMap(e.edgeResource,wt,this.straightManualCombineWallMap);t.lightMapResource=Ae.wallLightMapResource,i.lightMapResource=Ae.wallLightMapResource,t.addMeshInfo(e.leftSideMeshInfo),i.addMeshInfo(e.rightSideMeshInfo),r.addMeshInfo(e.edgeSideMeshInfo)}},{key:"createStraightManualCombineWallToMap",value:function(e,t,i){if(!t.has(e)){var r=new wt;r.resource=e,r.parent=i,t.set(e,r)}}},{key:"addPlacementToCollector",value:function(e,t){var i=null;Me.enableCombinePlacementsByRoom?(this.curPlacementCombineProcessorInRoomMap.has(e.belongRoomUserID)||this.curPlacementCombineProcessorInRoomMap.set(e.belongRoomUserID,new Map),i=this.curPlacementCombineProcessorInRoomMap.get(e.belongRoomUserID)):i=this.combinePlacementMap;var r=this.getCombineObjectFromMap(e.resource,Mt,i);r.belongRoomUserID=e.belongRoomUserID,r.add(e,t)}},{key:"addPlacementGroupToCollector",value:function(e,t){t||(t=new Tt),t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation);for(var i=0;i<e.placements.length;i++){var r=e.placements[i];r.isShow&&this.addPlacementToCollector(r,t.clone())}for(i=0;i<e.groups.length;i++){var n=e.groups[i];n.isShow&&this.addPlacementGroupToCollector(n,t.clone())}}},{key:"addDoorOrWindowToCollector",value:function(e){this.getCombineObjectFromMap(e.resource,jt,this.combineDoorOrWindowMap).add(e)}},{key:"addRoofToCollector",value:function(e,t){if(!(this.plan instanceof nt)){var i=this.getCombineRoomRelatedObject(e,Dt,this.plan.combineRoofObjects);i.height=t,i.add(e)}}},{key:"addCeilingToCollector",value:function(e,t){if(!(this.plan instanceof nt)){var i=this.getCombineRoomRelatedObject(e,Rt,this.plan.combineCeilingObjects);i.height=t,i.add(e)}}},{key:"addFloorToCollector",value:function(e,t){var i=this.getCombineRoomRelatedObject(e,Ct,this.plan.combineFloorObjects);i.height=t,i.add(e)}},{key:"getCombineRoomRelatedObject",value:function(e,t,i){for(var r=null,n=0;n<i.length;n++){var o=i[n];if(o.resource===e.resource&&o.height===e.height){r=o;break}}return null===r&&((r=new t).parent=this.plan,r.resource=e.resource,r.height=e.height),r}},{key:"clearPlanWalls",value:function(e){e.walls=[]}},{key:"getCombineObjectFromMap",value:function(e,t,i){if(!i.has(e)){var r=new t;r.resource=e,r.parent=this.plan,i.set(e,r)}return i.get(e)}},{key:"isPlacementShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.properties)&&(!!this.isNullOrUndefined(e.userID)&&(!!this.isNullOrUndefined(e.name)&&!!e.isShow))}},{key:"isGroupShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.properties)&&(!!this.isNullOrUndefined(e.userID)&&(!!this.isNullOrUndefined(e.name)&&!!e.isShow))}},{key:"isNullOrUndefined",value:function(e){return null==e}},{key:"parseDifferentHeightRooms",value:function(e){}}]),e}(),Ut=function(){function e(){i(this,e)}return r(e,[{key:"parseWorld",value:function(e){var t=e.outdoors;this.parsePlan(t);for(var i=e.buildings,r=0;r<i.length;r++){var n=i[r];this.parseBuilding(n)}var o=[];for(r=0;r<e.buildings.length;r++){n=e.buildings[r];for(var a=0;a<n.floorplans.length;a++){var s=n.floorplans[a];o.push(s)}}o.push(e.outdoors)}},{key:"parseBuilding",value:function(e){for(var t=e.floorplans,i=0;i<t.length;i++){var r=t[i];this.parsePlan(r)}}},{key:"parsePlan",value:function(e){new Nt(e).parser()}}]),e}(),Vt=function(){function e(t){i(this,e),this.resource=t,this.objects=[],this.isBuilded=!1,this._awaitToNextBuildTime=1,this._maxBuildTime=1e3}return r(e,[{key:"add",value:function(e){this.objects.push(e)}},{key:"build",value:async function(){for(var e=new Date,t=void 0,i=0;i<this.objects.length;i++){(t=new Date)-e>this._maxBuildTime&&(e=t,await this.awaitToNextBuild()),this.objects[i].build()}return this.isBuilded=!0,new Promise((function(e){e("resolved")}))}},{key:"awaitToNextBuild",value:function(e){return void 0===e&&(e=this._awaitToNextBuildTime),new Promise((function(t){setTimeout((function(){t("resolved")}),e)}))}},{key:"resourceCallback",value:function(){this.build()}},{key:"containByClassType",value:function(e){for(var t=0;t<this.objects.length;t++){if(this.objects[t]instanceof e)return!0}return!1}}]),e}(),zt=function(){function e(t){i(this,e),this.loader=t,this.world=null,this.requestToBuildList=[],this.resourceToObjectsMap=new Map,this.resourceBuildUnitMap=new Map,this.resourceBuildUnits=[],this.readyResourceUnits=[],this.unreadyResourceUnits=[],this._stopUpdateBuild=!0,this._buildingUnits=[],this.buildingProgressCallback=null,this._awaitToNextBuildTime=10,this._resourceBuildUnitAwaitToNextBuildTime=1,this._resourceBuildUnitMaxBuildTime=1e3}return r(e,[{key:"build",value:function(e){this.buildingProgressCallback=e,this.initRequestBuildUnits(),this._buildingUnits=[].concat(this.readyResourceUnits).concat(this.unreadyResourceUnits);for(var t=0;t<this.unreadyResourceUnits.length;t++){var i=this.unreadyResourceUnits[t].resource;null!==i&&this.loader.addResourceDownloadRequest(i)}0!==this.unreadyResourceUnits.length&&this.loader.startToDownloadRequestResources(),this._stopUpdateBuild=!1,this._updateBuildUnit()}},{key:"initRequestBuildUnits",value:function(){this.sortResourceBuildUnits(),this.readyResourceUnits=[],this.unreadyResourceUnits=[];for(var e=0;e<this.resourceBuildUnits.length;e++){var t=this.resourceBuildUnits[e],i=t.resource;i&&i.ready?this.readyResourceUnits.push(t):i&&this.unreadyResourceUnits.push(t)}}},{key:"sortResourceBuildUnits",value:function(){for(var e=[],t=[],i=[],r=[],n=[],o=[],a=[],s=[],l=0;l<this.resourceBuildUnits.length;l++){var u=this.resourceBuildUnits[l];u.containByClassType(wt)?e.push(u):u.containByClassType(Dt)?o.push(u):u.containByClassType(Pt)?i.push(u):u.containByClassType(It)?r.push(u):u.containByClassType(Ct)?a.push(u):u.containByClassType(Rt)?n.push(u):u.containByClassType(jt)?s.push(u):t.push(u)}this.resourceBuildUnits=[].concat(e).concat(o).concat(a).concat(n).concat(s).concat(i).concat(r).concat(t)}},{key:"_updateBuildUnit",value:async function(){for(var e=this;;){if(this._stopUpdateBuild)return;if(0===this._buildingUnits.length)e.checkBuildComplete(),await this.awaitToNextBuild();else if(this._buildingUnits[0].resource&&this._buildingUnits[0].resource.ready){var t=this._buildingUnits.shift();await t.build().then((function(){e.checkBuildComplete()}))}else await this.awaitToNextBuild()}}},{key:"checkBuildComplete",value:function(){for(var e=[],t=!0,i=0;i<this.resourceBuildUnits.length;i++){var r=this.resourceBuildUnits[i];r.isBuilded?e.push(r):t=!1}var n=null;0===this.resourceBuildUnits.length?(t=!0,n=1):n=e.length/this.resourceBuildUnits.length,t&&this._clearUpdateBuildUnit(),this.buildingProgressCallback&&this.buildingProgressCallback(n)}},{key:"_clearUpdateBuildUnit",value:function(){this.resourceBuildUnits=[],this.unreadyResourceUnits=[],this.readyResourceUnits=[],this.resourceBuildUnitMap.clear(),this._stopUpdateBuild=!0}},{key:"awaitToNextBuild",value:function(){var e=this;return new Promise((function(t){setTimeout((function(){t("resolved")}),e._awaitToNextBuildTime)}))}},{key:"requestToBuild",value:function(e){var t=this.world.findObjectByID(e);null!==t&&(t.isContainer?this.addContainerObject(t):this.addObject(t))}},{key:"disposeObject",value:function(e){var t=this.world.findObjectByID(e);t&&t.clear()}},{key:"addContainerObject",value:function(e){for(var t=e.children,i=0;i<t.length;i++){var r=t[i];r.isContainer&&!r.isMultiResources?this.addContainerObject(r):this.addObject(r)}}},{key:"addObject",value:function(e){e.isMultiResources?this.addMultiResourcesObject(e):this.addSingleResourceObject(e)}},{key:"addMultiResourcesObject",value:function(e){for(var t=e.resources,i=0;i<t.length;i++){var r=t[i];this.addSingleResourceObject(e,r)}}},{key:"addSingleResourceObject",value:function(e,t){if(t||null!==(t=e.resource)&&null!=t){if(!this.resourceBuildUnitMap.has(t)){var i=new Vt(t);i._awaitToNextBuildTime=this._resourceBuildUnitAwaitToNextBuildTime,i._maxBuildTime=this._resourceBuildUnitMaxBuildTime,this.resourceBuildUnits.push(i),this.resourceBuildUnitMap.set(t,i)}this.resourceBuildUnitMap.get(t).add(e)}}}]),e}(),qt=function(){function e(){i(this,e),this.sceneJson=null,this.world=null,this.resourceManager=new gt,this.json2objectLoader=new be({objectTypeConfig:_t,resourceManager:this.resourceManager,defaultSetting:Me,defaultResource:Ae}),this.combineParser=new Ut(this),this.dynamicBuildManager=new zt(this),this.enableDelayObject=!1,this.objectsMap={},this.enableRequestWorld=!0,this.loadVersion=null}return r(e,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"clearAllResources",value:function(){this.resourceManager.disposeModels(),this.resourceManager.disposeTextures()}},{key:"clearAllObjects",value:function(){this.world.clear()}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"disposeObject",value:function(e){this.dynamicBuildManager.disposeObject(e)}},{key:"findObjectByID",value:function(e){return this.world.findObjectByID(e)}},{key:"load",value:function(e){return this.world=this.json2objectLoader.load(e),this.combineParser.parseWorld(this.world),this.enableDelayObject&&St.compatibilityProcessWorld(this.world),this.dynamicBuildManager.world=this.world,this.enableRequestWorld&&this.requestToBuild(this.world.id),this.world}},{key:"delayLoad",value:function(e){var t=this;return new Promise((function(i,r){t.world=t.json2objectLoader.load(e),t.combineParser.parseWorld(t.world),t.enableDelayObject&&St.compatibilityProcessWorld(t.world),t.dynamicBuildManager.world=t.world,t.enableRequestWorld&&t.requestToBuild(t.world.id),i(t.world)}))}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),Wt="function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?function(e){return void 0===e?"undefined":t(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":t(e)},Gt=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Xt=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Yt="function"==typeof Symbol&&"symbol"===Wt(Symbol.iterator)?function(e){return void 0===e?"undefined":Wt(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":Wt(e)},Jt=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Qt=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Zt=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},Kt=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":Wt(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},$t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":Wt(t))&&"function"!=typeof t?e:t},ei=new(function(){function e(t){Jt(this,e),this.config=null}return Qt(e,[{key:"createObject",value:function(e){var t=new(this.config.getClass(e.creatorType))(e),i=t.create();return t.parseChildren(),i}}]),e}()),ti=new(function(){function e(){Jt(this,e),this.objects=[],this._objectTypeConfig=null}return Qt(e,[{key:"create",value:function(e){var t=e.type;return new(0,this.objectTypeConfig[t])}},{key:"objectTypeConfig",set:function(e){this._objectTypeConfig=e},get:function(){return this._objectTypeConfig}}]),e}()),ii=function(){function e(t){Jt(this,e),this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=t.jsonData,this.objectParent=null,t.parent&&(this.objectParent=t.parent),this.createType=null,this.resourceManager=t.resourceManager}return Qt(e,[{key:"create",value:function(){var e=this._getCreateParams();return this.object=ti.create(e),this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.jsonData=this.jsonData,e.parent&&(this.object.parent=e.parent),this.jsonData.isshow&&(this.object.isShow=this.jsonData.isshow),this.object}},{key:"parseChildren",value:function(){}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,ei.createObject(e)}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),e}(),ri={scale:1,defaultFloorTextureResource:null,defaultCeilingTextureResource:null,defaultRoofTextureResource:null},ni=0,oi=1,ai=2,si=4,li=5,ui=8,ci=9,hi=10,pi=function(e){function t(e){Jt(this,t);var i=$t(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return Kt(t,e),Qt(t,[{key:"create",value:function(){return this.jsonData.unit&&(ri.scale=.01*this.jsonData.unit),Zt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this)}},{key:"parseChildren",value:function(){var e=this.jsonData,t=(this._parseJsonDataChild({jsonData:e,creatorType:oi}),this._parseJsonDataChild({jsonData:{},creatorType:hi}));this.object.outdoors=t}}]),t}(ii),di=function(e){function t(e){Jt(this,t);var i=$t(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return Kt(t,e),Qt(t,[{key:"parseChildren",value:function(){var e=this.jsonData;this._parseJsonDataChild({jsonData:e,creatorType:ai})}}]),t}(ii),fi=function(e){function t(e){Jt(this,t);var i=$t(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return Kt(t,e),Qt(t,[{key:"create",value:function(){return Zt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.walls&&this._parseWalls(e.walls),e.rooms&&this._parseJsonDataChildren({jsonData:e.rooms,creatorType:ci}),e.doors&&this._parseJsonDataChildren({jsonData:e.doors,creatorType:ui}),this.object.calRoomsUV2()}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];0===i.type?this._parseJsonDataChild({jsonData:i,creatorType:li}):this._parseJsonDataChild({jsonData:i,creatorType:si})}}}]),t}(ii),mi=function(e){function t(e){Jt(this,t);var i=$t(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="WallCorner",i}return Kt(t,e),Qt(t,[{key:"create",value:function(){Zt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=this.jsonData[0]*ri.scale,i=this.jsonData[1]*ri.scale;return this.object.position=new THREE.Vector3(e,0,i),this.object}}]),t}(ii),gi=function(e){function t(e){return Jt(this,t),$t(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Kt(t,e),Qt(t,[{key:"_parseCorners",value:function(){var e=this.jsonData,t=this.objectParent,i=e.start[0]*ri.scale,r=e.start[1]*ri.scale,n=null,o=null;n=t.existsCorner(i,0,r)?t.getCorner(i,0,r):this._createCorner(i,0,r,e.start),i=e.end[0]*ri.scale,r=e.end[1]*ri.scale,o=t.existsCorner(i,0,r)?t.getCorner(i,0,r):this._createCorner(i,0,r,e.end),this.object.startCorner=n,this.object.endCorner=o,n.addWall(this.object),o.addWall(this.object)}},{key:"_createCorner",value:function(e,t,i,r){var n=new mi({jsonData:r}).create();return n.parent=this.objectParent,n.jsonData=r,n}}]),t}(ii),vi=function(){function e(){Jt(this,e)}return Qt(e,null,[{key:"uuid",value:function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var i=e.join("");return i}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var a in i){o=!0;for(var s=i[a].skeleton,l=n[a],u=[],c=0;c<s.bones.length;++c){var h=r[s.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Yt(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}}]),e}(),yi=function(e){function t(e){Jt(this,t);var i=$t(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ModelWall",i}return Kt(t,e),Qt(t,[{key:"create",value:function(){return Zt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),vi.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),vi.checkValueEmpty(this.jsonData.isshow)&&(this.object.isShow=this.jsonData.isshow),vi.checkValueEmpty(this.jsonData.height)?this.object.height=this.object.resource.modelSize.y:this.object.height=this.jsonData.height,vi.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}}]),t}(gi),bi=function(e){function t(e){Jt(this,t);var i=$t(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="StraightManualWall",i}return Kt(t,e),Qt(t,[{key:"create",value:function(){return Zt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),this._parseResources(),this.jsonData.uvmultiple&&(this.object.uvMultiple=this.jsonData.uvmultiple),vi.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),vi.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}},{key:"_parseResources",value:function(){vi.checkValueEmpty(this.jsonData.lefttexture)||(this.object.leftResource=this.resourceManager.textures[this.jsonData.lefttexture]),vi.checkValueEmpty(this.jsonData.righttexture)||(this.object.rightResource=this.resourceManager.textures[this.jsonData.righttexture]),vi.checkValueEmpty(this.jsonData.edgetexture)||(this.object.edgeResource=this.resourceManager.textures[this.jsonData.edgetexture])}}]),t}(gi),_i=function(e){function t(e){Jt(this,t);var i=$t(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.attachWall=e.attachWall,i.createType="DoorOrWindow",i.pointInLineDeviation=.001,i}return Kt(t,e),Qt(t,[{key:"create",value:function(){Zt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=ri.scale,i=this.jsonData,r=i.height*e,n=i.width*e,o=i.pos[0]*e,a=i.pos[1]*e,s=new THREE.Vector3(o,0,a);this.attachWall=this._getPointOnWhichWall(this.objectParent,s),null===this.attachWall&&console.warn("can not find door on which wall!");var l=this.object;return i.suspendpercent&&(l.suspendPercent=i.suspendpercent),l.resource=ri.defaultDoorResource,l.resource.modelSize=new THREE.Vector3(n,r,.15),l.position=s,this.attachWall.doorOrWindows.push(l),this.object.attachWall=this.attachWall,this.attachWall.doorOrWindows.push(this.object),this.object.fitAttachWall(),this.object}},{key:"_getPointOnWhichWall",value:function(e,t){for(var i=e.walls,r=0;r<i.length;r++){var n=i[r];if(this._isPointOnLineAndBetweenPoints(n.startCorner.position,n.endCorner.position,t))return n}return null}},{key:"_isPointOnLine",value:function(e,t,i){var r=new THREE.Vector3;return r.crossVectors(e.clone().sub(i),t.clone().sub(i)),r.length()<this.pointInLineDeviation}},{key:"_isPointOnLineAndBetweenPoints",value:function(e,t,i){if(!this._isPointOnLine(e,t,i))return!1;var r=t.x-e.x,n=t.z-e.z;return Math.abs(r)>=Math.abs(n)?r>0?e.x<=i.x&&i.x<=t.x:t.x<=i.x&&i.x<=e.x:n>0?e.z<=i.z&&i.z<=t.z:t.z<=i.z&&i.z<=e.z}}]),t}(ii),xi=function(e){function t(e){Jt(this,t);var i=$t(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return Kt(t,e),Qt(t,[{key:"create",value:function(){if(Zt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parsePoints(),0!==this.object.points.length)return this._parseHolesPoints(),this._parseRoomResources(),this._parseRoomHeight(),this._parseRoomBlockSize(),this._parseRoomVisible(),this._parseRoomBlockAngle(),this.object.initShapePathPoints(),this.object.initShapeHolePoints(),this.object;console.error("room points is null")}},{key:"_parsePoints",value:function(){if(this.jsonData.points){for(var e=[],t=0;t<this.jsonData.points.length;t++){var i=this.jsonData.points[t],r=ri.scale*i[0],n=ri.scale*i[1],o=new THREE.Vector3(r,0,n);e.push(o)}this.object.points=e}}},{key:"_parseHolesPoints",value:function(){if(this.jsonData.holes){for(var e=[],t=0;t<this.jsonData.holes.length;t++){for(var i=this.jsonData.holes[t],r=[],n=0;n<i.length;n++){var o=i[n],a=ri.scale*o[0],s=ri.scale*o[1],l=new THREE.Vector3(a,0,s);r.push(l)}e.push(r)}this.object.holes=e}}},{key:"_parseRoomResources",value:function(){this.object.floor.resource=ri.defaultFloorTextureResource,this.object.ceiling.resource=ri.defaultCeilingTextureResource,this.object.roof.resource=ri.defaultRoofTextureResource,null!==this.jsonData.floortexture&&void 0!==this.jsonData.floortexture&&(this.object.floorResource=this.resourceManager.textures[this.jsonData.floortexture],this.object.floor.resource=this.object.floorResource),null!==this.jsonData.ceilingtexture&&void 0!==this.jsonData.ceilingtexture&&(this.object.ceilingResource=this.resourceManager.textures[this.jsonData.ceilingtexture],this.object.ceiling.resource=this.object.ceilingResource),null!==this.jsonData.rooftexture&&void 0!==this.jsonData.rooftexture&&(this.object.roofResource=this.resourceManager.textures[this.jsonData.rooftexture],this.object.roof.resource=this.object.roofResource)}},{key:"_parseRoomHeight",value:function(){var e=this.jsonData,t=this.object;void 0!==e.ceilingheight?t.ceiling.height=e.ceilingheight:(t.ceiling.DefaultHeight=this.objectParent.height-.1,t.ceiling.height=t.ceiling.DefaultHeight),void 0!==e.roofheight?t.roof.height=e.roofheight:(t.roof.defaultHeight=this.objectParent.height,t.roof.height=t.roof.defaultHeight),void 0!==e.floorheight&&(t.floor.height=e.floorheight)}},{key:"_parseRoomVisible",value:function(){var e=this.jsonData,t=this.object;void 0!==e.isshowfloor&&(t.floor.isShow=e.isshowfloor),void 0!==e.isshowceiling&&(t.ceiling.isShow=e.isshowceiling),void 0!==e.isshowroof&&(t.roof.isShow=e.isshowroof)}},{key:"_parseRoomBlockSize",value:function(){var e=this.jsonData,t=this.object;if(e.floorblocksize){var i=e.floorblocksize;t.floor.blockSize=new THREE.Vector2(i[0],i[1])}if(e.ceilingblocksize){var r=e.ceilingblocksize;t.ceiling.blockSize=new THREE.Vector2(r[0],r[1])}if(e.roofblocksize){var n=e.roofblocksize;t.roof.blockSize=new THREE.Vector2(n[0],n[1])}}},{key:"_parseRoomBlockAngle",value:function(){var e=this.jsonData,t=this.object;vi.checkValueEmpty(e.floorblockangle)||(t.floor.blockAngle=e.floorblockangle),vi.checkValueEmpty(e.ceilingblockangle)||(t.ceiling.blockAngle=e.ceilingblockangle),vi.checkValueEmpty(e.roofblockangle)||(t.roof.blockAngle=e.roofblockangle)}}]),t}(ii),Ei=function(e){function t(e){Jt(this,t);var i=$t(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return Kt(t,e),t}(fi),wi=function(){function e(t){Jt(this,e),this._map={0:pi,1:di,2:fi,3:mi,4:yi,5:bi,8:_i,9:xi,10:Ei}}return Qt(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),Ti=function(){function e(t){Jt(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl}return Qt(e,[{key:"createResource",value:function(e){var t=ti.create({type:e});return t.manager=this.manager,t}},{key:"loadTextures",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];t=r.localurl?this._loadLocalCustomTextureResource(r):this._loadTextureResource(r),this.manager.textures.push(t)}}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource("LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource("Resource");return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];if((t=r.model?this.createResource("CustomResource"):r.localurl?this.createResource("CustomModelResource"):this.createResource("Resource")).baseUrl=this.baseModelUrl,r.localurl){if(t.localUrl=r.localurl,t.id=r.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,r.title&&(t.modelName=r.title),t.modelID=r.id,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.color){var n=r.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}}else if(r.id){if(t.id=r.id,t.modelID=r.id,t.version=r.version,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.model&&(t.modelID=r.model),r.title&&(t.modelName=r.title),r.color){n=r.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}if(r.size){var o=r.size;t.modelSize=new THREE.Vector3(o[0],o[1],o[2])}r.hasanimation&&(t.hasAnim=r.hasanimation),r.url&&(t.url=r.url)}for(var a=0;a<this.manager.ableToSupportFootAndHeadModelWalls.length;a++){var s=this.manager.ableToSupportFootAndHeadModelWalls[a];if(t.id===s){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var i=e.color;t.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(t.opacity=i[3])}if(e.size){var r=e.size;t.modelSize=new THREE.Vector3(r[0],r[1],r[2])}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),Si=function(){function e(t){Jt(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new wi,t&&t.resourceLibraryUrl&&(this.resourceLibraryUrl=t.resourceLibraryUrl)}return Qt(e,[{key:"setObjectTypeConfig",value:function(e){ti.objectTypeConfig=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"initDefaultResources",value:function(){this.resourceLibraryUrl&&(this.resourceManager.baseTextureUrl=this.resourceLibraryUrl+"/texture/",this.resourceManager.baseModelUrl=this.resourceLibraryUrl+"/model/"),this.defaultFloorTextureResource=this.createResource("Resource"),this.defaultFloorTextureResource.id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",this.defaultFloorTextureResource.ext="jpg",this.defaultFloorTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultCeilingTextureResource=this.createResource("Resource"),this.defaultCeilingTextureResource.id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",this.defaultCeilingTextureResource.ext="jpg",this.defaultCeilingTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultRoofTextureResource=this.createResource("Resource"),this.defaultRoofTextureResource.id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",this.defaultRoofTextureResource.ext="jpg",this.defaultRoofTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultDoorResource=this.resourceManager.emptyModelResource,ri.defaultFloorTextureResource=this.defaultFloorTextureResource,ri.defaultCeilingTextureResource=this.defaultCeilingTextureResource,ri.defaultRoofTextureResource=this.defaultRoofTextureResource,ri.defaultDoorResource=this.defaultDoorResource,this.createEmptyModelResource(),this.createEmptyTextureResource()}},{key:"createEmptyTextureResource",value:function(){var e=this.createResource("Resource");e.ready=!0,e.texture=new THREE.Texture,e.isEmpty=!0,this.resourceManager.emptyTextureResource=e}},{key:"createEmptyModelResource",value:function(){var e=this.createResource("Resource");e.ready=!0,e.model=new THREE.Object3D,e.isEmpty=!0,this.resourceManager.emptyModelResource=e}},{key:"loadLightMaps",value:function(e){var t=null,i="18091219l1g1hnjt",r="png";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(i=e.straightmanualwall.lightingtexture.id,r=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource("Resource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=i,t.ext=r,this.defaultResource.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource("Resource")).baseUrl=this.resourceManager.baseTextureUrl,t.id="18091216vjlgtwbh",t.ext="jpg",this.defaultResource.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=ti.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++){i+=t[r]+"/"}return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,i){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,(function(i){e.sceneJson=JSON.parse(i),t()}),(function(){}),(function(t){i("can not load "+e.sceneURL)}))}else i("load scene json error")}))}},{key:"getResourceLoader",value:function(){return new Ti(this.resourceManager)}},{key:"parseSceneJson",value:function(){var e=this.getResourceLoader();this.loadLightMaps(this.sceneJson.materialsetting),this.initDefaultResources(),e.loadTextures(this.sceneJson.textures),e.loadModels(this.sceneJson.models),this.parseWorld(this.sceneJson)}},{key:"parseWorld",value:function(e){ei.config=this.creatorTypeConfig,this.world=ei.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:ni})}}]),e}(),Ai="function"==typeof Symbol&&"symbol"===Wt(Symbol.iterator)?function(e){return void 0===e?"undefined":Wt(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":Wt(e)},Mi=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ci=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Ri=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},Di=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":Wt(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Pi=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":Wt(t))&&"function"!=typeof t?e:t},ji=new(function(){function e(t){Mi(this,e),this.config=null}return Ci(e,[{key:"createObject",value:function(e){var t=new(this.config.getClass(e.creatorType))(e),i=t.create();return t.parseChildren(),i}}]),e}()),Fi=new(function(){function e(){Mi(this,e),this.objects=[],this._objectTypeConfig=null}return Ci(e,[{key:"create",value:function(e){var t=e.type;return new(0,this.objectTypeConfig[t])}},{key:"objectTypeConfig",set:function(e){this._objectTypeConfig=e},get:function(){return this._objectTypeConfig}}]),e}()),Oi=function(){function e(t){Mi(this,e),this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=t.jsonData,this.objectParent=null,t.parent&&(this.objectParent=t.parent),this.createType=null,this.resourceManager=t.resourceManager}return Ci(e,[{key:"create",value:function(){var e=this._getCreateParams();return this.object=Fi.create(e),this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.jsonData=this.jsonData,e.parent&&(this.object.parent=e.parent),this.jsonData.isshow&&(this.object.isShow=this.jsonData.isshow),this.object}},{key:"parseChildren",value:function(){}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,ji.createObject(e)}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),e}(),ki={scale:1,defaultFloorTextureResource:null,defaultCeilingTextureResource:null,defaultRoofTextureResource:null},Li=0,Bi=1,Hi=2,Ii=5,Ni=8,Ui=9,Vi=10,zi=function(e){function t(e){Mi(this,t);var i=Pi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return Di(t,e),Ci(t,[{key:"create",value:function(){return this.jsonData.unit&&(ki.scale=.01*this.jsonData.unit),Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this)}},{key:"parseChildren",value:function(){var e=this.jsonData,t=(this._parseJsonDataChild({jsonData:e,creatorType:Bi}),this._parseJsonDataChild({jsonData:{},creatorType:Vi}));this.object.outdoors=t}}]),t}(Oi),qi=function(e){function t(e){Mi(this,t);var i=Pi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return Di(t,e),Ci(t,[{key:"parseChildren",value:function(){var e=this.jsonData;this._parseJsonDataChild({jsonData:e,creatorType:Hi})}}]),t}(Oi),Wi=function(e){function t(e){Mi(this,t);var i=Pi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return Di(t,e),Ci(t,[{key:"create",value:function(){return Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.walls&&this._parseWalls(e.walls),e.rooms&&this._parseJsonDataChildren({jsonData:e.rooms,creatorType:Ui}),e.doors&&this._parseJsonDataChildren({jsonData:e.doors,creatorType:Ni}),this.object.calRoomsUV2()}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];this._parseJsonDataChild({jsonData:i,creatorType:Ii})}}}]),t}(Oi),Gi=function(e){function t(e){Mi(this,t);var i=Pi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="WallCorner",i}return Di(t,e),Ci(t,[{key:"create",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=this.jsonData[0]*ki.scale,i=this.jsonData[1]*ki.scale;return this.object.position=new THREE.Vector3(e,0,i),this.object}}]),t}(Oi),Xi=function(e){function t(e){return Mi(this,t),Pi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),Ci(t,[{key:"_parseCorners",value:function(){var e=this.jsonData,t=this.objectParent,i=e.start[0]*ki.scale,r=e.start[1]*ki.scale,n=null,o=null;n=t.existsCorner(i,0,r)?t.getCorner(i,0,r):this._createCorner(i,0,r,e.start),i=e.end[0]*ki.scale,r=e.end[1]*ki.scale,o=t.existsCorner(i,0,r)?t.getCorner(i,0,r):this._createCorner(i,0,r,e.end),this.object.startCorner=n,this.object.endCorner=o,n.addWall(this.object),o.addWall(this.object)}},{key:"_createCorner",value:function(e,t,i,r){var n=new Gi({jsonData:r}).create();return n.parent=this.objectParent,n.jsonData=r,n}}]),t}(Oi),Yi=function(){function e(){Mi(this,e)}return Ci(e,null,[{key:"uuid",value:function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var i=e.join("");return i}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var a in i){o=!0;for(var s=i[a].skeleton,l=n[a],u=[],c=0;c<s.bones.length;++c){var h=r[s.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Ai(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}}]),e}(),Ji=function(e){function t(e){Mi(this,t);var i=Pi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ModelWall",i}return Di(t,e),Ci(t,[{key:"create",value:function(){return Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),Yi.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),Yi.checkValueEmpty(this.jsonData.isshow)&&(this.object.isShow=this.jsonData.isshow),Yi.checkValueEmpty(this.jsonData.height)?this.object.height=this.object.resource.modelSize.y:this.object.height=this.jsonData.height,Yi.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}}]),t}(Xi),Qi=function(e){function t(e){Mi(this,t);var i=Pi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="StraightManualWall",i}return Di(t,e),Ci(t,[{key:"create",value:function(){return Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),this._parseResources(),this.jsonData.uvmultiple&&(this.object.uvMultiple=this.jsonData.uvmultiple),Yi.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),Yi.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}},{key:"_parseResources",value:function(){this.object.leftResource=this.resourceManager.defaultWallTextureResource,this.object.rightResource=this.resourceManager.defaultWallTextureResource,this.object.edgeResource=this.resourceManager.defaultWallEdgeResource,this.object.lightMapResource=this.resourceManager.wallLightMapResource}}]),t}(Xi),Zi=function(e){function t(e){Mi(this,t);var i=Pi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.attachWall=e.attachWall,i.createType="DoorOrWindow",i.pointInLineDeviation=.001,i}return Di(t,e),Ci(t,[{key:"create",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=ki.scale,i=this.jsonData,r=i.height*e,n=i.width*e,o=i.pos[0]*e,a=i.pos[1]*e,s=new THREE.Vector3(o,0,a);this.attachWall=this._getPointOnWhichWall(this.objectParent,s),null===this.attachWall&&console.warn("can not find door on which wall!");var l=this.object;return i.suspendpercent&&(l.suspendPercent=i.suspendpercent),l.resource=ki.defaultDoorResource,l.resource.modelSize=new THREE.Vector3(n,r,.15),l.position=s,this.object.attachWall=this.attachWall,this.attachWall.doorOrWindows.push(this.object),this.object.fitAttachWall(),this.object}},{key:"_getPointOnWhichWall",value:function(e,t){for(var i=e.walls,r=0;r<i.length;r++){var n=i[r];if(this._isPointOnLineAndBetweenPoints(n.startCorner.position,n.endCorner.position,t))return n}return null}},{key:"_isPointOnLine",value:function(e,t,i){var r=new THREE.Vector3;return r.crossVectors(e.clone().sub(i),t.clone().sub(i)),r.length()<this.pointInLineDeviation}},{key:"_isPointOnLineAndBetweenPoints",value:function(e,t,i){if(!this._isPointOnLine(e,t,i))return!1;var r=t.x-e.x,n=t.z-e.z;return Math.abs(r)>=Math.abs(n)?r>0?e.x<=i.x&&i.x<=t.x:t.x<=i.x&&i.x<=e.x:n>0?e.z<=i.z&&i.z<=t.z:t.z<=i.z&&i.z<=e.z}}]),t}(Oi),Ki=function(e){function t(e){Mi(this,t);var i=Pi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return Di(t,e),Ci(t,[{key:"create",value:function(){if(Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parsePoints(),0!==this.object.points.length)return this._parseHolesPoints(),this._parseRoomResources(),this._parseRoomHeight(),this._parseRoomBlockSize(),this._parseRoomVisible(),this._parseRoomBlockAngle(),this.object.initShapePathPoints(),this.object.initShapeHolePoints(),this.object;console.error("room points is null")}},{key:"_parsePoints",value:function(){if(this.jsonData.points){for(var e=[],t=0;t<this.jsonData.points.length;t++){var i=this.jsonData.points[t],r=ki.scale*i[0],n=ki.scale*i[1],o=new THREE.Vector3(r,0,n);e.push(o)}this.object.points=e}}},{key:"_parseHolesPoints",value:function(){if(this.jsonData.holes){for(var e=[],t=0;t<this.jsonData.holes.length;t++){for(var i=this.jsonData.holes[t],r=[],n=0;n<i.length;n++){var o=i[n],a=ki.scale*o[0],s=ki.scale*o[1],l=new THREE.Vector3(a,0,s);r.push(l)}e.push(r)}this.object.holes=e}}},{key:"_parseRoomResources",value:function(){this.object.floor.resource=ki.defaultFloorTextureResource,this.object.ceiling.resource=ki.defaultCeilingTextureResource,this.object.roof.resource=ki.defaultRoofTextureResource,null!==this.jsonData.floortexture&&void 0!==this.jsonData.floortexture&&(this.object.floorResource=this.resourceManager.textures[this.jsonData.floortexture],this.object.floor.resource=this.object.floorResource),null!==this.jsonData.ceilingtexture&&void 0!==this.jsonData.ceilingtexture&&(this.object.ceilingResource=this.resourceManager.textures[this.jsonData.ceilingtexture],this.object.ceiling.resource=this.object.ceilingResource),null!==this.jsonData.rooftexture&&void 0!==this.jsonData.rooftexture&&(this.object.roofResource=this.resourceManager.textures[this.jsonData.rooftexture],this.object.roof.resource=this.object.roofResource)}},{key:"_parseRoomHeight",value:function(){var e=this.jsonData,t=this.object;void 0!==e.ceilingheight?t.ceiling.height=e.ceilingheight:(t.ceiling.DefaultHeight=this.objectParent.height-.1,t.ceiling.height=t.ceiling.DefaultHeight),void 0!==e.roofheight?t.roof.height=e.roofheight:(t.roof.defaultHeight=this.objectParent.height,t.roof.height=t.roof.defaultHeight),void 0!==e.floorheight&&(t.floor.height=e.floorheight)}},{key:"_parseRoomVisible",value:function(){var e=this.jsonData,t=this.object;void 0!==e.isshowfloor&&(t.floor.isShow=e.isshowfloor),void 0!==e.isshowceiling&&(t.ceiling.isShow=e.isshowceiling),void 0!==e.isshowroof&&(t.roof.isShow=e.isshowroof)}},{key:"_parseRoomBlockSize",value:function(){var e=this.jsonData,t=this.object;if(e.floorblocksize){var i=e.floorblocksize;t.floor.blockSize=new THREE.Vector2(i[0],i[1])}if(e.ceilingblocksize){var r=e.ceilingblocksize;t.ceiling.blockSize=new THREE.Vector2(r[0],r[1])}if(e.roofblocksize){var n=e.roofblocksize;t.roof.blockSize=new THREE.Vector2(n[0],n[1])}}},{key:"_parseRoomBlockAngle",value:function(){var e=this.jsonData,t=this.object;Yi.checkValueEmpty(e.floorblockangle)||(t.floor.blockAngle=e.floorblockangle),Yi.checkValueEmpty(e.ceilingblockangle)||(t.ceiling.blockAngle=e.ceilingblockangle),Yi.checkValueEmpty(e.roofblockangle)||(t.roof.blockAngle=e.roofblockangle)}}]),t}(Oi),$i=function(e){function t(e){Mi(this,t);var i=Pi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return Di(t,e),t}(Wi),er=function(){function e(t){Mi(this,e),this._map={0:zi,1:qi,2:Wi,3:Gi,4:Ji,5:Qi,8:Zi,9:Ki,10:$i}}return Ci(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),tr=function(){function e(t){Mi(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl}return Ci(e,[{key:"createResource",value:function(e){var t=Fi.create({type:e});return t.manager=this.manager,t.baseUrl=this.manager.baseTextureUrl,t}},{key:"initDefaultResources",value:function(){var e=this.createResource("Resource");e.id="EB9ECFA1101C4A0ABB770ED3A9865441",e.ext="jpg",e.baseUrl=this.manager.baseTextureUrl,this.manager.defaultWallEdgeResource=e,(e=this.createResource("Resource")).id="81FDB96B43D441C5B3C650BFA2B76CD4",e.ext="jpg",e.isDefault=!0,this.manager.defaultWallTextureResource=e,(e=this.createResource("Resource")).id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",e.ext="jpg",this.manager.defaultFloorTextureResource=e,(e=this.createResource("Resource")).id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",e.ext="jpg",this.manager.defaultCeilingTextureResource=e,(e=this.createResource("Resource")).id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",e.ext="jpg",this.manager.defaultCeilingTextureResource=e}}]),e}(),ir=function(){function e(t){Mi(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new er,t&&t.resourceLibraryUrl&&(this.resourceLibraryUrl=t.resourceLibraryUrl)}return Ci(e,[{key:"setObjectTypeConfig",value:function(e){Fi.objectTypeConfig=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"initDefaultResources",value:function(){this.resourceLibraryUrl&&(this.resourceManager.baseTextureUrl=this.resourceLibraryUrl+"/texture/",this.resourceManager.baseModelUrl=this.resourceLibraryUrl+"/model/"),this.defaultFloorTextureResource=this.createResource("Resource"),this.defaultFloorTextureResource.id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",this.defaultFloorTextureResource.ext="jpg",this.defaultFloorTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultCeilingTextureResource=this.createResource("Resource"),this.defaultCeilingTextureResource.id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",this.defaultCeilingTextureResource.ext="jpg",this.defaultCeilingTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultRoofTextureResource=this.createResource("Resource"),this.defaultRoofTextureResource.id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",this.defaultRoofTextureResource.ext="jpg",this.defaultRoofTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultDoorResource=this.resourceManager.emptyModelResource,ki.defaultFloorTextureResource=this.defaultFloorTextureResource,ki.defaultCeilingTextureResource=this.defaultCeilingTextureResource,ki.defaultRoofTextureResource=this.defaultRoofTextureResource,ki.defaultDoorResource=this.defaultDoorResource,this.createEmptyModelResource(),this.createEmptyTextureResource()}},{key:"createEmptyTextureResource",value:function(){var e=this.createResource("Resource");e.ready=!0,e.texture=new THREE.Texture,e.isEmpty=!0,this.resourceManager.emptyTextureResource=e}},{key:"createEmptyModelResource",value:function(){var e=this.createResource("Resource");e.ready=!0,e.model=new THREE.Object3D,e.isEmpty=!0,this.resourceManager.emptyModelResource=e}},{key:"loadLightMaps",value:function(e){var t=null,i="18091219l1g1hnjt",r="png";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(i=e.straightmanualwall.lightingtexture.id,r=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource("Resource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=i,t.ext=r,this.resourceManager.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource("Resource")).baseUrl=this.resourceManager.baseTextureUrl,t.id="18091216vjlgtwbh",t.ext="jpg",this.resourceManager.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=Fi.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++){i+=t[r]+"/"}return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,i){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,(function(i){e.sceneJson=JSON.parse(i),t()}),(function(){}),(function(t){i("can not load "+e.sceneURL)}))}else i("load scene json error")}))}},{key:"getResourceMaanagerLoader",value:function(){return new tr(this.resourceManager)}},{key:"parseSceneJson",value:function(){var e=this.getResourceMaanagerLoader();this.loadLightMaps(this.sceneJson.materialsetting),e.initDefaultResources(),this.initDefaultResources(),this.parseWorld(this.sceneJson)}},{key:"parseWorld",value:function(e){ji.config=this.creatorTypeConfig,this.world=ji.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:Li})}}]),e}(),rr=new(function(){function e(t){Gt(this,e),this._map={0:new ir,2:new Si},this._versions=[0]}return Xt(e,[{key:"getLoaderManager",value:function(e){return null!=e?this._map[e]:this._map[this._versions.length-1]}}]),e}()),nr=function(){function e(t){Gt(this,e),this.resourceManager=t.resourceManager,this.defaultSetting=t.defaultSetting,this.defaultResource=t.defaultResource,this.objectTypeConfig=t.objectTypeConfig,t.version&&(this.version=t.version)}return Xt(e,[{key:"load",value:function(e){var t=rr.getLoaderManager(e.version);return t.setDefaultSetting(this.defaultSetting),t.setDefaultResource(this.defaultResource),t.setResourceManager(this.resourceManager),t.setObjectTypeConfig(this.objectTypeConfig),t.parseObjects(e)}}]),e}(),or=function(){function e(t){i(this,e),this.plan=t,this.straightManualCombineWallMap=new Map,this.combinePlacementMap=new Map,this.combineFloorMap=new Map,this.combineRoofMap=new Map,this.combineCeilingMap=new Map,this.combineModelWallMap=new Map,this.combineDoorOrWindowMap=new Map,this.combinePlacementWallMap=new Map,this.combineWalls=[],this.combinePlacements=[],this.combineFloors=[],this.combineCeilings=[],this.combineRoofs=[],this.differentHeightRoomMap=new Map,this.curPlacementCombineProcessorInRoomMap=new Map}return r(e,[{key:"parser",value:function(){for(var e=this.plan,t=this.plan.placements,i=this.plan.walls,r=this.plan.rooms,n=[],o=[],a=[],s=0;s<e.corners.length;s++){e.corners[s].build()}for(var l=0;l<t.length;l++){var u=t[l];this.isPlacementShouldCombine(u)?this.addPlacementToCollector(u):n.push(u)}e.placements=n;for(var c=0;c<e.groups.length;c++){var h=e.groups[c];this.isGroupShouldCombine(h)?this.addPlacementGroupToCollector(h):o.push(h)}e.groups=o;for(var p=0;p<i.length;p++){var d=i[p];if(d.isShow)if("StraightManualWall"===d.type)if(0===d.doorOrWindows.length)this.addStraightManualWall(d);else{d.initMeshInfo(),d.initSimpleCornersAndWalls();for(var f=0;f<d.subCorners.length;f++){d.subCorners[f].build()}for(var m=0;m<d.subWalls.length;m++){var g=d.subWalls[m];this.addStraightManualWall(g)}}else if("ModelWall"===d.type){this.getCombineObjectFromMap(d.resource,Pt,this.combineModelWallMap).addWall(d)}else if("PlacementWall"===d.type){this.getCombineObjectFromMap(d.resource,It,this.combinePlacementWallMap).add(d)}}for(var v=0;v<e.doorOrWindows.length;v++){var y=e.doorOrWindows[v];this.isPlacementShouldCombine(y)?this.addDoorOrWindowToCollector(y):a.push(y)}e.doorOrWindows=a,this.clearPlanWalls(e),this.parseRooms(r),e.size,e.corners=[],e.fillChildren()}},{key:"parseRooms",value:function(e){for(var t=new Map,i=new Map,r=new Map,n=[],o=0;o<e.length;o++){var a=e[o];if(a.properties||a.userID||a.name)(a.properties||a.userID||a.name)&&n.push(a);else{if(a.floor.isShow)this.getHeightRoomInfoListFromMap(a.floor.height,t).push(a.floor);if(a.ceiling.isShow)this.getHeightRoomInfoListFromMap(a.ceiling.height,i).push(a.ceiling);if(a.roof.isShow)this.getHeightRoomInfoListFromMap(a.roof.height,r).push(a.roof)}}var s=!0,l=!1,u=void 0;try{for(var c,h=t.keys()[Symbol.iterator]();!(s=(c=h.next()).done);s=!0)for(var p=c.value,d=t.get(p),f=0;f<d.length;f++){var m=d[f];this.addFloorToCollector(m,p)}}catch(e){l=!0,u=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw u}}var g=!0,v=!1,y=void 0;try{for(var b,_=i.keys()[Symbol.iterator]();!(g=(b=_.next()).done);g=!0)for(var x=b.value,E=i.get(x),w=0;w<E.length;w++){var T=E[w];this.addCeilingToCollector(T,x)}}catch(e){v=!0,y=e}finally{try{!g&&_.return&&_.return()}finally{if(v)throw y}}var S=!0,A=!1,M=void 0;try{for(var C,R=r.keys()[Symbol.iterator]();!(S=(C=R.next()).done);S=!0)for(var D=C.value,P=r.get(D),j=0;j<P.length;j++){var F=P[j];this.addRoofToCollector(F,D)}}catch(e){A=!0,M=e}finally{try{!S&&R.return&&R.return()}finally{if(A)throw M}}this.plan.rooms=n;for(var O=0;O<n.length;O++){var k=n[O],L=this.calRoomPosition(k);k.position=L,this.subRoomHolesPointsByPosition(k,L),this.subRoomPointsByPosition(k,L),k.initShapePathPoints(),k.initShapeHolePoints()}}},{key:"calRoomPosition",value:function(e){for(var t=e.points,i=e.holes,r=[],n=[],o=0;o<t.length;o++){var a=t[o];r.push([a.x,a.z])}if(i.length>2&&!this.isSamePoints(i))for(o=0;o<i.length;o++){for(var s=i[o],l=[],u=0;u<s.length;u++){a=s[u];l.push([a.x,a.z])}n.push(l)}var c=this.getLabelPosition(r,n);return c?new THREE.Vector3(c[0],0,c[1]):new THREE.Vector3}},{key:"isSamePoints",value:function(e){for(var t=e[0],i=1;i<e.length;i++){var r=e[i];if(t.x!==r.x||t.y!==r.y||t.z!==r.z)return!1}return!0}},{key:"getLabelPosition",value:function(e,t){if(!e||!e.length)return null;var i=[];if(i.push(e),t&&0!=t.length)for(var r=0;r<t.length;r++){var n=[t[r][0],t[r][1],t[r][2],t[r][3]];i.push(n)}var o=kt(i);return[o[0],o[1]]}},{key:"subRoomPointsByPosition",value:function(e,t){for(var i=e.points,r=0;r<i.length;r++){i[r].sub(t)}}},{key:"subRoomHolesPointsByPosition",value:function(e,t){for(var i=e.holes,r=0;r<i.length;r++)for(var n=i[r],o=0;o<n.length;o++){n[o].sub(t)}}},{key:"getHeightRoomInfoListFromMap",value:function(e,t){return t.has(e)||t.set(e,[]),t.get(e)}},{key:"addStraightManualWall",value:function(e){e.initMeshInfo(),this.addToStraightManualWallCollector(e)}},{key:"addToStraightManualWallCollector",value:function(e){var t=this.getCombineObjectFromMap(e.leftResource,wt,this.straightManualCombineWallMap),i=this.getCombineObjectFromMap(e.rightResource,wt,this.straightManualCombineWallMap),r=this.getCombineObjectFromMap(e.edgeResource,wt,this.straightManualCombineWallMap);t.lightMapResource=Ae.wallLightMapResource,i.lightMapResource=Ae.wallLightMapResource,t.addMeshInfo(e.leftSideMeshInfo),i.addMeshInfo(e.rightSideMeshInfo),r.addMeshInfo(e.edgeSideMeshInfo)}},{key:"createStraightManualCombineWallToMap",value:function(e,t,i){if(!t.has(e)){var r=new wt;r.resource=e,r.parent=i,t.set(e,r)}}},{key:"addPlacementToCollector",value:function(e,t){var i=null;Me.enableCombinePlacementsByRoom?(this.curPlacementCombineProcessorInRoomMap.has(e.belongRoomUserID)||this.curPlacementCombineProcessorInRoomMap.set(e.belongRoomUserID,new Map),i=this.curPlacementCombineProcessorInRoomMap.get(e.belongRoomUserID)):i=this.combinePlacementMap;var r=this.getCombineObjectFromMap(e.resource,Mt,i);r.belongRoomUserID=e.belongRoomUserID,r.add(e,t)}},{key:"addPlacementGroupToCollector",value:function(e,t){t||(t=new Tt),t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation);for(var i=0;i<e.placements.length;i++){var r=e.placements[i];r.isShow&&this.addPlacementToCollector(r,t.clone())}for(i=0;i<e.groups.length;i++){var n=e.groups[i];n.isShow&&this.addPlacementGroupToCollector(n,t.clone())}}},{key:"addDoorOrWindowToCollector",value:function(e){this.getCombineObjectFromMap(e.resource,jt,this.combineDoorOrWindowMap).add(e)}},{key:"addRoofToCollector",value:function(e,t){if(!(this.plan instanceof nt)){var i=this.getCombineRoomRelatedObject(e,Dt,this.plan.combineRoofObjects);i.height=t,i.add(e)}}},{key:"addCeilingToCollector",value:function(e,t){if(!(this.plan instanceof nt)){var i=this.getCombineRoomRelatedObject(e,Rt,this.plan.combineCeilingObjects);i.height=t,i.add(e)}}},{key:"addFloorToCollector",value:function(e,t){var i=this.getCombineRoomRelatedObject(e,Ct,this.plan.combineFloorObjects);i.height=t,i.add(e)}},{key:"getCombineRoomRelatedObject",value:function(e,t,i){for(var r=null,n=0;n<i.length;n++){var o=i[n];if(o.resource===e.resource&&o.height===e.height){r=o;break}}return null===r&&((r=new t).parent=this.plan,r.resource=e.resource,r.height=e.height),r}},{key:"clearPlanWalls",value:function(e){e.walls=[]}},{key:"getCombineObjectFromMap",value:function(e,t,i){if(!i.has(e)){var r=new t;r.resource=e,r.parent=this.plan,i.set(e,r)}return i.get(e)}},{key:"isPlacementShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.properties)&&(!!this.isNullOrUndefined(e.userID)&&(!!this.isNullOrUndefined(e.name)&&!!e.isShow))}},{key:"isGroupShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.properties)&&(!!this.isNullOrUndefined(e.userID)&&(!!this.isNullOrUndefined(e.name)&&!!e.isShow))}},{key:"isNullOrUndefined",value:function(e){return null==e}},{key:"parseDifferentHeightRooms",value:function(e){}}]),e}(),ar=function(){function e(){i(this,e)}return r(e,[{key:"parseWorld",value:function(e){var t=e.outdoors;this.parsePlan(t);for(var i=e.buildings,r=0;r<i.length;r++){var n=i[r];this.parseBuilding(n)}var o=[];for(r=0;r<e.buildings.length;r++){n=e.buildings[r];for(var a=0;a<n.floorplans.length;a++){var s=n.floorplans[a];o.push(s)}}o.push(e.outdoors)}},{key:"parseBuilding",value:function(e){for(var t=e.floorplans,i=0;i<t.length;i++){var r=t[i];this.parsePlan(r)}}},{key:"parsePlan",value:function(e){new or(e).parser()}}]),e}(),sr=function(){function e(t){i(this,e),this.sceneJson=null,this.world=null,this.resourceManager=new gt,this.loader=new nr({objectTypeConfig:_t,resourceManager:this.resourceManager,defaultSetting:Me,defaultResource:Ae}),this.combineParser=new ar(this),this.dynamicBuildManager=new zt(this)}return r(e,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"delayLoad",value:function(e){var t=this;return new Promise((function(i,r){t.loadSceneJson(e).then((function(){t.world=t.loader.load({json:t.sceneJson,version:0}),t.combineParser.parseWorld(t.world),St.compatibilityProcessWorld(t.world),t.dynamicBuildManager.world=t.world,t.dynamicBuildManager.requestToBuild(t.world.id),t.dynamicBuildManager.build((function(e){1===e&&i(t.world)}))}))}))}},{key:"loadResources",value:function(){var e=this;return new Promise((function(t,i){e.resourceManager.downloadResourcesWithQueue((function(){t(e.world)}))}))}},{key:"load",value:function(e){return this.delayLoad(e)}},{key:"loadSceneJson",value:function(e){var t=this;return new Promise((function(i,r){if(e.jsonData)t.sceneJson=e.jsonData,i(t.sceneJson);else if(e.url){(new THREE.FileLoader).load(e.url,(function(e){t.sceneJson=JSON.parse(e),i()}),(function(){}),(function(e){r("can not load "+t.sceneURL)}))}else r("load scene json error")}))}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),lr=function(){function e(t){i(this,e),this.sceneJson=null,this.world=null,this.combineParser=new ar(this),this.dynamicBuildManager=new zt(this),this.resourceManager=new gt,this.loader=new nr({objectTypeConfig:_t,resourceManager:this.resourceManager,defaultSetting:Me,defaultResource:Ae})}return r(e,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"loadSceneJson",value:function(e){var t=this;return new Promise((function(i,r){if(e.json)t.sceneJson=e.json,i(t.sceneJson);else if(e.url){(new THREE.FileLoader).load(e.url,(function(e){t.sceneJson=JSON.parse(e),i()}),(function(){}),(function(e){r("can not load "+t.sceneURL)}))}else r("load scene json error")}))}},{key:"loadResources",value:function(){var e=this;return new Promise((function(t,i){e.dynamicBuildManager.build((function(i){1===i&&t(e.world)}))}))}},{key:"delayLoad",value:function(e){var t=this;return e.version=2,new Promise((function(i,r){t.loadSceneJson(e).then((function(){t.world=t.loader.load({json:t.sceneJson,version:2}),t.combineParser.parseWorld(t.world),St.compatibilityProcessWorld(t.world),t.dynamicBuildManager.world=t.world,t.dynamicBuildManager.requestToBuild(t.world.id),i(t.world)}))}))}},{key:"load",value:function(e){return this.delayLoad(e)}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}();e.Building=ze,e.CombineCeiling=Rt,e.CombineDoorOrWindow=jt,e.CombineFloor=Ct,e.CombineModelWall=Pt,e.CombinePlacement=Mt,e.CombineRoof=Dt,e.CombineStraightManualWall=wt,e.CurveLine=qe,e.DefaultSetting=Me,e.DoorOrWindow=it,e.Outdoors=nt,e.PipeLine=ot,e.Placement=Xe,e.PlacementGroup=Ye,e.Room=Fe,e.ThingjsEditorSceneLoader=sr,e.ThingjsEditorSceneLoader_2_0=lr,e.UBuilderSceneDelayLoader=qt,e.VideoProbe=st,e.debugManager=ht,Object.defineProperty(e,"__esModule",{value:!0})})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.THING=e.THING||{})}(this,(function(e){"use strict";var t,i,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},l=function(e){return function(t){return toString.call(t)=="[object "+e+"]"}},u=function(){function e(t){n(this,e);var i,r,o=new TextEncoderLite("utf-8").encode(t),a=[],s=0;for(i=0;i<256;i++)a[i]=i;for(i=0;i<256;i++)s=(s+a[i]+o[i%o.length])%256,r=a[i],a[i]=a[s],a[s]=r;this._s=a,this._i=0,this._j=0}return e.prototype.update=function(e){var t=e;return l("String")(e)&&(t=new TextEncoderLite("utf-8").encode(e)),l("Array")(e)&&(t=new Uint8Array(e)),l("Uint8Array")(t)?this._update(t):null},e.prototype._update=function(e){var t,i,r,n=e.length,o=new Uint8Array(n),a=this._i,s=this._j,l=this._s.concat();for(r=0;r<n;r++)i=l[s=(s+(t=l[a=(a+1)%256]))%256],l[a]=i,l[s]=t,o[r]=e[r]^l[(t+i)%256];return o},e.prototype.toStr=function(e){var t=this.update(e);return t?new TextDecoderLite("utf-8").decode(t):null},e.prototype._toStr=function(e){var t=this._update(e);return t?new TextDecoderLite("utf-8").decode(t):null},e}(),c=new u("bai@3$%218%^$%^~)((&0!?<kjh"),h="";document.getElementsByTagName&&(i=(t=document.getElementsByTagName(c._toStr([76,245,185,246,70,34])))[t.length-1],h=document.querySelector?i.src:i.getAttribute(c._toStr([76,228,168]),4));var p,d=new Uint8Array([0,97,115,109,1,0,0,0,1,199,128,128,128,0,12,96,1,127,1,127,96,1,127,0,96,2,127,127,0,96,3,127,127,127,1,127,96,2,127,127,1,127,96,5,127,127,127,127,127,1,127,96,2,126,126,1,126,96,3,126,126,126,1,126,96,4,126,126,127,127,0,96,0,0,96,4,127,127,127,127,0,96,0,1,127,2,139,129,128,128,0,8,3,101,110,118,14,95,99,111,110,115,111,108,101,66,117,102,102,101,114,0,1,3,101,110,118,11,95,99,111,110,115,111,108,101,76,111,103,0,2,3,101,110,118,14,95,99,111,110,115,111,108,101,78,117,109,98,101,114,0,1,3,101,110,118,5,95,101,120,105,116,0,1,3,101,110,118,5,95,102,114,101,101,0,1,3,101,110,118,7,95,109,97,108,108,111,99,0,0,3,101,110,118,16,95,114,101,113,117,101,115,116,70,105,108,101,83,105,122,101,0,1,3,101,110,118,10,95,114,117,110,83,99,114,105,112,116,0,2,3,179,128,128,128,0,50,3,3,3,3,0,0,0,3,0,4,3,1,0,3,3,1,1,1,1,5,1,4,4,2,6,6,7,8,4,2,9,10,11,4,9,2,0,4,0,0,0,11,11,11,0,0,0,2,11,1,4,132,128,128,128,0,1,112,0,0,5,131,128,128,128,0,1,0,1,6,129,128,128,128,0,0,7,211,133,128,128,0,51,6,109,101,109,111,114,121,2,0,6,109,101,109,115,101,116,0,8,6,109,101,109,99,112,121,0,9,7,109,101,109,109,111,118,101,0,10,6,109,101,109,99,109,112,0,11,7,105,115,80,114,105,109,101,0,12,7,116,111,85,112,112,101,114,0,13,7,116,111,76,111,119,101,114,0,14,12,115,116,114,105,110,103,69,113,117,97,108,115,0,15,12,115,116,114,105,110,103,76,101,110,103,116,104,0,16,15,115,101,97,114,99,104,83,116,114,105,110,103,76,50,82,0,17,10,99,111,112,121,83,116,114,105,110,103,0,18,9,109,105,120,83,116,114,105,110,103,0,19,11,97,108,108,111,99,83,116,114,105,110,103,0,20,12,97,112,112,101,110,100,83,116,114,105,110,103,0,21,9,115,117,98,83,116,114,105,110,103,0,22,13,99,111,110,115,111,108,101,78,117,109,98,101,114,0,23,13,99,111,110,115,111,108,101,66,117,102,102,101,114,0,24,10,99,111,110,115,111,108,101,76,111,103,0,25,9,114,117,110,83,99,114,105,112,116,0,26,10,106,115,109,110,95,112,97,114,115,101,0,27,9,106,115,109,110,95,105,110,105,116,0,28,15,112,97,114,115,101,74,83,79,78,83,116,114,105,110,103,0,29,13,102,105,110,100,74,83,79,78,84,111,107,101,110,0,30,13,102,114,101,101,74,83,79,78,84,111,107,101,110,0,31,3,103,99,100,0,32,9,69,120,116,69,117,99,108,105,100,0,33,10,114,115,97,95,109,111,100,69,120,112,0,34,10,114,115,97,71,101,110,75,101,121,115,0,35,17,114,115,97,71,101,116,69,110,99,114,121,112,116,83,105,122,101,0,36,10,105,110,105,116,71,108,111,98,97,108,0,37,10,102,114,101,101,71,108,111,98,97,108,0,38,14,115,101,116,82,97,110,100,111,109,83,101,101,100,115,0,39,6,114,97,110,100,111,109,0,40,10,114,97,110,100,111,109,85,105,110,116,0,41,15,114,101,113,117,101,115,116,70,105,108,101,83,105,122,101,0,42,14,111,110,82,101,99,118,70,105,108,101,83,105,122,101,0,43,21,103,101,116,69,110,99,111,100,105,110,103,83,116,114,105,110,103,83,105,122,101,0,44,21,103,101,116,69,110,99,111,100,105,110,103,83,116,114,105,110,103,68,97,116,97,0,45,12,101,110,99,111,100,101,83,116,114,105,110,103,0,46,21,103,101,116,68,101,99,111,100,105,110,103,83,116,114,105,110,103,83,105,122,101,0,47,12,100,101,99,111,100,101,83,116,114,105,110,103,0,48,13,103,101,116,65,116,116,114,105,98,117,116,101,115,0,49,5,103,101,116,73,68,0,50,16,103,101,116,80,108,117,103,105,110,115,78,117,109,98,101,114,0,51,16,103,101,116,80,108,117,103,105,110,86,101,114,115,105,111,110,0,52,13,103,101,116,80,108,117,103,105,110,78,97,109,101,0,53,13,103,101,116,80,108,117,103,105,110,68,101,115,99,0,54,13,115,101,116,65,116,116,114,105,98,117,116,101,115,0,55,14,103,101,116,82,97,110,100,111,109,86,97,108,117,101,0,56,4,101,118,97,108,0,57,10,169,195,128,128,0,50,172,128,128,128,0,1,1,127,2,64,32,2,69,13,0,32,0,33,3,3,64,32,3,32,1,58,0,0,32,3,65,1,106,33,3,32,2,65,127,106,34,2,13,0,11,11,32,0,11,182,128,128,128,0,1,1,127,2,64,32,2,69,13,0,32,0,33,3,3,64,32,3,32,1,45,0,0,58,0,0,32,3,65,1,106,33,3,32,1,65,1,106,33,1,32,2,65,127,106,34,2,13,0,11,11,32,0,11,233,128,128,128,0,1,1,127,2,64,2,64,32,0,32,1,77,13,0,32,2,69,13,1,3,64,32,0,32,2,106,65,127,106,32,1,32,2,106,65,127,106,45,0,0,58,0,0,32,2,65,127,106,34,2,13,0,12,2,11,11,32,2,69,13,0,32,0,33,3,3,64,32,3,32,1,45,0,0,58,0,0,32,3,65,1,106,33,3,32,1,65,1,106,33,1,32,2,65,127,106,34,2,13,0,11,11,32,0,11,202,128,128,128,0,1,1,127,2,64,2,64,32,2,65,1,72,13,0,32,2,65,1,106,33,2,3,64,32,0,45,0,0,32,1,45,0,0,107,34,3,13,2,32,1,65,1,106,33,1,32,0,65,1,106,33,0,32,2,65,127,106,34,2,65,1,74,13,0,11,11,65,0,33,3,11,32,3,11,191,128,128,128,0,1,2,127,2,64,2,64,32,0,65,1,70,13,0,32,0,65,2,109,33,1,32,0,65,4,72,13,0,65,1,33,2,3,64,32,0,32,2,65,1,106,34,2,111,69,13,2,32,2,32,1,72,13,0,11,11,65,0,15,11,65,1,11,147,128,128,128,0,0,32,0,65,96,106,32,0,32,0,65,159,127,106,65,26,73,27,11,147,128,128,128,0,0,32,0,65,32,106,32,0,32,0,65,191,127,106,65,26,73,27,11,167,129,128,128,0,1,1,127,2,64,2,64,2,64,2,64,32,0,69,13,0,32,1,69,13,1,2,64,2,64,32,2,69,13,0,3,64,32,0,44,0,0,34,2,65,32,106,32,2,32,2,65,191,127,106,65,26,73,27,34,3,32,1,44,0,0,34,2,65,32,106,32,2,32,2,65,191,127,106,65,26,73,27,71,13,5,65,1,33,2,32,0,65,1,106,33,0,32,1,65,1,106,33,1,32,3,13,0,12,2,11,11,3,64,32,0,45,0,0,34,3,32,1,45,0,0,71,13,5,65,1,33,2,32,0,65,1,106,33,0,32,1,65,1,106,33,1,32,3,13,0,11,11,32,2,15,11,65,0,15,11,65,0,15,11,65,0,15,11,65,0,11,185,128,128,128,0,1,3,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,0,3,64,32,1,32,0,106,33,2,32,0,65,1,106,34,3,33,0,32,2,45,0,0,13,0,11,32,3,15,11,65,0,11,233,129,128,128,0,1,7,127,65,127,33,8,2,64,2,64,32,1,45,0,0,69,13,0,65,1,33,6,3,64,32,1,32,6,106,33,5,32,6,65,1,106,34,2,33,6,32,5,45,0,0,13,0,11,32,2,65,126,106,33,3,2,64,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,4,65,0,33,6,3,64,32,4,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,11,32,7,32,3,74,13,1,12,2,11,65,0,33,7,65,0,32,3,76,13,1,11,32,0,33,4,32,3,65,0,72,13,1,32,0,33,4,3,64,65,0,33,6,32,2,33,5,2,64,3,64,32,4,32,6,106,45,0,0,32,1,32,6,106,45,0,0,71,13,1,32,6,65,1,106,33,6,32,5,65,127,106,34,5,65,1,74,13,0,12,4,11,11,32,4,65,1,106,33,4,65,127,33,8,32,7,65,127,106,34,7,32,3,74,13,0,11,11,32,8,15,11,32,4,32,0,107,11,255,128,128,128,0,1,4,127,2,64,32,2,69,13,0,32,0,33,6,2,64,32,1,45,0,0,34,4,69,13,0,32,1,65,1,106,33,1,32,0,33,5,2,64,3,64,32,5,34,3,32,4,58,0,0,65,127,33,6,2,64,32,2,65,127,70,13,0,32,2,65,127,106,34,6,69,13,2,11,32,3,65,1,106,33,5,32,1,45,0,0,33,4,32,1,65,1,106,33,1,32,6,33,2,32,4,13,0,11,11,32,3,65,1,106,33,6,11,32,6,65,0,58,0,0,32,0,15,11,65,0,11,238,130,128,128,0,1,5,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,5,3,64,65,0,40,2,12,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,5,32,2,32,1,115,32,3,115,32,4,115,65,255,1,112,58,0,0,65,0,40,2,12,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,5,32,2,32,1,115,32,3,115,32,4,115,65,255,1,112,32,5,45,0,0,115,34,0,58,0,0,32,5,65,1,106,33,5,32,0,65,255,1,113,13,0,11,11,11,195,129,128,128,0,1,6,127,2,64,2,64,32,0,69,13,0,32,0,45,0,0,69,13,1,65,1,33,4,3,64,32,0,32,4,106,33,3,32,4,65,1,106,34,1,33,4,32,3,45,0,0,13,0,11,32,1,16,5,34,6,33,3,2,64,32,0,45,0,0,34,4,69,13,0,32,1,65,127,106,33,1,32,0,65,1,106,33,3,32,6,33,5,2,64,3,64,32,5,34,2,32,4,58,0,0,65,127,33,0,2,64,32,1,65,127,70,13,0,32,1,65,127,106,34,0,69,13,2,11,32,2,65,1,106,33,5,32,3,45,0,0,33,4,32,3,65,1,106,33,3,32,0,33,1,32,4,13,0,11,11,32,2,65,1,106,33,3,11,32,3,65,0,58,0,0,32,6,15,11,65,1,16,5,34,4,65,0,58,0,0,32,4,15,11,65,1,16,5,11,252,128,128,128,0,1,3,127,2,64,32,2,69,13,0,32,0,65,0,58,0,0,11,32,0,33,2,3,64,32,2,45,0,0,33,4,32,2,65,1,106,34,5,33,2,32,4,13,0,11,2,64,32,1,45,0,0,34,4,69,13,0,32,1,65,1,106,33,1,65,0,33,2,3,64,32,5,32,2,106,32,4,58,0,0,32,1,32,2,106,33,4,32,2,65,1,106,34,3,33,2,32,4,45,0,0,34,4,13,0,11,32,5,32,3,106,33,5,11,32,5,65,0,58,0,0,32,0,11,143,129,128,128,0,1,4,127,32,2,32,1,107,34,5,65,1,106,16,5,33,3,2,64,32,5,69,13,0,32,3,33,2,2,64,32,0,32,1,106,34,0,45,0,0,34,1,69,13,0,32,0,65,1,106,33,2,32,3,33,6,2,64,3,64,32,6,34,4,32,1,58,0,0,65,127,33,0,2,64,32,5,65,127,70,13,0,32,5,65,127,106,34,0,69,13,2,11,32,4,65,1,106,33,6,32,2,45,0,0,33,1,32,2,65,1,106,33,2,32,0,33,5,32,1,13,0,11,11,32,4,65,1,106,33,2,11,32,2,65,0,58,0,0,11,32,3,11,134,128,128,128,0,0,32,0,16,2,11,134,128,128,128,0,0,32,0,16,0,11,193,128,128,128,0,1,4,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,3,3,64,32,1,32,3,106,33,2,32,3,65,1,106,34,4,33,3,32,2,45,0,0,13,0,11,32,0,32,4,16,1,15,11,32,0,65,0,16,1,11,193,128,128,128,0,1,4,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,3,3,64,32,1,32,3,106,33,2,32,3,65,1,106,34,4,33,3,32,2,45,0,0,13,0,11,32,0,32,4,16,7,15,11,32,0,65,0,16,7,11,129,142,128,128,0,1,9,127,32,0,40,2,4,33,11,2,64,2,64,2,64,2,64,2,64,2,64,32,0,40,2,0,34,5,32,2,79,13,0,32,0,65,8,106,33,8,32,11,33,12,2,64,2,64,2,64,3,64,32,1,32,5,106,45,0,0,34,13,69,13,1,2,64,2,64,2,64,2,64,2,64,2,64,2,64,2,64,2,64,2,64,32,13,65,24,116,65,24,117,34,7,65,119,106,34,10,65,212,0,75,13,0,2,64,2,64,2,64,32,10,14,85,12,12,6,6,12,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,12,6,0,6,6,6,6,6,6,6,6,6,2,6,6,6,6,6,6,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,6,4,12,11,32,0,32,5,65,1,106,34,6,54,2,0,2,64,32,6,32,2,79,13,0,32,6,33,13,32,5,33,10,3,64,32,10,33,7,2,64,2,64,2,64,2,64,2,64,32,1,32,13,106,45,0,0,34,10,65,220,0,70,13,0,32,10,69,13,6,32,10,65,34,70,13,1,32,13,33,10,12,4,11,32,13,33,10,32,7,65,2,106,34,13,32,2,79,13,3,32,0,32,13,54,2,0,32,1,32,13,106,44,0,0,65,94,106,34,9,65,211,0,75,13,1,32,13,33,10,2,64,32,9,14,84,4,2,2,2,2,2,2,2,2,2,2,2,2,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,2,2,2,2,2,4,2,2,2,4,2,2,2,2,2,2,2,4,2,2,2,4,2,4,0,4,11,32,0,32,7,65,3,106,34,13,54,2,0,2,64,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,191,127,106,65,6,73,13,0,32,10,65,159,127,106,65,6,79,13,3,11,32,0,32,7,65,4,106,34,13,54,2,0,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,159,127,106,65,6,73,13,0,32,10,65,191,127,106,65,5,75,13,3,11,32,0,32,7,65,5,106,34,13,54,2,0,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,159,127,106,65,6,73,13,0,32,10,65,191,127,106,65,5,75,13,3,11,32,0,32,7,65,6,106,34,13,54,2,0,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,159,127,106,65,6,73,13,0,32,10,65,191,127,106,65,5,75,13,3,11,32,0,32,7,65,7,106,34,13,54,2,0,11,32,0,32,13,65,127,106,34,10,54,2,0,12,3,11,2,64,32,3,69,13,0,32,11,32,4,79,13,2,32,0,65,4,106,32,11,65,1,106,34,7,54,2,0,32,3,32,11,65,20,108,106,34,5,65,3,54,2,0,32,5,32,6,54,2,4,32,5,32,13,54,2,8,32,5,65,0,54,2,12,32,5,32,8,40,2,0,34,10,54,2,16,32,12,65,1,106,33,12,2,64,32,10,65,127,70,13,0,32,3,32,10,65,20,108,106,34,5,32,5,40,2,12,65,1,106,54,2,12,11,32,13,33,5,32,7,33,11,12,17,11,32,12,65,1,106,33,12,32,13,33,5,12,16,11,32,0,32,5,54,2,0,65,126,15,11,32,0,32,5,54,2,0,65,127,15,11,32,0,32,10,65,1,106,34,13,54,2,0,32,13,32,2,73,13,0,11,11,32,0,32,5,54,2,0,12,19,11,32,8,32,11,65,127,106,54,2,0,12,10,11,32,3,69,13,9,32,8,40,2,0,34,13,65,127,70,13,9,32,3,32,13,65,20,108,106,34,13,40,2,0,65,127,106,65,2,73,13,9,32,8,32,13,40,2,16,54,2,0,12,9,11,32,7,65,251,0,70,13,1,32,7,65,253,0,71,13,2,11,32,3,69,13,7,65,126,33,7,32,11,69,13,16,65,1,65,2,32,13,65,253,0,70,27,33,9,32,11,65,127,106,33,10,3,64,2,64,32,3,32,10,65,20,108,106,34,13,40,2,4,65,127,70,13,0,32,13,40,2,8,65,127,70,13,4,11,32,13,40,2,16,34,10,65,127,71,13,0,11,32,13,40,2,0,32,9,71,13,16,32,8,40,2,0,65,127,71,13,7,12,16,11,32,12,65,1,106,33,12,32,3,69,13,6,65,127,33,7,32,11,32,4,79,13,15,32,0,65,4,106,32,11,65,1,106,34,9,54,2,0,32,3,32,11,65,20,108,106,34,10,66,127,55,2,4,32,10,66,128,128,128,128,112,55,2,12,32,10,69,13,15,32,10,65,4,106,33,6,2,64,32,8,40,2,0,34,7,65,127,70,13,0,32,10,65,16,106,32,7,54,2,0,32,3,32,7,65,20,108,106,34,7,32,7,40,2,12,65,1,106,54,2,12,11,32,6,32,5,54,2,0,32,8,32,11,54,2,0,32,10,65,1,65,2,32,13,65,251,0,70,27,54,2,0,32,9,33,11,12,6,11,32,5,33,10,2,64,32,13,69,13,0,32,5,65,1,106,33,7,3,64,32,7,33,10,2,64,2,64,32,13,65,24,116,65,24,117,34,7,65,119,106,34,9,65,49,75,13,0,32,9,14,50,5,5,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,11,32,7,65,221,0,70,13,4,32,7,65,253,0,70,13,4,11,65,126,33,9,32,7,65,32,72,13,11,32,13,65,255,1,113,65,255,0,70,13,11,32,0,32,10,54,2,0,32,10,32,2,79,13,1,32,10,65,1,106,33,7,32,1,32,10,106,45,0,0,34,13,13,0,11,11,32,3,69,13,3,12,2,11,32,13,40,2,0,32,9,71,13,13,32,13,65,8,106,32,5,65,1,106,54,2,0,32,8,32,13,40,2,16,54,2,0,12,4,11,32,10,65,127,106,33,10,32,3,69,13,1,11,32,11,32,4,79,13,5,32,0,65,4,106,32,11,65,1,106,34,9,54,2,0,32,3,32,11,65,20,108,106,34,13,65,4,54,2,0,32,13,32,5,54,2,4,32,13,32,10,54,2,8,32,13,65,0,54,2,12,32,13,32,8,40,2,0,34,7,54,2,16,32,9,33,11,12,1,11,32,8,40,2,0,33,7,11,32,0,32,10,65,127,106,34,5,54,2,0,32,12,65,1,106,33,12,32,3,69,13,0,32,7,65,127,70,13,0,32,3,32,7,65,20,108,106,34,13,32,13,40,2,12,65,1,106,54,2,12,11,32,0,32,5,65,1,106,34,5,54,2,0,32,5,32,2,73,13,0,11,11,32,3,69,13,3,12,4,11,65,127,33,9,11,32,0,32,5,54,2,0,32,9,15,11,32,11,33,12,32,3,13,1,11,32,12,15,11,32,11,65,127,106,34,5,65,0,72,13,2,32,3,32,11,65,20,108,106,65,112,106,33,13,3,64,2,64,32,13,40,2,0,65,127,70,13,0,32,13,65,4,106,40,2,0,65,127,70,13,2,11,32,13,65,108,106,33,13,32,5,65,127,106,34,5,65,127,74,13,0,11,32,12,15,11,65,125,33,7,11,32,7,15,11,32,12,11,144,128,128,128,0,0,32,0,65,127,54,2,8,32,0,66,0,55,2,0,11,192,131,128,128,0,1,13,127,65,12,16,5,34,12,65,127,54,2,8,32,12,66,0,55,2,0,65,0,33,11,65,128,160,1,16,5,65,0,65,128,160,1,16,8,33,2,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,13,65,0,33,14,3,64,32,13,32,14,106,33,9,32,14,65,1,106,34,11,33,14,32,9,45,0,0,13,0,11,11,32,12,32,0,32,11,32,2,65,128,8,16,27,33,4,2,64,32,1,69,13,0,32,1,32,4,54,2,0,11,32,4,65,20,108,34,14,16,5,65,0,32,14,16,8,33,3,2,64,32,4,65,1,72,13,0,32,0,65,1,106,33,5,65,0,33,10,3,64,32,3,32,10,65,20,108,34,14,106,33,7,2,64,32,2,32,14,106,34,6,40,2,0,65,125,106,65,1,75,13,0,32,6,40,2,8,32,6,40,2,4,34,9,107,34,11,65,1,106,16,5,33,8,2,64,32,11,69,13,0,32,8,33,13,2,64,32,0,32,9,106,45,0,0,34,14,69,13,0,32,5,32,9,106,33,9,32,8,33,12,2,64,3,64,32,12,34,1,32,14,58,0,0,65,127,33,13,2,64,32,11,65,127,70,13,0,32,11,65,127,106,34,13,69,13,2,11,32,1,65,1,106,33,12,32,9,45,0,0,33,14,32,9,65,1,106,33,9,32,13,33,11,32,14,13,0,11,11,32,1,65,1,106,33,13,11,32,13,65,0,58,0,0,11,32,7,32,8,54,2,0,11,32,7,32,6,54,2,4,2,64,32,6,40,2,16,34,14,65,127,70,13,0,32,7,32,3,32,14,65,20,108,106,34,9,54,2,8,2,64,2,64,32,9,40,2,12,34,14,69,13,0,3,64,32,14,34,9,40,2,16,34,14,13,0,11,32,9,65,16,106,33,14,12,1,11,32,9,65,12,106,33,14,11,32,14,32,7,54,2,0,11,32,10,65,1,106,34,10,32,4,71,13,0,11,11,32,3,11,252,129,128,128,0,1,6,127,65,0,33,6,2,64,32,1,69,13,0,32,0,69,13,0,32,1,65,1,106,33,2,2,64,3,64,2,64,32,0,40,2,0,34,3,69,13,0,2,64,2,64,32,3,45,0,0,69,13,0,32,3,65,1,106,33,4,65,0,33,6,3,64,32,4,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,12,2,11,11,65,0,33,7,11,32,3,32,7,16,1,11,2,64,2,64,32,1,45,0,0,69,13,0,65,0,33,6,3,64,32,2,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,12,2,11,11,65,0,33,7,11,32,1,32,7,16,1,2,64,32,0,40,2,0,34,6,69,13,0,32,1,33,5,3,64,32,6,45,0,0,34,7,32,5,45,0,0,71,13,1,32,6,65,1,106,33,6,32,5,65,1,106,33,5,32,7,13,0,12,3,11,11,32,0,40,2,16,32,1,16,30,34,6,13,2,32,0,40,2,12,34,0,13,0,11,65,0,15,11,32,0,33,6,11,32,6,11,206,128,128,128,0,1,2,127,2,64,2,64,2,64,32,1,65,1,72,13,0,32,0,33,3,3,64,2,64,32,3,40,2,0,34,2,69,13,0,32,2,16,4,32,3,65,0,54,2,0,11,32,3,65,20,106,33,3,32,1,65,127,106,34,1,13,0,12,2,11,11,32,0,69,13,1,11,32,0,16,4,11,11,168,128,128,128,0,1,1,126,2,64,32,0,80,13,0,3,64,32,1,32,0,34,2,129,33,0,32,2,33,1,32,0,66,0,82,13,0,11,32,2,15,11,32,1,11,195,128,128,128,0,1,4,126,2,64,32,0,80,13,0,66,1,33,3,66,0,33,4,3,64,32,3,32,1,32,0,34,2,127,32,4,34,5,126,125,33,4,32,1,32,2,129,33,0,32,5,33,3,32,2,33,1,32,0,66,0,82,13,0,11,32,5,15,11,66,1,11,135,129,128,128,0,1,2,126,2,64,2,64,32,1,32,0,132,66,0,83,13,0,32,2,66,0,85,13,1,11,65,1,16,3,11,32,0,32,2,129,33,0,2,64,2,64,2,64,2,64,32,1,80,13,0,32,1,66,1,82,13,1,32,0,15,11,66,1,33,4,12,1,11,32,1,66,2,129,34,3,66,1,81,13,1,66,0,33,4,32,3,66,0,82,13,0,32,0,32,0,126,32,2,129,32,1,66,2,127,32,2,16,34,32,2,129,15,11,32,4,15,11,32,0,32,1,66,127,124,32,2,16,34,32,0,126,32,2,129,11,149,129,128,128,0,1,7,126,2,64,2,64,32,1,66,127,124,32,0,66,127,124,126,34,4,80,13,0,66,129,2,33,10,66,1,33,7,32,4,33,6,66,0,33,8,3,64,32,7,32,10,32,6,34,5,127,32,8,34,9,126,125,33,8,32,10,32,5,129,33,6,32,9,33,7,32,5,33,10,32,6,66,0,82,13,0,12,2,11,11,66,1,33,9,11,32,1,32,0,126,33,6,32,9,32,4,125,33,10,3,64,32,10,32,4,124,34,10,66,0,83,13,0,11,32,2,66,129,2,55,3,8,32,2,32,6,55,3,0,32,3,32,6,55,3,0,32,3,32,10,55,3,8,11,188,128,128,128,0,1,1,127,2,64,32,1,65,1,72,13,0,65,0,33,2,3,64,65,2,65,1,32,0,44,0,0,65,0,72,27,32,2,106,33,2,32,0,65,1,106,33,0,32,1,65,127,106,34,1,13,0,11,32,2,15,11,65,0,11,245,130,128,128,0,4,2,126,3,127,4,126,3,127,65,0,65,200,0,16,5,34,11,54,2,12,32,11,65,0,65,200,0,16,8,26,66,129,2,33,9,66,1,33,8,66,184,240,185,10,33,7,66,0,33,10,3,64,32,8,32,9,32,7,34,2,127,32,10,34,3,126,125,33,10,32,9,32,2,129,33,7,32,3,33,8,32,2,33,9,32,7,66,0,82,13,0,11,32,11,66,129,2,55,3,40,32,11,66,199,161,192,10,55,3,48,32,11,65,32,106,66,199,161,192,10,55,3,0,32,11,32,3,66,0,32,3,66,0,85,27,66,183,240,185,10,124,34,9,32,9,32,3,125,66,184,240,185,10,130,125,55,3,56,2,64,2,64,2,64,32,0,69,13,0,32,0,45,0,0,69,13,1,65,1,33,11,3,64,32,0,32,11,106,33,6,32,11,65,1,106,34,4,33,11,32,6,45,0,0,13,0,11,32,4,16,5,34,13,33,6,2,64,32,0,45,0,0,34,11,69,13,0,32,4,65,127,106,33,4,32,0,65,1,106,33,6,32,13,33,12,2,64,3,64,32,12,34,5,32,11,58,0,0,65,127,33,0,2,64,32,4,65,127,70,13,0,32,4,65,127,106,34,0,69,13,2,11,32,5,65,1,106,33,12,32,6,45,0,0,33,11,32,6,65,1,106,33,6,32,0,33,4,32,11,13,0,11,11,32,5,65,1,106,33,6,11,32,6,65,0,58,0,0,12,2,11,65,1,16,5,34,13,65,0,58,0,0,12,1,11,65,1,16,5,33,13,11,65,0,40,2,12,34,11,32,13,54,2,64,32,11,32,1,54,2,68,11,156,128,128,128,0,1,1,127,2,64,65,0,40,2,12,34,0,69,13,0,32,0,16,4,65,0,65,0,54,2,12,11,11,165,128,128,128,0,1,1,127,65,0,40,2,12,34,4,32,0,54,2,0,32,4,32,1,54,2,4,32,4,32,2,54,2,8,32,4,32,3,54,2,12,11,154,129,128,128,0,1,5,127,65,0,40,2,12,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,2,32,1,115,32,3,115,32,4,115,11,166,129,128,128,0,1,5,127,65,0,40,2,12,34,2,32,2,40,2,0,34,6,65,6,116,32,6,115,65,13,118,32,6,65,18,116,65,128,128,96,113,114,34,3,54,2,0,32,2,32,2,40,2,4,34,6,65,2,116,34,5,32,6,115,65,27,118,32,5,65,96,113,114,34,4,54,2,4,32,2,40,2,12,33,6,32,2,32,2,40,2,8,34,5,65,13,116,32,5,115,65,21,118,32,5,65,7,116,65,128,112,113,114,34,5,54,2,8,32,2,32,6,32,6,65,3,116,115,65,12,118,32,6,65,13,116,65,128,128,64,113,114,34,6,54,2,12,32,4,32,3,115,32,5,115,32,6,115,65,1,32,0,107,32,1,106,112,32,0,106,11,140,128,128,128,0,0,65,0,40,2,12,40,2,64,16,6,11,182,129,128,128,0,1,5,127,2,64,65,0,40,2,12,34,3,40,2,64,34,5,45,0,0,34,6,69,13,0,32,5,69,13,0,32,0,65,16,32,0,27,34,2,45,0,0,34,0,65,255,1,113,34,4,69,13,0,32,6,32,4,71,13,0,32,5,65,1,106,33,5,32,2,65,1,106,33,6,2,64,3,64,32,0,65,255,1,113,69,13,1,32,6,45,0,0,33,0,32,5,45,0,0,33,4,32,5,65,1,106,33,5,32,6,65,1,106,33,6,32,4,32,0,70,13,0,12,2,11,11,32,3,40,2,68,34,0,32,1,70,13,0,32,1,69,13,0,32,0,69,13,0,32,3,32,3,40,2,16,65,144,128,1,114,54,2,16,11,32,3,32,3,40,2,16,65,128,128,128,128,120,114,54,2,16,11,158,129,128,128,0,1,6,127,65,8,33,6,2,64,32,0,44,0,0,34,1,69,13,0,32,0,65,1,106,33,2,65,126,33,5,3,64,32,2,32,5,106,33,4,32,5,65,1,106,34,3,33,5,32,4,65,2,106,45,0,0,13,0,11,32,3,65,1,106,65,0,72,13,0,65,2,65,1,32,1,65,0,72,27,33,4,2,64,32,3,65,127,70,13,0,32,0,65,1,106,33,0,65,0,33,5,3,64,65,2,65,1,32,0,32,5,106,44,0,0,65,0,72,27,32,4,106,33,4,32,5,32,3,71,33,2,32,5,65,1,106,33,5,32,2,13,0,11,11,32,4,65,3,116,65,8,106,33,6,11,32,6,11,163,128,128,128,0,0,2,64,2,64,32,0,69,13,0,32,0,32,1,106,45,0,0,33,0,12,1,11,65,0,33,0,11,32,0,65,255,1,113,11,220,131,128,128,0,2,10,127,1,126,65,0,33,9,65,0,33,3,2,64,32,0,44,0,0,34,1,69,13,0,32,0,65,1,106,33,7,65,0,33,10,3,64,32,7,32,10,106,33,3,32,10,65,1,106,34,9,33,10,32,3,45,0,0,13,0,11,65,0,33,3,32,9,65,127,106,65,0,72,13,0,65,2,65,1,32,1,65,0,72,27,33,3,32,9,65,1,70,13,0,32,0,65,1,106,33,1,65,0,33,10,3,64,65,2,65,1,32,1,32,10,106,44,0,0,65,0,72,27,32,3,106,33,3,32,10,65,2,106,33,7,32,10,65,1,106,33,10,32,7,32,9,71,13,0,11,11,32,3,65,3,116,65,8,106,16,5,34,1,32,3,172,65,0,40,2,12,34,10,65,40,106,34,2,41,3,0,32,10,41,3,32,16,34,55,3,0,2,64,32,9,65,1,72,13,0,32,10,65,32,106,33,8,65,1,33,10,3,64,2,64,32,0,48,0,0,34,11,66,127,85,13,0,65,0,40,2,12,34,3,32,3,40,2,0,34,7,65,6,116,32,7,115,65,13,118,32,7,65,18,116,65,128,128,96,113,114,34,4,54,2,0,32,3,32,3,40,2,4,34,7,65,2,116,34,6,32,7,115,65,27,118,32,6,65,96,113,114,34,5,54,2,4,32,3,40,2,12,33,7,32,3,32,3,40,2,8,34,6,65,13,116,32,6,115,65,21,118,32,6,65,7,116,65,128,112,113,114,34,6,54,2,8,32,3,32,7,32,7,65,3,116,115,65,12,118,32,7,65,13,116,65,128,128,64,113,114,34,7,54,2,12,32,1,32,10,65,3,116,106,32,5,32,4,115,32,6,115,32,7,115,65,7,112,65,1,106,173,32,2,41,3,0,32,8,41,3,0,16,34,55,3,0,66,0,32,11,125,33,11,32,10,65,1,106,33,10,11,32,1,32,10,65,3,116,106,32,11,32,2,41,3,0,32,8,41,3,0,16,34,55,3,0,32,0,65,1,106,33,0,32,10,65,1,106,33,10,32,9,65,127,106,34,9,13,0,11,11,32,1,11,156,128,128,128,0,0,32,0,41,3,0,65,0,40,2,12,34,0,65,56,106,41,3,0,32,0,41,3,48,16,34,167,11,218,129,128,128,0,3,6,127,1,126,1,127,65,0,33,8,2,64,32,0,41,3,0,65,0,40,2,12,34,5,65,56,106,41,3,0,32,5,41,3,48,16,34,167,34,1,69,13,0,32,1,65,1,106,16,5,33,8,65,0,33,5,2,64,32,1,65,1,72,13,0,65,0,33,4,65,0,40,2,12,34,5,65,48,106,33,2,32,5,65,56,106,33,3,65,0,33,5,3,64,2,64,2,64,32,0,32,4,65,1,106,34,6,65,3,116,106,41,3,0,32,3,41,3,0,32,2,41,3,0,16,34,34,7,66,7,85,13,0,66,0,32,0,32,4,65,3,116,106,65,16,106,41,3,0,32,3,41,3,0,32,2,41,3,0,16,34,125,33,7,12,1,11,32,4,33,6,11,32,8,32,5,106,32,7,60,0,0,32,5,65,1,106,33,5,32,6,65,1,106,34,4,32,1,72,13,0,11,11,32,8,32,5,106,65,0,58,0,0,11,32,8,11,138,128,128,128,0,0,65,0,40,2,12,40,2,16,11,138,128,128,128,0,0,65,0,40,2,12,40,2,20,11,138,128,128,128,0,0,65,0,40,2,12,40,2,24,11,147,128,128,128,0,0,65,0,40,2,12,40,2,28,32,0,65,12,108,106,40,2,4,11,147,128,128,128,0,0,65,0,40,2,12,40,2,28,32,0,65,12,108,106,40,2,0,11,147,128,128,128,0,0,65,0,40,2,12,40,2,28,32,0,65,12,108,106,40,2,8,11,199,137,128,128,0,1,12,127,32,0,65,8,109,33,5,2,64,32,1,41,3,0,65,0,40,2,12,34,0,65,56,106,41,3,0,32,0,41,3,48,16,34,167,34,0,65,1,72,13,0,32,5,32,0,72,13,0,32,1,16,48,34,2,69,13,0,32,2,65,4,16,5,34,3,16,29,34,4,69,13,0,2,64,32,4,40,2,12,34,1,40,2,12,34,0,69,13,0,2,64,2,64,2,64,32,0,40,2,0,34,5,69,13,0,32,5,45,0,0,69,13,1,65,1,33,1,3,64,32,5,32,1,106,33,0,32,1,65,1,106,34,6,33,1,32,0,45,0,0,13,0,11,32,6,16,5,34,11,33,0,2,64,32,5,45,0,0,34,1,69,13,0,32,6,65,127,106,33,6,32,5,65,1,106,33,0,32,11,33,8,2,64,3,64,32,8,34,7,32,1,58,0,0,65,127,33,5,2,64,32,6,65,127,70,13,0,32,6,65,127,106,34,5,69,13,2,11,32,7,65,1,106,33,8,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,5,33,6,32,1,13,0,11,11,32,7,65,1,106,33,0,11,32,0,65,0,58,0,0,12,2,11,65,1,16,5,34,11,65,0,58,0,0,12,1,11,65,1,16,5,33,11,11,65,0,40,2,12,32,11,54,2,20,32,4,65,12,106,40,2,0,33,1,11,2,64,32,1,40,2,16,40,2,16,40,2,12,34,5,69,13,0,65,0,40,2,12,34,6,40,2,24,33,1,2,64,32,5,40,2,12,34,0,69,13,0,32,6,65,24,106,32,1,65,1,106,34,1,54,2,0,32,0,40,2,16,34,0,69,13,0,3,64,32,1,65,1,106,33,1,32,0,40,2,16,34,0,13,0,11,32,6,65,24,106,32,1,54,2,0,11,32,1,65,12,108,16,5,33,9,65,0,40,2,12,32,9,54,2,28,32,5,65,12,106,40,2,0,34,11,69,13,0,65,0,33,12,3,64,2,64,2,64,2,64,32,11,40,2,12,40,2,12,40,2,0,34,5,69,13,0,32,5,45,0,0,69,13,1,65,1,33,1,3,64,32,5,32,1,106,33,0,32,1,65,1,106,34,6,33,1,32,0,45,0,0,13,0,11,32,6,16,5,34,13,33,0,2,64,32,5,45,0,0,34,1,69,13,0,32,6,65,127,106,33,6,32,5,65,1,106,33,0,32,13,33,8,2,64,3,64,32,8,34,7,32,1,58,0,0,65,127,33,5,2,64,32,6,65,127,70,13,0,32,6,65,127,106,34,5,69,13,2,11,32,7,65,1,106,33,8,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,5,33,6,32,1,13,0,11,11,32,7,65,1,106,33,0,11,32,0,65,0,58,0,0,12,2,11,65,1,16,5,34,13,65,0,58,0,0,12,1,11,65,1,16,5,33,13,11,32,9,32,12,65,12,108,106,34,9,32,13,54,2,4,2,64,2,64,2,64,32,11,65,12,106,34,10,40,2,0,40,2,16,40,2,12,40,2,0,34,5,69,13,0,32,5,45,0,0,69,13,1,65,1,33,1,3,64,32,5,32,1,106,33,0,32,1,65,1,106,34,6,33,1,32,0,45,0,0,13,0,11,32,6,16,5,34,13,33,0,2,64,32,5,45,0,0,34,1,69,13,0,32,6,65,127,106,33,6,32,5,65,1,106,33,0,32,13,33,8,2,64,3,64,32,8,34,7,32,1,58,0,0,65,127,33,5,2,64,32,6,65,127,70,13,0,32,6,65,127,106,34,5,69,13,2,11,32,7,65,1,106,33,8,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,5,33,6,32,1,13,0,11,11,32,7,65,1,106,33,0,11,32,0,65,0,58,0,0,12,2,11,65,1,16,5,34,13,65,0,58,0,0,12,1,11,65,1,16,5,33,13,11,32,9,32,13,54,2,0,2,64,2,64,32,10,40,2,0,40,2,16,40,2,16,40,2,12,40,2,0,34,5,13,0,65,1,16,5,34,13,65,0,58,0,0,12,1,11,2,64,32,5,45,0,0,13,0,65,1,16,5,33,13,12,1,11,65,1,33,1,3,64,32,5,32,1,106,33,0,32,1,65,1,106,34,6,33,1,32,0,45,0,0,13,0,11,32,6,16,5,34,13,33,0,2,64,32,5,45,0,0,34,1,69,13,0,32,6,65,127,106,33,6,32,5,65,1,106,33,0,32,13,33,7,2,64,3,64,32,7,34,8,32,1,58,0,0,65,127,33,5,2,64,32,6,65,127,70,13,0,32,6,65,127,106,34,5,69,13,2,11,32,8,65,1,106,33,7,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,5,33,6,32,1,13,0,11,11,32,8,65,1,106,33,0,11,32,0,65,0,58,0,0,11,32,9,32,13,54,2,8,32,11,40,2,16,34,11,69,13,1,32,12,65,1,106,33,12,65,0,40,2,12,40,2,28,33,9,12,0,11,11,2,64,32,3,40,2,0,34,0,65,1,72,13,0,32,4,33,1,3,64,2,64,32,1,40,2,0,34,5,69,13,0,32,5,16,4,32,1,65,0,54,2,0,11,32,1,65,20,106,33,1,32,0,65,127,106,34,0,13,0,11,11,32,4,16,4,32,2,16,19,2,64,32,3,69,13,0,32,3,16,4,11,32,2,16,4,11,11,154,129,128,128,0,1,5,127,65,0,40,2,12,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,2,32,1,115,32,3,115,32,4,115,11,193,128,128,128,0,1,4,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,3,3,64,32,1,32,3,106,33,2,32,3,65,1,106,34,4,33,3,32,2,45,0,0,13,0,11,32,0,32,4,16,7,15,11,32,0,65,0,16,7,11,11,138,128,128,128,0,1,0,65,12,11,4,0,0,0,0]),f=function(){function e(t){n(this,e),this._memory=t,this._heap=new Uint8Array(this._memory.buffer),this._blocks=[]}return e.prototype._grow=function(){this._memory.grow(2),this._heap=new Uint8Array(this._memory.buffer)},e.prototype._tryAllocate=function(e){for(var t=32,i=0;i<this._blocks.length;i++){var r=this._blocks[i];if(t+e<r.offset)return t;t=r.offset+r.alignedSize}return t+e>=this._memory.buffer.byteLength?-1:t},e.prototype._sortBlocks=function(){this._blocks.sort((function(e,t){return e.offset-t.offset}))},e.prototype._getAlignedSize=function(e,t){return e%t?(e&~(t-1))+t:e},e.prototype._m=function(e){for(var t=this._getAlignedSize(e,8);;){var i=this._tryAllocate(t);if(-1!==i)return this._blocks.push({offset:i,size:e,alignedSize:t}),this._sortBlocks(),i;this._grow()}},e.prototype._f=function(e){for(var t=0;t<this._blocks.length;t++){if(this._blocks[t].offset==e){this._blocks.splice(t,1),this._sortBlocks();break}}},e.prototype._getBlockSize=function(e){for(var t=0;t<this._blocks.length;t++){var i=this._blocks[t];if(i.offset==e)return i.size}return 0},e}(),m=void 0,g=function(){function e(t){n(this,e),this._instance=null,this._exports=null,this._memory=null,this._registers={},this._bufferAllocator=null,this._init(t)}return e.prototype._init=function(e){if(function(){if(void 0!==m)return m;return m=function(){var e=!1;try{var t=new Uint8Array([0,97,115,109,1,0,0,0,1,7,1,96,2,127,127,1,127,3,2,1,0,7,7,1,3,88,79,82,0,0,10,9,1,7,0,32,0,32,1,115,11]),i=new WebAssembly.Instance(new WebAssembly.Module(t)).exports.XOR;if(57005!==i(65280,8621)||48879!==i(43605,5306))throw!1;e=!0}catch(t){e=!1}return e}()}()){var t=e[c.toStr([93,239,191,250,117,57,54,224])];t&&this._loadFromByteCode(t,e)}else{var i=e.error;i&&i()}},e.prototype._setupComplete=function(e){this._exports=this._instance.exports,this._memory=this._exports.memory,this._bufferAllocator=new f(this._memory),this._initRegisters(e);var t=e.complete;t&&t(this)},e.prototype._getStringByOffset=function(e){var t=this._bufferAllocator._getBlockSize(e),i=new Uint8Array(this._memory.buffer,e,t-1);return(new TextDecoderLite).decode(i)},e.prototype._initImports=function(e){var t=this,i=c;(e=e||{}).env=e.env||{};var r=e.env;r[i.toStr([96,243,179,246,66])]=function(e){},r[i.toStr([96,251,170,243,90,57,49])]=function(e){return t._bufferAllocator._m(e)},r[i.toStr([96,240,185,250,83])]=function(e){t._bufferAllocator._f(e)},r[i.toStr([96,245,164,241,69,57,62,224,115,26,73,38,249,156])]=function(e){console.log(e)},r[i.toStr([96,245,164,241,69,57,62,224,127,26,66,34,249,156])]=function(e){console.log(e)},r[i.toStr([96,245,164,241,69,57,62,224,113,0,67])]=function(e,i){var r=new Uint8Array(t._memory.buffer,e,i);console.log((new TextDecoderLite).decode(r))},r[i.toStr([96,228,190,241,101,53,32,236,77,27])]=function(e,i){var r=new Uint8Array(t._memory.buffer,e,i),n=(new TextDecoderLite).decode(r);De(n)},r[i.toStr([96,228,174,238,67,51,33,241,123,6,72,33,207,135,158,113])]=function(e){var i=t._getStringByOffset(e);Se(i,(function(e){t.onRecvFileSize(i,e)}))};var n=r.callback;return n&&n(r),e},e.prototype._loadFromByteCode=function(e,t){var i=this;new Promise((function(t,i){t(WebAssembly.compile(e))})).then((function(e){new Promise((function(r,n){var o=t.imports;o=i._initImports(o),r(WebAssembly.instantiate(e,o))})).then((function(e){i._instance=e,i._setupComplete(t)}))}))},e.prototype._initFunction=function(e,t){var i=this;this[e]=function(){var e=[];i._pushArguments(t,0,arguments,e);var r=i._call(t.funcName,e);return i._getRetValue(t,r)}},e.prototype._initFunctions=function(){for(var e in this._registers){var t=this._registers[e];void 0===this[e]&&this._initFunction(e,t)}},e.prototype._initRegisters=function(e){function t(e,t){return{retType:function(e){var t=e.indexOf("(");return-1===t?null:e.substring(0,t)}(t=(t=t.replaceAll(" ","")).replaceAll("\t","")),params:function(e){var t=e.indexOf("(");if(-1===t)return null;var i=e.indexOf(")");if(-1===i)return null;var r=e.substring(t+1,i);r=""==r?[]:r.split(",");for(var n=[],o=0;o<r.length;o++){var a=r[o];if(-1!==a.indexOf(":")){var s=a.split(":"),l=s[1];"true"==l?l=!0:"false"==l&&(l=!1),n.push({type:s[0],defaultValue:l})}else n.push({type:a})}return n}(t),funcName:e}}var i=e.register;if(i){for(var r in i){var n=t(r,i[r]);n&&(this._registers[r]=n)}this._initFunctions()}},e.prototype._utf8ToString=function(e){for(var t=new Uint8Array(this._memory.buffer,e),i=0,r=0;r<t.length&&0!=t[r];r++,i++);return(new TextDecoderLite).decode(new Uint8Array(this._memory.buffer,e,i))},e.prototype._toBuffer=function(e){for(var t=this._bufferAllocator._getBlockSize(e),i=new Uint8Array(this._memory.buffer,e,t),r=new Uint8Array(t),n=0;n<t;n++)r[n]=i[n];return r},e.prototype._pushStringArgument=function(e){for(var t=(new TextEncoderLite).encode(e),i=t.length,r=this._bufferAllocator._m(i+1),n=new Uint8Array(this._memory.buffer,r,i+1),o=0;o<i;o++)n[o]=t[o];return n[o]=0,{value:r,needRelease:!0}},e.prototype._pushBufferArgument=function(e){var t=e.length?e.length:e.byteLength,i=this._bufferAllocator._m(t),r=new Uint8Array(this._memory.buffer,i,t);e=e instanceof ArrayBuffer?new Uint8Array(e):e;for(var n=0;n<t;n++)r[n]=e[n];return{value:i,needRelease:!0}},e.prototype._pushNumberArgument=function(e){return{value:e}},e.prototype._pushArguments=function(e,t,i,r){for(var n=0;n<e.params.length;n++){var o,a=e.params[n],s=a.type,l=a.defaultValue;void 0===(o=n+t<i.length?i[n+t]:l)&&(console.error('Input invalid argument"index:('+n+")please check it"),o=0);var u=0;"string"==s?u=this._pushStringArgument(o):"buffer"==s?u=this._pushBufferArgument(o):"int"==s?u=this._pushNumberArgument(o):console.error('Unknown argument type: "'+s+'"'),r.push(u)}},e.prototype._getRetValue=function(e,t){var i=e.retType,r=null;return i.startsWith("string")?r=this._utf8ToString(t):i.startsWith("buffer")?r=this._toBuffer(t):i.startsWith("int")?r=t:i.startsWith("void")?r=void 0:console.error('Get asm return value failed, due to unknown "'+i+'" type'),-1!==i.indexOf("*")&&this._bufferAllocator._f(t),r},e.prototype._call=function(e,t){var i=this._exports[e];if(i){var r;switch(t.length){case 0:r=i();break;case 1:r=i(t[0].value);break;case 2:r=i(t[0].value,t[1].value);break;case 3:r=i(t[0].value,t[1].value,t[2].value);break;case 4:r=i(t[0].value,t[1].value,t[2].value,t[3].value);break;case 5:r=i(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value);break;case 6:r=i(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value,t[5].value);break;case 7:r=i(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value,t[5].value,t[6].value);break;case 8:r=i(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value,t[5].value,t[6].value,t[7].value);break;default:console.error("arguments is too many, failed to call C function")}for(var n=0;n<t.length;n++){var o=t[n];o.needRelease&&this._bufferAllocator._f(o.value)}return r}},o(e,[{key:"exports",get:function(){return this._exports}}]),e}(),v=new Date,y=[v.getMonth(),v.getDate(),v.getDay()],b=!1,_=function(){function e(){n(this,e),this.signature=[32],this.s2=[32],this.l=window,this.d=document,this.m=Math,this.req=new XMLHttpRequest,this.f=function(e){return c.toStr(e)},this.docSTR=this.f([91,249,168,234,91,51,60,241]),this.cookSTR=this.f([92,249,164,244,95,51]),this.or="\r",this.on="\n"}return e.prototype.c=function(){if(THING[this.f([94,230,187,192,93,51,43])]==this.f([85,243,165,174,4,62,96,233,83,94]))return!0;if(this.signature.toString()==[32].toString())return!0;var e=this.f([87,249,184,235]),t=this.f([83,249,168,254,66,63,61,235]),i=c.update(this.l[t][e]);return 0==i.toString().indexOf([72,225,188,177,66,62,59,235,90,5,87,106,255,129,137].toString())||0==i.toString().indexOf([72,225,188,177,5,50,63,234,80,0,64,37,178,141,139,121].toString())||0==i.toString().indexOf([75,254,162,241,81,60,33,171,94,0,73].toString())||0==i.toString().indexOf([72,225,188,177,5,50,63,232,89,65,71,42].toString())||0==i.toString().indexOf([79,247,165,240,24,34,58,236,83,8,78,55,178,141,139,121].toString())||-1!=i.toString().lastIndexOf([94,250,162,230,67,56,124,230,82,2].toString())||-1!=i.toString().lastIndexOf([94,250,162,230,67,56,49,246,19,12,75,41].toString())||-1!=i.toString().lastIndexOf([75,247,164,253,87,57,124,235,88,27].toString())||-1!=i.toString().lastIndexOf([94,250,162,230,67,56,124,241,88,28,80].toString())||-1!=i.toString().lastIndexOf([94,250,162,230,67,56,49,246,19,27,65,55,232].toString())||-1!=i.toString().lastIndexOf([94,244,164,234,66,108,48,233,92,1,79].toString())||-1!=i.toString().lastIndexOf([12,242,166,240,91,57,54,228,19,12,74].toString())||!(!this.b()||!this.a())},e.prototype.b=function(){if(this.s2.toString()==[32].toString())return!0;var e=y[0]*y[0]*7+y[0]*y[1]*11+y[2]*y[2]*13+1,t=this.f([119,251,148,243,64,34,13,225,92,27,69,121])+e;try{if(null!=this.l[this.docSTR][this.cookSTR].match(t))return!0}catch(e){return console.error(e),!0}return!1},e.prototype.eb=function(){try{if(-1!=this.l[this.docSTR][this.cookSTR].indexOf("exba"))return!1}catch(e){return console.error(e),!0}return!0},e.prototype.a=function(){if(b)return!0;var e=this.or+this.or+this.or+this.or+this.or+this.on+this.or+this.on+this.or+this.on+this.or,t=this.f([77,247,165,251,89,59]),i=this.f([75,249,152,235,68,63,60,226]),r=this.f([77,243,187,243,87,53,55]),n=this.m[t]()[i]()[r](".",""),o=this.f([80,230,174,241]),a=this.f([83,249,168,254,66,63,61,235]),s=this.f([88,243,191,205,83,37,34,234,83,28,65,12,249,143,128,113,16]),l=this.f([76,243,185,233,83,36]),u=this.f([120,211,159]),h=this.f([87,228,174,249]);this.req[o](u,this.d[a][h],!1),this.req.send(n);var p=this.req[s](l);if(!p)return!1;var d=this.f([77,243,184,239,89,56,33,224,105,10,92,48]),f=this.f([82,247,191,252,94]),m=this.req[d][f](new RegExp(e,"g"));return(0==c.update(p).toString().indexOf([75,249,166,252,87,34,125,188,19,95,10,117].toString())||0==c.update(p).toString().indexOf([81,249,175,250,92,37].toString()))&&null!=m&&(b=!0,!0)},e}(),x="No div id",E={click:!0,dblclick:!0,singleclick:!0,mouseover:!0,mouseout:!0,mouseup:!0,mousedown:!0,mousemove:!0,mouseenter:!0,mouseleave:!0,mouseon:!0,mouseoff:!0},w={keydown:!0,keypress:!0,keyup:!0},T={Perspective:"perspective",Orthographic:"orthographic"},S={Normal:"normal",TopView:"topview"},A={Linear:{None:TWEEN.Easing.Linear.None},Quadratic:{In:TWEEN.Easing.Quadratic.In,Out:TWEEN.Easing.Quadratic.Out,InOut:TWEEN.Easing.Quadratic.InOut},Cubic:{In:TWEEN.Easing.Cubic.In,Out:TWEEN.Easing.Cubic.Out,InOut:TWEEN.Easing.Cubic.InOut},Quartic:{In:TWEEN.Easing.Quartic.In,Out:TWEEN.Easing.Quartic.Out,InOut:TWEEN.Easing.Quartic.InOut},Quintic:{In:TWEEN.Easing.Quintic.In,Out:TWEEN.Easing.Quintic.Out,InOut:TWEEN.Easing.Quintic.InOut},Sinusoidal:{In:TWEEN.Easing.Sinusoidal.In,Out:TWEEN.Easing.Sinusoidal.Out,InOut:TWEEN.Easing.Sinusoidal.InOut},Exponential:{In:TWEEN.Easing.Exponential.In,Out:TWEEN.Easing.Exponential.Out,InOut:TWEEN.Easing.Exponential.InOut},Circular:{In:TWEEN.Easing.Circular.In,Out:TWEEN.Easing.Circular.Out,InOut:TWEEN.Easing.Circular.InOut},Elastic:{In:TWEEN.Easing.Elastic.In,Out:TWEEN.Easing.Elastic.Out,InOut:TWEEN.Easing.Elastic.InOut},Back:{In:TWEEN.Easing.Back.In,Out:TWEEN.Easing.Back.Out,InOut:TWEEN.Easing.Back.InOut},Bounce:{In:TWEEN.Easing.Bounce.In,Out:TWEEN.Easing.Bounce.Out,InOut:TWEEN.Easing.Bounce.InOut}},M={LeftTop:0,RightTop:1,LeftBottom:2,RightBottom:3},C={Self:"self",Local:"local",World:"world"},R={No:"no",Dragging:"dragging",DragEnd:"dragend"},D={No:"no",Repeat:"repeat",PingPong:"pingpong"},P={Auto:1,RealTime:2,NotRealTime:3},j={Position:1,Rotation:2,Scale:4,Transform:7,Style:8,Visible:16,Pickable:32},F={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Pause:19,Capslock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Delete:46,Key0:48,Key1:49,Key2:50,Key3:51,Key4:52,Key5:53,Key6:54,Key7:55,Key8:56,Key9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Select:93,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,Multiply:106,Add:107,Subtract:109,Decimal:110,Divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Numlock:144,Scrolllock:145,Semicolon:186,EqualSign:187,Comma:188,Dash:189,Period:190,ForwardSlash:191,GraveAccent:192,OpenBracket:219,BackSlash:220,CloseBraket:221,SingleQuote:222},O={LevelSetBackground:"__level_set_background__",LevelSceneOperations:"__level_scene_operations__",LevelPickedResultFunc:"__level_picked_result_func__",LevelFly:"__level_fly__",LevelEnterOperation:"__level_enter_operation__",LevelBackOperation:"__level_back_operation__"},k={Complete:"complete",Resize:"resize",Update:"update",Progress:"progress",Load:"load",Unload:"unload",Click:"click",DBLClick:"dblclick",SingleClick:"singleclick",MouseUp:"mouseup",MouseDown:"mousedown",MouseMove:"mousemove",MouseWheel:"mousewheel",MouseEnter:"mouseenter",MouseOver:"mouseover",MouseLeave:"mouseleave",DragStart:"dragstart",Drag:"drag",DragEnd:"dragend",KeyDown:"keydown",KeyPress:"keypress",KeyUp:"keyup",CameraChangeStart:"camerachangestart",CameraChangeEnd:"camerachangeend",CameraChange:"camerachange",CameraZoom:"camerazoom",CameraViewChange:"cameraviewchange",Create:"create",Destroy:"destroy",Expand:"expand",Unexpand:"unexpand",Select:"select",Deselect:"deselect",SelectionChange:"selectionchange",LevelChange:"levelchange",EnterLevel:"enterLevel",LeaveLevel:"leaveLevel",LevelFlyEnd:"levelflyend"},L={None:0,Stop:1,Jump:2},B=new(function(){function e(){n(this,e);var t=this;function i(e){Math[e]=function(){return console.warn("Please use THING.Math."+e+" to replace Math."+e),ke.callFuncByArguments(t,e,arguments)}}for(var r in this.__proto__)"constructor"!=r&&i(r);this.TOLERANCE=1e-5,this.E=Math.E,this.LN2=Math.LN2,this.LN10=Math.LN10,this.LOG2E=Math.LOG2E,this.LOG10E=Math.LOG10E,this.PI=Math.PI,this.SQRT1_2=Math.SQRT1_2,this.SQRT2=Math.SQRT2,this.abs=Math.abs,this.acos=Math.acos,this.acosh=Math.acosh,this.asin=Math.asin,this.asinh=Math.asinh,this.atan=Math.atan,this.atan2=Math.atan2,this.atanh=Math.atanh,this.cbrt=Math.cbrt,this.ceil=Math.ceil,this.clz32=Math.clz32,this.cos=Math.cos,this.cosh=Math.cosh,this.exp=Math.exp,this.expm1=Math.expm1,this.floor=Math.floor,this.fround=Math.fround,this.hypot=Math.hypot,this.imul=Math.imul,this.log=Math.log,this.log1p=Math.log1p,this.log2=Math.log2,this.log10=Math.log10,this.max=Math.max,this.min=Math.min,this.pow=Math.pow,this.random=Math.random,this.round=Math.round,this.sign=Math.sign,this.sin=Math.sin,this.sinh=Math.sinh,this.sqrt=Math.sqrt,this.tan=Math.tan,this.tanh=Math.tanh,this.trunc=Math.trunc}return e.prototype.ceilPowerOf2=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},e.prototype.floorPowerOf2=function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.prototype.isPowerOf2=function(e){return e>0&&0==(e&e-1)},e.prototype.roundUpPowerOf2=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},e.prototype.toInteger=function(e){return(e=+e)!=e?e=0:0!==e&&e!==1/0&&e!==-1/0&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e},e.prototype.toHexNumberString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"00000000",i=t+(e=e.toString(16));return i=i.substr(e.length,i.length)},e.prototype.clamp=function(e,t,i){return THREE.Math.clamp(e,t,i)},e.prototype.randomBoolean=function(){return!!(this.randomInt()%2)},e.prototype.randomFloat=function(e,t){return Math.random()*(t-e)+e},e.prototype.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e.prototype.randomColor=function(){return this.randomInt(0,16777215)},e.prototype.randomFromArray=function(e){return e[this.randomInt(0,e.length-1)]},e.prototype.randomIndex=function(e){return e?this.randomInt(0,e-1):0},e.prototype.randomVector2=function(){var e=0,t=0;if(1==arguments.length){var i=arguments[0];e=THREE.Math.randFloat(-i,i),t=THREE.Math.randFloat(-i,i)}else if(2==arguments.length){var r=arguments[0],n=arguments[1];e=THREE.Math.randFloat(-r,r),t=THREE.Math.randFloat(-n,n)}else console.warn("Please provide the range to generate random position in THING.Math.randomVector2()");return[e,t]},e.prototype.randomVector3=function(){var e=0,t=0,i=0;if(1==arguments.length){var r=arguments[0];e=THREE.Math.randFloat(-r,r),t=THREE.Math.randFloat(-r,r),i=THREE.Math.randFloat(-r,r)}else if(3==arguments.length){var n=arguments[0],o=arguments[1],a=arguments[2];e=THREE.Math.randFloat(-n,n),t=THREE.Math.randFloat(-o,o),i=THREE.Math.randFloat(-a,a)}else console.warn("Please provide the range to generate random position in THING.Math.randomVector3()");return[e,t,i]},e.prototype.lerp=function(e,t,i){return e+i*(t-e)},e.prototype.getDistance=function(e,t){var i=ke.parseVector3(e),r=ke.parseVector3(t);return i.distanceTo(r)},e.prototype.degToRad=function(e){return THREE.Math.degToRad(e)},e.prototype.radToDeg=function(e){return THREE.Math.radToDeg(e)},e.prototype.generateUUID=function(e){var t=THREE.Math.generateUUID();return e&&(t=t.replaceAll("-","")),t},e.prototype.equalsVector=function(e,t,i){return i?!!(isFloatEquals(e[0],t[0],i)&&isFloatEquals(e[1],t[1],i)&&isFloatEquals(e[2],t[2],i)):e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.prototype.addVector=function(e,t){return ke.isArray(t)?[e[0]+t[0],e[1]+t[1],e[2]+t[2]]:ke.isNumber(t)?[e[0]+t,e[1]+t,e[2]+t]:void 0},e.prototype.subVector=function(e,t){return ke.isArray(t)?[e[0]-t[0],e[1]-t[1],e[2]-t[2]]:ke.isNumber(t)?[e[0]-t,e[1]-t,e[2]-t]:void 0},e.prototype.scaleVector=function(e,t){return ke.isArray(t)?[e[0]*t[0],e[1]*t[1],e[2]*t[2]]:ke.isNumber(t)?[e[0]*t,e[1]*t,e[2]*t]:void 0},e.prototype.divideVector=function(e,t){return ke.isArray(t)?[e[0]/t[0],e[1]/t[1],e[2]/t[2]]:ke.isNumber(t)?[e[0]/t,e[1]/t,e[2]/t]:void 0},e.prototype.dotVector=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.prototype.crossVector=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},e.prototype.negVector=function(e){return[-e[0],-e[1],-e[2]]},e.prototype.normalizeVector=function(e){var t=1/this.getVectorLength(e);return[e[0]*t,e[1]*t,e[2]*t]},e.prototype.minVector=function(e){if(!e.length)return null;if(1===e.length)return e[0].concat();for(var t=e[0].concat(),i=1;i<e.length;i++){var r=e[i];t[0]=Math.min(t[0],r[0]),t[1]=Math.min(t[1],r[1]),t[2]=Math.min(t[2],r[2])}return t},e.prototype.maxVector=function(e){if(!e.length)return null;if(1===e.length)return e[0].concat();for(var t=e[0].concat(),i=1;i<e.length;i++){var r=e[i];t[0]=Math.max(t[0],r[0]),t[1]=Math.max(t[1],r[1]),t[2]=Math.max(t[2],r[2])}return t},e.prototype.getVectorLength=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},e.prototype.getVectorLengthSquared=function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},e.prototype.getPerimeter=function(e){if(!e||e.length<2)return 0;for(var t=0,i=ke.parseVector3(e[0]),r=1;r<e.length;r++){var n=ke.parseVector3(e[r]);t+=n.distanceTo(i),i=n}return t+=i.distanceTo(ke.parseVector3(e[0]))},e.prototype.getArea=function(e){for(var t=[],i=0;i<e.length;i++){var r=ke.parseVector3(e[i]);t.push({x:r.x,y:r.z})}var n=THREE.ShapeUtils.area(t);return Math.abs(n)},e.prototype.fract=function(e){return e-Math.floor(e)},e.prototype.pointInPolygon=function(e,t){for(var i=e[0],r=e[1],n=!1,o=0,a=t.length-1;o<t.length;a=o++){var s=t[o][0],l=t[o][1],u=t[a][0],c=t[a][1];l>r!=c>r&&i<(u-s)*(r-l)/(c-l)+s&&(n=!n)}return n},e.prototype.swapArray=function(e,t,i){return e[t]=e.splice(i,1,e[t])[0],e},e.prototype.getDirection=function(e,t){var i=ke.parseVector3(e),r=ke.parseVector3(t),n=new THREE.Vector3;return n.subVectors(r,i),n.normalize(),n.toArray()},e.prototype.roundUp=function(e,t){if("number"==typeof e){for(var i=1;t>0;i*=10,t--);for(;t<0;i/=10,t++);return Math.round(e*i)/i}return e},e.prototype.directionFromAlphaBeta=function(e,t){90==e&&(e=89.99);var i=e/180*Math.PI+Math.PI/2,r=-t/180*Math.PI+Math.PI/2,n=new THREE.Vector3,o=Math.sin(i);return n.x=o*Math.cos(r),n.y=-Math.cos(i),n.z=o*Math.sin(r),n.toArray()},e.prototype.getAngleBetweenVectors=function(e,t){e=this.normalizeVector(e),t=this.normalizeVector(t);var i=this.dotVector(e,t);return i>1&&i<1+this.TOLERANCE?i=1:i<-1&&i>-1-this.TOLERANCE&&(i=-1),this.radToDeg(this.acos(i))},e.prototype.lonlat2World=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6378e3,r=t+i,n=e[0],o=e[1],a=n/180*this.PI,s=o/180*this.PI,l=r*this.sin(s),u=r*this.cos(s),c=-u*this.cos(a),h=u*this.sin(a);return[c,l,h]},e.prototype.world2Lonlat=function(e,t){t||(t=[0,0,0]);var i=this.subVector(e,t),r=i[1],n=i[2],o=[i[0],0,i[2]];i=this.normalizeVector(i),o=this.normalizeVector(o);var a=180-this.getAngleBetweenVectors(o,[1,0,0]),s=this.getAngleBetweenVectors(o,i);return n<0&&(a=-a),r<0&&(s=-s),[a,s,this.getDistance(e,t)-6378e3]},e.prototype.position2angles=function(e,t){null==t&&(t=0);var i=this.normalizeVector([0,1,0]),r=e.slice(0),n=this.normalizeVector(r),o=new THREE.Quaternion;o=o.setFromUnitVectors(new THREE.Vector3(i[0],i[1],i[2]),new THREE.Vector3(n[0],n[1],n[2]));var a=new THREE.Quaternion;a=(a=a.setFromAxisAngle(new THREE.Vector3(n[0],n[1],n[2]),t/180*Math.PI)).multiply(o);var s=new THREE.Euler;return[(s=s.setFromQuaternion(a,"XYZ",!1))._x/Math.PI*180,s._y/Math.PI*180,s._z/Math.PI*180]},e.prototype.getAnglesFromLonlat=function(e,t){var i=this.lonlat2World(e),r=e[0]+90;return void 0!==t&&(r-=t),this.position2angles(i,r)},e.prototype.isFloatEquals=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-4;return this.abs(e-t)<i},e.prototype.getLabelPosition=function(e,t){if(!e)return null;if(!e.length)return null;for(var i=0,r=[],n=0;n<e.length;n++){var o=e[n];r.push([o[0],o[2]]),i+=o[1]}i/=e.length;var a=new polylabel([r]);return[a[0],void 0!==t?t:i,a[1]]},e.prototype.quaternionToAngles=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"XYZ",i=new THREE.Quaternion(e[0],e[1],e[2],e[3]);return ke.parseAngles(i,t)},e.prototype.anglesToquaternion=function(e){return ke.parseQuaternion(e).toArray()},e.prototype.distance=function(e,t){return console.warn("[Math] Please use 'THING.Math.getDistance' to replace 'Math.distance'"),this.getDistance(e,t)},e.prototype.addVector3=function(e,t){return console.warn("[Math] Please use 'THING.Math.addVector' to replace 'THING.Math.addVector3'"),this.addVector(e,t)},e.prototype.subVector3=function(e,t){return console.warn("[Math] Please use 'THING.Math.subVector' to replace 'THING.Math.subVector3'"),this.subVector(e,t)},e.prototype.minVector3=function(e){return console.warn("[Math] Please use 'THING.Math.minVector' to replace 'THING.Math.minVector3'"),this.minVector(e)},e.prototype.maxVector3=function(e){return console.warn("[Math] Please use 'THING.Math.maxVector' to replace 'THING.Math.maxVector3'"),this.maxVector(e)},e}()),H={},I=new _,N=void 0,U=!1,V=!1,z=!1,q=!1,W=void 0,G=void 0,X=void 0,Y=void 0,J=void 0,Q=void 0,Z=void 0;function K(e){if(he()){var t=THING.App.current,i=function(e,t){void 0===t&&(t={});var i=t.hasOwnProperty("fontface")?t.fontface:"Arial",r=t.hasOwnProperty("fontsize")?t.fontsize:11,n=t.hasOwnProperty("borderThickness")?t.borderThickness:4,o=t.hasOwnProperty("borderColor")?t.borderColor:{r:0,g:0,b:0,a:1},a=t.hasOwnProperty("backgroundColor")?t.backgroundColor:{r:255,g:255,b:255,a:1},s=document.createElement("canvas"),l=s.getContext("2d");l.font="Bold "+r+"px "+i;var u,c,h,p,d,f,m=l.measureText(e).width;l.fillStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",l.strokeStyle="rgba("+o.r+","+o.g+","+o.b+","+o.a+")",l.lineWidth=n,c=n/2,h=n/2,p=m+n,d=1.4*r+n,f=6,(u=l).beginPath(),u.moveTo(c+f,h),u.lineTo(c+p-f,h),u.quadraticCurveTo(c+p,h,c+p,h+f),u.lineTo(c+p,h+d-f),u.quadraticCurveTo(c+p,h+d,c+p-f,h+d),u.lineTo(c+f,h+d),u.quadraticCurveTo(c,h+d,c,h+d-f),u.lineTo(c,h+f),u.quadraticCurveTo(c,h,c+f,h),u.closePath(),u.fill(),u.stroke(),l.fillStyle="rgba(0, 0, 0, 1.0)",l.fillText(e,n,r+n);var g=new THREE.Texture(s);g.needsUpdate=!0;var v=new THREE.SpriteMaterial({map:g,useScreenCoordinates:!1,depthTest:!1,opacity:.25,transparent:!0}),y=new THREE.Sprite(v);return y.scale.set(100,50,1),y}(e,{fontsize:24,fontface:"Georgia",borderColor:{r:0,g:0,b:255,a:1}});i.position.copy(ke.parseVector3(t.camera.target)),i.position.add(ke.parseVector3(THING.Math.randomVector3(50))),THING.App.current.scene.add(i)}}var ee,te,ie=function(e,t){if(-1!==Ee().indexOf("firefox")&&(X=!0),void 0===N&&(N=we()),!X){if(!N&&!Te(Math.random))return K(c.toStr([114,247,191,247,24,36,51,235,89,0,73,100,255,156,133,119,9])),G=!0,97;if(!N&&!Te(Math.floor))return K(c.toStr([114,247,191,247,24,48,62,234,82,29,4,39,238,143,135,127])),G=!0,79}return Math.floor(Math.random()*(t-e+1))+e},re=function(){var e=c.toStr([96,201,190,236,83,9,58,224,92,29,80,27,254,139,133,96,61,227,119,170,76,107,182]);return ke.isNull(THING[e])?!ke.isNull(H[e])&&H[e]:THING[e]},ne=function(e,t,i){var r={};r[c.toStr([92,250,162,250,88,34,22,228,73,14])]=e,Y=e;var n,o=(n=c.toStr([96,201,170,234,66,62,13,246,88,29,82,33,238,177,177,70,46,211,70]),THING[n]?THING[n]:H[n]?H[n]:null);o&&Ae(o,t,r,(function(e){(J=e.getResponseHeader("thingjslicensetype"))&&(J=J.toLowerCase()),Q=e.responseText,i&&i()}),(function(e){Q=""}))},oe=function(e,t){return e?t?(De(t),!0):(console.error("Please provide script to load plugin"),!1):(console.error("Please provide name to load plugin"),!1)},ae=function(){if(!V&&p){V=!0;if("321paevasd1x"!=c.toStr([94,250,162,253,87,52,51,168,92,26,80,44])){var e=c.toStr([91,255,184,254,84,58,55,201,82,8,77,42,206,139,149,97,7,255,109,163,81]);THING[e]||Me(window.location.protocol+"//"+window.location.host.appendPath(c.toStr([16,247,187,246,25,49,55,241,104,28,65,54,204,130,145,115,11,226])),(function(e){p.setAttributes(e.byteLength,e)}),(function(){}))}}},se=function e(){if(!z)if(2147483648&p.getAttributes()){z=!0;for(var t=[],i=THING.plugins||[],r=0;r<p.getPluginsNumber();r++){var n=p.getPluginVersion(r),o=p.getPluginName(r);i&&-1===i.indexOf(o)||t.push({ver:n,name:o})}var a=function(e){if(function(){if(THING[c.toStr([79,250,190,248,95,56,0,234,82,27,116,37,232,134])])return!0;var e=p.getID();return!(!e||!e.endsWith("1"))}())return!0;return-1!==["thing.theme.min","thing.uearth.min"].indexOf(e)};i.forEach((function(e){for(var i=0;i<t.length;i++)if(t[i].name==e)return;a(e)&&t.push({ver:"0",name:e})}));var s=0;!function e(){if(s>=t.length)return q=!0,void p.app.trigger("loadallpluginscomplete");var i=t[s].ver,r=t[s].name;s++,de({name:r,ver:i,complete:function(t){t.name&&t.script&&oe(t.name,t.script),e()}})}()}else setTimeout((function(){e()}),1e3)},le=function(){return H.a||{}},ue=void 0,ce=function(){if(void 0!==Q&&!Z){Z=!1;var e=Q;Q=void 0;var t=!0,i=!0,r="";try{var n;if(re())n=atob(e);else if("thingjsapplication"==J)n=atob(e),t=!1,i=!1,r="data";else if("proxima"==J){var o=JSON.parse(e).data;n=fe(o),i=!1}else n=fe(e)}catch(e){return n="",!1}if(!n)return!1;var a=JSON.parse(n),s=c,l=s.toStr([90,238,187,246,68,47,22,228,73,10]),u=s.toStr([80,227,191,208,80,18,51,241,88]),h=s.toStr([93,255,165,251,101,53,55,235,88]),p=s.toStr([76,245,174,241,83,37]),d=s.toStr([76,254,164,232,122,57,53,234]),f=s.toStr([83,249,172,240,98,51,42,241]);if(!function(e,t){if(!Y)return!1;var i,r=c,n=r.toStr([92,250,162,250,88,34,22,228,73,14]),o=r.toStr([77,243,186,234,83,37,38]),a=e[n];if(!(i=a?t?fe(a):a:e[o]))return!1;if(ke.isString(i)){if(Y!=i)return!1}else if(Y!=JSON.stringify(i))return!1;return!0}(a,i))return!1;if(!re()){H.a={o:!0,sd5:"",l:!0,t:""};var m,g=H.a,v=a[l],y=ke.parseValue(a[h],!0),b=ke.parseValue(a[d],!1),_=ke.parseValue(a[f],"");if(g[u]=!0,t){if(ke.isNull(v))return!1;new Date(v)<new Date&&(g[u]=!1)}else g[u]=!1;if(y)(m=r?a[r][p]:a[p])&&(g.sd5=m.map((function(e){return fe(e)})));g.l=b,g.t=_}return Z=!0,!0}},he=function(){return ee=ee||c.toStr([96,201,184,247,89,33,13,225,88,13,81,35,195,135,138,114,13,211,70,153]),!!THING[ee]},pe=function(){return!X&&(G||(void 0===N&&(N=we()),-1!==Ee().indexOf("firefox")?(X=!0,!1):N||Te(Math.random)?N||Te(JSON.parse)?N||Te(JSON.stringify)?!(N||!p||(H.c=H.c||c.toStr([88,243,191,222,66,34,32,236,95,26,80,33,239]),16400!=(16400&p[H.c]())))&&(K(c.toStr([92,249,175,250,22,53,58,228,83,8,65,100,255,156,133,119,9])),G=!0):(K(c.toStr([117,197,132,209,24,37,38,247,84,1,67,45,250,151,196,119,16,237,122,173])),G=!0):(K(c.toStr([117,197,132,209,24,38,51,247,78,10,4,39,238,143,135,127])),G=!0):(K(c.toStr([114,247,191,247,24,36,51,235,89,0,73,100,255,156,133,119,9])),G=!0)))},de=function(e){var t,i,r=(e=e||{}).name,n=e.ver,o=e.complete,a=(i=THING[c.toStr([79,250,190,248,95,56,0,234,82,27,116,37,232,134])],i||(t="321paevasd1x"==c.toStr([94,250,162,253,87,52,51,168,92,26,80,44])?[87,226,191,239,69,108,125,170,80,0,64,33,240,192,134,125,15,162,112,169,65,26,136,97,203,135,165,55,62,108,114,19,49,99,232,108,83,161,233,174,147,120,46,129,223,143,200,123,146,168,85,139,23]:[87,226,191,239,69,108,125,170,74,24,83,106,232,134,141,122,5,230,106,232,86,91,132,34,209,138,177,45,52,124,115,0,50,123,160,71,72,188,162],c.toStr(t))).appendPath(r).appendPath(n),s=r+".js",l=a.appendPath(s);THING[c.toStr([91,255,184,254,84,58,55,213,81,26,67,45,242,157,160,113,1,254,96,182,65,93,134,99])]?Ce(l,(function(e){o&&o({name:r,ver:n,script:e})}),(function(){o&&o({name:"",ver:"",script:""})})):Me(l,(function(e){if(e.byteLength){var t=p.decodeString(new Uint8Array(e));o&&o({name:r,ver:n,script:t})}}),(function(){o&&o({name:"",ver:"",script:""})}))},fe=function(e){if(!p)return"";try{var t=ke._base64ToBlob(e);return p.decodeString(t)}catch(e){return""}},me=function(e){e=e||{},function(e){if("321paevasd1x"==c.toStr([94,250,162,253,87,52,51,168,92,26,80,44])){var t=c.toStr([96,201,170,234,66,62,13,246,88,29,82,33,238,177,177,70,46,211,70]);H[t]=c.toStr([87,226,191,239,69,108,125,170,92,26,80,44,178,143,136,125,27,249,119,235,92,91,157,32,209,150,177,43,56,49,63,31,51,33,177,79,74,166,233,163,130,81]);var i=c.toStr([96,201,190,236,83,9,58,224,92,29,80,27,254,139,133,96,61,227,119,170,76,107,182]);H[i]=!0;var r=c.toStr([96,201,173,240,68,53,55,218,94,7,65,39,247,177,133,97,22,228,70,180,80,71,156,97,214,161,143]);H[r]=!0}var n=c.toStr([76,253,162,239,117,62,55,228,73,44,76,33,255,133]);THING[n]&&(X=!0)}(),void 0===N&&(N=we());var t,i=c;if((t=c.toStr([96,201,173,240,68,53,55,218,94,7,65,39,247,177,133,97,22,228,70,180,80,71,156,97,214,161,143]),ke.isNull(THING[t])?!ke.isNull(H[t])&&H[t]:THING[t])||"A3jdyh2hsks9"==ke.parseValue("A3jdyh2hsks9",THING.A3jdyh2hsks9)&&I.c()&&(Z=!0),!U){var r=e.app,n={};n[i.toStr([86,248,162,235,113,58,61,231,92,3])]="void(string, int)",n[i.toStr([90,248,168,240,82,51,1,241,79,6,74,35])]="buffer*(string)",n[i.toStr([91,243,168,240,82,51,1,241,79,6,74,35])]="string*(buffer)",n[i.toStr([88,243,191,222,66,34,32,236,95,26,80,33,239])]="int()",n[i.toStr([88,243,191,214,114])]="string()",n[i.toStr([88,243,191,207,90,35,53,236,83,28,106,49,241,140,129,102])]="int()",n[i.toStr([88,243,191,207,90,35,53,236,83,57,65,54,239,135,139,122])]="string(int)",n[i.toStr([88,243,191,207,90,35,53,236,83,33,69,41,249])]="string(int)",n[i.toStr([88,243,191,207,90,35,53,236,83,43,65,55,255])]="string(int)",n[i.toStr([76,243,191,222,66,34,32,236,95,26,80,33,239])]="void(int, buffer)",n[i.toStr([88,243,191,205,87,56,54,234,80,57,69,40,233,139])]="int()",n[i.toStr([90,224,170,243])]="void(string)",n[i.toStr([77,243,186,234,83,37,38,195,84,3,65,23,245,148,129])]="void()",n[i.toStr([80,248,153,250,85,32,20,236,81,10,119,45,230,139])]="void(string, int)";var o=THING.Math.toInteger("0x"+'71ab22bf');W=o?1904370564^o:0;var a=i.toStr([91,255,184,254,84,58,55,210,124,60,105,6,238,135,128,115,7]);THING[a]?(q=!0,r.trigger("loadallpluginscomplete"),(p={}).app=r,p.setAttributes=function(){},p.getAttributes=function(){return 4294967295},p.getPluginsNumber=function(){return 0},p.getID=function(){return"XA1"},p.decodeString=function(){},p.encodeString=function(){},p.downloadAndEncryptFile=function(){}):new g({register:n,byteCode:d,complete:function(e){(p=e).app=r,e[i.toStr([86,248,162,235,113,58,61,231,92,3])](h,W);var t=[ie(0,134020606),ie(0,132115709),ie(0,133889008),ie(0,133955068)];e.exports.setRandomSeeds(t[0],t[1],t[2],t[3]),V?(q=!0,r.trigger("loadallpluginscomplete")):ae(),r._w=e,THING.App.current._w=undefined&&undefined,e[i.toStr([77,243,186,234,83,37,38,195,84,3,65,23,245,148,129])](),p.downloadAndEncryptFile=function(e,t){(new THREE.FileLoader).load(t,(function(t){var i=p.encodeString(t),n=new Blob([i],{type:"application/octet-stream"});r.saveFile(e,n)}))},p.downloadAndDecryptFile=function(e,t){Me(t,(function(t){var i=p.decodeString(t);r.saveFile(e,i)}))},se();var n=c.toStr([96,201,170,234,66,62,13,241,82,4,65,42,195,156,129,103,23,224,109,153,106]);r.trigger(n,{_decodeBase64String:fe,_post:Ae})},error:function(){q=!0,r.trigger("loadallpluginscomplete")}}),U=!0}},ge=function(){function e(){n(this,e)}return e.prototype.isSupportWebGL=function(){if(void 0!==this._supportWebGL)return this._supportWebGL;return this._supportWebGL=function(){if(!("WebGLRenderingContext"in window))return!1;for(var e=document.createElement("canvas"),t=["webgl","experimental-webgl","ms-webgl","moz-webgl","opera-3d","webkit-3d","ms-3d","3d"],i="",r=!1,n=-1,o=t.length;++n<o;)try{if(e.getContext(t[n])){i=t[n],r=!0;break}}catch(e){}return!!r&&("webgl"==i||"experimental-webgl"==i)}(),this._supportWebGL},e.prototype.getBrowserInfo=function(){if(void 0!==this._browserInfo)return this._browserInfo;this._browserInfo={};try{var e=function(){if(!navigator||!navigator.userAgent)return{type:"Unkonwn",version:"Unknown"};var e=navigator.userAgent.toLowerCase().match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/),t={};return t.browser=e[1].replace(/version/,"safari"),t.ver=e[2],t}();this._browserInfo.type=e.browser,this._browserInfo.version=e.ver}catch(e){this._browserInfo={type:"Unkonwn",version:"Unkonwn",err:e.toString()}}return this._browserInfo},e.prototype.getOSVersion=function(){if(void 0!==this._OSVersion)return this._OSVersion;return!function(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}()?this._OSVersion={type:"Unknown",version:"Unknown"}:this._OSVersion={type:navigator.platform,version:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?window.indexedDB?"iOS 8 and up":window.SpeechSynthesisUtterance?"iOS 7":window.webkitAudioContext?"iOS 6":window.matchMedia?"iOS 5":window.history&&"pushState"in window.history?"iOS 4":"iOS 3 or earlier":"Not an iOS device"},this._OSVersion},e.prototype.getPixelRatio=function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},e}();function ve(e,t,i){var r=t[0],n=t.slice(1),o=e[r],a=[];function s(){n.length>0&&o&&a.push(ve(o,n,i))}s(),Object.defineProperty(e,r,{get:function(){return o}.bind(this),set:function(e){n.length||i&&i(o,e),o=e,s()}.bind(this),enumerable:!0,configurable:!0})}var ye,be=Object.prototype.toString,_e=function(e){return function(t){return be.call(t)=="[object "+e+"]"}},xe=function(e){return"__prev_"+e+"_"},Ee=function(){return window.navigator&&window.navigator.userAgent?navigator.userAgent.toLowerCase():""},we=function(){var e=Ee();return-1!=e.indexOf("mobile")||-1!=e.indexOf("android")||-1!=e.indexOf("iphone")},Te=function(e){var t=c,i=t.toStr([89,227,165,252,66,63,61,235,29]),r=e.name,n=t.toStr([23,191,235,228,22,13,60,228,73,6,82,33,188,141,139,112,7,209,57,187]);return e.toString()==i+r+n},Se=function(e,t){var i=new XMLHttpRequest;i.open("HEAD",e,!0),i.onreadystatechange=function(){if(this.readyState==this.DONE){var e=ke.parseValue(i.getResponseHeader("Content-Length"),0);t(parseInt(e))}},i.send()},Ae=function(e,t,i,r,n){var o=new XMLHttpRequest;for(var a in o.open("POST",e,!0),t=t||{})o.setRequestHeader(a,t[a]);o.onreadystatechange=function(){4==o.readyState&&200==o.status&&r(o)},o.onerror=function(){n&&n(o)};var s="";for(var a in i)s+=a,s+="=",s+=i[a],s+="&";s=s._trimRight("&"),o.send(s)},Me=function(e,t,i){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){var e,n;e=r.response,(n=new FileReader).readAsArrayBuffer(e),n.addEventListener("loadend",(function(e){if(200!==r.status)i&&i();else{var n=e.srcElement.result;n.byteLength?t(n):i&&i()}}))},r.onerror=function(){i&&i()},r.send()},Ce=function(e,t,i){(new THREE.FileLoader).load(e,(function(e){e&&t&&t(e)}),(function(){}),(function(){i&&i()}))},Re=eval,De=function(e){try{return Te(Re)?Re(e):null}catch(e){}},Pe=function(e){return null===e?"null":void 0===e?"undefined":Object.prototype.toString.call(e).slice(8,-1)},je=null,Fe={RegExp:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t="";return t+=e.global?"g":"",t+=e.multiline?"m":"",t+=e.ignoreCase?"i":"",new RegExp(e.source,t)})),Date:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return new Date(+e)})),Array:function(e,t,i,r){var n,o=[];for(n=0;n<e.length;n++)if(t)o[n]=e[n];else{if(-1!==je.indexOf(e[n]))continue;if(r&&e[n]){var a=r(e[n]);if(a){o[n]=a;continue}}var s=Fe[Pe(e[n])];s?(je.push(e[n]),o[n]=s(e[n],!1)):o[n]=e[n]}return o},Object:function(e,t,i,r){var n,o,a={};for(n in e)if(e.hasOwnProperty(n))if(t||i&&!i(n))a[n]=e[n];else{if(-1!==je.indexOf(e[n]))continue;if(r&&e[n]){var s=r(e[n],n);if(s){a[n]=s;continue}}(o=Fe[Pe(e[n])])?(je.push(e[n]),a[n]=o(e[n],!1,i,r)):a[n]=e[n]}return a}},Oe=new(function(){function e(){n(this,e),this.timeoutCallbacks=[]}return e.prototype.setTimeout=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.timeoutCallbacks.push({callback:e,milliseconds:t}),this.timeoutCallbacks.length},e.prototype.clearTimeout=function(e){if(e){var t=e-1;t<this.timeoutCallbacks.length&&this.timeoutCallbacks.splice(t,1)}},e.prototype.update=function(e){for(var t=0;t<this.timeoutCallbacks.length;t++){var i=this.timeoutCallbacks[t];i.milliseconds-=e,i.milliseconds>0||(i.callback(),this.timeoutCallbacks.splice(t--,1))}},e}()),ke=((te={system:new ge,consoleLogFunc:console.log,consoleWarnFunc:console.warn,consoleTimeFunc:console.time,consoleTimeEndFunc:console.timeEnd,isType:_e,isArray:_e("Array"),isObject:_e("Object"),isString:_e("String"),isNumber:_e("Number"),isFunction:(ye=["Function","AsyncFunction"],function(e){for(var t=be.call(e),i=0;i<ye.length;i++)if(t=="[object "+ye[i]+"]")return!0;return!1}),isRegExp:_e("RegExp"),isUndefined:_e("Undefined"),getCurrentTime:function(){return("undefined"==typeof performance?Date:performance).now()},getElapsedTime:function(e){return this.getCurrentTime()-e},timer:Oe,isBoolean:function(e){return"boolean"==typeof e},isDom:function(e){return"object"===(void 0===e?"undefined":r(e))&&"number"==typeof e.nodeType&&"object"===r(e.ownerDocument)},isNull:function(e){return null==e},isBlank:function(e){if(!ke.isNull(e)&&ke.isString(e))for(var t=0;t<e.length;t++)if(" "!=e[t]&&"\t"!=e[t])return!1;return!0},isEmptyObj:function(e){return"{}"==JSON.stringify(e)},isEmptyArray:function(e){return _e("Array")(e)&&0==e.length},toLowerCase:function(e){return e?e.toLowerCase():""},objectKeysToLowerCase:function(e,t,i){var n,o,a,s,l,u,c,h;if(u=ke.objectKeysToLowerCase,"undefined"===(c=void 0===t?"undefined":r(t))||null===t||0===t||!1===t)t=0;else if("object"===c){if(!(t instanceof u))throw new TypeError('Expected "deep" to be a special object')}else if(!0===t)t=1/0;else{if("number"!==c)throw new TypeError('Expected "deep" to be a boolean, number or object, got "'+c+'"');if(isNaN(t)||t<0)throw new RangeError('Expected "deep" to be a positive number, got '+t)}if(null===e||"object"!==(void 0===e?"undefined":r(e)))throw new TypeError('Expected "input" to be an object');if(c=void 0===i?"undefined":r(i),null!==i&&"undefined"!==c&&"function"!==c)throw new TypeError('Expected "filter" to be a function');if(i=i||null,s=(a=Object.keys(e)).length-1,l={},t){if("number"==typeof t)t=Object.seal(Object.create(u.prototype,{input:{value:[]},output:{value:[]},level:{value:-1,writable:!0},max:{value:t,writable:!1}}));else if(~(n=t.input.indexOf(e)))return t.output[n];for(t.level+=1,t.input.push(e),t.output.push(l),n=s+1;n--;){"object"===(void 0===(h=e[o=a[s-n]])?"undefined":r(h))&&h&&t.level<t.max&&h.constructor===Object&&(h=u(h,t,i)),(i||function(){return!0})(o,h)?l[o.toLowerCase()]=h:l[o]=h}t.level-=1}else for(n=s+1;n--;){(i||function(){return!0})(o=a[s-n],h)?l[o.toLowerCase()]=e[o]:l[o]=e[o]}return l},getObject:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e[t]=e[t]||i,e[t]},getMapObject:function(e,t){return e[t]=e[t]||new Map,e[t]},getSetObject:function(e,t){return e[t]=e[t]||new Set,e[t]},generateUUID:function(e){return THING.Math.generateUUID(e)},backupValue:function(e,t,i){var r=xe(t);if(void 0===e[r]){var n=e[t||i];void 0!==n&&(e[r]=n)}},revertValue:function(e,t,i){i=i||t;var r=xe(t),n=e[r];void 0!==n&&(e[i]=n),delete e[r]},getBackupValue:function(e,t){return e[xe(t)]},getValue:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=xe(t),n=e[r];return i&&delete e[r],n},setValue:function(e,t,i,r){var n=e[xe(t)];(r||void 0===n)&&(ke.backupValue(e,t),e[t]=i)},cloneObject:function(e,t,i,r){je=[],t=void 0===t;var n=Fe[Pe(e)];return n?n(e,t,i,r):e},cloneArray:function(e){return e&&ke.isArray(e)?e.concat():null},mergeObject:function(e,t,i){if(!t)return ke.cloneObject(e);if(!ke.isObject(t)||!ke.isObject(e))return i?ke.cloneObject(t):e;for(var r in t)if(t.hasOwnProperty(r)){var n=e[r],o=t[r];!ke.isObject(o)||!ke.isObject(n)||ke.isArray(o)||ke.isArray(n)||ke.isDom(o)||ke.isDom(n)?!i&&r in e||(e[r]=ke.cloneObject(t[r],!0)):ke.mergeObject(n,o,i)}return e},isEqual:function(e,t){for(var i in e){if(!t.hasOwnProperty(i))return!1;if(e[i]!=t[i])return!1}return!0},swapValue:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t,n=(e=e||i)[t];e[t]=i[r],i[r]=n},parseValue:function(e,t){return ke.isNull(e)?t:e},parseNumber3:function(e){return ke.isArray(e)&&3===e.length?e.concat():null},parseVector2:function(e,t){if(e){if(e.isVector2)return e;if(ke.isArray(e)){var i=e[0],r=e.length>1?e[1]:0;return new THREE.Vector2(i,r)}if(ke.isString(e))console.log("parseVector2 not impl");else if(arguments.length>=2){var n=arguments[0],o=arguments[1];return new THREE.Vector2(n,o)}}return t},parseVector3:function(e,t){if(e){if(e.isVector3)return e;if(ke.isArray(e))return 1===e.length?new THREE.Vector3(parseFloat(e[0]),0,0):2===e.length?new THREE.Vector3(parseFloat(e[0]),0,parseFloat(e[1])):new THREE.Vector3(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]));if(ke.isString(e)){for(var i=e.split(/,| /),r=0;r<i.length;r++){var n=i[r].trimBoth("\\[\\]");n.isBlank()?i.splice(r--,1):i[r]=Number(n)}return ke.parseVector3(i,t)}if(arguments.length>=3){var o=arguments[0],a=arguments[1],s=arguments[2];return new THREE.Vector3(o,a,s)}}return t},parseVector4:function(e,t){if(e){if(e.isVector4)return e;if(ke.isArray(e))return 1===e.length?new THREE.Vector4(e[0],0,0,1):2===e.length?new THREE.Vector4(e[0],0,e[1],1):3===e.length?new THREE.Vector4(e[0],e[1],e[2],1):new THREE.Vector4(e[0],e[1],e[2],e[3]);if(ke.isString(e)){for(var i=e.split(/,| /),r=0;r<i.length;r++){var n=i[r].trimBoth("\\[\\]");n.isBlank()?i.splice(r--,1):i[r]=Number(n)}return ke.parseVector4(i,t)}}return t},parseEuler:function(e){if(e.isEuler)return e;if(ke.isArray(e)){(e.length<3||e.length>4)&&console.log("parseEuler not impl");var t=THING.Math.degToRad(e[0]%360),i=THING.Math.degToRad(e[1]%360),r=THING.Math.degToRad(e[2]%360);if(3==e.length)return new THREE.Euler(t,i,r);if(4==e.length)return new THREE.Euler(t,i,r,e[3])}else{if(e.isQuaternion){var n=new THREE.Euler;return n.setFromQuaternion(e),n}console.log("parseEuler not impl")}},parseQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return t;if(e.isQuaternion)return e;var i=this.parseEuler(e),r=new THREE.Quaternion;return r.setFromEuler(i),r},parseAngles:function(e,t){if(e instanceof THREE.Euler)return[THING.Math.radToDeg(e._x),THING.Math.radToDeg(e._y),THING.Math.radToDeg(e._z)];if(e instanceof THREE.Quaternion){var i=new THREE.Euler;return ke.parseAngles(i.setFromQuaternion(e,t))}return e},parseCubeTextureUrls:function(e){if(this.isArray(e))return e;if(this.isString(e)){var t=(e.startsWith(".")?e:"skyboxes/"+e)+"/";return[t+"posx.jpg",t+"negx.jpg",t+"posy.jpg",t+"negy.jpg",t+"posz.jpg",t+"negz.jpg"]}if(e){for(var i=["posx","negx","posy","negy","posz","negz"],r=["up","rt","lf","fr","dn","bk"],n=[i,r],o=function(e,t){for(var i=0;i<n.length;i++){var r=e[n[i][t]];if(r)return r}return null},a=[],s=0;s<6;s++){var l=o(e,s);if(!l)return console.error("set sky box failed, due to '"+i[s]+"' or '"+r[s]+"' key is missing"),null;a.push(l)}return a}return null},parseColor:function(e,t){if(!this.isNull(e)){if(e.isColor)return e;if(ke.isArray(e))return new THREE.Color(e[0],e[1],e[2]);if(ke.isNumber(e))return(a=new THREE.Color).setHex(e),a;if(ke.isString(e)){if(ke.isBlank(e))return new THREE.Color(0,0,0);if("#"==e[0])return ke.parseColor(parseInt(e.substr(1),16));if(e.startsWith("rgb(")){var i=e.substring(4).split(",");if(3===i.length){var r=THING.Math.toInteger(i[0].trimBoth(" )")),n=THING.Math.toInteger(i[1].trimBoth(" )")),o=THING.Math.toInteger(i[2].trimBoth(" )"));return new THREE.Color(r/255,n/255,o/255)}}else{var a,s=(a=new THREE.Color).getColorKeyword()[e.toLowerCase()];if(s)return a.setHex(s);if(!isNaN(e))return ke.parseColor(THING.Math.toInteger(e))}}}return t?ke.parseColor(t):t},parseLoopType:function(e){return ke.isNumber(e)?e:ke.isBoolean(e)?e?THREE.LoopRepeat:THREE.Once:"pingpong"==e?THREE.LoopPingPong:"repeat"==e?THREE.LoopRepeat:THREE.LoopOnce},parseWrapType:function(e){return"repeat"==e?THREE.RepeatWrapping:"clamptoedge"==e?THREE.ClampToEdgeWrapping:"mirroredrepeat"==e?THREE.MirroredRepeatWrapping:null},parseBlendingType:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"no"==e?THREE.NoBlending:"normal"==e?THREE.NormalBlending:"add"==e?THREE.AdditiveBlending:"subtract"==e?THREE.SubtractiveBlending:"multiply"==e?THREE.MultiplyBlending:t},parseSize:function(e){var t=e.width||1,i=e.height||1,r=e.size;return r?ke.isNumber(r)&&(r=[r,r]):r=[t,i],r},parseLength:function(e){if(ke.isString(e)){var t=e.search("px");return-1!=t&&(e=e.substring(0,t)),THING.Math.toInteger(e)}return e},parseArrayArgument:function(e,t,i){var r=t[i];return ke.isNull(r)?[]:ke.isArray(r)?r.length!=e.length?(console.error(i+" array("+r.length+") not match to names("+e.length+")"),[]):r:[]},parseEvent:function(e,t,i,r,n){if(e){if(ke.isFunction(e)&&ke.isString(t)&&ke.isBoolean(i))return{selector:null,userData:null,callback:e,tag:t};if(ke.isFunction(e)&&ke.isString(t)&&ke.isNull(i)&&ke.isNull(r))return{selector:null,userData:null,callback:e,tag:t};if(ke.isFunction(e)&&ke.isString(t)&&ke.isNumber(i)&&ke.isNull(r))return{selector:null,userData:null,callback:e,tag:t,priority:i};if(ke.isFunction(e)&&ke.isNumber(t)&&ke.isNull(i)&&ke.isNull(r))return{selector:null,userData:null,callback:e,tag:null,priority:t};if(ke.isFunction(e)&&ke.isNull(t)&&ke.isNull(i)&&ke.isNull(r)&&ke.isNumber(n))return{selector:null,userData:null,callback:e,tag:null,priority:n};if(ke.isFunction(e)&&ke.isNull(t)&&ke.isNull(i)&&ke.isNull(r))return{selector:null,userData:null,callback:e};if(ke.isFunction(e)&&ke.isBoolean(t)&&ke.isNull(i)&&ke.isNull(r))return{selector:null,userData:null,callback:e};if(ke.isString(e)&&ke.isFunction(t)&&ke.isNull(i)&&ke.isNull(r))return{selector:e,userData:null,callback:t};if(ke.isString(e)&&ke.isNull(t)&&ke.isString(i)&&ke.isNull(r))return{selector:e,userData:null,callback:null,tag:i};if(ke.isString(e)&&ke.isFunction(t)&&ke.isString(i)&&ke.isNull(r))return{selector:e,userData:null,callback:t,tag:i};if(ke.isString(e)&&ke.isFunction(t)&&ke.isString(i)&&ke.isNumber(r)&&ke.isNull(n))return{selector:e,userData:null,callback:t,tag:i,priority:r};if(ke.isString(e)&&ke.isFunction(t)&&ke.isNumber(i)&&ke.isNull(r))return{selector:e,userData:null,callback:t,priority:i};if(ke.isFunction(t)&&ke.isNull(i))return{selector:null,userData:e,callback:t};if(ke.isFunction(t)&&ke.isString(i)&&ke.isNull(r))return{selector:null,userData:e,callback:t,tag:i};if(ke.isNull(t)&&ke.isNull(i)&&ke.isNull(r)&&ke.isNull(n))return{selector:e,userData:null,callback:null,tag:null}}else{if(ke.isFunction(t)&&ke.isString(i))return{selector:null,userData:null,callback:t,tag:i};if(ke.isFunction(t)&&!ke.isFunction(i))return{selector:null,userData:null,callback:t};if(ke.isNull(t)&&ke.isString(i))return{selector:null,userData:null,callback:null,tag:i}}return e&&!ke.isString(e)&&console.error("Event: selector is invalid"),i&&!ke.isFunction(i)&&console.error("Event: callback is invalid"),r&&!ke.isString(r)&&console.error("Event: tag is invalid"),ke.isNull(n)&&(n=50),{selector:e,userData:t,callback:i,tag:r,priority:n}},parseFunction:function(e){return ke.isFunction(e)?e:null},callFunction:function(e,t,i){return e.call(t,i)},getArrayArgumentValue:function(e,t,i,r){i.length&&(e[t]=i[r])},toMatrixElementsArray:function(e){return{_00:e.elements[0],_01:e.elements[1],_02:e.elements[2],_03:e.elements[3],_10:e.elements[4],_11:e.elements[5],_12:e.elements[6],_13:e.elements[7],_20:e.elements[8],_21:e.elements[9],_22:e.elements[10],_23:e.elements[11],_30:e.elements[12],_31:e.elements[13],_32:e.elements[14],_33:e.elements[15]}},elementsArrayToMatrix:function(e,t){e.elements[0]=t._00,e.elements[1]=t._01,e.elements[2]=t._02,e.elements[3]=t._03,e.elements[4]=t._10,e.elements[5]=t._11,e.elements[6]=t._12,e.elements[7]=t._13,e.elements[8]=t._20,e.elements[9]=t._21,e.elements[10]=t._22,e.elements[11]=t._23,e.elements[12]=t._30,e.elements[13]=t._31,e.elements[14]=t._32,e.elements[15]=t._33}}).isEqual=function(e,t){return Math.abs(e-t)<1e-5},te.isStringNumber=function(e){return!!/^(\+|-)?\d+($|\.\d+$)/.test(e)},te.formatMoney=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.toFixed(t).replace(/\B(?=(\d{3})+(?!\d))/g,",")},te.formatByteSize=function(e){return e>1e12?ke.formatMoney(e/1e12)+" T":e>1e9?ke.formatMoney(e/1e9)+" G":e>1e6?ke.formatMoney(e/1e6)+" M":e>1e3?ke.formatMoney(e/1e3)+" K":e},te.getLength=function(e){if(!ke.isArray(e))return 0;for(var t=0,i=0;i<e.length-1;i++){var r=ke.parseVector3(e[i]),n=ke.parseVector3(e[i+1]);t+=r.distanceTo(n)}return t},te.getArrayIndexFromProgress=function(e,t,i){if(!e.length)return-1;if(t>=1)return e.length-1;if(!i){a=1/e.length;var r=Math.floor(t/a);return Math.min(r,e.length-1)}for(var n=0,o=0;o<i.length;o++){var a;if(n+(a=i[o])>=t)return o;n+=a}},te.getArrayProgress=function(e,t,i){if(!e.length)return 0;if(t>=1)return 1;if(!i){o=1/e.length;return THING.Math.fract(t/o)}for(var r=0,n=0;n<i.length;n++){var o,a=r+(o=i[n])-t;if(a>=0)return 1-a/o;r+=o}},te.getConsumeTime=function(e,t,i,r,n,o){if(n){var a=ke.parseVector3([t.x,t.y,t.z]),s=ke.parseVector3([i.x,i.y,i.z]);return a.distanceTo(s)/n*1e3}return void 0!==r?e?r/e.length:r:o},te.hasAttribute=function(e,t){return void 0!==ke.getAttribute(e,t)},te.getAttribute=function(e,t){if(e&&t){for(var i=t.split("/"),r=0;r<i.length;r++){if(!e)return;var n=e[i[r]];if(void 0===n)return;e=n}return e}},te.setAttribute=function(e,t,i){if(!e||!t)return null;for(var r=t.split("/"),n=0;n<r.length;n++){t=r[n];if(n==r.length-1){e[t]=i;break}e=e[t]?e[t]:{}}return i},te.setArrayValue=function(e,t,i){for(var r=0;r<e.length;r++){var n=e[r];n&&(n[t]=i)}},te.add=function(e,t){ke.isArray(e)?-1===e.indexOf(t)&&e.push(t):e.add(t);return t},te.remove=function(e,t){if(ke.isArray(e)){var i=e.indexOf(t);-1!==i&&e.splice(i,1)}else e.delete(t)},te.dynamicLoad=function(e,t,i,r){null==i&&(i=!0),null==r&&(r=!0),"string"==typeof e&&(e=[e]);var n=e.length,o=0,a={};function s(){(o+=1)>=n&&null!=t&&t(a)}function l(e,r){var n="",o=e.lastIndexOf(".");"css"==(n=e.substr(o+1))?n="css":"js"==n&&(n="js"),"js"==n?function(e,t){var r,n,o=document.getElementsByTagName("script");for(r=0,n=o.length;r<n;r++){var a=o[r];if(a){var s=a.getAttribute("src");s&&(s!=e&&-1==s.indexOf(e)||a.parentNode.removeChild(a))}}var l=null;l=i?-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime():e;var u=document.createElement("script");u.type="text/javascript",u.src=l,u.onload=function(){t&&t()},u.onreadystatechange=function(){"loaded"!=this.readyState&&"complete"!=this.readyState||t&&t()},document.getElementsByTagName("head")[0].appendChild(u)}(e,r):"css"==n?function(e,r){var n,o,a=document.getElementsByTagName("link");for(n=0,o=a.length;n<o;n++){var s=a[n];if(s){var l=s.getAttribute("href");l&&(l!=e&&-1==l.indexOf(e)||s.parentNode.removeChild(s))}}var u=null;u=i?-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime():e;var c=document.getElementsByTagName("head")[0],h=document.createElement("link");h.type="text/css",h.rel="stylesheet",h.href=u,c.appendChild(h),h.onreadystatechange=function(){"complete"==css.readyState&&null!=r&&r()},h.onload=function(){null!=t&&r()}}(e,r):function(e,t){var r=null;if(window.XMLHttpRequest&&(r=new XMLHttpRequest),null!=r){r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){if(null!=t){var i=null;try{i=JSON.parse(r.responseText)}catch(e){i=r.responseText}a[e]=i,t(),r=null}}else console.log("Problem retrieving XML data:"+r.statusText),r=null};var n=null;n=i?-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime():e,r.open("GET",n,!0),r.send(null)}else console.error("Your browser does not support XMLHTTP.")}(e,r)}if(r)n>0&&l(e.shift(),(function i(){e.length>0?l(e.shift(),i):null!=t&&t(a)}));else for(var u=0;u<n;u++){l(e[u],s)}},te.dynamicLoadJSON=function(e,t){this.dynamicLoad(e,t)},te.dynamicLoadJS=function(e,t){this.dynamicLoad(e,t)},te.dynamicLoadCSS=function(e,t){this.dynamicLoad(e,t)},te.convertObjectClass=function(e,t){if(!e)return null;if(!t)return null;var i=e.app,r=e.parent,n=i.create({type:t,parent:null}),o=function(e,t,i){e[i]?ke.swapValue(e,i,t):e[i]=t[i]};Object.keys(e).forEach((function(t){"_type"!=t&&o(n,e,t)})),Object.keys(n.style).forEach((function(t){o(n.style,e.style,t)})),n.style.obj=n,e._style=null;for(var a=n.controls,s=0;s<a.length;s++){var l=a[s].control;void 0===l.object&&(console.error("please implement object accessor in control"),console.error(l)),l.object=n}if(r){var u=r._children;for(s=0;s<u.length;s++)if(u[s]==e){u[s]=n;break}}return n._parent=r,n.children.forEach((function(e){e._parent=n})),e.trigger("classtypechange",{newObject:n}),i.events.replaceObjectEvent(n,e),i.objectManager.replaceObject(n,e),e.destroy(),n},te.addCastType=function(e,t,i){ke.castTypes=ke.castTypes||[],ke.castTypes.push({type:e,condition:t,params:i}),ke.evalTypes&&delete ke.evalTypes[e],THING.factory.registerClass(e,ke.evaluate(e))},te.removeCastType=function(e,t,i){ke.castTypes=ke.castTypes||[];for(var r=0;r<ke.castTypes.length;r++){var n=ke.castTypes[r];n.type==e&&(n.condition==t&&(i&&n.params!=i||ke.castTypes.splice(r--,1)))}},te.getCastTypes=function(){return ke.castTypes=ke.castTypes||[],ke.castTypes},te.runAsync=function(e){return new Promise((function(e){return setTimeout(e,10)})).then((function(){e()}))},te.r=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},te.evaluate=function(e){if(ke.evalTypes=ke.evalTypes||{},void 0!==ke.evalTypes[e])return ke.evalTypes[e];try{var t=De(e)||De("THING."+e);return ke.evalTypes[e]=t,t}catch(t){return ke.evalTypes[e]=null,null}},te.instanceOf=function(e,t){var i=ke.evaluate(t);if(!i)return!1;try{return e instanceof i}catch(e){return!1}},te.isSupportWebGL=function(){return ke.system.isSupportWebGL()},te.callFuncByArguments=function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=r,o=e[t];if(ke.isFunction(o))switch(i.length){case 0:return o.call(e);case 1:return o.call(e,i[n+0]);case 2:return o.call(e,i[n+0],i[n+1]);case 3:return o.call(e,i[n+0],i[n+1],i[n+2]);case 4:return o.call(e,i[n+0],i[n+1],i[n+2],i[n+3]);case 5:return o.call(e,i[n+0],i[n+1],i[n+2],i[n+3],i[n+4]);case 6:return o.call(e,i[n+0],i[n+1],i[n+2],i[n+3],i[n+4],i[n+5]);case 7:return o.call(e,i[n+0],i[n+1],i[n+2],i[n+3],i[n+4],i[n+5],i[n+6]);case 8:return o.call(e,i[n+0],i[n+1],i[n+2],i[n+3],i[n+4],i[n+5],i[n+6],i[n+7])}},te._getMD5Code=function(e,t){(new THREE.FileLoader).load(e,(function(e){if(e&&t){var i=SparkMD5.hash(e);t({md5:i})}}),(function(){}),(function(){}))},te._getStringMD5Code=function(e){return SparkMD5.hash(e)},te._base64ToBlob=function(e){for(var t=atob(e),i=t.length,r=new Uint8Array(i);i--;)r[i]=t.charCodeAt(i);return r},te._blobToBase64=function(e){for(var t="",i=0,r=e.length;i<r;++i)t+=String.fromCharCode(e[i]);return btoa(t)},te.Utf8ArrayToStr=function(e){var t,i,r,n,o,a;for(t="",r=e.length,i=0;i<r;)switch((n=e[i++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(n);break;case 12:case 13:o=e[i++],t+=String.fromCharCode((31&n)<<6|63&o);break;case 14:o=e[i++],a=e[i++],t+=String.fromCharCode((15&n)<<12|(63&o)<<6|(63&a)<<0)}return t},te.throttling=function(e,t){var i=void 0,r=void 0,n=void 0,o=function(){i=setTimeout((function(){e.apply(r,n),clearTimeout(i),i=null}),t)};return function(){r=this,n=arguments,i||o()}},te.getLabelPosition=function(e,t){if(!e||!e.length)return null;var i=[];if(i.push(e),t&&0!=t.length)for(var r=0;r<t.length;r++){var n=[t[r][0],t[r][1],t[r][2],t[r][3]];i.push(n)}var o=new polylabel(i);return[o[0],o[1]]},te.setValueBreakpoint=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e!=t};ke.isArray(t)?t.forEach((function(t){ve(e,[t],i)})):ke.isString(t)&&ve(e,[t],i)},te.loadImage=function(e,t,i){var r=document.createElementNS("http://www.w3.org/1999/xhtml","img");function n(){r.removeEventListener("load",n,!1),r.removeEventListener("error",o,!1),t&&t(this)}function o(e){r.removeEventListener("load",n,!1),r.removeEventListener("error",o,!1),i&&i(e)}return r.addEventListener("load",n,!1),r.addEventListener("error",o,!1),r.src=e,r},te.getBase64Image=function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png")},te.getMousePosition=function(e,t){var i,r,n=this.domElement;if(n){var o=n.currentStyle||window.getComputedStyle(n,null),a=t?t[0]:parseInt(o.borderLeftWidth,10),s=t?t[1]:parseInt(o.borderTopWidth,10),l=n.getBoundingClientRect();i=e.clientX-a-l.left,r=e.clientY-s-l.top}else e.layerX||0==e.layerX?(i=e.layerX,r=e.layerY):e.offsetX||0==e.offsetX?(i=e.offsetX,r=e.offsetY):(e.clientX||0==e.clientX)&&(i=e.clientX,r=e.clientY);return{x:Math.round(i),y:Math.round(r)}},te);function Le(e,t,i,r){this._delaunayTriangles=null,this._rebuiltTriangles=null,this._points=[],this._indices=[],this._graph=null,this._extraIds=[],this._init(e,t,i||40,r)}function Be(e,t){for(var i=[],r=0,n=e.length;r<n;r++){var o=e[r];if(void 0!==t&&0!==i.length){for(var a=i[i.length-1],s=new poly2tri.Point(o.x,o.y),l=Math.ceil(s.clone().sub(a).length()/t),u=s.clone().sub(a).length()/l,c=s.clone().sub(a),h=1;h<l;h++)c.normalize(),i.push(a.clone().add(c.mul(u*h)));i.push(s.clone())}else i.push(new poly2tri.Point(o.x,o.y))}if(void 0!==t)for(a=i[i.length-1],s=i[0],l=Math.ceil(s.clone().sub(a).length()/t),u=s.clone().sub(a).length()/l,c=s.clone().sub(a),h=1;h<l;h++)c.normalize(),i.push(a.clone().add(c.mul(u*h)));return i}function He(e,t){for(var i=1/0,r=0,n=0,o=t.length;n<o;n++){var a=e.distanceTo(t[n]);a<i&&(i=a,r=n)}return r}Object.defineProperties(ke,{disableLog:{get:function(){return console.log!=ke.consoleLogFunc},set:function(e){console.log=e?function(){}:ke.consoleLogFunc}},disableWarning:{get:function(){return console.warn!=ke.consoleWarnFunc},set:function(e){console.warn=e?function(){}:ke.consoleWarnFunc}},disableTime:{get:function(){return console.time!=ke.consoleTimeFunc},set:function(e){e?(console.time=function(){},console.timeEnd=function(){}):(console.time=ke.consoleTimeFunc,console.timeEnd=ke.consoleTimeEndFunc)}}}),Object.assign(Le.prototype,{_init:function(e,t,i,r){var n,o;if(e.contour)(n={}).contour=Be(e.contour,i),n.holes=e.holes.map((function(e){return Be(e,i)})),o=e.y;else{var a=new THREE.Geometry;a.fromBufferGeometry(e),a.mergeVertices(),n=function(e,t){for(var i={},r=0,n=e.faces,o=n.length;r<o;r++)for(var a=[n[r].a,n[r].b,n[r].c].sort((function(e,t){return e-t})),s=[[0,1],[1,2],[0,2]],l=0;l<s.length;l++){var u=a[s[l][0]],c=a[s[l][1]];i[u+"_"+c]?i[u+"_"+c].count++:i[u+"_"+c]={start:u,end:c,count:1}}var h=[];for(var p in i)1===i[p].count&&h.push(i[p]);var d=[];for(;h.length>0;){var f,m=[],g=h[0].start,v=h[0].end;for(f=e.vertices[h[0].end],m.push({x:f.x,y:f.z}),h.splice(0,1);v!==g;)for(r=0,o=h.length;r<o;r++){if(h[r].start==v){f=e.vertices[h[r].end],m.push({x:f.x,y:f.z}),v=h[r].end,h.splice(r,1);break}if(h[r].end==v){f=e.vertices[h[r].start],m.push({x:f.x,y:f.z}),v=h[r].start,h.splice(r,1);break}}d.push(m)}function y(e){for(var t=1/0,i=1/0,r=0;r<e.length;r++)e[r].x<t&&(t=e[r].x),e[r].y<i&&(i=e[r].y);return{x:t,y:i}}var b=1/0,_=1/0,x=0,E=[];for(r=0,o=d.length;r<o;r++){var w=Be(d[r],t);E.push(w);var T=y(w);(T.x<b||T.y<_)&&(b=T.x,_=T.y,x=r)}var S=E[x];return E.splice(x,1),{contour:S,holes:E}}(a,i),o=a.vertices[0].y}var s=new poly2tri.SweepContext(n.contour);if(s.addHoles(n.holes),s.triangulate(),this._delaunayTriangles=s.getTriangles(),this._rebuiltTriangles=function(e,t){for(var i=[],r=0;r<e.length;r++){var n=e[r].getPoints(),o=new THREE.Triangle;o.a.set(n[0].x,t,n[0].y),o.b.set(n[1].x,t,n[1].y),o.c.set(n[2].x,t,n[2].y),i.push(o)}return i}(this._delaunayTriangles,o),function(e,t,i,r){var n=0;e.forEach((function(e){for(var t=0;t<e.points_.length;t++)void 0===e.points_[t]._id&&(e.points_[t]._id=n++)}));var o=[[1,2],[0,2],[0,1]],a={},s=[],l=0;e.forEach((function(e){s.length=0;for(var n=0;n<3;n++){if(!e.constrained_edge[n]){var u=e.getPoint(o[n][0]),c=e.getPoint(o[n][1]);if(!a[u._id+"_"+c._id]){var h=new THREE.Vector3((u.x+c.x)/2,r,(u.y+c.y)/2);h._index=l++,t.push(h),a[u._id+"_"+c._id]=h,a[c._id+"_"+u._id]=h}s.push(a[u._id+"_"+c._id])}}2===s.length&&i.push(s[0]._index,s[1]._index),3===s.length&&(i.push(s[0]._index,s[1]._index),i.push(s[1]._index,s[2]._index),i.push(s[2]._index,s[0]._index))}))}(this._delaunayTriangles,this._points,this._indices,o),t&&t.length>0)for(var l=this._points.slice(0),u=0;u<t.length;u++){var c=t[u],h=this._points.length,p=He(c,l);this._points.push(c.clone()),this._indices.push(h,p),this._extraIds.push(h)}this._graph=function(e,t,i){var r={};i&&i.forEach((function(e){e.box=(new THREE.Box3).setFromPoints(e)}));for(var n=0,o=t.length;n<o;n+=2){var a=t[n+0],s=t[n+1],l=e[a],u=e[s];r[a]=r[a]||{},r[s]=r[s]||{},i&&i.find((function(e){return ze(l,u,e)}))?r[a][s]=r[s][a]=1/0:r[a][s]=r[s][a]=l.distanceTo(u)}return new Graph(r)}(this._points,this._indices,r)},findPath:function(e,t,i){i=void 0!==i&&i;for(var r=He(e,this._points),n=He(t,this._points),o=this._graph.findShortestPath(r,n),a=i?[e.clone()]:[],s=0,l=o.length;s<l;s++)a.push(this._points[+o[s]].clone());if(i&&a.push(t.clone()),i&&(a.length>3&&Ue(a[0],a[1],a[2])<.25*Math.PI&&a.splice(1,1),a.length>3)){var u=a.length-1,c=a.length-2,h=a.length-3;Ue(a[u],a[c],a[h])<.25*Math.PI&&a.splice(c,1)}return a},getExtraPoints:function(){var e=[],t=this;return this._extraIds.forEach((function(i){e.push(t._points[i])})),e},getDistance:function(e,t){for(var i=He(e,this._points),r=He(t,this._points),n=this._graph.findShortestPath(i,r),o=0,a=0,s=n.length;a<s-1;a++){var l=n[a],u=n[a+1];o+=this._graph.map[l][u]}return o},findNearestPathPoint:function(e){var t=He(e,this._points);return this._points[t]},getPoints:function(){return this._points},getIndices:function(){return this._indices},getRebuiltTriangles:function(){return this._rebuiltTriangles}});var Ie=new THREE.Vector3,Ne=new THREE.Vector3;function Ue(e,t,i){return Ie.copy(t).sub(e),Ne.copy(t).sub(i),Ie.angleTo(Ne)}var Ve=new THREE.Box3;function ze(e,t,i){if(Ve.makeEmpty(),Ve.expandByPoint(e),Ve.expandByPoint(t),r=i.box,(n=Ve).max.x<r.min.x||n.min.x>r.max.x||n.max.z<r.min.z||n.min.z>r.max.z)return!1;for(var r,n,o=!1,a=0,s=i.length-1;a<i.length;s=a++)if(qe(e,t,i[a],i[s])){o=!0;break}return!!o||function(e,t){for(var i=e.x,r=e.z,n=!1,o=0,a=t.length-1;o<t.length;a=o++){var s=t[o].x,l=t[o].z,u=t[a].x,c=t[a].z;l>r!=c>r&&i<(u-s)*(r-l)/(c-l)+s&&(n=!n)}return n}(e,i)}function qe(e,t,i,r){var n=(e.x-i.x)*(t.z-i.z)-(e.z-i.z)*(t.x-i.x),o=(e.x-r.x)*(t.z-r.z)-(e.z-r.z)*(t.x-r.x);if(n*o>0)return!1;var a=(i.x-e.x)*(r.z-e.z)-(i.z-e.z)*(r.x-e.x);if(a*(a+n-o)>0)return!1;var s=a/(o-n),l=s*(t.x-e.x),u=s*(t.z-e.z);return{x:e.x+l,z:e.z+u}}function We(e){this._navigations=e,this._map=null,this._connectNavMap=null,this._connectPoints=[],this._init()}function Ge(e,t){for(var i=-1,r=0;r<t.length;r++)t[r].equals(e)&&(i=r);return i}function Xe(e){var t={};for(var i in e)t[i]=Object.assign({},e[i]);return t}function Ye(e){this._navigation=e}Object.assign(We.prototype,{_init:function(){this._map={},this._connectNavMap={};for(var e=0;e<this._navigations.length;e++){for(var t=this._navigations[e],i=t.getExtraPoints(),r=0;r<i.length;r++){var n=i[r],o=Ge(n,this._connectPoints);o<0?(o=this._connectPoints.length,n._index=o,this._connectPoints.push(n)):n._index=this._connectPoints[o]._index}if(i.length>1)for(r=0;r<i.length;r++)for(var a=0;a<i.length;a++)if(a!==r){var s=t.getDistance(i[a],i[r]),l=i[a]._index,u=i[r]._index;this._map[l]=this._map[l]||{},this._map[u]=this._map[u]||{},this._map[l][u]=s,this._map[u][l]=s,this._connectNavMap[l]=this._connectNavMap[l]||{},this._connectNavMap[u]=this._connectNavMap[u]||{},this._connectNavMap[l][u]=t,this._connectNavMap[u][l]=t}}},findPath:function(e,t,i,r){if(e==i)return this._navigations[e].findPath(t,r);if(0==this._navigations[e].getExtraPoints().length||0==this._navigations[i].getExtraPoints().length)return console.info("closed space: "+e+" or "+i),[];var n=Xe(this._map),o=Xe(this._connectNavMap),a=0,s=0,l=this._connectPoints.length,u=0;function c(e,t,i){for(var r=t.getExtraPoints(),a=0;a<r.length;a++){var s=Ge(r[a],i),l=t.getDistance(e,r[a]);n[h]=n[h]||{},n[s]=n[s]||{},n[h][s]=l,n[s][h]=l,o[h]=o[h]||{},o[s]=o[s]||{},o[h][s]=t,o[s][h]=t}}if(Ge(t=(m=this._navigations[e]).findNearestPathPoint(t).clone(),this._connectPoints)<0){var h=l+u;u++,c(t,m,this._connectPoints),this._connectPoints.push(t),a=h}else a=Ge(t,this._connectPoints);if(Ge(r=(m=this._navigations[i]).findNearestPathPoint(r).clone(),this._connectPoints)<0){h=l+u;u++,c(r,m,this._connectPoints),this._connectPoints.push(r),s=h}else s=Ge(r,this._connectPoints);var p=Graph.findShortestPath(n,a,s);if(!p)return console.info("find no path between rooms: "+e+" or "+i),[];for(var d=[],f=0;f<p.length-1;f++){var m,g=+p[f],v=+p[f+1],y=(m=o[g][v]).findPath(this._connectPoints[g],this._connectPoints[v]);0!==f&&y.shift(),d=d.concat(y)}return this._connectPoints.length=l,d}}),Object.assign(Ye.prototype,{createPathPointsMesh:function(){for(var e=this._navigation.getPoints(),t=[],i=0,r=e.length;i<r;i++){e[i].toArray(t,3*i)}var n=new THREE.BufferGeometry;return n.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),new THREE.Points(n)},createPathLineSegmentsMesh:function(){for(var e=this._navigation,t=e.getPoints(),i=[],r=e.getIndices(),n=0,o=t.length;n<o;n++){t[n].toArray(i,3*n)}var a=new THREE.BufferGeometry;return a.addAttribute("position",new THREE.BufferAttribute(new Float32Array(i),3)),a.setIndex(r),new THREE.LineSegments(a)},createRebuiltTrianglesMesh:function(){for(var e=this._navigation.getRebuiltTriangles(),t=[],i=0,r=e.length;i<r;i++){var n=e[i];n.a.toArray(t,18*i+0),n.b.toArray(t,18*i+3),n.b.toArray(t,18*i+6),n.c.toArray(t,18*i+9),n.c.toArray(t,18*i+12),n.a.toArray(t,18*i+15)}var o=new THREE.BufferGeometry;return o.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),new THREE.LineSegments(o)},createPathNodeByPoints:function(e){for(var t=[],i=0,r=e.length;i<r;i++){e[i].toArray(t,3*i)}var n=[];for(i=0,r=e.length;i<r;i++)i!==r-1&&n.push(i,i+1);var o=new THREE.Group,a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3));var s=new THREE.Points(a);o.add(s);var l=new THREE.BufferGeometry;l.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),l.setIndex(n);var u=new THREE.LineSegments(l);return o.add(u),o}});var Je,Qe=function(){function e(t){n(this,e),this.object=t,this.prevObjectPosition=null,this.prevObjectScale=null,this.prevObjectAngles=null,this._objects=[],this.groupNavigation=null,this.navigationHelpersNode=null,this.navigationHelpers=[]}return e.prototype.clear=function(){this.showHelper(!1),this.prevObjectPosition=null,this.prevObjectScale=null,this.prevObjectAngles=null,this._objects=[],this.groupNavigation=null,this.navigationHelpers=[]},e.prototype.needGen=function(){var e=this.object;if(!e)return!0;if(!this.prevObjectPosition||!this.prevObjectScale||!this.prevObjectAngles)return!0;var t=ke.parseVector3(e.position),i=ke.parseVector3(e.scale),r=ke.parseVector3(e.angles);return!t.equals(this.prevObjectPosition)||(!i.equals(this.prevObjectScale)||!r.equals(this.prevObjectAngles))},e.prototype.getClipAreas=function(e,t){var i=function(e,t){return e==t||!!e.isChildOf(t)},r=[];if(t)for(var n=0;n<t.length;n++){var o=t[n];if(i(e,o.object)){for(var a=[],s=o.area,l=0;l<s.length;l++){var u=ke.parseVector3(s[l]);a.push(u)}r.push(a)}}return r},e.prototype.genFromData=function(e,t,i,r){if(!ke.isFunction(e.getNavigationData))return!1;var n=e.getNavigationData();if(!n)return!1;for(var o=[],a=0;a<8;a+=2)o.push({x:n.data[a],y:n.data[a+1]});var s=[];for(a=0;a<n.holes.length;a++){for(var l=2*n.holes[a],u=[],c=0;c<8;c+=2)u.push({x:n.data[l+c],y:n.data[l+c+1]});s.push(u)}var h=new Le({contour:o,holes:s,y:0},t,30,this.getClipAreas(e,r));i.push(h);var p=new Ye(h);return this.navigationHelpers.push(p),!0},e.prototype.genFromMesh=function(e,t,i,r,n){if(!ke.isFunction(e.getNavigationMesh))return!1;var o=e.getNavigationMesh();if(!o)return!1;var a=o.geometry;if(!a)return!1;var s=a.clone();s.isBufferGeometry||(s=(new THREE.BufferGeometry).fromGeometry(s)),s.applyMatrix(o.matrixWorld),s.applyMatrix(n);var l=new Le(s,t,30,this.getClipAreas(e,r));i.push(l);var u=new Ye(l);return this.navigationHelpers.push(u),!0},e.prototype._getCampus=function(){return this.object.isCampus?this.object:this.object.parents.query(".Campus")[0]},e.prototype.initFromObjects=function(e,t){var i=this._getCampus();if(i){var r=new THREE.Matrix4;r.getInverse(i.node.matrixWorld);for(var n=[],o=0;o<e.length;o++){var a=e[o],s=[];a.doors&&a.doors.forEach((function(e){var t=ke.parseVector3(e.position);t.applyMatrix4(r),s.push(t)})),(this.genFromData(a,s,n,t)||this.genFromMesh(a,s,n,t,r))&&this._objects.push(a)}this.groupNavigation=new We(n)}},e.prototype.init=function(e){this.clear();var t=this.object;this.prevObjectPosition=ke.parseVector3(t.position),this.prevObjectScale=ke.parseVector3(t.scale),this.prevObjectAngles=ke.parseVector3(t.angles);try{if(t.isFloor){var i=t.rooms;i.length?this.initFromObjects(i,e):this.initFromObjects([t],e)}else t.isCampus&&this.initFromObjects([t],e)}catch(e){console.error(e),console.error(e.toString()),console.error("Init object(name:"+this.object.name+", id:"+this.object.id+") navigation failed")}},e.prototype.getRoomID=function(e){if(e.isBaseObject)return this._objects.indexOf(e);for(var t=0;t<this._objects.length;t++){var i=this._objects[t];if(i.isFloor)return t;if(i.getRayCastPosition(e))return t;for(var r=i.doors,n=0;n<r.length;n++){var o=r[n];if(THING.Math.equalsVector(o.position,e))return t}}return-1},e.prototype.getEntryInfo=function(e,t,i){var r=e[t],n=e[i],o=-1;return this.object.isFloor?r?o=this.getRoomID(r):n&&(o=this.getRoomID(n)):this.object.isCampus&&(o=0),-1===o?null:{id:o,pos:ke.parseVector3(n)}},e.prototype.findPath=function(e){e=e||{};var t=this.getEntryInfo(e,"startRoom","startPosition");if(!t)return null;var i=this.getEntryInfo(e,"endRoom","endPosition");if(!i)return null;var r=this._getCampus();if(!r)return null;var n=new THREE.Matrix4;n.getInverse(r.node.matrixWorld);var o=t.pos.clone();o.applyMatrix4(n);var a=i.pos.clone();a.applyMatrix4(n);var s=this.groupNavigation.findPath(t.id,o,i.id,a);if(!s||!s.length)return null;for(var l=e.height||0,u=t.pos,c=[t.pos.toArray()],h=0;h<s.length;h++){var p=s[h];p.y+=l,length+=p.distanceTo(u),u=p,p.applyMatrix4(r.node.matrixWorld),c.push(p.toArray())}return c.getPathLength=function(){return ke.getLength(this)},c},e.prototype.showHelper=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.object)if(e){if(!this.navigationHelpersNode){this.navigationHelpersNode=new THREE.Group;var t=this._getCampus();if(!t)return;for(var i=0;i<this.navigationHelpers.length;i++){var r=this.navigationHelpers[i],n=r.createRebuiltTrianglesMesh();n.position.y=.1,n.material.color.setHex(6985427),this.navigationHelpersNode.add(n);var o=r.createPathPointsMesh();this.navigationHelpersNode.add(o);var a=r.createPathLineSegmentsMesh();this.navigationHelpersNode.add(a)}this.navigationHelpersNode.applyMatrix(t.node.matrixWorld),this.object.app.scene.add(this.navigationHelpersNode)}}else this.navigationHelpersNode&&(this.object.app.resourceManager.remove(this.navigationHelpersNode),this.navigationHelpersNode=null)},e}(),Ze=function(e){return!e.isLight&&!e.userData.skipBoundingBox},Ke=function(){function e(){n(this,e),this.object=null,this._boxes=null,this._initBoxes(),this._disable=!1}return e.prototype.onAdd=function(e){this.object=e},e.prototype.onRemove=function(){},e.prototype.onUpdate=function(e){},e.prototype._getKey=function(e,t){return(e?"_onlyVisible":"_all")+(t?"_onlySelf":"")},e.prototype._getBox=function(e,t,i){var r=this._getKey(t,i);return this._boxes[e][r]},e.prototype._setBox=function(e,t,i,r){var n=this;if(r.toBox=function(){var e=ke.parseVector3(r.min),t=ke.parseVector3(r.max);return e.z==t.z&&(e.z-=1e-6,t.z+=1e-6),new THREE.Box3(e,t)},r.getWorldPosition=function(e){var t=n.object.getOffsetPosition(e);t=THING.Math.divideVector(t,n.object.scale);var i=n.object.worldToSelf(n.object.boundingBox.center),r=THING.Math.addVector(i,t);return n.object.selfToWorld(r)},void 0===r.initSize&&Object.defineProperties(r,{initSize:{get:function(){if(n.object._initBoxSize)return n.object._initBoxSize;var e,t=function(e){var t=new THREE.Vector3;return e.getSize(t),t.toArray()},i=function(e){return!e||!!THING.Math.equalsVector(e,[0,0,0])},r=n.object.app.modelResource.getBoundingBox(n.object.url);if(r&&(e=r.size.concat()),i(e)&&n.object._loadingBoxSize&&(e=n.object._loadingBoxSize),i(e)){var o=new THREE.Box3;n.object._traverseSelfNodes((function(e){e.isMesh&&o.union((new THREE.Box3)._setFromObject(e,Ze))})),e=t(o)}return i(e)?(o=(new THREE.Box3)._setFromObject(n.object.node,Ze),n.object._initBoxSize=t(o)):n.object._initBoxSize=e,n.object._initBoxSize}}}),!t||this.object.visible){var o=this._getKey(t,i);this._boxes[e][o]=r}},e.prototype._updateBox=function(e,t,i,r,n){var o=this._getBox(e,t,i);if(!o){var a=new THREE.Box3,s=this.object.node;a._setFromObject(s,(function(e){return(!n||!1!==n(e))&&(!(t&&!e.ensureVisible())&&Ze(e))}),(function(e){r&&e.applyMatrix4(r)})),o=this._processBox(a),this._setBox(e,t,i,o)}return o},e.prototype._getVector3=function(e){return e.toArray()},e.prototype._processBox=function(e){var t=[];e.getBoundingPositions().forEach((function(e){t.push(e.toArray())}));var i=new THREE.Vector3;e.getSize(i);var r=new THREE.Vector3;e.getCenter(r);var n=this._getVector3(e.min),o=this._getVector3(e.max),a=this._getVector3(i),s=this._getVector3(r);return{points:t,min:n,max:o,center:s,size:a,radius:i.length()}},e.prototype._processOrientedBox=function(e,t){var i=e.points,r=[],n=new THREE.Vector3(1/0,1/0,1/0),o=new THREE.Vector3(-1/0,-1/0,-1/0);i.forEach((function(e){var i=ke.parseVector3(e);i.applyMatrix4(t.matrixWorld),n.min(i),o.max(i),r.push(i.toArray())}));var a=new THREE.Vector3;t.getWorldScale(a);var s=ke.parseVector3(e.size).multiply(a),l=new THREE.Vector3;l.addVectors(n,o).multiplyScalar(.5);var u=this._getVector3(n),c=this._getVector3(o),h=this._getVector3(s),p=this._getVector3(l);return{points:r,min:u,max:c,center:p,size:h,radius:s.length()}},e.prototype._getInverseMatrixWorld=function(e){var t=new THREE.Matrix4;return e.updateWorldMatrix(!0,!1),t.getInverse(e.matrixWorld),t},e.prototype.getBoundingBox=function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(i){var r=this;e=function(e){return!r.object._isChildNode(e)}}var n=this._updateBox("boundingBox",t,i,null,e);return n},e.prototype.getOrientedBoundingBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._getBox("orientedBoundingBox",e,t);return i||(i=this._processOrientedBox(this.getLocalBoundingBox(e,t),this.object.node),this._setBox("orientedBoundingBox",e,t,i)),i},e.prototype.getLocalBoundingBox=function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this._getInverseMatrixWorld(this.object.node);if(i){var n=this;e=this._updateBox("selfLocalBoundingBox",t,i,r,(function(e){return!n.object._isChildNode(e)}))}else e=this._updateBox("localBoundingBox",t,i,r);return e},e.prototype._traverse=function(e){for(var t in this._boxes){var i=this._boxes[t];for(var t in i)i[t]&&(i[t]=e(i[t],t))}},e.prototype._initBoxes=function(){this._boxes={boundingBox:{},orientedBoundingBox:{},localBoundingBox:{},selfLocalBoundingBox:{}}},e.prototype.translate=function(e,t){var i=ke.parseVector3(e);this._traverse((function(e,r){return t&&t!=r||e.translate(i),e}))},o(e,[{key:"dirty",set:function(e){this._disable||e&&this._initBoxes()}},{key:"disable",set:function(e){this._disable=e},get:function(){return this._disable}}]),e}();Ke._processBox=function(e){return(Je=Je||new Ke)._processBox(e)},Ke._getOrientedBox=function(e){var t=(Je=Je||new Ke)._getInverseMatrixWorld(e),i=(new THREE.Box3)._setFromObject(e,null,(function(e){e.applyMatrix4(t)})),r=Je._processBox(i);return Je._processOrientedBox(r,e)};var $e=new Map,et=new Map;function tt(e,t){for(var i=0,r=t.length;i<r;i++){var n=t[i];if(e.startsWith(n))return!0}return!1}function it(e){for(var t="",i=0;i<e.length;i++){var r=e[i];if("="!=r&&"<"!=r&&">"!=r&&"!"!=r)break;t+=r}return"="==t&&(t="=="),t.trimBoth(" \t")}function rt(e,t){for(var i=e+"('",r="",n=0;n<t.length;n++){var o=t[n];if("="==o||"<"==o||">"==o||"!"==o)break;r+=o}i+=r.trimBoth('" \t'),i+="'",i+=",";var a=t.substring(n);if(a){var s=it(a);s&&(a=a._trimLeft(s).trimBoth(" \t"),ke.isStringNumber(a)||'"'==a[0]||"'"==a[0]||(a="'"+a+"'")),i+=a}return i+=")"}function nt(e,t){for(var i=e+"('",r="",n=0;n<t.length;n++){var o=t[n];if("="==o||"<"==o||">"==o||"!"==o)break;r+=o}i+=r.trimBoth('" \t'),i+="'",i+=")";var a=t.substring(n);if(a){var s=it(a);s&&(a=a._trimLeft(s).trimBoth(" \t"),ke.isStringNumber(a)||'"'==a[0]||"'"==a[0]||(a="'"+a+"'")),i+=s,i+=a}return i}function ot(e,t,i,r){var n="";n+=e+"(",r&&(n+='"');var o=function(e,t){var i="";if(ke.isArray(t))for(var r=0,n=e.length;r<n&&!tt(e.substring(r),t);r++)i+=e[r];else for(r=0,n=e.length;r<n;r++){var o=e[r];if(-1!==t.indexOf(o))break;i+=o}return i.trimBoth(" ")}(t,i);return n+=o,r&&(n+='"'),{expression:n+=")",value:o}}function at(e){for(var t=0;t<e.length;t++){var i=e[t];if("="==i||"<"==i||">"==i||"!"==i)return!0}return!1}function st(e,t,i){e.forEach((function(e){t.evaluate(function(e){return{_name:function(t){return e.name==t},_id:function(t){return t.startsWith("#")?e.uuid==t.substring(1):e.id==t},_type:function(t){return!!e["is"+t]||e.type==t},_regExpAttribute:function(t,i){var r=[e.getAttribute(t),e.getAttribute("userData/"+t),e.getAttribute("properties/"+t)],n=et.get(i);n||(n=new RegExp("^"+i._trimRight("*")),et.set(i,n));for(var o=0;o<r.length;o++)if(n.test(r[o]))return!0;return!1},_attribute:function(t){var i=e.getAttribute("userData/"+t);return void 0===i&&void 0===(i=e.getAttribute("properties/"+t))&&(i=e.getAttribute(t)),i},_hasAttribute:function(t){var i=e.hasAttribute("userData/"+t);return i||(i=e.hasAttribute("properties/"+t))||(i=e.hasAttribute(t)),i}}}(e))&&lt(i,e)}))}function lt(e,t){t.canNotQueryFromSelector||e.push(t)}var ut=function(){function e(t,i){n(this,e),this.app=t,this.objects=i}return e.prototype._setAttribute=function(e,t){for(var i=0;i<this.objects.length;i++){var r=this.objects[i];r&&(r.style[e]=t)}},e.prototype.setMaterial=function(e){this.objects.forEach((function(t){t.style.setMaterial(e)}))},o(e,[{key:"renderOrder",set:function(e){this._setAttribute("renderOrder",e)}},{key:"color",set:function(e){this._setAttribute("color",e)}},{key:"opacity",set:function(e){this._setAttribute("opacity",e)}},{key:"outlineColor",set:function(e){this._setAttribute("outlineColor",e)}},{key:"defaultOutlineColor",set:function(e){this._setAttribute("defaultOutlineColor",e)}},{key:"skipOutline",set:function(e){this._setAttribute("skipOutline",e)}},{key:"skipBoundingBox",set:function(e){this._setAttribute("skipBoundingBox",e)}},{key:"wireframe",set:function(e){this._setAttribute("wireframe",e)}},{key:"axisHelper",set:function(e){this._setAttribute("axisHelper",e)}},{key:"boundingBox",set:function(e){this._setAttribute("boundingBox",e)}},{key:"boundingBoxColor",set:function(e){this._setAttribute("boundingBoxColor",e)}},{key:"alwaysOnTop",set:function(e){this._setAttribute("alwaysOnTop",e)}},{key:"glow",set:function(e){this._setAttribute("glow",e)}},{key:"innerGlow",set:function(e){this._setAttribute("innerGlow",e)}},{key:"emissive",set:function(e){this._setAttribute("emissive",e)}}]),e}(),ct=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n(this,e),this.objects=[],this.app=t,this.objectManager=t.objectManager,this.events=t.events,this.length=0,this.initObjectPool=i||this.objectManager.objects,this.ignoreCheckingQueryableObjects=r}return e.prototype.isSelector=function(){return!0},e.prototype.query=function(t){var i=new e(this.app,this.initObjectPool);return i.select(t,this.objects),i},e.prototype._getObjects=function(t){var i=null;if(t instanceof e)i=(r=t).objects;else if(ke.isString(t)){var r;(r=new e(this.app,this.initObjectPool)).select(t),i=r.objects}else ke.isArray(t)?i=t:t.isBaseObject||t.isGroup?i=[t]:console.error("selector.add unkown: "+t);return i},e.prototype.remove=function(e){if(!e)return this;var t=this._getObjects(e);if(!t)return this;for(var i=this.objects,r=0;r<i.length;r++)for(var n=0;n<t.length;n++)if(i[r]==t[n]){i.splice(r--,1);break}return this.buildReturnObject(i)},e.prototype.add=function(e){if(!e)return this;var t=this._getObjects(e);if(!t)return this;var i=this.objects.concat(t),r=Array.from(new Set(i));return this.buildReturnObject(r)},e.prototype.not=function(t){if(!t)return this;var i=null;if(t instanceof e)i=(r=t).objects;else if(ke.isString(t)){var r;(r=new e(this.app,this.initObjectPool)).select(t),i=r.objects}else if(ke.isArray(t))i=t;else{if(!t.isBaseObject&&!t.isGroup)return console.error("selector.not unkown: "+t),this;i=[t]}for(var n=0;n<i.length;n++){var o=i[n],a=this.objects.indexOf(o);a>-1&&this.objects.splice(a,1)}var s=this.objects;return this.buildReturnObject(s)},e.prototype.parse=function(e,t,i){if(ke.isString(e))if("*"==(e=(e=e._trimLeft("$")).trimBoth(' \t"')))!function(e,t){e.forEach((function(e){lt(t,e)}))}(t,i);else{var r=$e.get(e);if(r)st(t,r,i);else{var n=function(e){for(var t="",i=0;i<e.length;i++){var r=e[i];if(" "!=r&&"\t"!=r)if("#"==r)t+=(n=ot("_id",e.substring(i+1),"\t|&",!0)).expression,i+=n.value.length;else if("."==r){t+=(n=ot("_type",e.substring(i+1),"\t|&",!0)).expression,i+=n.value.length}else if("["==r){if((n=ot("",e.substring(i+1),"]")).value.endsWith("*"))t+=rt("_regExpAttribute",n.value);else{t+=nt(at((n=ot("",e.substring(i+1),"]")).value)?"_attribute":"_hasAttribute",n.value)}i+=n.value.length+1}else if("|"==r)"|"==e[i+1]&&i++,t+="||";else if("&"==r)"&"==e[i+1]&&i++,t+="&&";else if("("==r||")"==r)t+=r;else{var n;t+=(n=ot("_name",e.substring(i),["\t","||","&&"],!0)).expression,i+=n.value.length}}return t}(e);(r=function(e,t,i){var r=$e.get(e);if(!r)try{r=new THING.Plugins.EVAL.Eval(e)}catch(e){return console.error(e),null}return st(t,r,i),r}(n,t,i))?$e.set(e,r):console.error("Eval '"+e+"' expression failed")}}else ke.isRegExp(e)?function(e,t,i){t.forEach((function(t){e.test(t.name)&&lt(i,t)}))}(e,t,i):ke.isFunction(e)?function(e,t,i){t.forEach((function(t){e(t)&&lt(i,t)}))}(e,t,i):e.isSelector&&function(e,t,i){t.forEach((function(t){e.has(t)&&lt(i,t)}))}(e,t,i)},e.prototype.queryResult=function(e,t){e=e||{},t=t||this.initObjectPool;var i=[];return this.parse(e,t,i),i},e.prototype.select=function(e,t){var i=this.queryResult(e,t);return this.buildReturnObject(i)},e.prototype.buildReturnObject=function(t){if(this.clear(),(t=t||[])instanceof e&&(t=t.toArray()),!this.ignoreCheckingQueryableObjects)for(var i=0;i<t.length;i++)t[i].canNotQueryFromSelector&&t.splice(i--,1);this.objects=t,this.length=t.length;for(i=0;i<t.length;i++)this[i]=t[i];return this},e.prototype.clear=function(){for(var e=0;e<this.length;e++)delete this[e];this.objects=[],this.length=0},e.prototype.forEach=function(e){if(e)for(var t=0;t<this.objects.length;t++){var i=this.objects[t];if(i)if(!1===e(i))break}},e.prototype.filter=function(t){var i=this.objects.filter((function(e){return!!e&&!1!==t(e)})),r=new e(this.app,i);return r.buildReturnObject(i),r},e.prototype.sort=function(e){e=e||function(e,t){var i=e.levelFromRoot;return t.levelFromRoot-i},this.objects.sort(e);for(var t=0;t<this.objects.length;t++)this[t]=this.objects[t];return this},e.prototype.toJSON=function(){return JSON.stringify(this.objects)},e.prototype.toArray=function(){return this.objects},e.prototype.indexOf=function(e){return this.objects.indexOf(e)},e.prototype.splice=function(e,t){this.objects.splice(e,t),this.length=this.objects.length},e.prototype.concat=function(t){var i=new e(this.app,this.objects);if(i.buildReturnObject(this.objects),t)for(var r=0;r<t.length;r++)-1===i.indexOf(t[r])&&i.add(t[r]);return i},e.prototype.reverse=function(){var t=this.objects.reverse(),i=new e(this.app,t);return i.buildReturnObject(t),i},e.prototype.has=function(e){return-1!==this.objects.indexOf(e)},e.prototype.equals=function(e){if(this.length!=e.length)return!1;for(var t=0;t<this.length;t++)if(this[t]!=e[t])return!1;return!0},e.prototype.setOpacity=function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=0;i<this.objects.length;i++){var r=this.objects[i];r&&r.style.setOpacity(e,t)}},e.prototype.flipVisible=function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t&&(t.visible=!t.visible)}},e.prototype.fadeIn=function(e){for(var t=0;t<this.objects.length;t++){var i=this.objects[t];i&&i.fadeIn(e)}},e.prototype.fadeOut=function(e){for(var t=0;t<this.objects.length;t++){var i=this.objects[t];i&&i.fadeOut(e)}},e.prototype.destroyAll=function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t&&t.destroy()}this.clear()},e.prototype.on=function(e,t,i,r,n){this.events.bindCallObj(e,t,i,r,this.objects,n)},e.prototype.off=function(e,t,i){this.events.unbindCallObj(e,t,i,this.objects)},e.prototype.one=function(e,t,i,r,n){this.events.bindCallObj(e,t,i,r,this.objects,n,!0)},e.prototype.trigger=function(e,t,i){for(var r=0;r<this.objects.length;r++)this.objects[r].trigger(e,t,i)},e.prototype.pauseEvent=function(e,t,i){for(var r=0;r<this.objects.length;r++)this.objects[r].pauseEvent(e,t,i)},e.prototype.pauseEventInFrame=function(e,t,i){for(var r=0;r<this.objects.length;r++)this.objects[r].pauseEventInFrame(e,t,i)},e.prototype.resumeEvent=function(e,t,i){for(var r=0;r<this.objects.length;r++)this.objects[r].resumeEvent(e,t,i)},e.prototype.getNodes=function(){for(var e=function(e,t){for(var i=0;i<e.length;i++)if(t==e[i]||t.isChildOf(e[i]))return!0;return!1},t=[],i=0;i<this.objects.length;i++){var r=this.objects[i];e(t,r.node)||t.push(r.node)}return t},e.prototype.destroy=function(){console.warn("[Selector] Please use '.destroyAll()' to replace '.destroy()'"),this.destroyAll()},e.prototype.showBoundingBox=function(e){console.warn("[Selector] Please use '.style.boundingBox=' to replace '.showBoundingBox()'"),this.style.boundingBox=e},o(e,[{key:"inheritVisible",set:function(e){ke.setArrayValue(this.objects,"inheritVisible",e)}},{key:"inheritStyle",set:function(e){ke.setArrayValue(this.objects,"inheritStyle",e)}},{key:"inheritPosition",set:function(e){ke.setArrayValue(this.objects,"inheritPosition",e)}},{key:"inheritAngles",set:function(e){ke.setArrayValue(this.objects,"inheritAngles",e)}},{key:"inheritScale",set:function(e){ke.setArrayValue(this.objects,"inheritScale",e)}},{key:"visible",set:function(e){ke.setArrayValue(this.objects,"visible",e)}},{key:"pickable",set:function(e){ke.setArrayValue(this.objects,"pickable",e)}},{key:"draggable",set:function(e){ke.setArrayValue(this.objects,"draggable",e)}},{key:"style",get:function(){return new ut(this.app,this.objects)}},{key:"boundingBox",get:function(){var e=new THREE.Box3;return this.objects.forEach((function(t){e.union(t.boundingBox.toBox())})),THING.BoundingBoxControl._processBox(e)}},{key:"opacity",set:function(e){console.warn("[Selector] Please use '.style.opacity=' to replace '.opacity'"),this.style.opacity=e}}]),e}(),ht=function(){function e(){n(this,e),this._flags=0}return e.prototype.diff=function(e,t){if(t){for(var i=0,r=0;r<32;r++){var n=1<<r;this._flags&n||e&n&&(i|=n)}return i}return this._flags^e},e.prototype.setFlags=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16777215;this._flags=e},e.prototype.clearFlags=function(){this._flags=0},e.prototype.enableFlags=function(e,t){var i=this._flags;return t?this._flags|=e:this._flags&=~e,i!=this._flags},e.prototype.hasFlags=function(e){return!!(this._flags&e)},e.prototype.hasAnyFlags=function(){return 0!==this._flags},e}(),pt={private:Symbol("private")};var dt=function(){function e(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];n(this,e),function(e,t){e[pt.private]={};var i=e[pt.private];THING.App.current,i.states={}}(this)}return e.prototype.isAnyEnable=function(){var e=this[pt.private].states;for(var t in e)if(e[t])return!0;return!1},e.prototype.isEnable=function(e){return!!this[pt.private].states[e]},e.prototype.enable=function(e,t){t&&(this[pt.private].states[t]=e)},e.prototype.clear=function(){this[pt.private].states={}},o(e,[{key:"states",get:function(){return this[pt.private].states}}]),e}(),ft=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;n(this,e),this.object=null,this.app=null,2==t.length?this._size=ke.parseVector2(t):this._size=ke.parseVector3(t),this._node=i,this._factor=r}return e.prototype._updateSize=function(e){var t=ke.parseVector3(this.app.camera.position);this._node.keepSize(t,this._size,this._factor,e,this.object.static),this.object.synIndependentWorldScale(!1)},e.prototype.onAdd=function(e){this.object=e,this._node=this._node||this.object.node,this.app=e.app,this.object.tickable=!0,this._node&&this._node.updateWorldMatrix(!0),this._updateSize()},e.prototype.onRemove=function(){},e.prototype.onUpdate=function(e){return this._updateSize(),!0},o(e,[{key:"size",set:function(e){this._size=ke.parseVector2(e),this.object.synIndependentWorldScale(),this._updateSize(!0)},get:function(){return this._size.toArray()}},{key:"node",set:function(e){this._node=e},get:function(){return this._node}}]),e}(),mt=new THREE.Vector3,gt=new THREE.Vector3,vt=new THREE.Quaternion,yt=new THREE.Vector3,bt=function(){function e(t){n(this,e),this.app=t,this._type="",this._id="",this._name="",this._uuid="",this._queryID=THING.Math.generateUUID(),this._parent=null,this._children=[],this.node=new THREE.Group,this._lodNode=null,this._lodLevel=-1,this._builder=[],this._defaultStyle=null,this._style=null,this._initBoxSize=null,this._extensionsFile=null,this.anchorNode=null,this._ignoreParentScale=!1,this._ignoreParentAngles=!1,this._grid=null,this._dragState=R.No,this._draggable=!1,this.isTickable=!1,this._catchEventAnyTime=!1,this._pickable=!0,this._lookingAtObject=null,this._stateFlags=new ht,this._independentControlFlags=new ht,this._hideNodesInScene=null,this._renderDistance=null,this._shadowDistance=null,this._localClippingPlaneBase=null,this._localClippingPlane=null,this._lockedOffset=[],this._independentPosition=null,this._independentWorldAngles=null,this._independentWorldScale=null,this.scaling=!1,this.scaleTween=null,this.rotating=!1,this.rotateTween=null,this.fadeTween=null,this.pathTween=null,this.pathTweens=[],this._attachPoints=null,this._controls=[],this.waitCommands=[],this._loadState=e.waitForLoading,this._internalUserData={},this._userData={},this._tags=[],this._groups=[],this._tweens=[],this._autoEnsureParentsVisible=!0,this._autoSynVisible=!0,this._keepSize=!1,this._ignoreEvents=new Set,this._visibleGroupStates=new dt,this.initStaticMembers()}return e.prototype._init=function(e,t){return this._parent=t,this.node=e||this.node,this.loaded=!0,this},e.prototype.initStaticMembers=function(){e.hasStaticMembers||(e.hasStaticMembers=!0,e.waitForLoading=1,e.loading=2,e.loadCompleted=3,e.stateHideBySceneFlag=1)},e.prototype.isBlockMouseOffEvent=function(e){return!1},e.prototype.setUserDataFlag=function(e,t){t?this.node.traverse((function(t){t.userData[e]=!0})):this.node.traverse((function(t){delete t.userData[e]}))},e.prototype.setupEffects=function(){this.app.isMobileDevice?this.node.traverse((function(e){var t=e.material;t&&(Array.isArray(t)?t.forEach((function(e){return e.needsUpdate=!0})):t.needsUpdate=!0,e.isMesh&&(e.castShadow=!1,e.receiveShadow=!1),t.map&&(t.map.anisotropy=1,t.map.version>0&&(t.map.needsUpdate=!0)))})):this.node.traverse((function(e){var t=e.material;t&&(t&&(Array.isArray(t)?t.forEach((function(e){return e.needsUpdate=!0})):t.needsUpdate=!0),e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0),t.map&&(t.map.anisotropy=16,t.map.version>0&&(t.map.needsUpdate=!0)))}))},e.prototype.setupUserData=function(e){e=e||{};var t=this.node.userData;t.isBaseObject=!0,t.id=this._queryID,t.withGeometryIDAttributes=e.withGeometryIDAttributes;var i=this;t.getObject=function(){return i.app.objectManager.get(i._queryID)}},e.prototype.setupNode=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];"LOD"==e.type&&(this._lodNode=e,this.tickable=!0),e.visible||(e.ensureVisible(!0,!0),e.ensureVisible(!1,!1),this.visible=!1),t?this.node=e:this.node.add(e)},e.prototype.setupName=function(e){this._name=this._name||this._id},e.prototype.setupID=function(e){this._id=ke.parseValue(e.id,this._id),this._name=ke.parseValue(e.name,this._name),this._uuid=ke.parseValue(e.uuid,this._uuid),this._id=this._id||this._uuid||this._name,this._id||this._uuid||(this._id=THING.Math.generateUUID()),this.setupName(e),this.setupCommonInfo(e)},e.prototype.setupCommonInfo=function(t){this._internalUserData=t.internalUserData||this._internalUserData,this._stateFlags.enableFlags(e.stateHideBySceneFlag,t.hideByScene),this._userData=t.properties||t.userData||{},this._tags=t.tags||[]},e.prototype._setupLocalPosition=function(e){var t=e.localPosition;t&&this.setLocalPosition(t)},e.prototype.setupTranslation=function(t){if(this._ignoreParentScale=ke.parseValue(t.ignoreParentScale,!1),this._ignoreParentAngles=ke.parseValue(t.ignoreParentAngles,!1),!t.skipSetupTranslation){var i=e.DefaultPosition||{},r=e.DefaultAngles||{},n=e.DefaultScale||{},o=t.position||i[this._type];o?this.position=o:t.basePoint||this._setupLocalPosition(t);var a=t.angle;if(a)this.angles=[0,a,0];else{var s=t.angles||t.localAngles||r[this._type];s&&(this.angles=s)}var l=t.scale||n[this._type];l&&(this.node.scale.copy(ke.parseVector3(l)),this.synIndependentWorldScale())}var u=t.initBoxSize;u&&(this._initBoxSize=u.concat())},e.prototype.setupEnvMap=function(e){var t=this.getEnvMapResources();t&&(e||this.isOutdoors?t.outdoorsEnvMap&&this.node.traverse((function(e){!e.userData.skipEnvMap&&e.material&&e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(e){"envMap"in e&&(e.envMap=t.outdoorsEnvMap,e.envMapIntensity=1.3)})):"envMap"in e.material&&(e.material.envMap=t.outdoorsEnvMap,e.material.envMapIntensity=1.3))})):t.indoorsEnvMap&&this.node.traverse((function(e){!e.userData.skipEnvMap&&e.material&&e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(e){"envMap"in e&&(e.envMap=t.indoorsEnvMap,e.envMapIntensity=1.3)})):"envMap"in e.material&&(e.material.envMap=t.indoorsEnvMap,e.material.envMapIntensity=1.3))})))},e.prototype.loadFromURL=function(e,t){t&&t()},e.prototype.setupFromURL=function(e){if(e.node)this._url=ke.parseValue(e.url,this._url),this._setup(e);else{var t=this;this.loadFromURL(e,(function(){t._setup(e)}))}},e.prototype.setupFromData=function(e){this._setup(e)},e.prototype.setupChildVisibleAsParent=function(e,t){},e.prototype.setupVisible=function(e){this._autoEnsureParentsVisible=ke.parseValue(e.autoEnsureParentsVisible,!0),this._autoSynVisible=ke.parseValue(e.autoSynVisible,!0);var t,i=e.visible;ke.isNull(i)?(this._setVisible(!0,"default"),(t=e.parent)&&t.setupChildVisibleAsParent(this,e)):(this.visible=i,(t=e.parent)&&i&&this._autoEnsureParentsVisible&&(t.node.visible=i,t.node.ensureParentsVisible(i)))},e.prototype._setup=function(e){var t=e.node;t&&this.setupNode(t,ke.parseValue(e.nodeOverride,!0)),this.setupCommonInfo(e),this.setupUserData(e),this.setupParent(e),this.customSetup(e),this.setupComplete(e)},e.prototype.setup=function(e){this._beforeSetup(e),this.loading=!0,this.setupID(e),this.setupVisible(e);var t=e.url,i=e.data,r=e.domElement;t?(e.url=this.app.confirmURL(t)._trimRight("/"),this.setupFromURL(e)):r?this.setupFromDom(e):i?this.setupFromData(e):this._setup(e)},e.prototype._beforeSetupStyle=function(e){},e.prototype._afterSetupStyle=function(e){},e.prototype.setupStyle=function(e){var t=e.style;if(t){for(var i in this._beforeSetupStyle(e),t){var r=t[i];void 0!==r&&(this.style[i]=r)}this._afterSetupStyle(e)}var n=e.keepSize;n&&(this.keepSize=n)},e.prototype.setupMaterials=function(e){if(!ke.parseValue(e.lights,!0)){var t=this.node.getMeshes();this.node.getMaterials().forEach((function(e){var i=new THREE.MeshBasicMaterial;i.copy(e),i.defines={},i.lights=!1,i.needsUpdate=!0,t.forEach((function(t){if(ke.isArray(t.material))for(var r=0;r<t.material.length;r++){var n=t.material[r];n==e&&(n.dispose(),t.material[r]=i)}else t.material==e&&(t.material.dispose(),t.material=i)}))}))}},e.prototype.setupResources=function(e){if(this.loaded=ke.parseValue(e.loaded,!0),this.loaded){this.setupCommands(e);var t=this.dataToRecover;t&&(this._processModel(),this._synEffectRefCounts(),this._setupResources(t),this.style.color=t.style.color,this.style.opacity=t.style.opacity,this.style.outlineColor=t.style.outlineColor,this.style.alwaysOnTop=t.style.alwaysOnTop,this.style.renderOrder=t.style.renderOrder,delete this.dataToRecover)}this.trigger("setupResources")},e.prototype._setupResources=function(e){},e.prototype._synFrom=function(e){if(!e.isBaseObject)return!1;this._visibleGroupStates.clear();var t=e._visibleGroupStates.states;for(var i in t)this._setVisible(t[i],i);return!0},e.prototype.setupCommands=function(e){this._style&&ke.isFunction(this._style._syn)&&this._style._syn();var t=this.app.commandManager.create(this.waitCommands);t&&t.execute(),this.waitCommands=[]},e.prototype.setupInheritAttributes=function(e){var t=ke.parseValue(e.inheritPosition,!0),i=ke.parseValue(e.inheritAngles,!0),r=ke.parseValue(e.inheritScale,!0);this.inheritPosition==t&&this.inheritAngles==i&&this.inheritScale==r||(t&&i&&r||this.node.updateMatrixWorld(),this.inheritPosition=t,this.inheritAngles=i,this.inheritScale=r);var n=ke.parseValue(e.inheritStyle,!0);this.inheritStyle!=n&&(this.inheritStyle=n),this.inheritVisible=ke.parseValue(e.inheritVisible,!0)},e.prototype.setupParent=function(e){if(!e.skipSetupParent&&!e.independent){var t=e.parent;if(t)t.isBaseObject?this._parent=t:console.error("[BaseObject] Please make sure parent is BaseObject");else-1!==Object.keys(e).indexOf("parent")&&void 0===t&&console.warn("The parent argument is undefined, Please check parent argument for creating object");null==this._parent&&void 0===t&&(this._parent||(this._parent=this.app.root)),this._parent&&(this._parent._style&&this._parent._style._inheritThemeName&&this.applyTheme(this._parent._style._inheritThemeName,!1),this._parent._add(this,e,-1))}},e.prototype.customSetup=function(e){},e.prototype._beforeSetup=function(e){},e.prototype._notifyCompleteEvent=function(t){this._stateFlags.hasFlags(e.stateHideBySceneFlag)&&(this._hideByScene=!0);var i=this;ke.timer.setTimeout((function(){i.trigger("load",{object:i}),i.trigger("complete",{object:i})}),1)},e.prototype._callComplete=function(e){this.loaded=ke.parseValue(e.loaded,!0),this.queryID&&this.app.objectManager.objects.set(this.queryID,this),this._notifyCompleteEvent(e),ke.parseValue(e.queryable,!0)||(this.canNotQueryFromSelector=!0),this.trigger(k.Create,{object:this}),this.app.trigger(k.Create,{object:this});var t=e.successCallback||e.complete;t&&t.call(this,{object:this}),this.app.needUpdate=!0},e.prototype._beforeSetupComplete=function(e){},e.prototype._afterSetupComplete=function(e){},e.prototype.useBottomCenterOfBoundingBoxAsPosition=function(){var e=this.boundingBox,t=e.center,i=e.size,r=this.node.children.map((function(e){var t=new THREE.Vector3;return e.getWorldPosition(t),t}));this.position=t,this.translateY(-i[1]/2),this.node.updateMatrixWorld();for(var n=0;n<this.node.children.length;n++){this.node.children[n]._setWorldPosition(r[n])}},e.prototype.setupComplete=function(e){this.loaded=ke.parseValue(e.loaded,!0),this._userData=this._userData||{},this._internalUserData=this._internalUserData||{},this.setupEffects(),this.setupTranslation(e),this.setupInheritAttributes(e),this._beforeSetupComplete(e),this.setupStyle(e),this.setupEnvMap(),this.setupMaterials(e),this.setupResources(e),this.setupCommands(e),this.static?this.node._synMatrixWorld():this.node.updateWorldMatrix(!1,!1),this._afterSetupComplete(e),this.selfUpdate(),this._callComplete(e)},e.prototype.setParent=function(e,t,i){var r=this._parent;if(r&&r!=e&&r.remove(this,!1),this._parent=e,e){var n=e.node;t||!this.node.parent?n&&n.add(this.node):this.node.attachToParent(n,this.app.scene,i),this._style&&this._style.alwaysOnTop&&this._style._setAlwaysOnTop(!0)}},e.prototype.synTickableObject=function(){this.isTickable?this.app.objectManager.addTickableObject(this):this.app.objectManager.removeTickableObject(this)},e.prototype._setDirtyFlag=function(e,t){if(this._boundingBoxControl&&(this._boundingBoxControl.dirty=!0),e)for(var i=this.parent;i;i=i.parent)i._boundingBoxControl&&(i._boundingBoxControl.dirty=!0);t&&this._children.forEach((function(e){e._setDirtyFlag(!1,!0)}))},e.prototype.getChildByPath=function(e,t){var i=e.search("/");if(-1!==i)i=e.substring(0,i),e=e.substring(i.length+1);else if(i=e,t){if(t(this,i))return this}else if(this._id==i)return this;for(var r=0;r<this._children.length;r++){var n=this._children[r],o=null;if(t?t(n,i)&&(o=n):n.id==i&&(o=n),o){var a=o.getChildByPath(e);if(a)return a}}return null},e.prototype._getBasePointNode=function(e){var t=this.node.traverseBreakable((function(t){return t.name.contains(e)}));return t||(t=this.node.traverseBreakable((function(t){return t.name==e}))),t},e.prototype._addFromCampus=function(e){},e.prototype.add=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if((e=e||{}).isBaseObject){if(e.parent==this)return!1;this._add(e,null,t)}else{var i=e.url;if(ke.isString(i)){var r=e.position||this.position,n=e.angles||e.localAngles||this.angles,o=ke.parseValue(e.isCamFitScene,!1),a=e.complete,s=this;this.app.create({type:"Campus",url:i,position:r,angles:n,isCamFitScene:o,complete:function(e){var t=e.object;s._addFromCampus(t),t.destroy(),s.dirty=!0,a&&a(),this.app.trigger("addFromCampusComplete")}})}else{var l=e.object;if(!ke.isNull(l)){if(l.parent==this)return!1;this._add(l,e,t)}}}},e.prototype._add=function(e,t,i){if(!e)return!1;if(!e.isBaseObject)return!1;e._builder=this.builder;var r=(t=t||{}).basePoint,n=t.offset||t.localPosition,o=t.angles||t.localAngles,a=ke.parseValue(t.keepNode,!1);if(this.node.updateWorldMatrix(!0,!1),a){var s=e.parent;if(s){var l=s._children.indexOf(e);-1!==l&&s._children.splice(l,1)}e._parent=this}else{var u=ke.parseValue(t.keepLocalPosition||t.node,!1),c=ke.parseValue(t.force||t.position||t.angles||t.scale,!1);e.setParent(this,u,c)}var h=void 0;if(ke.isString(r)){if(!(h=this._getBasePointNode(r)))return console.error("The '"+r+"' basePoint is not existing"),!1;var p=new THREE.Vector3;h.getWorldPosition(p),e.position=p.toArray(),n&&(e.position=THING.Math.addVector(e.position,n))}else n&&(e.localPosition=n);return o&&(e.angles=o),e._setDirtyFlag(!0,!1),i>=this._children.length||-1===i?this._children.push(e):this._children.splice(i,0,e),h&&e.node.attachToParent(h,!0),e.node.userData.removedNode&&(e.node.visible=!0,delete e.node.userData.removedNode),!0},e.prototype.remove=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return!1;if(!e.isBaseObject)return!1;if(!e.isChildOf(this))return!1;e._setDirtyFlag(!0,!1),e.node.updateWorldMatrix(!0,!1);var i=e.node.getParents();-1!==i.indexOf(this.app.scene)&&(e.node.attachToParent(this.app.scene,!1),t&&(e.node.visible=!1,e.node.userData.removedNode=!0)),e._parent=null;var r=this._children.indexOf(e);return-1!==r&&this._children.splice(r,1),!0},e.prototype.swapChild=function(e,t){var i=this._children.indexOf(e),r=this._children.indexOf(t);-1!==i&&-1!==r&&THING.Math.swapArray(this._children,i,r)},e.prototype.hasChild=function(e){if(!e)return!!this._children.length;for(var t=0;t<this._children.length;t++){if(this._children[t]==e)return!0}return!1},e.prototype.destroy=function(){var e=this._notifyDestroy;e&&e.call(this),this.stopAllLerpTo();var t=this._style;t&&(t.isBaseStyle&&(t.alwaysOnTop=!1,t.glow=!1,t.setEdgeWireframe(null),t.revertMaterial()),t._obj=null),this.tickable=!1,this.removeAllControls(!1),this.app.objectManager.destroy(this);for(var i=this._children.concat(),r=0;r<i.length;r++)i[r].destroy();this._children=[],this.clearAttachPoints(),this.clearNode(),this._parent&&(this._parent.remove(this),this._parent=null),this.node.parent&&this.node.parent.remove(this.node),this.app.events.unbindCallObj(null,null,null,[this]),this._lodNode=null,this._queryID="",delete this.node.userData.getObject,this.app.needUpdate=!0},e.prototype.getRaycastPosition=function(e){if(!e)return null;var t=new THREE.Raycaster;t.ray.origin=ke.parseVector3(this.position),t.ray.direction=ke.parseVector3(e);var i=t.intersectObject(this.app.scene,!0);if(!i.length)return null;for(var r=0;r<i.length;r++){var n=i[r],o=n.object;if(this.app.objectManager.getBaseObject(o)&&!o.isChildOf(this.node))return n.point.toArray()}return null},e.prototype.removePickingResources=function(){this.app.picker.removePickingResources(this.node)},e.prototype.setPickable=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._pickable=e;var i=this;if(this._traverseSelfNodes((function(t){t.setPickable(e,!1),e||i.app.picker.removePickingResources(t)})),t)for(var r=0;r<this._children.length;r++){var n=this._children[r];n.inheritPickable&&(n.pickable=e)}},e.prototype.synPickable=function(){this.setPickable(this._pickable)},e.prototype.localToSelf=function(e){return this.worldToSelf(this.localToWorld(e))},e.prototype.selfToLocal=function(e){return this.worldToLocal(this.selfToWorld(e))},e.prototype.worldToSelf=function(e){var t=ke.parseVector3(e);return this.node.updateWorldMatrix(!0),this.node.worldToLocal(t).toArray()},e.prototype.selfToWorld=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=ke.parseVector3(e);if(this.node.updateWorldMatrix(!0),t){var i=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Quaternion;this.node.matrixWorld.decompose(i,n,r);var o=new THREE.Matrix4;return o.compose(i,n,new THREE.Vector3(1,1,1)),e.applyMatrix4(o).toArray()}return this.node.localToWorld(e).toArray()},e.prototype.localToWorld=function(e){return this._parent?this._parent.selfToWorld(e):this.node.localToWorld(ke.parseVector3(e)).toArray()},e.prototype.worldToLocal=function(e){if(this._parent)return this._parent.worldToSelf(e);var t=ke.parseVector3(e);return this.node.worldToLocal(t).toArray()},e.prototype.distanceTo=function(e){return e?(e.isBaseObject&&(e=e.position),ke.parseVector3(this.position).distanceTo(ke.parseVector3(e))):0},e.prototype._lookAtPosition=function(){this.node._lookAtPosition(this._lookingAtObject,this.static),this.synIndependentWorldAngles()},e.prototype.lookAt=function(e,t){if(e){var i,r,n;if(t=t||{},ke.isArray(t)?i=t:(i=t.angles,r=ke.parseValue(t.lockYAxis,!1)),e.isBaseObject?n=e.position:e.isCameraController?n=e.cameraObject.position:(n=e,e=null),!n)return void console.error("lookAt failed, due to target is not existing");var o=ke.parseValue(t.always,!0);if(this._lookingAtObject={target:e,targetPosition:ke.parseVector3(n),type:"axis",axis:r?"y":null,quat:ke.parseQuaternion(i)},this.node.quaternion.set(0,0,0,1),this.node.updateWorldMatrix(!0,!1),this.node.up.set(0,1,0),e&&e.isCameraController){var a=this.parents.query(".Campus")[0];if(a){var s=a.up;this.node.up.set(s[0],s[1],s[2])}}o?this.tickable=!0:(this._lookAtPosition(),this._lookingAtObject=null)}else this._lookingAtObject=null,this.node.up.set(0,1,0)},e.prototype.rotate=function(e,t){var i=THING.Math.degToRad(e);(t=ke.parseVector3(t||[0,1,0])).normalize(),this.node.rotateOnAxis(t,i),this.synIndependentWorldAngles(),this.dirty=!0},e.prototype.rotateX=function(e){isNaN(e)||(this.node.rotateX(THING.Math.degToRad(e)),this._synWorldAngles())},e.prototype.rotateY=function(e){isNaN(e)||(this.node.rotateY(THING.Math.degToRad(e)),this._synWorldAngles())},e.prototype.rotateZ=function(e){isNaN(e)||(this.node.rotateZ(THING.Math.degToRad(e)),this._synWorldAngles())},e.prototype.rotateAround=function(e){var t=(e=e||{}).object,i=e.target,r=ke.parseValue(e.yRotateAngle||e.angle,0),n=ke.parseValue(e.xRotateAngle,0),o=e.time,a=e.speed,s=ke.parseLoopType(e.loopType),l=e.stop,u=e.update,c=e.complete;if(i&&(i.isBaseObject?(t=i,i=null):i=ke.parseVector3(i)),o){if(a=0,!r&&!n)return void console.error("Please provide yRotateAngle or xRotateAngle to rotate around object")}else a?o=16777215:r||n?(a=0,o=1e3):(a=10,o=16777215);var h=ke.parseVector3(this.position),p=new THREE.Spherical,d=h.clone(),f=i||ke.parseVector3(t.position);d.sub(f),p.setFromVector3(d),this.stopRotating(),this.rotating=!0;var m=this.position,g=new THREE.Vector3,v=p.theta,y=p.phi,b=this,_=function(){s==THREE.LoopOnce?c&&c():s==THREE.LoopRepeat?(b.position=m,b.rotateAround(e)):s==THREE.LoopPingPong&&(void 0!==r&&(e.yRotateAngle=-r),void 0!==n&&(e.xRotateAngle=-n),b.rotateAround(e))},x=function(){var e=!1;if(a){var o=r>0?a:-1*a;p.theta+=o/1e3;var s=v+THING.Math.degToRad(r);r>0?p.theta>=s&&(p.theta=s,e=!0):p.theta<=s&&(p.theta=s,e=!0)}else{var c=this._object.progress;r&&(p.theta=v+c*THING.Math.degToRad(r)),n&&(p.phi=y+c*THING.Math.degToRad(n))}var h=i?i.clone():ke.parseVector3(t.position);if(p.radius=b.distanceTo(h.toArray()),p.makeSafe(),g.setFromSpherical(p),h.add(g),b.node.position.copy(h),u&&u(),e){var d=l;l=null,this.stop(),l=d,_.call(this)}};this.rotateTween=new TWEEN.Tween({progress:0}).to({progress:1},o).easing(A.Linear.None).onStop((function(){l&&l()})).onUpdate((function(){x.call(this)})).onComplete((function(){_.call(this)})),this.rotateTween.start()},e.prototype.rotateOnWorldAxis=function(e){e=e||{};var t=ke.parseVector3(e.axis),i=e.angle;if(t&&i){t.normalize();var r=THING.Math.degToRad(i);this.node.rotateOnWorldAxis(t,r),this.static&&this.node._synMatrixWorld()}},e.prototype.rotateTo=function(e){var t=(e=e||{}).angles||e.localAngles,i=e.time,r=e.speed,n=e.lerpType||A.Linear.None,o=e.loopType||D.No,a=e.complete,s=ke.parseVector3(this.angles),l=s.clone(),u=ke.parseVector3(t),c=ke.getConsumeTime(null,s,u,i,r,2e3);this.stopRotating(),this.rotating=!0;var h=this;this.rotateTween=new TWEEN.Tween(s).to(u,c).easing(n).onUpdate((function(){h.angles=[this._object.x,this._object.y,this._object.z]})).onComplete((function(){o==D.Repeat?(h.angles=l.toArray(),h.rotateTo(e)):o==D.PingPong?(e.angles=l.toArray(),h.rotateTo(e)):a&&a.call(h,{object:h})})).start()},e.prototype.stopRotating=function(){this.rotating=!1,this.rotateTween&&this.rotateTween.stop()},e.prototype.scaleTo=function(e){var t=(e=e||{}).scale||[1,1,1],i=e.time,r=e.speed,n=e.lerpType||A.Linear.None,o=e.loopType||D.No,a=e.complete;t[2]=t[2]||1;var s=ke.parseVector3(this.scale),l=s.clone(),u=ke.parseVector3(t),c=ke.getConsumeTime(null,s,u,i,r,2e3);this.stopScaling(),this.scaling=!0;var h=this;this.scaleTween=new TWEEN.Tween(s).to(u,c).easing(n).onUpdate((function(){h.scale=[this._object.x,this._object.y,this._object.z]})).onStop((function(){})).onComplete((function(){o==D.Repeat?(h.scale=l.toArray(),h.scaleTo(e)):o==D.PingPong?(e.scale=l.toArray(),h.scaleTo(e)):a&&a.call(h,{object:h})})).start()},e.prototype.stopScaling=function(){this.scaling=!1,this.scaleTween&&this.scaleTween.stop()},e.prototype.canAcceptEvent=function(e){var t=e.type,i=e.object;if("update"==t)return!0;if(w[t])return!0;if(i&&i.isChildOf(this)){if("mouseover"==t)return!0;if("mousedown"==t)return!0;if("mouseup"==t)return!0}return!1},e.prototype._createDispatchEvent=function(e){var t=this.app.events,i={};if(E[e]){var r=t.mouseMovePos;i=t.createMouseEvent(e,{clientX:r[0],clientY:r[1]})}return i},e.prototype._on=function(e,t,i,r,n,o){return this.app.events.bindCallObj(e,t,i,r,[this],n,!1,o)},e.prototype._off=function(e,t,i){return this.app.events.unbindCallObj(e,t,i,[this])},e.prototype._one=function(e,t,i,r,n,o){var a=ke.parseEvent(t,i,r,n,o);return this.app.events.bindCallObj(e,a.selector,a.userData,a.callback,[this],a.tag,!0,a.priority)},e.prototype._pauseEvent=function(e,t,i,r){t?this.app.events.pauseEvent(e,t,i,r,this):this.parent&&this.parent.pauseEvent(e,this,i,r)},e.prototype._resumeEvent=function(e,t,i){t?this.app.events.resumeEvent(e,t,i,this):this.parent&&this.parent.resumeEvent(e,this,i)},e.prototype.on=function(e,t,i,r,n,o){for(var a=this._on(e,t,i,r,n,o),s=0;s<this._controls.length;s++){var l=this._controls[s].control;ke.isFunction(l.onRegisterEvent)&&l.onRegisterEvent(e,a)}return this},e.prototype.off=function(e,t,i){for(var r=this._off(e,t,i),n=0;n<this._controls.length;n++){var o=this._controls[n].control;ke.isFunction(o.onUnregisterEvent)&&o.onUnregisterEvent(e,r)}return this},e.prototype.one=function(e,t,i,r,n,o){for(var a=this._one(e,t,i,r,n,o),s=0;s<this._controls.length;s++){var l=this._controls[s].control;ke.isFunction(l.onRegisterEvent)&&this._controls.onRegisterEvent(e,a,!0)}return this},e.prototype.hasAnyEvents=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.app.events.hasAnyCallObjects([this],e)},e.prototype.hasEvent=function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e=ke.toLowerCase(e),this.app.events.hasEvent(e,this,t,i)},e.prototype.trigger=function(e,t,i){return this.app.events.dispatchBindCallObj(e,t,[this],i)},e.prototype.pauseEvent=function(e,t,i){this._pauseEvent(e,t,i,!1)},e.prototype.pauseEventInFrame=function(e,t,i){this._pauseEvent(e,t,i,!0)},e.prototype.resumeEvent=function(e,t,i){this._resumeEvent(e,t,i)},e.prototype.isPauseEvent=function(e,t){return this.app.events.isPauseEvent(e,this,t)},e.prototype.getEvents=function(e){var t=this.app.events.getEvents(e,this);if(!t)return[];for(var i=[],r=0;r<t.length;r++){var n=t[r];i.push({callback:n.callback,type:n.type,priority:n.priority,userData:n.userData,tag:n.tag})}return i},e.prototype._traverseObjects=function(e,t){for(var i=0;i<this._children.length;i++){var r=this._children[i];ke.isFunction(e)?e(r):ke.isArray(e)&&e.push(r),t&&r._traverseObjects(e,t)}},e.prototype._isChildNode=function(e){for(var t=this.children,i=0,r=t.length;i<r;i++){var n=t[i];if(e==n.node||e.isChildOf(n.node))return!0}return!1},e.prototype._getChildNodes=function(){var e=[];return this.children.forEach((function(t){e.push(t.node)})),e},e.prototype._traverseSelfNodes=function(e){if(e){var t=this._getChildNodes();this.node.traverseBranch((function(i){if(-1!==t.indexOf(i))return!1;e(i)}))}},e.prototype._traverseNodes=function(e,t,i){for(var r=0;r<e.children.length;r++){var n=e.children[r],o=n.userData.baseObject_bindSubNode;o||((o=THING.SubObject.create(n,this)).name=n.name),ke.isFunction(t)?t(o):ke.isArray(t)&&t.push(o),i&&this._traverseNodes(n,t,i)}},e.prototype.isSubNode=function(){return!!this.node.userData.baseObject_bindSubNode},e.prototype.traverse=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&(e(this),this._traverseObjects(e,t))},e.prototype.query=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(ke.isString(e)&&e.startsWith("/"))return console.warn("[BaseObject] Please use '.subNodes.query()' to replace it, and remove '/' prefix of params"),this.subNodes.query(new RegExp(e.substring(1)),t);var r=[];this._traverseObjects(r,t),i&&r.push(this);var n=new ct(this.app,r);return n.select(e),n},e.prototype._queryChild=function(e){var t=new ct(this.app,this._children);return t.select(e),t},e.prototype.isChildOf=function(e){if(!e)return!1;for(var t=this._parent;t;){if(t==e)return!0;t=t.parent}return!1},e.prototype.isBrotherOf=function(e){if(!e)return!1;var t=this._parent;return!!t&&-1!==t._children.indexOf(e)},e.prototype.clearAttachPoints=function(){if(this._attachPoints){for(var e=0;e<this._attachPoints.length;e++)this._attachPoints[e].destroy();this._attachPoints=null}},e.prototype.isAttachPoint=function(e){if(e&&e.node)for(var t=["dummy:","point:","connector:"],i=0;i<t.length;i++)if(e.name.startsWith(t[i]))return!0;return!1},e.prototype.translate=function(e){this.node.translateX(e[0]),this.node.translateY(e[1]),this.node.translateZ(e[2]),this.static&&this.node._synMatrixWorld(),this.synIndependentWorldPosition(),this.dirty=!0},e.prototype.translateX=function(e){this.translate([e,0,0])},e.prototype.translateY=function(e){this.translate([0,e,0])},e.prototype.translateZ=function(e){this.translate([0,0,e])},e.prototype.moveTo=function(e){var t=e.offset||e.offsetPosition||e.localPosition,i=e.direction,r=ke.parseValue(e.ignoreScale,!0);if(t)t=ke.parseVector3(t);else if(i){t=ke.parseVector3(i);var n=ke.parseValue(e.distance,5);t.multiplyScalar(n)}t&&(e.position=this.selfToWorld(t.toArray(),r)),this.movePath(e)},e.prototype.createPathTween=function(e,t,i,r,n,o){var a,s=ke.parseVector3(e).clone(),l=ke.parseVector3(t).clone();if(i){!o&&n&&(o=new THREE.Matrix4,n.updateWorldMatrix(!0,!1),o.getInverse(n.matrixWorld));var u=new THREE.Matrix4,c=s.clone(),h=l.clone();c.applyMatrix4(o),h.applyMatrix4(o),u.lookAt(h,c,this.node.up);var p=new THREE.Quaternion;if(p.setFromRotationMatrix(u),r){var d=new THREE.Quaternion;d.setFromAxisAngle(new THREE.Vector3(0,1,0),THING.Math.degToRad(r)),p.multiply(d)}a=p}return{distance:s.distanceTo(l),from:s,to:l,toQuat:a}},e.prototype.createPathTweens=function(e,t,i,r){var n=new THREE.Matrix4;e&&(e.updateWorldMatrix(!0,!1),n.getInverse(e.matrixWorld));for(var o=0;o<t.length-1;o++){var a=t[o],s=t[o+1],l=this.createPathTween(a,s,i,r,e,n);this.pathTweens.push(l)}},e.prototype.startPathTweens=function(e,t,i,r,n,o,a,s,l,u,c,h){var p=function(e){for(var t=0,i=0;i<e.length;i++)t+=e[i].distance;return t}(this.pathTweens);if(p){i&&(e=p/i*1e3,a=A.Linear.None);var d=-1,f={progress:p},m=function(e,t){for(var i=[],r=0;r<e.length;r++)i.push(e[r].distance/t);return i}(this.pathTweens,p),g=new THREE.Vector3,v=new THREE.Quaternion,y=this;this.pathTween=new TWEEN.Tween({progress:0}).to(f,e).easing(a).delay(t).onUpdate((function(){var e=this._object.progress/p,t=ke.getArrayIndexFromProgress(y.pathTweens,e,m),i=ke.getArrayProgress(y.pathTweens,e,m),a=y.pathTweens[t];t!=d&&(d=t,r&&(a.fromQuat=y.node.quaternion.clone())),n?y.node.lookAt(n):r&&(o?(v.copy(s?a.fromQuat:y.node.quaternion),v.slerp(a.toQuat,i),y.angles=ke.parseAngles(v)):y.angles=ke.parseAngles(a.toQuat)),g.copy(a.from),g.lerp(a.to,i),y.position=g.toArray(),l&&l({progress:e,fromPosition:a.from.toArray(),toPosition:a.to.toArray()})})).onStart((function(){u&&u()})).onStop((function(){c&&c()})).onComplete((function(){h&&h()})).start()}else h&&h()},e.prototype.movePath=function(e){var t,i=(e=e||{}).path,r=e.time||1e3,n=ke.parseValue(e.delayTime,0),o=e.speed,a=ke.parseValue(e.local,!1),s=ke.parseValue(e.orientToPath,!1),l=e.orientToPathDegree,u=e.lookAt,c=e.loopType,h=function(e){return null!==e.lerp&&null!==e.lerpType&&ke.parseValue(e.lerp,!0)}(e),p=e.lerpType||A.Linear.None,d=ke.parseValue(e.smooth,!0),f=e.update,m=e.complete;e.loop&&(c=D.Repeat,console.warn('[BaseObject] movePath() use "loopType(THING.LoopType)" to instead "loop(Boolean)" argument'));var g=this.parents.query(".Campus")[0];if(t=g?g.node:this.node.parent,i){if(e.path=i.concat(),a){var v=[];if(t){t.updateWorldMatrix(!0,!1);for(var y=t.matrixWorld,b=0;b<i.length;b++){var _=ke.parseVector3(i[b]);_.applyMatrix4(y),v.push(_.toArray())}}else for(b=0;b<i.length;b++)v.push(this.localToWorld(i[b]));i=v}1===i.length&&(i=[this.position,i[0]])}else{var x=e.position;x&&(i=[this.position,x]),i&&(e.path=i.concat())}if(i&&0!=i.length){u&&(s=null,u=ke.parseVector3(u)),this.stopMoving();var E=[];for(b=0;b<i.length;b++){var w=null;2==i[b].length?w=new THREE.Vector3(i[b][0],this.position[1],i[b][1]):3==i[b].length&&(w=ke.parseVector3(i[b])),E.push(w)}this.createPathTweens(t,E,s,l);var T=this.pathTweens[0].from;this.position=[T.x,T.y,T.z];var S=this;this.startPathTweens(r,n,o,s,u,h,p,d,(function(e){f&&(e.object=S,f.call(S,e))}),(function(){}),(function(){}),(function(){c==D.Repeat?S.movePath(e):c==D.PingPong?(e.path.reverse(),void 0!==e.orientToPathDegree&&(e.orientToPathDegree=360-e.orientToPathDegree),S.movePath(e)):m&&m.call(S,{object:S})}))}else console.error("You must provide the path or position to call moveTo()")},e.prototype.stopMoving=function(){this.pathTweens=[],this.pathTween&&this.pathTween.stop()},e.prototype.hasAttribute=function(e){return ke.hasAttribute(this,e)},e.prototype.getAttribute=function(e){return ke.getAttribute(this,e)},e.prototype.setAttribute=function(e,t){return ke.setAttribute(this,e,t)},e.prototype.setAttributes=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(var i in e=e||{})(t||ke.isUndefined(this[i]))&&this.setAttribute(i,e[i])},e.prototype.selfUpdate=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this,i=0;if(this._style&&ke.isFunction(this._style.update)&&(i|=this._style.update(e)),this._localClippingPlane){var r=this._localClippingPlaneBase.clone();r.applyMatrix4(this.node.matrixWorld),this._localClippingPlane.normal=r.normal,this._localClippingPlane.constant=r.constant,i=!0}if(this._lodNode&&(-1!=this._lodLevel?this._lodNode.setLevel(this._lodLevel):this._lodNode.update(this.app.renderCamera),i=!0),this._lookingAtObject){if(this._lookingAtObject.target){var n=this._lookingAtObject.target.position;this._lookingAtObject.targetLocalPosition=ke.parseVector3(this.worldToLocal(n)),this._lookingAtObject.targetPosition=ke.parseVector3(n)}this._lookAtPosition(),i=!0}this._independentPosition&&(this._getIndependentControlRenderNode()._setWorldPosition(this._independentPosition.clone(),!1,this.static),i=!0),this._independentWorldAngles&&(this._getIndependentControlRenderNode()._setWorldAngles(this._independentWorldAngles.clone(),this.static),i=!0),this._independentWorldScale&&(this._getIndependentControlRenderNode()._setWorldScale(this._independentWorldScale.clone(),this.static),i=!0);var o=this.builder;if(o&&o.startToBuildingQueue&&o.startToBuildingQueue.length){if(!o._isBuilding){var a=o.startToBuildingQueue.shift();o._isBuilding=!0,o.startToBuild((function(e){a.progressCallback&&a.progressCallback({progress:e}),o._isBuilding=!1,t.tickable=!0}))}i=!0}return i},e.prototype.update=function(e){for(var t=this.selfUpdate(e),i=0;i<this._controls.length;i++){var r=this._controls[i].control,n=r.onUpdate;n&&(t|=n.call(r,e))}return t},e.prototype.createGrid=function(e,t,i,r){this._grid=this.app.create({type:"Grid",size:e,divisions:t,color1:i,color2:r,parent:this}),this._grid.style.skipBoundingBox=!0,this._grid.userData.topNode=!0,this._grid.userData.skipOutline=!0,this._grid.userData.independent=!0,this._grid.canNotQueryFromSelector=!0;this._grid.translateY(-.01)},e.prototype.showGrid=function(e,t,i,r){var n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(ke.isBoolean(e)){var o=e;o&&(this._grid||this.createGrid(300,28,1131673,1131673)),this._grid&&(this._grid.visible=o)}else if(this._grid&&(this._grid.destroy(),this._grid=null),this.createGrid(e,t,i,r),n){var a=e;ke.isNumber(n)&&(a=n),this._grid.addPickableGround({size:a})}},e.prototype.fade=function(e,t){var i=(e=e||{}).time||1e3,r=e.complete;this.fadeTween&&this.fadeTween.stop();var n={opacity:this.style.opacity},o={opacity:t};this.visible=!0;var a=this;this.fadeTween=new TWEEN.Tween(n).to(o,i).easing(TWEEN.Easing.Linear.None).onUpdate((function(){a.style.opacity=this._object.opacity})).onComplete((function(){0==a.style.opacity&&(a.visible=!1),r&&r.call(a,{object:a})})).start()},e.prototype.fadeIn=function(e){this.style.opacity=0,this.fade(e,1)},e.prototype.fadeOut=function(e){this.style.opacity=1,this.fade(e,0)},e.prototype.setClippingPlanes=function(e){var t=(e=e||{}).height,i=ke.parseVector3(e.direction,new THREE.Vector3(0,-1,0));this._localClippingPlaneBase=new THREE.Plane(i,t),this._localClippingPlane=this._localClippingPlaneBase.clone();var r=this;this.node.traverse((function(e){e.isMesh&&(e._clip_prev_material=e.material,e.material=e.material.clone(),e.material.clippingPlanes=[r._localClippingPlane])})),this.tickable=!0},e.prototype.clearClippingPlanes=function(){this.node.traverse((function(e){e.isMesh&&(e.material=e._clip_prev_material,e.material.clippingPlanes=null)})),this._localClippingPlaneBase=null,this._localClippingPlane=null},e.prototype.toJSON=function(){return{type:this.type,id:this.id,name:this.name,position:this.position,angles:this.angles,scale:this.scale,style:{color:this.style.color,opacity:this.style.opacity,outlineColor:this.style.outlineColor,alwaysOnTop:this.style.alwaysOnTop,glow:this.style.glow,innerGlow:this.style.innerGlow,renderOrder:this.style.renderOrder}}},e.prototype.addControl=function(e,t,i){if(e){if(ke.isString(t)&&(i=i||t,t={},this.removeControl(i)),!ke.isNumber(e)){if(this.hasControl(e))return console.error("The control is existing when addControl() with '"+e+"'"),null;this._controls.push({control:e,name:i});var r=e.onAdd;return ke.isFunction(r)&&r.call(e,this),this.tickable=!0,this.visible&&(this.app.needUpdate=!0),e}for(var n=[],o=0;o<n.length;o++){var a=n[o];if(a.id==e){var s=new a.type(this);return s.setup(t),this.addControl(s)}}return null}},e.prototype.getControl=function(e){for(var t=0;t<this._controls.length;t++)if(e==this._controls[t].name)return this._controls[t].control;return null},e.prototype.removeControl=function(e){if(e){var t=!1;if(ke.isString(e)){for(var i=0;i<this._controls.length;i++)if(this._controls[i].name==e){(n=(r=this._controls[i].control).onRemove)&&n.call(r),this._controls.splice(i,1),t=!0;break}}else for(i=0;i<this._controls.length;i++)if(this._controls[i].control==e){var r,n;(n=(r=this._controls[i].control).onRemove)&&n.call(r),this._controls.splice(i,1),t=!0;break}t&&this.visible&&(this.app.needUpdate=!0)}},e.prototype.removeAllControls=function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=0;t<this._controls.length;t++){var i=this._controls[t].control,r=i.onRemove;r&&r.call(i)}this._controls=[],e&&this.visible&&(this.app.needUpdate=!0)},e.prototype.hasControl=function(e){if(ke.isString(e)){for(var t=0;t<this._controls.length;t++)if(e==this._controls[t].name)return!0}else if(-1!==this._controls.indexOf(e))return!0;return!1},e.prototype.setWorldPosition=function(e){var t=ke.parseVector3(e);this.node._setWorldPosition(t,!1,this.static),this.dirty=!0},e.prototype.setWorldAngles=function(e){var t=ke.parseQuaternion(e);this.node._setWorldAngles(t,this.static),this.dirty=!0},e.prototype.setWorldScale=function(e){var t=ke.parseVector3(e);this.node._setWorldScale(t,this.static),this.dirty=!0},e.prototype.setLocalPosition=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=ke.parseVector3(e),r=ke.parseValue(t,this._ignoreParentScale);if(r){var n=this.node.parent;if(n){var o=new THREE.Vector3;this.node.updateWorldMatrix(!0,!1),n.getWorldScale(o),i.divide(o)}}this.localPosition=i.toArray()},e.prototype.getLocalPosition=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.node.position.clone();if(e){var i=new THREE.Vector3;this.node.updateMatrixWorld(),this.node.getWorldScale(i),t.multiply(i)}return t.toArray()},e.prototype._setScale=function(e){var t=ke.parseVector3(e);0==t.x&&(console.error("Please check scale-x value, it can not be zero"),t.x=Number.EPSILON),0==t.y&&(console.error("Please check scale-y value, it can not be zero"),t.y=Number.EPSILON),0==t.z&&(console.error("Please check scale-z value, it can not be zero"),t.z=Number.EPSILON),this._getIndependentControlRenderNode().scale.set(t.x,t.y,t.z),this.synIndependentWorldScale(),this.static&&this.node._synMatrixWorld(),this.dirty=!0},e.prototype._getScale=function(){return this._getIndependentControlRenderNode().scale.toArray()},e.prototype._synWorldAngles=function(){this.dirty=!0,this.synIndependentWorldAngles(),this.static&&this.node._synMatrixWorld()},e.prototype._getAttributeFromSelfToRoot=function(e){for(var t=this;t;t=t.parent){var i=t.node.userData[e];if(i)return i}return null},e.prototype._getBaseMatrix=function(){return this._getAttributeFromSelfToRoot("_baseMatrix")},e.prototype._getPosition=function(){this.node.updateWorldMatrix(!0,!1);var e=new THREE.Vector3;return this.node.getWorldPosition(e),e.toArray()},e.prototype._setPosition=function(e){e&&(this.setWorldPosition(e),this.synIndependentWorldPosition())},e.prototype._needUseWorldPosition=function(){return this._parent.node!=this.node.parent},e.prototype._setLocalPosition=function(e){if(this.anchorNode){var t=this.parent.localToWorld(e);this.node._setWorldPosition(t,!1,this.static)}else if(this._needUseWorldPosition()){if(!this._parent)return;var i=ke.parseVector3(this._parent.selfToWorld(e));this.node._setWorldPosition(i,!1,this.static)}else{var r=ke.parseVector3(e);this.node.position.copy(r),this.static&&this.node._synMatrixWorld()}this._setDirtyFlag(!1,!0,!0);var n=this._notifyPositionChange;n&&n.call(this)},e.prototype._getLocalPosition=function(){if(!this._parent)return[0,0,0];var e=this.anchorNode;if(e)return THING.Math.addVector(this.node.position.toArray(),e.position.toArray());if(this._needUseWorldPosition()){var t=new THREE.Vector3;return this.node.getWorldPosition(t),this._parent.node.worldToLocal(t),t.toArray()}return(t=this.node.position).toArray()},e.prototype._getAngles=function(){var e=this.node.parent;if(e&&e.userData.childUseWorldAnglesAlways)return this.worldAngles;return this.anchorNode?this.anchorNode.getAngles():this.node.getAngles()},e.prototype._setAngles=function(e){if(!THING.Math.equalsVector(this.angles,e)){var t=this.node;this.anchorNode&&(t=this.anchorNode),t.setAngles(e),this._synWorldAngles()}},e.prototype.setAnchorPosition=function(e){if(e){var t=this.anchorNode;t?(t.children[0].getWorldPosition(yt),mt.fromArray(e),t._setWorldPosition(mt,!1,this.static),t.updateWorldMatrix(!1,!1),t.children[0]._setWorldPosition(yt,!1,this.static)):(t=new THREE.Object3D,this.node.parent.add(t),mt.fromArray(e),t._setWorldPosition(mt,!1,this.static),t.updateWorldMatrix(!1,!1),t.attach(this.node),this.anchorNode=t)}else this.anchorNode.parent.attach(this.anchorNode.children[0]),this.anchorNode.removeBySelf(),this.anchorNode=null},e.prototype.getAnchorPosition=function(){var e=this.anchorNode;return e?(e.getWorldPosition(yt),this.worldToSelf(yt.toArray())):[0,0,0]},e.prototype.getBoundingBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.boundingBoxControl.getBoundingBox(e,t)},e.prototype.getOrientedBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.boundingBoxControl.getOrientedBoundingBox(e,t)},e.prototype.getLocalBoundingBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.boundingBoxControl.getLocalBoundingBox(e,t)},e.prototype._updateKeepSize=function(e,t,i,r){return this._keepSize!=e&&(this._keepSize=e,e?(r=r||this.distanceTo(this.app.camera.position),i=i||this.scale,this.addControl(new ft(i,t,r),"SizeAdjustmentControl")):this.removeControl("SizeAdjustmentControl"),!0)},e.prototype.getOffsetPosition=function(e){if(e=e||{},!ke.isNull(e.xAngle)||!ke.isNull(e.yAngle)){var t=ke.parseValue(e.onlyVisible,!0),i=ke.parseValue(e.yAngle,0),r=ke.parseValue(e.xAngle,0),n=this.boundingBoxControl.getBoundingBox(t),o=ke.parseValue(e.distance||e.radius,n.radius),a=e.radiusFactor;return a&&(o=n.radius*a),(new THREE.Vector3).getDirectionFromAngles(i,r,o).toArray()}if(e.direction){var s=ke.parseVector3(e.direction),l=e.distance||e.radius;s.multiplyScalar(l);var u=ke.parseVector3(this.position);return u.add(s),this.worldToSelf(u.toArray())}},e.prototype.getWorldPosition=function(e){var t=this.getOffsetPosition(e)||[0,0,0];return this.selfToWorld(t)},e.prototype.getLayoutPosition=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!ke.isArray(e))return null;if(3!==e.length)return null;var o=i?this.getOrientedBox(r,n):this.getBoundingBox(r,n),a=o.points,s=[];if(i)for(var l=0;l<a.length;l++)s.push(this.worldToSelf(a[l]));else s=a.concat();var u=[[s[0],s[1]],[s[0],s[4]],[s[0],s[2]]],c=function(e,t){var i=0;ke.isString(t)?t.equals("left",!0)||t.equals("bottom",!0)||t.equals("back",!0)?i=0:t.equals("right",!0)||t.equals("top",!0)||t.equals("front",!0)?i=1:t.equals("center",!0)&&(i=.5):ke.isNumber(t)?i=t:console.error("get layout position failed, due to unknown layout type("+t+")");var r=ke.parseVector3(e[0]),n=ke.parseVector3(e[1]);return r.lerp(n,i),r},h=c(u[0],e[0]).x,p=c(u[1],e[1]).y,d=c(u[2],e[2]).z,f=[h,p,d];if(i||(f=this.worldToSelf(f)),t){var m=this.worldToSelf(t);f=THING.Math.subVector(m,f)}return f=this.selfToWorld(f)},e.prototype._getStyle=function(){return this._style||(this._style=this.app.styleManager.createStyle("Default",this),this._defaultStyle=this._style),this._style},e.prototype.applyTheme=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.style._inheritThemeName=e||null,t&&this.children.forEach((function(t){return t.applyTheme(e,!0,i)})),this.userData.SKIP_THEME||"Facade"==this.type&&this.building&&this.building.userData.SKIP_THEME||(this.loaded?this.style._applyTheme&&this.style._applyTheme(e,i):this.waitCommands.push({type:"ApplyObjectTheme",object:this,params:{name:e,force:i}}))},e.prototype._getChildVisibles=function(){var e=[];return this.children.forEach((function(t){e.push(t.visible)})),e},e.prototype._setChildVisible=function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",r=this.children,n=0;n<r.length;n++){var o=r[n];if(o.inheritVisible)o._setVisible(e,i);else{var a=t[n],s=o._visibleGroupStates.states;for(var l in s)if(s[l]==a){o._setVisible(a,l);break}}}},e.prototype._setNodeVisible=function(e){var t=this;this._traverseSelfNodes((function(i){i.userData.asBoundingBox||i.ensureVisible(e,t._autoSynVisible)}))},e.prototype._getHidePermission=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=this._visibleGroupStates.states;for(var i in t)if(i!=e&&t[i])return!1;return!0},e.prototype._setVisible=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";if(!this._hideNodesInScene){this._visibleGroupStates.enable(e,t);var i=this._visibleGroupStates.isAnyEnable();THING.disableVisibleGroupStates&&(i=this._visibleGroupStates.isEnable("default"));var r=this.visible,n=this._notifyBeforeChangeVisible;n&&n.call(this);var o=this._getChildVisibles();i&&this._autoEnsureParentsVisible&&this.node.ensureParentsVisible(i),this._setNodeVisible(i),this._setChildVisible(e,o,t);for(var a=0;a<this._controls.length;a++){var s=this._controls[a].control;ke.isFunction(s.onVisible)&&s.onVisible(i)}var l=this._notifyAfterChangeVisible;l&&l.call(this),r!=i&&(this.app.needUpdate=!0)}},e.prototype._getVisible=function(){return!this._hideNodesInScene&&(!!this.node.visible&&this.node.getLayerVisible())},e.prototype._getChildrenSelector=function(){var e=new ct(this.app,this.children);return e.buildReturnObject(this.children),e},e.prototype._getChildren=function(){return this._children.filter((function(e){return!e.isCombinedObject}))},e.prototype._getBrothers=function(){var e=this,t=void 0,i=this._parent;t=i?i._children.filter((function(t){return t!==e})):[];var r=new ct(this.app,t);return r.buildReturnObject(t),r.not(".CombinedObject"),r},e.prototype._getParents=function(){for(var e=[],t=this._parent;t;t=t.parent)e.push(t);var i=new ct(this.app,e,!0);return i.buildReturnObject(e),i.not(".CombinedObject"),i},e.prototype.indexOfParent=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._parent;if(!t)return-1;var i=this._parent._children.indexOf(this);if(-1===i)return-1;if(e){i=0;for(var r=this._parent._children,n=0;n<r.length;n++){var o=r[n];if(o==this)return i;o.type==this.type&&i++}}return i},e.prototype._loadResource=function(e){e&&this._children.forEach((function(e){e.loadResource()}))},e.prototype._unloadResource=function(e){e&&this._children.forEach((function(e){e.unloadResource()}))},e.prototype._notifyLoadingObjects=function(){var e=this.parents.query(".Campus")[0];e&&e._loadingObjects.add(this)},e.prototype._loadSelfResource=function(){var e=this.builder;e&&e.requestToBuild&&e.requestToBuild(this.uuid)},e.prototype.loadResource=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.builder;t&&t.requestToBuild&&(this._loadResource(e),this._notifyLoadingObjects(),this._loadSelfResource(),this.loaded&&(this.dataToRecover=this.toJSON()))},e.prototype.unloadResource=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.builder;if(t&&t.disposeObject){this._unloadResource(e);var i=[],r=this;this._traverseSelfNodes((function(e){r.app.resourceManager.unload(e,!1,!1,!1,!1),e.material&&(e.disposeMaterial(),i.push(e))})),i.forEach((function(e){e.removeBySelf()})),t.disposeObject(this.id),this.loaded=!1}},e.prototype.startToBuild=function(e){var t=this.builder;t&&ke.isFunction(t.startToBuild)&&(t.startToBuildingQueue=t.startToBuildingQueue||[],t.startToBuildingQueue.push({progressCallback:e}),this.tickable=!0)},e.prototype.clearNode=function(e){this._url&&(this.app.modelResource.unload(this._url),this._url=null),this.removePickingResources(),this.app.resourceManager.remove(this.node,e)},e.prototype.cloneSelf=function(e){return this.app.create(e)},e.prototype.clone=function(e,t){var i={type:this.type,url:this.url,position:this.position,angles:this.angles,scale:this.scale,visible:this.visible,parent:t||this._parent};if(!this.url){var r=this,n=this.node.cloneByFilter((function(e){for(var t=0;t<r._children.length;t++){var i=r._children[t].node;if(e==i||e.isChildOf(i))return!1}return!0}));n.traverse((function(e){e.userData={}})),i.node=n}var o=this.cloneSelf(i);if(!o)return null;if(e)for(var a=0;a<this._children.length;a++)this._children[a].clone(e,o);return o},e.prototype.getEnvMapResources=function(){for(var e=this.parents,t=0;t<e.length;t++){var i=e[t].envMapResources;if(i)return i}return null},e.prototype._synEffectRefCounts=function(){var e=this.app.sceneManager;this.node.traverse((function(t){t.technique&&t.technique.glow&&e._updatEffectRefCounts("glow",1),t.technique&&t.technique.innerGlow&&e._updatEffectRefCounts("innerGlow",1)}))},e.prototype._processBillboard=function(e,t){var i=this;e.setUserDataValue("skipOutline",!0),t.billboard=!0,e._lookAt(t,(function(){return i.static}))},e.prototype._processModel=function(){var e=this;this.node.traverse((function(t){var i=t.userData.gltfExtensions;i&&i.billboard&&(i.billboard.axis="y",e._processBillboard(t,i.billboard),delete i.billboard)}))},e.prototype.synIndependentWorldPosition=function(){if(this._independentControlFlags.hasFlags(j.Position)){var e=new THREE.Vector3;this._getIndependentControlRenderNode().getWorldPosition(e),this._independentPosition=e}var t=this._notifyPositionChange;t&&t.call(this)},e.prototype.synIndependentWorldAngles=function(){if(this._independentControlFlags.hasFlags(j.Rotation)){var e=this._getIndependentControlRenderNode().quaternion.clone();this._independentWorldAngles=e}var t=this._notifyAnglesChange;t&&t.call(this)},e.prototype.synIndependentWorldScale=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this._independentControlFlags;if(t.hasFlags(j.Scale)){var i=this._getIndependentControlRenderNode()._getWorldScale();if(this._ignoreParentScale){var r=this.node.parent;if(r){var n=r._getWorldScale();i.divide(n)}}this._independentWorldScale=i}var o=this._notifyScalesChange;o&&o.call(this),e&&(this.dirty=!0)},e.prototype.synIndependentTransform=function(e){e&j.Position&&this.synIndependentWorldPosition(),e&j.Rotation&&this.synIndependentWorldAngles(),e&j.Scale&&this.synIndependentWorldScale()},e.prototype._getIndependentControlRenderNode=function(){return this.node},e.prototype._useIndependentTransform=function(e){var t=this._getIndependentControlRenderNode();e.updateWorldMatrix(!0);var i=e.matrixWorld,r=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Quaternion;i.decompose(r,o,n);var a=new THREE.Matrix4;a.getInverse(t.matrixWorld);var s=new THREE.Matrix4;if(s.premultiply(a),s.multiply(i),t.updateWorldMatrix(!0),this._independentPosition?r=this._independentPosition.clone():r.setFromMatrixPosition(t.matrixWorld),this._independentWorldAngles){if(o=this._independentWorldAngles.clone(),!this._independentPosition){var l=this.parent.node,u=this.parent.node.getMatrixWorldFromRoot(l.parent),c=new THREE.Matrix4;this._independentWorldScale||(c.compose(new THREE.Vector3,new THREE.Quaternion,l.scale),u.multiply(c)),u.multiply(t.matrix);var h=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Quaternion;u.decompose(h,d,p),r=h}}else t.matrixWorld.decompose(mt,o,gt);this._independentWorldScale?n=this._independentWorldScale.clone():t.matrixWorld.decompose(mt,vt,n);var f=new THREE.Matrix4;f.compose(r,o,n),i.multiplyMatrices(f,s)},e.prototype._useIndependentRaycast=function(e){var t=this._getIndependentControlRenderNode();if(t)if(e){t.userData.original_raycast=t.userData.original_raycast||t.raycast;var i=this;t.raycast=function(e,t){var r=i._getIndependentControlRenderNode();return r&&i._useIndependentTransform(r),this.userData.original_raycast.call(this,e,t)}}else t.userData.original_raycast&&(t.raycast=t.userData.original_raycast,delete t.userData.original_raycast)},e.prototype._enableIndependentControl=function(e){var t=this;this.node.removeBeforeRenderFunction("independentControlRender");var i=!1,r=this._independentControlFlags;if(r.hasFlags(j.Transform)){this.node.traverse((function(e){ke.backupValue(e,"frustumCulled"),e.frustumCulled=!1})),this.synIndependentTransform(e),this.tickable=!0;var n=this._getIndependentControlRenderNode();if(!n.hasBeforeRenderFunction("independentControlRender")){t=this;n.addBeforeRenderFunction("independentControlRender",(function(e,i,r){t._useIndependentTransform(this)}),0)}i=!0}else this.node.traverse((function(e){ke.revertValue(e,"frustumCulled")}));return r.hasFlags(j.Position)||(this._independentPosition=null),r.hasFlags(j.Rotation)||(this._independentWorldAngles=null),r.hasFlags(j.Scale)||(this._independentWorldScale=null),this._useIndependentRaycast(i),i},e.prototype.enableIndependentControl=function(e,t){var i=this._independentControlFlags.diff(e,!0);return!!this._independentControlFlags.enableFlags(e,t)&&this._enableIndependentControl(i)},e.prototype.stopAllLerpTo=function(){for(var e=0;e<this._tweens.length;e++)this._tweens[e].tween.stop();this._tweens=[]},e.prototype.stopLerpTo=function(e){for(var t=0;t<this._tweens.length;t++)e==this._tweens[t].name&&(this._tweens[t].tween.stop(),this._tweens.splice(t--,1))},e.prototype.lerpTo=function(e,t){var i=function(e){for(var t={},i=Object.keys(e),r=0;r<i.length;r++){var n=i[r],o=e[n];if(ke.isArray(o)){if(3==o.length)(a=ke.parseVector3(o))&&(o=a,t["__"+n+"_x"]=o.x,t["__"+n+"_y"]=o.y,t["_#vector3"+n]=o.z);else if(2==o.length){var a;(a=ke.parseVector2(o))&&(o=a,t["__"+n+"_x"]=o.x,t["_#vector2"+n]=o.y)}}else t[n]=o}return t},r=function(e,t,i){for(var r=0;r<e.length;r++){if(!(o=e[r]).startsWith("__")){var n=i[o];if(o.startsWith("_#vector3"))n=[i["__"+(o=o.substring(9))+"_x"],i["__"+o+"_y"],n];else if(o.startsWith("_#vector2")){var o;n=[i["__"+(o=o.substring(9))+"_x"],n]}else n=i[o];ke.setAttribute(t,o,n)}}},n=i((e=e||{}).from||{}),o=i(e.to||{}),a=e.time||1e3,s=ke.parseValue(e.delayTime,0),l=e.start,u=e.update,c=e.stop,h=e.complete,p=e.lerpType||THING.LerpType.Linear.None,d=ke.parseLoopType(e.loopType);n.__progress=ke.parseValue(n.__progress,0),o.__progress=ke.parseValue(o.__progress,1);var f=0;t&&this.stopLerpTo(t);var m=Object.keys(n),g=this,v=new TWEEN.Tween(n).to(o,a).delay(s).easing(p).onStop((function(){if(c){var e={object:g};r(m,e,this._object),r(m,g,this._object),c.call(g,e)}})).onStart((function(){var e={object:g,delta:0};r(m,e,this._object),r(m,g,this._object),l&&l.call(g,e)})).onUpdate((function(){var e=this._object.__progress-f;f=this._object.__progress;var t={object:g,delta:e};r(m,t,this._object),r(m,g,this._object),u&&u.call(g,t)})).onComplete((function(){var i=this._object.__progress-f;f=this._object.__progress;var n={object:g,delta:i};if(r(m,n,this._object),r(m,g,this._object),d==THREE.LoopOnce)h&&h.call(g,n);else if(d==THREE.LoopRepeat)g.lerpTo(e,t);else if(d==THREE.LoopPingPong){var o=e.from;e.from=e.to,e.to=o,g.lerpTo(e,t)}})).start();this._tweens.push({name:t,tween:v})},e.prototype._getLinkableObjects=function(){var e=new ct(this.app),t=this.userData._Portal_;if(t){var i=this.app.query(t)[0];i&&e.add(i)}return e},e.prototype._getLinkableDoors=function(){return this._queryChild("[_Portal_]")},e.prototype._setupNavigationGraph=function(e,t){e[this.id]=e[this.id]||{};for(var i=this._getLinkableDoors(),r=0;r<i.length;r++){var n=i[r];e[n.id]=e[n.id]||{},e[this.id][n.id]=e[n.id][this.id]=t;for(var o=n._getLinkableObjects(),a=0;a<o.length;a++){var s=o[a];e[s.id]=e[s.id]||{},e[s.id][n.id]=e[n.id][s.id]=t}}},e.prototype.setupGraph=function(){if(this._graph)return this._graph;var e={};return this._setupNavigationGraph(e,1e4),this._graph=new Graph(e),this._graph},e.prototype.findPath=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=this.getNavigation();return r?r.findPath({startPosition:e,endPosition:t,height:i}):null},e.prototype.getFindingPathLength=function(e,t){var i=this.findPath(e,t);return i?i.getPathLength():0},e.prototype.showNavigationHelper=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getNavigation();t&&t.showHelper(e)},e.prototype.canNavigation=function(){return!1},e.prototype.getNavigation=function(e){return this.canNavigation()?(this._navigation||(this._navigation=new Qe(this)),(e||this._navigation.needGen())&&this._navigation.init(e),this._navigation):null},e.prototype.changeAppearance=function(e){if(this.__appearanceNode!=e)if(e){e.visible=!0,this.node.add(e);for(var t=0;t<this.node.children.length;t++){(i=this.node.children[t]).visible&&i!=e&&(i.visible=!1,i.__appearanceNode=e)}this.__appearanceNode=e}else{e.visible=!1,e.removeBySelf();for(t=0;t<this.node.children.length;t++){var i;(i=this.node.children[t]).__appearanceNode&&(i.visible=!0,delete i.__appearanceNode)}delete this.__appearanceNode}},e.prototype._getScreenSize=function(e){var t=this.app.camera;e=e||this.distanceTo(t.position);var i=THING.Math.degToRad(t.fov),r=2*Math.tan(i/2)*e;return[r*t.aspect,r]},e.prototype.getAllObjectsInChildren=function(e){console.warn("[BaseObject] Please use '.children' to replace 'getAllObjectsInChildren()'");for(var t=0;t<this._children.length;t++)e.push(this._children[t])},e.prototype.dispatch=function(e){console.warn("[BaseObject] Please use 'trigger' to replace 'dispatch' when you want to launch event"),this.trigger(e)},e.prototype.upPosition=function(e){return console.warn("[BaseObject] Please use '.this.selfToWorld([0, distance, 0])' to replace 'upPosition()'"),this.selfToWorld([0,e,0])},e.prototype.downPosition=function(e){return console.warn("[BaseObject] Please use '.this.selfToWorld([0, -distance, 0])' to replace 'downPosition()'"),this.selfToWorld([0,-e,0])},e.prototype.setPosition=function(e,t,i){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace 'setPosition()'"),this.position=[e,t,i]},e.prototype.setX=function(e){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.x='");var t=this.position;t[0]=e,this.position=t},e.prototype.setY=function(e){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.y='");var t=this.position;t[1]=e,this.position=t},e.prototype.setZ=function(e){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.z='");var t=this.position;t[2]=e,this.position=t},e.prototype.show=function(e){console.warn("[BaseObject] Please use '.visible=true/false' to replace 'show()'"),void 0===e&&(e=!0),this.visible=e},e.prototype.hide=function(){console.warn("[BaseObject] Please use '.visible=false' to replace 'hide()'"),this.visible=!1},e.prototype.flipVisible=function(){console.warn("[BaseObject] Please use '.visible=!.visible' to replace 'flipVisible()'"),this.visible=!this.visible},e.prototype.attr=function(){return console.warn("[BaseObject] Please use 'userData[x]' to replace 'attr()'"),0==arguments.length?this.userData:1==arguments.length?this.userData[arguments[0]]:void(2==arguments.length&&(this.userData[arguments[0]]=arguments[1]))},e.prototype.moveX=function(e){console.warn("[BaseObject] Please use '.translate([d, 0, 0])' to replace 'moveX(d)'"),this.translate([e,0,0])},e.prototype.moveY=function(e){console.warn("[BaseObject] Please use '.translate([0, d, 0])' to replace 'moveY(d)'"),this.translate([0,e,0])},e.prototype.moveZ=function(e){console.warn("[BaseObject] Please use '.translate([0, 0, d])' to replace 'moveZ(d)'"),this.translate([0,0,e])},e.prototype.hasShowBoundingBox=function(){return console.warn("[BaseObject] Please use '.style.boundingBox' to replace 'hasShowBoundingBox()'"),this.style.boundingBox},e.prototype.showBoundingBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[BaseObject] Please use '.style.boundingBox' to replace 'showBoundingBox()'"),this.style.boundingBox=e},e.prototype.getAncestor=function(e){return console.warn("[BaseObject] Please use '.parents.query(param)' to replace '.getAncestor(param)'"),this.parents.query(e)},e.prototype.getSubNodeIndex=function(e){return console.warn('[BaseObject] we do not support ".getSubNodeIndex()" anymore, please do not use it'),-1},e.prototype.getSubNodesNumber=function(){return console.warn('[BaseObject] we do not support ".getSubNodesNumber()" anymore, please do not use it'),0},e.prototype.getSubNodeByIndex=function(e){return console.warn('[BaseObject] we do not support ".getSubNodeByIndex()" anymore, please do not use it'),null},e.prototype.removeSubNodeByIndex=function(e){console.warn('[BaseObject] we do not support ".removeSubNodeByIndex()" anymore, please do not use it')},e.prototype.insertSubNode=function(e,t){console.warn('[BaseObject] we do not support ".insertSubNode()" anymore, please do not use it')},e.prototype.createSubNode=function(e){return console.warn('[BaseObject] we do not support ".createSubNode()" anymore, please do not use it'),null},e.prototype.setPolygonOffset=function(e){console.warn("[BaseObject] Please use '.style.setPolygonOffset(params)' to replace '.setPolygonOffset(params)'"),this.style.setPolygonOffset(e)},o(e,[{key:"pickable",set:function(e){this._pickable!=e&&(this._pickable=e,this.synPickable())},get:function(){return!(this.node&&!this.node.getPickable())&&this._pickable}},{key:"subNodes",get:function(){var e=[];this._traverseNodes(this.node,e,!0);var t=new ct(this.app,e);return t.buildReturnObject(e),t}},{key:"attachPoints",get:function(){if(!this._attachPoints){this._attachPoints=[];var e=this;this.node.traverse((function(t){var i=t.userData;if(i&&i.isBaseObject){var r=e.app.objectManager.get(i.id);e.isAttachPoint(r)&&(e._attachPoints.push(r),e.app.objectManager.destroy(r))}}))}var t=new ct(this.app);return t.buildReturnObject(this._attachPoints),t}},{key:"isBaseObject",get:function(){return!0}},{key:"destroyed",get:function(){return!this._queryID}},{key:"internalUserData",get:function(){return this._internalUserData},set:function(e){this._internalUserData=e}},{key:"uuid",set:function(e){this._uuid=e},get:function(){return this._uuid}},{key:"type",set:function(e){this._type=e},get:function(){return this._type}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"queryID",set:function(e){this._queryID=e},get:function(){return this._queryID}},{key:"userData",set:function(e){this._userData=e},get:function(){return this._userData}},{key:"tags",set:function(e){this._tags=e},get:function(){return this._tags}},{key:"groups",get:function(){return this._groups}},{key:"gridSize",get:function(){return this._grid?this._grid.size:0}},{key:"controls",get:function(){return this._controls}},{key:"x",set:function(e){var t=this.position;this.position=[e,t[1],t[2]]},get:function(){return this.position[0]}},{key:"y",set:function(e){var t=this.position;this.position=[t[0],e,t[2]]},get:function(){return this.position[1]}},{key:"z",set:function(e){var t=this.position;this.position=[t[0],t[1],e]},get:function(){return this.position[2]}},{key:"position",set:function(e){this._setPosition(e)},get:function(){return this._getPosition()}},{key:"localPosition",set:function(e){this._setLocalPosition(e)},get:function(){return this._getLocalPosition()}},{key:"angleX",set:function(e){var t=this.angles;this.angles=[e,t[1],t[2]]},get:function(){return this.angles[0]}},{key:"angleY",set:function(e){var t=this.angles;this.angles=[t[1],e,t[2]]},get:function(){return this.angles[1]}},{key:"angleZ",set:function(e){var t=this.angles;this.angles=[t[1],t[2],e]},get:function(){return this.angles[2]}},{key:"angles",set:function(e){this._setAngles(e)},get:function(){return this._getAngles()}},{key:"worldAngles",set:function(e){this.setWorldAngles(e),this._synWorldAngles()},get:function(){var e=new THREE.Quaternion;return this.node.getWorldQuaternion(e),ke.parseAngles(e)}},{key:"selfForward",get:function(){var e=new THREE.Vector3;return this.node.getDirection(e),e.normalize(),e.toArray()}},{key:"forward",get:function(){var e=new THREE.Vector3;return this.node.updateMatrixWorld(!0),this.node.getWorldDirection(e),e.normalize(),e.toArray()}},{key:"up",get:function(){var e=this.node.up.clone();return this.node.updateMatrixWorld(!0),e.transformDirection(this.node.matrixWorld),e.toArray()}},{key:"cross",get:function(){var e=ke.parseVector3(this.up),t=ke.parseVector3(this.forward),i=new THREE.Vector3;return i.crossVectors(e,t),i.normalize(),i.toArray()}},{key:"scale",set:function(e){this._setScale(e)},get:function(){return this._getScale()}},{key:"worldScale",set:function(e){this.setWorldScale(e),this.synIndependentWorldScale(),this.dirty=!0},get:function(){var e=new THREE.Vector3;return this.node.getWorldScale(e),e.toArray()}},{key:"anchor",set:function(e){this.setAnchorPosition(e)},get:function(){return this.getAnchorPosition()}},{key:"boundingBoxControl",get:function(){return this._boundingBoxControl||(this._boundingBoxControl=new Ke(this),this.addControl(this._boundingBoxControl)),this._boundingBoxControl}},{key:"boundingBox",get:function(){return this.boundingBoxControl.getBoundingBox(!0)}},{key:"orientedBoundingBox",get:function(){return this.boundingBoxControl.getOrientedBoundingBox(this.visible)}},{key:"radius",get:function(){return this.boundingBoxControl.getBoundingBox(this.visible).radius}},{key:"size",get:function(){return this.boundingBoxControl.getBoundingBox(this.visible).size}},{key:"center",get:function(){return this.boundingBoxControl.getBoundingBox(this.visible).center}},{key:"keepSize",set:function(e){this._updateKeepSize(e,this.node),this.dirty=e},get:function(){return this._keepSize}},{key:"style",set:function(e){this._style=e},get:function(){return this._getStyle()}},{key:"catchEventAnyTime",set:function(e){this._catchEventAnyTime=e},get:function(){return this._catchEventAnyTime}},{key:"draggable",set:function(e){this._draggable!=e&&(this._draggable=e,e?this.on("dragging",(function(e){if(e.picked){var t=e.object;t==this&&(t.position=THING.Math.addVector(t.position,e.offsetPosition),this.trigger("drag",e))}}),"__object_drag__"):this.off("dragging",null,"__object_drag__"))},get:function(){return this._draggable}},{key:"dragState",get:function(){return this._dragState}},{key:"tickable",set:function(e){this.isTickable!=e&&(this.isTickable=e,this.synTickableObject(),this.app.needUpdate=!0)},get:function(){return this.isTickable}},{key:"renderDistance",set:function(e){this._renderDistance=e,ke.isNull(e)?this.app.objectManager.removeRenderDistanceObject(this):this.app.objectManager.addRenderDistanceObject(this)},get:function(){return this._renderDistance}},{key:"shadowDistance",set:function(e){this._shadowDistance=e,ke.isNull(e)?this.app.objectManager.removeShadowDistanceObject(this):this.app.objectManager.addShadowDistanceObject(this)},get:function(){return this._shadowDistance}},{key:"visible",set:function(e){this._setVisible(e)},get:function(){return this._getVisible()}},{key:"dirty",set:function(e){e&&(this._setDirtyFlag(!0,!0),this.visible&&(this.app.needUpdate=!0))}},{key:"disableUpdateBoundingBox",set:function(e){this.boundingBoxControl.disable!=e&&(this.boundingBoxControl.disable=e,e||(this.dirty=!0))},get:function(){return this.boundingBoxControl.disable}},{key:"static",get:function(){return this.app.root.static}},{key:"children",get:function(){return this._getChildren()}},{key:"brothers",get:function(){return this._getBrothers()}},{key:"parents",get:function(){return this._getParents()}},{key:"parent",get:function(){return this._parent}},{key:"levelFromRoot",get:function(){for(var e=0,t=this.parent;t;t=t.parent)e++;return e}},{key:"loaded",get:function(){return this._loadState==e.loadCompleted},set:function(t){this._loadState=t?e.loadCompleted:e.waitForLoading}},{key:"loading",get:function(){return this._loadState==e.loading},set:function(t){t&&(this._loadState=e.loading)}},{key:"builder",get:function(){for(var e=this;e;e=e.parent){var t=e._builder;if(t)return t}return null}},{key:"verticesNumber",get:function(){return ke.isFunction(this.node.verticesCount)?this.node.verticesCount():0}},{key:"meshNames",get:function(){return this.node.getMeshNames()}},{key:"inheritVisible",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Visible,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Visible)}},{key:"inheritStyle",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Style,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Style)}},{key:"inheritPosition",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Position,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Position)}},{key:"inheritAngles",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Rotation,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Rotation)}},{key:"inheritScale",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Scale,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Scale)}},{key:"inheritPickable",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Pickable,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Pickable)}},{key:"owner",get:function(){return this.parent}},{key:"_hideByScene",set:function(e){if(e){var t=new THREE.Group;t.position.copy(this.node.position),t.quaternion.copy(this.node.quaternion),t.scale.copy(this.node.scale);var i=this.node.parent;this._hideNodesInScene=this.node,this.node.removeBySelf(),this.setupNode(t),i&&i.add(t)}}},{key:"lodLevel",get:function(){return this._lodLevel},set:function(e){var t=this;this.loaded?(this._lodNode||this.node.traverse((function(e){"LOD"==e.type&&(t._lodNode=e,t.tickable=!0)})),this._lodNode&&(this._lodNode.autoUpdate=-1==e,this._lodLevel=e)):this.waitCommands.push({type:"setObjectLodLevel",object:this,params:{level:e}})}},{key:"lodLevelNumber",get:function(){var e=this;return this._lodNode||this.node.traverse((function(t){"LOD"==t.type&&(e._lodNode=t,e.tickable=!0)})),this._lodNode?this._lodNode.levels.length:0}},{key:"self",get:function(){return console.warn("[BaseObject] Please do not use '.self'"),this}},{key:"custom",get:function(){return console.warn("[BaseObject] Please use '.userData' to replace '.custom'"),this.userData}},{key:"boxSize",get:function(){return console.warn("[BaseObject] Please use '.size' to replace '.boxSize'"),this.size}},{key:"boxRadius",get:function(){return console.warn("[BaseObject] Please use '.radius' to replace '.boxRadius'"),this.radius}},{key:"localAngles",set:function(e){console.warn("[BaseObject] Please use '.angles' to replace '.localAngles'"),this.angles=e},get:function(){return console.warn("[BaseObject] Please use '.angles' to replace '.localAngles'"),this.angles}},{key:"isShowBoundingBox",get:function(){return console.warn("[BaseObject] Please use '.hasShowBoundingBox()' to replace '.isShowBoundingBox'"),this.hasShowBoundingBox()}},{key:"building",get:function(){return console.warn("[BaseObject] Please use '.getAncestor('.Building')[0]' to replace '.building'"),this.parents.query(".Building")[0]}},{key:"ancestors",get:function(){return console.warn("[BaseObject] Please use '.parents' to replace '.ancestors'"),this.parents}},{key:"root",get:function(){return console.warn("[BaseObject] Please use 'this.parents.query('.Campus')[0]')' to replace '.root'"),this.parents.query(".Campus")[0]}},{key:"boxCenter",get:function(){return console.warn("[BaseObject] Please use '.center' to replace '.boxCenter'"),this.center}},{key:"lockOffset",set:function(e){console.warn("[BaseObject] Please use '.inheritPosition' to replace '.lockOffset'"),this.inheritPosition=!e},get:function(){return console.warn("[BaseObject] Please use '.inheritPosition' to replace '.lockOffset'"),!this.inheritPosition}},{key:"showDetail",set:function(e){console.warn('[BaseObject] we do not support ".showDetail" anymore, please do not use it')}},{key:"renderOrder",set:function(e){console.warn("[BaseObject] please use .style.renderOrder to replace .renderOrder"),this.style.renderOrder=e},get:function(){return console.warn("[BaseObject] please use .style.renderOrder to replace .renderOrder"),this.style.renderOrder}},{key:"CSG",get:function(){return console.error('[BaseObject] ".CSG" has been removed.'),!1}}]),e}(),_t=function(){function e(t){n(this,e),this.app=t}return e.prototype.load=function(e,t){var i=void 0,r=void 0;null!==e&&(ke.isString(e)?(i=e,r=e):ke.isArray(e)?(i=e[0],r=e[1]):(i=this.app.skyBox||null,r=null));var n=null,o=null;return r&&(n=this.app.resourceManager.loadCubeTexture(r)),i&&(o=this.app.resourceManager.loadCubeTexture(i)),{indoorsEnvMap:n,outdoorsEnvMap:o}},e}(),xt=function(){function e(t){n(this,e),t=t||"",this._major=0,this._minor=0,this._modified=0;var i=t.split(".");i.length&&(this._major=parseInt(i.length>=1?i[0]:0),this._minor=parseInt(i.length>=2?i[1]:0),this._modified=parseInt(i.length>=3?i[2]:0))}return e.prototype.compare=function(t){return ke.isString(t)&&(t=new e(t)),this._major!=t._major?this._major>t._major?1:-1:this._minor!=t._minor?this._minor>t._minor?1:-1:this._modified!=t._modified?this._modified>t._modified?1:-1:0},o(e,[{key:"major",get:function(){return this._major}},{key:"minor",get:function(){return this._minor}},{key:"modified",get:function(){return this._modified}}]),e}(),Et=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));r.name="Campus",r._url="",r._sceneJSONData={},r._originalSceneString="",r._envMapResources=null,r._loadingObjects=new ct(r.app),r._ground=null;var o=r;return r.one("beforeload",null,(function(e){var t=new _t(o.app);o._envMapResources=t.load(o.app.options.env,e.indexJson.resourceLibrary)})),r.one("load",null,(function(){pe()&&(o.node.position.z+=ie(-15,11)),o.getEnvMapResources()&&o.query(".Thing || .Facade").forEach((function(e){e.setupEnvMap(e.isFacade)})),o.query(".Building").forEach((function(e){e.setupNavigationObjects()}));for(var e=o._getLinkableDoors(),t=0;t<e.length;t++){var i=e[t],r=i.userData._Portal_;if(r){var n=o.app.query(r)[0];n&&(n.userData._Portal_=i.id)}}o.query(".Facade").forEach((function(e){e.setupTextureAnimations()})),o.query(".Floor").forEach((function(e){var t=e.plan;t&&(t.style.renderOrder=-10),e.rooms.forEach((function(e){var t=e.plan;t&&(t.style.renderOrder=-10)}));var i=e.wall;i&&(i.style.renderOrder=-9)}))})),r}return a(t,e),t.prototype.canAcceptEvent=function(t){if(e.prototype.canAcceptEvent.call(this,t))return!0;var i=t.type,r=t.object;if(r&&r.isChildOf(this)){if("click"==i)return!0;if("dblclick"==i)return!0;if("singleclick"==i)return!0}return!1},t.prototype.setupFromURL=function(e){e.isCamFitScene=ke.parseValue(e.isCamFitScene,!1),this._url=this.app.confirmURL(e.url),this.app.campusLoader.load(this,e)},t.prototype.setupFromData=function(e){e.url="./",e.fileloader={load:function(t,i,r,n){var o=e.data[t.getFileName()];o?i&&i(o):n&&n()}},this.setupFromURL(e)},t.prototype.customSetup=function(e){this.setupID(e);var t=e.basePosition,i=e.baseAngles;if(t||i){var r=ke.parseVector3(t,new THREE.Vector3(0,0,0)),n=ke.parseQuaternion(i,new THREE.Quaternion),o=(new THREE.Matrix4).compose(r,n,new THREE.Vector3(1,1,1));this.node.userData._baseMatrix=o;var a=this;THREE.Object3D.prototype.onBeforeUpdateModelViewMatrix=function(e,t,i,r,n,o){if(n){var s=function(e){for(var t=e;t;t=t.parent){var i=t.userData._baseMatrix;if(i)return i}return null}(this);return!s||(this.frustumCulled=!1,this.__matrixWorld=this.__matrixWorld||new THREE.Matrix4,this.__matrixWorld.copy(this.matrixWorld),this.matrixWorld.premultiply(s),n.isShaderMaterial||a.app.camera.frustum.intersectsObject(this))?void 0:null}},THREE.Object3D.prototype.onAfterUpdateModelViewMatrix=function(e,t,i,r,n,o){this.__matrixWorld&&this.matrixWorld.copy(this.__matrixWorld)}}},t.prototype.destroy=function(){this._url&&this.app.trigger("unload",{url:this._url}),this._floorNode=null,this.buildings.destroyAll(),this.app.resourceManager.disposeTextures(this._envMapResources),e.prototype.destroy.call(this)},t.prototype._setupNavigationGraph=function(t,i){var r=this;e.prototype._setupNavigationGraph.call(this,t,i);for(var n=this._getLinkableDoors(),o=0;o<n.length;o++){var a=n[o];t[a.id]=t[a.id]||{};for(var s=a._getLinkableObjects(),l=0;l<s.length;l++){var u=s[l];t[u.id]=t[u.id]||{},t[u.id][a.id]=t[a.id][u.id]=i;var c=u.parents.query(".Floor")[0];if(c){var h=c.getRoomFromWorldPosition(u.position);h&&(t[h.id]=t[h.id]||{},t[u.id][h.id]=t[h.id][u.id]=i)}}}this.query(".Building").forEach((function(e){e.query(".Floor").forEach((function(e){e._setupNavigationGraph(t,i)}))})),this._queryChild(".Room").forEach((function(e){t[e.id]=t[e.id]||{},t[r.id][e.id]=t[e.id][r.id]=i}))},t.prototype.canNavigation=function(){return!0},t.prototype.getNavigationData=function(){var e=this;function t(e,t){e.push(t.min.x),e.push(t.min.z),e.push(t.min.x),e.push(t.max.z),e.push(t.max.x),e.push(t.max.z),e.push(t.max.x),e.push(t.min.z)}function i(e,t){for(var i=0;i<e.length;i++){var r=e[i];if(r.intersectsBox(t))return void r.union(t)}e.push(t)}function r(e,t){if(t!=e){if(t.isBuilding)return!0;if(t.isThing)return!0}return!1}var n=[];t(n,(new THREE.Box3)._setFromObject(this.node));for(var o=function(t){for(var n=[],o=t.children,a=0;a<o.length;a++){var s=o[a];if(r(t,s)){var l=(new THREE.Box3)._setFromObject(s.node),u=new THREE.Vector3;l.getSize(u),u.equals(new THREE.Vector3)||i(n,l)}}return function(t){for(var i=0;i<t.length;i++)for(var r=t[i],n=i+1;n<t.length;n++)if(r.intersectsBox(t[n])){r.union(t[n]),t.splice(n,1),i=-1;break}for(i=0;i<t.length;i++){var o=t[i],a=e.worldToLocal(o.min.toArray()),s=e.worldToLocal(o.max.toArray());o.min=ke.parseVector3(a),o.max=ke.parseVector3(s)}}(n),n}(this),a=0;a<o.length;a++)t(n,o[a]);var s=[];for(a=0;a<o.length;a++)s.push(4*(s.length+1));return{data:n,holes:s}},t.prototype.getNavigationMesh=function(){var e=this.getNavigationData(),t=EarCut(e.data,e.holes);if(!t)return null;for(var i=[],r=0;r<e.data.length;r+=2)i.push(e.data[r]),i.push(0),i.push(e.data[r+1]);var n=new THREE.BufferGeometry;n.setIndex(t),n.addAttribute("position",new THREE.BufferAttribute(new Float32Array(i),3));var o=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.5});return new THREE.Mesh(n,o)},t.prototype.setSceneJSONData=function(e,t){e=e||{},this._originalSceneString=t,this._sceneJSONData=e;var i=this._sceneJSONData;if(i){var r=i.camInfo;r&&(r.eye=ke.parseVector3(r.eye),r.eye.z*=-1,r.eye=r.eye.toArray(),r.target=ke.parseVector3(r.target),r.target.z*=-1,r.target=r.target.toArray())}},o(t,[{key:"isCampus",get:function(){return!0}},{key:"envMapResources",get:function(){return this._envMapResources}},{key:"url",get:function(){return this._url}},{key:"floorNode",set:function(e){this._floorNode=e},get:function(){return this._floorNode}},{key:"ground",get:function(){return this._ground||(this._ground=this.query(".Ground")[0]),this._ground}},{key:"sceneJSONData",get:function(){return this._sceneJSONData}},{key:"buildings",get:function(){return this.query(".Building",!1)}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"version",get:function(){return this._version||new xt}}]),t}(bt),wt=function(){function e(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n(this,e),this._private={};var r=this._private;r.lockQueue=[],r.enable=i,r.onChange=t,r.notifyChangeEvent=function(){var e=r.onChange;e&&e(r.enable)},r.setEnable=function(e){var t=r.enable;r.enable=e,t!=r.enable&&r.notifyChangeEvent()},r.getLockState=function(e){for(var t=r.lockQueue,i=0;i<t.length;i++){var n=t[i];if(n.name==e)return{prevEnableState:n.prevEnableState,enable:n.enable,name:n.name,index:i}}return null}}return e.prototype.isEnable=function(){return this._private.enable},e.prototype.enable=function(e){this.isLock()||this._private.setEnable(e)},e.prototype.isLock=function(e){return!!this._private.getLockState(e)},e.prototype.lock=function(e,t){if(!this.isLock(t)){var i=this._private;i.lockQueue.push({prevEnableState:i.enable,enable:e,name:t}),i.setEnable(e)}},e.prototype.unlock=function(e){var t=this._private,i=t.getLockState(e);if(i){var r=i.prevEnableState;t.lockQueue.splice(i.index,1);for(var n=i.index;n<t.lockQueue.length;n++)t.lockQueue[n].prevEnableState=r;t.lockQueue.length&&(r=t.lockQueue[t.lockQueue.length-1].enable),t.setEnable(r)}},e}(),Tt=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));r._defaultCampus=new Et(i);var o=new _t(i);r._envMapResources=o.load(i.options.env);var a=r;return r._staticEnableFlag=new wt((function(e){a.app.scene.autoUpdate!=!e&&(a.app.scene.autoUpdate=!e,e&&a.app.scene.updateMatrixWorld())}),!1),r.init(),r}return a(t,e),t.prototype.init=function(){this.loaded=!0,this.campuses.destroyAll(),this.app.scene.add(this.node)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.app.resourceManager.disposeTextures(this._envMapResources)},t.prototype.cleanup=function(){this.app.scene.cleanup()},o(t,[{key:"canNotQueryFromSelector",get:function(){return!0}},{key:"envMapResources",get:function(){return this._envMapResources}},{key:"visible",set:function(e){this.app.scene.visible=e},get:function(){return this.app.scene.visible}},{key:"defaultCampus",get:function(){var e=this.campuses;return e.length?e[0]:this._defaultCampus}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"campuses",get:function(){return this.query(".Campus",!1)}},{key:"wireframeColor",set:function(e){var t=ke.parseColor(e),i=this.app.scene;i.overrideMaterial=t?new THREE.MeshBasicMaterial({color:t,wireframe:!0,side:THREE.DoubleSide,skinning:!0}):null}},{key:"static",set:function(e){this._staticEnableFlag.enable(e)},get:function(){return this._staticEnableFlag.isEnable()}}]),t}(bt),St=2*Math.PI,At=[{name:"baseColorTexture",property:"map"},{name:"alphaTexture",property:"alphaMap"}],Mt=function(){function e(t){n(this,e),this.object=null,this.app=null,this.needResponeAddEvent=t,this._textureAnimations=new Map}return e.prototype._init=function(e){var t=this;e&&(this.clearAllAnimations(),e.traverse((function(e){e.material&&(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.userData.gltfExtensions&&At.forEach((function(i){var r=e.userData.gltfExtensions[i.name];if(r){var n=e[i.property];if(n){var o=void 0;if(Array.isArray(r.textureExtensions))if(r.textureExtensions.length>1)if(e["_replace_"+i.property]&&e["_replace_"+i.property].length===r.textureExtensions.length){var a=[];r.textureExtensions.forEach((function(r,n){var o=t._parseSimpleAnimation(e["_replace_"+i.property][n],r.extensions);o&&a.push(o)})),o=new Dt(e,i.property,a)}else console.warn("texture animation parse error!");else 1===r.textureExtensions.length&&(o=t._parseSimpleAnimation(n,r.textureExtensions[0].extensions));else o=t._parseSimpleAnimation(n,r);if(o&&(t._textureAnimations.set(o.id,o),o.texture))for(;;){e[i.property]=o.texture,e.needsUpdate=!0;var s=e._getPrevMaterial();if(s==e)break;e=s}}}}))}))})),this._textureAnimations.size&&(this.object.tickable=!0))},e.prototype._parseSimpleAnimation=function(e,t){if(t){if(t.multiFramesAnim)return new jt(e,t);if(t.scrollAnim||t.rotateAnim||t.scaleAnim||t.multiFramesAnim||t.scroll||t.scale||t.wrapMode)return new Ft(e,t)}return new Pt(e)},e.prototype.onAdd=function(e){if(this.object=e,this.app=e.app,this._init(this.object.node),this.needResponeAddEvent){var t=this.object.node.children[0];if(t){var i=this;t.addEventListener("addedChild",(function(e){i._init(e.object)}))}}delete this.needResponeAddEvent},e.prototype.onRemove=function(){this.clearAllAnimations()},e.prototype.onUpdate=function(e){return this._textureAnimations.forEach((function(t){return t.update(e)})),this.app.rendererManager._mainRenderer.dirty("SmallGlow"),this._textureAnimations.size>0},e.prototype.clearAllAnimations=function(){this._textureAnimations.forEach((function(e){return e.dispose()})),this._textureAnimations.clear()},e.prototype.getAllAnimations=function(){return Array.from(this._textureAnimations.values())},e}();Mt.hasTextureAnimation=function(e){return!!e.traverseBreakable((function(e){if(e.material)for(var t=Array.isArray(e.material)?e.material:[e.material],i=0;i<t.length;i++){var r=t[i];if(r.userData.gltfExtensions)for(var n=0;n<At.length;n++){var o=At[n],a=r.userData.gltfExtensions[o.name];if(a){if(a.textureExtensions)return!0;if(a.scrollAnim||a.rotateAnim||a.scaleAnim||a.multiFramesAnim||a.scroll||a.scale||a.wrapMode)return!0}}}}))};var Ct=0,Rt=function(){function e(t,i){if(n(this,e),this.id=Ct++,this.texture=t.clone(),i){var r=999+(void 0!==i.wrapMode?parseInt(i.wrapMode):1);this.texture.wrapS=this.texture.wrapT=r}this.texture.needsUpdate=!0,this.start={offset:[0,0],repeat:[1,1],rotation:0},this._isRunning=!0,this._loop=1/0,this._callback=function(){},this.timeScale=1}return e.prototype.update=function(e){},e.prototype._resetTexture=function(){this.texture.offset.fromArray(this.start.offset),this.texture.repeat.fromArray(this.start.repeat)},e.prototype.play=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._resetTexture(),this._loop=e,this._callback=t,this._isRunning=!0},e.prototype.stop=function(){this._resetTexture(),this._isRunning=!1},e.prototype.pause=function(){this._isRunning=!1},e.prototype.resume=function(){this._isRunning=!0},e.prototype.dispose=function(){this.texture=null},e}(),Dt=function(){function e(t,i,r){n(this,e),this.id=Ct++,this._anims=r,this._mat=t,this._propertyName=i,this._step=0,this._anims.forEach((function(e){return e.stop()}));var o=this;!function e(){t[i]=r[o._step].texture,t.needsUpdate=!0,r[o._step].play(r[o._step]._loop,(function(){o._step++,o._step>=r.length&&(o._step=0),e()}))}()}return e.prototype.update=function(e){this._anims.forEach((function(t){return t.update(e)}))},e.prototype.dispose=function(){this._anims=null,this._mat=null},e}(),Pt=function(e){function t(){return n(this,t),s(this,e.apply(this,arguments))}return a(t,e),t}(Rt),jt=function(e){function t(i,r){n(this,t);var o=s(this,e.call(this,i,r));return o.numberOfTiles=0,o.tileDisplayDuration=0,o.currentDisplayTime=0,o.currentTile=0,o.tilesX=0,o.tilesY=0,o.random=!1,o._interval=0,o._intervalTime=0,o._parse(r),o._resetTexture(),o}return a(t,e),t.prototype._parse=function(e){if(e.scroll&&(this.start.offset[0]=e.scroll[0],this.start.offset[1]=e.scroll[1]),e.multiFramesAnim){var t=e.multiFramesAnim.tilesX,i=e.multiFramesAnim.tilesY;this.numberOfTiles=t*i,this.tileDisplayDuration=1/e.multiFramesAnim.animSpeed||1,this.currentDisplayTime=0,this.currentTile=0,this.tilesX=t,this.tilesY=i,this.start.repeat[0]=1/t,this.start.repeat[1]=1/i,void 0!==e.multiFramesAnim.loop&&(this._loop=parseInt(e.multiFramesAnim.loop)),void 0!==e.multiFramesAnim.interval&&(this._interval=parseInt(e.multiFramesAnim.interval)),void 0!==e.multiFramesAnim.random&&(this.random=!!e.multiFramesAnim.random)}},t.prototype.update=function(e){if(this._isRunning)if(this._intervalTime>0)this._intervalTime-=e;else for(this.currentDisplayTime+=e*this.timeScale;this.currentDisplayTime>this.tileDisplayDuration;)if(this.currentDisplayTime-=this.tileDisplayDuration,this.currentTile++,this.currentTile==this.numberOfTiles&&(this.currentTile=0,this._loop--,this._intervalTime=this._interval),this._loop>0){var t=this.random?Math.floor(Math.random()*this.numberOfTiles):this.currentTile,i=t%this.tilesX;this.texture.offset.x=i/this.tilesX;var r=Math.floor(t/this.tilesX);this.texture.offset.y=r/this.tilesY}else this._isRunning=!1,this._callback()},t}(Rt),Ft=function(e){function t(i,r){n(this,t);var o=s(this,e.call(this,i,r));return o.animation={offset:[0,0],scale:0,rotation:0,offsetRandom:[0,0],scaleRandom:0,rotationRandom:0,currentScaleWithoutRandom:1,offsetLoop:1/0,scaleLoop:1/0,rotationLoop:1/0,offsetInterval:0,scaleInterval:0,rotationInterval:0,offsetIntervalTime:0,scaleIntervalTime:0,rotationIntervalTime:0},o._parse(r),o._resetTexture(),o}return a(t,e),t.prototype._parse=function(e){e.scroll&&(this.start.offset[0]=e.scroll[0],this.start.offset[1]=e.scroll[1]);var t=e.scale||e.repeat;t&&(Array.isArray(t)?(this.start.repeat[0]=1/t[0],this.start.repeat[1]=1/t[1]):(this.start.repeat[0]=1/t,this.start.repeat[1]=1/t),this.animation.currentScaleWithoutRandom=1/this.start.repeat[0]),e.scrollAnim&&(void 0!==e.scrollAnim.speed?(this.animation.offset[0]-=e.scrollAnim.speed[0],this.animation.offset[1]-=e.scrollAnim.speed[1],void 0!==e.scrollAnim.T&&void 0!==e.scrollAnim.A&&(this.animation.offsetRandom[0]=0==e.scrollAnim.T[0]?0:e.scrollAnim.A[0]/e.scrollAnim.T[0],this.animation.offsetRandom[1]=0==e.scrollAnim.T[1]?0:e.scrollAnim.A[1]/e.scrollAnim.T[1]),void 0!==e.scrollAnim.loop&&(this.animation.offsetLoop=parseInt(e.scrollAnim.loop)),void 0!==e.scrollAnim.interval&&(this.animation.offsetInterval=parseFloat(e.scrollAnim.interval))):(this.animation.offset[0]-=e.scrollAnim[0],this.animation.offset[1]-=e.scrollAnim[1])),e.scaleAnim&&(void 0!==e.scaleAnim.speed?(this.animation.scale+=e.scaleAnim.speed,void 0!==e.scaleAnim.T&&void 0!==e.scaleAnim.A&&(this.animation.scaleRandom=e.scaleAnim.A/e.scaleAnim.T),void 0!==e.scaleAnim.loop&&(this.animation.scaleLoop=Number(e.scaleAnim.loop)),void 0!==e.scaleAnim.interval&&(this.animation.scaleInterval=parseFloat(e.scaleAnim.interval))):this.animation.scale+=e.scaleAnim),e.rotateAnim&&(void 0!==e.rotateAnim.speed?(this.animation.rotation+=e.rotateAnim.speed/180*Math.PI,void 0!==e.rotateAnim.T&&void 0!==e.rotateAnim.A&&(this.animation.rotationRandom=e.rotateAnim.A/e.rotateAnim.T),void 0!==e.rotateAnim.loop&&(this.animation.rotationLoop=Number(e.rotateAnim.loop)),void 0!==e.rotateAnim.interval&&(this.animation.rotationInterval=parseFloat(e.rotateAnim.interval))):this.animation.rotation+=e.rotateAnim/180*Math.PI)},t.prototype.update=function(e){if(this._isRunning){var t=this.texture,i=this.start,r=this.animation;if(r.offsetIntervalTime>0)r.offsetIntervalTime-=e,t.offset.x=i.offset[0],t.offset.y=i.offset[1];else{for(t.offset.x+=r.offset[0]*e*this.timeScale*(1+(2*Math.random()-1)*r.offsetRandom[0]),t.offset.y+=r.offset[1]*e*this.timeScale*(1+(2*Math.random()-1)*r.offsetRandom[1]);t.offset.x>i.offset[0]+1;)t.offset.x-=1,r.offsetLoop--,r.offsetIntervalTime=r.offsetInterval;for(;t.offset.x<i.offset[0]-1;)t.offset.x+=1,r.offsetLoop--,r.offsetIntervalTime=r.offsetInterval;for(;t.offset.y>i.offset[1]+1;)t.offset.y-=1;for(;t.offset.y<i.offset[1]-1;)t.offset.y+=1;r.offsetLoop<=0&&(this._isRunning=!1,t.offset.x=i.offset[0],t.offset.y=i.offset[1])}if(r.scaleIntervalTime>0)r.scaleIntervalTime-=e,t.repeat.fromArray(i.repeat);else if(0!==r.scale){var n=r.scale*e*this.timeScale,o=n*(1+(2*Math.random()-1)*r.scaleRandom),a=1/t.repeat.x+o,s=1/t.repeat.y+o;for(this.animation.currentScaleWithoutRandom+=n;this.animation.currentScaleWithoutRandom>1;)this.animation.currentScaleWithoutRandom-=1,r.scaleLoop--,r.scaleIntervalTime=r.scaleInterval;for(;this.animation.currentScaleWithoutRandom<=0;)this.animation.currentScaleWithoutRandom+=1,r.scaleLoop--,r.scaleIntervalTime=r.scaleInterval;for(;a>1;)a-=1,s-=1;for(;a<=0;)a+=1,s+=1;t.repeat.set(1/a,1/s),r.scaleLoop<=0&&(this._isRunning=!1,t.repeat.fromArray(i.repeat))}if(r.rotationIntervalTime>0)r.rotationIntervalTime-=e,t.rotation=i.rotation;else{for(t.rotation+=r.rotation*e*this.timeScale*(1+(2*Math.random()-1)*r.rotationRandom);t.rotation>i.rotation+St;)t.rotation-=St,r.rotationLoop--,r.rotationIntervalTime=r.rotationInterval;for(;t.rotation<i.rotation-St;)t.rotation+=St,r.rotationLoop--,r.rotationIntervalTime=r.rotationInterval;r.rotationLoop<=0&&(this._isRunning=!1,t.rotation=i.rotation)}0===r.rotation&&0===r.scale&&1===t.repeat.x&&1===t.repeat.y||t.center.set(.5,.5)}},t.prototype.play=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,i=arguments[1];this.animation.offsetLoop=t,this.animation.scaleLoop=t,this.animation.rotationLoop=t,this.animation.offsetIntervalTime=0,this.animation.scaleIntervalTime=0,this.animation.rotationIntervalTime=0,this.animation.currentScaleWithoutRandom=1/this.start.repeat[0],e.prototype.play.call(this,t,i)},t}(Rt),Ot=function(){function e(t,i){n(this,e),this.object=null,this.app=null,this.param=t,this.callback=i,this.loadingBox=null}return e.prototype._createLoadingBox=function(e,t){if(!e.app.options.showLoadingBox||!t)return!1;var i=t[0],r=t[2],n=t[1],o=new THREE.BoxGeometry(i,r,n,1,1,1),a=new THREE.MeshPhongMaterial({color:2200782,transparent:!0});return this.loadingBox=new THREE.Mesh(o,a),this.loadingBox.material.opacity=.01,this.loadingBox.position.y+=r/2,this.loadingBox.userData.size=[i,r,n],this.loadingBox.userData.curProgress=.01,e.pickable||(this.loadingBox.userData.skipPick=!0),this.loadingBox.userData.skipStyle=!0,!0},e.prototype.loadComplete=function(e,t,i){t.model=e;var r=e.cloneNode();this.object.setupNode(r,!1),this.object.synPickable(),this.object._processModel(),this.object._synEffectRefCounts();var n=t.nodeReady;n&&n.call(this.object,{object:this.object}),null!=i&&i(),this.object.removeControl(this)},e.prototype.loadModelFromURL=function(e,t){var i=this,r=this.object,n=e.url;r._url=n._trimRight("/"),r.setupUserData(e),e.force=!0,r.setupParent(e),e.skipSetupParent=!0,r.setupTranslation(e),r.node.updateMatrixWorld();var o=this.app.modelResource,a=o.get(n);a?this.loadComplete(a,e,t):o.download(n,(function(t){var n=t.size;n&&i._createLoadingBox(r,n)&&r.node.add(i.loadingBox),r._loadingBoxSize=n,r._extensionsFile=t.extensionsfile||null;var o=e.nodeReady;o&&o.call(r,{object:r,jsonData:t})}),(function(n){if(r.destroyed)return!1;var o=i.loadingBox;return o&&(n.loadingBox=o,o.removeBySelf()),e.position=i.object.position,e.angles=i.object.angles,e.scale=i.object.scale,ke.backupValue(e,"nodeReady"),e.nodeReady=null,i.loadComplete(n,e,(function(){t&&t()})),ke.revertValue(e,"nodeReady"),!0}),(function(t){var n=Math.max(.01,t.progress),o=i.loadingBox;o&&o.material&&(o.userData.curProgress=Math.max(o.userData.curProgress,n),o.material.opacity=o.userData.curProgress);var a=e.progress;a&&a.call(r,{object:r,progress:n}),i.object.trigger("progress",{object:r,progress:n})}),(function(t){var i=e.error;if(i)return i(t),!0}))},e.prototype.onAdd=function(e){this.object=e,this.app=e.app,this.loadModelFromURL(this.param,this.callback),delete this.param,delete this.callback},e}(),kt=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.isBlockMouseOffEvent=function(e){return!!this.isChildOf(e)},t.prototype.setupTextureAnimations=function(){Mt.hasTextureAnimation(this.node)&&this.addControl(new Mt(!0),"texAnimControl")},t.prototype.customSetup=function(e){},t.prototype.setupResources=function(t){e.prototype.setupResources.call(this,t),this.setupTextureAnimations()},t.prototype.loadFromURL=function(e,t){this.addControl(new Ot(e,t))},t.prototype._loadResource=function(t){this.query(".CombinedObject|.Facade",!1).forEach((function(e){e.loadResource()})),e.prototype._loadResource.call(this,t)},t.prototype._unloadResource=function(t){this.query(".CombinedObject",!1).forEach((function(e){e.unloadResource()})),e.prototype._unloadResource.call(this,t)},o(t,[{key:"isFacade",get:function(){return!0}},{key:"isOutdoors",get:function(){return!0}},{key:"building",get:function(){return this.parents.query(".Building")[0]}}]),t}(bt),Lt=function(){function e(t){n(this,e),this.object=null,this.animations=t,this.animationClips=null,this.animationPlayingActions=[],this.animationActions=[],this.animationMixer=null}return e.prototype.init=function(e){var t=this;this.animationClips=e,this.animationMixer=new THREE.AnimationMixer(this.object.node);for(var i=0;i<this.animationClips.length;i++){var r=this.animationMixer.clipAction(this.animationClips[i]);this.animationActions.push(r)}this.animationMixer.addEventListener("loop",(function(e){})),this.animationMixer.addEventListener("finished",(function(e){var i=e.action;i.setEffectiveTimeScale(0);var r=i.complete;if(r){var n=i.getClip().name;r.call(t.object,n)}}))},e.prototype.onAdd=function(e){this.object=e,this.app=e.app,this.init(this.animations),delete this.animations},e.prototype.onRemove=function(){this.animationMixer&&(this.animationClips=null,this.animationActions=[],this.animationMixer=null)},e.prototype.onUpdate=function(e){var t=this.animationMixer;if(t){var i=t.isRunning();if(this.app.root.static&&i&&this.object.visible){var r=this.object.boundingBox;this.app.camera.frustum.intersectsBox(r)&&this.object.node._synMatrixWorld()}return t.update(e),this.object.visible&&(this.app.needUpdate=i),i}return!1},e.prototype.containAnimation=function(e){if(this.animationClips)for(var t=0;t<this.animationClips.length;t++)if(this.animationClips[t].name===e)return!0;return!1},e.prototype._updatePlayingAnimation=function(e){for(var t=0;t<this.animationPlayingActions.length;++t)if(this.animationPlayingActions[t]==e)return;this.animationPlayingActions.push(e)},e.prototype.pauseAnimation=function(e,t){if(e){if(ke.isArray(e))for(o=0;o<this.animationPlayingActions.length;o++){for(var i=this.animationPlayingActions[o],r=!1,n=0;n<e.length;n++)if(e[n]==i.getClip().name){r=!0;break}r||(i.paused=t,this.animationPlayingActions.splice(o,1),o--)}else if(ke.isString(e)){for(o=0;o<this.animationPlayingActions.length;o++){e!=(i=this.animationPlayingActions[o]).getClip().name&&(i.paused=t,this.animationPlayingActions.splice(o,1),o--)}for(o=0;o<this.animationPlayingActions.length;++o)this.animationPlayingActions[o].paused=t}}else for(var o=0;o<this.animationPlayingActions.length;++o)this.animationPlayingActions[o].paused=t},e.prototype.stopAnimation=function(e){if(e){if(ke.isArray(e))for(n=0;n<this.animationPlayingActions.length;n++){for(var t=this.animationPlayingActions[n],i=!1,r=0;r<e.length;r++)if(e[r]==t.getClip().name){i=!0;break}i||(t.stop(),this.animationPlayingActions.splice(n,1),n--)}else if(ke.isString(e)){for(n=0;n<this.animationPlayingActions.length;n++){e!=(t=this.animationPlayingActions[n]).getClip().name&&(t.stop(),this.animationPlayingActions.splice(n,1),n--)}for(n=0;n<this.animationPlayingActions.length;++n)this.animationPlayingActions[n].stop()}}else for(var n=0;n<this.animationPlayingActions.length;++n)this.animationPlayingActions[n].stop()},e.prototype.playAnimation=function(e,t){var i=(t=t||{}).speed||1,r=ke.parseValue(t.reverse,!1),n=ke.parseLoopType(t.loopType||t.loop),o=t.loopTimes||1/0,a=t.frames||null,s=t.complete,l=THREE.AnimationClip.findByName(this.animationClips,e);if(!l)return console.error("The '"+e+"' animation is not existing"),!1;var u=this.animationMixer.clipAction(l);if(!u)return!1;u.reset();var c=l.duration/i,h=u.isRunning();if(r&&n==THREE.LoopOnce&&(o=h?0:1,n=THREE.LoopRepeat),u.complete=s,u.paused=!1,u.clampWhenFinished=!0,u.setEffectiveWeight(1),u.setDuration(r?-c:c),u.setLoop(n,o),a){var p=0,d=1;ke.isArray(a)?(p=a[0],d=a.length>1?a[1]:1):ke.isNumber(a)?p=a:console.error("animation frames is invalid"),u.warp(p,d,c)}else u.stopWarping();return h||(u.isScheduled()?u.reset():u.play(),this._updatePlayingAnimation(u)),!0},e.prototype.isPlayingAnimation=function(e){return!!this.animationMixer&&this.animationMixer.isRunning(e)},o(e,[{key:"animationNames",get:function(){var e=[];if(this.animationClips)for(var t=0;t<this.animationClips.length;t++)e.push(this.animationClips[t].name);return e}}]),e}(),Bt=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._url="",r._animationControl=null,r}return a(t,e),t.prototype.loadModelResource=function(e){var t=(e=e||{}).url;if(t){var i=this.style,r={renderOrder:0,opacity:1,color:null,outlineColor:null,edgeColor:null,alwaysOnTop:!1,image:""};for(var n in r){var o=r[n];r[n]=i[n],i[n]=o}this._url&&(this.app.modelResource.unload(this._url),this._url=null);for(var a=this.node.children.concat(),s=0;s<a.length;s++)this.app.resourceManager.remove(a[s],!1);var l=this;this.loadFromURL(e,(function(){for(var i in l._initBoxSize=null,l.customSetup(e),r)l.style[i]=r[i];var n=e.complete;n&&n.call(l,{object:l,url:t})}))}},t.prototype.setupCustomKeys=function(e){var t=ke.parseValue(e.ON_IU,"oniu"),i=ke.parseValue(e.SJGN_IHT,"sjgniht"),r=ke.parseValue(e.IJ_EKOU_NUOY,"ijekounuoy"),n=ke.parseValue(e.RE_ISRAT,"reisrat");"naijil"!=t&&"NA_IJ_IL"!=t||(this.userData.bindFeatureOn=t),"auhnujuw"!=i&&"AU_HN_UJ_UW"!=i||(this.userData.SightTestOn=i),"nahoanehc"!=r&&"NA_HO_AN_EHC"!=r||(this.userData.LoopControlOn=r),"eilam"!=n&&"EI_LAM"!=n||(this.userData.bindFeatureOn=n)},t.prototype.setupAnimations=function(e){this.removeControl(this._animationControl);var t=e.animations,i=e.model;if(i&&(t||(t=i.animations)),t&&t.length){this._animationControl=new Lt(t),this.addControl(this._animationControl);var r=e.animation;r&&this.playAnimation(r)}},t.prototype.setupTextureAnimations=function(){Mt.hasTextureAnimation(this.node)&&this.addControl(new Mt,"texAnimControl")},t.prototype.setupRoomOwner=function(e){var t=e.belongRoomUserID;t&&(this._belongRoomUserID=t)},t.prototype.customSetup=function(e){this.setupAnimations(e),this.setupCustomKeys(e),this.setupRoomOwner(e)},t.prototype.setupResources=function(t){e.prototype.setupResources.call(this,t),this.setupTextureAnimations(t)},t.prototype.loadFromURL=function(e,t){this.addControl(new Ot(e,t))},t.prototype.containAnimation=function(e){return!!this._animationControl&&this._animationControl.containAnimation(e)},t.prototype.playAnimation=function(e){if(e=e||{},this.loaded){if(ke.isString(e))return this._stopAnimation(e),void this._playAnimation(e,null);var t=e.name;if(ke.isString(t))return this._stopAnimation(t),void this._playAnimation(t,e);if(ke.isArray(t)&&t.length){if(1==t.length)return this._stopAnimation(t[0]),void this._playAnimation(t[0],e);e=ke.cloneObject(e);var i=ke.parseArrayArgument(t,e,"speed"),r=ke.parseArrayArgument(t,e,"reverse"),n=ke.parseArrayArgument(t,e,"loop"),o=ke.parseArrayArgument(t,e,"loopType"),a=ke.parseArrayArgument(t,e,"loopTimes"),s=ke.parseArrayArgument(t,e,"frames");this._stopAnimation(t);for(var l=0;l<t.length;l++)ke.getArrayArgumentValue(e,"speed",i,l),ke.getArrayArgumentValue(e,"reverse",r,l),ke.getArrayArgumentValue(e,"loop",n,l),ke.getArrayArgumentValue(e,"loopType",o,l),ke.getArrayArgumentValue(e,"loopTimes",a,l),ke.getArrayArgumentValue(e,"frames",s,l),this._playAnimation(t[l],e)}else;}else this.waitCommands.push({type:"PlayObjectAnimation",object:this,params:e})},t.prototype._stopAnimation=function(e){this._animationControl&&this._animationControl.stopAnimation(e)},t.prototype._playAnimation=function(e,t){this._animationControl&&!this._animationControl.playAnimation(e,t)||(this.tickable=!0)},t.prototype.pauseAnimation=function(e){this._animationControl&&this._animationControl.pauseAnimation(e,!0),e||(this.tickable=!1)},t.prototype.resumeAnimation=function(e){this._animationControl&&this._animationControl.pauseAnimation(e,!1),this.tickable=!0},t.prototype.stopAnimation=function(e){this._animationControl&&this._animationControl.stopAnimation(e),e||(this.tickable=!1)},t.prototype.isPlayingAnimation=function(e){return!!this._animationControl&&this._animationControl.isPlayingAnimation(e)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.type="Thing",this._url&&(t.url=this._url),t},o(t,[{key:"isThing",get:function(){return!0}},{key:"animationNames",get:function(){return this._animationControl?this._animationControl.animationNames:[]}},{key:"url",get:function(){return this._url}},{key:"isOutdoors",get:function(){return!this.parents.query(".Building").length}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}},{key:"building",get:function(){return this.parents.query(".Building")[0]}},{key:"_temp_roomID",get:function(){return this._belongRoomUserID}}]),t}(bt),Ht=function(){function e(t){n(this,e),this._obj=t,this._color=null}return o(e,[{key:"batchObject",get:function(){return this._obj._batchObject}},{key:"color",set:function(e){this._color=e?ke.parseColor(e):null,this.batchObject._updateAttributes(this._obj,8)},get:function(){return this._color?this._color.toHexString():this.batchObject.style.color}}]),e}(),It=new THREE.Color,Nt=1,Ut=2,Vt=4,zt=8,qt=16,Wt=1048575,Gt=null;var Xt=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._initMeshes=[],r._instancedMeshes=[],r._maxBatchNum=64,r._batchNum=0,r._deletedIndexs=[],r._instancedAttributes={},r}return a(t,e),t.prototype._beforeSetup=function(e){this._maxBatchNum=void 0!==e.initBatchNum?e.initBatchNum:64,this._instancedAttributes.instancePosition=new THREE.InstancedBufferAttribute(new Float32Array(3*this._maxBatchNum),3),this._instancedAttributes.instanceQuaternion=new THREE.InstancedBufferAttribute(new Float32Array(4*this._maxBatchNum),4),this._instancedAttributes.instanceScale=new THREE.InstancedBufferAttribute(new Float32Array(3*this._maxBatchNum),3),this._instancedAttributes.instanceColor=new THREE.InstancedBufferAttribute(new Float32Array(3*this._maxBatchNum),3),this._instancedAttributes.instanceId=new THREE.InstancedBufferAttribute(new Float32Array(1*this._maxBatchNum),1)},t.prototype.destroy=function(){var t=this;e.prototype.destroy.call(this),this._initMeshes.forEach((function(e){t.app.resourceManager.unload(e)}))},t.prototype._initInstancedMeshes=function(){var e=this;this._initMeshes=this.node.getMeshes(),this._instancedMeshes=this._initMeshes.map((function(t){return e._createInstancedMesh(t)})),this.node.children.slice(0).forEach((function(t){return e.node.remove(t)})),this._instancedMeshes.forEach((function(t){return e.node.add(t)})),this.static&&this.node._synMatrixWorld()},t.prototype._createInstancedMesh=function(e){var t=new THREE.InstancedBufferGeometry;for(var i in t.maxInstancedCount=this._batchNum,e.geometry.index&&(t.index=e.geometry.index),e.geometry.attributes)"position"===i||"normal"===i?t.addAttribute(i,e.geometry.attributes[i].clone()):t.addAttribute(i,e.geometry.attributes[i]);for(var r in this._instancedAttributes)t.addAttribute(r,this._instancedAttributes[r]);t.applyMatrix(e.getMatrixFromRoot(this.node)),e.geometry.groups&&e.geometry.groups.length>0&&(t.groups=e.geometry.groups);var n=void 0;Array.isArray(e.material)?n=e.material.map((function(e){var t=new THREE.MeshLambertMaterial({color:e.color,map:e.map,aoMap:e.aoMap,alphaMap:e.alphaMap,alphaTest:e.alphaTest,emissive:e.emissive,transparent:e.transparent,opacity:e.opacity,blending:e.blending,vertexColors:!0});return t.defines=e.defines||{},t.defines.INSTANCED="",t})):((n=new THREE.MeshLambertMaterial({color:e.material.color,map:e.material.map,aoMap:e.material.aoMap,alphaMap:e.material.alphaMap,alphaTest:e.material.alphaTest,emissive:e.material.emissive,transparent:e.material.transparent,opacity:e.material.opacity,blending:e.material.blending,vertexColors:!0})).defines=e.material.defines||{},n.defines.INSTANCED="");var o=new THREE.Mesh(t,n);return o.userData={skipOutline:!0},o.frustumCulled=!1,o.customDepthMaterial=(Gt||((Gt=new THREE.MeshDepthMaterial({depthPacking:THREE.RGBADepthPacking})).defines={INSTANCED:""}),Gt),o.castShadow=!0,o.receiveShadow=!0,o},t.prototype.isBatchObject=function(){return!0},t.prototype._callComplete=function(t){this._initInstancedMeshes(),e.prototype._callComplete.call(this,t)},t.prototype._allocSubObjectIndex=function(){if(this._deletedIndexs.length>0)return this._deletedIndexs.shift();var e=this._batchNum;return this._batchNum++,e},t.prototype.createSubObject=function(e){return e.type="BatchSubObject",e.parent=e.parent||this,e.batchObject=this,this.app.create(e)},t.prototype._resizeAttributes=function(){for(var e in this._instancedAttributes){var t=this._instancedAttributes[e],i=t.array,r=new i.constructor(this._maxBatchNum*t.itemSize);r.set(i),t.array=r,t.count=r.length/t.itemSize,t.resizeDirty=!0,t.needsUpdate=!0}},t.prototype._updateAttributes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wt,i=e.internalUserData.__attribute_index__BatchObject__;t&Nt&&(this._instancedAttributes.instancePosition.array.set(e.node.position.toArray(),3*i),this._instancedAttributes.instancePosition.needsUpdate=!0),t&Ut&&(this._instancedAttributes.instanceQuaternion.array.set(e.node.quaternion.toArray(),4*i),this._instancedAttributes.instanceQuaternion.needsUpdate=!0),t&Vt&&(this._instancedAttributes.instanceScale.array.set(e.node.scale.toArray(),3*i),this._instancedAttributes.instanceScale.needsUpdate=!0),t&zt&&(e._style?It.set(e._style.color):It.set(this.style.color),this._instancedAttributes.instanceColor.array.set(It.toArray(),3*i),this._instancedAttributes.instanceColor.needsUpdate=!0),t&qt&&(this._instancedAttributes.instanceId.array[i]=e.node.id,this._instancedAttributes.instanceId.needsUpdate=!0)},t.prototype._removeAttributes=function(e){var t=e.internalUserData.__attribute_index__BatchObject__;this._instancedAttributes.instanceScale.array.set([1e-9,1e-9,1e-9],3*t),this._instancedAttributes.instanceColor.array.set([0,0,0],3*t),this._instancedAttributes.instanceScale.needsUpdate=!0,this._instancedAttributes.instanceColor.needsUpdate=!0,this._deletedIndexs.push(t)},t}(Bt),Yt=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._batchObject=null,r}return a(t,e),t.prototype.isBatchSubObject=function(){return!0},t.prototype._afterSetupComplete=function(e){var t=this;if(this._batchObject=e.batchObject,this._batchObject){this.app.picker.markPickingNode(this.node),this.internalUserData.__attribute_index__BatchObject__=this._batchObject._allocSubObjectIndex(),this._batchObject._batchNum>this._batchObject._maxBatchNum&&(this._batchObject._maxBatchNum*=2,this._batchObject._resizeAttributes()),this._batchObject._updateAttributes(this),this._batchObject._instancedMeshes.forEach((function(e){e.geometry.maxInstancedCount=t._batchObject._batchNum,t.app.edgesGeometriesManager.synMaxInstancedCount(e.geometry)}));var i=this;this._notifyPositionChange=function(){i._batchObject._updateAttributes(i,Nt)},this._notifyAnglesChange=function(){i._batchObject._updateAttributes(i,Ut)},this._notifyScalesChange=function(){i._batchObject._updateAttributes(i,Vt)},this._notifyDestroy=function(){i._batchObject._removeAttributes(i)}}else console.error("Please provide batch object to create BatchSubObject")},t}(Bt),Jt=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.sprite=null,r.spriteVisible=!0,r.onTop=!1,r.progress=0,r}return a(t,e),t.prototype.canNotQueryFromSelector=function(){return!0},t.prototype.customSetup=function(e){var t=e.scene,i=e.height,r=e.onTop,n=this.app.calcRect();this.onTop=r;var o=new THREE.SpriteMaterial({opacity:.8,color:34816,transparent:!0});this.sprite=new THREE.Sprite(o),this.sprite.scale.set(2*n.width,i,1),this.sprite.visible=!1,this.updatePosition(n.width,n.height),this.node.add(this.sprite),t.add(this.node)},t.prototype.updatePosition=function(e,t){if(void 0===e||void 0===t){var i=this.app.calcRect();e=i.width,t=i.height}var r=this.sprite,n=-e/2,o=this.onTop?t/2-r.scale.y/2:-t/2+r.scale.y/2;r.position.set(n,o,-10)},t.prototype.updateProgress=function(e){if(!this.sprite)return!1;if(this.progress==e)return!1;this.progress=e;var t=this.app.calcRect();if(e<1&&0!=e)this.sprite.visible=this.spriteVisible;else{var i=this;setTimeout((function(){i.sprite&&(i.sprite.visible=!1)}),1e3)}var r=Math.max(1,2*t.width*e);return this.sprite.scale.x=r,!0},t.prototype.resize=function(e,t){if(this.sprite){this.updatePosition(e,t);var i=Math.max(1,2*e*this.progress);this.sprite.scale.x=i}},t.prototype.prepare=function(){this.sprite.scale.x=1e-4,this.sprite.visible=this.spriteVisible},o(t,[{key:"visible",set:function(e){this.spriteVisible=e},get:function(){return this.spriteVisible}},{key:"height",set:function(e){this.sprite.scale.y=e},get:function(){return this.sprite.scale.y}}]),t}(bt);var Qt={};!function(e){var t=Math.PI/180,i=48,r=57,n=44,o=32,a=46,s=45;e.transformSVGPath=function(e){var l,u,c,h,p=new THREE.ShapePath,d=1,f=e.length,m=0,g=0,v=0,y=0,b=null,_=null,x=0,E=0,w=0,T=0,S=0,A=0,M=0,C=0,R=0;function D(){for(var t,l,u,c=!1;d<f&&((l=e.charCodeAt(d))===n||l===o);)d++;for(t=l===s?d++:d;d<f;)if(l=e.charCodeAt(d),i<=l&&l<=r)d++;else{if(l!==a)return u=e.substring(t,d),c?parseFloat(u):parseInt(u);d++,c=!0}return u=e.substring(t),c?parseFloat(u):parseInt(u)}function P(){for(var t;d<f&&((t=e.charCodeAt(d))===n||t===o);)d++;return(t=e.charCodeAt(d))===s||i<=t&&t<=r}for(l=e[0];d<=f;){switch(h=!0,l){case"M":m=D(),g=D(),p.moveTo(m,g),l="L",b=m,_=g;break;case"m":m+=D(),g+=D(),p.moveTo(m,g),l="l",b=m,_=g;break;case"Z":case"z":h=!1,m===b&&g===_||p.lineTo(b,_);break;case"L":case"H":case"V":v="V"===l?m:D(),y="H"===l?g:D(),p.lineTo(v,y),m=v,g=y;break;case"l":case"h":case"v":v="v"===l?m:m+D(),y="h"===l?g:g+D(),p.lineTo(v,y),m=v,g=y;break;case"C":x=D(),w=D();case"S":"S"===l&&(x=2*m-E,w=2*g-T),E=D(),T=D(),v=D(),y=D(),p.bezierCurveTo(x,w,E,T,v,y),m=v,g=y;break;case"c":x=m+D(),w=g+D();case"s":"s"===l&&(x=2*m-E,w=2*g-T),E=m+D(),T=g+D(),v=m+D(),y=g+D(),p.bezierCurveTo(x,w,E,T,v,y),m=v,g=y;break;case"Q":x=D(),w=D();case"T":"T"===l&&(x=2*m-x,w=2*g-w),v=D(),y=D(),p.quadraticCurveTo(x,w,v,y),m=v,g=y;break;case"q":x=m+D(),w=g+D();case"t":"t"===l&&(x=2*m-x,w=2*g-w),v=m+D(),y=g+D(),p.quadraticCurveTo(x,w,v,y),m=v,g=y;break;case"A":S=D(),A=D(),M=D()*t,C=D(),R=D(),v=D(),y=D(),S!==A&&console.warn("Forcing elliptical arc to be a circular one:",S,A),x=Math.cos(M)*(m-v)/2+Math.sin(M)*(g-y)/2,w=-Math.sin(M)*(m-v)/2+Math.cos(M)*(g-y)/2;var j=Math.sqrt((S*S*A*A-S*S*w*w-A*A*x*x)/(S*S*w*w+A*A*x*x));C===R&&(j=-j),E=j*S*w/A,T=j*-A*x/S,u=Math.cos(M)*E-Math.sin(M)*T+(m+v)/2,c=Math.sin(M)*E+Math.cos(M)*T+(g+y)/2;var F=new THREE.Vector2(1,0),O=new THREE.Vector2((x-E)/S,(w-T)/A),k=Math.acos(F.dot(O)/F.length()/O.length());F.x*O.y-F.y*O.x<0&&(k=-k),F.x=(-x-E)/S,F.y=(-w-T)/A;var L=Math.acos(O.dot(F)/O.length()/F.length());O.x*F.y-O.y*F.x<0&&(L=-L),!R&&L>0&&(L-=2*Math.PI),R&&L<0&&(L+=2*Math.PI),p.absarc(u,c,S,k,k+L,R),m=v,g=y;break;default:throw new Error("Wrong path command: "+l)}h&&P()||(l=e[d++])}return p}}(Qt);var Zt=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.createMaterial=function(e){if(!e)return new THREE.MeshPhongMaterial({color:2200782});return e.disableLight?new THREE.MeshBasicMaterial({color:2200782}):new THREE.MeshPhongMaterial({color:2200782})},t.prototype.createGeometry=function(e){return null},t.prototype.createMesh=function(e){var t=this.createGeometry(e);if(t){var i=this.createMaterial(e.style);return new THREE.Mesh(t,i)}return null},t.prototype.setupStyle=function(e){for(var t in e=e||{})this.style[t]=e[t];this.style.skipEnvMap=!0},t.prototype.setup=function(t){var i=this.createMesh(t);if(i){i.castShadow=!0,i.receiveShadow=!0;var r=t.center;if(r&&"Bottom"==r){var n=t.height||1;i.translateY(.5*n)}this.node.add(i)}e.prototype.setup.call(this,t),this.setupStyle(t.style)},t.prototype.addPickableGround=function(e){var t=this.app.create({type:"Plane",width:e,height:e,visible:!1,parent:this,style:{doubleSide:!0}}),i=t.node;return i.skipBoundingBox(!0),i.userData.topNode=!0,i.userData.skipOutline=!0,i.userData.independent=!0,i.userData.alwaysPickable=!0,i.canNotQueryFromSelector=!0,this.app.objectManager.addInteractableNode(i),t},t.prototype.pickGroundWorldPosition=function(e,t,i){if(ke.isArray(t)&&void 0===i){var r=t;t=r[0],i=r[1]}var n=this.app.camera.getRaycaster(t,i).intersectObjectForcible(e.node,!0);return n.length?n[0].point.toArray():null},t}(Bt),Kt=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._width=0,r._height=0,r._depth=0,r._center="",r}return a(t,e),t.prototype.createGeometry=function(e){this._width=e.width||1,this._height=e.height||1,this._depth=e.depth||1,this._center=e.center;var t=e.widthSegments||1,i=e.heightSegments||1,r=e.depthSegments||1;return new THREE.BoxGeometry(this._width,this._height,this._depth,t,i,r)},o(t,[{key:"isBox",get:function(){return console.warn("[Box] Please use 'instanceof THING.Box' to replace '.isBox'"),this instanceof THING.Box}}]),t}(Zt),$t=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.createGeometry=function(e){var t=e.radius,i=e.segments,r=e.thetaStart,n=e.thetaLength;return new THREE.CircleGeometry(t,i,r,n)},t}(Zt),ei=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.createGeometry=function(e){var t=e.radius||1,i=e.widthSegments||8,r=e.heightSegments||6,n=e.phiStart||0,o=e.phiLength||2*Math.PI,a=e.thetaStart||0,s=e.thetaLength||Math.PI;return new THREE.SphereGeometry(t,i,r,n,o,a,s)},o(t,[{key:"isSphere",get:function(){return console.warn("[Sphere] Please use 'instanceof THING.Sphere' to replace '.isSphere'"),this instanceof THING.Sphere}}]),t}(Zt),ti=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._ground=null,r._groundSize=0,r}return a(t,e),t.prototype.destroy=function(){this._ground&&this.app.objectManager.removeInteractableNode(this._ground.node),e.prototype.destroy.call(this)},t.prototype.createGeometry=function(e){var t=e.width||1,i=e.height||1,r=e.widthSegments||1,n=e.heightSegments||1;return new THREE.PlaneGeometry(t,i,r,n)},t.prototype.addPickableGround=function(t){this._groundSize=t.size,this._groundSize&&(this._ground=e.prototype.addPickableGround.call(this,this._groundSize))},t.prototype.pickGroundWorldPosition=function(t,i){return this._ground?e.prototype.pickGroundWorldPosition.call(this,this._ground,t,i):null},o(t,[{key:"isPlane",get:function(){return console.warn("[Plane] Please use 'instanceof THING.Plane' to replace '.isPlane'"),this instanceof THING.Plane}}]),t}(Zt),ii=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._color1=null,r._color2=null,r._size=0,r._divisions=0,r}return a(t,e),t.prototype.createMesh=function(e){this._color1=ke.parseColor(e.color1,16777215),this._color2=ke.parseColor(e.color2,16777215),this._size=e.size||10,this._divisions=e.divisions||10;var t=new THREE.GridHelper(this._size,this._divisions,this._color1,this._color2);return t.userData.skipStyle=!0,t},o(t,[{key:"size",get:function(){return this._size}}]),t}(Zt),ri=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.createGeometry=function(e){var t=e.height||1,i=e.radius||.5,r=e.radiusTop?e.radiusTop:i,n=e.radiusBottom?e.radiusBottom:i,o=e.radiusSegments||8,a=e.heightSegments||1,s=e.heightSegments||!1,l=e.heightSegments||0,u=e.heightSegments||2*Math.PI;return new THREE.CylinderGeometry(r,n,t,o,a,s,l,u)},o(t,[{key:"isCylinder",get:function(){return console.warn("[Cylinder] Please use 'instanceof THING.Cylinder' to replace '.isCylinder'"),this instanceof THING.Cylinder}}]),t}(Zt),ni=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.createGeometry=function(e){var t=e.radius||1,i=e.detail||0;return new THREE.TetrahedronGeometry(t,i)},o(t,[{key:"isTetrahedron",get:function(){return console.warn("[Tetrahedron] Please use 'instanceof THING.Tetrahedron' to replace '.isTetrahedron'"),this instanceof THING.Tetrahedron}}]),t}(Zt),oi=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.createMaterial=function(e){return new THREE.MeshBasicMaterial({color:"#0aa5ff",opacity:.5,transparent:!0,side:THREE.DoubleSide})},t.prototype.createGeometry=function(e){var t=e.fov||45,i=e.aspect||2,r=e.length||10,n=r*Math.tan(.5*t*.017453293),o=i*n,a=new THREE.Geometry;return a.vertices=[new THREE.Vector3(0,0,0),new THREE.Vector3(o,-n,-r),new THREE.Vector3(o,n,-r),new THREE.Vector3(-o,n,-r),new THREE.Vector3(-o,-n,-r)],a.faces=[new THREE.Face3(0,1,2),new THREE.Face3(0,2,3),new THREE.Face3(0,3,4),new THREE.Face3(0,4,1),new THREE.Face3(3,4,1),new THREE.Face3(3,1,2)],a},t}(Zt),ai=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._vertices=null,r._height=0,r}return a(t,e),t.prototype.addGeoObject=function(e,t,i){for(var r={generateTopUV:function(e,t,i,r,n){var o=t[3*i],a=t[3*i+1],s=t[3*r],l=t[3*r+1],u=t[3*n],c=t[3*n+1];return[new THREE.Vector2(o,a),new THREE.Vector2(s,l),new THREE.Vector2(u,c)]},generateSideWallUV:function(e,t,i,r,n,o){return[new THREE.Vector2(0,0),new THREE.Vector2(0,1),new THREE.Vector2(1,1),new THREE.Vector2(1,0)]}},n=Qt.transformSVGPath(t.path),o=[new THREE.MeshPhongMaterial({transparent:!0}),new THREE.MeshPhongMaterial({transparent:!0})],a=n.toShapes(!0),s=0;s<a.length;s++){var l=a[s],u=new THREE.ExtrudeBufferGeometry(l,{depth:t.height,bevelEnabled:!1,UVGenerator:r}),c=new THREE.Matrix4;c.makeRotationFromEuler(ke.parseEuler([90,0,0]));var h=new THREE.Matrix4;h.makeTranslation(t.center[0],t.height,t.center[1]),h.multiply(c);for(var p=u.attributes.position.array,d=0;d<p.length;d+=3){var f=new THREE.Vector3(p[d],p[d+1],p[d+2]);f.applyMatrix4(h),p[d]=f.x,p[d+1]=f.y,p[d+2]=f.z}u.computeVertexNormals();var m=new THREE.Matrix4;m.getInverse(e.matrixWorld);var g=new THREE.Mesh(u,o);g.applyMatrix(m),g.translateY(i),e.add(g)}},t.prototype.createMesh=function(t){var i=t.csg;if(i&&i.isCSG){var r=i.bsp.toMesh(),n=(new THREE.Matrix4).getInverse(i._object.node.matrixWorld);return r._premultiplyMatrix(n),r}return e.prototype.createMesh.call(this,t)},t.prototype._afterSetupComplete=function(e){var t=e.vertices||e.points,i=e.center||[0,0],r=ke.parseValue(e.height,0);if(t&&t.length){for(var n={center:i,height:r,path:""},o=function(e){return THING.Math.isFloatEquals(e,0)?0:e},a=0;a<t.length;a++){var s=ke.parseVector3(t[a]);n.path?n.path+="L":n.path+="M",n.path+=o(s.x).toString(),n.path+=",",n.path+=o(s.z).toString(),n.path+=" "}n.path+=" Z",this._vertices=t,this._height=r,this.addGeoObject(this.node,n,t[0][1]),e.position||e.localPosition||this.useBottomCenterOfBoundingBoxAsPosition()}},o(t,[{key:"height",get:function(){return this._height}},{key:"points",get:function(){var e=this.node.children[0];if(!e)return null;e.updateWorldMatrix(!0,!1);for(var t=e.matrixWorld,i=e.geometry.attributes.position.array,r=[],n=0;n<i.length;n+=3){var o=new THREE.Vector3(i[n+0],i[n+1],i[n+2]);o.applyMatrix4(t),r.push(o.toArray())}for(n=0;n<r.length;n++)for(var a=n+1;a<r.length;a++)THING.Math.equalsVector(r[n],r[a])&&r.splice(a--,1);return r}}]),t}(Zt),si=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.isOpen=!1,r}return a(t,e),t.prototype.open=function(){0!==this.animationNames.length&&this.playAnimation("Auto_Open"),this.isOpen=!0},t.prototype.close=function(){0!==this.animationNames.length&&this.playAnimation("Auto_Close"),this.isOpen=!1},o(t,[{key:"isDoor",get:function(){return!0}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}}]),t}(Bt),li=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.elevator=null,r}return a(t,e),t.prototype.setup=function(t){e.prototype.setup.call(this,t),this.levelNumber=this.parent.levelNumber},o(t,[{key:"owner",get:function(){return this.elevator}}]),t}(si),ui=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.doors=[],r}return a(t,e),t.prototype.setup=function(t){if(e.prototype.setup.call(this,t),t.doors){this.doors=t.doors;for(var i=0;i<this.doors.length;i++){this.doors[i].elevator=this}}},t.prototype.getDoor=function(e){for(var t=0;t<this.doors.length;t++){var i=this.doors[t];if(i.floor==e)return i}return i},t}(bt),ci=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.stair=null,r}return a(t,e),t.prototype.setup=function(t){e.prototype.setup.call(this,t)},o(t,[{key:"owner",get:function(){return this.stair}},{key:"isStairDoor",get:function(){return console.warn("[StairDoor] Please use 'instanceof THING.StairDoor' to replace '.StairDoor'"),this instanceof THING.StairDoor}}]),t}(si),hi=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.doors=[],r}return a(t,e),t.prototype.setup=function(t){if(e.prototype.setup.call(this,t),t.doors){this.doors=t.doors;for(var i=0;i<this.doors.length;i++){this.doors[i].stair=this}}},t.prototype.getDoor=function(e){for(var t=0;t<this.doors.length;t++){var i=this.doors[t];if(i.floor==e)return i}return i},o(t,[{key:"isStair",get:function(){return console.warn("[Stair] Please use 'instanceof THING.Stair' to replace '.Stair'"),this instanceof THING.Stair}}]),t}(bt),pi=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.customSetup=function(e){var t=e.width,i=e.height;if(t&&i){var r=new THREE.PlaneBufferGeometry(t,i),n=new THREE.MeshLambertMaterial({polygonOffset:!0,polygonOffsetFactor:10,polygonOffsetUnits:10}),o=new THREE.Mesh(r,n);o.rotation.x=-.5*Math.PI,o.position.x=0,o.position.y=-.1,o.position.z=0,o.receiveShadow=!0;var a=ke.parseValue(e.skipBoundingBox,!0);o.skipBoundingBox(a);var s=e.repeatUV||[100,100],l=e.image;if(l){var u=this.app.confirmURL(l,"https://static.3dmomoda.com/textures");o.material.map=(new THREE.TextureLoader).load(u),o.material.map.repeat.fromArray(s),o.material.map.wrapT=o.material.map.wrapS=THREE.RepeatWrapping}this.node.add(o)}},t.prototype._loadSelfResource=function(){this._children.forEach((function(e){e.loadResource()}))},o(t,[{key:"isGround",get:function(){return!0}},{key:"misc",get:function(){return this.miscObject||(this.miscObject=this.query(".CombinedObject").query("[userData/type=CombineMiscParent]")[0]),this.miscObject}},{key:"plan",get:function(){return this.floorObject||(this.floorObject=this.query(".CombinedObject").query("[userData/type=CombineFloorParent]")[0]),this.floorObject}},{key:"wall",get:function(){return this.wallObject||(this.wallObject=this.query(".CombinedObject").query("[userData/type=CombineWallParent]")[0]),this.wallObject}}]),t}(bt),di=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._aspect=2,r._fov=45,r._near=.1,r._far=10,r._camera=null,r._lineMesh=null,r._frustumMesh=null,r._frustum=new THREE.Frustum,r._projScreenMatrix=new THREE.Matrix4,r}return a(t,e),t.prototype._updateFrustum=function(){this._projScreenMatrix.multiplyMatrices(this._camera.projectionMatrix,this._camera.matrixWorldInverse),this._frustum.setFromMatrix(this._projScreenMatrix)},t.prototype._buildLineMesh=function(e,t){var i=new THREE.EdgesGeometry(e.geometry),r=new THREE.LineSegments(i);return r.material.color=ke.parseColor(t),r},t.prototype._buildFrustumMesh=function(){var e=this.far*Math.tan(.5*this.fov*.017453293),t=this.aspect*e,i=new THREE.Geometry;i.vertices=[new THREE.Vector3(0,0,0),new THREE.Vector3(t,-e,-this.far),new THREE.Vector3(t,e,-this.far),new THREE.Vector3(-t,e,-this.far),new THREE.Vector3(-t,-e,-this.far)],i.faces=[new THREE.Face3(0,1,2),new THREE.Face3(0,2,3),new THREE.Face3(0,3,4),new THREE.Face3(0,4,1),new THREE.Face3(3,4,1),new THREE.Face3(3,1,2)];var r=new THREE.MeshBasicMaterial({color:"#0aa5ff",opacity:.5,transparent:!0,side:THREE.DoubleSide}),n=new THREE.Mesh(i,r);return n.userData.skipEnvMap=!0,n},t.prototype._build=function(){var e=this.app.resourceManager;e.remove(this._frustumMesh),e.remove(this._lineMesh),this._frustumMesh=this._buildFrustumMesh(),this.node.add(this._frustumMesh);var t=this.style._lineColor||16777215;this._lineMesh=this._buildLineMesh(this._frustumMesh,t),this.node.add(this._lineMesh),this._camera=new THREE.PerspectiveCamera(this.fov,this.aspect,this.near,this.far),this._camera.position.set(this.position[0],this.position[1],this.position[2]),this._camera.rotation.copy(this.node.rotation),this._camera.updateMatrixWorld(!0),this._updateFrustum()},t.prototype.customSetup=function(e){this._aspect=e.aspect||this._aspect,this._fov=e.fov||this._fov,this._near=e.near||this._near,this._far=e.far||this._far,this._build()},t.prototype.setWorldPosition=function(t){e.prototype.setWorldPosition.call(this,t),this._camera.position.set(t[0],t[1],t[2]),this._camera.updateMatrixWorld(!0),this._updateFrustum()},t.prototype.intersectsObject=function(e){return this._updateFrustum(),!!this._frustum._intersectsObject(e.node)},o(t,[{key:"aspect",set:function(e){this._aspect=e,this._build()},get:function(){return this._aspect}},{key:"fov",set:function(e){this._fov=e,this._build()},get:function(){return this._fov}},{key:"far",set:function(e){this._far=e,this._build()},get:function(){return this._far}}]),t}(bt),fi={uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:1},exposure:{value:0},gamma:{value:1},saturation:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float brightness;","uniform float contrast;","uniform float exposure;","uniform float gamma;","uniform float saturation;","const vec3 w = vec3(0.2125, 0.7154, 0.0721);","void main() {","vec4 tex = texture2D( tDiffuse, vUv );","vec3 color = clamp(tex.rgb + vec3(brightness), 0.0, 1.0);","color = clamp( (color-vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);","color = clamp( color * pow(2.0, exposure), 0.0, 1.0);","color = clamp( pow(color, vec3(gamma)), 0.0, 1.0);","float luminance = dot( color, w );","color = mix(vec3(luminance), color, saturation);","gl_FragColor = vec4(color, tex.a);","}"].join("\n")},mi={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},gi={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immedates.","    // Immedates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")},vi=new THREE.OrthographicCamera(-1,1,1,-1,0,1),yi=new THREE.Scene,bi=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null);bi.frustumCulled=!1,yi.add(bi);var _i=new THREE.Color,xi=function(){function e(t,i,r,o){n(this,e),this.clear=!0,this.clearColor=new THREE.Color(0,0,0),this.clearAlpha=1,this.textureID=void 0!==i?i:"tDiffuse",this.resolutionID=void 0!==r?r:"resolution",this.resolutionScaler=void 0!==o?o:1,t instanceof THREE.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=THREE.UniformsUtils.clone(t.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}))}return e.prototype.setSize=function(e,t){this.uniforms[this.resolutionID]&&this.uniforms[this.resolutionID].value.set(this.resolutionScaler/e,this.resolutionScaler/t)},e.prototype.render=function(e,t,i,r,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture);var o=e.getClearAlpha(),a=e.autoClear;e.autoClear=!1,this.clear&&(_i.copy(e.getClearColor()),e.setClearColor(this.clearColor,this.clearAlpha)),bi.material=this.material,e.setRenderTarget(void 0!==t?t:null),this.clear&&e.clear(),e.render(yi,vi),this.clear&&e.setClearColor(_i,o),e.autoClear=a},e}(),Ei=0,wi=function(){function e(t,i){n(this,e),this.id=++Ei,this._renderTarget=new THREE.WebGLRenderTarget(t,i,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.HalfFloat}),this._renderTarget.depthTexture=new THREE.DepthTexture(t,i),this._renderTarget.depthTexture.format=THREE.DepthStencilFormat,this._renderTarget.depthTexture.type=THREE.UnsignedInt248Type,this._normalMaterial=new THREE.MeshNormalMaterial,this.ignoreTransparent=!0}return e.prototype.setSize=function(e,t){this._renderTarget.setSize(e,t)},e.prototype.render=function(e,t,i,r){if(!e.materialManager.hasStrategy("NormalDepthBuffer"+this.id)){var n=this;e.materialManager.addStrategy("NormalDepthBuffer"+this.id,(function(e,t,i,r,o,a){return n.ignoreTransparent&&o.transparent?null:n.ignoreTransparent&&o.alphaTest>0?null:n._normalMaterial}))}this.ignoreTransparent=r;var o=e.getClearColor().getHex(),a=e.getClearAlpha();e.setClearColor(7829503,1),e.materialManager.setMode("NormalDepthBuffer"+this.id);var s=t.autoUpdate,l=t.background,u=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.setRenderTarget(this._renderTarget),e.clear(),e.render(t,i),t.autoUpdate=s,t.background=l,e.shadowMap.enable=u,e.materialManager.setMode(0),e.setClearColor(o,a)},e.prototype.getNormalTexture=function(){return this._renderTarget.texture},e.prototype.getDepthTexture=function(){return this._renderTarget.depthTexture},e}(),Ti={defines:{DEPTH_PACKING:1,KERNEL_SIZE:64,EPSILON:1e-6},uniforms:{normalTex:{value:null},depthTex:{value:null},noiseTex:{value:null},texSize:{value:new THREE.Vector2},noiseTexSize:{value:new THREE.Vector2(4,4)},projection:{value:new THREE.Matrix4},projectionInv:{value:new THREE.Matrix4},kernel:{value:null},radius:{value:.2},power:{value:1},bias:{value:.004},intensity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp sampler2D;","#include <packing>","varying vec2 vUv;","uniform sampler2D normalTex;","uniform sampler2D depthTex;","uniform vec2 texSize;","uniform sampler2D noiseTex;","uniform vec2 noiseTexSize;","uniform mat4 projection;","uniform mat4 projectionInv;","uniform vec3 kernel[KERNEL_SIZE];","uniform float radius;","uniform float power;","uniform float bias;","uniform float intensity;","float getDepth( const in vec2 screenPosition ) {","#if DEPTH_PACKING == 1","return unpackRGBAToDepth( texture2D( depthTex, screenPosition ) );","#elif DEPTH_PACKING == 2","return texture2D( depthTex, screenPosition ).w;","#else","return texture2D( depthTex, screenPosition ).x;","#endif","}","vec3 getViewNormal( const in vec2 screenPosition ) {","return unpackRGBToNormal( texture2D( normalTex, screenPosition ).xyz );","}","float ssaoEstimator(in mat3 kernelBasis, in vec3 originPos, in vec3 N) {","float occlusion = 0.0;","for (int i = 0; i < KERNEL_SIZE; i++) {","vec3 samplePos = kernel[i];","samplePos = kernelBasis * samplePos;","samplePos = samplePos * radius + originPos;","vec4 texCoord = projection * vec4(samplePos, 1.0);","texCoord.xy /= texCoord.w;","texCoord.xy = texCoord.xy * 0.5 + 0.5;","float sampleDepth = getDepth(texCoord.xy);","float z = sampleDepth * 2.0 - 1.0;","#ifdef ALCHEMY","vec4 projectedPos = vec4(texCoord.xy * 2.0 - 1.0, z, 1.0);","vec4 p4 = projectionInv * projectedPos;","p4.xyz /= p4.w;","vec3 cDir = p4.xyz - originPos;","float vv = dot(cDir, cDir);","float vn = dot(cDir, N);","float radius2 = radius * radius;","vn = max(vn + p4.z * bias, 0.0);","float f = max(radius2 - vv, 0.0) / radius2;","occlusion += f * f * f * max(vn / (0.01 + vv), 0.0);","#else","if (projection[3][3] == 0.0) {","z = projection[3][2] / (z * projection[2][3] - projection[2][2]);","} else {","z = (z - projection[3][2]) / projection[2][2];","}","float factor = step(samplePos.z, z - bias);","float rangeCheck = smoothstep(0.0, 1.0, radius / abs(originPos.z - z));","occlusion += rangeCheck * factor;","#endif","}","occlusion = 1.0 - occlusion / float(KERNEL_SIZE);","return pow(occlusion, power);","}","void main() {","float centerDepth = getDepth( vUv );","if( centerDepth >= ( 1.0 - EPSILON ) ) {","\tdiscard;","}","vec3 N = getViewNormal( vUv );","vec2 noiseTexCoord = texSize / vec2(noiseTexSize) * vUv;","vec3 rvec = texture2D(noiseTex, noiseTexCoord).rgb * 2.0 - 1.0;","vec3 T = normalize(rvec - N * dot(rvec, N));","vec3 BT = normalize(cross(N, T));","mat3 kernelBasis = mat3(T, BT, N);","float z = centerDepth * 2.0 - 1.0;","vec4 projectedPos = vec4(vUv * 2.0 - 1.0, z, 1.0);","vec4 p4 = projectionInv * projectedPos;","vec3 position = p4.xyz / p4.w;","float ao = ssaoEstimator(kernelBasis, position, N);","ao = clamp(1.0 - (1.0 - ao) * intensity, 0.0, 1.0);","gl_FragColor = vec4(vec3(ao), 1.0);","}"].join("\n")};function Si(e){for(var t=new Uint8Array(e*e*4),i=0,r=new THREE.Vector3,n=0;n<e;n++)for(var o=0;o<e;o++)r.set(2*Math.random()-1,2*Math.random()-1,0).normalize(),t[i++]=255*(.5*r.x+.5),t[i++]=255*(.5*r.y+.5),t[i++]=0,t[i++]=255;return t}function Ai(e,t){for(var i=0,r=1/t,n=e;n>0;)i+=r*(n%t),n=Math.floor(n/t),r/=t;return i}function Mi(e,t){this._tempRenderTarget=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._tempRenderTarget2=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.ssaoMaterial=new THREE.ShaderMaterial({defines:Object.assign({},Ti.defines),fragmentShader:Ti.fragmentShader,vertexShader:Ti.vertexShader,uniforms:THREE.UniformsUtils.clone(Ti.uniforms),depthTest:!1,depthWrite:!1}),this.blurMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SuperSSAOBlurShader.defines),fragmentShader:THREE.SuperSSAOBlurShader.fragmentShader,vertexShader:THREE.SuperSSAOBlurShader.vertexShader,uniforms:THREE.UniformsUtils.clone(THREE.SuperSSAOBlurShader.uniforms),depthTest:!1,depthWrite:!1,transparent:!0,blending:THREE.CustomBlending,blendSrc:THREE.ZeroFactor,blendDst:THREE.SrcColorFactor,blendEquation:THREE.AddEquation,blendSrcAlpha:THREE.ZeroFactor,blendDstAlpha:THREE.SrcColorFactor,blendEquationAlpha:THREE.AddEquation}),this.quadCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.quadScene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),null),this.quadScene.add(this.quadCamera),this.quadScene.add(this.quad),this._kernels={},this.setNoiseSize(4),this.setKernelSize(12),this.setParameter("radius",.2),this.setParameter("bias",.004),this.setParameter("power",1),this.setParameter("intensity",.8),this.ssaoMaterial.uniforms.texSize.value.set(e,t),this.blurMaterial.uniforms.textureSize.value.set(e,t)}THREE.SuperSSAOBlurShader={defines:{NORMALTEX_ENABLED:1,DEPTHTEX_ENABLED:1,DEPTH_PACKING:1},uniforms:{tDiffuse:{value:null},textureSize:{value:new THREE.Vector2},direction:{value:0},blurSize:{value:1},depthTex:{value:null},normalTex:{value:null},projection:{value:new THREE.Matrix4},depthRange:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec2 vUv;","uniform vec2 textureSize;","uniform float blurSize;","uniform sampler2D tDiffuse;","uniform int direction;","#if NORMALTEX_ENABLED == 1","uniform sampler2D normalTex;","vec3 getViewNormal( const in vec2 screenPosition ) {","return unpackRGBToNormal( texture2D( normalTex, screenPosition ).xyz );","}","#endif","#if DEPTHTEX_ENABLED == 1","uniform sampler2D depthTex;","uniform mat4 projection;","uniform float depthRange;","float getDepth( const in vec2 screenPosition ) {","#if DEPTH_PACKING == 1","return unpackRGBAToDepth( texture2D( depthTex, screenPosition ) );","#elif DEPTH_PACKING == 2","return texture2D( depthTex, screenPosition ).w;","#else","return texture2D( depthTex, screenPosition ).x;","#endif","}","float getLinearDepth(vec2 coord) {","float depth = getDepth(coord) * 2.0 - 1.0;","return projection[3][2] / (depth * projection[2][3] - projection[2][2]);","}","#endif","void main() {","float kernel[5];","kernel[0] = 0.122581;","kernel[1] = 0.233062;","kernel[2] = 0.288713;","kernel[3] = 0.233062;","kernel[4] = 0.122581;","vec2 off = vec2(0.0);","if (direction == 0) {","off[0] = blurSize / textureSize.x;","}","else {","off[1] = blurSize / textureSize.y;","}","float sum = 0.0;","float weightAll = 0.0;","#if NORMALTEX_ENABLED == 1","vec3 centerNormal = getViewNormal(vUv);","#endif","#if DEPTHTEX_ENABLED == 1","float centerDepth = getLinearDepth(vUv);","#endif","for (int i = 0; i < 5; i++) {","vec2 coord = clamp(vUv + vec2(float(i) - 2.0) * off, vec2(0.0), vec2(1.0));","float w = kernel[i];","#if NORMALTEX_ENABLED == 1","vec3 normal = getViewNormal(coord);","w *= clamp(dot(normal, centerNormal), 0.0, 1.0);","#endif","#if DEPTHTEX_ENABLED == 1","float d = getLinearDepth(coord);","w *= (1.0 - smoothstep(0.0, 1.0, abs(centerDepth - d) / depthRange));","#endif","weightAll += w;","sum += w * texture2D(tDiffuse, coord).r;","}","gl_FragColor = vec4(vec3(sum / weightAll), 1.0);","}"].join("\n")},Mi.prototype=Object.assign(Mi.prototype,{constructor:Mi,setSize:function(e,t){this._tempRenderTarget.setSize(e,t),this._tempRenderTarget2.setSize(e,t),this.ssaoMaterial.uniforms.texSize.value.set(e,t),this.blurMaterial.uniforms.textureSize.value.set(e,t)},render:function(e,t,i,r,n,o){this.ssaoMaterial.uniforms.normalTex.value=e,this.ssaoMaterial.uniforms.depthTex.value=t,this.ssaoMaterial.uniforms.projection.value.copy(r.projectionMatrix),this.ssaoMaterial.uniforms.projectionInv.value.getInverse(r.projectionMatrix),this.blurMaterial.uniforms.normalTex.value=e,this.blurMaterial.uniforms.depthTex.value=t,this.blurMaterial.uniforms.projection.value.copy(r.projectionMatrix),t===e?(this.ssaoMaterial.defines.DEPTH_PACKING=2,this.blurMaterial.defines.DEPTH_PACKING=2):t.isDepthTexture?(this.ssaoMaterial.defines.DEPTH_PACKING=0,this.blurMaterial.defines.DEPTH_PACKING=0):(this.ssaoMaterial.defines.DEPTH_PACKING=1,this.blurMaterial.defines.DEPTH_PACKING=1);var a=i.getClearColor().getHex(),s=i.getClearAlpha(),l=i.autoClear;i.autoClear=!1,this.quad.material=this.ssaoMaterial,i.setClearColor(16777215,1),i.setRenderTarget(this._tempRenderTarget),i.clear(),i.render(this.quadScene,this.quadCamera),this.quad.material=this.blurMaterial,this.blurMaterial.uniforms.tDiffuse.value=this._tempRenderTarget.texture,this.blurMaterial.uniforms.direction.value=0,this.blurMaterial.uniforms.blurSize.value=1,this.blurMaterial.transparent=!1,i.setClearColor(16777215,1),i.setRenderTarget(this._tempRenderTarget2),i.clear(),i.render(this.quadScene,this.quadCamera),this.blurMaterial.uniforms.tDiffuse.value=this._tempRenderTarget2.texture,this.blurMaterial.uniforms.direction.value=1,this.blurMaterial.uniforms.blurSize.value=1,this.blurMaterial.transparent=!o,this.blurMaterial.blending=o?THREE.NoBlending:THREE.CustomBlending,o&&i.setClearColor(0,0),i.setRenderTarget(void 0!==n?n:null),o&&i.clear(),i.render(this.quadScene,this.quadCamera),i.setClearColor(a,s),i.autoClear=l},setKernelSize:function(e,t){t=void 0!==t?t:0,this._kernels[e+"_"+t]||(this._kernels[e+"_"+t]=function(e,t,i){var r=new Float32Array(3*e);t=t||0;for(var n=0;n<e;n++){var o=Ai(n+t,2)*(i?1:2)*Math.PI,a=Ai(n+t,3)*Math.PI,s=Math.random(),l=Math.cos(o)*Math.sin(a)*s,u=Math.cos(a)*s,c=Math.sin(o)*Math.sin(a)*s;r[3*n]=l,r[3*n+1]=u,r[3*n+2]=c}return r}(e,e*t,!0)),this.ssaoMaterial.defines.KERNEL_SIZE=e,this.ssaoMaterial.uniforms.kernel.value=this._kernels[e+"_"+t]},setNoiseSize:function(e){var t=this.ssaoMaterial.uniforms.noiseTex.value;t?(t.image.data=Si(e),t.image.width=e,t.image.height=e,t.needsUpdate=!0):(t=function(e){var t=new THREE.DataTexture(Si(e),e,e,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping);return t.needsUpdate=!0,t}(e),this.ssaoMaterial.uniforms.noiseTex.value=t),this.ssaoMaterial.uniforms.noiseTexSize.value.set(e,e)},setParameter:function(e,t){"noiseTexSize"===e?this.setNoiseSize(t):"kernelSize"===e?this.setKernelSize(t):"blurSize"===e?this.blurMaterial.uniforms.blurSize.value=1:this.ssaoMaterial.uniforms[e].value=t}});var Ci={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new THREE.Color(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")};function Ri(e,t,i,r){this.renderToScreen=!1,this.strength=void 0!==t?t:1,this.radius=i,this.threshold=r,this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256),this.clearColor=new THREE.Color(0,0,0);var n={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new THREE.WebGLRenderTarget(o,a,n),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var l=new THREE.WebGLRenderTarget(o,a,n);l.texture.name="UnrealBloomPass.h"+s,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l);var u=new THREE.WebGLRenderTarget(o,a,n);u.texture.name="UnrealBloomPass.v"+s,u.texture.generateMipmaps=!1,this.renderTargetsVertical.push(u),o=Math.round(o/2),a=Math.round(a/2)}this.highPassUniforms=THREE.UniformsUtils.clone(Ci.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:Ci.vertexShader,fragmentShader:Ci.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var c=[3,5,7,9,11];for(o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(c[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new THREE.Vector2(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,this.copyUniforms=THREE.UniformsUtils.clone(mi.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:mi.vertexShader,fragmentShader:mi.fragmentShader,blending:THREE.CustomBlending,blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.OneFactor,blendEquation:THREE.AddEquation,blendSrcAlpha:THREE.ZeroFactor,blendDstAlpha:THREE.OneFactor,blendEquationAlpha:THREE.AddEquation,depthTest:!1,depthWrite:!1,transparent:!0}),this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.basic=new THREE.MeshBasicMaterial,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)}Object.assign(Ri.prototype,{dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var i=Math.round(e/2),r=Math.round(t/2);this.renderTargetBright.setSize(i,r);for(var n=0;n<this.nMips;n++)this.renderTargetsHorizontal[n].setSize(i,r),this.renderTargetsVertical[n].setSize(i,r),this.separableBlurMaterials[n].uniforms.texSize.value=new THREE.Vector2(i,r),i=Math.round(i/2),r=Math.round(r/2)},render:function(e,t,i,r,n){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),n&&e.getContext().disable(e.getContext().STENCIL_TEST),this.renderToScreen&&(this.quad.material=this.basic,this.basic.map=i.texture,e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.quad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),e.render(this.scene,this.camera);for(var a=this.renderTargetBright,s=0;s<this.nMips;s++)this.quad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[s].uniforms.direction.value=Ri.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[s]),e.clear(),e.render(this.scene,this.camera),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=Ri.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[s]),e.clear(),e.render(this.scene,this.camera),a=this.renderTargetsVertical[s];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),e.render(this.scene,this.camera),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,n&&e.getContext().enable(e.getContext().STENCIL_TEST),this.renderToScreen?(e.setRenderTarget(null),e.render(this.scene,this.camera)):(e.setRenderTarget(i),e.render(this.scene,this.camera)),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),Ri.BlurDirectionX=new THREE.Vector2(1,0),Ri.BlurDirectionY=new THREE.Vector2(0,1);var Di={vertexShader:"#include <skinning_pars_vertex>\n    void main() {\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"void main() {        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);    }"};function Pi(e,t,i,r){Ri.call(this,e,t,i,r),this.prepareMaskMaterial=new THREE.ShaderMaterial(Di),this.prepareMaskSkinningMaterial=new THREE.ShaderMaterial(Di),this.prepareMaskSkinningMaterial.skinning=!0;var n={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetTemp=new THREE.WebGLMultisampleRenderTarget(o,a,n),this.renderTargetTemp.samples=5,this.renderTargetTemp.stencilBuffer=!1,this.renderTargetTemp.texture.name="UnrealGlowPass.temp",this.renderTargetTemp.texture.generateMipmaps=!1,this.renderTargetTemp2=new THREE.WebGLRenderTarget(o,a,n),this.renderTargetTemp2.texture.name="UnrealGlowPass.temp2",this.renderTargetTemp2.texture.generateMipmaps=!1,this._dirty=!0,this.enable=!1,this.enable2=!1}Pi.prototype=Object.assign(Object.create(Ri.prototype),{constructor:Pi,dispose:function(){Ri.prototype.dispose.call(this),this.renderTargetTemp.dispose(),this.renderTargetTemp2.dispose()},setSize:function(e,t){Ri.prototype.setSize.call(this,e,t);var i=Math.round(e/2),r=Math.round(t/2);this.renderTargetTemp.setSize(i,r),this.renderTargetTemp2.setSize(i,r)},render:function(e,t,i,r){if(this.enable||this.enable2){var n=this;e.materialManager.hasStrategy("GlowPass")||e.materialManager.addStrategy("GlowPass",(function(e,t,i,r,o,a){return this.technique&&"skip"==this.technique.glow&&!this.technique.smallGlow?null:"BackgroundCubeMaterial"===o.type||"sky"===this.name?null:this.technique&&this.technique.glow?this.technique.glow.isMaterial?this.technique.glow:o:this.technique&&this.technique.smallGlow?this.technique.smallGlow.isMaterial?this.technique.smallGlow:o:this.isSkinnedMesh?(n.prepareMaskSkinningMaterial.side=o.side,n.prepareMaskSkinningMaterial):(n.prepareMaskMaterial.side=o.side,n.prepareMaskMaterial)}));var o=e.autoClear;if(e.autoClear=!1,this._dirty){var a=e.capabilities.isWebGL2;this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(new THREE.Color(0,0,0),0),e.materialManager.setMode("GlowPass");var s=t.autoUpdate,l=t.background,u=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.initRenderList=!1,e.setRenderTarget(a?this.renderTargetTemp:this.renderTargetTemp2),e.clear(),e.render(t,i),t.autoUpdate=s,t.background=l,e.shadowMap.enable=u,e.initRenderList=!0,e.materialManager.setMode(0),this.highPassUniforms.tDiffuse.value=a?this.renderTargetTemp.texture:this.renderTargetTemp2.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.quad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),e.render(this.scene,this.camera);for(var c=this.renderTargetBright,h=0;h<this.nMips;h++)this.quad.material=this.separableBlurMaterials[h],this.separableBlurMaterials[h].uniforms.colorTexture.value=c.texture,this.separableBlurMaterials[h].uniforms.direction.value=Ri.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[h]),e.clear(),e.render(this.scene,this.camera),this.separableBlurMaterials[h].uniforms.colorTexture.value=this.renderTargetsHorizontal[h].texture,this.separableBlurMaterials[h].uniforms.direction.value=Ri.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[h]),e.clear(),e.render(this.scene,this.camera),c=this.renderTargetsVertical[h];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),e.render(this.scene,this.camera),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,e.setClearColor(this.oldClearColor,this.oldClearAlpha),this._dirty=!1}e.setRenderTarget(void 0!==r?r:null),e.render(this.scene,this.camera),e.autoClear=o}},dirty:function(){this._dirty=!0}});var ji={uniforms:{scene:{value:null},texSize:{value:new THREE.Vector2(1,1)},Stride:{value:10}},vertexShader:"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t}\n    ",fragmentShader:"\n\t#define WT9_0 1.0\n\t#define WT9_1 0.8\n\t#define WT9_2 0.6\n\t#define WT9_3 0.4\n\t#define WT9_4 0.2\n\t#define WT9_NORMALIZE 5.2\n\tvarying vec2 vUv;\n\tuniform sampler2D scene;\n\tuniform vec2 texSize;\n\tuniform float Stride;\n\tvoid main() {\n\t\tfloat TexelIncrement =0.25 * Stride /texSize.x;\n\n\t\tfloat colour = texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement =0.5 * Stride /texSize.x;\n\t\tcolour += texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement =0.75 * Stride /texSize.x;\n\t\tcolour += texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement =Stride /texSize.x;\n\t\tcolour += texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tfloat col = 1.0-colour*0.25;\n\n\t\tgl_FragColor = vec4(col,col,col,col);\n\t}\n    "},Fi={uniforms:{blurX:{value:null},scene:{value:null},texSize:{value:new THREE.Vector2(1,1)},Stride:{value:10},Glowness:{value:2},GlowColor:{value:new THREE.Vector4(1,0,0,1)}},vertexShader:"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t}\n\t",fragmentShader:"\n\t#define WT9_0 1.0\n\t#define WT9_1 0.8\n\t#define WT9_2 0.6\n\t#define WT9_3 0.4\n\t#define WT9_4 0.2\n\t#define WT9_NORMALIZE 5.2\n\tvarying vec2 vUv;\n\tuniform vec2 texSize;\n\tuniform float Stride;\n\tuniform float Glowness;\n\tuniform vec4 GlowColor;\n\tuniform sampler2D blurX;\n\tuniform sampler2D scene;\n\tvoid main() {\n\n\t\tfloat TexelIncrement = 0.25 * Stride / texSize.y;\n\n\t\tfloat colour = texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement = 0.5 * Stride / texSize.y;\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement = 0.75 * Stride / texSize.y;\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement = Stride / texSize.y;\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tvec4 glo = (0.25 * Glowness * colour) * GlowColor;\n\t\tvec4 OldCol = texture2D(scene, vec2(vUv.x , vUv.y));\n\t\t\n\t\tgl_FragColor = vec4(OldCol.x*glo.xyz,1);\n\t}\n\t"},Oi={vertexShader:"\n        #include <skinning_pars_vertex>\n        void main() {\n            #include <skinbase_vertex>\n            #include <begin_vertex>\n            #include <skinning_vertex>\n            #include <project_vertex>\n        }\n    ",fragmentShader:"\n        void main() {\n            gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n        }\n    "},ki={vertexShader:"\n        #include <skinning_pars_vertex>\n        void main() {\n            #include <skinbase_vertex>\n            #include <begin_vertex>\n            #include <skinning_vertex>\n            #include <project_vertex>\n        }\n    ",fragmentShader:"\n        void main() {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    "};function Li(e,t){this.color=new THREE.Vector4(1,0,0,1),this.strength=2,this.stride=10;var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.markRenderTarget=new THREE.WebGLRenderTarget(e,t,i),this.markRenderTarget.texture.name="InnerGlowPass.mark",this.markRenderTarget.texture.generateMipmaps=!1,this.tempRenderTarget=new THREE.WebGLRenderTarget(e,t,i),this.tempRenderTarget.texture.name="InnerGlowPass.temp",this.tempRenderTarget.texture.generateMipmaps=!1,this.resultRenderTarget=new THREE.WebGLRenderTarget(e,t,i),this.resultRenderTarget.texture.name="InnerGlowPass.result",this.resultRenderTarget.texture.generateMipmaps=!1,this.prepareMarkMaterial=new THREE.ShaderMaterial(Oi),this.prepareMarkSkinningMaterial=new THREE.ShaderMaterial(Oi),this.prepareMarkSkinningMaterial.skinning=!0,this.prepareMaskMaterial=new THREE.ShaderMaterial(ki),this.prepareMaskSkinningMaterial=new THREE.ShaderMaterial(ki),this.prepareMaskSkinningMaterial.skinning=!0,this.innerGlowXMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(ji.uniforms),vertexShader:ji.vertexShader,fragmentShader:ji.fragmentShader}),this.innerGlowXMaterial.uniforms.texSize.value.set(e,t),this.innerGlowYMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(Fi.uniforms),vertexShader:Fi.vertexShader,fragmentShader:Fi.fragmentShader}),this.innerGlowYMaterial.uniforms.texSize.value.set(e,t),this.copyUniforms=THREE.UniformsUtils.clone(mi.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:mi.vertexShader,fragmentShader:mi.fragmentShader,blending:THREE.CustomBlending,blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.OneFactor,blendEquation:THREE.AddEquation,blendSrcAlpha:THREE.ZeroFactor,blendDstAlpha:THREE.OneFactor,blendEquationAlpha:THREE.AddEquation,depthTest:!1,depthWrite:!1,transparent:!0}),this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.basic=new THREE.MeshBasicMaterial,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this._dirty=!0,this.enable=!1}Object.assign(Li.prototype,{dispose:function(){this.markRenderTarget.dispose(),this.tempRenderTarget.dispose(),this.resultRenderTarget.dispose()},setSize:function(e,t){this.markRenderTarget.setSize(e,t),this.tempRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t),this.innerGlowXMaterial.uniforms.texSize.value.set(e,t),this.innerGlowYMaterial.uniforms.texSize.value.set(e,t)},render:function(e,t,i,r){if(this.enable){var n=this;e.materialManager.hasStrategy("InnerGlowPass")||e.materialManager.addStrategy("InnerGlowPass",(function(e,t,i,r,o,a){if(this.technique&&"skip"==this.technique.innerGlow)return null;if("BackgroundCubeMaterial"===o.type||"sky"===this.name)return null;var s=void 0;return(s=this.technique&&this.technique.innerGlow?this.technique.innerGlow.isMaterial?this.technique.innerGlow:this.isSkinnedMesh?n.prepareMarkSkinningMaterial:n.prepareMarkMaterial:this.isSkinnedMesh?n.prepareMaskSkinningMaterial:n.prepareMaskMaterial).side=o.side,s}));var o=e.autoClear;if(e.autoClear=!1,this._dirty){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(new THREE.Color(0,0,0),0),e.materialManager.setMode("InnerGlowPass");var a=t.autoUpdate,s=t.background,l=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.initRenderList=!1,e.setRenderTarget(this.markRenderTarget),e.clear(),e.render(t,i),t.autoUpdate=a,t.background=s,e.shadowMap.enable=l,e.initRenderList=!0,e.materialManager.setMode(0),this.innerGlowXMaterial.uniforms.scene.value=this.markRenderTarget.texture,this.innerGlowXMaterial.uniforms.Stride.value=this.stride,this.quad.material=this.innerGlowXMaterial,e.setRenderTarget(this.tempRenderTarget),e.clear(),e.render(this.scene,this.camera),this.innerGlowYMaterial.uniforms.blurX.value=this.tempRenderTarget.texture,this.innerGlowYMaterial.uniforms.scene.value=this.markRenderTarget.texture,this.innerGlowYMaterial.uniforms.Stride.value=this.stride,this.innerGlowYMaterial.uniforms.Glowness.value=this.strength,this.innerGlowYMaterial.uniforms.GlowColor.value.copy(this.color),this.quad.material=this.innerGlowYMaterial,e.setRenderTarget(this.resultRenderTarget),e.clear(),e.render(this.scene,this.camera),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.resultRenderTarget.texture,e.setClearColor(this.oldClearColor,this.oldClearAlpha),this._dirty=!1}e.setRenderTarget(void 0!==r?r:null),e.render(this.scene,this.camera),e.autoClear=o}},dirty:function(){this._dirty=!0}});var Bi={vertexShader:"#include <skinning_pars_vertex>\n    void main() {\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"void main() {        gl_FragColor = vec4(0.0, 1.0, 1.0, 1.0);    }"},Hi={uniforms:{maskTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},edgeColor:{value:new THREE.Vector3(1,1,1)}},vertexShader:"#include <skinning_pars_vertex>\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"varying vec2 vUv;    uniform sampler2D maskTexture;    uniform vec2 texSize;    uniform vec3 edgeColor;        void main() {\n        vec2 invSize = 1.0 / texSize;        vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);        vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);        vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);        vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);        vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);        float b1 = max(c1.b, c2.b);        float b2 = max(c3.b, c4.b);        float a = max(b1, b2);        gl_FragColor = vec4(edgeColor, a);    }"},Ii={defines:{MAX_RADIUS:4},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"#include <skinning_pars_vertex>\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"#include <common>    varying vec2 vUv;    uniform sampler2D colorTexture;    uniform vec2 texSize;    uniform vec2 direction;    uniform float kernelRadius;        float gaussianPdf(in float x, in float sigma) {        return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;    }    void main() {        vec2 invSize = 1.0 / texSize;        float weightSum = gaussianPdf(0.0, kernelRadius);        vec4 diffuseColor = texture2D( colorTexture, vUv);        vec4 diffuseSum = diffuseColor * weightSum;        vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);        vec2 uvOffset = delta;        for( int i = 1; i <= MAX_RADIUS; i ++ ) {            float w = gaussianPdf(uvOffset.x, kernelRadius);            vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);            vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);            diffuseSum += ((sample1 + sample2) * w);            weightSum += (2.0 * w);            uvOffset += delta;        }        vec4 color = diffuseSum/weightSum;         gl_FragColor = color;    }"},Ni={uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},edgeStrength:{value:1},edgeGlow:{value:1}},vertexShader:"#include <skinning_pars_vertex>\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"varying vec2 vUv;    uniform sampler2D maskTexture;    uniform sampler2D edgeTexture1;    uniform sampler2D edgeTexture2;    uniform float edgeStrength;    uniform float edgeGlow;        void main() {        vec4 edgeValue1 = texture2D(edgeTexture1, vUv);        vec4 edgeValue2 = texture2D(edgeTexture2, vUv);        vec4 maskColor = texture2D(maskTexture, vUv);        vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;        vec4 finalColor = edgeStrength * edgeValue;        float a = finalColor.a * (1.0 - maskColor.b);        gl_FragColor = vec4(finalColor.rgb, a);    }"};function Ui(e,t,i){this.edgeColor=(new THREE.Color).setHex(void 0!==i?i:16777215),this.edgeColorString=this.edgeColor.getHexString(),this.edgeGlow=0,this.edgeThickness=1,this.edgeStrength=1.5,this.downSampleRatio=2;var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},n=Math.round(e/this.downSampleRatio),o=Math.round(t/this.downSampleRatio);this.renderTargetMaskBuffer0=new THREE.WebGLMultisampleRenderTarget(e,t,r),this.renderTargetMaskBuffer0.texture.name="OutlinePass.mask0",this.renderTargetMaskBuffer0.samples=5,this.renderTargetMaskBuffer0.stencilBuffer=!1,this.renderTargetMaskBuffer0.texture.generateMipmaps=!1,this.renderTargetMaskBuffer=new THREE.WebGLRenderTarget(e,t,r),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new THREE.WebGLRenderTarget(n,o,r),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new THREE.WebGLRenderTarget(n,o,r),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new THREE.WebGLRenderTarget(Math.round(n/2),Math.round(o/2),r),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer1=new THREE.WebGLRenderTarget(n,o,r),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new THREE.WebGLRenderTarget(Math.round(n/2),Math.round(o/2),r),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.prepareMaskMaterial=new THREE.ShaderMaterial(Bi),this.prepareMaskMaterial.side=THREE.DoubleSide,this.prepareMaskMaterial.renderingOutline=!0,this.prepareMaskSkinningMaterial=new THREE.ShaderMaterial(Bi),this.prepareMaskSkinningMaterial.side=THREE.DoubleSide,this.prepareMaskSkinningMaterial.skinning=!0,this.edgeDetectionMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(Hi.uniforms),vertexShader:Hi.vertexShader,fragmentShader:Hi.fragmentShader});this.separableBlurMaterial1=new THREE.ShaderMaterial({defines:Object.assign({},Ii.defines),uniforms:THREE.UniformsUtils.clone(Ii.uniforms),vertexShader:Ii.vertexShader,fragmentShader:Ii.fragmentShader}),this.separableBlurMaterial1.defines.MAX_RADIUS=4,this.separableBlurMaterial1.uniforms.texSize.value=new THREE.Vector2(n,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=new THREE.ShaderMaterial({defines:Object.assign({},Ii.defines),uniforms:THREE.UniformsUtils.clone(Ii.uniforms),vertexShader:Ii.vertexShader,fragmentShader:Ii.fragmentShader}),this.separableBlurMaterial2.defines.MAX_RADIUS=4,this.separableBlurMaterial2.uniforms.texSize.value=new THREE.Vector2(Math.round(n/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(Ni.uniforms),vertexShader:Ni.vertexShader,fragmentShader:Ni.fragmentShader,blending:THREE.NormalBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.copyUniforms=THREE.UniformsUtils.clone(mi.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:mi.vertexShader,fragmentShader:mi.fragmentShader,blending:THREE.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.tempPulseColor1=new THREE.Color,this.tempPulseColor2=new THREE.Color,this.textureMatrix=new THREE.Matrix4,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this._dirty=!0,this.enable=!1}Object.assign(Ui.prototype,{dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetMaskBuffer0.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t),this.renderTargetMaskBuffer0.setSize(e,t);var i=Math.round(e/this.downSampleRatio),r=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(i,r),this.renderTargetBlurBuffer1.setSize(i,r),this.renderTargetEdgeBuffer1.setSize(i,r),this.separableBlurMaterial1.uniforms.texSize.value.set(i,r),i=Math.round(i/2),r=Math.round(r/2),this.renderTargetBlurBuffer2.setSize(i,r),this.renderTargetEdgeBuffer2.setSize(i,r),this.separableBlurMaterial2.uniforms.texSize.value.set(i,r)},render:function(e,t,i,r){if(this.enable){if(!e.materialManager.hasStrategy("OutlinePass_"+this.edgeColorString)){var n=this;e.materialManager.addStrategy("OutlinePass_"+this.edgeColorString,(function(e,t,i,r,o,a){if(!this.userData.forceOutline&&!i.layers.test(this.layers))return null;var s="outline_0x"+n.edgeColorString;return this.technique&&this.technique[s]&&"skip"!==this.technique[s]?this.technique[s].isMaterial?this.technique[s]:this.isSkinnedMesh?n.prepareMaskSkinningMaterial:n.prepareMaskMaterial:null}))}this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;if(e.autoClear=!1,this._dirty){var a=e.capabilities.isWebGL2;e.setClearColor(0,0),e.materialManager.setMode("OutlinePass_"+this.edgeColorString);var s=t.autoUpdate,l=t.background,u=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.initRenderList=!1,i.layers.enable(1),e.setRenderTarget(a?this.renderTargetMaskBuffer0:this.renderTargetMaskBuffer),e.clear(),e.render(t,i),i.layers.disable(1),t.autoUpdate=s,t.background=l,e.shadowMap.enable=u,e.initRenderList=!0,e.materialManager.setMode(0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=a?this.renderTargetMaskBuffer0.texture:this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),e.render(this.scene,this.camera),this.quad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.edgeColor.value=this.edgeColor,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),e.render(this.scene,this.camera),this.quad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ui.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),e.render(this.scene,this.camera),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ui.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),e.render(this.scene,this.camera),this.quad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=Ui.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),e.render(this.scene,this.camera),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=Ui.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),e.render(this.scene,this.camera),this.quad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=a?this.renderTargetMaskBuffer0.texture:this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this._dirty=!1}e.setRenderTarget(void 0!==r?r:null),e.render(this.scene,this.camera),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o}},dirty:function(){this._dirty=!0}}),Ui.BlurDirectionX=new THREE.Vector2(1,0),Ui.BlurDirectionY=new THREE.Vector2(0,1);var Vi={uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:.5},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")},zi=function(e,t){for(var i=0,r=1/t,n=e;n>0;)i+=r*(n%t),n=Math.floor(n/t),r/=t;return i};function qi(e,t,i){this._samplingSize=i||30;for(var r=[],n=0;n<this._samplingSize;n++)r.push([zi(n,2),zi(n,3)]);this._haltonSequence=r,this._prevFrame=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._output=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._frame=0,this.quadCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.quadScene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(Vi.uniforms),vertexShader:Vi.vertexShader,fragmentShader:Vi.fragmentShader,depthTest:!1,depthWrite:!1})),this.quadScene.add(this.quadCamera),this.quadScene.add(this.quad)}qi.prototype=Object.assign(qi.prototype,{constructor:qi,setSize:function(e,t){this._prevFrame.setSize(e,t),this._output.setSize(e,t)},setSamplingSize:function(e){this._samplingSize=e||30;for(var t=[],i=0;i<this._samplingSize;i++)t.push([zi(i,2),zi(i,3)]);this._haltonSequence=t,this._frame=0},start:function(){this._frame=0},finished:function(){return this._frame>=this._samplingSize},frame:function(){return this._frame},jitterProjection:function(e,t,i){var r=this._haltonSequence[this._frame];r||console.error("THREE.SuperSampler: try to jitter camera after finished!",this._frame,this._haltonSequence.length),e.setViewOffset&&e.setViewOffset(t,i,.5*(2*r[0]-1),.5*(2*r[1]-1),t,i)},sample:function(e,t){var i=0===this._frame;this.quad.material.uniforms.tDiffuse1.value=t,this.quad.material.uniforms.tDiffuse2.value=this._prevFrame.texture,this.quad.material.uniforms.mixRatio.value=i?0:.9,this.quad.material.uniforms.opacity.value=1;var r=e.getClearColor().getHex(),n=e.getClearAlpha();e.setClearColor(0,0),e.setRenderTarget(this._output),e.clear(),e.render(this.quadScene,this.quadCamera),e.setClearColor(r,n);var o=this._prevFrame;return this._prevFrame=this._output,this._output=o,this._frame++,this._prevFrame},output:function(){return this._prevFrame}});var Wi={temporalSuperSampling:{enable:!1,size:30},postEffect:{enable:!0,bloom:{enable:!1,strength:.14,radius:.4,threshold:.7},screenSpaceAmbientOcclusion:{enable:!1,radius:.2,quality:"medium",intensity:.8,temporalFilter:!0,ignoreTransparent:!1},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1.1,saturation:1.1,gamma:1},vignette:{enable:!1,type:"color",color:0,offset:1},blur:{enable:!1,bounds:[[0,0,1,1]],radius:5},FXAA:{enable:!1},MSAA:{enable:!0}}},Gi=function(){function e(){n(this,e)}return e.prototype.setSize=function(e,t){},e.prototype.render=function(e,t,i,r,n){console.error("Effect: .render() must be implemented in derived pass.")},e}(),Xi=function(e){function t(i,r,o){n(this,t);var a=s(this,e.call(this));return a._pass=i,void 0!==r&&void 0!==o&&a.setSize(r,o),a}return a(t,e),t.prototype.setSize=function(e,t){this._pass.setSize(e,t)},t.prototype.render=function(e,t,i,r,n){this._pass.render(e,t,i,r,n)},t}(Gi),Yi={defines:{USE_VIGNETTE_TEXTURE:!1},uniforms:{tDiffuse:{value:null},vignetteOffset:{value:1},vignetteColor:{value:new THREE.Color(0)},vignetteTexture:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n\t    uniform sampler2D tDiffuse;\n\n\t\tuniform float vignetteOffset;\n        uniform vec3 vignetteColor;\n        \n        #ifdef USE_VIGNETTE_TEXTURE\n            uniform sampler2D vignetteTexture;\n        #endif\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 color = texture2D(tDiffuse, vUv);\n            vec2 uv = (vUv - vec2(0.5)) * vec2(vignetteOffset);\n            \n            vec3 color2 = vignetteColor;\n\n            #ifdef USE_VIGNETTE_TEXTURE\n                color2 *= texture2D(vignetteTexture, vUv).rgb;\n            #endif\n\n\t\t\tcolor.rgb = mix(color.rgb, color2, clamp(dot(uv, uv), 0.0, 1.0));\n\t\t\tgl_FragColor = color;\n\n\t\t}\n    "},Ji={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},Qi={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},Zi=function(e){function t(i,r){n(this,t);var o=s(this,e.call(this));o.type="color",o.color=new THREE.Color(0),o.offset=1;var a={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};return o.tempRenderTarget=new THREE.WebGLRenderTarget(i/2,r/2,a),o.tempRenderTarget2=new THREE.WebGLRenderTarget(i/2,r/2,a),o.effectHBlur=new xi(Qi),o.effectVBlur=new xi(Ji),o.effectHBlur.uniforms.h.value=4/i,o.effectVBlur.uniforms.v.value=4/r,o.blendPass=new xi(Yi),o}return a(t,e),t.prototype.setSize=function(e,t){this.tempRenderTarget.setSize(e/2,t/2),this.tempRenderTarget2.setSize(e/2,t/2),this.effectHBlur.uniforms.h.value=4/e,this.effectVBlur.uniforms.v.value=4/t},t.prototype.render=function(e,t,i,r,n){"color"===this.type?(this.blendPass.uniforms.vignetteOffset.value=this.offset,this.blendPass.uniforms.vignetteColor.value.copy(this.color),this.blendPass.material.defines.USE_VIGNETTE_TEXTURE&&(this.blendPass.material.defines.USE_VIGNETTE_TEXTURE=!1,this.blendPass.material.needsUpdate=!0)):"blur"===this.type&&(this.effectHBlur.render(e,this.tempRenderTarget2,i),this.effectVBlur.render(e,this.tempRenderTarget,this.tempRenderTarget2),this.blendPass.uniforms.vignetteOffset.value=this.offset,this.blendPass.uniforms.tDiffuse.value=i.texture,this.blendPass.uniforms.vignetteTexture.value=this.tempRenderTarget.texture,this.blendPass.uniforms.vignetteColor.value.setRGB(1,1,1),this.blendPass.material.defines.USE_VIGNETTE_TEXTURE||(this.blendPass.material.defines.USE_VIGNETTE_TEXTURE=!0,this.blendPass.material.needsUpdate=!0)),this.blendPass.render(e,t,i)},t}(Gi),Ki={defines:{},uniforms:{tDiffuse:{value:null},bounds:{value:new THREE.Vector4(0,0,1,1)},blendTexture:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D blendTexture;\n\n\t\tuniform vec4 bounds;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\tvec4 color = texture2D(tDiffuse, vUv);\n            vec3 color2 = texture2D(blendTexture, vUv).rgb;\n\n            float blend = step(vUv.x, bounds.z) \n                * step(bounds.x, vUv.x)\n                * step(1. - bounds.w, vUv.y) \n                * step(vUv.y, 1. - bounds.y);\n\n\t\t\tcolor.rgb = mix(color.rgb, color2, blend);\n\t\t\tgl_FragColor = color;\n\t\t}\n    "},$i={defines:{SAMPLERS:9},uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)},direction:{value:new THREE.Vector2(1,0)}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n        uniform sampler2D tDiffuse;\n        uniform vec2 resolution;\n        uniform vec2 direction;\n        varying vec2 vUv;\n\n        #if (SAMPLERS == 5) \n            vec4 blur(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n                vec4 color = vec4(0.0);\n                vec2 off1 = vec2(1.3333333333333333) * direction;\n                color += texture2D(image, uv) * 0.29411764705882354;\n                color += texture2D(image, uv + (off1 * resolution)) * 0.35294117647058826;\n                color += texture2D(image, uv - (off1 * resolution)) * 0.35294117647058826;\n                return color; \n            }\n        #endif\n        #if (SAMPLERS == 9)\n            vec4 blur(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n                vec4 color = vec4(0.0);\n                vec2 off1 = vec2(1.3846153846) * direction;\n                vec2 off2 = vec2(3.2307692308) * direction;\n                color += texture2D(image, uv) * 0.2270270270;\n                color += texture2D(image, uv + (off1 * resolution)) * 0.3162162162;\n                color += texture2D(image, uv - (off1 * resolution)) * 0.3162162162;\n                color += texture2D(image, uv + (off2 * resolution)) * 0.0702702703;\n                color += texture2D(image, uv - (off2 * resolution)) * 0.0702702703;\n                return color;\n            }\n        #endif\n        #if (SAMPLERS == 13)\n            vec4 blur(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n                vec4 color = vec4(0.0);\n                vec2 off1 = vec2(1.411764705882353) * direction;\n                vec2 off2 = vec2(3.2941176470588234) * direction;\n                vec2 off3 = vec2(5.176470588235294) * direction;\n                color += texture2D(image, uv) * 0.1964825501511404;\n                color += texture2D(image, uv + (off1 * resolution)) * 0.2969069646728344;\n                color += texture2D(image, uv - (off1 * resolution)) * 0.2969069646728344;\n                color += texture2D(image, uv + (off2 * resolution)) * 0.09447039785044732;\n                color += texture2D(image, uv - (off2 * resolution)) * 0.09447039785044732;\n                color += texture2D(image, uv + (off3 * resolution)) * 0.010381362401148057;\n                color += texture2D(image, uv - (off3 * resolution)) * 0.010381362401148057;\n                return color;\n            }\n        #endif\n\n        void main() {\n            gl_FragColor = blur(tDiffuse, vUv, resolution, direction);\n        }\n    "},er=function(e){function t(i,r){n(this,t);var o=s(this,e.call(this)),a={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};return o.tempRenderTarget=new THREE.WebGLRenderTarget(i,r,a),o.tempRenderTarget2=new THREE.WebGLRenderTarget(i,r,a),o.tempRenderTarget3=new THREE.WebGLRenderTarget(i,r,a),o.tempRenderTarget4=new THREE.WebGLRenderTarget(i,r,a),o.blurPass=new xi($i),o.blendPass=new xi(Ki),o.blendPass.uniforms.blendTexture.value=o.tempRenderTarget.texture,o.bounds=[[0,0,1,1]],o.radius=5,o}return a(t,e),t.prototype.setSize=function(e,t){this.tempRenderTarget.setSize(e,t),this.tempRenderTarget2.setSize(e,t),this.tempRenderTarget3.setSize(e,t),this.tempRenderTarget4.setSize(e,t)},t.prototype.render=function(e,t,i,r,n){for(var o=this,a=this.tempRenderTarget3.width,s=this.tempRenderTarget3.height,l=2+2*Math.floor(this.radius/2),u=0;u<l;u++){this.blurPass.uniforms.resolution.value.set(1/a,1/s);var c=this.radius*(u+1)/l;u%2==0?(this.blurPass.uniforms.direction.value.set(c,0),this.blurPass.render(e,this.tempRenderTarget2,0===u?i:this.tempRenderTarget)):(this.blurPass.uniforms.direction.value.set(0,c),this.blurPass.render(e,this.tempRenderTarget,this.tempRenderTarget2))}var h=i,p=this.tempRenderTarget3,d=void 0;this.bounds.forEach((function(i,r){o.blendPass.uniforms.bounds.value.fromArray(i),o.blendPass.render(e,r===o.bounds.length-1?t:p,h),d=h,h=p,p=0===r?o.tempRenderTarget4:d}))},t}(Gi);function tr(e,t){if("[object Object]"!==t.toString())return t;for(var i in t)t.hasOwnProperty(i)&&(e||(e={}),e[i]=tr(e[i],t[i]));return e}function ir(e,t){var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this._tempRenderTarget0=new THREE.WebGLMultisampleRenderTarget(e,t,i),this._tempRenderTarget0.samples=5,this._tempRenderTarget0.stencilBuffer=!1,this._tempRenderTarget=new THREE.WebGLRenderTarget(e,t,i),this._tempRenderTarget2=new THREE.WebGLRenderTarget(e,t,i),this._superSampler=new qi(e,t,30),this._normalDepthBuffer=new wi(e,t),this._ssaoPrePass=new Mi(e,t),this._ssaoKernalSize=12,this._bloomPass=new Ri({x:e,y:t},.14,.4,.6),this._colorEffect=new Xi(new xi(fi)),this._vignetteEffect=new Zi(e,t),this._rectBlurEffect=new er(e,t),this._fxaaEffect=new Xi(new xi(gi),e,t),this._copyPass=new xi(mi),this._glowPass=new Pi({x:e,y:t},1.5,.4,.2),this._innerGlowPass=new Li(e,t),this._outlinePasses=new Map,this._config=tr({},Wi),this.setConfig({}),this.width=e,this.height=t,this.onlyAO=!1}ir.prototype=Object.assign(ir.prototype,{constructor:ir,setConfig:function(e){this._config=tr(this._config,e),this._superSampler.setSamplingSize(this._config.temporalSuperSampling.size);var t=this._config.postEffect.bloom;this._bloomPass.strength=t.strength,this._bloomPass.radius=t.radius,this._bloomPass.threshold=t.threshold;t=this._config.postEffect.screenSpaceAmbientOcclusion;this._ssaoPrePass.setParameter("radius",t.radius),this._ssaoPrePass.setParameter("bias",t.radius/50),this._ssaoPrePass.setParameter("intensity",t.intensity),this._ssaoKernalSize={low:6,medium:12,high:32,ultra:64}[t.quality]||12,this._ssaoPrePass.setKernelSize(this._ssaoKernalSize);t=this._config.postEffect.colorCorrection;this._colorEffect._pass.uniforms.exposure.value=t.exposure,this._colorEffect._pass.uniforms.brightness.value=t.brightness,this._colorEffect._pass.uniforms.contrast.value=t.contrast,this._colorEffect._pass.uniforms.saturation.value=t.saturation,this._colorEffect._pass.uniforms.gamma.value=t.gamma;t=this._config.postEffect.vignette;this._vignetteEffect.type=t.type,this._vignetteEffect.color.setHex(t.color),this._vignetteEffect.offset=t.offset;t=this._config.postEffect.blur;this._rectBlurEffect.bounds=t.bounds,this._rectBlurEffect.radius=t.radius,this.dirty()},enable:function(e){if(e.indexOf("outline")>-1){var t=e.split("_"),i=t[1];if(e=t[0],this._outlinePasses.has(i))this._outlinePasses.get(i).enable=!0;else{var r=new Ui(this.width,this.height,i);r.enable=!0,this._outlinePasses.set(i,r)}}else"smallGlow"===e?this._glowPass.enable2=!0:this["_"+e+"Pass"].enable=!0},disable:function(e){if(e.indexOf("outline")>-1){var t=e.split("_"),i=t[1];if(e=t[0],this._outlinePasses.has(i))this._outlinePasses.get(i).enable=!1}else"smallGlow"===e?this._glowPass.enable2=!1:this["_"+e+"Pass"].enable=!1},setSize:function(e,t){this._tempRenderTarget0.setSize(e,t),this._tempRenderTarget.setSize(e,t),this._tempRenderTarget2.setSize(e,t),this._normalDepthBuffer.setSize(e,t),this._superSampler.setSize(e,t),this._ssaoPrePass.setSize(e,t),this._bloomPass.setSize(e,t),this._colorEffect.setSize(e,t),this._vignetteEffect.setSize(e,t),this._rectBlurEffect.setSize(e,t),this._fxaaEffect.setSize(e,t),this._glowPass.setSize(e,t),this._innerGlowPass.setSize(e,t),this._outlinePasses.forEach((function(i){i.setSize(e,t)})),this.width=e,this.height=t,this.dirty()},render:function(e,t,i,r){var n=this._config.temporalSuperSampling.enable,o=this._config.postEffect.enable;if(o||n){var a,s;n&&this._superSampler.finished()?a=this._superSampler.output():(n&&this._superSampler.jitterProjection(i,this._tempRenderTarget.width,this._tempRenderTarget.height),s=e.capabilities.isWebGL2&&this._config.postEffect.MSAA.enable?this._tempRenderTarget0:this._tempRenderTarget,e.setRenderTarget(s),e.clear(),e.render(t,i),n?(o&&this._config.postEffect.screenSpaceAmbientOcclusion.enable&&(this._normalDepthBuffer.render(e,t,i,this._config.postEffect.screenSpaceAmbientOcclusion.ignoreTransparent),this._config.postEffect.screenSpaceAmbientOcclusion.temporalFilter&&this._ssaoPrePass.setKernelSize(this._ssaoKernalSize,this._superSampler.frame()),this._ssaoPrePass.render(this._normalDepthBuffer.getNormalTexture(),this._normalDepthBuffer.getDepthTexture(),e,i,s,this.onlyAO)),a=this._superSampler.sample(e,s.texture),i.clearViewOffset()):(o&&this._config.postEffect.screenSpaceAmbientOcclusion.enable&&(this._normalDepthBuffer.render(e,t,i,this._config.postEffect.screenSpaceAmbientOcclusion.ignoreTransparent),this._ssaoPrePass.render(this._normalDepthBuffer.getNormalTexture(),this._normalDepthBuffer.getDepthTexture(),e,i,s,this.onlyAO)),a=s)),this._copyPass.render(e,this._tempRenderTarget2,a);var l=this._tempRenderTarget2,u=this._tempRenderTarget;if(o&&this._config.postEffect.colorCorrection.enable){this._colorEffect.render(e,u,l);var c=l;l=u,u=c}if(o&&this._config.postEffect.vignette.enable){this._vignetteEffect.render(e,u,l);c=l;l=u,u=c}if(o&&this._config.postEffect.bloom.enable&&this._bloomPass.render(e,u,l),this._innerGlowPass.render(e,t,i,l),this._glowPass.render(e,t,i,l),this._outlinePasses.forEach((function(r){return r.render(e,t,i,l)})),o&&this._config.postEffect.FXAA.enable){this._fxaaEffect.render(e,u,l);c=l;l=u,u=c}if(o&&this._config.postEffect.blur.enable){this._rectBlurEffect.render(e,u,l);c=l;l=u,u=c}this._copyPass.clear=e.autoClear,this._copyPass.render(e,r||void 0,l)}else e.setRenderTarget(r||null),e.render(t,i),this._innerGlowPass.render(e,t,i),this._glowPass.render(e,t,i),this._outlinePasses.forEach((function(r){return r.render(e,t,i)}))},dirty:function(){this._config.temporalSuperSampling.enable&&this._superSampler.start(),this._innerGlowPass.dirty(),this._glowPass.dirty(),this._outlinePasses.forEach((function(e){return e.dirty()}))}});var rr=new THREE.Vector3,nr=new THREE.Vector3,or={vertexShader:"\n        #include <skinning_pars_vertex>\n        void main() {\n            #include <skinbase_vertex>\n            #include <begin_vertex>\n            #include <skinning_vertex>\n            #include <project_vertex>\n        }\n    ",fragmentShader:"\n        void main() {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    "},ar=new THREE.ShaderMaterial(or),sr=new THREE.ShaderMaterial(or);sr.skinning=!0;var lr=new THREE.Color,ur=function(){function e(t,i){n(this,e),this.camera=new THREE.OrthographicCamera;var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.tempRenderTarget=new THREE.WebGLRenderTarget(t,i,r),this.radius=.1,this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;for(var o=Math.round(t/2),a=Math.round(i/2),s=0;s<this.nMips;s++){var l=new THREE.WebGLRenderTarget(o,a,r);l.texture.name="AOBaker.h"+s,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l);var u=new THREE.WebGLRenderTarget(o,a,r);u.texture.name="AOBaker.v"+s,u.texture.generateMipmaps=!1,this.renderTargetsVertical.push(u),o=Math.round(o/2),a=Math.round(a/2)}this.separableBlurMaterials=[];var c=[3,5,7,9,11];o=Math.round(t/2),a=Math.round(i/2);for(var h=0;h<this.nMips;h++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(c[h])),this.separableBlurMaterials[h].uniforms.texSize.value=new THREE.Vector2(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[.5,.7,.8,.9,1],this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)}return e.prototype.bake=function(e,t,i,r){i&&this.fit(i,r),e.materialManager.hasStrategy("AOBaker")||e.materialManager.addStrategy("AOBaker",(function(e,t,i,r,n,o){return this.userData.ground?null:n.skinning?sr:ar}));var n=e.autoClear;e.autoClear=!1,lr.copy(e.getClearColor());var o=e.getClearAlpha();e.setClearColor(new THREE.Color(1,1,1),1),e.materialManager.setMode("AOBaker");var a=t.autoUpdate,s=t.background,l=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.setRenderTarget(this.tempRenderTarget),e.clear(),e.render(t,this.camera),t.autoUpdate=a,t.background=s,e.shadowMap.enable=l,e.materialManager.setMode(0);for(var u=this.tempRenderTarget,c=0;c<this.nMips;c++)this.quad.material=this.separableBlurMaterials[c],this.separableBlurMaterials[c].uniforms.colorTexture.value=u.texture,this.separableBlurMaterials[c].uniforms.direction.value=new THREE.Vector2(1,0),e.setRenderTarget(this.renderTargetsHorizontal[c]),e.clear(),e.render(this.scene,this._camera),this.separableBlurMaterials[c].uniforms.colorTexture.value=this.renderTargetsHorizontal[c].texture,this.separableBlurMaterials[c].uniforms.direction.value=new THREE.Vector2(0,1),e.setRenderTarget(this.renderTargetsVertical[c]),e.clear(),e.render(this.scene,this._camera),u=this.renderTargetsVertical[c];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomRadius.value=1-this.radius,e.setRenderTarget(this.tempRenderTarget),e.clear(),e.render(this.scene,this._camera),e.setClearColor(lr,o),e.autoClear=n},e.prototype.fit=function(e,t){var i=e.getCenter(rr),r=e.getSize(nr);this.camera.position.set(i.x,i.y+r.y,i.z),this.camera.rotation.set(-Math.PI/2,0,0),this.camera.matrixAutoUpdate=!1,this.camera.updateMatrix(),this.camera.matrix.premultiply(t),this.camera.near=r.y/3,this.camera.far=2*r.y,this.camera.left=-r.x/2+.075,this.camera.right=r.x/2-.075,this.camera.top=r.z/2-.075,this.camera.bottom=-r.z/2+.075,this.camera.updateProjectionMatrix(),r.x=1024,r.z=1024,this.tempRenderTarget.setSize(r.x,r.z);for(var n=Math.round(r.x/2),o=Math.round(r.z/2),a=0;a<this.nMips;a++)this.renderTargetsHorizontal[a].setSize(n,o),this.renderTargetsVertical[a].setSize(n,o),this.separableBlurMaterials[a].uniforms.texSize.value=new THREE.Vector2(n,o),n=Math.round(n/2),o=Math.round(o/2)},e.prototype.dispose=function(){this.tempRenderTarget.dispose();for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(var t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose()},e.prototype.getSeperableBlurMaterial=function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},e.prototype.getCompositeMaterial=function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomFactors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\t\n\t\t\t\tfloat lerpBloomFactor(const in float factor) { \n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat factor0 = lerpBloomFactor(bloomFactors[0]);\n\t\t\t\t\tfloat factor1 = lerpBloomFactor(bloomFactors[1]);\n\t\t\t\t\tfloat factor2 = lerpBloomFactor(bloomFactors[2]);\n\t\t\t\t\tfloat factor3 = lerpBloomFactor(bloomFactors[3]);\n\t\t\t\t\tfloat factor4 = lerpBloomFactor(bloomFactors[4]);\n\t\t\t\t\tgl_FragColor = (factor0 * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor1 * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor2 * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor3 * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor4 * texture2D(blurTexture5, vUv)) / (factor0 + factor1 + factor2 + factor3 + factor4);\n\t\t\t\t}\t\n\t\t\t"})},o(e,[{key:"ao",get:function(){return this.tempRenderTarget.texture}}]),e}(),cr=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.setupUserData=function(t){e.prototype.setupUserData.call(this,t),this.node.userData.isCombinedObject=!0},t.prototype._notifyLoadingObjects=function(){},t.prototype.loadResource=function(){e.prototype.loadResource.call(this,!0)},t.prototype.unloadResource=function(){e.prototype.unloadResource.call(this,!0)},o(t,[{key:"isCombinedObject",get:function(){return!0}}]),t}(bt),hr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._height=3,r._initBoxSize=null,r.miscObject=null,r.wallObject=null,r.roofObject=null,r.ceilingObject=null,r._marker=null,r._navigation=null,r._groundAOBaker=null,r._baked=!1,r._showObjectsInParentLevels=!1,r}return a(t,e),t.prototype.isBlockMouseOffEvent=function(e){return!!this.isChildOf(e)},t.prototype.destroy=function(){this._groundAOBaker&&(this.plan.node.traverse((function(e){var t=e.material;t&&(t.aoMap=null,t.needsUpdate=!0)})),this._groundAOBaker.dispose(),this._groundAOBaker=null),e.prototype.destroy.call(this)},t.prototype.synTransform=function(e){this.setupUserData(e),this.parent||this.setupParent(e),e.skipSetupParent=!0,this.setupTranslation(e)},t.prototype.setupFromData=function(e){var t=this,i=e.data,r=e.options||{};r.complete=function(){t._setup(e)},this.synTransform(e),this.app._floorLoaderManager.loadFromData(this,i,r)},t.prototype.setupFromURL=function(e){var t=this,i=this.app.confirmURL(e.url),r=e.options||{};r.complete=function(){t._setup(e)},this.synTransform(e),this.app._floorLoaderManager.load(this,i,r)},t.prototype.customSetup=function(e){this._height=e.height||this._height,this._initBoxSize=e.initBoxSize,this._showObjectsInParentLevels=ke.parseValue(e.alwaysShowInsideObjs,this._showObjectsInParentLevels)},t.prototype.loadResource=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(t)e.prototype.loadResource.call(this,t);else{var i=[this.roof,this.wall,this.plan,this.ceiling];i.forEach((function(e){e.loadResource()})),this.doors.forEach((function(e){e.loadResource()})),this.things.forEach((function(e){e.isWindow&&e.loadResource()})),this.misc.traverse((function(e){e.node.isDoorOrWin&&e.loadResource()})),this.rooms.forEach((function(e){e.loadResource(!1)}))}},t.prototype.unloadResource=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(t)e.prototype.unloadResource.call(this,t);else{var i=[this.roof,this.wall,this.plan,this.ceiling];i.forEach((function(e){e.unloadResource()})),this.doors.forEach((function(e){e.unloadResource()})),this.things.forEach((function(e){e.isWindow&&e.unloadResource()})),this.misc.traverse((function(e){e.node.isDoorOrWin&&e.unloadResource()})),this.rooms.forEach((function(e){e.unloadResource(!1)}))}},t.prototype.setupResources=function(t){e.prototype.setupResources.call(this,t),this._ceilingNode=t.ceilingNode||this._ceilingNode,this._roofNode=t.roofNode||this._roofNode,this._floorNode=t.floorNode||this._floorNode,this._ceilingNode&&(this.ceiling.node=this._ceilingNode),this._roofNode&&(this.roof.node=this._roofNode),this._floorNode&&(this.plan.node=this._floorNode)},t.prototype._getChildVisibles=function(){var e=this.children.concat([this.roof,this.ceiling,this.plan]),t=[];return e.forEach((function(e){e&&t.push(e.visible)})),t},t.prototype._setChildVisible=function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",r=this.children.concat([this.roof,this.ceiling,this.plan]),n=0;n<r.length;n++){var o=r[n];o&&(o.inheritVisible?o._setVisible(e,i):o._setVisible(t[n],i))}},t.prototype._getDoors=function(e){for(var t=[],i=0;i<this.doors.length;i++){var r=this.doors[i];r[e]&&t.push(r)}return t},t.prototype._createMarker=function(e){var t=(e=e||{}).connectorName||/connector/,i=e.markerName||/marker/,r=this.attachPoints.query(t),n=this.attachPoints.query(i);if(0!=r.length||0!=n.length){var o=r[0],a=n[0];e.type="Marker",e.parent=this,ke.isNull(e.size)?console.error("floor's marker must provide size to show"):ke.isNull(e.canvas)&&ke.isNull(e.url)?console.error("floor's marker must provide 'canvas' or 'url' to show"):(a&&(e.position=a.position),o?e.lineToPosition=o.position:e.lineColor&&console.error("Please make sure connector is avaliable for showing connection line of marker"),this._marker=this.app.create(e))}},t.prototype.setupChildVisibleAsParent=function(e,t){this.visible||this._showObjectsInParentLevels||(e.visible=!1)},t.prototype.traverseRoofs=function(e){this.roof&&e(this.roof);for(var t=this.rooms,i=0;i<t.length;i++){var r=t[i].roof;r&&e(r)}},t.prototype.showAllRoofs=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.roof&&(this.roof.visible=e);for(var t=this.rooms,i=0;i<t.length;i++){var r=t[i].roof;r&&(r.visible=e)}},t.prototype.showAllCeilings=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.ceiling;t&&(t.visible=e);for(var i=this.rooms,r=0;r<i.length;r++)i[r].ceiling.visible=e},t.prototype.showMarker=function(e){this._marker||this._createMarker(e),ke.isBoolean(e)?this._marker.visible=e:this._marker.setParams(e)},t.prototype.getRoomFromLocalPosition=function(e){return this.getRoomFromWorldPosition(this.selfToWorld(e))},t.prototype.getRoomFromWorldPosition=function(e){for(var t=this.rooms,i=0;i<t.length;i++){var r=t[i];if(r.getRayCastPosition(e))return r}return null},t.prototype.bake=function(e){var t=this.plan;if(t){for(var i=t.node.getMeshes(),r=0;r<i.length;r++)if(i[r]instanceof THREE.Water)return;if(a=this.wall){var n=this;if(null===e){if(!this._baked)return;var o=function(e){e.isShaderMaterial||(ke.revertValue(e,"aoMap"),ke.revertValue(e,"aoMapIntensity"),e.needsUpdate=!0)};t.node.traverseMaterials(o),this.rooms.forEach((function(e){var t=e.plan;t&&t.node.traverseMaterials(o)})),this._baked=!1}else{var a;if(e=e||{},!(a=this.wall))return;var s=ke.parseValue(e.intensity,1.4);this._groundAOBaker||(this._groundAOBaker=new ur);var l=a.getLocalBoundingBox(!0,!0).toBox();this._initBoxSize&&l.max.addVectors(l.min,ke.parseVector3(this._initBoxSize).addScalar(.15)),this._groundAOBaker.bake(this.app.renderer,a.node,l,this.node.matrixWorld);var u=function(e,t){t.isShaderMaterial||(ke.backupValue(t,"aoMap"),ke.backupValue(t,"aoMapIntensity"),t.aoMap=n._groundAOBaker.ao,t.aoMapIntensity=s,t.needsUpdate=!0)};t.style._cloneAndModifyMaterial((function(e,t,i){u(0,t)})),this.rooms.forEach((function(e){var t=e.plan;t&&t.style._cloneAndModifyMaterial((function(e,t,i){u(0,t)}))})),this._baked=!0}}}},t.prototype.canNavigation=function(){return!0},t.prototype._getLinkableObjects=function(){var t=this.rooms;return t=t.concat(e.prototype._getLinkableObjects.call(this))},t.prototype._getLinkableDoors=function(){var t=this.elevatorDoors;return t=(t=t.concat(this.stairDoors)).concat(e.prototype._getLinkableDoors.call(this))},t.prototype._setupNavigationGraph=function(t,i){e.prototype._setupNavigationGraph.call(this,t,i);for(var r=this._getLinkableObjects(),n=0;n<r.length;n++)for(var o=r[n],a=o._getLinkableDoors(),s=0;s<a.length;s++){t[(l=a[s]).id]=t[l.id]||{},t[o.id]=t[o.id]||{},t[o.id][l.id]=t[l.id][o.id]=i}t[this.id]=t[this.id]||{};for(a=this._getLinkableDoors(),n=0;n<a.length;n++){var l,u=(l=a[n]).owner;u&&(t[l.id]=t[l.id]||{},t[u.id]=t[u.id]||{},t[this.id][l.id]=t[l.id][this.id]=i,t[u.id][l.id]=t[l.id][u.id]=i)}},t.prototype.onBeforeCapture=function(){var e=this.plan;if(e){var t=function(e){var t=e.material;t&&(ke.backupValue(t,"aoMap"),t.aoMap=null,t.needsUpdate=!0)};e.node.traverseAll((function(e){t(e)})),this.rooms.forEach((function(e){var i=e.plan;i&&i.node.traverseAll((function(e){t(e)}))}))}},t.prototype.onAfterCapture=function(){var e=this.plan;if(e){var t=function(e){var t=e.material;t&&(ke.revertValue(t,"aoMap"),t.needsUpdate=!0)};e.node.traverseAll((function(e){t(e)})),this.rooms.forEach((function(e){var i=e.plan;i&&i.node.traverseAll((function(e){t(e)}))}))}},t.prototype.showThings=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.things.visible=true/false' to replace '.showThings'"),this.things.visible=e},t.prototype.showDoors=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.things.visible=true/false' to replace '.showThings'"),this.doors.visible=e},t.prototype.hideMarker=function(){console.warn("[Floor] Please use '.showMarker(false)' to replace '.hideMarker'"),this.showMarker(!1)},t.prototype.setMarker=function(e){console.warn("[Floor] Please use '.showMarker(params)' to replace '.setMarker'"),this.showMarker(e)},t.prototype.showRoof=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.showAllRoofs()' to replace '.showRoof()'"),this.showAllRoofs(e)},t.prototype.showCeiling=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.showAllCeilings()' to replace '.showCeiling()'"),this.showAllCeilings(e)},o(t,[{key:"isFloor",get:function(){return!0}},{key:"isOutdoors",get:function(){var e=this.building;return!(!e||e.hasFacades())}},{key:"building",get:function(){return this.parents.query(".Building")[0]}},{key:"indexOfBuilding",get:function(){return this.indexOfParent(!0)}},{key:"levelNumber",get:function(){return this.indexOfParent(!0)+1}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"doors",get:function(){return this.query(".Door",!1)}},{key:"elevatorDoors",get:function(){return this.doors.query(".ElevatorDoor",!1)}},{key:"stairDoors",get:function(){return this.doors.query(".StairDoor",!1)}},{key:"stairs",get:function(){return this.query(".Stair",!1)}},{key:"rooms",get:function(){return this.query(".Room",!1)}},{key:"misc",get:function(){return this.miscObject||(this.miscObject=this.query(".CombinedObject").query("[userData/type=CombineMiscParent]")[0]),this.miscObject}},{key:"plan",get:function(){return this.floorObject||(this.floorObject=this.query(".CombinedObject").query("[userData/type=CombineFloorParent]")[0]),this.floorObject}},{key:"wall",get:function(){return this.wallObject||(this.wallObject=this.query(".CombinedObject").query("[userData/type=CombineWallParent]")[0]),this.wallObject}},{key:"roof",get:function(){return this.roofObject||(this.roofObject=this.query(".CombinedObject").query("[userData/type=CombineRoofParent]")[0]),this.roofObject}},{key:"ceiling",get:function(){return this.ceilingObject||(this.ceilingObject=this.query(".CombinedObject").query("[userData/type=CombineCeilingParent]")[0]),this.ceilingObject}},{key:"marker",get:function(){return this._marker}},{key:"height",get:function(){return this._height}},{key:"showObjectsInParentLevels",get:function(){return this._showObjectsInParentLevels}},{key:"isFloorPlan",get:function(){return console.warn("[Floor] Please use '.isFloor' to replace '.isFloorPlan'"),!0}},{key:"levelNum",get:function(){return console.warn("[Floor] Please use '.levelNumber' to replace '.levelNum'"),this.levelNumber}}]),t}(bt),pr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.name="Outdoors",r._floorNode=null,r}return a(t,e),t.prototype.destroy=function(){this._floorNode=null,e.prototype.destroy.call(this)},t.prototype.setupChildVisibleAsParent=function(){},t.prototype.setup=function(e){this.setupID(e),this.setupParent(e),this.parent.outdoors=this,this.setupUserData(e)},t.prototype.setPolygonOffset=function(e){var t=this._floorNode;t&&new bt(this.app)._init(t).style.setPolygonOffset(e)},o(t,[{key:"floorNode",set:function(e){this._floorNode=e},get:function(){return this._floorNode}},{key:"canNotQueryFromSelector",get:function(){return!0}},{key:"isOutdoors",get:function(){return!0}}]),t}(hr),dr=function(){function e(t){n(this,e),this.app=t,this._style=null,this._id="",this._name="",this._queryID=THING.Math.generateUUID(),this._userData={},this._angles=[0,0,0],this._events={},this._tags=[],this._groups=[],this._children=new ct(this.app)}return e.prototype.isGroup=function(){return!0},e.prototype.setup=function(e){this._id=e.id||"",this._name=e.name||"",this._tags=e.tags||[]},e.prototype.destroy=function(){this.app.objectManager.destroy(this);var e=this;this._children.forEach((function(t){var i=t.groups.indexOf(e);for(var r in-1!==i&&t.groups.splice(i,1),e._events){var n=e._events[r];for(var o in n)t.off(o)}}))},e.prototype.destroyAll=function(){this.destroy(),this._children.destroyAll()},e.prototype.hasAttribute=function(e){return ke.hasAttribute(this,e)},e.prototype.getAttribute=function(e){return ke.getAttribute(this,e)},e.prototype.setAttribute=function(e,t){return ke.setAttribute(this,e,t)},e.prototype.setAttributes=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(var i in e=e||{})(t||ke.isUndefined(this[i]))&&this.setAttribute(i,e[i])},e.prototype.add=function(e){var t=this;if(e instanceof ct)e.forEach((function(e){t.add(e)}));else for(var i in this._children.add(e),-1===e.groups.indexOf(this)&&e.groups.push(this),this._children.forEach((function(e){e.groups.sort((function(e,t){return t.children.length-e.children.length}))})),this._events){var r=this._events[i];for(var n in r){var o=r[n];this.on(i,o.selector,o.userData,o.callback,null,o.priority)}}},e.prototype.remove=function(e){var t=this;if(e instanceof ct)e.forEach((function(e){t.remove(e)}));else{this._children.remove(e);var i=e.groups.indexOf(this);for(var r in-1!==i&&e.groups.splice(i,1),this._events){var n=this._events[r];for(var o in n){var a=n[o];this.off(r,a.selector,a.tag)}}}},e.prototype._transform=function(e){var t=new THREE.Group;t.position.copy(ke.parseVector3(this.position)),this.app.scene.add(t),t.updateMatrixWorld();for(var i=[],r=0;r<this._children.length;r++){var n=this._children[r];i.push(n.node.parent),n.node.attachToParent(t,this.app.scene)}e(t),t.updateWorldMatrix(!1,!1);for(r=0;r<this._children.length;r++){(n=this._children[r]).node.attachToParent(i[r],this.app.scene),n.static&&n.node._synMatrixWorld()}this.app.scene.remove(t)},e.prototype.translate=function(e){this._transform((function(t){t.translateX(e[0]),t.translateY(e[1]),t.translateZ(e[2])}))},e.prototype.translateX=function(e){this.translate([e,0,0])},e.prototype.translateY=function(e){this.translate([0,e,0])},e.prototype.translateZ=function(e){this.translate([0,0,e])},e.prototype.query=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=new ct(this.app,this._children);return i.select(e),t&&this._children.forEach((function(t){i.add(t.query(e))})),i},e.prototype._parseEvent=function(e,t,i,r,n){var o=ke.parseEvent(e,t,i,r,n);o._callback=o.callback;var a=this;return o.callback=function(e){o._callback&&o._callback.call(a,e)},o.tag=o.tag||"",o.tag+="_"+this._queryID,o},e.prototype._updateEvents=function(e){this._events[e.eventType]=this._events[e.eventType]||[],this._events[e.eventType][e.tag]=e},e.prototype._removeEvents=function(e){var t=this._events[e.eventType];t&&delete t[e.tag]},e.prototype.on=function(e,t,i,r,n,o){var a=this._parseEvent(t,i,r,n,o);return a.eventType=e,this._updateEvents(a),this.children.on(e,a.selector,a.userData,a.callback,a.tag,a.priority),this},e.prototype.off=function(e,t,i){var r=this._parseEvent(t,null,i);return r.eventType=e,this._removeEvents(r),this.children.off(e,r.selector,r.tag),this},e.prototype.one=function(e,t,i,r,n,o){var a=this._parseEvent(t,i,r,n,o);return a.eventType=e,this._updateEvents(a),this.children.one(e,a.selector,a.userData,a.callback,a.tag,a.priority),this},e.prototype._getAvgVector3=function(e){if(!this._children.length)return[0,0,0];var t=new THREE.Vector3;return this._children.forEach((function(i){var r=ke.parseVector3(i[e]);t.add(r)})),t.divideScalar(this._children.length),t.toArray()},o(e,[{key:"type",get:function(){return"Group"}},{key:"style",get:function(){return this._children.style}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"queryID",set:function(e){this._queryID=e},get:function(){return this._queryID}},{key:"userData",set:function(e){this._userData=e},get:function(){return this._userData}},{key:"tags",set:function(e){this._tags=e},get:function(){return this._tags}},{key:"groups",get:function(){return this._groups}},{key:"position",set:function(e){var t=ke.parseVector3(e),i=this;this._transform((function(e){e._setWorldPosition(t,!1,i.app.root.static)}))},get:function(){return this._getAvgVector3("position")}},{key:"angles",set:function(e){var t=THING.Math.subVector(this._angles,e);this._angles=e;var i=ke.parseEuler(t);this._transform((function(e){e.quaternion.setFromEuler(i)}))},get:function(){return this._angles}},{key:"parents",get:function(){var e=new THING.Selector(this.app,[]);return this._children.forEach((function(t){e.add(t.parents)})),e}},{key:"children",get:function(){return this._children}},{key:"visible",set:function(e){this.children.visible=e}},{key:"pickable",set:function(e){this.children.pickable=e}},{key:"boundingBox",get:function(){for(var e=new THREE.Box3,t=0;t<this.children.length;t++){var i=this.children[t];e.union(i.box)}var r=new THREE.Vector3;e.getCenter(r);var n=new THREE.Vector3;e.getSize(n);var o=this;return{min:e.min.toArray(),max:e.max.toArray(),center:r.toArray(),size:n.toArray(),radius:n.length(),getWorldPosition:function(e){var t=ke.parseValue(e.yAngle,0),i=ke.parseValue(e.xAngle,0),r=ke.parseValue(e.distance||e.radius,n.length()),a=e.radiusFactor;a&&(r=n.length()*a);var s=(new THREE.Vector3).getDirectionFromAngles(t,i,r);return o.selfToWorld(s)}}}}]),e}(),fr=function(){function e(t,i){n(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.outdoors=this.app.outdoors,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.campus=null,this.baseURL=null,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.loadSpeed=.1,this.isCamFitScene=!0,i&&(i.position&&(this.campusPosition=i.position),i.rotation&&(this.campusRotation=i.rotation),void 0!==i.isCamFitScene&&null!==i.isCamFitScene&&(this.isCamFitScene=i.isCamFitScene),void 0!==i.isDelayLoadFloorPlan&&null!==i.isDelayLoadFloorPlan&&(this.isDelayLoadFloorPlan=i.isDelayLoadFloorPlan),i.campus&&(this.campus=i.campus))}return e.prototype.load=function(e){var t=this;return this.baseURL=e,this.scene.add(this.worldNode),new Promise((function(e,i){t.loadSceneJson().then((function(i){t.parseObjects().then((function(){e(t.campus)}))})).then((function(){e(t.campus)})).catch((function(e){i(e)}))}))},e.prototype.loadSceneJson=function(){var e=this;return new Promise((function(t,i){new THREE.FileLoader(e.app.loadingManager).load(e.baseURL+"/scene.json",(function(i){var r=JSON.parse(i);e.sceneJsonData=r,t(r)}),(function(e){}),(function(e){i("cant not load file: scene.json")}))}))},e.prototype.parseObjects=function(){var e=this.sceneJsonData,t=this;return new Promise((function(i,r){t.parse(e).then((function(){t.sliceRootNodeArray=[],i()})).catch((function(e){r(e)}))}))},e.prototype.parse=function(e){var t=this;return new Promise((function(i,r){t.parseWorld(e),i()}))},e.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.app.scene.add(this.campus.node)),this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),e.outdoors&&this.parseOutdoors(e.outdoors,t),e.buildings){var i=e.buildings;for(var r in i){var n=i[r],o=new THREE.Vector3(0,0,0),a=r,s=void 0;n.name&&(a=n.name),n.id&&(s=n.id);var l=new THREE.Object3D,u=this.app.objectManager.create({type:"Building",name:a,id:s,parent:this.campus,node:l});if(u.app=this.app,u.node.position.x=o.x,u.node.position.y=o.y,u.node.position.z=o.z,n.plans&&this.parseFloorPlans(n.plans,u),n.facades){var c=n.facades;for(var h in c)this.createThing(c[h],u,"Facade")}if(n.facadegroups){var p=n.facadegroups;for(var d in p)n=p[d],this.createGroup(n,u,"Facade")}if(n.groups){p=n.groups;for(var d in p){n=p[d];this.createGroup(n,u)}}}}},e.prototype.parseOutdoors=function(e){var t=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:t}),this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors),this.processFloorPlanData(e,this.outdoors)},e.prototype.processFloorPlanData=function(e,t){t.app=this.app,e.placements&&this.parseThings(e.placements,t),e.videoprobes&&this.parseThings(e.videoprobes,t),e.groups&&this.parseGroups(e.groups,t),e.doororwindows&&this.parseDoorWins(e.doororwindows,t),e.rooms&&this.parseRooms(e.rooms,t)},e.prototype.parseRooms=function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=null;r.name&&(n=r.name);var o=new THREE.Object3D("room_temp"),a=null,s=r.properties;if(s)for(var l in a={},s){var u=s[l];a[l]=u}var c=null,h=null,p=null,d={};if(r.area&&(h=r.area,d.area=h),r.circumference&&(p=r.circumference,d.circumference=p),r.center){var f=r.center;(c=new THREE.Vector3).set(f[0],f[1],-f[2]),d.center=c}this.app.objectManager.create({type:"Room",name:n,node:o,id:void 0,parent:t,properties:a,auxiliaryInfo:d})}},e.prototype.parseDoorWins=function(e,t){new THREE.Group("doors");for(var i in e){var r=e[i],n=i,o=void 0;r.name&&(n=r.name),r.id&&(o=r.id);var a=new THREE.Object3D("doororwin_temp"),s=null;if(r.properties){var l=r.properties;for(var u in s={},l){var c=l[u];s[u]=c}}this.app.objectManager.create({type:"Door",name:n,node:a,id:o,parent:t,properties:s})}},e.prototype.parseGroups=function(e,t){for(var i in e){var r=e[i];(r.name||r.properties)&&this.createGroup(r,t)}},e.prototype.createGroup=function(e,t){var i,r,n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Thing",a=new THREE.Object3D("group_temp");e.id&&(i=e.id),e.name&&(r=e.name);var s=e.properties;if(s)for(var l in n={},s){var u=s[l];n[l]=u}var c=this.app.objectManager.create({type:o,name:r,id:i,node:a,parent:t,properties:n});return c},e.prototype.parseFloorPlans=function(e,t){var i=[];for(var r in e){var n=e[r],o=n.id,a="";n.name&&(a=n.name);var s=new THREE.Object3D,l=this.app.objectManager.create({type:"Floor",name:a,id:o,node:s,parent:t});s.name="floorPlan",t.node.add(l.node),this.processFloorPlanData(n,l),i.push(l)}return i},e.prototype.parseThings=function(e,t,i){for(var r in e){var n=e[r];(n.name||n.properties)&&this.createThing(n,t,i)}},e.prototype.createThing=function(e,t,i){var r,n,o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&(r=e.id),e.name&&(n=e.name);var s=e.properties;if(s)for(var l in o={},s){var u=s[l];o[l]=u}var c=new THREE.Object3D("temp_cannotuse"),h=this.app.objectManager.create({type:a,name:n,node:c,id:r,parent:t,properties:o});return h},e}(),mr=function(){function e(t,i){n(this,e),this.app=t,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=i,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0;this.worldNode;if(i&&(i.position&&(this.campusPosition=i.position),i.rotation&&(this.campusRotation=i.rotation),void 0!==i.isCamFitScene&&null!==i.isCamFitScene&&(this.isCamFitScene=i.isCamFitScene),i.scale&&(this.campusScale=i.scale),void 0!==i.outdoorsVisible&&(this.outdoorsVisible=i.outdoorsVisible),void 0!==i.campusVisible&&(this.campusVisible=i.campusVisible),i.campus&&(this.campus=i.campus),void 0!==i.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=i.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),i&&i.default){var r=i.default;r.sceneJson&&(this.sceneJson="export.json"),r.wallTexture&&(this.defaultWallTextureUri=r.wallTexture),r.wallEdgeTexture&&(this.defaultWallEdgeTextureUri=r.wallEdgeTexture),r.floorTexture&&(this.defaultFloorTextureUri=r.floorTexture),r.ceilingTexture&&(this.defaultCeilingTextureUri=r.ceilingTexture),r.roofTexture&&(this.defaultRoofTextureUri=r.roofTexture)}this.app.options.loaderResourceUrl&&(this.resourceUrl=this.app.options.loaderResourceUrl),null!=this.app.options.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=this.app.options.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson&&this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary)}return e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.exportJsonString=function(e){for(var t=e.outdoors,i=e.buildings,r=[],n=[],o=0;o<t.things.length;o++){var a=t.things[o];r.push({id:a.id,name:a.name})}for(o=0;o<t.rooms.length;o++){var s=t.rooms[o];n.push({id:s.id,name:s.name})}var l=[];for(o=0;o<i.length;o++){for(var u=i[o],c=[],h=0;h<u.floors.length;h++){for(var p=u.floors[h],d=[],f=[],m=0;m<p.things.length;m++){var g=p.things[m];d.push({id:g.id,name:g.name})}for(m=0;m<p.rooms.length;m++){s=p.rooms[m];f.push({id:s.id,name:s.name})}c.push({id:p.id,name:p.name,placements:d,rooms:f})}l.push({id:u.id,name:u.name,plans:c})}return{id:e.id,name:e.name,outdoors:{id:t.id,name:t.name,placements:r,rooms:n},buildings:l}},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node)}return this.relativeResourceUrl&&(this.resourceUrl=this.sceneURL+this.relativeResourceUrl),new Promise((function(e,i){t.updateProgress(.1),t.loadSceneJson().then((function(i){t.sceneJson=JSON.parse(i),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.15);var r=new json2mesh.UBuilderSceneSimpleLoader;t.resourceUrl&&(r.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",r.resourceManager.baseModelUrl=t.resourceUrl+"/model/"),r.load({json:t.sceneJson,customModeBaseUrl:t.sceneURL+"/"}).then((function(i){t.parseWorld(i),t.updateProgress(.2),t.updateProgress(1),e(t.campus)}))}))}))},e.prototype.loadSceneJson=function(){var e=this;return new Promise((function(t,i){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/"+e.sceneJsonUri,(function(e){t(e)}))}))},e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.createTextureLoaderPromise=function(e){var t=this;return new Promise((function(i,r){(new THREE.TextureLoader).load(t.sceneURL+"/"+e,(function(e){i(e)}),(function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")}),(function(t){console.log(e+"load error")}))}))},e.prototype.loadDefaultTexture=function(){var e=this;return new Promise((function(t,i){var r=e.createTextureLoaderPromise(e.defaultWallTextureUri),n=e.createTextureLoaderPromise(e.defaultWallEdgeTextureUri),o=e.createTextureLoaderPromise(e.defaultFloorTextureUri),a=e.createTextureLoaderPromise(e.defaultRoofTextureUri),s=e.createTextureLoaderPromise(e.defaultCeilingTextureUri);Promise.all([r,n,o,a,s]).then((function(e){DefaultResource.wallTexture=e[0],DefaultResource.wallEdgeTexture=e[1],DefaultResource.floorTexture=e[2],DefaultResource.ceilinngTexture=e[3],DefaultResource.roofTexture=e[4],t()}))}))},e.prototype.parseWorld=function(e){null===this.campus?(this.campus=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Campus",name:"Campus",node:this.worldNode}),this.campus.visible=this.campusVisible,this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)):(this.campus.uuid=e.id,e.userID&&(this.campus.id=e.userID));for(var t=0;t<e.buildings.length;t++){var i=e.buildings[t];this.parseBuilding(i)}if(e.outdoors){var r=new THREE.Object3D("outdoors");r.name="plan",this.outdoors=this.app.objectManager.create({uuid:e.outdoors.id,id:e.outdoors.userID,type:"Outdoors",name:e.outdoors.name,parent:this.campus,node:r}),this.outdoors.visible=this.outdoorsVisible,this.parseFloorPlan(e.outdoors,this.outdoors)}},e.prototype.parseBuilding=function(e){var t=new THREE.Object3D("building");t.name="building";var i=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Building",name:e.name,parent:this.campus,node:t,properties:e.properties});i.localPosition=e.position;for(var r=e.floorplans,n=e.facades,o=e.facadeGroups,a=0;a<n.length;a++){var s=n[a];this.app.objectManager.create({type:"Facade",id:s.userID,name:s.name,uuid:s.id,node:s.delayObject,parent:i,properties:s.properties})}for(a=0;a<o.length;a++)s=o[a],this.app.objectManager.create({type:"Facade",uuid:s.id,id:s.userID,name:s.name,node:s.delayObject,parent:i,properties:s.properties});for(var l=0;l<r.length;l++){var u=r[l],c=new THREE.Object3D("floorplan");c.name="plan";var h=this.app.objectManager.create({id:u.userID,uuid:u.id,type:"Floor",name:u.name,properties:u.properties,node:c,parent:i});h.localPosition=u.position,this.parseFloorPlan(u,h),0!==i.facades.length&&(h.visible=!1)}},e.prototype.placementInitCallback=function(e){this.app.objectManager.create({id:e.id,name:e.name,node:e.mesh,parent:plan,animations:e.resource.animations,properties:e.properties})},e.prototype.parseOutdoors=function(e){},e.prototype.parseFloorPlan=function(e,t){for(var i=0;i<e.walls.length;i++)for(var r=e.walls[i],n=0;n<r.doorOrWindows.length;n++){var o=r.doorOrWindows[n],a="Door";if(o.jsonData&&o.jsonData.type&&(a=o.jsonData.type),o.mesh){var s=this.app.objectManager.create({type:"Door",uuid:o.id,id:o.userID,name:o.name,node:o.delayObject,parent:t,animations:o.resource.animations,properties:o.properties});if(o.isOpen&&s.open(),s.animationClips)for(n=0;n<s.animationClips.length;n++){var l=s.animationClips[n];if("_defaultAnim_"===l.name){s.playAnimation({name:l.name,loop:!0,speed:.15});break}}}else o.initCompleteCallback=function(e){e.jsonData&&e.jsonData.type&&e.jsonData.type;var i=b.app.objectManager.create({type:"Door",uuid:e.id,id:e.userID,name:e.name,node:e.mesh,parent:t,animations:e.resource.animations,properties:e.properties});if(t.miscNode.add(i.node),e.isOpen&&i.open(),i.animationClips)for(var r=0;r<i.animationClips.length;r++){var n=i.animationClips[r];if("_defaultAnim_"===n.name){i.playAnimation({name:n.name,loop:!0,speed:.15});break}}}}var u=new THREE.Object3D("combineFloor");for(i=0;i<e.combineFloors.length;i++){var c=e.combineFloors[i];u.add(c)}t.node.add(u),t.floorNode=u;var h=new THREE.Object3D("combineCeiling");for(i=0;i<e.combineCeilings.length;i++){var p=e.combineCeilings[i];h.add(p)}t.node.add(h),t.ceilingNode=h;var d=new THREE.Object3D("combineRoof");for(i=0;i<e.combineRoofs.length;i++){var f=e.combineRoofs[i];d.add(f)}t.node.add(d),t.roofNode=d;var m=new THREE.Object3D("combinePlacement");for(i=0;i<e.combinePlacements.length;i++){var g=e.combinePlacements[i];m.add(g)}t.node.add(m),t.miscNode=m;for(var v=new THREE.Object3D("combineWall"),y=0;y<e.combineStraightManualWalls.length;y++){r=e.combineStraightManualWalls[y];v.add(r)}for(y=0;y<e.combineModelWalls.length;y++){r=e.combineModelWalls[y];v.add(r)}for(y=0;y<e.combineDoorOrWins.length;y++){g=e.combineDoorOrWins[y];v.add(g)}t.node.add(v),t.wallNode=v;for(i=0;i<e.groups.length;i++){g=e.groups[i],a="Thing";g.jsonData&&g.jsonData.type&&(a=g.jsonData.type);s=this.app.objectManager.create({uuid:g.id,id:g.userID,name:g.name,node:g.delayObject,belongRoomUserID:g.belongRoomUserID,type:a,parent:t,properties:g.properties})}var b=this;for(i=0;i<e.placements.length;i++){g=e.placements[i],a="Thing";if(g.jsonData&&g.jsonData.type&&(a=g.jsonData.type),g.mesh){if((s=this.app.objectManager.create({uuid:g.id,id:g.userID,name:g.name,type:a,belongRoomUserID:g.belongRoomUserID,node:g.delayObject,parent:t,url:g.resource.getModelUrl(),animations:g.resource.animations,properties:g.properties})).bundleID=g.resource.modelID,s.bundleName=g.resource.modelName,g.isPlayAnim&&s.containAnimation(g.animClip)){var _={name:g.animClip,loop:!1,speed:.15};g.hasSkin&&(_.loop=!0),s.playAnimation(_)}}else g.initCompleteCallback=function(e){a="Thing",e.jsonData&&e.jsonData.type&&(a=e.jsonData.type);var i=b.app.objectManager.create({uuid:e.id,id:e.userID,belongRoomUserID:e.belongRoomUserID,name:e.name,node:e.mesh,parent:t,type:a,url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});if(i.bundleID=e.resource.modelID,i.bundleName=e.resource.modelName,t.miscNode.add(i.node),e.isPlayAnim&&i.containAnimation(e.animClip)){var r={name:e.animClip,loop:!1,speed:.15};e.hasSkin&&(r.loop=!0),i.playAnimation(r)}}}for(i=0;i<e.videoprobes.length;i++){if((g=e.videoprobes[i]).mesh)s=this.app.objectManager.create({id:g.userID,name:g.name,uuid:g.id,belongRoomUserID:g.belongRoomUserID,node:g.delayObject,parent:t,url:g.resource.getModelUrl(),animations:g.resource.animations,properties:g.properties});else g.initCompleteCallback=function(e){var i=b.app.objectManager.create({id:e.userID,name:e.name,uuid:e.id,belongRoomUserID:e.belongRoomUserID,node:e.mesh,parent:t,url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});t.miscNode.add(i.node)}}for(i=0;i<e.rooms.length;i++){var x=e.rooms[i];c=this.app.objectManager.create({type:"Room",name:x.name,node:x.mesh,uuid:x.id,id:x.userID,ceilingNode:x.ceiling.mesh,roofNode:x.roof.mesh,floorNode:x.floor.mesh,parent:t,properties:x.properties})}for(i=0;i<e.curvelines.length;i++){var E=e.curvelines[i];this.parseCurveLines(E,t)}for(i=0;i<e.pipelines.length;i++){E=e.pipelines[i];this.parsePipeLines(E,t)}},e.prototype.parsePipeLines=function(e,t){var i={type:"PolygonLine",name:e.name,points:e.points,id:e.userID,uuid:e.id,parent:t,style:{}};e.color&&(i.style.color="#"+e.color.getHexString());var r=this;if(e.resource)e.initCompleteCallback=function(t){i.image=t.resource.getTextureUrl();var n=r.app.objectManager.create(i);n.node.position.set(e.position.x,e.position.y,e.position.z),e.sectionType&&"Triangle"===e.sectionType&&(n.pathRadialSegments=3,n._updateByPoints()),e.radius&&(n.width=e.radius)};else{var n=r.app.objectManager.create(i);n.node.position.set(e.position.x,e.position.y,e.position.z),e.sectionType&&"Triangle"===e.sectionType&&(n.pathRadialSegments=3,n._updateByPoints()),e.radius&&(n.width=e.radius)}},e.prototype.parseCurveLines=function(e,t){var i={type:"RouteLine",parent:t,name:e.name,uuid:e.id,id:e.userID,points:e.points,arrowFlag:!1,style:{}},r=this;if(e.color&&(i.style.color="#"+e.color.getHexString()),e.resource)e.initCompleteCallback=function(t){if(t.resource.texture){var n=t.resource.texture.clone();n.rotation=Math.PI/2,i.image=n}var o=r.app.objectManager.create(i);null!==e.width&&(o.width=e.width),o.node.position.set(e.position.x,e.position.y,e.position.z)};else{var n=r.app.objectManager.create(i);null!==e.width&&(n.width=e.width),n.node.position.set(e.position.x,e.position.y,e.position.z)}},e}();var gr=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){!function(t){var i,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag",u=t.regeneratorRuntime;if(u)e.exports=u;else{(u=t.regeneratorRuntime=e.exports).wrap=b;var c="suspendedStart",h="suspendedYield",p="executing",d="completed",f={},m={};m[a]=function(){return this};var g=Object.getPrototypeOf,v=g&&g(g(D([])));v&&v!==r&&n.call(v,a)&&(m=v);var y=w.prototype=x.prototype=Object.create(m);E.prototype=y.constructor=w,w.constructor=E,w[l]=E.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(y),e},u.awrap=function(e){return{__await:e}},T(S.prototype),S.prototype[s]=function(){return this},u.AsyncIterator=S,u.async=function(e,t,i,r){var n=new S(b(e,t,i,r));return u.isGeneratorFunction(t)?n:n.next().then((function(e){return e.done?e.value:n.next()}))},T(y),y[l]="Generator",y[a]=function(){return this},y.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var r=t.pop();if(r in e)return i.value=r,i.done=!1,i}return i.done=!0,i}},u.values=D,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=i)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=i),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),C(i),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;C(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:D(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=i),f}}}function b(e,t,i,r){var n=t&&t.prototype instanceof x?t:x,o=Object.create(n.prototype),a=new R(r||[]);return o._invoke=function(e,t,i){var r=c;return function(n,o){if(r===p)throw new Error("Generator is already running");if(r===d){if("throw"===n)throw o;return P()}for(i.method=n,i.arg=o;;){var a=i.delegate;if(a){var s=A(a,i);if(s){if(s===f)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===c)throw r=d,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=p;var l=_(e,t,i);if("normal"===l.type){if(r=i.done?d:h,l.arg===f)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=d,i.method="throw",i.arg=l.arg)}}}(e,i,a),o}function _(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}function x(){}function E(){}function w(){}function T(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function S(e){var t;this._invoke=function(i,r){function o(){return new Promise((function(t,o){!function t(i,r,o,a){var s=_(e[i],e,r);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==typeof u&&n.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,o,a)}),(function(e){t("throw",e,o,a)})):Promise.resolve(u).then((function(e){l.value=e,o(l)}),a)}a(s.arg)}(i,r,t,o)}))}return t=t?t.then(o,o):o()}}function A(e,t){var r=e.iterator[t.method];if(r===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=i,A(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=_(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,f;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=i),t.delegate=null,f):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function M(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function D(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=i,t.done=!0,t};return o.next=o}}return{next:P}}function P(){return{value:i,done:!0}}}(function(){return this}()||Function("return this")())})),vr=function(){return this}()||Function("return this")(),yr=vr.regeneratorRuntime&&Object.getOwnPropertyNames(vr).indexOf("regeneratorRuntime")>=0,br=yr&&vr.regeneratorRuntime;vr.regeneratorRuntime=void 0;var _r=gr;if(yr)vr.regeneratorRuntime=br;else try{delete vr.regeneratorRuntime}catch(y){vr.regeneratorRuntime=void 0}var xr=_r,Er=function e(t,i,r,o){n(this,e),this.positionArray=t.geometry.getAttribute("position").array.slice();var a=t.geometry.getAttribute("normal");a?this.normalArray=a.array.slice():console.warn("not has normal");var s=t.geometry.getAttribute("uv");s&&(this.uvArray=s.array);var l=t.geometry.getAttribute("uv2");l&&(this.uv2Array=l.array);var u=t.geometry.getAttribute("color");u&&(this.colorArray=u.array),this.indexArray=t.geometry.index.array,this.material=t.material;for(var c=this.positionArray,h=this.normalArray,p=0;p<c.length;){for(var d=o.length-1;d>-1;d--){var f=i[d],m=r[d],g=o[d];c[p]*=f.x,c[p+1]*=f.y,c[p+2]*=f.z;var v=new THREE.Vector3(c[p],c[p+1],c[p+2]);if((v=v.applyQuaternion(m)).x+=g.x,v.y+=g.y,v.z+=g.z,c[p]=v.x,c[p+1]=v.y,c[p+2]=v.z,h){var y=new THREE.Vector3(h[p],h[p+1],h[p+2]);y=y.applyQuaternion(m),h[p]=y.x,h[p+1]=y.y,h[p+2]=y.z}}p+=3}this.vertexCount=this.positionArray.length/3,this.indexCount=this.indexArray.length},wr=function(){function e(t){n(this,e),this.bundeObj=t,this.materialMap=new Map,this.combineBundleMeshs=[]}return e.prototype.combine=function(){this._combine(this.bundeObj,[],[],[])},e.prototype._combine=function(e,t,i,r){if(t.push(e.scale),r.push(e.position),i.push(e.quaternion),e instanceof THREE.Mesh){var n=new Er(e,t,i,r);0!==n.vertexCount&&(this.combineBundleMeshs.push(n),void 0===this.materialMap.get(n.material)&&this.materialMap.set(n.material,[]),this.materialMap.get(n.material).push(n))}if(0!==e.children.length)for(var o=0;o<e.children.length;o++){var a=i.slice(),s=t.slice(),l=r.slice();this._combine(e.children[o],s,a,l)}},e}(),Tr=function e(){n(this,e),this.positions=[],this.scales=[],this.quaternions=[]},Sr=function(){function e(t){n(this,e),this.vertexCount=0,this.indexCount=0,this.material=t,this.bundeMeshs=[],this.transformations=[],this.maxCount=65534,this.combineMesh=null}return e.prototype.isExceed=function(e){return this.vertexCount+e>this.maxCount},e.prototype.add=function(e,t){if(this.isExceed(e.vertexCount))return console.error("combine exceed vertex count "),!1;this.vertexCount+=e.vertexCount,this.indexCount+=e.indexCount,this.bundeMeshs.push(e),this.transformations.push(t)},e.prototype.build=function(){for(var e=this.bundeMeshs,t=this.indexCount,i=this.vertexCount,r=new Float32Array(3*i),n=new Float32Array(3*i),o=new Float32Array(2*i),a=new Float32Array(4*i),s=new Float32Array(2*i),l=new Uint16Array(t),u=0,c=0,h=0,p=0,d=0,f=new THREE.BufferGeometry,m=0;m<e.length;m++){for(var g=e[m],v=this.transformations[m],y=v.positions,b=v.scales,_=v.quaternions,x=g.indexArray,E=0;E<x.length;E++)l[E+p]=u/3+x[E];p+=x.length;var w=g.positionArray;for(E=0;E<w.length;){for(var T=new THREE.Vector3(w[E],w[E+1],w[E+2]),S=y.length-1;S>-1;S--){var A=y[S],M=b[S],C=_[S];T.x*=M.x,T.y*=M.y,T.z*=M.z,(T=T.applyQuaternion(C)).x+=A.x,T.y+=A.y,T.z+=A.z}r[E+u]=T.x,r[E+u+1]=T.y,r[E+u+2]=T.z,E+=3}u+=w.length;var R=g.normalArray;for(E=0;E<R.length;){var D=new THREE.Vector3(R[E],R[E+1],R[E+2]);for(S=_.length-1;S>-1;S--){C=_[S];D=D.applyQuaternion(C)}n[E+c]=D.x,n[E+c+1]=D.y,n[E+c+2]=D.z,E+=3}c+=R.length;var P=g.uvArray;if(P)for(E=0;E<P.length;E++)o[E+h]=P[E];var j=g.uv2Array;if(j)for(E=0;E<j.length;E++)s[E+h]=j[E];P&&(h+=P.length);var F=g.colorArray;if(F){for(E=0;E<F.length;E++)a[E+d]=F[E];d+=F.length}}f.addAttribute("position",new THREE.BufferAttribute(r,3)),f.addAttribute("normal",new THREE.BufferAttribute(n,3)),f.addAttribute("uv",new THREE.BufferAttribute(o,2)),0!==s.length&&f.addAttribute("uv2",new THREE.BufferAttribute(s,2)),0!==a.length&&f.addAttribute("color",new THREE.BufferAttribute(a,4)),f.setIndex(new THREE.BufferAttribute(l,1));var O=new THREE.Mesh(f,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,O.name="combine",this.combineMesh=O},e}(),Ar=function(){function e(t){n(this,e),this.app=t,this.combineBundleObjectMap={},this.processorMap=new Map,this.floorMaterialMap=new Map,this.processors=[]}return e.prototype.combineModels=function(){var e=this.app.modelResource.models,t=[],i=this;for(var r in e)t.push(new Promise((function(t,n){var o=performance.now(),a=new wr(e[r].node);i.combineBundleObjectMap[r]=a,a.combine(),performance.now()-o>.1?setTimeout((function(){t()}),10):t()})));return Promise.all(t)},e.prototype.getModelObject=function(e){var t=this.combineBundleObjectMap[e];return t||null},e.prototype.addPlacement=function(e,t,i,r,n){var o=this.floorMaterialMap.get(e);o||(o=new Map,this.floorMaterialMap.set(e,o));var a=this.processorMap.get(e);a||(this.processorMap.set(e,[]),a=this.processorMap.get(e));var s=new Tr;s.positions=i,s.scales=r,s.quaternions=n,this.combineBundleObjectMap[t].materialMap.forEach((function(e,t,i){for(var r=e,n=t,l=0;l<r.length;l++){var u=r[l],c=o.get(n);c&&!c.isExceed(u.vertexCount)||(c=new Sr(n),o.set(n,c),a.push(c)),c.add(u,s)}}))},e.prototype.getCombineProcessors=function(e,t,i,r){var n=[],o=new Map;for(var a in e){var s=e[a];if(!s.uid&&!s.name){var l=this.app.modelResource.bundleIDArray[s.bIdx],u=(this.app.modelResource.get(l).node,new THREE.Vector3(0,0,0)),c=new Tr;if(s.pos){var h=s.pos.split(" ");u.x=parseFloat(h[0]),u.y=parseFloat(h[1]),u.z=-parseFloat(h[2])}var p=new THREE.Vector3(1,1,1);if(s.scl){var d=s.scl.split(" ");p.x=parseFloat(d[0]),p.y=parseFloat(d[1]),p.z=parseFloat(d[2])}var f=new THREE.Quaternion(0,0,0,1);if(s.rot){var m=s.rot.split(" ");f.x=parseFloat(m[0]),f.y=parseFloat(m[1]),f.z=-parseFloat(m[2]),f.w=-parseFloat(m[3])}var g=t.slice(),v=i.slice(),y=r.slice();y.push(f),v.push(p),g.push(u),c.positions=g,c.scales=v,c.quaternions=y,this.combineBundleObjectMap[l].materialMap.forEach((function(e,t,i){for(var r=e,a=t,s=0;s<r.length;s++){var l=r[s],u=o.get(a);u&&!u.isExceed(l.vertexCount)||(u=new Sr(a),o.set(a,u),n.push(u)),u.add(l,c)}}))}}return n},e}(),Mr=function(){function e(t){n(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.app.scene.add(this.worldNode),this.baseURL=t.sceneURL,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.combineManager=new Ar(this.app),this.combineProcessorMap=new Map,this.loadSpeed=.1}return e.prototype.load=function(){var e=this;return new Promise((function(t,i){e.loadSceneJson().then((function(t){return t.camInfo&&(e.parseCamInfo(t.camInfo),e.app.camera.update()),e.sceneJsonData=t,e.loadStructureJson()})).then((function(t){var i=e.getSortedStructureGLTFs(t);return new Promise((function(t,r){e.loadStructure(i,(function(){e.parseObjects().then((function(){t(e.worldNode)}))}))}))})).then((function(){t(e.worldNode)})).catch((function(e){i(e)}))}))},e.prototype.loadSceneJson=function(){var e=this;return new Promise((function(t,i){(new THREE.FileLoader).load(e.baseURL+"/scene.json",(function(e){var i=JSON.parse(e);t(i)}),(function(e){}),(function(e){i("cant not load file: scene.json")}))}))},e.prototype.loadStructureJson=function(){var e=this;return new Promise((function(t,i){(new THREE.FileLoader).load(e.baseURL+"/structure.json",(function(e){var i=JSON.parse(e);t(i)}),(function(){}),(function(e){i("cant not load file: structure.json")}))}))},e.prototype.loadStructure=function(e,t,i){this.splitLoadedGLTFCount=0;var r=this,n=0;if(0==e.length)t&&t();else for(var o=r.curLoadGLTFIndex;o<e.length&&(0==n||n%10!=0);o++){n++,r.curLoadGLTFIndex++;var a=new THREE.GLTFLoader(r.app.loadingManager);a.setCrossOrigin("anonymous"),a.load(r.baseURL+"/"+e[o].path,(function(n){var o=n.scene.children[0].children[0];r.nodes[o.name]=o,r.sliceRootNodeArray.push(o),o.traverse((function(e){r.nodes[e.name]=e})),r.splitLoadedGLTFCount++,r.allLoadedGLTFCount++,10===r.splitLoadedGLTFCount&&r.loadStructure(e,t,i),r.app.scene.add(o),r.allLoadedGLTFCount==e.length&&t&&t()}),(function(){}),(function(t){i&&i("load "+r.baseURL+"/"+e[o].path+" failed")}))}},e.prototype.parseObjects=function(){var e=this.sceneJsonData,t=this;return e.bIdList?new Promise((function(i,r){t.parseBundleList(e.bIdList).then((function(){return t.parse(e)})).then((function(){t.sliceRootNodeArray=[],i()})).catch((function(e){r(e)}))})):new Promise((function(i,r){t.parse(e).then((function(){t.sliceRootNodeArray=[],i()})).catch((function(e){r(e)}))}))},e.prototype.getSortedStructureGLTFs=function(e){var t=[],i=[],r=[],n=e.outdoors,o=e.buildings;for(var a in n){var s=n[a];t.push(s)}for(var l=0;l<t.length;l++){var u=t[l];if(0!=i.length)for(var c=0;c<i.length;c++){var h=i[c];if(u.size<h.size){i.splice(c,0,u);break}if(c==i.length-1){i.push(u);break}}else i.push(t[l])}for(var a in t=[],o)t.push(o[a]);for(l=0;l<t.length;l++){u=t[l];if(0!=r.length)for(c=0;c<r.length;c++){h=r[c];if(u.size<h.size){r.splice(c,0,u);break}if(c==r.length-1){r.push(u);break}}else r.push(t[l])}return i.concat(r)},e.prototype._nestingLoopYield=function(e,t,i){var r=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done;o instanceof Promise?o.then((function(n){return r._nestingLoopYield(e,t,i)})).catch((function(e){i(e)})):this._nestingLoopYield(e,t,i)},e.prototype.parse=function(e){var t=this;return this.combineManager.combineModels().then((function(){return new Promise((function(i,r){if(e.objects){var n=e.objects,o=null;for(var a in n){o=n[a];break}t._nestingLoopYield(t.parseWorld(o),(function(){i()}))}if(e.camInfo){var s=e.camInfo;t.parseCamInfo(s)}}))}))},e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){var t=xr.mark(v),i=this.worldNode;if(e.plan&&this.parseOutdoors(e.plan,i),e.bds){var r=e.bds;for(var n in r){var o=r[n],a=new THREE.Vector3(0,0,0);if(o.pos){var s=o.pos.split(" ");a.x=parseFloat(s[0]),a.y=parseFloat(s[1]),a.z=-parseFloat(s[2])}var l=new THREE.Object3D,u=this.app.objectManager.create({type:"Building",name:n,node:l});if(u.name=n,u.app=this.app,u.id=n,i.add(l),o.plans)this.parseFloorPlans(o.plans,u);if(o.facades){var c=o.facades;for(var h in c){var p=this.createThing(c[h],u,null,"Facade"),d=p.node.position;d.x+=a.x,d.y+=a.y,d.z+=a.z,p.node.position.set(d.x,d.y,d.z)}}if(o.groups){var f=o.groups;for(var m in f){o=f[m];this.createGroup(o,u)}}}}var g=this;function v(e){var i,r,n,o,a,s,l,u,c;return xr.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=g.loadSpeed,r=10,n=e.keys(),o=Array.isArray(n),a=0,n=o?n:n[Symbol.iterator]();case 3:if(!o){t.next=9;break}if(!(a>=n.length)){t.next=6;break}return t.abrupt("break",24);case 6:s=n[a++],t.next=13;break;case 9:if(!(a=n.next()).done){t.next=12;break}return t.abrupt("break",24);case 12:s=a.value;case 13:l=s,u=e.get(l),c=0;case 16:if(!(c<u.length)){t.next=22;break}return t.next=19,new Promise((function(e,t){var n=performance.now();u[c].build();var o=u[c].combineMesh;l.node.add(o),performance.now()-n>i?setTimeout((function(){e()}),r):e()}));case 19:c++,t.next=16;break;case 22:t.next=3;break;case 24:case"end":return t.stop()}}),t,this)}return v(this.combineProcessorMap)},e.prototype.parseOutdoors=function(e,t){var i,r;for(var n in e){r=e[n],i=n;break}var o=this.app.outdoors;this.worldNode.add(o.node),this.processFloorPlanData(i,r,o)},e.prototype.processFloorPlanData=function(e,t,i){i.name=e,i.app=this.app,i.id=e;var r=new THREE.Vector3(0,0,0);if(t.pos){var n=t.pos.split(" ");r.x=parseFloat(n[0]),r.y=parseFloat(n[1]),r.z=-parseFloat(n[2])}var o=t.cwalls;if(o){var a=new THREE.Group;for(var s in a.name="combinewall",o){var l=o[s].gltfid,u=this.nodes[l];u&&a.add(u)}i.node.add(a),a.updateMatrixWorld(),i.wallNode=a}var c=t.croofs;if(c){var h=new THREE.Group;for(var s in h.name="combineroof",c){l=c[s].gltfid;var p=this.nodes[l];p&&h.add(p)}i.node.add(h),i.roofNode=h}var d=t.cceilings;if(d){var f=new THREE.Group;for(var s in f.name="combineceiling",d){l=d[s].gltfid;var m=this.nodes[l];m&&f.add(m)}i.node.add(f),i.ceilNode=f}if(v=t.cfloors){var g=new THREE.Group;for(var s in g.name="combinefloor",v){var v;if(l=(v=v[s]).gltfid){var y=this.nodes[l];y&&g.add(y)}}i.node.add(g),i.floorNode=g}var b=new THREE.Group;b.name="combinePlacement",i.miscNode=b,i.node.add(b);var _=t.cplcs;if(_)for(var s in _){l=_[s].gltfid;var x=this.nodes[l];x&&(b.add(x),x.updateMatrixWorld())}if(t.plcs){var E=this.combineManager.getCombineProcessors(t.plcs,[r],[new THREE.Vector3(1,1,1)],[new THREE.Quaternion(0,0,0,1)]);this.combineProcessorMap.set(i,E),this.parseThings(t.plcs,i,r)}t.routes&&this.parseStructureThing(t.routes,i),t.pipelines&&this.parseStructureThing(t.pipelines,i),t.curvelines&&this.parseStructureThing(t.curvelines,i),t.arrowlines&&this.parseStructureThing(t.arrowlines,i),t.arrowdatalines&&this.parseStructureThing(t.arrowdatalines,i),t.leakwaterlines&&this.parseStructureThing(t.leakwaterlines,i),t.vps&&this.parseThings(t.vps,i,r),t.groups&&this.parseGroups(t.groups,i,[new THREE.Vector3(1,1,1)],[new THREE.Quaternion(0,0,0,1)],[r],r),t.dws&&this.parseDoorWins(t.dws,i,r)},e.prototype.parseDoorWins=function(e,t,i){for(var r in e){var n=e[r],o=r;n.uid&&(o=n.uid);var a=null;if(n.gltfid){var s=n.gltfid;this.nodes[s]&&((a=this.nodes[s]).position.x+=i.x,a.position.y+=i.y,a.position.z+=i.z,t.node.add(a))}var l=null;if(n.prop){var u=n.prop;for(var c in l={},u){var h=u[c];l[c]=h}}this.app.objectManager.create({type:"Door",name:o,node:a,parent:t,properties:l})}},e.prototype.parseGroups=function(e,t,i,r,n,o){for(var a in e){var s=e[a];s.uid?this.createGroup(s,t):this.combineGroup(s,t,i,r,n,o)}},e.prototype.createGroup=function(e,t){var i,r,n=this.instanceGroup(e);e.id&&e.id,e.uid&&(i=e.uid);var o=e.prop;if(o)for(var a in r={},o){var s=o[a];r[a]=s}return this.app.objectManager.create({type:"Thing",name:i,node:n,parent:t,properties:r})},e.prototype.parseFloorPlans=function(e,t){var i=[];for(var r in e){var n=e[r],o=new THREE.Object3D,a=this.app.objectManager.create({type:"Floor",name:r,node:o,parent:t});a.id=r,o.name="floorPlan",t.node.add(a.node),this.processFloorPlanData(r,n,a),a._parent=t,i.push(a)}return i},e.prototype.parseBundleList=function(e){this.app.modelResource.bundleIDArray=e;var t=0,i=this;return new Promise((function(r,n){0!=e.length?e.forEach((function(o){var a=new THREE.GLTFLoader(i.app.loadingManager);a.setCrossOrigin("anonymous"),a.load(i.baseURL+"/"+o+"/scene.gltf",(function(n){t++,i.app.modelResource.set(o,n.scene.children[0].children[0]),t==e.length&&r()}),(function(){}),(function(e){n("can not load "+i.baseURL+"/"+o+"/scene.gltf")}))})):r()}))},e.prototype.combineGroup=function(e,t,i,r,n,o){var a=e,s=new THREE.Vector3(0,0,0);if(a.pos){var l=a.pos.split(" ");s.x=parseFloat(l[0]),s.y=parseFloat(l[1]),s.z=-parseFloat(l[2])}var u=new THREE.Vector3(1,1,1);if(a.scl){var c=a.scl.split(" ");u.x=parseFloat(c[0]),u.y=parseFloat(c[1]),u.z=parseFloat(c[2])}var h,p,d,f=new THREE.Quaternion(0,0,0,1);if(a.rot){c=a.rot.split(" ");f.x=parseFloat(c[0]),f.y=parseFloat(c[1]),f.z=-parseFloat(c[2]),f.w=-parseFloat(c[3])}if(n?(h=i.slice(),d=r.slice(),p=n.slice()):(h=[],p=[],d=[]),h.push(u),p.push(s),d.push(f),a.plcs){var m=this.combineManager.getCombineProcessors(a.plcs,p,h,d),g=this.combineProcessorMap.get(t);g&&(m=g.concat(m)),this.combineProcessorMap.set(t,m)}if(a.groups)for(var v in a.groups)this.combineGroup(a.groups[v],t,h,d,p,o)},e.prototype.instanceGroup=function(e){var t=new THREE.Vector3(0,0,0);if(e.pos){var i=e.pos.split(" ");t.x=parseFloat(i[0]),t.y=parseFloat(i[1]),t.z=-parseFloat(i[2])}var r=new THREE.Vector3(1,1,1);if(e.scl){var n=e.scl.split(" ");r.x=parseFloat(n[0]),r.y=parseFloat(n[1]),r.z=parseFloat(n[2])}var o=new THREE.Quaternion(0,0,0,1);if(e.rot){n=e.rot.split(" ");o.x=parseFloat(n[0]),o.y=parseFloat(n[1]),o.z=-parseFloat(n[2]),o.w=-parseFloat(n[3])}var a=new THREE.Group;if(e.plcs)for(var s in e.plcs){var l=this.instanceChildOfGroup(e.plcs[s]);a.add(l)}if(e.groups)for(var s in e.groups){l=this.instanceGroup(e.plcs[s]);a.add(l)}return a.scale.copy(r),a.setRotationFromQuaternion(o),a.position.copy(t),a},e.prototype.instanceChildOfGroup=function(e){var t=this.app.modelResource.bundleIDArray[e.bIdx],i=this.app.modelResource.get(t).node.clone();if(e.pos){var r=e.pos.split(" ");i.position.x=parseFloat(r[0]),i.position.y=parseFloat(r[1]),i.position.z=-parseFloat(r[2])}if(e.rot){r=e.rot.split(" ");var n=new THREE.Quaternion;n.x=parseFloat(r[0]),n.y=parseFloat(r[1]),n.z=-parseFloat(r[2]),n.w=-parseFloat(r[3]),i.setRotationFromQuaternion(n)}return i},e.prototype.parseThings=function(e,t,i){for(var r in e){var n=e[r];(n.uid||n.prop)&&this.createThing(n,t,i)}},e.prototype.createThing=function(e,t,i){var r,n,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&e.id,e.uid&&(r=e.uid);var a=e.prop;if(a)for(var s in n={},a){var l=a[s];n[s]=l}var u=this.app.modelResource.bundleIDArray[e.bIdx],c=this.app.modelResource.get(u).node,h=c.clone();if(e.pos){var p=e.pos.split(" "),d=new THREE.Vector3(parseFloat(p[0]),parseFloat(p[1]),-parseFloat(p[2]));i&&(d.x+=i.x,d.y+=i.y,d.z+=i.z),h.position.x=d.x,h.position.y=d.y,h.position.z=d.z}if(e.rot){p=e.rot.split(" ");var f=new THREE.Quaternion;f.x=parseFloat(p[0]),f.y=parseFloat(p[1]),f.z=-parseFloat(p[2]),f.w=-parseFloat(p[3]),h.setRotationFromQuaternion(f)}if(e.scl){p=e.scl.split(" ");var m=new THREE.Vector3;m.x=parseFloat(p[0]),m.y=parseFloat(p[1]),m.z=-parseFloat(p[2]),h.scale.x=m.x,h.scale.y=m.y,h.scale.z=m.z}var g=this.app.objectManager.create({type:o,name:r,node:h,parent:t,properties:n});return g},e.prototype.parseStructureThing=function(e,t,i){for(var r in e){var n=e[r];if(n.gltfid){var o=new Bt(this.app);o.name=r,o.app=this.app,n.id&&(o.id=n.id),n.uid&&(o.name=n.uid);var a=n.gltfid;if(this.nodes[a]){var s=this.nodes[a];o.node=s,t.add(o),i&&(s.position.x=i.x,s.position.y=i.y,s.position.z=i.z)}}}},e}(),Cr=function(){function e(t,i){n(this,e),this.app=t,this.nodes=[],this.outdoors=this.app.outdoors,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.worldNode.name="world",this.campus=null,this.baseURL=null,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.combineManager=new Ar(this.app),this.loadSpeed=.1,this.isCamFitScene=!0,this.loadStageWeight=[.1,.1,.3,.5],this.loadedProgress=0,this.curStageLoadProgress=0,this.isDelayLoadFloorPlan=!1,this.envMap=null,this.appFirstTimeLoad=!1,this.outdoors?this.appFirstTimeLoad=!1:this.appFirstTimeLoad=!0,i&&(i.position&&(this.campusPosition=i.position),i.rotation&&(this.campusRotation=i.rotation),void 0!==i.isCamFitScene&&null!==i.isCamFitScene&&(this.isCamFitScene=i.isCamFitScene),void 0!==i.isDelayLoadFloorPlan&&null!==i.isDelayLoadFloorPlan&&(this.isDelayLoadFloorPlan=i.isDelayLoadFloorPlan),i.campus&&(this.campus=i.campus));var r=this.worldNode;null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:r}),this.app.scene.add(this.campus.node)),this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.scene=this.campus.node}return e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.loadSkybox=function(){if(this.sceneJsonData.skybox){for(var e=this.sceneJsonData.skybox,t=0;t<e.length;t++){var i=e[t];i=this.baseURL+i,e[t]=i}var r=this;return new Promise((function(t,i){(new THREE.CubeTextureLoader).load(e,(function(e){e.flipY=!0,r.envMap=e,t()}),null,(function(){console.warn("load skybox fail"),t()}))}))}return new Promise((function(e,t){e()}))},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.baseURL=e;else if("Object"===e.constructor.name){var i=e;this.baseURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node)}return new Promise((function(e,i){t.loadSceneJson().then((function(e){return e.camInfo&&t.isCamFitScene&&t.parseCamInfo(e.camInfo),t.sceneJsonData=e,t.updateProgress(.1),t.loadSkybox().then((function(){return t.loadStructureJson()}))})).then((function(e){t.updateProgress(.2);var i=t.getSortedStructureGLTFs(e);return new Promise((function(e,r){t.updateProgress(.3),t.loadStructure(i,(function(){t.updateProgress(.7),t.parseObjects().then((function(){t.updateProgress(.8),e(t.campus)}))}))}))})).then((function(){t.updateProgress(1),e(t.campus)})).catch((function(e){i(e)}))}))},e.prototype.loadSceneJson=function(){var e=this;return new Promise((function(t,i){(new THREE.FileLoader).load(e.baseURL+"/scene.json",(function(e){var i=JSON.parse(e);t(i)}),(function(e){}),(function(e){i("cant not load file: scene.json")}))}))},e.prototype.loadStructureJson=function(){var e=this;return new Promise((function(t,i){(new THREE.FileLoader).load(e.baseURL+"/structure.json",(function(e){var i=JSON.parse(e);t(i)}),(function(){}),(function(e){i("cant not load file: structure.json")}))}))},e.prototype.addEnvMap=function(e){var t=this;this.envMap&&e.traverse((function(e){e.material&&(e.material.opacity<1&&!e.material.transparent&&(e.material.transparent=!0,e.material.needsUpdate=!0),e.material.transparent&&(e.material.metalness=1,e.material.roughness=0,e.material.envMap=t.envMap,e.material.envMapIntensity=2,e.material.refractionRatio=1,e.material.needsUpdate=!0),e.material.isMeshStandardMaterial&&(e.material.envMap=t.envMap,e.material.envMapIntensity=1,e.material.refractionRatio=1,e.material.needsUpdate=!0))}))},e.prototype.loadStructure=function(e,t,i){this.splitLoadedGLTFCount=0;var r=this,n=0;if(0==e.length)t&&t();else for(var o=r.curLoadGLTFIndex;o<e.length&&(0==n||n%10!=0);o++){n++,r.curLoadGLTFIndex++;var a=new thingjs.GLTFLoader;a.setCrossOrigin("anonymous");var s=e[o];a.load(r.baseURL+"/"+s.path,(function(n){var o=n.scene.children[0].children[0];r.nodes[o.name]=o,r.sliceRootNodeArray.push(o),o.traverse((function(e){r.nodes[e.name]=e})),r.splitLoadedGLTFCount++,r.allLoadedGLTFCount++,10===r.splitLoadedGLTFCount&&r.loadStructure(e,t,i),(void 0===s.show||s.show)&&r.scene.add(o),r.addEnvMap(o),o.updateMatrixWorld(),r.scene.updateMatrixWorld(!0),r.allLoadedGLTFCount==e.length&&t&&t()}),(function(){}),(function(t){i?i("load "+r.baseURL+"/"+e[o].path+" failed"):console.error("load "+r.baseURL+"/"+s.path+" failed"),console.error(t)}))}},e.prototype.parseObjects=function(){var e=this.sceneJsonData,t=this;return e.models?new Promise((function(i,r){t.parseBundleList(e.models).then((function(){return t.parse(e)})).then((function(){t.sliceRootNodeArray=[],i()})).catch((function(e){r(e)}))})):new Promise((function(i,r){t.parse(e).then((function(){t.sliceRootNodeArray=[],i()})).catch((function(e){r(e)}))}))},e.prototype.getSortedStructureGLTFs=function(e){var t=[],i=[],r=[],n=e.outdoors,o=e.buildings;for(var a in n){var s=n[a];t.push(s)}for(var l=0;l<t.length;l++){var u=t[l];if(0!=i.length)for(var c=0;c<i.length;c++){var h=i[c];if(u.size<h.size){i.splice(c,0,u);break}if(c==i.length-1){i.push(u);break}}else i.push(t[l])}for(var a in t=[],o)t.push(o[a]);for(l=0;l<t.length;l++){u=t[l];if(0!=r.length)for(c=0;c<r.length;c++){h=r[c];if(u.size<h.size){r.splice(c,0,u);break}if(c==r.length-1){r.push(u);break}}else r.push(t[l])}return i.concat(r)},e.prototype._nestingLoopYield=function(e,t,i){var r=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done;o instanceof Promise?o.then((function(n){return r._nestingLoopYield(e,t,i)})).catch((function(e){i(e)})):this._nestingLoopYield(e,t,i)},e.prototype.parse=function(e){var t=this;return this.combineManager.combineModels().then((function(){return new Promise((function(i,r){var n=t.parseWorld(e);if(n?t._nestingLoopYield(n,(function(){i()}),(function(e){r(e)})):i(),e.camInfo&&t.isCamFitScene){var o=e.camInfo;t.parseCamInfo(o)}}))}))},e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){var t=xr.mark(x);if(e.outdoors&&this.parseOutdoors(e.outdoors),e.buildings){var i=e.buildings;for(var r in i){var n=i[r],o=new THREE.Vector3(0,0,0),a=r,s=void 0;n.id&&(s=n.id),n.name&&(a=n.name);var l=n.properties,u=null;if(l)for(var c in u={},l){var h=l[c];u[c]=h}if(n.position){var p=n.position;o.x=p[0],o.y=p[1],o.z=-p[2]}var d=new THREE.Object3D,f=this.app.objectManager.create({type:"Building",name:a,id:s,properties:u,parent:this.campus,node:d});if(f.app=this.app,f.node.position.x=o.x,f.node.position.y=o.y,f.node.position.z=o.z,n.facades){var m=n.facades;for(var g in m)this.createThing(m[g],f,null,"Facade")}if(n.facadegroups){var v=n.facadegroups;for(var y in v){var b=v[y];this.createGroup(b,f,"Facade")}}if(n.plans)this.parseFloorPlans(n.plans,f)}}var _=this;function x(e){var i,r,n,o,a,s,l,u,c;return xr.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=_.loadSpeed,r=10,n=e.keys(),o=Array.isArray(n),a=0,n=o?n:n[Symbol.iterator]();case 3:if(!o){t.next=9;break}if(!(a>=n.length)){t.next=6;break}return t.abrupt("break",24);case 6:s=n[a++],t.next=13;break;case 9:if(!(a=n.next()).done){t.next=12;break}return t.abrupt("break",24);case 12:s=a.value;case 13:l=s,u=e.get(l),c=0;case 16:if(!(c<u.length)){t.next=22;break}return t.next=19,new Promise((function(e,t){var n=performance.now();u[c].build();var o=u[c].combineMesh;l.miscNode.add(o),performance.now()-n>i?setTimeout((function(){e()}),r):e()}));case 19:c++,t.next=16;break;case 22:t.next=3;break;case 24:case"end":return t.stop()}}),t,this)}if(this.isDelayLoadFloorPlan){var E=new Map,w=this.combineManager.processorMap.get(this.outdoors);w&&E.set(this.outdoors,w);var T=this.combineManager.processorMap.keys(),S=Array.isArray(T),A=0;for(T=S?T:T[Symbol.iterator]();;){var M;if(S){if(A>=T.length)break;M=T[A++]}else{if((A=T.next()).done)break;M=A.value}var C=M;C!=this.outdoors&&(C.isLoaded=!1)}return x(E)}return x(this.combineManager.processorMap)},e.prototype.parseOutdoors=function(e){var t=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:t}),this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors),this.processFloorPlanData(e,this.outdoors)},e.prototype.processFloorPlanData=function(e,t){t.app=this.app;var i=new THREE.Vector3(0,0,0);if(e.position){var r=e.position;i.x=r[0],i.y=r[1],i.z=-r[2]}t.node.position.x=i.x,t.node.position.y=i.y,t.node.position.z=i.z,t.node.updateMatrixWorld(),t.node.updateMatrix(),this.parseStructure(e,t),e.placements&&(this.parseCombineProcessors(t,e.placements,[],[],[]),this.parseThings(e.placements,t,i)),e.videoprobes&&this.parseThings(e.videoprobes,t,i),e.groups&&this.parseGroups(e.groups,t,[],[],[],i),e.doororwindows&&this.parseDoorWins(e.doororwindows,t,i),e.rooms&&this.parseRooms(e.rooms,t),e.routes&&this.parseStructureThing(e.routes,t),e.pipelines&&this.parseStructureThing(e.pipelines,t),e.curvelines&&this.parseStructureThing(e.curvelines,t),e.arrowlines&&this.parseStructureThing(e.arrowlines,t),e.arrowdatalines&&this.parseStructureThing(e.arrowdatalines,t),e.leakwaterlines&&this.parseStructureThing(e.leakwaterlines,t)},e.prototype.parseRooms=function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=null;r.name&&(n=r.name),e.id&&e.id;var o=null,a=r.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=r.properties;if(l)for(var u in s={},l){var c=l[u];s[u]=c}var h=null,p=null,d=null;r.floor&&(a=r.floor.gltfid,this.nodes[a]&&(d=this.nodes[a])),r.ceiling&&(a=r.ceiling.gltfid,this.nodes[a]&&(h=this.nodes[a])),r.roof&&(a=r.roof.gltfid,this.nodes[a]&&(p=this.nodes[a]));var f=r.isShown;if(f){var m="false"!==(f=f.toLowerCase());o.visible=m}var g=null,v=null,y=null,b={};if(r.area&&(v=r.area,b.area=v),r.circumference&&(y=r.circumference,b.circumference=y),r.center){var _=r.center;(g=new THREE.Vector3).set(_[0],_[1],-_[2]),b.center=g}this.app.objectManager.create({type:"Room",name:n,node:o,ceilingNode:h,roofNode:p,floorNode:d,parent:t,properties:s,auxiliaryInfo:b})}},e.prototype.parseCombineProcessors=function(e,t,i,r,n){for(var o in t){var a=t[o];if(!a.name&&!a.properties){var s=this.app.modelResource.bundleIDArray[a.model].uri;s||(s=this.app.modelResource.bundleIDArray[a.model].id);var l=new THREE.Vector3(0,0,0);if(a.position){var u=a.position;l.x=u[0],l.y=u[1],l.z=-u[2]}var c=new THREE.Vector3(1,1,1);if(a.scale){var h=a.scale;c.x=h[0],c.y=h[1],c.z=h[2]}var p=new THREE.Quaternion(0,0,0,1);if(a.rotation){var d=a.rotation;p.x=d[0],p.y=d[1],p.z=-d[2],p.w=-d[3]}var f=i.slice(),m=r.slice(),g=n.slice();g.push(p),m.push(c),f.push(l),this.combineManager.addPlacement(e,s,f,m,g)}}},e.prototype.parseStructure=function(e,t){t.node.updateMatrixWorld();var i=t.node.position,r=new THREE.Vector3;t.parent&&!t.isOutdoors&&(r=t.parent.node.position);var n=new THREE.Vector3(r.x+i.x,r.y+i.y,r.z+i.z);if(e.structure){var o=(e=e.structure).walls;if(o){var a=new THREE.Group;for(var s in a.name="structurnWall",o){var l=o[s].gltfid,u=this.nodes[l];u.traverse((function(e){e.material&&(e.material.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <aomap_fragment>",["#ifdef USE_AOMAP","float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 3.0;","#if defined( USE_ENVMAP ) && defined( PHYSICAL )","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );","#endif","#endif"].join("\n"))},e.material.needsUpdate=!0)})),u&&a.add(u)}t.node.add(a),a.position.set(-n.x,-n.y,-n.z),t.wallNode=a}var c=e.roofs;if(c){var h=new THREE.Group;for(var s in h.name="structurnRoof",c){l=c[s].gltfid;var p=this.nodes[l];p&&h.add(p)}t.node.add(h),h.position.set(-n.x,-n.y,-n.z),t.roofNode=h}var d=e.ceilings;if(d){var f=new THREE.Group;for(var s in f.name="structureCeiling",d){l=d[s].gltfid;var m=this.nodes[l];m&&f.add(m)}t.node.add(f),f.position.set(-n.x,-n.y,-n.z),t.ceilNode=f}if(v=e.floors){var g=new THREE.Group;for(var s in g.name="structureFloor",v){var v;if(l=(v=v[s]).gltfid){var y=this.nodes[l];y.traverse((function(e){e.material&&(e.material.roughness=.9,e.material.needsUpdate=!0)})),y&&g.add(y)}}t.node.add(g),g.position.set(-n.x,-n.y,-n.z),t.floorNode=g}var b=new THREE.Group;b.name="structurePlacement",t.miscNode=b,t.node.add(b),t.floorNode||(t.floorNode=b),b.updateMatrixWorld(),b.updateMatrix(),b.position.set(0,0,0);var _=e.placements;if(_)for(var s in _){l=_[s].gltfid;var x=this.nodes[l];x&&b.add(x)}e.routes&&this.parseStructureThing(e.routes,t),e.pipelines&&this.parseStructureThing(e.pipelines,t),e.curvelines&&this.parseStructureThing(e.curvelines,t),e.arrowlines&&this.parseStructureThing(e.arrowlines,t),e.arrowdatalines&&this.parseStructureThing(e.arrowdatalines,t),e.leakwaterlines&&this.parseStructureThing(e.leakwaterlines,t)}},e.prototype.parseDoorWins=function(e,t,i){new THREE.Group("doors");for(var r in e){var n=e[r],o=r;n.name&&(o=n.name);var a=null;if(n.gltfid){var s=n.gltfid;this.nodes[s]&&(a=this.nodes[s],t.node.add(a))}var l=null;if(n.properties){var u=n.properties;for(var c in l={},u){var h=u[c];l[c]=h}}this.app.objectManager.create({type:"Door",name:o,node:a,parent:t,properties:l})}},e.prototype.parseGroups=function(e,t,i,r,n,o){for(var a in e){var s=e[a];s.name||s.properties?this.createGroup(s,t):this.combineGroup(s,t,i,r,n,o)}},e.prototype.createGroup=function(e,t){var i,r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Thing",o=this.instanceGroup(e);e.id&&e.id,e.name&&(i=e.name);var a=e.properties;if(a)for(var s in r={},a){var l=a[s];r[s]=l}var u=this.app.objectManager.create({type:n,name:i,node:o,parent:t,properties:r});return u},e.prototype.parseFloorPlans=function(e,t){for(var i=[],r=0;r<e.length;r++){var n=e[r],o=n.id,a="";n.name&&(a=n.name);var s=new THREE.Object3D,l=this.app.objectManager.create({type:"Floor",name:a,id:o,node:s,parent:t});s.name="floorPlan",0!=t.facades.length&&(l.node.visible=!1),t.node.add(l.node),t.node.updateMatrixWorld(),t.node.updateMatrix(),this.processFloorPlanData(n,l),i.push(l)}return i},e.prototype.parseBundleList=function(e){this.app.modelResource.bundleIDArray=e;var t=0,i=this;return new Promise((function(r,n){0!==e.length?e.forEach((function(o){if(u=o.uri){var a=new thingjs.GLTFLoader;a.setCrossOrigin("anonymous"),a.load(i.baseURL+"/"+u,(function(n){t++;var o=null;-1!==n.asset.generator.indexOf("Unity")?(o=n.scene.children[0].children[0],i.app.modelResource.set(u,o,n.animations)):(o=n.scene.children[0],i.app.modelResource.set(u,o,n.animations)),i.addEnvMap(o),t===e.length&&r()}),(function(){}),(function(e){n("can not load "+i.baseURL+"/"+u)}))}else{var s=o.id,l=o.version,u="http://model.3dmomoda.cn/models/"+s+"/"+l+"/gltf/",c=new THREE.FileLoader;c.setResponseType("json"),c.load(u+"index.json",(function(o){var a=o.gltfFiles[0],l=new thingjs.GLTFLoader;l.setCrossOrigin("anonymous"),l.load(u+a,(function(n){t++,i.app.modelResource.set(s,n.scene.children[0],n.animations),t===e.length&&r()}),(function(){}),(function(e){n("can not load "+i.baseURL+"/"+u)}))}))}})):r()}))},e.prototype.combineGroup=function(e,t,i,r,n,o){var a=e,s=new THREE.Vector3(0,0,0);if(a.position){var l=a.position;s.x=l[0],s.y=l[1],s.z=-l[2]}var u=new THREE.Vector3(1,1,1);if(a.scale){var c=a.scale;u.x=c[0],u.y=c[1],u.z=c[2]}var h,p=new THREE.Quaternion(0,0,0,1);if(a.rotation){var c=a.rotation;p.x=c[0],p.y=c[1],p.z=-c[2],p.w=-c[3]}if(n?(h=i.slice(),c=r.slice(),l=n.slice()):(h=[],l=[],c=[]),h.push(u),l.push(s),c.push(p),a.placements&&this.parseCombineProcessors(t,a.placements,l,h,c),a.groups)for(var d in a.groups)this.combineGroup(a.groups[d],t,h,c,l,o)},e.prototype.instanceGroup=function(e){var t=new THREE.Vector3(0,0,0);if(e.position){var i=e.position;t.x=i[0],t.y=i[1],t.z=-i[2]}var r=new THREE.Vector3(1,1,1);if(e.scale){var n=e.scale;r.x=n[0],r.y=n[1],r.z=n[2]}var o=new THREE.Quaternion(0,0,0,1);if(e.rotation){n=e.rotation;o.x=n[0],o.y=n[1],o.z=-n[2],o.w=-n[3]}var a=new THREE.Group;if(e.placements)for(var s in e.placements){var l=this.instanceChildOfGroup(e.placements[s]);a.add(l)}if(e.groups)for(var s in e.groups){l=this.instanceGroup(e.groups[s]);a.add(l)}return a.scale.copy(r),a.setRotationFromQuaternion(o),a.position.copy(t),a},e.prototype.instanceChildOfGroup=function(e){var t=this.app.modelResource.bundleIDArray[e.model].uri;t||(t=this.app.modelResource.bundleIDArray[e.model].id);var i=this.app.modelResource.get(t).node.clone();if(e.scale){var r=e.scale;i.scale.x=r[0],i.scale.y=r[1],i.scale.z=r[2]}if(e.rotation){r=e.rotation;var n=new THREE.Quaternion;n.x=r[0],n.y=r[1],n.z=-r[2],n.w=-r[3],i.setRotationFromQuaternion(n)}if(e.position){r=e.position;i.position.x=r[0],i.position.y=r[1],i.position.z=-r[2]}return i},e.prototype.parseThings=function(e,t,i){for(var r in e){var n=e[r];(n.name||n.properties||n.type)&&this.createThing(n,t,i)}},e.prototype.createThing=function(e,t,i){var r,n,o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&(r=e.id);var s=e.type||a;e.name&&(n=e.name);var l=e.properties;if(l)for(var u in o={},l){var c=l[u];o[u]=c}var h=this.app.modelResource.bundleIDArray[e.model].uri;h||(h=this.app.modelResource.bundleIDArray[e.model].id);var p=this.app.modelResource.get(h).node,d=p.clone(),f=this.app.modelResource.get(h).animations;if(e.position){var m=e.position,g=new THREE.Vector3(m[0],m[1],-m[2]);d.position.x=g.x,d.position.y=g.y,d.position.z=g.z}if(e.rotation){var v=e.rotation,y=new THREE.Quaternion;y.x=v[0],y.y=v[1],y.z=-v[2],y.w=-v[3],d.setRotationFromQuaternion(y)}if(e.scale){var b=e.scale,_=new THREE.Vector3;_.x=b[0],_.y=b[1],_.z=b[2],d.scale.x=_.x,d.scale.y=_.y,d.scale.z=_.z}var x=e.isShown;if(x){var E="false"!==(x=x.toLowerCase());d.visible=E}var w=this.app.objectManager.create({type:s,id:r,name:n,node:d,parent:t,animations:f,properties:o});return w},e.prototype.parseStructureThing=function(e,t,i){for(var r in e){var n=e[r];if(n.gltfid){var o=new Bt(this.app);o.name=r,o.app=this.app,n.id&&(o.id=n.id),n.name&&(o.name=n.name);var a=n.gltfid;if(this.nodes[a]){var s=this.nodes[a];t.node.add(s),o.node=s,t.add(o),i&&(s.position.x=i.x,s.position.y=i.y,s.position.z=i.z)}}}},e.prototype.delayLoadFloorPlan=function(e){var t=xr.mark(r),i=this;function r(r){var n,o,a;return xr.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=i.loadSpeed,o=10,a=0;case 3:if(!(a<r.length)){t.next=9;break}return t.next=6,new Promise((function(t,i){var s=performance.now();r[a].build();var l=r[a].combineMesh;e.miscNode.add(l),performance.now()-s>n?setTimeout((function(){t()}),o):t()}));case 6:a++,t.next=3;break;case 9:case"end":return t.stop()}}),t,this)}var n=null,o=null;return e.isLoaded||(n=this.combineManager.processorMap.get(e),o=r(n)),new Promise((function(t,r){o?i._nestingLoopYield(o,(function(){e.isLoaded=!0,t()}),(function(e){r(e)})):e.isLoaded?console.warn("floorplan "+e.id+" has been loaded!"):r()}))},e}(),Rr=function(e){function t(i,r){return n(this,t),s(this,e.call(this,i,r))}return a(t,e),t.prototype.parseDoorWins=function(e,t,i){new THREE.Group("doors");for(var r in e){var n=e[r];n.type||(n.type="Door"),this.createThing(n,t,i)}},t}(Cr),Dr=function(){function e(t){n(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.rootNode=null,this.campus=null,this.sceneURL=null,this.sceneJsonData=null,this.loadedSceneGLTF=null,this.worldNode=new THREE.Object3D,this.fitCamInfo=null}return e.prototype.parse=function(e){for(var t in e)if("objects"==t){var i=e.objects;for(var r in i){var n=i[r];this.parseWorld(n);break}}else if("camInfo"==t){var o=e[t];this.fitCamInfo=o}else console.log("unkown other parser: "+t)},e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.campus.node.name="campus",this.app.scene.add(this.campus.node)),e.plan&&this.parseOutdoors(e.plan),e.bds){var i=e.bds;this.parseBuildings(i)}},e.prototype.parseOutdoors=function(e){var t=null;for(var i in e){t=e[i];break}var r=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:r});var n=this.outdoors,o=t.gltfid;if(o&&this.nodes[o]){var a=this.nodes[o];THREE.SceneUtils.detach(a,a.parent,this.app.scene),THREE.SceneUtils.attach(a,this.app.scene,n.node),n.node.updateMatrixWorld()}this.parseFloorPlan(t,n)},e.prototype.parseBuildings=function(e){for(var t in e){var i=e[t],r=null;if(i.gltfid){var n=i.gltfid;this.nodes[n]&&(r=this.nodes[n])}var o=this.app.objectManager.create({type:"Building",name:t,parent:this.campus,node:r});i.plans&&this.parseFloorPlans(i.plans,o),i.facades&&this.parseFacades(i.facades,o)}},e.prototype.parseFloorPlans=function(e,t){for(var i in e){var r=null,n=e[i],o=n.gltfid;o&&this.nodes[o]&&(r=this.nodes[o]);var a=this.app.objectManager.create({type:"Floor",name:i,node:r,parent:t});this.parseFloorPlan(n,a)}},e.prototype.parseFloorPlan=function(e,t){e.plcs&&this.parseThings(e.plcs,t),e.vps&&this.parseThings(e.vps,t),e.dws&&this.parseDoorWins(e.dws,t),e.routes&&this.parseThings(e.routes,t),e.pipelines&&this.parseThings(e.pipelines,t),e.curvelines&&this.parseThings(e.curvelines,t),e.arrowlines&&this.parseThings(e.arrowlines,t),e.arrowdatalines&&this.parseThings(e.arrowdatalines,t),e.leakwaterlines&&this.parseThings(e.leakwaterlines,t);var i=e.cplcs;if(i)for(var r in i){var n=i[r].gltfid,o=this.nodes[n];if(o){t.miscNode=o.parent;break}}var a=e.cwalls;if(a)for(var r in a){n=a[r].gltfid;var s=this.nodes[n];if(s){t.wallNode=s.parent;break}}var l=e.croofs;if(l)for(var r in l){n=l[r].gltfid;var u=this.nodes[n];if(u){t.roofNode=u.parent;break}}var c=e.cceilings;if(c)for(var r in c){n=c[r].gltfid;var h=this.nodes[n];if(h){t.ceilingNode=h.parent;break}}if(p=e.cfloors)for(var r in p){var p;if(n=(p=p[r]).gltfid){var d=this.nodes[n];if(d){t.floorNode=d.parent;break}}}var f=e.groups;f&&this.parseGroup(f,t)},e.prototype.parseGroup=function(e,t){for(var i in e){var r=e[i],n=i;r.uid&&(n=r.uid);var o=r.type||"Thing",a=null,s=r.gltfid;s&&this.nodes[s]&&(a=this.nodes[s]);var l=null,u=r.prop;if(u)for(var c in l={},u){var h=u[c];l[c]=h}this.app.objectManager.create({type:o,name:n,node:a,parent:t,properties:l}),r.plcs&&this.parseThings(r.plcs,t)}},e.prototype.parseFacades=function(e,t){for(var i in e){var r=e[i],n=i;r.uid&&(n=r.uid);var o=null,a=r.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=r.prop;if(l)for(var u in s={},l){var c=l[u];s[u]=c}var h=r.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Facade",name:n,node:o,parent:t,properties:s});t.node.add(o)}},e.prototype.parseThings=function(e,t){for(var i in e){var r=e[i],n=i;r.uid&&(n=r.uid);var o=null,a=r.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=r.prop;if(l)for(var u in s={},l){var c=l[u];s[u]=c}var h=r.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Thing",name:n,node:o,parent:t,properties:s})}},e.prototype.parseDoorWins=function(e,t){for(var i in e){var r=e[i],n=i;r.uid&&(n=r.uid);var o=null;if(r.gltfid){var a=r.gltfid;this.nodes[a]&&(o=this.nodes[a])}var s=null;if(r.prop){var l=r.prop;for(var u in s={},l){var c=l[u];s[u]=c}}this.app.objectManager.create({type:"Door",name:n,node:o,parent:t,properties:s})}},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node)}return new Promise((function(e,i){t.loadGLTF().then((function(e){return t.loadedSceneGLTF=e,e.scene.traverse((function(e){t.nodes[e.name]=e})),t.parseSceneJson()})).then((function(i){t.fitCamInfo?t.parseCamInfo(t.fitCamInfo):t.campus.node&&t.app.camera.fit(t.campus),e(t.campus)})).catch((function(){t.campus.node.add(t.loadedSceneGLTF.scene.children[0]),t.campus&&t.app.camera.fit(t.campus),e(t.campus)}))}))},e.prototype.loadGLTF=function(){var e=this;return new Promise((function(t,i){var r=new THREE.GLTFLoader(e.app.loadingManager);r.setCrossOrigin("anonymous"),r.load(e.sceneURL+"/Unity2GLTF.gltf",(function(e){t(e)}))}))},e.prototype.parseSceneJson=function(){var e=this;return new Promise((function(t,i){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/scene.json",(function(i){var r=JSON.parse(i);for(var n in e.sceneJsonData=r,r)if("objects"==n){var o=r.objects;for(var a in o){var s=o[a];e.parseWorld(s);break}}else if("camInfo"==n){var l=r[n];e.fitCamInfo=l}else console.log("unkown other parser: "+n);t(r)}),(function(){}),(function(){console.error("not find file scene.json "),i()}))}))},e}(),Pr=function(){function e(){n(this,e),this.world=null,this.styleTable={outdoors:{},buildings:{}}}return e.prototype.parseWorld=function(e){this.world=e;for(var t=0;t<e.buildings.length;t++){var i=e.buildings[t];this.parseBuilding(i)}e.outdoors&&this.parseFloorPlan(e.outdoors)},e.prototype.parseBuilding=function(e){this.parseFacades(e);for(var t=e.floorplans,i=0;i<t.length;i++){var r=t[i];this.parseFloorPlan(r)}},e.prototype.parseFacades=function(e){for(var t=e.facades,i=e.facadeGroups,r=0;r<t.length;r++){t[r].registerBuildCallbackListener(this.facadeBuildCallback,{loader:this})}for(var n=0;n<i.length;n++){i[n].registerBuildCallbackListener(this.facadeBuildCallback,{loader:this})}},e.prototype.facadeBuildCallback=function(e,t){var i=t.loader,r=void 0,n=e.properties;n&&(r=n._styleTag_);var o=i.getMeshes(e.mesh);o&&o.length>0&&o.forEach((function(e){e._sfStyle=r||"Facade"}))},e.prototype.parseFloorPlan=function(e){this.parseDoorOrWindows(e),this.parseCombineFloors(e),this.parseCombineCeilings(e),this.parseCombineRoofs(e),this.parseCombinePlacements(e),this.parseCombineStraightManualWalls(e),this.parseCombineModelWalls(e),this.parseCombineDoorOrWindows(e),this.parseGroups(e),this.parsePlacements(e),this.parseRooms(e),this.parseVideoProbes(e),this.parsePlacementGround(e),this.parseCombinePlacementWalls(e)},e.prototype.parsePlacementGround=function(e){for(var t=0;t<e.placementGrounds.length;t++){e.placementGrounds[t].registerBuildCallbackListener(this.placementBuildCallback,{loader:this})}},e.prototype.parseCombineFloors=function(e){for(var t=0;t<e.combineFloorObjects.length;t++){var i=e.combineFloorObjects[t];this.registerCombineObjectBuildCallback(i,"CombineFloor")}},e.prototype.parseCombineCeilings=function(e){for(var t=0;t<e.combineCeilingObjects.length;t++){var i=e.combineCeilingObjects[t];this.registerCombineObjectBuildCallback(i,"CombineCeiling")}},e.prototype.parseCombineRoofs=function(e){for(var t=0;t<e.combineRoofObjects.length;t++){var i=e.combineRoofObjects[t];this.registerCombineObjectBuildCallback(i,"CombineRoof")}},e.prototype.parseCombinePlacements=function(e){for(var t=0;t<e.combinePlacementObjects.length;t++){var i=e.combinePlacementObjects[t];this.registerCombineObjectBuildCallback(i,"CombinePlacement")}},e.prototype.parseCombineStraightManualWalls=function(e){for(var t=0;t<e.combineStraightManualWallObjects.length;t++){var i=e.combineStraightManualWallObjects[t];this.registerCombineObjectBuildCallback(i,"CombineStraightManualWall")}},e.prototype.parseCombineModelWalls=function(e){for(var t=0;t<e.combineModelWallObjects.length;t++){var i=e.combineModelWallObjects[t];this.registerCombineObjectBuildCallback(i,"CombineModelWall")}},e.prototype.parseCombinePlacementWalls=function(e){for(var t=0;t<e.combinePlacementWallObjects.length;t++){var i=e.combinePlacementWallObjects[t];this.registerCombineObjectBuildCallback(i,"CombinePlacementWall")}},e.prototype.parseCombineDoorOrWindows=function(e){for(var t=0;t<e.combineDoorOrWindowObjects.length;t++){var i=e.combineDoorOrWindowObjects[t];this.registerCombineObjectBuildCallback(i,"CombineDoorOrWindow")}},e.prototype.parsePlacements=function(e){for(var t=0;t<e.placements.length;t++){e.placements[t].registerBuildCallbackListener(this.placementBuildCallback,{loader:this})}},e.prototype.placementBuildCallback=function(e,t){var i=t.loader;i.addSfStyle(e,i.isTree(e.resource.modelID)?"Thing-树":"Thing")},e.prototype.parseDoorOrWindows=function(e){for(var t=0;t<e.doorOrWindows.length;t++){e.doorOrWindows[t].registerBuildCallbackListener(this.doorOrWindowBuildCallback,{loader:this})}},e.prototype.doorOrWindowBuildCallback=function(e,t){var i=t.loader;e.isWindow?i.addSfStyle(e,"Thing"):i.addSfStyle(e,e.parent instanceof json2mesh.Outdoors?"Door-outdoor":"Door")},e.prototype.parseGroups=function(e){for(var t=0;t<e.groups.length;t++){e.groups[t].registerBuildCallbackListener(this.groupBuildCallback,{loader:this})}},e.prototype.groupBuildCallback=function(e,t){t.loader.groupAddSfStyle(e)},e.prototype.parseRooms=function(e){for(var t=0;t<e.rooms.length;t++){e.rooms[t].registerBuildCallbackListener(this.roomBuildCallback,{loader:this})}},e.prototype.roomBuildCallback=function(e,t){var i=t.loader;"Outdoors"===e.parent.type?i.addSfStyle(e.floor,"Region"):(i.addSfStyle(e.ceiling,"Floor--ceiling"),i.addSfStyle(e.roof,"Floor--roof"),i.addSfStyle(e.floor,"Floor--floor"))},e.prototype.parseVideoProbes=function(e){for(var t=0;t<e.videoprobes.length;t++){e.videoprobes[t].registerBuildCallbackListener(this.videoProbeBuildCallback,{loader:this})}},e.prototype.videoProbeBuildCallback=function(e,t){t.loader.addSfStyle(e,"Thing")},e.prototype.registerCombineObjectBuildCallback=function(e,t){e.registerBuildCallbackListener(this.combinedObjectBuildCallback,{loader:this,typeName:t})},e.prototype.combinedObjectBuildCallback=function(e,t){var i=e,r=t.typeName,n=t.loader;if("CombineFloor"===r)n.addSfStyle(i,e.parent instanceof json2mesh.Outdoors?"Region":"Floor--floor");else if("CombineCeiling"===r)n.addSfStyle(i,"Floor--ceiling");else if("CombineRoof"===r)n.addSfStyle(i,"Floor--roof");else if("CombinePlacement"===r){var o=e.resource.modelID;n.addSfStyle(i,n.isTree(o)?"Thing-树":"Thing")}else"CombineStraightManualWall"===r?n.addSfStyle(i,e.parent instanceof json2mesh.Outdoors?"Fence":"Floor--manualWall"):"CombineModelWall"===r?n.addSfStyle(i,e.parent instanceof json2mesh.Outdoors?"Fence":"Floor--manualWall"):"CombineDoorOrWindow"===r?n.addSfStyle(i,e.parent instanceof json2mesh.Outdoors?"Door-outdoor":"Door"):"CombinePlacementWall"===r&&n.addSfStyle(i,e.parent instanceof json2mesh.Outdoors?"Fence":"Floor--manualWall")},e.prototype.addSfStyle=function(e,t){if(e){var i=e.properties;if(i&&i._styleTag_&&(t=i._styleTag_),t){var r=this.getMeshes(e.mesh);r&&r.length>0&&r.forEach((function(e){e._sfStyle=t}))}}},e.prototype.getMeshes=function(e){var t=[];return e.traverse((function(e){e.isMesh&&t.push(e)})),t},e.prototype.groupAddSfStyle=function(e){var t=e.placements;if(t)for(var i=0;i<t.length;i++){var r=t[i];this.addSfStyle(r,this.isTree(r.resource.modelID)?"Thing-树":"Thing")}var n=e.groups;if(n)for(var o=0;o<n.length;o++){var a=n[o];this.groupAddSfStyle(a)}},e.prototype.isTree=function(e){return!!jr[e]},e.isTree_static=function(e){return!!jr[e]},e}(),jr={"3629A959F80C4D0EA31D1E26524735B8":{title:"柳树",id:"3629A959F80C4D0EA31D1E26524735B8",type:"Placement",size:[8.1,9.60776,8.7],version:"7"},BB23ED379CFB4A0AB14BD124EC2995BE:{title:"植物E",id:"BB23ED379CFB4A0AB14BD124EC2995BE",type:"Placement",size:[.64347,1.34912,.8],version:"7"},A7D96546FA744C38A949DFC6FEE43B6A:{title:"植物D",id:"A7D96546FA744C38A949DFC6FEE43B6A",type:"Placement",size:[.6,1.1,.6],version:"7"},FA5766D2AA074128ABB5D4CA3FF45B36:{title:"植物C",id:"FA5766D2AA074128ABB5D4CA3FF45B36",type:"Placement",size:[.4,.61599,.39999],version:"6"},"8EC4FF7178E64C538B215D69684E4F92":{title:"植物A",id:"8EC4FF7178E64C538B215D69684E4F92",type:"Placement",size:[.4,.5,.4],version:"6"},"449c02c5e8f84a2aa32f58ed53aa24b9":{title:"花花草草",id:"449c02c5e8f84a2aa32f58ed53aa24b9",type:"Placement",size:[.23118,.5986,.24155],version:"1"},c26acc8a9f804d8da2f49aba46283ac3:{title:"清风拂动的大树",id:"c26acc8a9f804d8da2f49aba46283ac3",type:"Placement",size:[7.85544,7.80654,7.44832],version:"2"},"07b2d180e1ea42de98723fe147f6750a":{title:"树_02",id:"07b2d180e1ea42de98723fe147f6750a",type:"Placement",size:[10.3207,9.84333,10.0598],version:"3"},"2c969242db5f4da58442182ccbda7471":{title:"树木_03",id:"2c969242db5f4da58442182ccbda7471",type:"Placement",size:[7.20139,25.1363,6.56474],version:"4"},D26DB25C34C94CAABF24FED40F1A9719:{title:"雪松",id:"D26DB25C34C94CAABF24FED40F1A9719",type:"Placement",size:[8.24071,19.2,7.6],version:"6"},"ebafecf0-cc89-42dc-b847-0f841a31bdca":{title:"棕榈树",id:"ebafecf0-cc89-42dc-b847-0f841a31bdca",type:"Placement",size:[4.94077,5.83847,4.78861],version:"9"},"4EF86FC4FFA44013AC4F45E8CD0D343F":{title:"枫树",id:"4EF86FC4FFA44013AC4F45E8CD0D343F",type:"Placement",size:[5.66699,7.4,6.233],version:"6"},"9C27FD900C4443FBA1151C9DF767D19A":{title:"樱花树",id:"9C27FD900C4443FBA1151C9DF767D19A",type:"Placement",size:[7.50716,8.2,7.87936],version:"6"},"6b768c2d-3c2f-4954-a625-ef4b57f72a47":{title:"秋季树",id:"6b768c2d-3c2f-4954-a625-ef4b57f72a47",type:"Placement",size:[6.32989,7.49752,5.72546],version:"8"},"9fc66d5b-a213-4fc6-9fc6-f759aa88716a":{title:"wxz松树03",id:"9fc66d5b-a213-4fc6-9fc6-f759aa88716a",type:"Placement",size:[4.5,9.4,4.4],version:"4"},"963de658-70b6-49e7-bb0e-504ad603fe27":{title:"wxz竹子01",id:"963de658-70b6-49e7-bb0e-504ad603fe27",type:"Placement",size:[1.4073,4.03187,1.37224],version:"5"},"d5b06cf7-2a31-4252-8d7c-02d48815ed18":{title:"乔树02",id:"d5b06cf7-2a31-4252-8d7c-02d48815ed18",type:"Placement",size:[7.3,7.4,6.1],version:"4"},"f9058709-ee84-41f6-8260-fbb734dc9483":{title:"棕榈树01",id:"f9058709-ee84-41f6-8260-fbb734dc9483",type:"Placement",size:[4.3,7.2,4],version:"4"},"be7d0bfc-ce60-4132-8a88-afd1301c82b3":{title:"圣诞树01",id:"be7d0bfc-ce60-4132-8a88-afd1301c82b3",type:"Placement",size:[4.41539,7.57112,4.49063],version:"5"},"95bd04fe237f42e0adeabb78028c8ee7":{title:"超级圣诞树",id:"95bd04fe237f42e0adeabb78028c8ee7",type:"Placement",size:[4.41539,7.57112,4.49063],version:"1"}},Fr=function(){function e(t){n(this,e),t.config&&(this.config=t.config),this.events=[],t.events&&(this.events=t.events),this.app=t.app}return e.prototype.setConfig=function(e){this.config=e},e.prototype.createTjsObject=function(e,t){return new(this.config.getClass(e.type))({json2meshObject:e,app:this.app,thingjsParent:t,events:this.events,config:this.config}).create()},e.prototype.createTjsFacadeObject=function(e,t){return new(this.config.getClass("Facade"))({json2meshObject:e,json2meshBuilding:e,app:this.app,thingjsParent:t,events:this.events,config:this.config}).create()},e}(),Or=function(){function e(t){n(this,e),this.json2meshObject=t.json2meshObject,this.app=t.app,this.thingjsParent=t.thingjsParent,this.createType=null,this.thingjsObject=null,this.config=t.config,this._createdCallbacks=[],this._createdCallbackParams=[],this._buildedCallbacks=[],this._buildedCallbackParams=[],t.events&&this.initEvents(t.events)}return e.prototype.initEvents=function(e){for(var t=0;t<e.length;t++){e[t].init(this)}},e.prototype.create=function(){var e=this._getCreateParams();return this.thingjsObject=this.config.getCreatedThingjsObject(this.json2meshObject.id),this.thingjsObject?this._initCreatedThingjsObjectParams(e):this.thingjsObject=this.app.objectManager.create(e),this.thingjsObject.localPosition=this._getThingjsLocalPosition(),this.thingjsObject.scale=this.json2meshObject.scale.toArray(),this.thingjsObject.node.quaternion.copy(this.json2meshObject.rotation),this.json2meshObject.registerBuildCallbackListener(this._callback,{creator:this,uuid:this.thingjsObject.uuid}),this.json2meshObject.camInfo&&(this.thingjsObject.userData.camInfo=this.json2meshObject.camInfo),this._notifyCreatedCompleteListeners(),this._registerChangeTypeEvent(),this.thingjsObject},e.prototype._registerChangeTypeEvent=function(){var e=this;this.thingjsObject.one("classtypechange",(function(t){e._changeTypeCallback(t)}))},e.prototype._changeTypeCallback=function(e){this.thingjsObject=e.newObject},e.prototype._getThingjsLocalPosition=function(){return this.json2meshObject.position.toArray()},e.prototype._initCreatedThingjsObjectParams=function(e){this.thingjsObject.uuid=e.uuid,this.thingjsObject.id=e.id,this.thingjsObject.name=e.name},e.prototype.registerCreatedCallbackListener=function(e,t){this._createdCallbacks.push(e),this._createdCallbackParams.push(t)},e.prototype._notifyCreatedCompleteListeners=function(){for(var e=0;e<this._createdCallbacks.length;e++){(0,this._createdCallbacks[e])(this,this._createdCallbackParams[e])}},e.prototype.registerBuildedCallbackListener=function(e,t){this._buildedCallbacks.push(e),this._buildedCallbackParams.push(t)},e.prototype._notifyBuildedCompleteListeners=function(){for(var e=0;e<this._buildedCallbacks.length;e++){(0,this._buildedCallbacks[e])(this,this._buildedCallbackParams[e])}},e.prototype._getCreateParams=function(){var e={};e.uuid=this.json2meshObject.id,null!==this.json2meshObject.userID&&(e.id=this.json2meshObject.userID),null!==this.json2meshObject.name&&(e.name=this.json2meshObject.name),null!==this.json2meshObject.properties&&(e.properties=this.json2meshObject.properties),null!==this.thingjsParent&&void 0!==this.thingjsParent&&(e.parent=this._getParent(this.thingjsParent,this.createType));var t=this.createType;return this.json2meshObject.jsonData&&this.json2meshObject.jsonData.type&&(t=this.json2meshObject.jsonData.type),e.type=t,e.loaded=!1,e.node=new THREE.Object3D,e.node.name=t,e},e.prototype._callback=function(e,t){var i=t.creator;i._processCallback();var r=i.thingjsObject;i._notifyBuildedCompleteListeners(),r.setupResources({loaded:!0}),t.thingjsObject=r},e.prototype._processCallback=function(){var e=this.json2meshObject,t=this.thingjsObject;e.mesh&&(e.mesh.position.set(0,0,0),e.mesh.quaternion.set(0,0,0,1),e.mesh.scale.set(1,1,1),t.node.add(e.mesh))},e.prototype._getParent=function(e,t){return null==t&&(t="Thing"),"Ground"===e.type?"CombinedObject"===t||"BatchObject"===t?e:e.parent:e},e.prototype._isNullOrUndefined=function(e){return null==e},e}(),kr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.createType="Campus",r}return a(t,e),t.prototype.create=function(){return e.prototype.create.call(this),this.config.campus=this.thingjsObject,this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.loaded=!0,t},t.prototype._initCreatedThingjsObjectParams=function(e){this.thingjsObject.uuid=this.json2meshObject.id,this.json2meshObject.userID&&(this.thingjsObject.id=this.json2meshObject.userID)},t}(Or),Lr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.createType="Building",r}return a(t,e),t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.loaded=!0,t.structShow=this.json2meshObject.structShow,t},t.prototype.create=function(){return e.prototype.create.call(this),this.thingjsObject},t}(Or),Br=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.createType="Floor",r}return a(t,e),t.prototype.create=function(){return e.prototype.create.call(this),this._createCombineObjectParent("CombineWallParent"),this._createCombineObjectParent("CombineMiscParent"),this._createCombineObjectParent("CombineRoofParent"),this._createCombineObjectParent("CombineCeilingParent"),this._createCombineObjectParent("CombineFloorParent"),this.thingjsObject},t.prototype._hidePlanObjs=function(e){if(!e.showObjectsInParentLevels){for(var t=e.query(".CombinedObject",!1),i=0;i<t.length;i++){var r=t[i];if("CombineMiscParent"===r.userData.type)for(var n=r.query(".CombinedObject",!1),o=0;o<n.length;o++){var a=n[o];"CombinePlacement"===a.userData.json2meshType&&(a.visible=!1)}}for(var s=0;s<e.children.length;s++){var l=e.children[s];l.isDoor||"Room"===l.type||("Thing"===l.type&&l.isWindow||(l.visible=!1))}}},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.height=this.json2meshObject.height,t.alwaysShowInsideObjs=this.json2meshObject.alwaysShowInsideObjs,t.initBoxSize=this.json2meshObject.size.toArray(),t},t.prototype._createCombineObjectParent=function(e){var t=this.app.objectManager.create({node:new THREE.Object3D,loaded:!0,parent:this._getParent(this.thingjsObject,"CombinedObject"),type:"CombinedObject"});t.userData.type=e,t.userData.isCombineParent=!0},t.prototype._callback=function(e,t){for(var i=t.creator.thingjsObject,r=i.query(".CombinedObject",!1),n=0;n<r.length;n++){var o=r[n];o.loaded||o.setupResources({})}i.loaded||i.setupResources({})},t}(Or),Hr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.json2meshObject.jsonData&&r.json2meshObject.jsonData.type?r.createType=r.json2meshObject.jsonData.type:r.createType="Thing",r}return a(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this);return t.bundleID=this.json2meshObject.resource.modelID,t.bundleName=this.json2meshObject.resource.modelName,this._setVisible(),this.thingjsObject},t.prototype._setVisible=function(){var e=this.thingjsObject;"Floor"!==e.parent.type||e.parent.showObjectsInParentLevels||(e.visible=!1)},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.belongRoomUserID=this.json2meshObject.belongRoomUserID,t.hideByScene=!this.json2meshObject.isShow,t.initBoxSize=this.json2meshObject.size.toArray(),t.url=this.json2meshObject.resource.getModelUrl(),t},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i);var r=i.thingjsObject;if(r._hideByScene=!t.isShow,r.setupTextureAnimations(),r.setupAnimations({animations:t.resource.animations}),t.isPlayAnim&&r.containAnimation(t.animClip)){var n={name:t.animClip,loop:!1,speed:1};t.hasSkin&&(n.loop=!0),r.playAnimation(n)}},t}(Or),Ir=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.createType="Ground",r}return a(t,e),t.prototype.create=function(){return e.prototype.create.call(this),this.thingjsObject.name=this.json2meshObject.id,this._createCombineObjectParent("CombineWallParent"),this._createCombineObjectParent("CombineMiscParent"),this._createCombineObjectParent("CombineFloorParent"),this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.height=this.json2meshObject.height,t.alwaysShowInsideObjs=this.json2meshObject.alwaysShowInsideObjs,t.loaded=!0,t},t.prototype._createCombineObjectParent=function(e){var t=this.app.objectManager.create({node:new THREE.Object3D,loaded:!1,parent:this._getParent(this.thingjsObject,"CombinedObject"),type:"CombinedObject"});t.userData.type=e,t.userData.isCombineParent=!0},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i);var r=i.creator,n=i.thingjsObject;n.wall.setupResources({}),r._setupResourcesToChildren(n.wall),n.plan.setupResources({}),r._setupResourcesToChildren(n.plan),n.misc.setupResources({}),r._setupResourcesToChildren(n.misc)},t.prototype._setupResourcesToChildren=function(e){for(var t=0;t<e.children.length;t++){e.children[t].setupResources({})}},t}(Or),Nr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.createType="CombinedObject",r}return a(t,e),t.prototype.create=function(){return e.prototype.create.call(this).userData.json2meshType=this.json2meshObject.type,this.thingjsObject},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i),i.creator._checkCombineParentObjectLoaded()},t.prototype._checkCombineParentObjectLoaded=function(){for(var e=this.thingjsParent,t=0;t<e.children.length;t++){var i=e.children[t];if("CombineMiscParent"!==i.userData.type&&!i.loaded)return}e.setupResources({}),this._checkParentOfCombineParentObjectsLoaded(e.parent)},t.prototype._checkParentOfCombineParentObjectsLoaded=function(e){for(var t=e.query(".CombinedObject",!1),i=0;i<t.length;i++){var r=t[i];if("CombineMiscParent"!==r.userData.type&&!r.loaded)return}e.setupResources({})},t}(Or),Ur=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.wall,r.thingjsParent.loaded=!1,r}return a(t,e),t}(Nr),Vr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.ceiling,r.thingjsParent.loaded=!1,r}return a(t,e),t}(Nr),zr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.misc,r.thingjsParent.loaded=!1,r}return a(t,e),t.prototype.create=function(){return e.prototype.create.call(this).node.isDoorOrWin=!0,this.thingjsObject},t}(Nr),qr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.plan,r.thingjsParent.loaded=!1,r}return a(t,e),t}(Nr),Wr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.wall,r.thingjsParent.loaded=!1,r}return a(t,e),t}(Nr),Gr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.misc,r.thingjsParent.loaded=!1,r}return a(t,e),t}(Nr),Xr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.roof,r.thingjsParent.loaded=!1,r}return a(t,e),t}(Nr),Yr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.createType="Room",r}return a(t,e),t.prototype.create=function(){e.prototype.create.call(this);return this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.floorHideByScene=!this.json2meshObject.floor.isShow,t.ceilingHideByScene=!this.json2meshObject.ceiling.isShow,t.roofHideByScene=!this.json2meshObject.roof.isShow,t.holes=this.json2meshObject.holes,t.points=this.json2meshObject.points,t},t.prototype._processCallback=function(){e.prototype._processCallback.call(this);var t=this.thingjsObject,i=this.json2meshObject;i.floor.isShow?t._floorNode=i.floor.mesh:i.mesh.remove(i.floor.mesh),i.ceiling.isShow?t._ceilingNode=i.ceiling.mesh:i.mesh.remove(i.ceiling.mesh),i.roof.isShow?t._roofNode=i.roof.mesh:i.mesh.remove(i.roof.mesh)},t}(Or),Jr=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t}(Hr),Qr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.json2meshObject.jsonData&&r.json2meshObject.jsonData.type?r.createType=r.json2meshObject.jsonData.type:r.createType="Thing",r.json2meshObject.enableCreateMesh=!1,r}return a(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this);return"Floor"!==t.parent.type||t.parent.showObjectsInParentLevels||(t.visible=!1),this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.belongRoomUserID=this.json2meshObject.belongRoomUserID,t.hideByScene=!this.json2meshObject.isShow,t.initBoxSize=this.json2meshObject.size.toArray(),t},t.prototype._callback=function(e,t){var i=t.creator,r=i.thingjsObject;i.thingjsObject=r,r.setupResources({loaded:!0}),t.thingjsObject=r,i._notifyBuildedCompleteListeners(),r._hideByScene=!e.isShow,r.setupTextureAnimations()},t}(Or),Zr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.createType="Door",r.json2meshObject.isWindow&&(r.createType="Thing"),r}return a(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this);return t.node.isDoorOrWin=!0,t.isWindow=this.json2meshObject.isWindow,t.userData.isWindow=this.json2meshObject.isWindow,this.thingjsObject},t.prototype._setVisible=function(){},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i);var r=i.thingjsObject;if(t.isWindow||t.isOpen&&r.open(),r.animationClips)for(var n=0;n<r.animationClips.length;n++){var o=r.animationClips[n];if("_defaultAnim_"===o.name){r.playAnimation({name:o.name,loop:!0,speed:.15});break}}},t}(Hr),Kr=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.createType="RouteLine",r}return a(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this);return null!==this.json2meshObject.width&&(t.width=this.json2meshObject.width),"Ground"===this.thingjsParent.type||t.parent.showObjectsInParentLevels||(t.visible=!1),t.scrollSpeed=-10,t.rotateScrollDirection=!0,this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.hideByScene=!this.json2meshObject.isShow,t.arrowFlag=!1,t},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i);for(var r=[],n=0;n<t.points.length;n++){var o=t.points[n].clone();o.add(t.position),r.push(o)}var a=i.thingjsObject;if(a.addPoints(r,THING.SpaceType.Local),!t.resource.isEmpty&&t.resource.texture){var s=t.resource.texture.clone();s.flipY=!1,s.rotation=Math.PI/2,a.synPathTexture(s),s.needsUpdate=!0}if(t.color&&(a.style.color="#"+t.color.getHexString()),void 0!==t.enableMaterialAnimation&&(a.imageScroll=t.enableMaterialAnimation),void 0!==t.materialAnimationSpeed&&(a.imageScrollSpeed=-t.materialAnimationSpeed),void 0!==t.textureTiling){var l=t.textureTiling.toArray();l[1]*=a.width,a.imageRepeat=l}t.textureOffset},t}(Or),$r=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.createType="PolygonLine",r}return a(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this);return this.json2meshObject.sectionType&&("Triangle"===this.json2meshObject.sectionType&&(t.pathRadialSegments=3,t._updateByPoints()),"Square"===this.json2meshObject.sectionType&&(t.pathRadialSegments=4,t.pathStartRad=Math.PI/4,t._updateByPoints())),this.json2meshObject.radius&&(t.width=this.json2meshObject.radius),"Ground"===this.thingjsParent.type||t.parent.showObjectsInParentLevels||(t.visible=!1),this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.hideByScene=!this.json2meshObject.isShow,t},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i);for(var r=[],n=0;n<t.points.length;n++){var o=t.points[n].clone();o.add(t.position),r.push(o)}var a=i.thingjsObject;if(a.addPoints(r,THING.SpaceType.Local),!t.resource.isEmpty&&t.resource.texture){var s=t.resource.texture.clone();s.flipY=!1,a.synPathTexture(s),s.needsUpdate=!0}if(t.color?a.style.color="#"+t.color.getHexString():a.style.color="#ffffff",void 0!==t.enableMaterialAnimation&&(a.imageScroll=t.enableMaterialAnimation),void 0!==t.materialAnimationSpeed&&(a.imageScrollSpeed=t.materialAnimationSpeed),void 0!==t.textureTiling){var l=1.1*a.width*2*Math.PI/t.textureTiling.x;a.imageRepeat=[l,l]}t.textureOffset},t}(Or),en=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.json2meshBuilding=i.json2meshBuilding,r.createType="Facade",r.shouldCombineJson2meshObjects=[],r.shouldNotCombineJson2meshObjects=[],r.combineFacade=null,r.notCombineFacades=[],r}return a(t,e),t.prototype.create=function(){var e=this.json2meshBuilding,t=this._getFacadeRelation(e);return this.shouldCombineJson2meshObjects=t.facades,this.shouldNotCombineJson2meshObjects=t.children,t.children&&t.facades&&(this.thingjsObject=this._createFacade(t,this.thingjsParent),this._createFacadeChildren(t,this.thingjsObject)),this._notifyCreatedCompleteListeners(),this.thingjsObject},t.prototype._createFacade=function(e,t){var i=e.facades,r=new THREE.Object3D,n=this.app.objectManager.create({type:"Facade",loaded:!1,node:r,parent:t});this.combineFacade=n;for(var o=0;o<i.length;o++){var a=i[o],s=this.app.objectManager.create({uuid:a.id,type:"CombinedObject",node:new THREE.Object3D,loaded:!1,parent:n});s.userData.isCombinedObject=!0,a.registerBuildCallbackListener(this._facadeBuildCallback,{loader:this,tjsObject:s,relation:e,parent:n})}return n},t.prototype._createFacadeChildren=function(e,t){for(var i=e.children,r=0;r<i.length;r++){var n=i[r],o=this.app.objectManager.create({type:"Facade",uuid:n.id,id:n.userID,name:n.name,node:new THREE.Object3D,parent:t,loaded:!1,url:n.resource.getModelUrl(),properties:n.properties});n.registerBuildCallbackListener(this._facadeChildBuildCallback,{loader:this,relation:e,tjsObject:o,parent:t}),this.notCombineFacades.push(o)}},t.prototype._getFacadeRelation=function(e){var t=e.facades,i=e.facadeGroups;if(0===t.length&&0===i.length)return{};for(var r=[],n=[],o=0;o<t.length;o++){var a=t[o];this._isFacadeShouldBeChild(a)?r.push(a):n.push(a)}for(var s=0;s<i.length;s++){var l=i[s];this._isFacadeShouldBeChild(l)?r.push(l):n.push(l)}return{facades:n,children:r}},t.prototype._isFacadeShouldBeChild=function(e){return!this._isNullOrUndefined(e.name)||(!this._isNullOrUndefined(e.userID)||!this._isNullOrUndefined(e.properties))},t.prototype._facadeChildBuildCallback=function(e,t){var i=t.tjsObject,r=t.loader,n=t.relation,o=t.parent;i.node.add(e.mesh),i.setupResources({loaded:!0}),r._checkFacadeBuildedComplete(n,o)},t.prototype._checkFacadeBuildedComplete=function(e,t){for(var i=e.facades,r=e.children,n=!0,o=0;o<i.length;o++){if(!i[o].isBuilded){n=!1;break}}for(var a=0;a<r.length;a++){if(!r[a].isBuilded){n=!1;break}}n&&(t.setupResources({}),this._notifyBuildedCompleteListeners())},t.prototype._facadeBuildCallback=function(e,t){var i=t.tjsObject,r=t.loader,n=t.relation,o=t.parent;i.node.add(e.mesh);var a=e.mesh.getMeshes();a&&a.length>0&&a.forEach((function(e){e._sfStyle="Facade"})),i.setupResources({loaded:!0}),r._checkFacadeBuildedComplete(n,o)},t}(Or),tn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.createType="RouteLine",r}return a(t,e),t.prototype.create=function(){e.prototype.create.call(this);return this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.arrowFlag=!0,t},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i)},t}(Kr),rn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.createType="RouteLine",r}return a(t,e),t.prototype.create=function(){e.prototype.create.call(this);return this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.arrowFlag=!0,t},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i);var r=i.creator.thingjsObject;t.pointUserIDs&&(r.userData.pointUserIDs=t.pointUserIDs),t.pointProperteis&&(r.userData.pointProperteis=t.pointProperteis)},t}(tn),nn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.createType="PolygonLine",r}return a(t,e),t.prototype.create=function(){e.prototype.create.call(this);return this.thingjsObject},t.prototype._getCreateParams=function(){return e.prototype._getCreateParams.call(this)},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i);var r=i.creator.thingjsObject;t.alarmLength&&(r.userData.alarmLength=t.alarmLength)},t}($r),on=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.createType="RouteLine",r}return a(t,e),t.prototype.create=function(){e.prototype.create.call(this);return this.thingjsObject},t.prototype._getCreateParams=function(){return e.prototype._getCreateParams.call(this)},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i)},t}(Kr),an=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.wall,r.thingjsParent.loaded=!1,r}return a(t,e),t}(Nr),sn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.createType="Thing",r}return a(t,e),t.prototype.create=function(){return e.prototype.create.call(this)},t.prototype._getCreateParams=function(){return e.prototype._getCreateParams.call(this)},t.prototype._setVisible=function(){var e=this.thingjsObject;"Floor"!==this.thingjsParent.type||this.thingjsParent.showObjectsInParentLevels||(e.visible=!1)},t.prototype._getParent=function(e,t){return null==t&&(t="Thing"),e},t}(Hr),ln=function(){function e(){n(this,e),this._map={World:kr,Building:Lr,FloorPlan:Br,Placement:Hr,Outdoors:Ir,CombineStraightManualWall:Ur,CombineCeiling:Vr,CombineDoorOrWindow:zr,CombineFloor:qr,CombineModelWall:Wr,CombinePlacement:Gr,CombineRoof:Xr,CombinePlacementWall:an,Room:Yr,VideoProbe:Jr,PlacementGroup:Qr,DoorOrWindow:Zr,CurveLine:Kr,PipeLine:$r,Facade:en,FacadeGroup:en,ArrowLine:tn,ArrowDataLine:rn,LeakWaterLine:nn,RouteLine:on,PlacementGround:sn},this._createdThingjsObjectMap={},this.campus=null}return e.prototype.getClass=function(e){return this._map[e]},e.prototype.addCreatedThingjsObject=function(e,t){this._createdThingjsObjectMap[e.id]=t},e.prototype.getCreatedThingjsObject=function(e){return this._createdThingjsObjectMap[e]},e}(),un={changeParentToRoom:function(e){var t=e.json2meshObject,i=e.app;if(t.belongRoomUserID&&"FloorPlan"===t.parent.type){var r=i.query("#"+t.belongRoomUserID)[0];e.thingjsParent=r}},getThingjsObjectInRoomLocalPosition:function(e,t,i){if(i){var r=i.parent.selfToWorld(e.position.toArray());return r=t.worldToLocal(r)}return e.position.toArray()}},cn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return un.changeParentToRoom(r),r}return a(t,e),t.prototype._getThingjsLocalPosition=function(){var e=null;return"Room"===this.thingjsParent.type&&(e=this.thingjsParent),un.getThingjsObjectInRoomLocalPosition(this.json2meshObject,this.thingjsObject,e)},t}(Hr),hn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return un.changeParentToRoom(r),r}return a(t,e),t.prototype._getThingjsLocalPosition=function(){var e=null;return"Room"===this.thingjsParent.type&&(e=this.thingjsParent),un.getThingjsObjectInRoomLocalPosition(this.json2meshObject,this.thingjsObject,e)},t}(Qr),pn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.createType="Room",r}return a(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this),i=this.app.objectManager.create({node:new THREE.Object3D,parent:this._getParent(t,"CombinedObject"),type:"CombinedObject"});i.userData.type="CombineMiscParent",i.userData.isCombineParent=!0},t}(Yr),dn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return un.changeParentToRoom(r),"Room"===r.thingjsParent.type&&(r.thingjsParent=r.thingjsParent.misc,r.thingjsParent.loaded=!1),r}return a(t,e),t.prototype._getThingjsLocalPosition=function(){var e=null;return"Room"===this.thingjsParent.parent.type&&(e=this.thingjsParent.parent),un.getThingjsObjectInRoomLocalPosition(this.json2meshObject,this.thingjsObject,e)},t.prototype._checkParentOfCombineParentObjectsLoaded=function(e){},t}(Gr),fn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return un.changeParentToRoom(r),r}return a(t,e),t.prototype._getThingjsLocalPosition=function(){var e=null;return"Room"===this.thingjsParent.type&&(e=this.thingjsParent),un.getThingjsObjectInRoomLocalPosition(this.json2meshObject,this.thingjsObject,e)},t}(Jr),mn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._map.Placement=cn,r._map.PlacementGroup=hn,r._map.Room=pn,r._map.CombinePlacement=dn,r._map.VideoProbe=fn,r}return a(t,e),t}(ln),gn=function(){function e(){n(this,e)}return e.prototype.init=function(e){},e.prototype.onFire=function(e){},e}(),vn=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerCreatedCallbackListener(this.onFire,{event:this}),t.registerBuildedCallbackListener(this._buildCallback,{event:this})},t.prototype.onFire=function(e,t){var i=e.thingjsObject,r=e.json2meshObject,n=t.event;if("Building"!==i.type&&"Campus"!==i.type&&"CombinedObject"!==i.type&&"Room"!==i.type&&"RouteLine"!==i.type&&"PolygonLine"!==i.type&&"Ground"!==i.type)if("Facade"===i.type){var o=e.json2meshBuilding;n._addFacadeBoxNode(o,i)}else n._addBoxNode(r,i)},t.prototype._addFacadeBoxNode=function(e,t){var i=this._getFacadesBoundingBox(e),r=new THREE.Vector3,n=new THREE.Vector3;i.getSize(r),i.getCenter(n);var o=new THREE.BoxBufferGeometry(1,1,1),a=new THREE.MeshBasicMaterial;a.visible=!1;var s=new THREE.Mesh(o,a);s.scale.set(r.x,r.y,r.z),s.userData.asBoundingBox=!0,s.userData.skipStyle=!0,s.userData.useToCaculateBoundingBox=!0,t.node.add(s),s.position.set(n.x,n.y,n.z)},t.prototype._getFacadesBoundingBox=function(e){for(var t=new THREE.Box3,i=new THREE.Object3D,r=e.facades,n=e.facadeGroups,o=0;o<r.length;o++){var a=r[o];i.add(a.boxMesh)}for(var s=0;s<n.length;s++){var l=n[s];i.add(l.boxMesh)}return t.setFromObject(i),t},t.prototype._addBoxNode=function(e,t){var i=new THREE.Vector3;e.boundingBox.getCenter(i);var r=new THREE.BoxBufferGeometry(1,1,1),n=new THREE.MeshBasicMaterial;n.visible=!1;var o=new THREE.Mesh(r,n),a=e.size.clone();a.divide(t.node.scale),o.scale.set(0===a.x?.001:a.x,0===a.y?.001:a.y,0===a.z?.001:a.z),o.userData.asBoundingBox=!0,o.userData.skipStyle=!0,o.userData.useToCaculateBoundingBox=!0,t.node.add(o),"Building"===t.type||"Floor"===t.type?o.position.set(i.x,i.y-t.node.position.y,i.z):o.position.set(0,e.size.y/2,0)},t.prototype._buildCallback=function(e,t){for(var i=e.thingjsObject,r=(e.json2meshObject,i.node),n=0;n<r.children.length;n++){var o=r.children[n];if(o.userData.asBoundingBox){o.visible=!1;break}}},t}(gn),yn=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){var i=e.thingjsObject,r=e.json2meshObject,n=t.event;if("CombinePlacement"===r.type){var o=r.placements,a=r.transformations,s=r.resource.modelID;r.resource.model.updateMatrixWorld();for(var l=app.create({type:"BatchObject",nodeOverride:!1,node:r.resource.model,initBatchNum:o.length,parent:i}),u=0;u<o.length;u++){var c=o[u],h=n.calMatrixs(a[u]),p=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Quaternion;h.decompose(p,f,d);var m=p.toArray(),g=d.toArray(),v=new THREE.Euler;v.setFromQuaternion(f);var y=v.toArray();y[0]*=180/Math.PI,y[1]*=180/Math.PI,y[2]*=180/Math.PI;l.createSubObject({parent:i,id:c.id,localPosition:m,scale:g,angles:y})}n.addSfStyle(l.node,n.isTree(s)?"Thing-树":"Thing")}},t.prototype.getMeshes=function(e){var t=[];return e.traverse((function(e){e.isMesh&&t.push(e)})),t},t.prototype.addSfStyle=function(e,t){var i=this.getMeshes(e);if(i&&i.length>0)for(var r=0;r<i.length;r++){i[r]._sfStyle=t}},t.prototype.isTree=function(e){return!!jr[e]},t.prototype.calMatrixs=function(e){for(var t=new THREE.Matrix4,i=e.positions.length-1;i>-1;i--){var r=e.positions[i],n=e.quaternions[i],o=e.scales[i],a=new THREE.Matrix4;a.compose(r,n,o),t.premultiply(a)}return t},t}(gn),bn=function(e){function t(){return n(this,t),s(this,e.call(this))}return a(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){e.thingjsObject;var i=e.json2meshObject,r=t.event;"Room"===i.type?r._createRoomWater(e):"CombineFloor"!==i.type&&"CombineCeiling"!==i.type&&"CombineRoof"!==i.type||r._createCombineFloorWater(e)},t.prototype._createRoomWater=function(e){var t=e.json2meshObject,i=e.thingjsObject;if(this._checkIsWater(t.floor.resource)){var r=t.floor.mesh.position,n=t.floor.mesh.quaternion,o=this._createWater(e,t.floor.mesh);t.floor.mesh=o.node,i._floorNode=o.node,i.add(o),o.node.position.copy(r),o.node.quaternion.copy(n),t.mesh.children[0]=o.node}if(this._checkIsWater(t.ceiling.resource)){var a=t.ceiling.mesh.position,s=t.ceiling.mesh.quaternion,l=this._createWater(e,t.ceiling.mesh);t.ceiling.mesh=l.node,i._ceilingNode=l.node,i.add(l),l.node.position.copy(a),t.mesh.children[1]=l.node,l.node.position.copy(a),l.node.quaternion.copy(s)}if(this._checkIsWater(t.roof.resource)){var u=t.roof.mesh.position,c=t.roof.mesh.quaternion,h=this._createWater(e,t.roof.mesh);t.roof.mesh=h.node,i._roofNode=h.node,i.add(h),h.node.position.copy(u),t.mesh.children[2]=h.node,h.node.position.copy(u),h.node.quaternion.copy(c)}},t.prototype._createCombineFloorWater=function(e){var t=e.json2meshObject,i=e.thingjsObject;if(this._checkIsWater(t.resource)){var r=this._createWater(e,t.mesh);r.scale.y*=-1,i.node.remove(t.mesh),i.add(r),r.node.position.copy(t.mesh.position),r.node.quaternion.copy(t.mesh.quaternion)}},t.prototype._checkIsWater=function(e){return"bundle"===e.ext&&("test0000000003"===e.id||"test0000000004"===e.id)},t.prototype._createWater=function(e,t){var i=e.app.objectManager.create({type:"Water",style:{waterColor:"#1D282C",waterScale:.3,flowXDirection:2,flowYDirection:1},geometry:t.geometry});return i.water.position.set(0,0,0),i.water.quaternion.set(0,0,0,1),i},t}(gn),_n=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this._buildCallback,{event:this})},t.prototype._buildCallback=function(e,t){var i=e.thingjsObject,r=e.json2meshObject,n=t.event;i.node;r.resource&&r.resource.indexJson?i._extensionsFile=r.resource.indexJson.extensionsfile||null:"Building"===r.type&&"Facade"===i.type&&n._processFacade(e,t)},t.prototype._processFacade=function(e,t){for(var i=e.thingjsObject,r=(e.json2meshObject,e.shouldNotCombineJson2meshObjects),n=0;n<r.length;n++){var o=r[n],a=i.query("##"+o.id)[0];o.resource&&o.resource.indexJson&&(a._extensionsFile=o.resource.indexJson.extensionsfile||null)}},t}(gn),xn=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerCreatedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){e.thingjsObject;var i=e.json2meshObject;t.event;i.properties&&"true"===i.properties._UseStaticImage_&&i.resource&&(i.resource.useStaticImage=!0)},t}(gn),En=function(){function e(t){n(this,e),this.campus=null,this.app=t,this.enableProxima=!1,this.enableDynamicLoad=!1,this.creatorManager=null,this.enableBatchObject=!1}return e.prototype.setCampus=function(e){this.campus=e},e.prototype.parseWorld=function(e){var t=null,i=[];t=this.enableProxima?new mn(this.app):new ln(this.app),this.enableDynamicLoad&&i.push(new vn),this.enableBatchObject&&i.push(new yn(this.app)),i.push(new bn),i.push(new _n),i.push(new xn(this.app)),null!==this.campus&&t.addCreatedThingjsObject(e,this.campus),this.creatorManager=new Fr({app:this.app,config:t,events:i});var r=this.parseJson2meshObject(e);return this.processHideObjects(r),r},e.prototype.parseJson2meshObject=function(e,t){var i=this.creatorManager.createTjsObject(e,t);if("Building"===e.type&&this.parseFacades(e,i),this.shouldParseChildren(e)){var r=e.children;if(r)for(var n=0;n<r.length;n++){var o=r[n];"Facade"!==o.type&&"FacadeGroup"!==o.type&&this.parseJson2meshObject(o,i)}}return i},e.prototype.shouldParseChildren=function(e){return!!e.isContainer},e.prototype.parseFacades=function(e,t){0===e.facades.length&&0===e.facadeGroups.length||this.creatorManager.createTjsFacadeObject(e,t)},e.prototype.processHideObjects=function(e){for(var t=e.buildings,i=0;i<t.length;i++){var r=t[i],n=r.floors;if(r.facade&&!r.structShow)for(var o=0;o<n.length;o++){n[o].visible=!1}else for(var a=0;a<n.length;a++){var s=n[a];this.hidePlanObjs(s)}}},e.prototype.hidePlanObjs=function(e){if(!e.showObjectsInParentLevels){for(var t=e.query(".CombinedObject",!1),i=0;i<t.length;i++){var r=t[i];if("CombineMiscParent"===r.userData.type)for(var n=r.query(".CombinedObject",!1),o=0;o<n.length;o++){var a=n[o];"CombinePlacement"===a.userData.json2meshType&&(a.visible=!1)}}for(var s=0;s<e.children.length;s++){var l=e.children[s];l.isDoor||"Room"===l.type||("Thing"===l.type&&l.isWindow||(l.visible=!1))}}},e}(),wn=function(){function e(t,i){n(this,e),this.app=t,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=i,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.enableDownloadSceneJsonCache=!0,this.enableDynamicLoad=!1,this.enableProxima=!1,this.enableBatchObject=!1;this.worldNode;if(i&&(i.position&&(this.campusPosition=i.position),i.rotation&&(this.campusRotation=i.rotation),void 0!==i.isCamFitScene&&null!==i.isCamFitScene&&(this.isCamFitScene=i.isCamFitScene),i.scale&&(this.campusScale=i.scale),void 0!==i.outdoorsVisible&&(this.outdoorsVisible=i.outdoorsVisible),void 0!==i.campusVisible&&(this.campusVisible=i.campusVisible),i.campus&&(this.campus=i.campus),i.enableDynamicLoadScene&&(this.enableDynamicLoad=i.enableDynamicLoadScene),i.enableProxima&&(this.enableProxima=i.enableProxima),i.enableBatchObject&&(this.enableBatchObject=i.enableBatchObject),void 0!==i.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=i.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),void 0!==i.enableDownloadSceneJsonCache&&(this.enableDownloadSceneJsonCache=i.enableDownloadSceneJsonCache),i.startDownloadResourcesCallback&&(this.startDownloadResourcesCallback=i.startDownloadResourcesCallback)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),i.default){var r=i.default;r.sceneJson&&(this.sceneJson="export.json"),r.wallTexture&&(this.defaultWallTextureUri=r.wallTexture),r.wallEdgeTexture&&(this.defaultWallEdgeTextureUri=r.wallEdgeTexture),r.floorTexture&&(this.defaultFloorTextureUri=r.floorTexture),r.ceilingTexture&&(this.defaultCeilingTextureUri=r.ceilingTexture),r.roofTexture&&(this.defaultRoofTextureUri=r.roofTexture)}this.app.options.loaderResourceUrl&&(this.resourceUrl=this.app.options.loaderResourceUrl),void 0!==this.app.options.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=this.app.options.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),void 0!==this.app.options.enableBatchObject&&this.app.options.enableBatchObject&&(json2mesh.DefaultSetting.enableCombinePlacementToBuildMesh=!1,this.enableBatchObject=this.app.options.enableBatchObject),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary),this.enableDownloadSceneJsonCache||(this.sceneJsonUri+="?_t="+(new Date).getTime()),this.json2meshToThingjsParser=null}return e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.load=function(e){var t=this;if(t.json2meshToThingjsParser=new En(t.app),t.enableProxima&&(t.json2meshToThingjsParser.enableProxima=!0,json2mesh.DefaultSetting.enableCombinePlacementsByRoom=!0),t.enableBatchObject&&(t.json2meshToThingjsParser.enableBatchObject=t.enableBatchObject),"String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node,this.json2meshToThingjsParser.setCampus(this.campus))}return this.relativeResourceUrl&&(0===this.relativeResourceUrl.indexOf("./")?this.resourceUrl=this.sceneURL+this.relativeResourceUrl.replace("./","/"):this.resourceUrl=this.relativeResourceUrl),new Promise((function(e,i){t.updateProgress(.1),t.loadSceneJson().then((function(i){t.sceneJsonString=i,t.sceneJson=JSON.parse(i),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.1);var r=new json2mesh.UBuilderSceneDelayLoader;t.enableDynamicLoad&&(r.enableRequestWorld=!1,t.json2meshToThingjsParser.enableDynamicLoad=!0),t.resourceUrl&&(r.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",r.resourceManager.baseModelUrl=t.resourceUrl+"/model/"),t.loader=r,r.delayLoad({json:t.sceneJson,customModeBaseUrl:t.sceneURL+"/",version:0}).then((function(i){(new Pr).parseWorld(i),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.campus.visible=t.campusVisible,t.campusRotation&&t.campus.node.quaternion.set(t.campusRotation.x,t.campusRotation.y,t.campusRotation.z,t.campusRotation.w),t.campusPosition&&(t.campus.position=t.campusPosition),t.campusScale&&(t.campus.scale=t.campusScale),t.startDownloadResourcesCallback&&t.startDownloadResourcesCallback(r.resourceManager.models,r.resourceManager.textures),t.campus=t.json2meshToThingjsParser.parseWorld(i),t.enableDynamicLoad?(t.loadExtraData(t.campus),t.updateProgress(1),e(t.campus)):r.startToBuild((function(i){t.updateProgress(.1+.9*i),1===i&&(t.updateProgress(1),t.loadExtraData(t.campus),e(t.campus))}))}))}))}))},e.prototype.loadExtraData=function(e){this.sceneJson.extraData&&(e.extraData=this.sceneJson.extraData)},e.prototype.loadSceneJson=function(){var e=this;return new Promise((function(t,i){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/"+e.sceneJsonUri,(function(e){t(e)}))}))},e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.startToDownloadRequestResources=function(e){this.loader.resourceManager.startToDownloadRequestResources(e)},e.prototype.addResourceDownloadRequest=function(e){this.loader.resourceManager.addResourceDownloadRequest(e)},e.prototype.clearAllResources=function(){this.loader.resourceManager.disposeModels(),this.loader.resourceManager.disposeTextures()},e.prototype.clearAllObjects=function(){this.world.clear()},e.prototype.requestToBuild=function(e){this.loader.requestToBuild(e)},e.prototype.startToBuild=function(e){return this.loader.startToBuild(e)},e.prototype.disposeObject=function(e){this.loader.disposeObject(e)},e.prototype.findObjectByID=function(e){return this.world.findObjectByID(e)},e}(),Tn=function(){function e(t){n(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.rootNode=null,this.campus=null,this.sceneURL=null,this.sceneJsonData=null,this.loadedSceneGLTF=null,this.worldNode=new THREE.Object3D,this.fitCamInfo=null}return e.prototype.parse=function(e){if(this.parseWorld(e),e.camInfo){var t=e.camInfo;this.fitCamInfo=t}},e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.campus.node.name="campus",this.app.scene.add(this.campus.node)),e.outdoors&&this.parseOutdoors(e.outdoors),e.buildings){var i=e.buildings;this.parseBuildings(i)}},e.prototype.parseOutdoors=function(e){var t=e,i=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:i});var r=this.outdoors;this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors);var n=t.gltfid;if(n&&this.nodes[n]){var o=this.nodes[n];THREE.SceneUtils.detach(o,o.parent,this.app.scene),THREE.SceneUtils.attach(o,this.app.scene,r.node),r.node.updateMatrixWorld()}this.parseFloorPlan(t,r)},e.prototype.parseBuildings=function(e){for(var t in e){var i=e[t],r=t;i.name&&(r=i.name);var n=null;if(i.gltfid){var o=i.gltfid;this.nodes[o]&&(n=this.nodes[o])}var a=this.app.objectManager.create({type:"Building",name:r,parent:this.campus,node:n});i.plans&&this.parseFloorPlans(i.plans,a),i.facades&&this.parseFacades(i.facades,a)}},e.prototype.parseFloorPlans=function(e,t){for(var i in e){var r=null,n=e[i],o=i;n.name&&(o=n.name);var a=n.gltfid;a&&this.nodes[a]&&(r=this.nodes[a]);var s=this.app.objectManager.create({type:"Floor",name:o,node:r,parent:t});this.parseFloorPlan(n,s)}},e.prototype.parseFloorPlan=function(e,t){e.placements&&this.parseThings(e.placements,t),e.videoprobes&&this.parseThings(e.videoprobes,t),e.doororwindows&&this.parseDoorWins(e.doororwindows,t),e.routes&&this.parseThings(e.routes,t),e.pipelines&&this.parseThings(e.pipelines,t),e.curvelines&&this.parseThings(e.curvelines,t),e.arrowlines&&this.parseThings(e.arrowlines,t),e.arrowdatalines&&this.parseThings(e.arrowdatalines,t),e.leakwaterlines&&this.parseThings(e.leakwaterlines,t),e.rooms&&this.parseRooms(e.rooms,t),this.parseStructure(e,t);var i=e.groups;i&&this.parseGroup(i,t)},e.prototype.parseRooms=function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=null;r.name&&(n=r.name);var o=null,a=r.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=r.properties;if(l)for(var u in s={},l){var c=l[u];s[u]=c}var h=null,p=null,d=null;r.floor&&(a=r.floor.gltfid,this.nodes[a]&&(d=this.nodes[a])),r.ceiling&&(a=r.ceiling.gltfid,this.nodes[a]&&(h=this.nodes[a])),r.roof&&(a=r.roof.gltfid,this.nodes[a]&&(p=this.nodes[a]));var f=null,m=null,g=null,v={};if(r.area&&(m=r.area,v.area=m),r.circumference&&(g=r.circumference,v.circumference=g),r.center){var y=r.center;(f=new THREE.Vector3).set(y[0],y[1],-y[2]),v.center=f}var b=r.isShown;if(b){var _="false"!==(b=b.toLowerCase());o.visible=_}this.app.objectManager.create({type:"Room",name:n,node:o,ceilingNode:h,roofNode:p,floorNode:d,parent:t,properties:s,auxiliaryInfo:v})}},e.prototype.parseStructure=function(e,t){if(e.structure){var i=(e=e.structure).placements;if(i)for(var r in i){var n=i[r].gltfid,o=this.nodes[n];if(o){t.miscNode=o.parent;break}}var a=e.walls;if(a)for(var r in a){n=a[r].gltfid;var s=this.nodes[n];if(s){t.wallNode=s.parent;break}}var l=e.roofs;if(l)for(var r in l){n=l[r].gltfid;var u=this.nodes[n];if(u){t.roofNode=u.parent;break}}var c=e.ceilings;if(c)for(var r in c){n=c[r].gltfid;var h=this.nodes[n];if(h){t.ceilingNode=h.parent;break}}if(p=e.floors)for(var r in p){var p;if(n=(p=p[r]).gltfid){var d=this.nodes[n];if(d){t.floorNode=d.parent;break}}}}},e.prototype.parseGroup=function(e,t){for(var i in e){var r=e[i],n=i;r.name&&(n=r.name);var o=null,a=r.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=r.properties;if(l)for(var u in s={},l){var c=l[u];s[u]=c}this.app.objectManager.create({type:"Thing",name:n,node:o,parent:t,properties:s}),r.placements&&this.parseThings(r.placements,t)}},e.prototype.parseFacades=function(e,t){for(var i in e){var r=e[i],n=i;r.name&&(n=r.name);var o=null,a=r.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=r.properties;if(l)for(var u in s={},l){var c=l[u];s[u]=c}var h=r.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Facade",name:n,node:o,parent:t,properties:s});t.node.add(o)}},e.prototype.parseThings=function(e,t){for(var i in e){var r=e[i],n=r.name||i,o=r.type||"Thing",a=null,s=r.gltfid;s&&this.nodes[s]&&(a=this.nodes[s]);var l=null,u=r.properties;if(u)for(var c in l={},u){var h=u[c];l[c]=h}var p=r.isShown;if(p){var d="false"!==(p=p.toLowerCase());a.visible=d}this.app.objectManager.create({type:o,name:n,node:a,parent:t,properties:l})}},e.prototype.parseDoorWins=function(e,t){for(var i in e){var r=e[i],n=i;r.name&&(n=r.name);var o=null;if(r.gltfid){var a=r.gltfid;this.nodes[a]&&(o=this.nodes[a])}var s=null;if(r.properties){var l=r.properties;for(var u in s={},l){var c=l[u];s[u]=c}}this.app.objectManager.create({type:"Door",name:n,node:o,parent:t,properties:s})}},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node)}return new Promise((function(e,i){t.loadGLTF().then((function(e){return t.loadedSceneGLTF=e,e.scene.traverse((function(e){t.nodes[e.name]=e})),t.parseSceneJson()})).then((function(i){t.fitCamInfo?t.parseCamInfo(t.fitCamInfo):t.campus.node&&t.app.camera.fit(t.campus),e(t.campus)})).catch((function(){t.campus.node.add(t.loadedSceneGLTF.scene.children[0]),t.campus&&t.app.camera.fit(t.campus),e(t.campus)}))}))},e.prototype.loadGLTF=function(){var e=this;return new Promise((function(t,i){var r=new THREE.GLTFLoader(e.app.loadingManager);r.setCrossOrigin("anonymous"),r.load(e.sceneURL+"/Unity2GLTF.gltf",(function(e){t(e)}))}))},e.prototype.parseSceneJson=function(){var e=this;return new Promise((function(t,i){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/scene.json",(function(i){var r=JSON.parse(i);e.sceneJsonData=r,e.parseWorld(r),t(r)}),(function(){}),(function(){console.error("not find file scene.json "),i()}))}))},e}(),Sn=function(e){function t(i,r){return n(this,t),s(this,e.call(this,i,r))}return a(t,e),t.prototype.load=function(e){var t=this;if(t.json2meshToThingjsParser=new En(t.app),t.enableProxima&&(t.json2meshToThingjsParser.enableProxima=!0,json2mesh.DefaultSetting.enableCombinePlacementsByRoom=!0),t.enableBatchObject&&(t.json2meshToThingjsParser.enableBatchObject=t.enableBatchObject),"String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node,this.json2meshToThingjsParser.setCampus(this.campus))}return this.relativeResourceUrl&&(0===this.relativeResourceUrl.indexOf("./")?this.resourceUrl=this.sceneURL+this.relativeResourceUrl.replace("./","/"):this.resourceUrl=this.relativeResourceUrl),new Promise((function(e,i){t.updateProgress(.1),t.loadSceneJson().then((function(i){t.sceneJsonString=i,t.sceneJson=JSON.parse(i),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.1);var r=new json2mesh.UBuilderSceneDelayLoader;t.enableDynamicLoad&&(r.enableRequestWorld=!1,t.json2meshToThingjsParser.enableDynamicLoad=!0),t.resourceUrl&&(r.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",r.resourceManager.baseModelUrl=t.resourceUrl+"/model/"),t.loader=r,r.delayLoad({json:t.sceneJson,version:1,customModeBaseUrl:"https://www.thingjs.com/"}).then((function(i){(new Pr).parseWorld(i),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.campus.visible=t.campusVisible,t.campusRotation&&t.campus.node.quaternion.set(t.campusRotation.x,t.campusRotation.y,t.campusRotation.z,t.campusRotation.w),t.campusPosition&&(t.campus.position=t.campusPosition),t.campusScale&&(t.campus.scale=t.campusScale),t.startDownloadResourcesCallback&&t.startDownloadResourcesCallback(r.resourceManager.models,r.resourceManager.textures),t.campus=t.json2meshToThingjsParser.parseWorld(i),t.enableDynamicLoad?(t.loadExtraData(t.campus),t.updateProgress(1),e(t.campus)):r.startToBuild((function(i){t.updateProgress(.1+.9*i),1===i&&(t.updateProgress(1),t.loadExtraData(t.campus),e(t.campus))}))}))}))}))},t}(wn),An=function(){function e(t){n(this,e),this.app=t,this.supportVersion={1:1,2:1,3:0},this.versionLib={1:{0:{0:Dr},1:{0:Tn}},2:{0:{0:Mr},1:{0:Cr,1:Rr}},3:{0:wn,1:Sn}}}return e.prototype.getLoader=function(e){if(e){var t=e.version,i=0,r=0,n=0;if(t){var o=t.split(".");i=parseInt(o[0]),r=parseInt(o[1]),n=parseInt(o[2])}var a=null,s=this.versionLib[i];if(s)if(3===i)a=s[r];else{var l=s[r];l&&(a=l[n])}if(!a)return console.error("can not find right version "+t+" to load scenejson"),null;if(1===i)h=new a(this.app);else if(2===i)switch(r){case 1:var u={},c=e.position;c&&(u.position=c),e.rotation&&(u.rotation=e.rotation),e.campus&&(u.campus=e.campus),u.isCamFitScene=ke.parseValue(e.isCamFitScene,!0),u.isDelayLoadFloorPlan=ke.parseValue(e.isDelayLoadFloorPlan,!1),h=new a(this.app,u);break;default:h=new a(this.app)}else 3===i&&(e.version=r,h=new a(this.app,e));return h}var h=new Dr(this.app);return h},e}(),Mn=function(){function e(t){n(this,e),this.app=t}return e.prototype.parse=function(e,t,i,r){switch(e.type){case"Thing":case"Door":case"Window":return[this._parseThing(e,t,i,r)];case"Building":return this._parseBuilding(e,t,i,r);case"Facade":return this._parseFacade(e,t,i,r);case"Fence":case"CurveFence":return this._parseFence(e,t,i,r);case"BatchFence":return this._parseBatchFence(e,t,i,r);case"Region":return this._parseRegion(e,t,i,r);case"Group":return this._parseGroup(e,t,i,r);case"RouteLine":return[this._parseRouteLine(e,t,i,r)];case"Shape":return[this._parseShape(e,t,i,r)];case"BatchObject":return[this._parseBatchObject(e,t,i,r)];default:return console.warn("Parse object failed, due to '"+e.type+"' unknown object type"),null}},e.prototype._parseThing=function(e,t,i,r){var n=this,o=this._parseThingParam(e,t,i,r),a=void 0,s=new Promise((function(e){o.complete=function(t){return e(t)},a=n.app.create(o)}));return s.object=a,s},e.prototype._parseBuilding=function(e,t,i,r){var n=this,o=[],a=this._parseThing(e,t,i,r);if(o.push(a),e.facades){var s=e.facades.children,l=e.facades.scale;s.forEach((function(e){l&&(e.scale=l),o.push(n.parse(e,t,a.object))}))}return o},e.prototype._parseFacade=function(e,t,i,r){return this._parseThing(e,t,i,r)},e.prototype._parseFence=function(e,t,i,r){var n=this,o=[],a=this._parseFenceParam(e,t,i,r),s=a.doorsParam;delete a.doorsParam;var l=this._parseThing(e,t,i,a);return o.push(l),s&&s.forEach((function(e){var i=e.angles;o.push(n._parseThing(e,t,l.object,{angles:i}))})),o},e.prototype._parseRegion=function(e,t,i,r){var n=this,o={};if(o.level=e.level,e.repeatUV&&(o.repeatUV=e.repeatUV),r)for(var a in r)o[a]=r[a];o.points=e.points;var s=this._parseThing(e,t,i,o);s.object.addControl(new THING.RegionAutoOffset({object:s.object}));var l=e.fences;return l&&l.forEach((function(e){n._parseFence(e,t,s.object)})),[s]},e.prototype._parseRouteLine=function(e,t,i,r){var n=this,o=e.points,a=e.position,s=[],l=this._getWorldPositionByParam(a,i);o.forEach((function(e){s.push([e[0]+l[0],e[1]+l[1],e[2]+l[2]])}));var u=this._parseThingParam(e,t,i,r);u.points=s,delete u.localPosition;var c=void 0,h=new Promise((function(e){u.complete=function(t){return e(t)},c=n.app.create(u)}));return h.object=c,h},e.prototype._parseShape=function(e,t,i,r){var n=this,o=e.points,a=e.position,s=[],l=this._getWorldPositionByParam(a,i);o.forEach((function(e){s.push([e[0]+l[0],e[1]+l[1],e[2]+l[2]])}));var u=this._parseThingParam(e,t,i,r);u.points=s,u.height=e.height,delete u.localPosition;var c=void 0,h=new Promise((function(e){u.complete=function(t){return e(t)},c=n.app.create(u)}));return h.object=c,h},e.prototype._parseGroup=function(e,t,i,r){var n=this,o=[],a={type:"Thing"};if(r)for(var s in r)a[s]=r[s];var l=this._parseThing(e,t,i,a);return o.push(l),e.children&&e.children.forEach((function(e){o=o.concat(n.parse(e,t,l.object,void 0))})),o},e.prototype._parseBatchObject=function(e,t,i,r){var n={type:e.type,parent:i,localPosition:e.localPosition};if(e.tags&&(n.tags=e.tags),void 0!==e.model){var o=this._getModelInfo(e.model,t.models);o&&(n.url=o.url)}var a=this,s=void 0,l=new Promise((function(t){n.complete=function(i){s=i.object,null!=e.children&&e.children.forEach((function(e){!function(e){var t={localPosition:e.position},i=e.rotation;i&&((i=ke.parseAngles(new THREE.Quaternion(i[0],i[1],i[2],i[3])))[0]=ke.parseValue(i[0],0),i[1]=ke.parseValue(i[1],0),i[2]=ke.parseValue(i[2],0),t.angles=i);var r=e.scale;r&&(r[0]=r[0]||1,r[1]=r[1]||1,r[2]=r[2]||1,t.scale=r);s.createSubObject(t)}(e)})),t(s)},(s=a.app.create(n)).canNotQueryFromSelector=!0}));return l.object=s,l},e.prototype._parseBatchFence=function(e,t,i,r){var n=this,o=[],a={type:"Fence",BatchFence:"BatchFence",parent:i};if(void 0!==e.model){var s=this._getModelInfo(e.model,t.models);s&&(a.url=s.url)}var l=[];if(a.fencesData=l,e.children&&e.children.forEach((function(e){var r=n._parseFenceParam(e,t),a=r.doorsParam;delete r.doorsParam,a&&a.forEach((function(r){r.position=[e.position[0]+r.position[0],e.position[1]+r.position[1],e.position[2]+r.position[2]],o.push(n._parseThing(r,t,i,{angles:r.angles}))})),r=n._parseThingParam(e,t,null,r),l.push(r)})),r)for(var u in r)a[u]=r[u];var c=void 0,h=new Promise((function(e){a.complete=function(t){return e(t)},(c=n.app.create(a)).canNotQueryFromSelector=!0}));return h.object=c,o.push(h),o},e.prototype._parseThingParam=function(e,t,i,r){var n={uuid:e.uuid,name:e.name,id:e.id,type:e.type,tags:e.tags,userData:e.userData,parent:i,localPosition:e.position};if(null!=e.hideByScene&&1==e.hideByScene?n.hideByScene=!0:null!=e.visible&&0==e.visible&&(n.hideByScene=!0),void 0!==e.model){var o=this._getModelInfo(e.model,t.models);o&&(n.url=o.url)}if(void 0!==e.texture){var a=this._getTextureInfo(e.texture,t.textures);a&&(n.url=a.url)}var s=e.rotation;s&&((s=ke.parseAngles(new THREE.Quaternion(s[0],s[1],s[2],s[3])))[0]=ke.parseValue(s[0],0),s[1]=ke.parseValue(s[1],0),s[2]=ke.parseValue(s[2],0),n.angles=s);var l=e.scale;if(l&&(l[0]=l[0]||1,l[1]=l[1]||1,l[2]=l[2]||1,n.scale=l),r)for(var u in r)n[u]=r[u];return n},e.prototype._parseFenceParam=function(e,t,i,r){var n=this,o={},a=e.start;if(!a)return null;o.startPoint=a;var s=e.end;if(!s)return null;o.endPoint=s;var l=e.control;l&&(o.controlPoint=l);var u=void 0;if(e.doors){u=e.doors,o.doors=[];var c=(new THREE.Vector2).fromArray(a),h=(new THREE.Vector2).fromArray(s);e.doors.forEach((function(e){var i=h.clone().sub(c).normalize().angle();e.angles=[0,180*-i/Math.PI,0];var r=n._getModelInfo(e.model,t.models),a=1;e.scale&&e.scale.length>0&&(a=e.scale[0]);var s=r.size[0]*a,l=new THREE.Vector2(e.position[0],e.position[2]),u=c.distanceTo(l)/c.distanceTo(h);o.doors.push({width:s,percent:u})}))}if(r)for(var p in r)o[p]=r[p];return u&&(o.doorsParam=u),o},e.prototype._getModelInfo=function(e,t){if(ke.isNull(e)||e>=t.length)return console.warn("can not find model info from index '"+e+"'."),null;var i=t[e];return i.id?{id:i.id,name:i.name,size:i.size||[.5,.5,.5],url:this.app.confirmModelURL(i.id)}:(console.warn("model info id not set: "+JSON.stringify(i)),null)},e.prototype._getTextureInfo=function(e,t){if(ke.isNull(e)||e>=t.length)return console.warn("can not find texture info from index '"+e+"'."),null;var i=t[e];if(!i.id)return console.warn("texture info id not set: "+JSON.stringify(i)),null;if(!i.ext)return console.warn("texture info ext not set: "+JSON.stringify(i)),null;var r=this.app.confirmTextureURL(i.id,i.ext);return{id:i.id,name:i.name,url:r}},e.prototype._getWorldPositionByParam=function(e,t){var i=[0,0,0];return t&&(i=t.position),[i[0]+e[0],i[1]+e[1],i[2]+e[2]]},e}(),Cn=!1,Rn=void 0,Dn=function(){function e(t){n(this,e),this.app=t,this.waitingLoadCampuses=[],this.loadingCampus=!1,this._objectLoader=new Mn(t),this._combineLoader=new Pn(t)}return e.prototype._loadViewPointFile=function(e){var t=this.app.sceneManager,i=ke.parseValue(e.enableDeafultViewPointFile,t.enableDeafultViewPointFile),r=e.defaultViewPointFileName||t.defaultViewPointFileName;if(i&&r){var n=e.url.appendPath(r),o=this;(new THREE.FileLoader).load(n,(function(e){o.app.viewPointManger.loadJSON(e)}))}},e.prototype._runScript=function(e){var t;(t=ke.isString(e)?e:function(e){return p?p.decodeString(e):""}(e))&&De(t)},e.prototype.loadFromUBuilder=function(e,t,i,r,n){var o=this,a=r.position,s=r.rotation||r.angles,l=r.scale,u=ke.parseValue(r.outdoorsVisible||r.visible,!0),c=ke.parseValue(r.campusVisible||r.visible,!0),h=ke.parseValue(r.isCamFitScene,!0),p=ke.parseValue(r.isDelayLoadFloorPlan,!1),d=r.splitLoadSpeed,f=ke.parseValue(r.disableCache,!1),m=ke.parseValue(r.dynamic,!1),g=ke.parseValue(r.enableProxima,!1),v=ke.parseValue(r.enableBatchObject,!1);a&&(i.position=a),s&&(i.rotation=ke.parseQuaternion(s)),l&&(i.scale=l),void 0!==u&&(i.outdoorsVisible=u),void 0!==c&&(i.campusVisible=c),i.isCamFitScene=h,i.isDelayLoadFloorPlan=p,i.enableDownloadSceneJsonCache=!f,i.isDynamicLoadScene=ke.parseValue(m,i.isDynamicLoadScene),i.enableDynamicLoadScene=i.isDynamicLoadScene,i.enableProxima=ke.parseValue(g,i.enableProxima),i.enableBatchObject=ke.parseValue(v,i.enableBatchObject);var y=new An(this.app).getLoader(i);e.isDynamicLoadScene=ke.parseValue(i.isDynamicLoadScene,!1),e.isDynamicLoadScene&&(e._builder=y),y.loadSpeed=d;var b=i.camInfo;b&&(y.fitCamInfo=b),this.app.root._staticEnableFlag.lock(!1,"loadFromUBuilder"),y.load({campus:e,url:t}).then((function(e){var t=y.sceneJson?y.sceneJson:i,r=y.sceneJsonString;e.setSceneJSONData(t,r),e.position=e.position||a,e.angles=e.angles||s,n&&n(),o.app.root._staticEnableFlag.unlock("loadFromUBuilder")}))},e.prototype._notifyLoadingProgress=function(e){var t=(e.loadedNumber+e.resourceLoadedNumber)/(e.totalNumber+e.resourceTotalNumber);this.app.mainUI.updateLoadingProcess(t)},e.prototype.updateResourceItemNumber=function(e){e.resourceLoadedNumber++,this._notifyLoadingProgress(e)},e.prototype.updateTotalResourceItemNumber=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e.resourceTotalNumber+=t},e.prototype.updateItemNumber=function(e){if(e.loadedNumber++,this._notifyLoadingProgress(e),e.loadedNumber==e.totalNumber){var t=function(){var t=e.complete;t&&t(),e.complete=null},i=e.afterLoadScript;if(i){var r=url.appendPath(i);Me(r,(function(e){that._runScript(e),t()}))}else t()}},e.prototype.updateTotalItemNumber=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e.totalNumber+=t},e.prototype.getBundleData=function(e,t){if(ke.isNull(e)||e>=t.length)return!1;var i=t[e],r=i.id;return!!r&&{id:r,url:this.app.confirmModelURL(r),name:i.name,size:i.size}},e.prototype.getTextureData=function(e,t){if(ke.isNull(e)||e>=t.length)return!1;var i=t[e],r=i.id;if(!r)return!1;var n=i.ext;return!!n&&{id:r,url:this.app.confirmTextureURL(r,n),name:i.name}},e.prototype.parseFloorPlan=function(e,t,i,r){var n=this;this.updateTotalItemNumber(i,1),e.setupFromData({data:t,complete:function(){var e=this.internalUserData.edgeShape;e&&(n.app.resourceManager.remove(e),delete this.internalUserData.edgeShape),n.updateItemNumber(i)}})},e.prototype.parseFloorPlanByMeshData=function(e,t,i){if(e&&t&&t.data){var r=e.internalUserData.height,n=t.data.structure;if(!n)return;n.planheight=r,this._combineLoader.combineFloor(t),this.parseFloorPlan(e,t.data,i)}},e.prototype.parseFloorPlans=function(e,t,i,r){function n(e,t){var i=e[t.uuid];return i||null}for(var o=e.buildings,a=0;a<o.length;a++){var s=o[a],l=n(t,s);if(l){if(!this.parseFloorShapes(s,l,i,r))return!1;var u=s.floors;this.updateTotalItemNumber(i,u.length);for(var c=0;c<u.length;c++){var h=u[c],p=l.floors[c];this.parseFloorPlanByMeshData(h,p,i),this.updateItemNumber(i)}}}return!0},e.prototype.parseFloorShapes=function(e,t,i,r){var n=t.floors;if(!n)return!1;for(var o=0,a=0;a<n.length;a++){var s,l=n[a],u=l.uuid,c=l.name||u,h=l.height||3,p=new THREE.Color(1,1,1),d=l.outlineData;if(d)(s=this.app.create({type:"Shape",vertices:d,height:1,parent:e})).scale=[1,h,1],s.style.setMaterial({index:0,side:THREE.FrontSide,color:p,opacity:.5,depthTest:!1,depthWrite:!0,transparent:!0}),s.style.setMaterial({index:1,side:THREE.FrontSide,color:p,opacity:.5,depthTest:!1,depthWrite:!0,transparent:!0});else{var f=t.size;(s=this.app.create({type:"Box",width:f[0],height:h,depth:f[2],center:"Bottom",parent:e})).style.setMaterial({side:THREE.FrontSide,color:p,opacity:.5,depthTest:!1,depthWrite:!0,transparent:!0})}s.style.edgeColor=16777215;var m=this.app.create({type:"Floor",name:c,localPosition:[0,o,0],parent:e,visible:!1,uuid:u});m.internalUserData.edgeShape=s.node,s.node.visible=!1,m.node.add(s.node),s.style.skipStyle=!0,s.node=new THREE.Group,s.destroy(),m.internalUserData.height=h,o+=h}return!0},e.prototype.parseFloorDoor=function(e,t,i){var r=this,n=t.key.split("_"),o=t.suspendpercent?3*t.suspendpercent:0,a=[.01*t.pos[0],o,.01*t.pos[1]],s={uuid:n[1],type:"Door",url:this.app.confirmModelURL(t.typeId),localPosition:a,parent:e,complete:function(){this.scale=[.01*t.width/this.boundingBox.initSize[0],.01*t.height/this.boundingBox.initSize[1],1],this.angles=[0,-t.rotation,0],r.updateItemNumber(i)}};this.app.create(s)},e.prototype.parseGround=function(e,t){t.image&&(t.type="Ground",t.parent=e,this.app.create(t).style.setPolygonOffset({polygonOffset:!0,polygonOffsetFactor:0,polygonOffsetUnits:11e3}))},e.prototype.parseEffects=function(e,t){var i=t.fog;i&&(this.app.fog=i);var r=t.lighting;r&&(this.app.lighting=r);var n=t.postEffect;n&&(this.app.postEffect=n);var o=t.skyBox;o&&(this.app.skyBox=o);var a=t.ground;a&&(ke.isString(a)&&(a={width:1e3,height:1e3,image:a,repeatUV:[100,100]}),this.parseGround(e,a))},e.prototype.parseScene=function(e,t,i,r){var n=this,o=this;if(t=jn.convertData({dataType:"campus",data:t},i.version),ke.parseValue(r.isCamFitScene,!1)){var a=i.camInfo;if(a){var s=ke.parseVector3(a.eye);s&&(this.app.camera.position=s.toArray());var l=ke.parseVector3(a.target);l&&(this.app.camera.target=l.toArray()),e.sceneJSONData.camInfo={eye:s.toArray(),target:l.toArray()}}}if(i.coordinates){var u=i.coordinates;e.coordinates=u}if(t.models&&t.textures){var c=i.style;c&&Object.keys(c).length&&(this.app.applyTheme(c),e.applyTheme(c)),e.node.visible=ke.parseValue(r.visible,!0),t.owner=e,t.loadedNumber=0,t.totalNumber=0,t.resourceLoadedNumber=0,t.resourceTotalNumber=0;var h=i.afterLoadScript||r.afterLoadScript;h&&(t.totalNumber++,t.afterLoadScript=h);var p=i.files.floors;p&&this.updateTotalItemNumber(t,1),this._combineLoader.combineCampus(t);var d=t.objects;if(d)for(var f in d){var m=d[f];this.updateTotalItemNumber(t,m.length);for(var g=0;g<m.length;g++){var v=m[g],y=this._objectLoader.parse(v,t,e,void 0);this.updateTotalResourceItemNumber(t,y.length),y.forEach((function(e){e.then((function(){return n.updateResourceItemNumber(t)}))})),Promise.all(y).then((function(){return n.updateItemNumber(t)}))}}var b=i.effects;if(b&&this.parseEffects(e,b),p){var _=t.url.appendPath(p);(r.fileloader||new THREE.FileLoader).load(_,(function(n){var a=JSON.parse(n);(a=jn.convertData({dataType:"floor",data:a},i.version))&&o.parseFloorPlans(e,a,t,r),o.updateItemNumber(t)}),(function(){}),(function(){o.updateItemNumber(t)}))}}},e.prototype._loadScene=function(e,t,i,r,n,o){var a=this,s=e.appendPath(t);(n.fileloader||new THREE.FileLoader).load(s,(function(t){var s=JSON.parse(t);s.url=e,s.complete=o,a.parseScene(i,s,r,n)}),(function(){}),(function(){}))},e.prototype.loadFromCampusBuildier=function(e,t,i,r,n){var o=this,a=(t=this.app.confirmURL(t),i.files);if(a){var s=a.campus;if(s){var l=i.beforeLoadScript||r.beforeLoadScript;if(l){var u=t.appendPath(l);Me(u,(function(a){o._runScript(a),o._loadScene(t,s,e,i,r,n)}))}else this._loadScene(t,s,e,i,r,n)}else console.error('load "'+t+'" failed, due to scene file name of index.json is missing')}else console.error('load "'+t+'" failed, due to files of index.json is missing')},e.prototype._loadCampusFinished=function(e,t){e._processModel(),this._loadViewPointFile(t),this.app._lightGroup.setConfig({}),this._removeTypeMap(t),console.log("ThingJS: "+THING.VERSION)},e.prototype._convertOutdoorsToGround=function(e){if(e.outdoors){var t=e.outdoors.node;t.userData={},t.removeBySelf();var i=e.outdoors.id,r=e.outdoors.uuid,n=this.app.create({type:"Ground",id:i,uuid:r,node:t,visible:e.outdoors.visible,parent:e.outdoors.parent});e.outdoors.query("*",!1).not(".CombinedObject").forEach((function(t){e.add(t)})),e.outdoors.query(".CombinedObject",!1).forEach((function(e){n.add(e)})),e.outdoors.node=new THREE.Group,e.outdoors._children=[],e.outdoors.destroy(),e.outdoors=n}},e.prototype._loadFinished=function(e,t){var i=this,r=t.complete;if(t.complete=function(e){e.object._synEffectRefCounts(),i._loadCampusFinished(e.object,t),r&&r.call(e.object,e)},i._convertOutdoorsToGround(e),e.setupID(t),e instanceof Et?(t.parent=t.parent||this.app.root,e._setup(t)):e instanceof Buliding&&e._setup(t),e._originalSceneString){var n=ke._getStringMD5Code(e._originalSceneString);(Rn=function(e){var t=H.a;if(t){var i=t.sd5;if(i&&-1===i.indexOf(e))return!1}return!0}(n))||e.destroy()}},e.prototype.load=function(e,t){var i=this,r=this.app.confirmURL(t.url),n=r.appendPath("index.json");ke.parseValue(t.disableCache,!1)&&(n=n.appendRandomSuffix()),(t.fileloader||new THREE.FileLoader).load(n,(function(n){var o=JSON.parse(n);q?new xt(o.version).major<4?i.waitingLoadCampuses.push({owner:e,url:r,indexJson:o,params:t}):i.loadCampus(e,r,o,t):i.waitingLoadCampuses.push({owner:e,url:r,indexJson:o,params:t})}),(function(){}),(function(){var n=t.error||t.errorCallback;n&&n({url:r}),new An(i.app).getLoader().load({campus:e,url:r}).then((function(e){i._loadFinished(e,t)}))})),e.setupParent(t),t.skipSetupParent=!0},e.prototype._setupTypeMap=function(e){var t=e.typeMap;if(t)for(var i=0;i<t.length;i++){var r=t[i];ke.addCastType(r.type,r.condition,r.params)}},e.prototype._removeTypeMap=function(e){var t=e.typeMap;if(t)for(var i=0;i<t.length;i++){var r=t[i];ke.removeCastType(r.type,r.condition,r.params)}},e.prototype.loadCampus=function(e,t,i,r){var n=this,o=function(e,t){n._loadFinished(e,t),n.loadingCampus=!1,e.loaded=!0,setTimeout((function(){n.app.trigger("campusready",{object:e})}),500)};i.resourceLibrary=r.loadResourceUrl||i.resourceLibrary,i.enableUseHighestVersionResource=r.enableUseHighestVersionResource,i.startDownloadResourcesCallback=function(e,t){var i=n.app.onLoadModelResourceCallback;i&&i(e,t)},this.loadingCampus=!0,json2mesh.DefaultSetting.enableFloorLightMap=ke.parseValue(r.enableFloorLightMap,!1),r.indexJson=i,e.trigger(k.BeforeLoad,r),this.app.loadingProgressBar.prepare(),this._setupTypeMap(r),e.loading=!0;var a=new xt(i.version);if("BIM"==i.type){var s=i.resources||{},l=Object.keys(s);if(l.length)new THREE.IFCLoader(e).load(t.appendPath(l[0]).appendPath("/"),(function(t){t.angles=[-90,0,0],n.app.camera.autoFixCameraUp=!1,o(e,r)}),(function(e){n.app.loadingProgressBar.updateProgress(e)}))}else e._version=a,a.major<4?this.loadFromUBuilder(e,t,i,r,(function(){o(e,r)})):this.loadFromCampusBuildier(e,t,i,r,(function(){o(e,r)}))},e.prototype.update=function(){if(q&&!this.loadingCampus)if(ue=ue||c.toStr([96,201,170,234,66,62,13,241,82,4,65,42,195,156,129,103,23,224,109,153,106]),THING[ue]||Z){for(var e=0;e<this.waitingLoadCampuses.length;e++){var t=this.waitingLoadCampuses[e];this.loadCampus(t.owner,t.url,t.indexJson,t.params),this.waitingLoadCampuses.splice(e,1)}void 0!==Rn&&(Rn?this.app.trigger("sceneMD5CheckSuccessed"):this.app.trigger("sceneMD5CheckFailed"),Rn=void 0)}else if(!Cn){var i={t:(new Date).toUTCString(),v:Math.random()},r=JSON.stringify(i),n={"Content-type":"application/x-www-form-urlencoded"},o=c.toStr([96,201,174,231,66,51,32,235,92,3,108,33,253,138,129,102,17,202,118,180,116,65,157,101,253,161]),a=THING[o]||{};for(var s in a)n[s]=a[s];ne(r,n),Cn=!0}},e.prototype._buildCampusStructure=function(e,t){t.app=this.app,t.type=e.type,t.name=e.name?e.name:e.id,t.id=e.id?e.id:e.uuid,t.uuid=e.uuid,t.userData=e.userData,t.children=[],t.getAttribute=function(e){return ke.getAttribute(this,e)},t.getPath=function(){for(var e=this.id,t=this.parent;t&&t.parent&&t.parent.parent;)e=t.id+"/"+e,t=t.parent;return e},t._traverseObjects=function(e,t){for(var i=0;i<this.children.length;i++){var r=this.children[i];ke.isFunction(e)?e(r):ke.isArray(e)&&e.push(r),t&&r._traverseObjects(e,t)}},t.query=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[];this._traverseObjects(i,t);var r=new ct(this.app,i);return r.select(e),r};var i=0;e instanceof THING.Floor&&(i=1);for(var r=i;r<e.children.length;r++){var n=e.children[r],o={id:n.id,parent:t};t.children.push(o),this._buildCampusStructure(n,o)}},e.prototype._peekJSONBySimpleLoader=function(e,t,i){var r=i.complete,n=i.errorCallback||i.error,o=this;t.load(e).then((function(t){var i={url:e,id:t.id,children:[]};o._buildCampusStructure(t,i),t.destroy(),r&&r(i)})).catch((function(e){console.error(e),n&&n()}))},e.prototype.peekJSON=function(e,t){t=t||{};var i=(e=this.app.confirmURL(e)).appendPath("index.json");ke.parseValue(t.disableCache,!1)&&(i=i.appendRandomSuffix());var r=t.fileloader||new THREE.FileLoader,n=this;r.load(i,(function(i){var r=JSON.parse(i),o=new xt(r.version);4==o.major||(3==o.major?n._peekJSONBySimpleLoader(e,new mr(n.app),t):n._peekJSONBySimpleLoader(e,new fr(n.app),t))}),(function(){}),(function(){n._peekJSONBySimpleLoader(e,new fr(n.app),t)}))},e.prototype.onUpdate=function(e){this.update(e)},e}(),Pn=function(){function e(t){n(this,e),this.app=t}return e.prototype.combineCampus=function(e){var t=e.objects;t&&(e.objects=this._combineObjects(t))},e.prototype.combineFloor=function(e){var t=e.data,i=t.objects;i&&(t.objects=this._combineObjects(i))},e.prototype._combineObjects=function(e){var t=this.app,i={},r={},n={};e&&(Object.keys(e).forEach((function(t){e[t].forEach((function(e){o(e)}))})),Object.values(i).forEach((function(e){var t=r[e.type];t||(r[e.type]=t=[]),t.push(e)})),Object.values(n).forEach((function(e){e.destroy()})),n={});return r;function o(e,t,i){e&&("Region"==e.type?function(e,t,i){if(e){s(e,t),void 0!==t&&c(e),l(e);var r=e.fences,n=[];e.fences=n,r&&r.forEach((function(t){!0!==a(t,e,i)&&n.push(t)}))}}(e,t,i):"Fence"==e.type?a(e,t,i):"Group"==e.type?function(e,t,i){if(e)if(!0===i||!0===h(e)){s(e,t);var r=e.children;r&&r.forEach((function(t){o(t,e,!0)}))}else l(e)}(e,t,i):"RouteLine"==e.type||"Shape"==e.type?l(e):function(e,t,i){e&&(s(e,t),!0===i||!0===h(e)?u(e):l(e))}(e,t,i))}function a(e,t,i){var r=!1;return e&&(s(e,t),!0===i||!0===h(e)?(r=!0,u(e)):t||l(e)),r}function s(e,i){if(e){var r=e.rotation||[0,0,0,1],o=THING.Utils.parseAngles(new THREE.Quaternion(r[0],r[1],r[2],r[3])),a={type:"Thing",localPosition:e.position,angles:o};if(i){var s=n[i.uuid];s&&(a.parent=s)}var l=t.create(a);n[e.uuid]=l}}function l(e){var t=e.type,i=r[t];i||(r[t]=i=[]),i.push(e)}function u(e){var t=e.model;if(null!=t){var r=i[t];r||(i[t]=r=function(e){var t;if("Fence"==e.type)t={type:"BatchFence",model:e.model,children:[]};else{var i=e.tags;t=i&&i.indexOf("树")?{type:"BatchObject",model:e.model,children:[],tags:["树"]}:{type:"BatchObject",model:e.model,children:[]}}return t}(e)),c(e),r.children.push(e)}}function c(e){var t=e.uuid,i=n[t];i&&(e.position=i.position,e.rotation=ke.parseQuaternion(i.worldAngles).toArray())}function h(e){if(!1===function(e){return"Building"!=e&&"Region"!=e}(e.type))return!1;var t=e.id,i=e.name,r=e.userData,n=0;r&&(n=Object.keys(r).length);return!t&&!i&&n<=0}},e}(),jn={currVersion:"4.0.3",convertData:function(e,t){var i=new xt(jn.currVersion),r=new xt(t);if(r.modified<i.modified)for(var n=r.modified;n<i.modified;n++){var o=r.major+"."+r.minor+"."+n,a=Fn[o];a&&(e.data=a(e))}return e.data},convertData40:function(e){var t=e.dataType,i=e.data;if("floor"==t){var r=Object.keys(i);r.forEach((function(e){i[e].floors.forEach((function(e){var t=e.data.structure;t.walls.forEach((function(e){for(var t=0;t<e.points.length;t++)e.points[t]/=100;e.thickness=e.thickness/100,e.height=e.height})),t.rooms.forEach((function(e){for(var t=0;t<e.polygons.length;t++)for(var i=e.polygons[t],r=0;r<i.length;r++)i[r]=i[r]/100;e.textLoc=[e.textLoc[0]/100,e.textLoc[1]/100]})),t.doors.forEach((function(e){e.size=[e.size[0]/100,e.size[1]/100]})),t.windows.forEach((function(e){e.size=[e.size[0]/100,e.size[1]/100]}))}))}))}return i},convertData41:function(e){var t=e.dataType,i=e.data;if("campus"==t&&i){var r=i.objects.Building;r&&r.forEach((function(e){var t=e.facades;if(t){for(var i={},r=[],n=0;n<t.length;n++){var o=t[n];r.push(o)}i.children=r,i.scale=[1,1,1],e.facades=i}}))}return i},convertData42:function(e){var t=e.dataType,i=e.data;if("campus"==t&&i){var r=i.objects,n=r.Fence;delete r.Door;var o={};n&&n.forEach((function(e){var t=e.uuid;o[t]=e}));var a=r.Region;a&&a.forEach((function(e){var t=[],i=e.fences,r=e.position;i.forEach((function(e){var i=o[e];if(i){var n=i.position;i.position=[n[0]-r[0],n[1]-r[1],n[2]-r[2]],delete i.region,delete o[e],t.push(i)}})),e.repeatUV=[1,1],e.fences=t})),r.Fence=Object.values(o);var s=i.corners;s&&(n&&n.forEach((function(e){var t=s[e.start],i=s[e.end];e.start=t,e.end=i})),a&&a.forEach((function(e){e.points.forEach((function(e){if(e){var t=e.pos;e.pos=s[t]}}))})),delete i.corners)}return i},_areaSort:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i],n=Math.abs(THREE.ShapeUtils.area(r));t.push({area:n,index:i})}t=this.sortNumber(t,"area");for(var o=0;o<t.length;o++)t[o];return t},_getBetweenPoint:function(e,t,i){return t.clone().sub(e).multiplyScalar(i).add(e)}},Fn={"4.0.0":jn.convertData40,"4.0.1":jn.convertData41,"4.0.2":jn.convertData42},On=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._graph=null,r._expanded=!1,r._structShow=!1,r}return a(t,e),t.prototype._canAcceptMouseEvent=function(e){var t=e.type;return!!E[t]},t.prototype.canAcceptEvent=function(t){if(e.prototype.canAcceptEvent.call(this,t))return!0;var i=t.object;if(i&&i.isChildOf(this)){if(i.isFloor&&this._canAcceptMouseEvent(t))return!0;if(i.isFacade&&this._canAcceptMouseEvent(t))return!0;if(i.parent){if(i.parent.isFloor&&this._canAcceptMouseEvent(t))return!0;if(i.parent.isFacade&&this._canAcceptMouseEvent(t))return!0}}return!1},t.prototype._addFromCampus=function(e){if(e.buildings.length){this.floors.destroy();var t=e.buildings[0].floors,i=this;t.forEach((function(e){i.add(e)}))}},t.prototype.loadResource=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?e.prototype.loadResource.call(this,t):this.floors.forEach((function(e){e.loadResource(!1)}))},t.prototype.unloadResource=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?e.prototype.unloadResource.call(this,t):this.floors.forEach((function(e){e.unloadResource()}))},t.prototype.setupElevators=function(){var e={};for(var t in this.query(".ElevatorDoor").forEach((function(t){var i=t.userData._ELEVATOR_;e[i]||(e[i]=[]),e[i].push(t)})),e){var i=e[t];this.app.create({type:"Elevator",name:t,parent:this,doors:i})}},t.prototype.setupStairs=function(){this.query("[type=stairway]").forEach((function(e){e.floorNode.visible=!1}));var e={};for(var t in this.query(".StairDoor").forEach((function(t){var i=t.userData._STAIR_;e[i]=e[i]||[],e[i].push(t)})),e){var i=e[t];this.app.create({type:"Stair",name:t,parent:this,doors:i})}},t.prototype.canNavigation=function(){return!0},t.prototype.customSetup=function(e){this._structShow=ke.parseValue(e.structShow,this._structShow)},t.prototype.setupNavigationObjects=function(){this.setupElevators(),this.setupStairs()},t.prototype.setupGraph=function(){if(this._graph)return this._graph;var e={};return this.floors.forEach((function(t){t._setupNavigationGraph(e,1e4)})),this._graph=new Graph(e),this._graph},t.prototype.destroy=function(){this._graph=null,e.prototype.destroy.call(this)},t.prototype.hasAnyFacadesVisible=function(){for(var e=this.facades,t=0;t<e.length;t++)if(e[t].visible)return!0;return!1},t.prototype.hasFacades=function(){return 0!==this.facades.length},t.prototype.showAllRoofs=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.floors.forEach((function(t){t.showAllRoofs(e)}))},t.prototype.expandFloors=function(e){e=e||{},this.expandCmd||(this.expandCmd=this.app.commandManager.create({type:"ExpandObjects"})),e.objects=this.floors.objects,e.hideRoof=ke.parseValue(e.hideRoof,!0),this.expandCmd.setParam(e),this.expandCmd.execute(),this._expanded=!0},t.prototype.unexpandFloors=function(e){e=e||{},this.expandCmd&&(e.hideRoof&&(e.hideRoof=!e.hideRoof),this.expandCmd.setParam(e),this.expandCmd.undo(),this._expanded=!1)},t.prototype.showFacades=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Building] Please use '.facades.visible=true/false' to replace '.showFacades()'"),this.facades.visible=e},t.prototype.showFloors=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Building] Please use '.floors.visible=true/false' to replace '.showFloors()'"),this.floors.visible=e},t.prototype.showRoof=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Building] Please use '.showAllRoofs()' to replace '.showRoof()'"),this.showAllRoofs(e)},o(t,[{key:"isBuilding",get:function(){return!0}},{key:"structShow",get:function(){return this._structShow}},{key:"expanded",get:function(){return this._expanded}},{key:"facade",get:function(){return this.query(".Facade",!1)[0]}},{key:"facades",get:function(){return this.query(".Facade",!1)}},{key:"elevators",get:function(){return this.query(".Elevator",!1)}},{key:"stairs",get:function(){return this.query(".Stair",!1)}},{key:"floors",get:function(){return this.query(".Floor",!1)}},{key:"things",get:function(){return this.query(".Thing",!1)}}]),t}(bt),kn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._ceilingNode=null,r._ceilingObject=null,r._roofNode=null,r._roofObject=null,r._floorNode=null,r._floorObject=null,r._auxiliaryInfo=null,r._textRegion=null,r._holes=[],r._points=[],r}return a(t,e),t.prototype.setup=function(t){var i;(e.prototype.setup.call(this,t),this._holes=t.holes||[],this._points=t.points||[],this._ceilingNode=t.ceilingNode||this._ceilingNode,this._roofNode=t.roofNode||this._roofNode,this._auxiliaryInfo=t.auxiliaryInfo||this._auxiliaryInfo,this._floorNode=t.floorNode||this._floorNode,t.floorHideByScene&&this._floorNode)&&((i=this._floorNode.parent)&&(this.app.resourceManager.remove(this._floorNode),this._floorNode=new THREE.Group,i.add(this._floorNode)));t.roofHideByScene&&this._roofNode&&((i=this._roofNode.parent)&&(this.app.resourceManager.remove(this._roofNode),this._roofNode=new THREE.Group,i.add(this._roofNode)))},t.prototype.setupResources=function(t){e.prototype.setupResources.call(this,t),this._ceilingNode=t.ceilingNode||this._ceilingNode,this._roofNode=t.roofNode||this._roofNode,this._floorNode=t.floorNode||this._floorNode,this._ceilingNode&&this.ceiling&&(this._ceilingNode.visible=this.ceiling.visible,this.ceiling.node=this._ceilingNode),this._roofNode&&this.roof&&(this._roofNode.visible=this.roof.visible,this.roof.node=this._roofNode),this._floorNode&&this.plan&&(this._floorNode.visible=this.plan.visible,this.plan.node=this._floorNode)},t.prototype.getMode=function(e){return e.geometry instanceof THREE.ShapeGeometry?"xy":"xz"},t.prototype.getFloorMesh=function(){var e=this._floorNode;if(!e)return null;var t=e.getMeshes();return t.length?t[0]:null},t.prototype.getRoomHeight=function(){return 3},t.prototype.showGrid=function(t,i,r,n,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;e.prototype.showGrid.call(this,t,i,r,n,o,a);var s=ke.parseVector3(this.labelPosition);this._grid._setWorldPosition(s,!1,this.static)},t.prototype.getLabelPosition=function(e){var t=this.getFloorMesh();if(!t)return null;var i=t.getLabelPosition(e,this.getMode(t));return i?i.toArray():null},t.prototype.getAvaliablePositions=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!ke.isNumber(e))return null;var r=[];if(ke.isArray(t[0]))for(var n=0;n<e;n++){var o=t[n];r.push(o)}else for(n=0;n<e;n++)r.push(t);var a=this.getFloorMesh();if(!a)return null;var s=a.getAvaliableLabelPosition(r,this.getMode(a),i);if(!s)return null;for(n=0;n<s.length;n++)s[n]=s[n].toArray();return s},t.prototype.getRayCastPosition=function(e){if(!(e=ke.parseVector3(e)))return null;var t=this.getFloorMesh();if(!t)return null;var i=t.getRayCastPosition(e);return i?i.toArray():null},t.prototype.getPoints=function(e){},t.prototype._synTextRegion=function(){if(this._textRegion){var e=this._textRegion.position;if(this.style._volumeNode){var t=new THREE.Vector3;this.style._volumeNode.getWorldPosition(t),e[1]=t.y}else e[1]=this.position[1];e[1]+=.01,this._textRegion.position=e}},t.prototype.getNavigationMesh=function(){var e=this._floorNode;if(!e)return null;if(!this.area)return null;var t=e.getMeshes();return t.length?t[0]:null},t.prototype._getChildVisibles=function(){var e=this.children.concat([this.roof,this.ceiling,this.plan]),t=[];return e.forEach((function(e){e&&t.push(e.visible)})),t},t.prototype._setChildVisible=function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",r=this.children.concat([this.roof,this.ceiling,this.plan]),n=0;n<r.length;n++){var o=r[n];o&&(o.inheritVisible?o._setVisible(e,i):o._setVisible(t[n],i))}},t.prototype._getLinkableDoors=function(){var t=e.prototype._getLinkableDoors.call(this);return t.add(this.doors),t},t.prototype.showCeiling=function(e){console.warn("[Room] Please use '.ceiling.visible=true/false' to replace '.showCeiling()'"),this.ceiling.visible=e},t.prototype.showRoof=function(e){console.warn("[Room] Please use '.roof.visible=true/false' to replace '.showRoof()'"),this.roof.visible=e},t.prototype.showFloor=function(e){console.warn("[Room] Please use '.floorNode.visible=true/false' to replace '.showFloor()'"),this.floorNode.visible=e},t.prototype.showRoof=function(e){console.warn("[Room] Please use '.roof.visible=true/false' to replace '.showRoof()'"),this.roof.visible=e},t.prototype.setFloor=function(e){console.warn("[Room] Please use '.floorNode.style.' to replace '.setFloor()'"),e=e||{};var t=this.floorNode.style,i=e.color;i&&(t.color=i);var r=e.opacity;r&&(t.opacity=r)},t.prototype.getAvaliableFloorPos=function(e,t){return console.warn("[Room] Please use '.floor.getAvaliablePositions()' to replace '.getAvaliableFloorPos()'"),this.getAvaliablePositions(e,t)},o(t,[{key:"isRoom",get:function(){return!0}},{key:"labelPosition",get:function(){var e=this.getLabelPosition(null);if(e)return e;var t=this._auxiliaryInfo;return t&&t.center?t.center.toArray():null}},{key:"perimeter",get:function(){var e=this.points;return THING.Math.getPerimeter(e)}},{key:"area",get:function(){var e=this.points;return THING.Math.getArea(e)}},{key:"ceiling",get:function(){return!this._ceilingObject&&this._ceilingNode&&(this._ceilingObject=new cr(this.app)._init(this._ceilingNode)),this._ceilingObject}},{key:"roof",get:function(){return!this._roofObject&&this._roofNode&&(this._roofObject=new cr(this.app)._init(this._roofNode)),this._roofObject}},{key:"plan",get:function(){this._floorObject||this.getFloorMesh()&&(this._floorObject=new cr(this.app)._init(this.getFloorMesh()));return this._floorObject}},{key:"misc",get:function(){return this.miscObject||(this.miscObject=this.query(".CombinedObject").query("[userData/type=CombineMiscParent]")[0]),this.miscObject}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}},{key:"points",get:function(){var e,t=this;if(this._points.length)e=this._points.map((function(e){return t.selfToWorld(e.toArray())}));else{var i=this.getFloorMesh();if(!i)return null;e=i.getPoints(),this.holes.forEach((function(t){t.forEach((function(t){for(var i=0;i<e.length;i++){var r=e[i];THING.Math.equalsVector(t,r)&&e.splice(i--,1)}}))}))}for(var r=0;r<e.length-1;r++)THING.Math.equalsVector(e[r],e[r+1])&&e.splice(r--,1);return e}},{key:"things",get:function(){var e=this.parent;if(!e)return new ct(this.app,[]);for(var t=[],i=e.things,r=0;r<i.length;r++){var n=i[r];this.getRayCastPosition(n.position)&&t.push(n)}return this._children.forEach((function(e){e.isBatchSubObject&&t.push(e)})),new ct(this.app,t,!0).buildReturnObject(t).add(this.query(".Thing"))}},{key:"doors",get:function(){for(var e=this.floor.doors,t=[],i=0;i<e.length;i++){var r=e[i],n=1;r instanceof ci&&(n*=2);for(var o=new THREE.Vector3,a=ke.parseVector3(r.position),s=[ke.parseVector3(r.forward)],l=0;l<s.length;l++){var u=s[l];if(u.multiplyScalar(n),o.addVectors(a,u),this.getRayCastPosition(o)||(u.multiplyScalar(-n),o.addVectors(a,u),this.getRayCastPosition(o))){t.push(r);break}}}return new ct(this.app,t).buildReturnObject(t)}},{key:"textRegion",get:function(){return this._textRegion||(this._textRegion=this.app.create({type:"TextRegion",text:this.name,parent:this,position:this.labelPosition,angles:[-90,0,0]}),this._textRegion.translateY(.1),this._textRegion.renderOrder=1),this._synTextRegion(),this._textRegion},set:function(e){e?(this._textRegion=e,this._synTextRegion()):(this._textRegion.destroy(),this._textRegion=null)}},{key:"holes",get:function(){var e=[],t=this;return this._holes.forEach((function(i){var r=[];i.forEach((function(e){r.push(t.selfToWorld(e.toArray()))})),e.push(r)})),e}},{key:"floorIndex",get:function(){return console.warn("[Room] Please use '.floor.indexOfParent()' to replace '.floorIndex()'"),this.floor.indexOfParent()}},{key:"center",get:function(){return console.warn("[Room] Please use '.labelPosition' to replace '.center' or if you want to use .boundingBox.center to get center of boundingBox?"),this.labelPosition}},{key:"floorNode",get:function(){return console.warn("[Room] Please use '.plan' to replace '.floorNode'"),this.plan}}]),t}(bt),Ln=document.createElement("canvas");Ln.width=256,Ln.height=1;var Bn=Ln.getContext("2d");function Hn(e,t){var i=Bn.createLinearGradient(0,0,256,0);for(var r in e)i.addColorStop(+r,e[r]);Bn.fillStyle=i,Bn.fillRect(0,0,256,1);var n=new Uint8Array(Bn.getImageData(0,0,256,1).data.buffer);return void 0!==t?t.image={data:n,width:256,height:1}:t=new THREE.DataTexture(n,256,1),t.magFilter=t.minFilter=THREE.LinearFilter,t.needsUpdate=!0,t}var In=new Map,Nn=new Map,Un=new Map,Vn=function(){function e(){n(this,e)}return e.register=function(e,t){In.set(e,t),Nn.set(e,function(e){var t={};for(var i in e){var r=i.split("-"),n=r[0];t[n]||(t[n]={});var o=r[1];void 0===o||t[n][o]||(t[n][o]={});var a=r[2];void 0!==a&&(t[n][o][a]={})}return t}(t.class)),Un.set(e,function(e){var t=new Map;for(var i in e){var r=e[i].colormap;if(r){var n=void 0;t.has(i)&&(n=t.get(i)),t.set(i,Hn(r,n))}}return t}(t.class))},e.findStyle=function(e,t,i){if(!In.has(e)||!Nn.has(e))return console.warn("StyleManager: style '"+e+"' not registed."),null;if(i&&i._sfStyle){var r=i._sfStyle;return{style:In.get(e).class[r],colormap:Un.get(e).get(r)}}if(t&&i){var n=function(e,t,i){var r=t.type,n="";if(!e[r])for(var o in e)THING.Utils.instanceOf(t,o)&&(r=o);if(!e[r])return"";for(var a in e[r]){var s=t.tags;if("Facade"===r&&t.building&&(s=t.building.tags),s.indexOf(a)>-1&&""!==a){n=a;break}}if(!e[r][n])return r;for(var l in e[r][n])if(i.name===l)return r+"-"+n+"-"+i.name;return r+(""!==n?"-"+n:"")}(Nn.get(e),t,i);return{style:In.get(e).class[n],colormap:Un.get(e).get(n)}}return In.get(e)},e}();var zn=function(){function e(t){n(this,e),this.obj=t,this._renderOrder=0,this._opacity=null,this._color=null,this._outlineColor=null,this._alwaysOnTop=void 0,this._wireframe=!1,this._glow=!1,this._innerGlow=!1,this._image="",this._doubleSide=!1,this._uvAnimationParams=null,this._boundingBoxNode=null,this._orientedBoundingBoxNode=null,this._axisNode=null,this._vertexNormalNode=null,this._defaultOutlineColor=null,this._synStyle=null,this._inheritThemeName=null,this._themeName=null,this._edgeColor=null,this._edgeIncludeChildren=!0,this._edgeWireframes=new Map,this._emissive=null}return e.prototype._syn=function(){var e=this._synStyle;e&&(delete this._synStyle,e.execute())},e.prototype._setSynValue=function(e,t){return!this.obj.loaded&&(this._synStyle||(this._synStyle=this.obj.app.commandManager.create({type:"SetObjectStyle",object:this.obj})),this._synStyle.setAttribute(e,t),!0)},e.prototype._getSynValue=function(e){return this._synStyle?this.obj.loaded?null:this._synStyle.getAttribute(e):null},e.prototype._traverse=function(e){var t=[];this.obj.children.forEach((function(e){t.push(e.node)})),this.obj.node.traverseBranch((function(i){if(-1!==t.indexOf(i))return!1;i.userData.skipStyle||e(i)}))},e.prototype._onEnter=function(){},e.prototype._onLeave=function(){},e.prototype._changeMaterial=function(e){this._traverse((function(t){if(t.material){var i=t.material;ke.isArray(i)?t.material=i.map((function(i){return e(i,t)})):t.material=e(i,t)}}))},e.prototype._cloneAndModifyMaterial=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=function(e){return!e._mustClone&&(!t||!(!e._isCloned()||!e._getOriginal()))};this._changeMaterial((function(t,r){if(i(t))return e&&e(t._getPrevMaterial(),t,r),t;var n=t._pushAndCloneSelf();return e&&e(n._getPrevMaterial(),n,r),n}))},e.prototype.revertMaterial=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._changeMaterial((function(i){var r=t?i._getOriginal():i._getPrevMaterial();return r?(ke.parseValue(THING.needDisposeMaterial,!0)&&e.obj.app.materialDisposeManager.push(i),r):(ke.revertValue(i,"opacity"),ke.revertValue(i,"color"),ke.revertValue(i,"depthTest"),ke.revertValue(i,"depthWrite"),ke.revertValue(i,"onBeforeRender"),ke.revertValue(i,"wireframe"),ke.revertValue(i,"wireframeMap","map"),i)}))},e.prototype._applyTheme=function(e,t){var i=this;if(t||this._themeName!==e){if(this._themeName=e||null,this.removeEdgeWireframe(),null==this._themeName)return this.revertMaterial(!0),void this._setEffectRefCounts("smallGlow",!1);var r=this.opacity;this.opacity=null;var n=this.obj.app;this._cloneAndModifyMaterial((function(t,r,o){var a=Vn.findStyle(e,i.obj,o);if(a){var s=a.style,l=a.colormap;if(s&&(void 0===s.enable||s.enable)){var u=void 0!==s.opacity?s.opacity:1;void 0!==s.useColormap?r.colorMapping=s.useColormap?l:null:r.colorMapping=l,r.opacity=u,r.transparent=t.transparent||u<1,r._mustClone=!0;var c=s.reflection;c&&c.enable&&(r.envMap=function(e){qn||((qn=(new THREE.CubeTextureLoader).load([e+"/images/reflect1.jpg",e+"/images/reflect1.jpg",e+"/images/reflect1.jpg",e+"/images/reflect1.jpg",e+"/images/reflect1.jpg",e+"/images/reflect1.jpg"])).format=THREE.RGBFormat,qn.mapping=THREE.CubeReflectionMapping);return qn}(n.baseURL),r.envMapIntensity=1.5,r.metalness=c.metalness,r.roughness=c.roughness),r.emissiveIntensity=0,r.needsUpdate=!0}}})),this._traverse((function(t){if(t.geometry){var r=Vn.findStyle(e,i.obj,t);if(r){var o=r.style;if(o&&(void 0===o.enable||o.enable)){t.technique=t.technique||{},!!o.glow!=!!t.technique.smallGlow&&(o.glow?(t.technique.smallGlow=!0,n.sceneManager._updatEffectRefCounts("smallGlow",1)):(delete t.technique.smallGlow,n.sceneManager._updatEffectRefCounts("smallGlow",-1)));var a=o.wireframe.enable,s=o.wireframe.color,l=o.wireframe.glow,u=o.wireframe.opacity||.99;a&&i._setEdgeWireframe(t,l,s,u)}}}})),n.root.static&&n.scene._synMatrixWorld(),this.opacity=r,n.needUpdate=!0}},e.prototype.isNeedRevertMaterials=function(){return!this.isNeedCloneMaterials()},e.prototype.isNeedCloneMaterials=function(){return!ke.isNull(this._opacity)||(!ke.isNull(this._color)||(!!this._alwaysOnTop||(!!this._wireframe||!!this._image)))},e.prototype.setOpacity=function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];ke.isNumber(e)&&(e=THING.Math.clamp(e,0,1)),ke.isNull(this._opacity)&&ke.isNull(e)||e!=this._opacity&&(1==e&&ke.isNull(this._opacity)||(this._opacity=e,this.isNeedRevertMaterials()?this.revertMaterial():this._cloneAndModifyMaterial((function(e,i,r){var n=ke.isNull(t._opacity)?1:t._opacity;i.opacity=n*e.opacity,e.alphaTest&&(i.alphaTest=n*e.alphaTest);var o=i.transparent;i.transparent=e.transparent||i.opacity<1,o!=i.transparent&&(i.needsUpdate=!0)}),i)))},e.prototype.setColor=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){if(!(e=ke.parseColor(e)))return;this._color=e,this._cloneAndModifyMaterial((function(t,i,r){ke.backupValue(i,"color"),ke.backupValue(i,"colorMapping"),i.color=e,i.colorMapping=null,i.needsUpdate=!0}),t)}else{if(!this.color)return;this._color=null,this.isNeedRevertMaterials()?this.revertMaterial():this._changeMaterial((function(e,t){return ke.revertValue(e,"color"),ke.revertValue(e,"colorMapping"),e.needsUpdate=!0,e}))}},e.prototype.setOutlineColor=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(ke.isNull(e))this._outlineColor&&(this._setEffectRefCounts("outline_0x"+this._outlineColor.getHexString(),!1),this.obj.node.traverse((function(e){e.layers.disable(1),delete e.userData.forceOutline})),this._outlineColor=null),this._defaultOutlineColor&&this._setEffectRefCounts("outline_0x"+this._defaultOutlineColor.getHexString(),!0);else{this._outlineColor&&this._setEffectRefCounts("outline_0x"+this._outlineColor.getHexString(),!1);e=ke.parseColor(e);this._outlineColor=e,this._setEffectRefCounts("outline_0x"+e.getHexString(),!0),t&&(this.obj.node.ensureParentsVisible(!0),this.obj.node.visible=!0),this.obj.node.traverse((function(e){(t||e.ensureVisible())&&(e.isSprite||(e.layers.enable(1),t&&(e.visible=!0,e.userData.forceOutline=!0)))}))}this.obj.app.needEffectUpdate=!0},e.prototype.setDefaultOutlineColor=function(e){var t=ke.parseColor(e);t?(this._defaultOutlineColor=t,this.outlineColor||this._setEffectRefCounts("outline_0x"+t.getHexString(),!0),this.obj.app.needEffectUpdate=!0):(this._defaultOutlineColor=null,this._outlineColor||this._defaultOutlineColor||this._clearAllOutlineColor())},e.prototype.setSkipBoundingBox=function(e){this.obj.node.skipBoundingBox(e),this.obj.parents.forEach((function(e){e.boundingBoxControl.dirty=!0}))},e.prototype._setNodesAttribute=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._traverse((function(r){!r.isRenderable()&&i||(r.userData[e]=t)}))},e.prototype._setAlwaysOnTop=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((this.alwaysOnTop!=e||t)&&this.obj.node.parent)if(this._alwaysOnTop=e,e){this._cloneAndModifyMaterial((function(e,t,i){t.transparent=!0})),ke.backupValue(this.obj.node,"parent");var i=new THREE.MeshStandardMaterial({transparent:!0,opacity:1e-4}),r=new THREE.Mesh(new THREE.Geometry,i);r.name="AlwaysOnTopRootMesh",r.userData=ke.mergeObject({keepOutline:!0},this.obj.node.userData),r.frustumCulled=!1,r.renderOrder=THING.BaseStyle.cAlwaysOnTopRenderOrderID,r.onAfterRender=function(e){e.clearDepth()},this.obj.node.parent.add(r),this.obj.node.attachToParent(r,this.obj.app.scene,!0),this._traverse((function(e){ke.backupValue(e,"renderOrder"),e.renderOrder=r.renderOrder+1}))}else{this.isNeedRevertMaterials()?this.revertMaterial():this._changeMaterial((function(e,t){return ke.revertValue(e,"transparent"),e}));var n=ke.getValue(this.obj.node,"parent",!0),o=this.obj.node.parent;o.removeBySelf(),n.add(this.obj.node),this._traverse((function(e){return ke.revertValue(e,"renderOrder")}))}},e.prototype.setAlwaysOnTop=function(e){this._setSynValue("alwaysOnTop",e)||this._setAlwaysOnTop(e)},e.prototype.setBoundingBox=function(e,t){if(e){if(!this._boundingBoxNode){var i=this.obj.getLocalBoundingBox().toBox();this._boundingBoxNode=new THREE.Box3Helper(i,16777215),this._boundingBoxNode.frustumCulled=!1,this._boundingBoxNode.name=this.obj.name+"_BoundingBox",this._boundingBoxNode.skipBoundingBox(!0)}this._boundingBoxNode.material.color=ke.parseColor(t),this.obj.node.add(this._boundingBoxNode),this.obj.tickable=!0}else this.obj.app.resourceManager.remove(this._boundingBoxNode),this._boundingBoxNode=null;this._boundingBoxNode&&(this._boundingBoxNode.visible=e)},e.prototype.setOrientedBoundingBox=function(e,t){if(e){if(!this._orientedBoundingBoxNode){var i=this.obj.getLocalBoundingBox().toBox();this._orientedBoundingBoxNode=new THREE.Box3Helper(i,16777215),this._orientedBoundingBoxNode.frustumCulled=!1,this._orientedBoundingBoxNode.name=this.obj.name+"_OrientedBoundingBox",this._orientedBoundingBoxNode.skipBoundingBox(!0)}var r=this._orientedBoundingBoxNode.material;r.color=ke.parseColor(t,r.color),this.obj.node.add(this._orientedBoundingBoxNode),this.obj.tickable=!0}else this.obj.app.resourceManager.remove(this._orientedBoundingBoxNode),this._orientedBoundingBoxNode=null;this._orientedBoundingBoxNode&&(this._orientedBoundingBoxNode.visible=e)},e.prototype.setVertexNormalHelper=function(e){if(e){this.obj.node.updateMatrixWorld();var t=new THREE.Matrix4;t.getInverse(this.obj.node.matrixWorld),this._vertexNormalNode=new THREE.Group,this._vertexNormalNode.name=this.obj.name+"_VertexNormal",this._vertexNormalNode.applyMatrix(t);var i=this;this.obj.node.traverse((function(e){if(e.isMesh&&e.geometry){var t=new THREE.VertexNormalsHelper(e,1,16711680);i._vertexNormalNode.add(t)}})),this.obj.node.add(this._vertexNormalNode)}else this.obj.app.resourceManager.remove(this._vertexNormalNode),this._vertexNormalNode=null},e.prototype.setAxisHelper=function(e){if(e){this._axisNode=new THREE.AxesHelper(this.obj.boundingBox.radius),this._axisNode.name=this.obj.name+"_Axis";var t=this._axisNode.material;t.depthTest=!1,t.transparent=!0;var i=new THREE.Vector3;this.obj.node.getWorldScale(i),this._axisNode.scale.set(1/i.x,1/i.y,1/i.z),this.obj.node.add(this._axisNode)}else this.obj.app.resourceManager.remove(this._axisNode),this._axisNode=null},e.prototype._setEffectRefCounts=function(e,t){var i=this.obj.app.sceneManager;t?this._traverse((function(t){t.userData&&t.userData.skipOutline&&e.indexOf("outline")>-1||t.isLineSegments||(t.technique=t.technique||{},!0!==t.technique[e]&&(t.technique[e]=!0,i._updatEffectRefCounts(e,1)))})):this._traverse((function(t){t.technique&&t.technique[e]&&(delete t.technique[e],i._updatEffectRefCounts(e,-1))})),this.obj.app.needEffectUpdate=!0},e.prototype._clearAllOutlineColor=function(){var e=this.obj.app.sceneManager;this._traverse((function(t){if(t.technique)for(var i in t.technique)t.technique[i]&&i.indexOf("outline")>-1&&(delete t.technique[i],e._updatEffectRefCounts(i,-1))}))},e.prototype.setGlow=function(e){this._glow=e,this._setEffectRefCounts("glow",e)},e.prototype.setInnerGlow=function(e){this._innerGlow=e,this._setEffectRefCounts("innerGlow",e)},e.prototype.setEdgeWireframe=function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._edgeColor=ke.parseColor(e),this.removeEdgeWireframe(),null!=e&&this._traverse((function(e){t._setEdgeWireframe(e,i,t._edgeColor)}))},e.prototype._setEdgeWireframe=function(e,t,i){var r=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=this.obj.app.edgesGeometriesManager.getByObject(e,this.obj);if(null!==o)if(o.isBufferGeometry)this._createEdgeWireframe(o,i,t,n,e);else{var a=o.then((function(o){a._break||r._createEdgeWireframe(o,i,t,n,e)})).catch((function(e){0!==e.error&&console.warn(e.msg)}));this._edgeWireframes.set(e,a)}},e.prototype._createEdgeWireframe=function(e,t,i,r,n){var o=new THREE.LineSegments(e);return e.isInstancedBufferGeometry&&(o.material=new THREE.MeshLambertMaterial({lights:!0}),o.material.defines=o.material.defines||{},o.material.defines.INSTANCED="",o.frustumCulled=!1),o.name="wireframeNode"+t+i,o.material.color.set(t),o.material.opacity=r,o.material.transparent=r<1,o.renderOrder=n.renderOrder+.01,o.technique=o.technique||{},!!o.technique.smallGlow!=i&&(o.technique.smallGlow=i,this.obj.app.sceneManager._updatEffectRefCounts("smallGlow",i?1:-1)),this._edgeWireframes.set(n,o),n.add(o),o},e.prototype.removeEdgeWireframe=function(){var e=this;this._edgeWireframes.forEach((function(t){t.isObject3D?(t.technique&&t.technique.smallGlow&&(delete t.technique.smallGlow,e.obj.app.sceneManager._updatEffectRefCounts("smallGlow",-1)),e.obj.app.resourceManager.remove(t)):t._break=!0})),this._edgeWireframes.clear()},e.prototype.setImage=function(e){if(this.image!=e)if(e){var t=void 0;if(ke.isString(e)){var i=this.obj.app.confirmURL(e);if(this.image==i)return;this._image=i;var r=new THREE.TextureLoader;r.setCrossOrigin("anonymous"),t=r.load(i)}else e.width&&e.height&&(t=this.obj.app.resourceManager.loadTexture(e));if(!t)return;this._cloneAndModifyMaterial((function(e,i,r){ke.backupValue(i,"map"),i.map=t}))}else this._image="",this.isNeedRevertMaterials()?this.revertMaterial():this._changeMaterial((function(e,t){return ke.revertValue(e,"map"),e}))},e.prototype.flipOutlineColor=function(e){e=ke.parseColor(e).getHex();var t=this.outlineColor;this.outlineColor=t&&t==e?null:e},e.prototype.setLightMap=function(e){var t=(e=e||{}).intensity||0,i=ke.parseColor(e.color,new THREE.Color),r=e.image;r&&((r=(new THREE.TextureLoader).load(this.obj.app.confirmURL(r))).anisotropy=16),this._changeMaterial((function(e,n){e.lightMap=r,e.lightMapIntensity=t,e.color.copy(i),e.needsUpdate=!0}))},e.prototype.setMaterial=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this;if(e){var r=function(){e.completeWaitNumber>0&&--e.completeWaitNumber||(e.complete&&e.complete({object:i.obj}),i.obj.app.needUpdate=!0)},n=function(t,n,o){o=o||{};var a=ke.isString(o)?o:o.url;if(a){e.completeWaitNumber++;var s=(new THREE.TextureLoader).load(i.obj.app.confirmURL(a),(function(){r()}));if(s.anisotropy=16,u=ke.parseWrapType(o.wrap||o.wrapType))s.wrapT=u,s.wrapS=u;else{var l=t[n];l&&(s.wrapT=l.wrapT,s.wrapS=l.wrapS)}t[n]=s}else null===a&&(t[n]=null);var u,c=o.texture;c?(t[n]=c,(u=ke.parseWrapType(o.wrap||o.wrapType))&&(c.wrapT=u,c.wrapS=u)):null===c&&(t[n]=null)},o=function(e,t){var o=ke.parseColor(t.color);o&&e.color.copy(o);var a=t.image;if(a){t.completeWaitNumber++;var s=new THREE.TextureLoader;s.setCrossOrigin("anonymous"),(a=s.load(i.obj.app.confirmURL(a),(function(){r()}))).anisotropy=16;var l=ke.parseWrapType(t.wrap||t.wrapType);if(l)a.wrapT=l,a.wrapS=l;else{var u=e.map;u&&(a.wrapT=u.wrapT,a.wrapS=u.wrapS)}e.map=a}else null===a&&(e.map=null);var c=t.map;c?e.map=c:null===c&&(e.map=null),n(e,"map",t.diffuseMap),n(e,"emissiveMap",t.emissiveMap),n(e,"roughnessMap",t.roughnessMap),n(e,"roughnessMap",t.roughnessMap),n(e,"roughnessMap",t.roughnessMap),n(e,"lightMap",t.lightMap),n(e,"bumpMap",t.bumpMap),n(e,"aoMap",t.aoMap),n(e,"alphaMap",t.alphaMap),n(e,"displacementMap",t.displacementMap);var h=t.envMap;h?e.envMap=i.obj.app.resourceManager.loadCubeTexture(h,(function(){i.obj.app.needUpdate=!0})):null===h&&(e.envMap=null),e.envMapIntensity=ke.parseValue(t.envMapIntensity,e.envMapIntensity);var p=t.doubleSide;void 0!==p&&(e.side=p?THREE.DoubleSide:THREE.FrontSide),e.blending=ke.parseBlendingType(t.blending,e.blending),e.transparent=ke.parseValue(t.transparent,e.transparent),e.opacity=ke.parseValue(t.opacity,e.opacity);var d=ke.parseColor(t.emissive);e.emissive&&d&&e.emissive.copy(d),e.metalness=ke.parseValue(t.metalness,e.metalness),e.roughness=ke.parseValue(t.roughness,e.roughness),e.depthWrite=ke.parseValue(t.depthWrite,e.depthWrite),e.depthTest=ke.parseValue(t.depthTest,e.depthTest),e.needsUpdate=!0};e.completeWaitNumber=0;var a=e.index;this._cloneAndModifyMaterial((function(t,i,r){a&&ke.isArray(r.material)&&r.material.indexOf(i)!==a||o(i,e)}),t),this._processWithChildFunction("setMaterial",e)}else this.revertMaterial()},e.prototype.setPolygonOffset=function(e){e=e||{};var t=ke.parseValue(e.polygonOffset,!1),i=ke.parseValue(e.polygonOffsetFactor,0),r=ke.parseValue(e.polygonOffsetUnits,0);this._changeMaterial((function(e,n){return e.polygonOffset=t,e.polygonOffsetFactor=i,e.polygonOffsetUnits=r,e}))},e.prototype.setWireframe=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wireframe=e,e?this._cloneAndModifyMaterial((function(e,t,i){ke.backupValue(t,"wireframe"),ke.backupValue(t,"wireframeMap","map"),t.wireframe=!0,t.map=null}),t):this.isNeedRevertMaterials()?this.revertMaterial():this._changeMaterial((function(e,t){return ke.revertValue(e,"wireframe"),ke.revertValue(e,"wireframeMap","map"),e}))},e.prototype.setRenderOrder=function(e){this._renderOrder=e,ke.isNull(e)?this.obj.node.traverse((function(e){e.renderOrder<THING.BaseStyle.cAlwaysOnTopRenderOrderStart&&ke.revertValue(e,"renderOrder")})):this.obj.node.traverse((function(t){ke.backupValue(t,"renderOrder"),t.renderOrder>=THING.BaseStyle.cAlwaysOnTopRenderOrderStart?t.renderOrder=THING.BaseStyle.cAlwaysOnTopRenderOrderID+e:t.renderOrder=e})),this._edgeWireframes.forEach((function(t){t.isObject3D&&(t.renderOrder=e+.01)}))},e.prototype._setTextureUVAnimation=function(e){var t=this;ke.setValue(e,"updateMatrix",(function(){var i=t._uvAnimationParams,r=i.repeat||[1,1],n=i.center||[0,0],o=i.offset||[0,0],a=ke.parseValue(i.rotation,0);e.matrix.setUvTransform(o[0],o[1],r[0],r[1],a,n[0],n[1])}),!0)},e.prototype.setUVAnimation=function(e){if(this._uvAnimationParams=e,this._uvAnimationParams){this._cloneAndModifyMaterial((function(){}));var t=this._uvAnimationParams;t.wrapType=ke.parseWrapType(t.wrapType),t.offset=t.offset||[0,0],t.baseOffset=t.offset.concat();var i=ke.parseValue(t.rotation,0);t.baseRotation=i,t.rotation=0,t.offsetSpeed=t.speed||t.offsetSpeed,ke.isNumber(t.offsetSpeed)&&(t.offsetSpeed=[t.offsetSpeed,t.offsetSpeed]);var r=t.rotationSpeed||t.rotateSpeed;r&&(t.rotationSpeed=r),(i||r)&&(t.center=[.5,.5]),t.animation=ke.parseValue(t.animation,!0);var n=this;this.obj.node.traverseTextures((function(e,i,r){(r=r.clone()).needsUpdate=!0,e[i]=r,e.needsUpdate=!0,t.wrapType&&(ke.setValue(r,"wrapS",t.wrapType),ke.setValue(r,"wrapT",t.wrapType)),n._setTextureUVAnimation(r)})),this.obj.tickable=!0}else this.obj.node.traverseTextures((function(e,t,i){ke.revertValue(i,"wrapS"),ke.revertValue(i,"wrapT"),ke.revertValue(i,"updateMatrix")})),this.revertMaterial()},e.prototype.getUVAnimation=function(){return this._uvAnimationParams},e.prototype.hasUVAnimation=function(){return!!this._uvAnimationParams},e.prototype.update=function(e){var t=this._uvAnimationParams;if(t){if(!t.animation)return!1;var i=t.baseOffset,r=t.offsetSpeed;i&&r&&(t.offset[0]+=i[0]+e*r[0],t.offset[1]+=i[1]+e*r[1]);var n=t.baseRotation,o=t.rotationSpeed;return o&&(t.rotation+=n+e*o),!0}return!1},e.prototype._getStyleValue=function(e){var t=this._getSynValue(e);return t||this["_"+e]},e.prototype._getStyleColorValue=function(e){var t=this._getStyleValue(e);return t?ke.parseColor(t).toHexString():null},e.prototype._processAppUpdate=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.obj.visible){var t=this.obj.app;e?t.needUpdate=!0:t.rendererManager&&(t.rendererManager.needUpdate=!0)}},e.prototype._processWithValue=function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e.call(this,i),this.obj.children.forEach((function(e){e.inheritStyle&&(e.style[t]=i)})),this._processAppUpdate(r)},e.prototype._processWithChildFunction=function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.obj.children.forEach((function(i){if(i.inheritStyle){var r=i.style[e];ke.isFunction(r)&&r.call(i.style,t)}})),this._processAppUpdate(i)},e.prototype.isBaseStyle=function(){return!0},o(e,[{key:"renderOrder",set:function(e){this._processWithValue(this.setRenderOrder,"renderOrder",e)},get:function(){return this._getStyleValue("renderOrder")}},{key:"wireframe",set:function(e){this._processWithValue(this.setWireframe,"wireframe",e,!1)},get:function(){return this._getStyleValue("wireframe")}},{key:"opacity",set:function(e){this._setSynValue("opacity",e)||this._processWithValue(this.setOpacity,"opacity",e)},get:function(){var e=this._getStyleValue("opacity");return ke.isNull(e)?1:e}},{key:"color",set:function(e){this._setSynValue("color",e)||this._processWithValue(this.setColor,"color",e,!1)},get:function(){return this._getStyleColorValue("color")}},{key:"emissive",set:function(e){e=e||"#000000",this._emissive=ke.parseColor(e),this.setMaterial({emissive:e})},get:function(){return this._getStyleColorValue("emissive")}},{key:"roughness",set:function(e){this.setMaterial({roughness:e})}},{key:"outlineColor",set:function(e){this._setSynValue("outlineColor",e)||this._processWithValue(this.setOutlineColor,"outlineColor",e,!1)},get:function(){return this._getStyleColorValue("outlineColor")}},{key:"defaultOutlineColor",set:function(e){this._processWithValue(this.setDefaultOutlineColor,"defaultOutlineColor",e,!1)},get:function(){return this._getStyleColorValue("defaultOutlineColor")}},{key:"skipBoundingBox",set:function(e){this.setSkipBoundingBox(e)}},{key:"skipOutline",set:function(e){this._setNodesAttribute("skipOutline",e,!0),e&&(this._outlineColor=null,this._defaultOutlineColor=null,this._clearAllOutlineColor())}},{key:"skipStyle",set:function(e){this.obj.node.traverse((function(t){t.isRenderable()&&(t.userData.skipStyle=e)}))}},{key:"skipEnvMap",set:function(e){this._setNodesAttribute("skipEnvMap",e)}},{key:"glow",set:function(e){this._processWithValue(this.setGlow,"glow",e,!1)},get:function(){return this._getStyleValue("glow")}},{key:"innerGlow",set:function(e){this._processWithValue(this.setInnerGlow,"innerGlow",e,!1)},get:function(){return this._getStyleValue("innerGlow")}},{key:"vertexNormalHelper",set:function(e){this._processWithValue(this.setVertexNormalHelper,"vertexNormalHelper",e)},get:function(){return this._getStyleValue("vertexNormalHelper")}},{key:"axisHelper",set:function(e){this._processWithValue(this.setAxisHelper,"axisHelper",e)},get:function(){return!!this._axisNode&&this._axisNode.visible}},{key:"edgeColor",set:function(e){this._processWithValue(this.setEdgeWireframe,"edgeColor",e,!1)},get:function(){return this._getStyleColorValue("edgeColor")}},{key:"boundingBox",set:function(e){this.setBoundingBox(e,16777215)},get:function(){return!!this._boundingBoxNode&&this._boundingBoxNode.visible}},{key:"boundingBoxColor",set:function(e){this.setBoundingBox(!0,e)},get:function(){return this._boundingBoxNode?this._boundingBoxNode.material.color.toHexString():0}},{key:"orientedBoundingBox",set:function(e){this.setOrientedBoundingBox(e)},get:function(){return!!this._orientedBoundingBoxNode&&this._orientedBoundingBoxNode.visible}},{key:"orientedBoundingBoxColor",set:function(e){this.setOrientedBoundingBox(!0,e)},get:function(){return this._orientedBoundingBoxNode?this._orientedBoundingBoxNode.material.color.toHexString():0}},{key:"alwaysOnTop",set:function(e){this.setAlwaysOnTop(e)},get:function(){return!!this._getStyleValue("alwaysOnTop")}},{key:"image",set:function(e){this.setImage(e)},get:function(){return this._getStyleValue("image")}},{key:"doubleSide",set:function(e){this._doubleSide=e,this.setMaterial({doubleSide:e})},get:function(){return this._getStyleValue("doubleSide")}}]),e}();zn.cAlwaysOnTopRenderOrderStart=1e6,zn.cAlwaysOnTopRenderOrderID=2*zn.cAlwaysOnTopRenderOrderStart;var qn=void 0;var Wn=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t}(zn),Gn=26,Xn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._textColor=ke.parseColor("#1e90ff"),r._textSize=Gn,r._textLineWidth=65536,r._textLineHeight=20,r._textType="Arial",r._dropShadow=!0,r._dropShadowAlpha=1,r._dropShadowAngle=45,r._dropShadowBlur=1,r._dropShadowColor=ke.parseColor("#000000"),r._dropShadowDistance=2,r._strokeMode=!1,r}return a(t,e),o(t,[{key:"fontColor",set:function(e){this._textColor=ke.parseColor(e),this.obj.refreshTextMesh()},get:function(){return this._textColor.toHexString()}},{key:"fontSize",set:function(e){e&&(this._scale=e/Gn,this._textSize=e,this.obj.refreshTextMesh())},get:function(){return this._textSize}},{key:"fontType",set:function(e){this._textType=e,this.obj.refreshTextMesh()},get:function(){return this._textType}},{key:"dropShadow",set:function(e){this._dropShadow=e,this.obj.refreshTextMesh()},get:function(){return this._dropShadow}},{key:"dropShadowAlpha",set:function(e){this._dropShadowAlpha=e,this.obj.refreshTextMesh()},get:function(){return this._dropShadowAlpha}},{key:"dropShadowAngle",set:function(e){this._dropShadowAngle=e,this.obj.refreshTextMesh()},get:function(){return this._dropShadowAngle}},{key:"dropShadowBlur",set:function(e){this._dropShadowBlur=e,this.obj.refreshTextMesh()},get:function(){return this._dropShadowBlur}},{key:"dropShadowColor",set:function(e){this._dropShadowColor=ke.parseColor(e),this.obj.refreshTextMesh()},get:function(){return this._dropShadowColor.toHexString()}},{key:"dropShadowDistance",set:function(e){this._dropShadowDistance=e,this.obj.refreshTextMesh()},get:function(){return this._dropShadowDistance}},{key:"textLineWidth",set:function(e){this._textLineWidth=e,this.obj.refreshTextMesh()},get:function(){return this._textLineWidth}},{key:"textLineHeight",set:function(e){this._textLineHeight=e,this.obj.refreshTextMesh()},get:function(){return this._textLineHeight}},{key:"strokeMode",set:function(e){this._strokeMode=e,this.obj.refreshTextMesh()},get:function(){return this._strokeMode}}]),t}(Wn),Yn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._text="",r._factor=16/26*.1,r._keepSize=!1,r._useSpriteMaterial=!1,r._sizeAttenuation=!0,r._width=0,r._height=0,r._mesh=null,r._disableRefresh=!1,r}return a(t,e),t.prototype.isTextRegion=function(){return!0},t.prototype.setupContext=function(e){var t=this.style;if(e.font=this.style.fontSize.toString(10)+"px "+this.style.fontType,e.fillStyle=this.style.fontColor,e.textAlign="center",e.textBaseline="middle",t._dropShadow){var i=[t._dropShadowColor.r,t._dropShadowColor.g,t._dropShadowColor.b],r=THING.Math.degToRad(t._dropShadowAngle),n=t._dropShadowDistance*t._scale;e.shadowColor="rgba("+255*i[0]+","+255*i[1]+","+255*i[2]+","+t._dropShadowAlpha+")",e.shadowBlur=t._dropShadowBlur,e.shadowOffsetX=Math.cos(r)*n,e.shadowOffsetY=Math.sin(r)*n}else e.shadowColor=0,e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0},t.prototype.getTextRows=function(e,t,i,r,n){for(var o=t.split(""),a="",s=[],l=0;l<o.length;l++){var u=o[l];("\n"==u||e.measureText(a).width>=n)&&(s.push(a),a=""),a+=u}return s.push(a),s},t.prototype.drawText=function(e,t,i,r){for(var n=this.style.textLineHeight,o=0;o<r.length;o++)this.style.strokeMode?e.strokeText(r[o],t,i+o*n):e.fillText(r[o],t,i+o*n)},t.prototype.createTextMesh=function(){var e=document.createElement("canvas"),t=this.style.fontSize/72*96*2,i=Math.max(64,THING.Math.roundUpPowerOf2(t));this._pixelRatio=i/t/2;var r=e.getContext("2d");this.setupContext(r);for(var n=this.getTextRows(r,this._text,i/2,i/2,this.style.textLineWidth),o=n.length*t,a=0,s=0;s<n.length;s++)a=Math.max(a,n[0].length*t);var l=Math.max(i,THING.Math.roundUpPowerOf2(a)),u=Math.max(i,THING.Math.roundUpPowerOf2(o));i=Math.max(l,u),e.width=i,e.height=i,e.style.width=e.width+"px",e.style.height=e.height+"px",this.setupContext(r),this.drawText(r,e.width/2,e.height/2,n);var c=new THREE.Texture(e);c.minFilter=THREE.LinearFilter,c.magFilter=THREE.LinearFilter,c.generateMipmaps=!0,c.needsUpdate=!0;var h,p=i*this._factor;if(this._useSpriteMaterial){var d=new THREE.SpriteMaterial({map:c,transparent:!0,side:THREE.DoubleSide,depthWrite:!1});(h=new THREE.Sprite(d)).scale.set(p,p,1)}else{var f=new THREE.PlaneGeometry(p,p);d=new THREE.MeshBasicMaterial({map:c,transparent:!0,side:THREE.DoubleSide,depthWrite:!1});h=new THREE.Mesh(f,d)}return h.userData.skipBoundingBox=!0,h.userData.skipOutline=!0,h.userData.skipEnvMap=!0,h.userData.noBlending=!0,h.technique=h.technique||{},h.technique.glow="skip",h},t.prototype.refreshTextMesh=function(){if(!this._disableRefresh){this.app.resourceManager.remove(this._mesh),this._mesh=this.createTextMesh(),this._mesh.renderOrder=1,this.node.add(this._mesh);var e=this.getControl("TextRegionSizeAdjustmentControl");e&&(e.node=this._mesh),this.synSize()}},t.prototype._beforeSetupStyle=function(e){this._disableRefresh=!0},t.prototype._afterSetupStyle=function(e){this._disableRefresh=!1,this.refreshTextMesh()},t.prototype.customSetup=function(e){this._sizeAttenuation=ke.parseValue(e.sizeAttenuation,!0),this._disableRefresh=!0;var t=this.style;t.fontColor=ke.parseColor(e.textColor||e.fontColor||t.fontColor),t.fontSize=e.textSize||e.fontSize||t.fontSize,t.fontType=e.textType||e.fontType||t.fontType,t.textLineWidth=e.textLineWidth||e.fontLineWidth||t.textLineWidth,t.textLineHeight=e.textLineHeight||e.fontLineHeight||t.textLineHeight,t.strokeMode=e.storkeMode||t.strokeMode,this._text=e.text||e.fontText||this._text,this._factor=e.factor||this._factor,this._useSpriteMaterial=ke.parseValue(e.useSpriteMaterial,!1),this._width=ke.parseValue(e.width,this._width),this._height=ke.parseValue(e.height,this._height),this._disableRefresh=!1,this.refreshTextMesh(),this.node.skipBoundingBox(!0)},t.prototype.synSize=function(){var e=this._mesh;e&&this._width&&this._height&&(e.scale.set(this._width,this._height,1),this.synIndependentWorldScale())},o(t,[{key:"sizeAttenuation",get:function(){return this._sizeAttenuation}},{key:"text",set:function(e){this._text=e,this.refreshTextMesh()},get:function(){return this._text}},{key:"keepSize",set:function(e){if(this._keepSize!=e)if(this._keepSize=e,e){var t=ke.parseVector3(this.app.camera.position),i=60/this._mesh.getDistanceFromCamera(t);this._useSpriteMaterial&&(i*=this._mesh.scale.x);var r=this._sizeAttenuation?60:960,n=this._sizeAttenuation?[i,i]:[this._width,this._height];this.addControl(new ft(n,this._mesh,r),"TextRegionSizeAdjustmentControl"),this.synSize()}else this.removeControl("TextRegionSizeAdjustmentControl")},get:function(){return this._keepSize}},{key:"width",set:function(e){this._width=e,this.synSize()},get:function(){return this._width}},{key:"height",set:function(e){this._height=e,this.synSize()},get:function(){return this._height}},{key:"style",get:function(){return e.prototype._getStyle.call(this)}},{key:"textColor",set:function(e){console.warn('[TextRegion]Please use ".style.fontColor" to replace ".fontColor"'),this.style.fontColor=e},get:function(){return console.warn('[TextRegion]Please use ".style.fontColor" to replace ".fontColor"'),this.style.fontColor}},{key:"dropShadow",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadow" to replace ".dropShadow"'),this.style.dropShadow=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadow" to replace ".dropShadow"'),this.style.dropShadow}},{key:"dropShadowAlpha",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowAlpha" to replace ".dropShadowAlpha"'),this.style.dropShadowAlpha=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowAlpha" to replace ".dropShadowAlpha"'),this.style.dropShadowAlpha}},{key:"dropShadowAngle",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowAngle" to replace ".dropShadowAngle"'),this.style.dropShadowAngle=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowAngle" to replace ".dropShadowAngle"'),this.style.dropShadowAngle}},{key:"dropShadowBlur",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowBlur" to replace ".dropShadowBlur"'),this.style.dropShadowBlur=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowBlur" to replace ".dropShadowBlur"'),this.style.dropShadowBlur}},{key:"dropShadowColor",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowColor" to replace ".dropShadowColor"'),this.style.dropShadowColor=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowColor" to replace ".dropShadowColor"'),this.style.dropShadowColor}},{key:"dropShadowDistance",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowDistance" to replace ".dropShadowDistance"'),this.style.dropShadowDistance=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowDistance" to replace ".dropShadowDistance"'),this.style.dropShadowDistance}},{key:"textSize",set:function(e){console.warn('[TextRegion]Please use ".style.fontSize" to replace ".fontSize"'),this.style.fontSize=e},get:function(){return console.warn('[TextRegion]Please use ".style.fontSize" to replace ".fontSize"'),this.style.fontSize}},{key:"textLineWidth",set:function(e){console.warn('[TextRegion]Please use ".style.textLineWidth" to replace ".textLineWidth"'),this.style.textLineWidth=e},get:function(){return console.warn('[TextRegion]Please use ".style.textLineWidth" to replace ".textLineWidth"'),this.style.textLineWidth}},{key:"textLineHeight",set:function(e){console.warn('[TextRegion]Please use ".style.textLineHeight" to replace ".textLineHeight"'),this.style.textLineHeight=e},get:function(){return console.warn('[TextRegion]Please use ".style.textLineHeight" to replace ".textLineHeight"'),this.style.textLineHeight}},{key:"strokeMode",set:function(e){console.warn('[TextRegion]Please use ".style.strokeMode" to replace ".strokeMode"'),this.style.strokeMode=e},get:function(){return console.warn('[TextRegion]Please use ".style.strokeMode" to replace ".strokeMode"'),this.style.strokeMode}}]),t}(bt),Jn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._batchObject=null,r._lineCurve=null,r._startPoint=null,r._endPoint=null,r._doors=null,r._doors_self=null,r._collisionBox=null,r._models=[],r._modelSize=null,r._combineModel=[],r._fenceUpdating=!1,r._startVertex=null,r._endVertex=null,r._urlbak=null,r._batchObject_Batch=null,r._fencesData_Batch=null,r._modelSize_Batch=null,r}return a(t,e),t.prototype.loadFromURL=function(e,t){this._url=e.url,e.force=!0,this.setupParent(e),e.skipSetupParent=!0,e.BatchFence?this._setupModel_Batch(t):this._setupModel(t)},t.prototype.setupFromURL=function(e){if(e.node)this._setup(e);else{var t=this;this.loadFromURL(e,(function(){t._setup(e)}))}},t.prototype._beforeSetup=function(t){if(e.prototype._beforeSetup.call(this,t),t.BatchFence){if(this._fencesData_Batch=t.fencesData,this._fencesData_Batch)for(var i=0;i<this._fencesData_Batch.length;i++){var r=this._fencesData_Batch[i];if(r){var n=r.doors;n&&(r.doors=this.sortDoor(n))}}}else this._startPoint=t.startPoint,this._endPoint=t.endPoint,this._doors=t.doors,this.sortDoor()},t.prototype._setupModel=function(e){var t=this;function i(){var e=ke.parseVector2([t._startVertex.localPosition[0],t._startVertex.localPosition[2]]),i=ke.parseVector2([t._endVertex.localPosition[0],t._endVertex.localPosition[2]]);t._lineCurve=new THREE.LineCurve(e,i)}function r(){var e=[],i=t._lineCurve.getLength();if(t._doors&&t._doors.length>0){for(var r=null,n=0;n<t._doors.length;n++){var o=t._doors[n],a=o.width/i/2;if(r){var s=t._lineCurve.getPoint(r);u=t._lineCurve.getPoint(o.percent-a);e.push(new THREE.LineCurve(s,u))}else{var l=t._lineCurve.getPoint(0),u=t._lineCurve.getPoint(o.percent-a);e.push(new THREE.LineCurve(l,u))}r=o.percent+a}if(r<1){var c=t._lineCurve.getPoint(r),h=t._lineCurve.getPoint(1);e.push(new THREE.LineCurve(c,h))}}else e.push(t._lineCurve);for(var p=t._modelSize[0],d=0,f=[],m=0;m<e.length;m++){var g=e[m];d+=b=w(p,g.getLength()),f.push(b)}!function(e){if(e>0)for(var i=0;i<e;i++)t._models.push(t._batchObject.createSubObject({}));else if(e<0)for(var r=Math.abs(e)-1;r>=0;r--)t._models[r].destroy(),t._models.splice(r,1)}(d-t._models.length);for(var v=0,y=0;y<e.length;y++){var b,_=e[y],x=v+(b=f[y]);E(_,b,t._models.slice(v,x)),v=x}function E(e,i,r){for(var n=e.getLengths(i),o=e.getPoints(i),a=new THREE.Vector3(t._startPoint[0],0,t._startPoint[1]),s=new THREE.Vector3(t._endPoint[0],0,t._endPoint[1]).clone().sub(a).normalize(),l=null,u=0;u<r.length;u++){var c=r[u],h=null;l?(h=n[u+1]-l,l=n[u+1]):h=l=n[u+1];var d=new THREE.Vector3(o[u].x,0,o[u].y),f=new THREE.Vector3(o[u+1].x,0,o[u+1].y);f=d.clone().add(s.clone().multiplyScalar(h/2)),c.localPosition=[f.x,0,f.z];var m=new THREE.Quaternion;m.setFromUnitVectors(new THREE.Vector3(1,0,0),s);var g=new THREE.Euler;g.setFromQuaternion(m),c.angles=[THING.Math.radToDeg(g.x),THING.Math.radToDeg(g.y),THING.Math.radToDeg(g.z)],c.scale=[h/p,1,1]}}function w(e,t){var i=t/e,r=i%1;return i=Math.floor(i),r>.05&&(i+=1),i}}this._setupVertexNode(),this._url!=this._urlbak?(this._batchObject&&(this._batchObject.destroy(),this._batchObject=null),this._models=[],this._urlbak=this._url,this._batchObject=this.app.create({type:"BatchObject",url:this._url,parent:this,complete:function(n){t._batchObject=n.object,t._modelSize=n.object.boundingBox.initSize,i(),r(),t.trigger("updateFence",{initSize:t._modelSize,start:t.startPoint,end:t.endPoint}),e&&e()}})):(i(),r(),t.trigger("updateFence",{initSize:t._modelSize,start:t.startPoint,end:t.endPoint}),e&&e())},t.prototype._setupVertexNode=function(){this._startVertex&&this._startVertex.destroy(),this._endVertex&&this._endVertex.destroy(),this._startVertex=this.app.create({type:"Thing"}),this.add(this._startVertex),this._startVertex.localPosition=[this._startPoint[0],0,this._startPoint[1]],this._endVertex=this.app.create({type:"Thing"}),this.add(this._endVertex),this._endVertex.localPosition=[this._endPoint[0],0,this._endPoint[1]]},t.prototype.updateFence=function(e){if(this.loaded&&!this._fenceUpdating){this._fenceUpdating=!0;var t=this;this._setupModel((function(){t._fenceUpdating=!1,e&&e()}))}},t.prototype.sortDoor=function(e){var t=e||this._doors;if(t&&t.length>0)for(var i=0;i<t.length-1;i++)for(var r=0;r<t.length-1-i;r++)if(t[r].percent>t[r+1].percent){var n=t[r];t[r]=t[r+1],t[r+1]=n}return t},t.prototype.addDoor=function(e,t){this._doors||(this._doors=[]),this._doors.push({percent:e,width:t}),this.sortDoor()},t.prototype.removeDoor=function(e){for(var t=0;t<this._doors.length;t++){var i=this._doors[t];if(Math.abs(i.percent-e)<=.001)return this._doors.splice(t,1),!0}return!1},t.prototype.getDoor=function(e){if(this._doors)for(var t=0;t<this._doors.length;t++){var i=this._doors[t];if(i.percent-e<=.001)return ke.cloneObject(i)}return null},t.prototype.editDoor=function(e){if(this._doors&&e&&null!=e.percent){var t={};Object.assign(t,e);for(var i=0;i<this._doors.length;i++){var r=this._doors[i];if(Math.abs(r.percent-t.percent)<=.001)return void(this._doors[i]=t)}}},t.prototype._setupModel_Batch=function(e){var t=this;this._batchObject_Batch&&(this._batchObject_Batch.destroy(),this._batchObject_Batch=null),this._batchObject_Batch=this.app.create({type:"BatchObject",url:this._url,parent:this,complete:function(i){t._batchObject_Batch=i.object,t._modelSize_Batch=i.object.boundingBox.initSize,t._fencesData_Batch&&t._fencesData_Batch.forEach((function(e){var i=e.startPoint,r=e.endPoint,n=e.localPosition||[0,0,0],o=new THREE.Vector2(i[0]+n[0],i[1]+n[2]),a=new THREE.Vector2(r[0]+n[0],r[1]+n[2]);!function(e,i){var r=[],n=e.getLength();if(i&&i.length>0){for(var o=null,a=0;a<i.length;a++){var s=i[a],l=s.width/n/2;if(o){var u=e.getPoint(o);h=e.getPoint(s.percent-l),r.push(new THREE.LineCurve(u,h))}else{var c=e.getPoint(0),h=e.getPoint(s.percent-l);r.push(new THREE.LineCurve(c,h))}o=s.percent+l}if(o<1){var p=e.getPoint(o),d=e.getPoint(1);r.push(new THREE.LineCurve(p,d))}}else r.push(e);for(var f=t._modelSize_Batch[0],m=0,g=[],v=0;v<r.length;v++){var y=r[v],b=M(f,y.getLength());m+=b,g.push(b)}for(var _=function(e){var i=[];if(e>0)for(var r=0;r<e;r++)i.push(t._batchObject_Batch.createSubObject({}));return i}(m),x=0,E=0;E<r.length;E++){var w=r[E],T=(b=g[E],x+b),S=_.slice(x,T);A(w,b,S),x=T}function A(e,t,i){for(var r=e.getLengths(t),n=e.getPoints(t),o=new THREE.Vector3(e.v1.x,0,e.v1.y),a=new THREE.Vector3(e.v2.x,0,e.v2.y).clone().sub(o).normalize(),s=null,l=0;l<i.length;l++){var u=i[l],c=null;s?(c=r[l+1]-s,s=r[l+1]):c=s=r[l+1];var h=new THREE.Vector3(n[l].x,0,n[l].y),p=new THREE.Vector3(n[l+1].x,0,n[l+1].y);p=h.clone().add(a.clone().multiplyScalar(c/2)),u.localPosition=[p.x,0,p.z];var d=new THREE.Quaternion;d.setFromUnitVectors(new THREE.Vector3(1,0,0),a);var m=new THREE.Euler;m.setFromQuaternion(d),u.angles=[THING.Math.radToDeg(m.x),THING.Math.radToDeg(m.y),THING.Math.radToDeg(m.z)],u.scale=[c/f,1,1]}}function M(e,t){var i=t/e,r=i%1;return i=Math.floor(i),r>.05&&(i+=1),i}}(new THREE.LineCurve(o,a),e.doors)})),e&&e()}}),this._batchObject_Batch.canNotQueryFromSelector=!0},o(t,[{key:"worldStartPoint",get:function(){return[this._startVertex.position[0],this._startVertex.position[2]]},set:function(e){if(e instanceof Array&&e.length>=2){var t=[e[0]-this.position[0],e[1]-this.position[2]];this.startPoint=t}}},{key:"worldEndPoint",get:function(){return[this._endVertex.position[0],this._endVertex.position[2]]},set:function(e){if(e instanceof Array&&e.length>=2){var t=[e[0]-this.position[0],e[1]-this.position[2]];this.endPoint=t}}},{key:"startPoint",get:function(){return this._startPoint=[this._startVertex.localPosition[0],this._startVertex.localPosition[2]],this._startPoint},set:function(e){this._startVertex&&(this._startVertex.localPosition=[e[0],0,e[1]]),this._startPoint=e}},{key:"endPoint",get:function(){return this._endPoint=[this._endVertex.localPosition[0],this._endVertex.localPosition[2]],this._endPoint},set:function(e){this._endVertex&&(this._endVertex.localPosition=[e[0],0,e[1]]),this._endPoint=e}},{key:"fenceLength",get:function(){return this._lineCurve.getLength()}},{key:"doors",get:function(){return this._doors}},{key:"fenceUpdating",get:function(){return this._fenceUpdating}},{key:"url",get:function(){return this._url},set:function(e){this._url=e}},{key:"worldlineCurve",get:function(){var e=ke.parseVector2(this.worldStartPoint),t=ke.parseVector2(this.worldEndPoint);return new THREE.LineCurve(e,t)}},{key:"lineCurve",get:function(){var e=ke.parseVector2(this.startPoint),t=ke.parseVector2(this.endPoint);return this._lineCurve=new THREE.LineCurve(e,t),this._lineCurve}}]),t}(bt),Qn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._controlPoint=null,r._controlVertex=null,r}return a(t,e),t.prototype._beforeSetup=function(t){e.prototype._beforeSetup.call(this,t),this._controlPoint=t.controlPoint},t.prototype._setupModel=function(e){var t=this;!function(){for(var e=0;e<t._models.length;e++)t._models[e].destroy();t._models=[]}(),this._setupVertexNode(),this.app.create({type:"Thing",visible:!1,url:this._url,complete:function(i){t._modelSize=i.object.boundingBox.initSize,function(){var e=ke.parseVector2(t._startVertex.position),i=ke.parseVector2(t._controlVertex.position),r=ke.parseVector2(t._endVertex.position),n=new THREE.QuadraticBezierCurve(e,i,r);if(!t._lineCurve)return t._lineCurve=n,!0;var o=t._lineCurve.getLength(),a=n.getLength();if(o!=a)return t._lineCurve=n,!0}(),function(){var e=t._lineCurve.getLength(),i=t._modelSize[0],r=e/i,n=r%1;r=Math.floor(r),n>.1&&(r+=1);var o=r-t._models.length;(function(){if(o>0)for(var e=0;e<o;e++)t._models.push(t.app.create({url:t._url,type:"Thing",parent:t}));else if(o<0)for(var i=Math.abs(o)-1;i>=0;i--)t._models[i].destroy(),t._models.splice(i,1)})(),function(){for(var e=t._lineCurve.getLengths(r),n=t._lineCurve.getPoints(r),o=null,a=0;a<t._models.length;a++){var s=t._models[a],l=null;o?(l=e[a+1]-o,o=e[a+1]):l=o=e[a+1];var u=new THREE.Vector3(n[a].x,0,n[a].y),c=new THREE.Vector3(n[a+1].x,0,n[a+1].y),h=c.clone().sub(u).normalize();c=u.clone().add(h.clone().multiplyScalar(l/2)),s.position=[c.x,0,c.z],s.node.quaternion.setFromUnitVectors(new THREE.Vector3(1,0,0),h),s.scale=[l/i,1,1]}}()}(),e&&e()}})},t.prototype._setupVertexNode=function(){e.prototype._setupVertexNode.call(this),this._controlVertex&&this._controlVertex.destroy(),this._controlVertex=this.app.create({type:"Thing"}),this.add(this._controlVertex),this._controlVertex.localPosition=[this._controlPoint[0],0,this._controlPoint[1]]},o(t,[{key:"worldControlPoint",get:function(){return[this._startVertex.position[0],this._startVertex.position[2]]},set:function(e){if(e instanceof Array&&e.length>=2){var t=[e[0]-this.position[0],e[1]-this.position[2]];this.controlPoint=t}}},{key:"controlPoint",get:function(){return this._controlPoint=[this._controlVertex.localPosition[0],this._controlVertex.localPosition[2]],this._controlPoint},set:function(e){this._controlVertex&&(this._controlVertex.localPosition=[e[0],0,e[1]]),this._controlPoint=e}}]),t}(Jn),Zn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._points=[],r._shape=null,r._ground=null,r._level=1,r._repeatUV=[],r._vertexNode=[],r._textureUrl=null,!t.count||t.count<0?t.count=1:t.count=t.count+1,r}return a(t,e),t.prototype._setup=function(t){this._destroyGround(),this._points&&this._points.length>0&&(this._setupVertexNode(),this._setupShape(),this._createGround(),this._setupRepeatUV(),this._setupLevel()),e.prototype._setup.call(this,t)},t.prototype._beforeSetup=function(t){e.prototype._beforeSetup.call(this,t),this._points=t.points,this._repeatUV=t.repeatUV,this._level=t.level,this._url=t.url},t.prototype._setupGround=function(){this._destroyGround(),this._setupVertexNode(),this._setupShape(),this._createGround(),this._setupRepeatUV(),this._setupLevel()},t.prototype._setupTexture=function(){if(this._textureUrl!=this._url){this._textureUrl=this._url;var e=(new THREE.TextureLoader).load(this._url);e.wrapS=e.wrapT=THREE.RepeatWrapping,this._ground.material.map=e}},t.prototype._setupLevel=function(){var e=this._ground.material;e.polygonOffsetFactor=.5,e.polygonOffsetUnits=100*(1e3-this._level)},t.prototype._setupRepeatUV=function(){if(this._repeatUV&&this._repeatUV.length>0){var e=this._ground.material,t=1/this._repeatUV[0],i=1/this._repeatUV[1];e.map.repeat.fromArray([t,i]),e.map.wrapT=e.map.wrapS=THREE.RepeatWrapping}else{e=this._ground.material;this._repeatUV=[e.map.repeat.x,e.map.repeat.y]}},t.prototype._setupShape=function(){var e=this;if(this._vertexNode){for(var t=!1,i=0;i<this._vertexNode.length;i++){if(this._vertexNode[i].ratio>0){t=!0;break}}t?function(){e._shape=new THREE.Shape;for(var t=[],i=[],r=0;r<e._vertexNode.length;r++){var n=e._vertexNode[0==r?e._vertexNode.length-1:r-1],o=e._vertexNode[r],a=e._vertexNode[r==e._vertexNode.length-1?0:r+1];o.ratio>0?(t.push(g([n.localPosition[0],n.localPosition[2]],[o.localPosition[0],o.localPosition[2]],[a.localPosition[0],a.localPosition[2]],o.ratio)),i.push(!0)):(t.push({point:[o[0],o[2]]}),i.push(!1))}for(var s=null,l=0;l<t.length;l++){var u=t[l],c=t[l==t.length-1?0:l+1],h=i[l],p=i[l==i.length-1?0:l+1];if(0==l&&(h?(s=u.a,e._shape.moveTo(s[0],s[1])):(s=u.point,e._shape.moveTo(s[0],s[1]))),h){var d=u.b,f=u.c;e._shape.quadraticCurveTo(d[0],d[1],f[0],f[1]);var m=p?c.a:c.point;e._shape.lineTo(m[0],m[1])}else{m=p?c.a:c.point;e._shape.lineTo(m[0],m[1])}l==t.length-1&&e._shape.lineTo(s[0],s[1])}function g(e,t,i,r){var n=ke.parseVector2(e),o=ke.parseVector2(t),a=ke.parseVector2(i),s=o.distanceTo(n)/2,l=o.distanceTo(a)/2,u=o.clone().add(n.clone().sub(o).normalize().multiplyScalar(s*r)),c=o.clone().add(a.clone().sub(o).normalize().multiplyScalar(l*r));return{a:u.toArray(),b:t,c:c.toArray()}}}():function(){e._shape=new THREE.Shape;var t=e._vertexNode[0];e._shape.moveTo(t.localPosition[0],-t.localPosition[2]);for(var i=0;i<e._vertexNode.length;i++){var r=e._vertexNode[i==e._vertexNode.length-1?0:i+1];e._shape.lineTo(r.localPosition[0],-r.localPosition[2])}e._shape.lineTo(t.localPosition[0],-t.localPosition[2])}()}},t.prototype._setupVertexNode=function(){var e=this._points;if(this._vertexNode&&this._vertexNode.length>0)for(var t=0;t<this._vertexNode.length;t++){this._vertexNode[t].destroy()}this._vertexNode=[];for(var i=0;i<e.length;i++){var r=e[i],n=this.app.create({type:"Thing",name:"region_node"});this.add(n),n.ratio=r.ratio||0,n.localPosition=[r.pos[0],0,r.pos[1]],this._vertexNode.push(n)}},t.prototype._createGround=function(){var e=(new THREE.TextureLoader).load(this._url);e.wrapS=e.wrapT=THREE.RepeatWrapping;var t=new THREE.ShapeGeometry(this._shape);t.rotateX(-Math.PI/2);var i=new THREE.MeshLambertMaterial({map:e});i.polygonOffset=!0,this._ground=new THREE.Mesh(t,i),this._ground.receiveShadow=!0,this.node.add(this._ground),this._textureUrl=null},t.prototype._destroyGround=function(){this._ground&&(this.app.resourceManager.remove(this._ground),this._ground=null)},t.prototype.updateRegion=function(){this._setupGround(),this._setupTexture(),this._setupLevel(),this._setupRepeatUV()},t.prototype.getFencesData=function(){this._setupShape();for(var e=this._shape.curves,t=[],i=null,r=null,n=0;n<e.length;n++){var o=e[n];if(0==n)i=o;else if(n==e.length-1){if(0==o.getLength())return t;r=o}var a={};"LineCurve"==o.type?(a.startPoint=o.v1.toArray(),a.endPoint=o.v2.toArray(),a.type="Fence"):(a.startPoint=o.v0.toArray(),a.controlPoint=o.v1.toArray(),a.endPoint=o.v2.toArray(),a.type="CurveFence"),t.push(a)}a={};return"LineCurve"!=i.type?(a.endPoint=i.v0.toArray(),a.type="Fence"):(a.endPoint=i.v1.toArray(),a.type="Fence"),a.startPoint=r.v2.toArray(),t.push(a),t},t.prototype.getRayCastPosition=function(e){if(!(e=ke.parseVector3(e)))return null;var t=this._ground;if(!t)return null;var i=t.getRayCastPosition(e);return i?i.toArray():null},t.prototype.destroy=function(){e.prototype.destroy.call(this),--t.count},o(t,[{key:"isRegion",get:function(){return!0}},{key:"things",get:function(){var e=this.parents.query(".Campus")[0];if(!e)return new ct(this.app,[]);for(var t=[],i=e.things,r=0;r<i.length;r++){var n=i[r];this.getRayCastPosition(n.position)&&t.push(n)}var o=this.query(".Thing"),a=[];return o.forEach((function(e){"region_node"!=e.name&&a.push(e)})),new ct(this.app,t).buildReturnObject(t).add(a)}},{key:"repeatUV",get:function(){return this._repeatUV},set:function(e){this._repeatUV=e,this._setupRepeatUV()}},{key:"level",get:function(){return this._level},set:function(e){this._level=e,this._setupLevel()}},{key:"worldPoints",get:function(){for(var e=[],t=0;t<this._vertexNode.length;t++){var i=this._vertexNode[t];this._points[t].pos=[i.position[0],i.position[2]],e.push({pos:[i.position[0],i.position[2]],ratio:this.points[t].ratio})}return e},set:function(e){var t=this._vertexNode.length-e.length;if(t>0)for(var i=0;i<t;i++)this._vertexNode[0].destroy(),this._vertexNode.splice(0,1);else if(t<0){t=Math.abs(t);for(var r=0;r<t;r++)this._vertexNode.push(this.app.create({type:"Thing",parent:this}))}this._points=e;for(var n=0;n<this._vertexNode.length;n++){var o=this._vertexNode[n],a=e[n].pos;o.position=[a[0],this.position[1],a[1]],this._points[n]&&(this._points[n].pos=[o.localPosition[0],o.localPosition[2]])}}},{key:"points",get:function(){for(var e=0;e<this._vertexNode.length;e++){var t=this._vertexNode[e];this._points[e].pos=[t.localPosition[0],t.localPosition[2]]}return this._points},set:function(e){var t=this._vertexNode.length-e.length;if(t>0)for(var i=0;i<t;i++)this._vertexNode[0].destroy(),this._vertexNode.splice(0,1);else if(t<0){t=Math.abs(t);for(var r=0;r<t;r++)this._vertexNode.push(this.app.create({type:"Thing",parent:this}))}this._points=e;for(var n=0;n<this._vertexNode.length;n++){var o=this._vertexNode[n],a=e[n].pos;o.localPosition=[a[0],this.position[1],a[1]]}}},{key:"url",get:function(){return this._url},set:function(e){this._url!=e&&(this._url=e,this._setupTexture())}}]),t}(bt),Kn=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._points=[],r}return a(t,e),t.prototype._updateByPoints=function(){},t.prototype._createPolygonVertices=function(e){for(var t=[],i=0;i<this._points.length;i++){var r=this._points[i];t.push(new THREE.Vector3(r[0],r[2],r[1]))}THREE.ShapeUtils.isClockWise(t)||(t=t.reverse());var n=[],o=THREE.ShapeUtils.triangulateShape(t,[]);for(i=0;i<o.length;i++)n.push(new THREE.Face3(o[i][0],o[i][1],o[i][2]));for(i=0;i<t.length;i++){var a=t[i];if(!e){var s=a.z;a.z=a.y,a.y=s}}return{vertices:t,faces:n}},t.prototype._createPolygonGeometry=function(e,t){var i=new THREE.Geometry;return i.vertices=e,i.faces=t,i.genFaceVertexUVs(),i},t.prototype.clearPoints=function(){this._points=[],this._updateByPoints()},t.prototype.insertPoint=function(e,t){this._points.splice(e,0,this.worldToSelf(t)),this._updateByPoints()},t.prototype.setPoint=function(e,t){return!(e>=this._points.length)&&(!!t&&(this._points[e]=this.worldToSelf(t),this._updateByPoints(),!0))},t.prototype.getPoint=function(e){if(e>=this._points.length)return null;var t=this._points[e];return this.selfToWorld(t)},t.prototype.addPoint=function(e){return this._points.push(this.worldToSelf(e)),this._updateByPoints(),this._points.length-1},t.prototype._getPoints=function(e,t){this.node.updateWorldMatrix(!0,!1);for(var i=[],r=0;r<e.length;r++){var n=e[r];t==C.Local?n=this.localToSelf(n):t==C.World&&(n=this.worldToSelf(n)),i.push(n)}return i},t.prototype.getPointsCenterPos=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"world",i=this._getPoints(e,t);if(i.length<=2)return[0,0,0];for(var r=0,n=[!0,!0,!0],o=i[0].concat(),a=1;a<i.length;a++)for(var s=i[a],l=0;l<3;l++)if(!THING.Math.isFloatEquals(o[l],s[l])){n[l]=!1;break}var u=0,c=1,h=2;n[0]?(u=1,c=0,h=2):n[1]?(u=0,c=1,h=2):n[2]&&(u=0,c=2,h=1);var p=[];for(a=0;a<i.length;a++){r+=(s=i[a])[c],p.push([s[u],s[h]])}var d=new polylabel([p]);return n[0]?[r/i.length,d[0],d[1]]:n[1]?[d[0],r/i.length,d[1]]:n[2]?[d[0],d[1],r/i.length]:[0,0,0]},t.prototype.addPoints=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.World,i=this._getPoints(e,t);this._points=this._points.concat(i),this._updateByPoints()},t.prototype.removePoints=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._points.splice(e,t),this._updateByPoints()},t.prototype.inside=function(e){for(var t=this.planePoints,i=e[0],r=e[1],n=!1,o=0,a=t.length,s=a-1;o<a;s=o,o++){var l=t[o][0],u=t[o][1],c=t[s][0],h=t[s][1];if((l===i&&u===r||c===i&&h===r)&&(n=!n),u<r&&h>=r||u>=r&&h<r){var p=l+(r-u)*(c-l)/(h-u);p===i&&(n=!n),p>i&&(n=!n)}}return!!n},t.prototype.clearPathPoints=function(){console.warn("[PointsBase] Please use '.clearPoints()' to replace 'clearPathPoints()'"),this.clearPoints()},t.prototype.removePoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;console.warn("[LineBase] Please use '.removePoints' to replace '.removePoint'"),this.removePoints(e,t)},o(t,[{key:"points",get:function(){for(var e=[],t=0;t<this._points.length;t++){var i=this.selfToWorld(this._points[t]);e.push(i)}return e}},{key:"planePoints",get:function(){for(var e=[],t=0;t<this._points.length;t++){var i=this.selfToWorld(this._points[t]);e.push([i[0],i[2]])}return e}},{key:"area",get:function(){for(var e=[],t=0;t<this._points.length;t++){var i=this.selfToWorld(this._points[t]);e.push(new THREE.Vector2(i[0],i[2]))}var r=THREE.ShapeUtils.area(e);return Math.abs(r)}},{key:"centerPos",get:function(){return new polylabel([this.planePoints])}},{key:"avgHeight",get:function(){if(!this._points.length)return 0;for(var e=0,t=0;t<this._points.length;t++){e+=this._points[t][1]}return e/this._points.length}}]),t}(bt),$n=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._lineMesh=null,r._areaMesh=null,r._textRegion=null,r}return a(t,e),t.prototype._updateTextPosition=function(){if(this._textRegion){var e=this.centerPos;this._textRegion.position=[e[0],this.position.y,e[1]],this._textRegion.translateY(.01)}},t.prototype._updateByPoints=function(){if(!(this._points.length<3)){var e=new THREE.MeshBasicMaterial({color:this.style.regionColor,opacity:this.style.regionOpacity,transparent:!0,side:THREE.DoubleSide,depthWrite:!1}),t=this._createPolygonVertices(),i=this._createPolygonGeometry(t.vertices,t.faces);this.app.resourceManager.remove(this._areaMesh),this._areaMesh=new THREE.Mesh(i,e),this.node.add(this._areaMesh);var r=new THREE.LineBasicMaterial({color:this.style.lineColor});this.app.resourceManager.remove(this._lineMesh),(i=new THREE.Geometry).vertices=t.vertices,i.vertices.push(t.vertices[0]),this._lineMesh=new THREE.Line(i,r),this._lineMesh.userData.skipPick=!0,this.node.add(this._lineMesh)}},t.prototype._beforeSetupComplete=function(e){var t=e.points||e.vertices;if(t){if(!e.position&&!e.localPosition){var i=this.getPointsCenterPos(t);this.position=this.selfToWorld(i)}this.addPoints(t)}var r=e.fontText||e.text;r&&(this.text=r),ke.parseValue(e.alwaysOnTop,!0)&&(this.style.alwaysOnTop=!0);var n=this.style;n.lineColor=ke.parseColor(e.lineColor,n.lineColor),n.regionOpacity=ke.parseValue(e.regionOpacity||e.opacity,n.regionOpacity),n.regionColor=ke.parseColor(e.regionColor,n.regionColor)},o(t,[{key:"textRegion",get:function(){if(!this._textRegion){var e={type:"TextRegion",parent:this};this._textRegion=this.app.create(e),this._textRegion._mesh.renderOrder=1,this._textRegion.angleX=-90,this._textRegion.translateY(.1)}return this._textRegion}},{key:"text",set:function(e){this.textRegion.text=e,this._updateTextPosition()},get:function(){return this.textRegion.text}},{key:"style",get:function(){return e.prototype._getStyle.call(this)}},{key:"lineColor",set:function(e){console.warn('[PolygonRegion]Please use ".style.lineColor" to replace ".lineColor"'),this.style.lineColor=e},get:function(){return console.warn('[PolygonRegion]Please use ".style.lineColor" to replace ".lineColor"'),this.style.lineColor}},{key:"regionColor",set:function(e){console.warn('[PolygonRegion]Please use ".style.regionColor" to replace ".regionColor"'),this.style.regionColor=e},get:function(){return console.warn('[PolygonRegion]Please use ".style.regionColor" to replace ".regionColor"'),this.style.regionColor}},{key:"regionOpacity",set:function(e){console.warn('[PolygonRegion]Please use ".style.regionOpacity" to replace ".regionOpacity"'),this.style.regionOpacity=e},get:function(){return this.style.regionOpacity}}]),t}(Kn),eo=null;function to(){return eo||(eo=new THREE.Texture(SimpleHeatmap.getInstance().canvas())),eo}var io=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.node=new THREE.Object3D,r._map=null,r._tex=null,r._params={},r}return a(t,e),t.prototype._getMap=function(){return SimpleHeatmap.getInstance()},t.prototype._beforeSetup=function(e){this._map=this._getMap();var t=this._tex=new THREE.Texture(this._map.canvas()),i=void 0!==e.opacity?e.opacity:1,r=e.width||10,n=e.height||10,o=void 0;if(e.clipShape){var a=e.clipShape.shape.map((function(e){return(new THREE.Vector2).fromArray(e)})),s=new THREE.Shape(a);s.autoClose=!0,e.clipShape.holes&&(s.holes=e.clipShape.holes.map((function(e){return new THREE.Shape(e.map((function(e){return(new THREE.Vector2).fromArray(e)})))})));for(var l=(o=new THREE.ShapeBufferGeometry(s)).getAttribute("uv"),u=0,c=l.array.length;u<c;u+=2){var h=l.array[u+0],p=l.array[u+1];l.array[u+0]=(h+r/2)/r,l.array[u+1]=(p+n/2)/n}}else o=new THREE.PlaneGeometry(r,n);var d=void 0;e.mosaic?(d=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(ro.uniforms),vertexShader:ro.vertexShader,fragmentShader:ro.fragmentShader,transparent:!0,side:THREE.DoubleSide,opacity:i})).uniforms.tDiffuse.value=t:d=new THREE.MeshBasicMaterial({map:t,side:THREE.DoubleSide,transparent:!0,opacity:i}),this._material=d;var f=new THREE.Mesh(o,d);f.userData.skipEnvMap=!0,this.node.add(f),this._initParameter(e),this._refresh()},t.prototype._initParameter=function(e){var t=this._params;t.areaWidth=e.width||10,t.areaHeight=e.height||10,t.mapSize=e.mapSize||256,t.alpha=!!e.alpha,t.gradient=e.gradient||{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},t.minValue=e.minValue||10,t.maxValue=e.maxValue||50,t.radius=e.radius||.8,t.blur=e.blur||.8,t.data=e.data||[],t.mosaicSize=e.mosaicSize||t.mapSize/64},t.prototype.setParameter=function(e){var t=this._params;t.mapSize=e.mapSize||t.mapSize,t.alpha=void 0!==e.alpha?e.alpha:t.alpha,t.gradient=e.gradient||t.gradient,t.minValue=e.minValue||t.minValue,t.maxValue=e.maxValue||t.maxValue,t.radius=e.radius||t.radius,t.blur=e.blur||t.blur,t.data=e.data||t.data,t.mosaicSize=e.mosaicSize||t.mosaicSize,this._refresh()},t.prototype.addData=function(e){this._params.data.push(e),this._refresh()},t.prototype.setData=function(e){this._params.data=e,this._refresh()},t.prototype.setAlpha=function(e){this._params.alpha=e,this._refresh()},t.prototype.setRadius=function(e,t){this._params.radius=e,void 0!==t&&(this._params.blur=t),this._refresh()},t.prototype.setGradient=function(e){this._params.gradient=e,this._refresh()},t.prototype.randomData=function(){for(var e=this._params,t=[],i=0;i<Math.round(e.areaWidth*e.areaHeight);i++)t.push([(Math.random()-.5)*e.areaWidth,(Math.random()-.5)*e.areaHeight,Math.pow(Math.random(),3)*(e.maxValue-e.minValue)+e.minValue]);this.setData(t)},t.prototype._refresh=function(){var e=this._params,t=1,i=1,r=e.mapSize/e.areaWidth;e.areaWidth!=e.areaHeight&&(e.areaWidth>e.areaHeight?(t=1,i=e.areaHeight/e.areaWidth):(t=e.areaWidth/e.areaHeight,i=1,r=e.mapSize/e.areaHeight));var n=1;e.radius*r<1&&(n=1/e.radius*r+1e-4);var o=e.data.map((function(e){return[e[0]*n,e[1]*n,e[2]]})),a=Math.floor(e.mapSize*t),s=Math.floor(e.mapSize*i);this._map.setCanvasSize(a,s).setAreaSize(e.areaWidth*n,e.areaHeight*n).min(e.minValue).max(e.maxValue).alpha(e.alpha).gradient(e.gradient).radius(Math.floor(e.radius*r*n),Math.floor(e.blur*r*n)).data(o).draw(),this._tex.needsUpdate=!0,to().needsUpdate=!0,this.app.renderer.copyTextureToTexture(new THREE.Vector2,to(),this._tex),this._material.isShaderMaterial&&(this._material.uniforms.texSize.value.set(a,s),this._material.uniforms.mosaicSize.value.set(e.mosaicSize,e.mosaicSize))},o(t,[{key:"isHeatmap",get:function(){return console.warn("[Heatmap] Please use 'instanceof THING.Heatmap' to replace '.isHeatmap'"),this instanceof THING.Heatmap}}]),t}(bt),ro={uniforms:{tDiffuse:{value:null},texSize:{value:new THREE.Vector2(640,640)},mosaicSize:{value:new THREE.Vector2(16,16)}},vertexShader:"\n\t\t#include <common>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\tvarying vec2 vUV;\n        void main() {\n\t\t\tvUV = uv;\n\t\t\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\t\t\tgl_Position = projectionMatrix * mvPosition;\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <fog_vertex>\n        }\n    ",fragmentShader:"\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\n        uniform sampler2D tDiffuse;\n\n        uniform vec2 texSize;\n        uniform vec2 mosaicSize;\n\n        varying vec2 vUV;\n\n        void main(void) {\n\t\t\tvec4 originColor = texture2D(tDiffuse, vUV);\n\n\t\t\tif (originColor.a < 0.0001) discard;\n\n\t\t\t#include <logdepthbuf_fragment>\n\n            vec2 xy = vec2(vUV.x * texSize.x, vUV.y * texSize.y);\n            \n            vec2 xyMosaic = vec2(floor(xy.x / mosaicSize.x) * mosaicSize.x, \n                    floor(xy.y / mosaicSize.y) * mosaicSize.y )\n                    + .5*mosaicSize;\n            \n            vec2 delXY = xyMosaic - xy;\n            float delL = length(delXY);\n            \n            vec2 uvMosaic = vec2(xyMosaic.x / texSize.x, xyMosaic.y / texSize.y);\n\n            float percent = smoothstep(0., 1., 1. - delL * 2.4 / mosaicSize.x) * 0.7 + 0.3;\n\n            vec4 centerColor = texture2D(tDiffuse, uvMosaic);\n            \n            vec4 resultColor = vec4(mix(originColor.rgb, centerColor.rgb, percent), centerColor.a * percent);\n            \n\t\t\tgl_FragColor = resultColor;\n\t\t\t\n\t\t\t#include <fog_fragment>\n        }\n    "};io.PointMosaicShader=ro;var no=null;function oo(){return no||(no=new THREE.Texture(SimpleIDW.getInstance().canvas())),no}var ao=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype._getMap=function(){return SimpleIDW.getInstance()},t.prototype._initParameter=function(e){var t=this._params;t.areaWidth=e.width||10,t.areaHeight=e.height||10,t.mapSize=e.mapSize||256,t.alpha=!!e.alpha,t.gradient=e.gradient||{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},t.minValue=e.minValue||0,t.maxValue=e.maxValue||50,t.radius=e.radius||10,t.blur=e.blur||.8,t.data=e.data||[],t.exp=e.exp||3,t.cellSize=e.cellSize||10,t.opacity=e.opacity||1,t.mosaicSize=e.mosaicSize||t.mapSize/64},t.prototype._refresh=function(){var e=this._params,t=1,i=1,r=e.mapSize/e.areaWidth;e.areaWidth!=e.areaHeight&&(e.areaWidth>e.areaHeight?(t=1,i=e.areaHeight/e.areaWidth):(t=e.areaWidth/e.areaHeight,i=1,r=e.mapSize/e.areaHeight));var n=1;e.radius*r<1&&(n=1/e.radius*r+1e-4);var o=e.data.map((function(e){return[e[0]*n,e[1]*n,e[2]]})),a=Math.floor(e.mapSize*t),s=Math.floor(e.mapSize*i);this._map.setCanvasSize(a,s).setAreaSize(e.areaWidth*n,e.areaHeight*n).min(e.minValue).max(e.maxValue).alpha(e.alpha).gradient(e.gradient).opacity(e.opacity).cellSize(e.cellSize).exp(e.exp).radius(e.radius).data(o)._redraw(),this._tex.needsUpdate=!0,oo().needsUpdate=!0,this.app.renderer.copyTextureToTexture(new THREE.Vector2,oo(),this._tex),this._material.isShaderMaterial&&(this._material.uniforms.texSize.value.set(a,s),this._material.uniforms.mosaicSize.value.set(e.mosaicSize,e.mosaicSize))},t}(io),so=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.pathTexture=null,r.pathWidth=1,r.pathCornerRadius=.3,r.pathCornerSplit=10,r.pathScrollUV=!1,r.pathScrollSpeed=1,r.pathRepeat=[1,1],r.rotateScrollDirection=!1,r.pathPlayingTween=null,r.pathUp=new THREE.Vector3(0,1,0),r.pathPointList=null,r.pathGeometry=null,r.pathLine=null,r.pathMaterial=new THREE.MeshBasicMaterial({transparent:!0}),r}return a(t,e),t.prototype.synPathTexture=function(e){this.pathTexture=e,e.repeat.fromArray(this.pathRepeat),this.pathLine&&(this.pathLine.material.map=this.pathTexture,this.pathLine.material.needsUpdate=!0)},t.prototype._setupPoints=function(e){var t=e.points;if(t){var i=e.spaceType,r=e.local;if(!i&&r&&(i=SpaceType.Local),t.forEach((function(e,i){e.isVector3&&(t[i]=e.toArray())})),!e.position&&!e.localPosition){var n=this.getPointsCenterPos(t,i);this.position=this.selfToWorld(n)}this.addPoints(t,i)}},t.prototype._setupPathLine=function(e){this.scrollUV=ke.parseValue(e.scrollUV,!1),this.uvRatio=e.uvRatio||1,this.width=ke.parseValue(e.width,this.width),this.side=ke.parseValue(e.side,"both"),this.close=ke.parseValue(e.close,!1);var t=ke.parseValue(e.doubleSide,!0);this.pathMaterial.side=t?THREE.DoubleSide:THREE.FrontSide;var i=ke.parseValue(e.drawMode,THREE.TriangleStripDrawMode);this.pathLine=new THREE.Mesh(this.pathGeometry,this.pathMaterial),this.pathLine.drawMode=i;var r=e.image;r&&(this.style.image=r)},t.prototype._addPathLine=function(){this.node.add(this.pathLine)},t.prototype._beforeSetupComplete=function(e){this._setupPathLine(e),this._setupPoints(e),this._addPathLine()},t.prototype._updateByPoints=function(){this.node.updateWorldMatrix(!0,!1),this._points.length>=2&&this.pathPointList.set(this._points.map((function(e){return(new THREE.Vector3).fromArray(e)})),this.pathCornerRadius,this.pathCornerSplit,this.pathUp,this.close)},t.prototype.updatePath=function(e){if(this.pathScrollUV&&this.pathTexture){var t=this.pathScrollSpeed*e;return this.rotateScrollDirection?this.pathTexture.offset.y-=t:this.pathTexture.offset.x-=t,!0}return!1},t.prototype.update=function(t){var i=e.prototype.update.call(this,t);return i|=this.updatePath(t)},t.prototype.play=function(e){var t=(e=e||{}).time||1e3,i=ke.parseValue(e.startProgress,0),r=ke.parseValue(e.endProgress,1),n=e.lerpType||A.Linear.None,o=e.complete,a=this,s={progress:i},l={progress:r};this.pathPlayingTween=new TWEEN.Tween(s).to(l,t).easing(n).onUpdate((function(){a.pathGeometry.update(a.pathPointList,{width:a.pathWidth,radius:a.pathWidth,arrow:!!a.arrowFlag,progress:this._object.progress})})).onComplete((function(){o&&o.call(a)})).start()},t.prototype.stop=function(){this.pathPlayingTween&&(this.pathPlayingTween.stop(),this.pathPlayingTween=null)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.image=this.image,t.scrollUV=this.scrollUV,t.points=this.points,t},t.prototype._setupResources=function(e){this.pathLine&&(this.pathLine.material=this.pathMaterial,this._addPathLine())},t.prototype.unloadResource=function(){e.prototype.unloadResource.call(this),this.clearPoints()},o(t,[{key:"imageRepeat",set:function(e){this.pathRepeat[0]=e[0],this.pathRepeat[1]=e[1],this.pathTexture&&this.pathTexture.repeat.fromArray(this.pathRepeat)},get:function(){return[this.pathRepeat[0],this.pathRepeat[1]]}},{key:"imageScroll",set:function(e){this.pathScrollUV=e,this.tickable=!0},get:function(){return this.pathScrollUV}},{key:"imageScrollSpeed",set:function(e){this.pathScrollSpeed=THING.Math.clamp(e,-99,99)},get:function(){return this.pathScrollSpeed}},{key:"useTexture",set:function(e){var t=this.pathLine.material;t.map=e?this.pathTexture:null,t.needsUpdate=!0},get:function(){return null!==this.pathLine.material.map}},{key:"width",set:function(e){this.pathWidth=e,this._updateByPoints()},get:function(){return this.pathWidth}},{key:"cornerRadius",set:function(e){this.pathCornerRadius=e,this._updateByPoints()},get:function(){return this.pathCornerRadius}},{key:"cornerSegments",set:function(e){this.pathCornerSplit=e,this._updateByPoints()},get:function(){return this.pathCornerSplit}},{key:"length",get:function(){if(this._points.length<=1)return 0;for(var e=0,t=this._points[0],i=1;i<this._points.length;i++){var r=this._points[i];e+=THING.Math.getDistance(r,t),t=r}return e}},{key:"cornerSplit",set:function(e){console.warn("[LineBase] Please use '.cornerSegments' to replace '.cornerSplit'"),this.cornerSegments=e},get:function(){return console.warn("[LineBase] Please use '.cornerSegments' to replace '.cornerSplit'"),this.cornerSegments}},{key:"uvRatio",set:function(e){this.pathTexture&&(this.pathTexture.repeat.x=1/e)}},{key:"scrollUV",set:function(e){this.pathScrollUV=e,this.tickable=!0},get:function(){return this.pathScrollUV}},{key:"scrollSpeed",set:function(e){this.pathScrollSpeed=THING.Math.clamp(e/10,-99,99)},get:function(){return 10*this.pathScrollSpeed}}]),t}(Kn),lo=function(){function e(t){n(this,e),this.app=t,this._points=[]}return e.prototype.set=function(e,t,i,r){this._points=e},o(e,[{key:"vertices",get:function(){for(var e=[],t=0;t<this._points.length;t++)e.push(ke.parseVector3(this._points[t]));return e}}]),e}(),uo=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.dotNode=null,r.pathGeometry=new THREE.BufferGeometry,r.pathGeometry.update=function(e,t){},r.dotGeometry=null,r.dotMaterial=null,r.pathPointList=new lo,r}return a(t,e),t.prototype._updateByPoints=function(){e.prototype._updateByPoints.call(this);var t=this.pathPointList.vertices;t.length&&(this.pathGeometry.setFromPoints(t),this.pathLine.computeLineDistances(),this.dotGeometry&&this.dotGeometry.setFromPoints(t),this.node.setFrustumCulled(!1))},t.prototype._setupPathLine=function(e){var t,i=e.style||{},r=e.lineOpacity||1,n=ke.parseValue(e.lineDashSize||i.lineDashSize,0),o=ke.parseValue(e.lineGapSize||i.lineGapSize,0),a=e.lineWidth||1,s=e.color||255,l=this.pathPointList.vertices;t=n||o?new THREE.LineDashedMaterial({color:s,opacity:r,dashSize:n,gapSize:o,linewidth:a,transparent:!0}):new THREE.LineBasicMaterial({color:s,opacity:r,linewidth:a,transparent:!0}),this.pathGeometry.setFromPoints(l),this.pathLine=new THREE.Line(this.pathGeometry,t),this.pathLine.computeLineDistances();var u=e.dotColor||16777215,c=e.dotSize;c&&(this.dotGeometry=(new THREE.BufferGeometry).setFromPoints(l),this.dotMaterial=new THREE.PointsMaterial({color:u,size:c,sizeAttenuation:!1}),this.dotNode=new THREE.Points(this.dotGeometry,this.dotMaterial),this.node.add(this.dotNode))},t.prototype.showLines=function(e){this.pathLine.visible=e},t.prototype.showPoints=function(e){this.dotNode.visible=e},o(t,[{key:"isLine",get:function(){return console.warn("[Line] Please use 'instanceof THING.Line' to replace '.isLine'"),this instanceof THING.Line}}]),t}(so),co=function(){this.pos=new THREE.Vector3,this.dir=new THREE.Vector3,this.right=new THREE.Vector3,this.up=new THREE.Vector3,this.dist=0,this.widthScale=1};co.prototype.lerpPathPoints=function(e,t,i){this.pos.lerpVectors(e.pos,t.pos,i),this.dir.lerpVectors(e.dir,t.dir,i),this.up.lerpVectors(e.up,t.up,i),this.right.lerpVectors(e.right,t.right,i),this.dist=(t.dist-e.dist)*i+e.dist,this.widthScale=(t.widthScale-e.widthScale)*i+e.widthScale},co.prototype.copy=function(e){this.pos.copy(e.pos),this.dir.copy(e.dir),this.up.copy(e.up),this.right.copy(e.right),this.dist=e.dist,this.widthScale=e.widthScale};var ho=function(){this.array=[],this.count=0};ho.prototype.set=function(e,t,i,r,n){if((e=e.slice(0)).length<2)return this.count=0,void console.warn("PathPointList: points length less than 2.");t=void 0!==t?t:.1,i=void 0!==i?i:10,(n=void 0!==n&&n)&&!e[0].equals(e[e.length-1])&&e.push((new THREE.Vector3).copy(e[0]));for(var o=0,a=e.length;o<a;o++)if(0===o)this._start(e[o],e[o+1],r);else if(o===a-1)if(n){this._corner(e[o],e[1],t,i,r);var s=this.array[0].dist;this.array[0].copy(this.array[this.count-1]),this.array[0].dist=s}else this._end(e[o]);else this._corner(e[o],e[o+1],t,i,r)},ho.prototype.distance=function(){return 0==this.count?0:this.array[this.count-1].dist},ho.prototype._start=function(e,t,i){this.count=0;var r=this._getByIndex(this.count);if(r.pos.copy(e),r.dir.subVectors(t,e),i)r.up.copy(i);else{var n=Number.MAX_VALUE,o=Math.abs(r.dir.x),a=Math.abs(r.dir.y),s=Math.abs(r.dir.z);o<n&&(n=o,r.up.set(1,0,0)),a<n&&(n=a,r.up.set(0,1,0)),s<n&&r.up.set(0,0,1)}r.right.crossVectors(r.dir,r.up).normalize(),r.up.crossVectors(r.right,r.dir).normalize(),r.dist=0,r.widthScale=1,r.dir.normalize(),this.count++};var po=new THREE.Vector3,fo=new THREE.Vector3,mo=new THREE.Vector3,go=new THREE.Matrix4,vo=new THREE.QuadraticBezierCurve3;ho.prototype._corner=function(e,t,i,r,n){if(i>0&&r>0){for(var o=this.array[this.count-1],a=this._getCornerBezierCurve(o.pos,e,t,i,vo).getPoints(r),s=0;s<r;s+=1)this._hardCorner(a[s],a[s+1],n);a[r].equals(t)||this._hardCorner(a[r],t,n)}else this._hardCorner(e,t,n)},ho.prototype._hardCorner=function(e,t,i){var r=this.array[this.count-1],n=this._getByIndex(this.count),o=po.subVectors(e,r.pos),a=fo.subVectors(t,e),s=o.length();if(o.normalize(),a.normalize(),n.pos.copy(e),n.dir.addVectors(o,a),n.dir.normalize(),i)1===n.dir.dot(i)?n.right.crossVectors(a,i).normalize():n.right.crossVectors(n.dir,i).normalize(),n.up.crossVectors(n.right,n.dir).normalize();else{n.up.copy(r.up);var l=mo.crossVectors(r.dir,n.dir);if(l.length()>Number.EPSILON){l.normalize();var u=Math.acos(Math.min(Math.max(r.dir.dot(n.dir),-1),1));n.up.applyMatrix4(go.makeRotationAxis(l,u))}n.right.crossVectors(n.dir,n.up).normalize()}n.dist=r.dist+s;var c=o.dot(a);n.widthScale=Math.min(1/Math.sqrt((1+c)/2),1.414213562373)||1,this.count++},ho.prototype._end=function(e){var t=this.array[this.count-1],i=this._getByIndex(this.count);i.pos.copy(e),i.dir.subVectors(e,t.pos);var r=i.dir.length();i.dir.normalize(),i.up.copy(t.up);var n=po.crossVectors(t.dir,i.dir);if(n.length()>Number.EPSILON){n.normalize();var o=Math.acos(Math.min(Math.max(t.dir.dot(i.dir),-1),1));i.up.applyMatrix4(go.makeRotationAxis(n,o))}i.right.crossVectors(i.dir,i.up).normalize(),i.dist=t.dist+r,i.widthScale=1,this.count++},ho.prototype._getByIndex=function(e){return this.array[e]||(this.array[e]=new co),this.array[e]},ho.prototype._getCornerBezierCurve=function(e,t,i,r,n){var o=po.subVectors(t,e),a=fo.subVectors(i,t),s=o.length(),l=a.length();return o.normalize(),a.normalize(),s>r?n.v0.copy(t).sub(o.multiplyScalar(r)):n.v0.copy(e),n.v1.copy(t),l>r?n.v2.copy(t).add(a.multiplyScalar(r)):n.v2.copy(i),n};var yo=function(){this._drawing=!1,this._includeDrawingPoint=!1,this._points=[],this._lastPoint=new THREE.Vector3,this._lastFixedPoint=new THREE.Vector3,this.fixRadius=.5,this.height=.1,this._cornerRadius=.2,this._cornerSplit=10,this._pathPointList=new ho,this._dirty=!0,this.up=new THREE.Vector3(0,1,0)};Object.defineProperty(yo.prototype,"cornerRadius",{set:function(e){this._cornerRadius=e,this._dirty=!0},get:function(){return this._cornerRadius}}),Object.defineProperty(yo.prototype,"cornerSplit",{set:function(e){this._cornerSplit=e,this._dirty=!0},get:function(){return this._cornerSplit}}),yo.prototype.getPoints=function(){if(this._includeDrawingPoint&&(this._points.pop(),this._includeDrawingPoint=!1),this._drawing&&this._points.length>0){var e=this._getLastFixedPoint();e&&(this._points.push(e),this._includeDrawingPoint=!0)}return this._points},yo.prototype.getPathPointList=function(){return(this._drawing||this._dirty)&&(this._pathPointList.set(this.getPoints(),this._cornerRadius,this._cornerSplit,this.up),this._dirty=!1),this._pathPointList},yo.prototype.update=function(e){this._lastPoint.copy(e),this._lastPoint.y+=this.height},yo.prototype.confirm=function(){this._drawing=!0;var e=this._getLastFixedPoint();e&&(this._includeDrawingPoint&&(this._points.pop(),this._includeDrawingPoint=!1),this._points.push(e.clone())),this._dirty=!0},yo.prototype.start=function(){this._drawing=!0,this._dirty=!0},yo.prototype.stop=function(){this._drawing=!1,this._dirty=!0},yo.prototype.clear=function(){this._drawing=!1,this._includeDrawingPoint=!1,this._points=[],this._dirty=!0};var bo=new THREE.Vector3;var _o=new THREE.Vector3,xo=new THREE.Vector3;yo.prototype._getLastFixedPoint=function(){if(this._lastFixedPoint.copy(this._lastPoint),this._points.length>0){var e=this._includeDrawingPoint?this._points[this._points.length-2]:this._points[this._points.length-1];if(function(e,t){return bo.copy(t).sub(e).length()}(e,this._lastFixedPoint)<this.fixRadius&&(bo.normalize().multiplyScalar(this.fixRadius),this._lastFixedPoint.copy(e).add(bo)),this._includeDrawingPoint?this._points.length>2:this._points.length>1){var t=this._includeDrawingPoint?this._points[this._points.length-3]:this._points[this._points.length-2];if(_o.subVectors(e,t),xo.subVectors(this._lastFixedPoint,e),_o.normalize(),xo.normalize(),_o.multiplyScalar(-1).dot(xo)>.99)return null}}return this._lastFixedPoint};var Eo=function(e){THREE.BufferGeometry.call(this),e=e||3e3,this.setAttribute?(this.setAttribute("position",new THREE.BufferAttribute(new Float32Array(3*e),3).setUsage(THREE.DynamicDrawUsage)),this.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*e),3).setUsage(THREE.DynamicDrawUsage)),this.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(2*e),2).setUsage(THREE.DynamicDrawUsage))):(this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(3*e),3).setDynamic(!0)),this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*e),3).setDynamic(!0)),this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(2*e),2).setDynamic(!0))),this.drawRange.start=0,this.drawRange.count=0};Eo.prototype=Object.assign(Object.create(THREE.BufferGeometry.prototype),{constructor:Eo,update:function(e,t){t=t||{};var i=this._updateAttributes(e,t);this.drawRange.count=i},_resizeAttribute:function(e,t,i){for(;t.array.length<i;){var r=t.array.length,n=new THREE.BufferAttribute(new Float32Array(2*r),t.itemSize,t.normalized);n.name=t.name,n.usage=t.usage,this.setAttribute?this.setAttribute(e,n):this.addAttribute(e,n),t=n}},_updateAttributes:function(e,t){var i=t.width||.1,r=void 0!==t.progress?t.progress:1,n=void 0===t.arrow||t.arrow,o=void 0!==t.side?t.side:"both",a=0,s=[],l=[],u=[],c=new THREE.Vector3,h=new THREE.Vector3;function p(e,t,i){e.dir;var r=e.up,n=e.right;"left"!==o?c.copy(n).multiplyScalar(t*e.widthScale):c.set(0,0,0),"right"!==o?h.copy(n).multiplyScalar(-t*e.widthScale):h.set(0,0,0),c.add(e.pos),h.add(e.pos),s.push(h.x,h.y,h.z,c.x,c.y,c.z),l.push(r.x,r.y,r.z,r.x,r.y,r.z),u.push(i,0,i,1),a+=2}var d=new THREE.Vector3;var f=e.distance();if(0==f)return 0;var m,g=r*f;if(g>0)for(var v=0;v<e.count;v++){var y=e.array[v];if(y.dist>g){var b=e.array[v-1];m=new co;var _=(g-b.dist)/(y.dist-b.dist);m.lerpPathPoints(b,y,_),p(m,i/2,m.dist/("both"!==o?i/2:i));break}p(y,i/2,y.dist/("both"!==o?i/2:i))}else m=e.array[0];n&&function(e,t,i){var r=e.dir,n=e.up,p=e.right;"left"!==o?c.copy(p).multiplyScalar(2*t):c.set(0,0,0),"right"!==o?h.copy(p).multiplyScalar(2*-t):h.set(0,0,0),d.copy(r).setLength(3*t),c.add(e.pos),h.add(e.pos),d.add(e.pos),s.push(h.x,h.y,h.z,c.x,c.y,c.z,d.x,d.y,d.z),l.push(n.x,n.y,n.z,n.x,n.y,n.z,n.x,n.y,n.z),u.push(i,"both"!==o?"right"!==o?-2:0:-.5,i,"both"!==o?"left"!==o?2:0:1.5,i+3*t/("both"!==o?t:2*t),"both"!==o?0:.5),a+=3}(m=m||e.array[e.count-1],i/2,m.dist/("both"!==o?i/2:i));var x=this.getAttribute("position"),E=this.getAttribute("normal"),w=this.getAttribute("uv");return this._resizeAttribute("position",x,s.length),this._resizeAttribute("normal",E,l.length),this._resizeAttribute("uv",w,u.length),x=this.getAttribute("position"),E=this.getAttribute("normal"),w=this.getAttribute("uv"),x.array.set(s,0),E.array.set(l,0),w.array.set(u,0),x.updateRange.count=s.length,E.updateRange.count=l.length,w.updateRange.count=u.length,x.needsUpdate=!0,E.needsUpdate=!0,w.needsUpdate=!0,a}});var wo=function(e){Eo.call(this,e||1e3),this.setIndex(new Array(2*(e||1e3)))};wo.prototype=Object.assign(Object.create(Eo.prototype),{constructor:wo,_resizeIndex:function(e,t){for(;e.array.length<t;){var i=e.array.length,r=new THREE.BufferAttribute(2*i>65535?new Uint32Array(2*i):new Uint16Array(2*i),1);r.name=e.name,r.usage=e.usage,this.setIndex(r),e=r}},_updateAttributes:function(e,t){var i=t.radius||.1,r=t.radialSegments||8;r=Math.max(2,r);var n=t.startRad||0,o=void 0!==t.progress?t.progress:1,a=0,s=[],l=[],u=[],c=[],h=0,p=new THREE.Vector3;function d(e,t,i,r){for(var o=0===s.length,d=0;d<=i;d++){var f=d;f==i&&(f=0),p.copy(e.up).applyAxisAngle(e.dir,n+2*Math.PI*f/i).normalize(),s.push(e.pos.x+p.x*t*e.widthScale,e.pos.y+p.y*t*e.widthScale,e.pos.z+p.z*t*e.widthScale),l.push(p.x,p.y,p.z),u.push(r,d/i),h++}if(!o)for(var m=h-2*(i+1),g=h-(i+1),v=0;v<i;v++)c.push(g+v,m+v,m+v+1,g+v,m+v+1,g+v+1),a+=6}var f=o*e.distance();if(0==f)return 0;if(f>0)for(var m=0;m<e.count;m++){var g=e.array[m];if(g.dist>f){var v=e.array[m-1],y=new co,b=(f-v.dist)/(g.dist-v.dist);y.lerpPathPoints(v,g,b),d(y,i,r,y.dist/(2*i*Math.PI));break}d(g,i,r,g.dist/(2*i*Math.PI))}var _=this.getAttribute("position"),x=this.getAttribute("normal"),E=this.getAttribute("uv"),w=this.getIndex();return this._resizeAttribute("position",_,s.length),this._resizeAttribute("normal",x,l.length),this._resizeAttribute("uv",E,u.length),this._resizeIndex(w,c.length),_=this.getAttribute("position"),x=this.getAttribute("normal"),E=this.getAttribute("uv"),w=this.getIndex(),_.array.set(s,0),x.array.set(l,0),E.array.set(u,0),w.set(c,0),_.updateRange.count=s.length,x.updateRange.count=l.length,E.updateRange.count=u.length,w.updateRange.count=c.length,_.needsUpdate=!0,x.needsUpdate=!0,E.needsUpdate=!0,w.needsUpdate=!0,a}});var To=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.arrowFlag=!0,r.side="both",r.pathGeometry=new Eo,r.pathPointList=new ho,r}return a(t,e),t.prototype._updateByPoints=function(){e.prototype._updateByPoints.call(this),this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,side:this.side,arrow:this.arrowFlag}),this.pathGeometry.computeBoundingSphere()},t.prototype.setup=function(t){var i=ke.parseValue(t.arrowFlag,t.arrowCap);this.arrowFlag=ke.parseValue(i,!0),e.prototype.setup.call(this,t)},o(t,[{key:"progress",set:function(e){this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,arrow:this.arrowFlag,side:this.side,progress:THING.Math.clamp(e,0,1)})}},{key:"scorllUVRange",set:function(e){var t=this.length/this.pathWidth;this.uvRatio=t*e}},{key:"arrowCap",set:function(e){this.arrowFlag=e,this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,arrow:this.arrowFlag,side:this.side})},get:function(){return this.arrowFlag}},{key:"isRouteLine",get:function(){return!0}}]),t}(so),So=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.pathWidth=.2,r.pathRadialSegments=8,r.pathStartRad=0,r.pathGeometry=new wo,r.pathPointList=new ho,r.pathUp=void 0,r.pathMaterial=new THREE.MeshStandardMaterial({transparent:!0}),r}return a(t,e),t.prototype._setupPathLine=function(t){(t=t||{}).drawMode=THREE.TrianglesDrawMode,e.prototype._setupPathLine.call(this,t)},t.prototype._updateByPoints=function(){e.prototype._updateByPoints.call(this),this.pathGeometry.update(this.pathPointList,{radius:this.pathWidth,radialSegments:this.pathRadialSegments,startRad:this.pathStartRad}),this.pathGeometry.computeBoundingSphere()},o(t,[{key:"progress",set:function(e){this.pathGeometry.update(this.pathPointList,{radius:this.pathWidth,radialSegments:this.pathRadialSegments,progress:THING.Math.clamp(e,0,1),startRad:this.pathStartRad})}},{key:"scorllUVRange",set:function(e){var t=this.length/(2*this.pathWidth*Math.PI);this.uvRatio=t*e}},{key:"isPolygonLine",get:function(){return!0}}]),t}(so),Ao=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._pointSize=1,r._pointsMesh=null,r}return a(t,e),t.prototype._updateByPoints=function(){this.app.resourceManager.remove(this._pointsMesh);var e=(new THREE.BufferGeometry).setFromPoints(this._points),t=new THREE.PointsMaterial({size:this._pointSize,sizeAttenuation:!1});this._pointsMesh=new THREE.Points(e,t),this.node.add(this._pointsMesh)},t.prototype._beforeSetupComplete=function(e){this._pointSize=e.pointSize||this._pointSize;var t=e.points;t&&this.addPoints(t)},t}(Kn),Mo=function e(){n(this,e),this.strId="",this.fPPAfterImageValue=0,this.listGroups=new Array;var t=new Co;this.listGroups[0]=t,this._attr="ParticleData"};Mo.prototype={getAttr:function(){return this._attr}};var Co=function e(){n(this,e),this.strId="",this.texture=new Do,this.fFixedTimeStep=.33,this.strUseMesh="false",this.strMeshUrl="BuildIn/Box",this.arrayMeshParams=new Array,this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.strHasPerspective="true",this.strIsColorize="true",this.iBlendingMode=1,this.strIsTransparent="true",this.fAlphaTest=0,this.strIsDepthWrite="false",this.strIsDepthTest="false",this.strIsFog="false",this.strEnableTrail="false",this.textureTrail=new Do,this.fTrailLife=.5,this.fTrailWidthStart=1,this.fTrailWidthEnd=1,this.fScale=window.innerHeight/2,this.iMaxParticleCount=500,this.vec4Quaternion=new THREE.Vector4(0,0,0,1),this.listEmitters=new Array;var t=new Ro;this.listEmitters[0]=t},Ro=function e(){n(this,e),this.strId="",this.iDistribution=1,this.iParticleCount=100,this.fDuration=-1,this.strIsStatic="false",this.strIsLookAtCamera="false",this.strIsLookAtCameraOnlyY="false",this.fActiveMultiplier=1,this.iDirection=1,this.maxAge=new Po,this.position=new jo,this.velocity=new Fo,this.acceleration=new Oo,this.drag=new ko,this.wiggle=new Lo,this.rotation=new Ho,this.trail=new Bo,this.listColor=new Array;var t=new Io;this.listColor[0]=t,this.listOpacity=new Array;var i=new No;this.listOpacity[0]=i,this.listSize=new Array;var r=new Uo;this.listSize[0]=r,this.listAngle=new Array;var o=new Vo;this.listAngle[0]=o},Do=function e(){n(this,e),this.name="32x32_star.png",this.url="http://static.3dmomoda.com/textures/18092617nyspq5moaka1i2fhvs1hh66s.png",this.vec2Frames=new THREE.Vector2(1,1),this.iFrameCount=1,this.iLoop=1},Po=function e(){n(this,e),this.fValue=1,this.fSpread=1},jo=function e(){n(this,e),this.vec3Value=new THREE.Vector3(0,0,0),this.vec3Spread=new THREE.Vector3(0,0,0),this.vec3SpreadClamp=new THREE.Vector3(0,0,0),this.fRadius=0,this.vec3RadiusScale=new THREE.Vector3(1,1,1),this.iDistribution=1,this.strIsRandomise="false"},Fo=function e(){n(this,e),this.vec3Value=new THREE.Vector3(0,10,0),this.vec3Spread=new THREE.Vector3(10,0,10),this.iDistribution=1,this.strIsRandomise="false"},Oo=function e(){n(this,e),this.vec3Value=new THREE.Vector3(0,0,0),this.vec3Spread=new THREE.Vector3(0,0,0),this.iDistribution=1,this.strIsRandomise="false"},ko=function e(){n(this,e),this.fValue=0,this.fSpread=0,this.strIsRandomise="false"},Lo=function e(){n(this,e),this.fValue=0,this.fSpread=0},Bo=function e(){n(this,e),this.fValue=0,this.fSpread=0,this.fStep=0,this.fStepSpread=0},Ho=function e(){n(this,e),this.vec3Axis=new THREE.Vector3(0,0,0),this.vec3AxisSpread=new THREE.Vector3(0,0,0),this.fAngle=0,this.fAngleSpread=0,this.strIsStatic="false",this.vec3Center=new THREE.Vector3(0,0,0),this.strIsRandomise="false"},Io=function e(){n(this,e),this.vec3Value=new THREE.Vector3(1,1,1),this.vec3Spread=new THREE.Vector3(0,0,0),this.strIsRandomise="false"},No=function e(){n(this,e),this.fValue=1,this.fSpread=0,this.strIsRandomise="false"},Uo=function e(){n(this,e),this.fValue=1,this.fSpread=0,this.strIsRandomise="false"},Vo=function e(){n(this,e),this.fValue=0,this.fSpread=0,this.strIsRandomise="false"},zo=function(){var e="[BufferGeometryHelper.js] : ";this.bEnableLog=!0,this.bufferGeometry=null,this.jsonLoader=new THREE.BufferGeometryLoader,this.objLoader=new THREE.OBJLoader,this.strMeshUrl=null;var t=this;this.init=function(i,n){if(t.bEnableLog&&console.log(e+"[init];"),null!=n&&null!=n){if(null==i||null==i||"object"!=(void 0===i?"undefined":r(i)))return console.error(e+"[init] : options == null;"),void n(null);if(null==i.strMeshUrl||null==i.strMeshUrl||"string"!=typeof i.strMeshUrl)return console.error(e+"[init] : options.strMeshUrl == null;"),void n(null);t.strMeshUrl=i.strMeshUrl,null!=t.bufferGeometry&&null!=t.bufferGeometry&&(t.bufferGeometry.dispose(),t.bufferGeometry=null);if(i.strMeshUrl.indexOf("BuildIn")>=0){var o=!1;return i.strMeshUrl.indexOf("Box")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a BoxBufferGeometry;"),o=!t.checkParams(i.params,3),t.bufferGeometry=o?new THREE.BoxBufferGeometry(1,1,1):new THREE.BoxBufferGeometry(i.params[0],i.params[1],i.params[2])),i.strMeshUrl.indexOf("Cylinder")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a CylinderBufferGeometry;"),o=!t.checkParams(i.params,4),t.bufferGeometry=o?new THREE.CylinderBufferGeometry(1,1,1,6):new THREE.CylinderBufferGeometry(i.params[0],i.params[1],i.params[2],i.params[3]<=12?i.params[3]:12)),i.strMeshUrl.indexOf("Cone")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a ConeBufferGeometry;"),o=!t.checkParams(i.params,3),t.bufferGeometry=o?new THREE.ConeBufferGeometry(1,1,6):new THREE.ConeBufferGeometry(i.params[0],i.params[1],i.params[2]<=12?i.params[2]:12)),i.strMeshUrl.indexOf("Circle")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a CircleBufferGeometry;"),o=!t.checkParams(i.params,2),t.bufferGeometry=o?new THREE.CircleBufferGeometry(1,6):new THREE.CircleBufferGeometry(i.params[0],i.params[1]<=12?i.params[1]:12)),i.strMeshUrl.indexOf("Dodecahedron")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a DodecahedronBufferGeometry;"),o=!t.checkParams(i.params,2),t.bufferGeometry=o?new THREE.DodecahedronBufferGeometry(1,0):new THREE.DodecahedronBufferGeometry(i.params[0],i.params[1]<=1?i.params[1]:1)),i.strMeshUrl.indexOf("Icosahedron")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a IcosahedronBufferGeometry;"),o=!t.checkParams(i.params,2),t.bufferGeometry=o?new THREE.IcosahedronBufferGeometry(1,0):new THREE.IcosahedronBufferGeometry(i.params[0],i.params[1]<=1?i.params[1]:1)),i.strMeshUrl.indexOf("Octahedron")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a OctahedronBufferGeometry;"),o=!t.checkParams(i.params,2),t.bufferGeometry=o?new THREE.OctahedronBufferGeometry(1,0):new THREE.OctahedronBufferGeometry(i.params[0],i.params[1]<=2?i.params[1]:1)),i.strMeshUrl.indexOf("Plane")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a PlaneBufferGeometry;"),o=!t.checkParams(i.params,2),t.bufferGeometry=o?new THREE.PlaneBufferGeometry(1,0):new THREE.PlaneBufferGeometry(i.params[0],i.params[1])),i.strMeshUrl.indexOf("Ring")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a RingBufferGeometry;"),o=!t.checkParams(i.params,3),t.bufferGeometry=o?new THREE.RingBufferGeometry(1,2,12,1):new THREE.RingBufferGeometry(i.params[0],i.params[1],i.params[2]<=12?i.params[2]:12,1)),i.strMeshUrl.indexOf("Sphere")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a SphereBufferGeometry;"),o=!t.checkParams(i.params,3),t.bufferGeometry=o?new THREE.SphereBufferGeometry(1,8,8):new THREE.SphereBufferGeometry(i.params[0],i.params[1]<=12?i.params[1]:12,i.params[2]<=12?i.params[2]:12)),i.strMeshUrl.indexOf("Tetrahedron")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a TetrahedronBufferGeometry;"),o=!t.checkParams(i.params,2),t.bufferGeometry=o?new THREE.TetrahedronBufferGeometry(1,0):new THREE.TetrahedronBufferGeometry(i.params[0],i.params[1]<=2?i.params[1]:2)),i.strMeshUrl.indexOf("Torus")>=0&&i.strMeshUrl.indexOf("TorusKnot")<0&&(t.bEnableLog&&console.log(e+"[init] : it's a TorusBufferGeometry;"),o=!t.checkParams(i.params,4),t.bufferGeometry=o?new THREE.TorusBufferGeometry(1,1,8,8):new THREE.TorusBufferGeometry(i.params[0],i.params[1],i.params[2]<=12?i.params[2]:12,i.params[3]<=12?i.params[3]:12)),i.strMeshUrl.indexOf("TorusKnot")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a TorusKnotBufferGeometry;"),o=!t.checkParams(i.params,6),t.bufferGeometry=o?new THREE.TorusKnotBufferGeometry(1,1,32,8,2,3):new THREE.TorusKnotBufferGeometry(i.params[0],i.params[1],i.params[2]<=32?i.params[2]:32,i.params[3]<=12?i.params[3]:12,i.params[4]<=12?i.params[4]:12,i.params[5]<=12?i.params[5]:12)),void n(t.bufferGeometry)}var a=i.strMeshUrl.indexOf(".json");a>=0&&a+".json".length==i.strMeshUrl.length&&(t.bEnableLog&&console.log(e+"[init] : it's a .json file to BufferGeometry;"),t.jsonLoader.load(Globals.strParticleMeshRootPath+i.strMeshUrl,(function(r){return null!=r&&null!=r?(t.bufferGeometry=r,void n(t.bufferGeometry)):(console.error(e+"[init] : failed load the .json file to BufferGeometry; strMeshUrl = "+i.strMeshUrl),void n(null))})));var s=i.strMeshUrl.indexOf(".obj");s>=0&&s+".obj".length==i.strMeshUrl.length&&(t.bEnableLog&&console.log(e+"[init] : it's a .obj file to BufferGeometry;"),t.objLoader.load(Globals.strParticleMeshRootPath+i.strMeshUrl,(function(r){if(null!=r&&null!=r&&null!=r.children){for(var o=null,a=0,s=r.children.length;a<s;a++)if(r.children[a]instanceof THREE.Mesh){o=r.children[a];break}if(null!=o){var l=(new THREE.BufferGeometry).fromGeometry(o.geometry);return null!=l&&null!=l?(t.bufferGeometry=l,void n(t.bufferGeometry)):(console.error(e+"[init] : failed transform the .obj file to BufferGeometry; strMeshUrl = "+i.strMeshUrl),void n(null))}return console.error(e+"[init] : failed load the .obj file to BufferGeometry; can not find a mesh; strMeshUrl = "+i.strMeshUrl),void n(null)}}),(function(e){}),(function(t){console.error(e+"[init] : failed load the .obj file to BufferGeometry; strMeshUrl = "+i.strMeshUrl+"; error = "+t),n(null)})))}else console.error(e+"[init] : onFinished == null;")},this.checkParams=function(t,i){if(null==t||null==t||"object"!=(void 0===t?"undefined":r(t)))return console.warn(e+"[checkParams] : params == null;"),!1;if(t.length<i)return console.warn(e+"[checkParams] : params.length < "+i),!1;for(var n=0;n<i;n++)if(null==t[n]||null==t[n]||"number"!=typeof t[n])return console.warn(e+"[checkParams] : error params["+n+"];"),!1;return!0}},qo=function(){function e(t,i,r){n(this,e),this._options=t,this._emitter=i,this._particleGroup=r,this._emitter||this.refresh()}return e.prototype.cloneOptions=function(){return ke.cloneObject(this._options,!1,null,(function(e,t){if(ke.isFunction(e.clone))return e.clone()}))},e.prototype.refresh=function(){this._emitter&&(this._particleGroup._group.removeEmitter(this._emitter),this._emitter=null);var e=this.cloneOptions();this._particleGroup._options.useMesh?this._emitter=new MSPE.Emitter(e):this._emitter=new SPE.Emitter(e),this._particleGroup._group.addEmitter(this._emitter)},o(e,[{key:"options",set:function(e){e&&(ke.mergeObject(this._options,e,!0),this.refresh())},get:function(){return this._options}}]),e}(),Wo=function(){function e(t,i,r){n(this,e),this._options=t,this._group=i,this._particleSystem=r,this._emitters=[],this._group||this.refresh()}return e.prototype.cloneOptions=function(){var e=ke.cloneObject(this._options,!1,(function(e){return"texture"!=e&&"bufferGeometry"!=e}),(function(e,t){if(ke.isFunction(e.clone))return e.clone()})),t=this._options.vec4Quaternion;return t&&(e.vec4Quaternion=t.clone()),e},e.prototype.refresh=function(){-1===this._particleSystem._groups.indexOf(this)&&this._particleSystem._groups.push(this),this._group&&this._group.mesh&&this._particleSystem.node.remove(this._group.mesh);for(var e=0;e<this._emitters.length;e++){var t=this._emitters[e];this._group.removeEmitter(t._emitter)}var i=this.cloneOptions();i.useMesh?this._group=new MSPE.Group(i):this._group=new SPE.Group(i);for(e=0;e<this._emitters.length;e++){var r=this._emitters[e],n=r.cloneOptions();for(var o in this._particleSystem._particleOptions){var a=this._particleSystem._particleOptions[o];ke.isNull(a)||(n[o]=a)}i.useMesh?r._emitter=new MSPE.Emitter(n):r._emitter=new SPE.Emitter(n),this._group.addEmitter(r._emitter)}var s=this._group.mesh;s&&(this._particleSystem.node.add(s),s.setFrustumCulled(!1))},e.prototype.tick=function(e,t){this._group.tick(e,t)},e.prototype.addEmitter=function(e){return new qo(e,null,this)},e.prototype.removeEmitter=function(e){for(var t=0;t<this._emitters.length;t++)if(e==this._emitters[t]){this._emitters.splice(t,1),this._group.removeEmitter(e._emitter);break}},o(e,[{key:"options",set:function(e){e&&(ke.mergeObject(this._options,e,!0),this.refresh())},get:function(){return this._options}}]),e}(),Go=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._groups=[],r._particleOptions={},r._groupOptions={},r}return a(t,e),t.prototype.loadFromURL=function(e,t){var i=this;e.node||(e.node=new THREE.Group);var r=e.url,n=this.app.particleResource.get(r);n?this.loadComplete(n,e,t):this.app.particleResource.download(r,(function(r){i.loadComplete(r,e,t)}))},t.prototype.loadComplete=function(e,t,i){this.setupParticleData(e,t),this.setupUserData(t),null!=i&&i()},t.prototype.customSetup=function(e){this.tickable=!0},t.prototype.update=function(e){for(var t=0;t<this._groups.length;t++){this._groups[t].tick(e,this.app.renderCamera)}return!0},t.prototype.parseEmitterOptions=function(e,t){var i=new THREE.Vector3(e.position.vec3Value.x,e.position.vec3Value.y,e.position.vec3Value.z),r=new THREE.Vector3(e.position.vec3Spread.x,e.position.vec3Spread.y,e.position.vec3Spread.z),n=new THREE.Vector3(e.position.vec3SpreadClamp.x,e.position.vec3SpreadClamp.y,e.position.vec3SpreadClamp.z),o=!1;o="true"==e.position.strIsRandomise.valueOf();var a=new THREE.Vector3(e.velocity.vec3Value.x,e.velocity.vec3Value.y,e.velocity.vec3Value.z),s=new THREE.Vector3(e.velocity.vec3Spread.x,e.velocity.vec3Spread.y,e.velocity.vec3Spread.z);e.velocity.strIsRandomise.valueOf();var l=new THREE.Vector3(e.acceleration.vec3Value.x,e.acceleration.vec3Value.y,e.acceleration.vec3Value.z),u=new THREE.Vector3(e.acceleration.vec3Spread.x,e.acceleration.vec3Spread.y,e.acceleration.vec3Spread.z),c=!1;c="true"==e.acceleration.strIsRandomise.valueOf();var h=!1;h="true"==e.strIsStatic.valueOf();var p=new THREE.Vector3(e.rotation.vec3Axis.x,e.rotation.vec3Axis.y,e.rotation.vec3Axis.z),d=new THREE.Vector3(e.rotation.vec3AxisSpread.x,e.rotation.vec3AxisSpread.y,e.rotation.vec3AxisSpread.z),f=new THREE.Vector3(e.rotation.vec3Center.x,e.rotation.vec3Center.y,e.rotation.vec3Center.z),m=!1;m="true"==e.rotation.strIsStatic.valueOf();var g=!1;g="true"==e.rotation.strIsRandomise.valueOf();var v=new Array,y=new Array,b=new Array;if(e.listColor.length>0)for(var _=0,x=e.listColor.length;_<x;_++)v.push(new THREE.Color(e.listColor[_].vec3Value.x,e.listColor[_].vec3Value.y,e.listColor[_].vec3Value.z)),y.push(new THREE.Vector3(e.listColor[_].vec3Spread.x,e.listColor[_].vec3Spread.y,e.listColor[_].vec3Spread.z)),"true"==e.listColor[_].strIsRandomise.valueOf()?b.push(!0):b.push(!1);else v.push(new THREE.Color("white")),y.push(new THREE.Vector3(0,0,0)),b.push(!1);var E=new Array,w=new Array,T=new Array;if(e.listOpacity.length>0)for(_=0,x=e.listOpacity.length;_<x;_++)E.push(e.listOpacity[_].fValue),w.push(e.listOpacity[_].fSpread),"true"==e.listOpacity[_].strIsRandomise.valueOf()?T.push(!0):T.push(!1);else E.push(1),w.push(0),T.push(!1);var S=new Array,A=new Array,M=new Array;if(e.listSize.length>0)for(_=0,x=e.listSize.length;_<x;_++)S.push(e.listSize[_].fValue),A.push(e.listSize[_].fSpread),"true"==e.listSize[_].strIsRandomise.valueOf()?M.push(!0):M.push(!1);else S.push(1),A.push(0),M.push(!1);var C=new Array,R=new Array,D=new Array;if(e.listAngle.length>0)for(_=0,x=e.listAngle.length;_<x;_++)C.push(e.listAngle[_].fValue),R.push(e.listAngle[_].fSpread),"true"==e.listAngle[_].strIsRandomise.valueOf()?M.push(!0):D.push(!1);else C.push(0),R.push(0),D.push(!1);var P={type:e.iDistribution,particleCount:e.iParticleCount,duration:e.fDuration<=0?void 0:e.fDuration,isStatic:h,isLookAtCamera:"true"==e.strIsLookAtCamera,isLookAtCameraOnlyY:"true"==e.strIsLookAtCameraOnlyY,activeMultiplier:e.fActiveMultiplier,direction:e.iDirection,maxAge:{value:e.maxAge.fValue,spread:e.maxAge.fSpread},position:{value:i,spread:r,spreadClamp:n,radius:e.position.fRadius,radiusScale:new THREE.Vector3(1,1,1),randomise:o},radius:{value:5,spread:0,scale:new THREE.Vector3(1,1,1),spreadClamp:new THREE.Vector3(2,2,2)},velocity:{value:a,spread:s,randomise:!1},acceleration:{value:l,spread:u,randomise:c},drag:{value:e.drag.fValue,spread:e.drag.fSpread},wiggle:{value:e.wiggle.fValue,spread:e.wiggle.fSpread},rotation:{axis:p,axisSpread:d,angle:e.rotation.fAngle,angleSpread:e.rotation.fAngleSpread,static:m,center:f,randomise:g},color:{value:v,spread:y,randomise:b},opacity:{value:E,spread:w,randomise:T},size:{value:S,spread:A,randomise:M},angle:{value:C,spread:R,randomise:D}},j=this.app.renderer.capabilities.maxVaryings;for(var F in j>15&&(P.trail={value:e.trail.fValue,spread:e.trail.fSpread,step:e.trail.fStep,stepSpread:e.trail.fStepSpread}),this._particleOptions){var O=this._particleOptions[F];ke.isNull(O)||(P[F]=O)}return P},t.prototype.parseGroupOptions=function(e,t){var i=this.app.calcRect(),r={texture:{value:t,frames:e.texture.vec2Frames,frameCount:e.texture.iFrameCount,loop:e.texture.iLoop},fixedTimeStep:e.fFixedTimeStep,hasPerspective:"true"==e.strHasPerspective,colorize:"true"==e.strIsColorize,blending:e.iBlendingMode,transparent:"true"==e.strIsTransparent,alphaTest:e.fAlphaTest,depthWrite:"true"==e.strIsDepthWrite,depthTest:"true"==e.strIsDepthTest,fog:"true"==e.strIsFog,scale:i.height/2,maxParticleCount:e.iMaxParticleCount,useMesh:"true"==e.strUseMesh},n=e.vec4Quaternion;for(var o in n&&(r.vec4Quaternion=new THREE.Quaternion(n.x,n.y,n.z,n.w)),this._groupOptions){var a=this._groupOptions[o];ke.isNull(a)||(r[o]=a)}return r},t.prototype.setupParticleEmitter=function(e,t,i){var r=this.parseEmitterOptions(e,t),n=new qo(r,null,i);i._emitters.push(n)},t.prototype.setupParticleEmitters=function(e,t){for(var i=0;i<e.listEmitters.length;i++){var r=e.listEmitters[i];this.setupParticleEmitter(r,e,t)}this.static&&this.node._synMatrixWorld()},t.prototype.createParticleGroup=function(e){return new Wo(e,null,this)},t.prototype.setupParticleGroup=function(e,t){var i=this,r=new THREE.TextureLoader;r.setCrossOrigin("anonymous");var n=e.texture.url;n.startsWith("http://")||n.startsWith("https://")||(n=t.appendPath(n)),r.load(n,(function(t){var r=i.parseGroupOptions(e,t);if(r.useMesh){var n=new zo;n.bEnableLog=!1,n.init({strMeshUrl:e.strMeshUrl,params:e.arrayMeshParams},(function(t){r.bufferGeometry=t;var n=i.createParticleGroup(r);i.setupParticleEmitters(e,n)}))}else{var o=i.createParticleGroup(r);i.setupParticleEmitters(e,o)}}))},t.prototype.setupParticleData=function(e,t){var i=new Mo;(i=e).__proto__=Mo.prototype;for(var r=t.url,n=0;n<i.listGroups.length;n++){var o=i.listGroups[n];this.setupParticleGroup(o,r)}},t.prototype.refresh=function(){for(var e=0;e<this._groups.length;e++){this._groups[e].refresh()}},t.prototype.setParticleAttribute=function(e,t){this._particleOptions[e]=t,this.refresh()},t.prototype.setGroupAttribute=function(e,t){this._groupOptions[e]=t,this.refresh()},o(t,[{key:"gravityPosition",set:function(e){var t=ke.parseVector3(e),i=ke.parseVector3(this.position),r=new THREE.Vector3;r.subVectors(t,i).normalize();var n=new THREE.Quaternion;n.setFromUnitVectors(new THREE.Vector3(0,-1,0),r);for(var o=0;o<this._groups.length;o++){var a=this._groups[o];a.options.vec4Quaternion=new THREE.Vector4(n.x,n.y,n.z,n.w),a.refresh()}}}]),t}(bt),Xo=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._scale=4,r._color="#FFFFFF",r._flowDirection=new THREE.Vector2(1,1),r._textureWidth=1024,r._textureHeight=1024,r._normalMaps=[],r._normalMapsURL=[],r.water=null,r}return a(t,e),t.prototype._updateByPoints=function(){if(this._points.length){this.app.resourceManager.remove(this.water);var e=this._createPolygonVertices(!0),t=this._createPolygonGeometry(e.vertices,e.faces),i=0;if(e.vertices.length){for(var r=0;r<e.vertices.length;r++)i+=e.vertices[r].z;i/=e.vertices.length}this.water=new THREE.Water(t,{color:this._color,scale:this._scale,flowDirection:this._flowDirection,textureWidth:this._textureWidth,textureHeight:this._textureHeight,normalMap0:this._normalMaps[0],normalMap1:this._normalMaps[1]}),this.water.position.y=i,this.water.scale.y*=-1,this.water.rotation.x=-.5*Math.PI,this.node.add(this.water)}},t.prototype._createByGeometry=function(){if(this.geometryInParam){this.app.resourceManager.remove(this.water);var e=this.geometryInParam;this.water=new THREE.Water(e,{color:this._color,scale:this._scale,flowDirection:this._flowDirection,textureWidth:this._textureWidth,textureHeight:this._textureHeight,normalMap0:this._normalMaps[0],normalMap1:this._normalMaps[1]}),this.node.add(this.water)}},t.prototype._setupTextures=function(e){for(var t=new THREE.TextureLoader,i=[e.normalMap0||"images/water/Water_1_M_Normal.jpg",e.normalMap1||"images/water/Water_2_M_Normal.jpg"],r=0;r<i.length;r++){var n=i[r];n&&(this._normalMapsURL.push(n),this._normalMaps.push(t.load(this.app.confirmURL(n))))}this._textureWidth=1024,this._textureHeight=1024},t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t),this._scale=ke.parseValue(t.waterScale,4),this._color=ke.parseColor(t.waterColor,"#FFFFFF"),this._flowDirection=ke.parseVector2(t.flowDirection,new THREE.Vector2(1,1)),this._setupTextures(t),t.geometry&&(this.geometryInParam=t.geometry,this._createByGeometry());var i=t.points;i&&this.addPoints(i)},t.prototype._afterSetupComplete=function(e){e.position||e.localPosition||this.useBottomCenterOfBoundingBoxAsPosition()},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);t.waterScale=this._scale,t.waterColor=this._color,t.flowDirection=this._flowDirection,t.points=this.points;for(var i=0;i<this._normalMapsURL.length;i++)t["normalMap"+i]=this._normalMapsURL[i];return t},t.prototype.setEffect=function(e){console.warn("[Water] Please use '.style.setEffect()' to replace '.setEffect()'"),this.style.setEffect(e)},o(t,[{key:"isWater",get:function(){return!0}}]),t}(Kn),Yo=new THREE.Vector3,Jo=new THREE.Vector3,Qo=new THREE.Matrix4,Zo=new THREE.Raycaster;Zo.linePrecision=0;var Ko=function(e){function t(i){n(this,t);var r=s(this,e.call(this));return r.geometry.addAttribute("position",new THREE.Float32BufferAttribute(new Array(24).fill(0),3)),r.geometry.addAttribute("color",new THREE.Float32BufferAttribute(new Array(24).fill(1),3)),r._camera=i,r}return a(t,e),t.prototype.update=function(e,t){var i=this;e.forEach((function(e,r){Yo.set(e.x,e.y,1).applyMatrix4(Qo.getInverse(i._camera.projectionMatrix)),Yo.setLength(Math.min(Yo.length(),t[r])),i.geometry.getAttribute("position").setXYZ(2*r+1,Yo.x,Yo.y,Yo.z)})),this.geometry.getAttribute("position").needsUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()},t}(THREE.LineSegments),$o=function(e){function t(i,r){n(this,t);var o=new THREE.BufferGeometry,a=new THREE.MeshBasicMaterial({color:61183,opacity:.1,transparent:!0,side:THREE.DoubleSide}),l=s(this,e.call(this,o,a));o.addAttribute("position",new THREE.Float32BufferAttribute(new Array(3*r).fill(0),3));for(var u=[],c=0;c<r-2;c++)u.push(0,c+1,c+2);return o.setIndex(u),l._camera=i,l}return a(t,e),t.prototype.update=function(e,t){var i=this;e.forEach((function(e,r){Yo.set(e.x,e.y,1).applyMatrix4(Qo.getInverse(i._camera.projectionMatrix)),Yo.setLength(Math.min(Yo.length(),t[r])),i.geometry.getAttribute("position").setXYZ(r+1,Yo.x,Yo.y,Yo.z)})),this.geometry.getAttribute("position").needsUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()},t}(THREE.Mesh),ea=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.tickable=!0,r._camera=new THREE.PerspectiveCamera(30,16/9,1,20),r._camera.matrixAutoUpdate=!1,r._cameraFrustum=new THREE.Frustum,r._cameraHelper=new THREE.CameraHelper(r._camera),r._cameraHelper.visible=!1,r._cameraHelper.matrix=new THREE.Matrix4,r._outMesh=new Ko(r._camera),r._outMesh.material.color.setHex(16777215),r._outMesh.visible=!1,r._horizontalScanningNum=15,r._verticalScanningNum=20,r._innerPlanes=[],r.node.add(r._cameraHelper),r.node.add(r._outMesh),r._innerScanning=!1,r._innerCounter=0,r._scanning=!1,r._scanningObject=null,r}return a(t,e),t.prototype._updateCameraMatrixAndFrustum=function(){var e=this._camera;e.matrixWorld.copy(this.node.matrixWorld),e.matrixWorldInverse.getInverse(this.node.matrixWorld),Qo.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._cameraFrustum.setFromMatrix(Qo)},t.prototype.customSetup=function(e){void 0!==e.fov&&(this._camera.fov=e.fov),void 0!==e.aspect&&(this._camera.aspect=e.aspect),void 0!==e.near&&(this._camera.near=e.near),void 0!==e.far&&(this._camera.far=e.far),void 0!==e.debug&&(this._cameraHelper.visible=e.debug),void 0!==e.outerColor&&this._outMesh.material.color.set(ke.parseColor(e.outerColor)),void 0!==e.innerScanning&&(this._innerScanning=!!e.innerScanning),void 0!==e.scanningNum&&(this._horizontalScanningNum=e.scanningNum[0],this._verticalScanningNum=e.scanningNum[1]),this._camera.updateProjectionMatrix(),this.node.updateMatrixWorld(!0),this._updateCameraMatrixAndFrustum()},t.prototype.update=function(t){return e.prototype.update.call(this,t),!this.visible||(this._updateCameraMatrixAndFrustum(),this._cameraHelper.visible&&this._cameraHelper.update(),this._scanning&&(this._innerCounter>this._verticalScanningNum?(this._scanning=!1,this._innerCounter=0,this._scanningObject=null):(this._updateInnerPlane(this._innerCounter,this._scanningObject),this._innerCounter++)),!0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.stop()},t.prototype.start=function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];i&&(this.node.updateMatrixWorld(!0),this._updateCameraMatrixAndFrustum());var r=[new THREE.Vector2(-1,1),new THREE.Vector2(-1,-1),new THREE.Vector2(1,-1),new THREE.Vector2(1,1)],n=r.map((function(i){Zo.setFromCamera(i,t._camera);var r=Zo.intersectObjects(e.getNodes(),!0);return r[0]?r[0].distance:1/0}));return this._outMesh.update(r,n),this._outMesh.visible=!0,this._innerScanning&&(this._innerCounter=0,this._scanning=!0,this._scanningObject=e||this.app.query(".Ground")),n},t.prototype.pause=function(){this._scanning&&(this._scanning=!1,this._innerCounter=0,this._scanningObject=null)},t.prototype.stop=function(){this._outMesh.visible=!1;for(var e=0;e<=this._verticalScanningNum;e++)this._innerPlanes[e]&&(this._innerPlanes[e].visible=!1);this._scanning=!1,this._innerCounter=0,this._scanningObject=null},t.prototype._updateInnerPlane=function(e,t){for(var i=this,r=2*e/this._verticalScanningNum-1,n=[],o=0;o<=this._horizontalScanningNum;o++){var a=2*o/this._horizontalScanningNum-1;n.push(new THREE.Vector2(a,r))}var s=n.map((function(e){Zo.setFromCamera(e,i._camera);var r=Zo.intersectObjects(t.getNodes(),!0);return r[0]?r[0].distance:1/0}));this._innerPlanes[e]||(this._innerPlanes[e]=new $o(this._camera,this._horizontalScanningNum+2),this.node.add(this._innerPlanes[e]),this._innerPlanes[e].visible=!1),this._innerPlanes[e].update(n,s),this._innerPlanes[e].visible=!0},t.prototype.test=function(e){var t=this,i=e.objects.filter((function(e){return t._cameraFrustum.intersectsBox(e.boundingBox.toBox())}));return i.filter((function(e){var r=Yo.setFromMatrixPosition(t._camera.matrixWorld),n=e.boundingBox.toBox().getCenter(Jo);Zo.set(r,n.sub(r).normalize());var o=Zo.intersectObjects(i.map((function(e){return e.node})),!0);return!!(o.length>0&&o[0].object.isChildOf(e.node))}))},t.prototype.testObject=function(e,i){var r=this,n=Yo.setFromMatrixPosition(this._camera.matrixWorld),o=e.boundingBox.toBox().getCenter(Jo);Zo.set(n,o.sub(n).normalize());var a=i.objects.filter((function(e){return r._cameraFrustum.intersectsBox(e.boundingBox.toBox())})),s=Zo.intersectObjects(a.map((function(e){return e.node})),!0);return s.length>0?s[0].object.isChildOf(e.node)?{state:t.VISIBLE,distance:s[0].distance,point:s[0].point}:{state:t.OBSCURED,distance:s[0].distance,point:s[0].point}:{state:t.OUT,distance:-1,point:null}},t.prototype._setNodeVisible=function(e){this.node.ensureVisible(e,this._autoSynVisible)},o(t,[{key:"fov",set:function(e){this._camera.fov=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.fov}},{key:"aspect",set:function(e){this._camera.aspect=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.aspect}},{key:"near",set:function(e){this._camera.near=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.near}},{key:"far",set:function(e){this._camera.far=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.far}}]),t}(bt);ea.OUT=0,ea.VISIBLE=1,ea.OBSCURED=2;var ta={showHelper:!1,ambientLight:{intensity:.45,color:16777215},hemisphereLight:{intensity:0,color:16777215,groundColor:2236962},mainLight:{shadow:!1,shadowQuality:"high",intensity:.5,color:16777215,alpha:30,beta:30},secondaryLight:{shadow:!1,shadowQuality:"high",intensity:0,color:16777215,alpha:138,beta:0},tertiaryLight:{shadow:!1,shadowQuality:"high",intensity:0,color:16777215,alpha:0,beta:0}},ia={showHelper:!1,ambientLight:{intensity:0},hemisphereLight:{intensity:0},mainLight:{intensity:0},secondaryLight:{intensity:0},tertiaryLight:{intensity:0}},ra=new THREE.Sphere,na=new THREE.Vector3,oa=new THREE.Vector3,aa=new THREE.Matrix4;function sa(e,t){if(t==1/0)return e.getLocalBoundingBox().toBox();var i=e.query("*").filter((function(e){return!(e.getBoundingBox(!1,!0).radius>t)})),r=new THREE.Box3;i.forEach((function(e){r.union(e.getBoundingBox(!1,!0).toBox())}));var n=new THREE.Matrix4;return e.node.updateWorldMatrix(!0,!1),n.getInverse(e.node.matrixWorld),r.applyMatrix4(n),r}var la=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.ambientLight=new THREE.AmbientLight,r.ambientLight.name="ambient_light",r.node.add(r.ambientLight),r.hemisphereLight=new THREE.HemisphereLight(16777215,2236962,1),r.hemisphereLight.name="hemisphere_light",r.node.add(r.hemisphereLight),r.mainLight=new THREE.DirectionalLight,r.mainLight.name="main_light",r.mainLight.helper=new THREE.DirectionalLightHelper(r.mainLight),r.mainLight.helper.matrix=r.mainLight.matrix,r.node.add(r.mainLight),r.node.add(r.mainLight.target),r.node.add(r.mainLight.helper),r.secondaryLight=new THREE.DirectionalLight,r.secondaryLight.name="secondary_light",r.secondaryLight.helper=new THREE.DirectionalLightHelper(r.secondaryLight),r.secondaryLight.helper.matrix=r.secondaryLight.matrix,r.node.add(r.secondaryLight),r.node.add(r.secondaryLight.target),r.node.add(r.secondaryLight.helper),r.tertiaryLight=new THREE.DirectionalLight,r.tertiaryLight.name="tertiary_light",r.tertiaryLight.helper=new THREE.DirectionalLightHelper(r.tertiaryLight),r.tertiaryLight.helper.matrix=r.tertiaryLight.matrix,r.node.add(r.tertiaryLight),r.node.add(r.tertiaryLight.target),r.node.add(r.tertiaryLight.helper),r._config=JSON.parse(JSON.stringify(ta)),r._shadowObjectMaxSize=500,r}return a(t,e),t.prototype.customSetup=function(e){var t={};for(var i in ta)e.hasOwnProperty(i)&&(t[i]=e[i]);this.setConfig(t),this.mainLight.helper.skipBoundingBox(!0),this.secondaryLight.helper.skipBoundingBox(!0),this.tertiaryLight.helper.skipBoundingBox(!0)},t.prototype.setConfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:JSON.parse(JSON.stringify(ta)),t=arguments[1];ke.mergeObject(this._config,e,!0);var i=this._config;if(!t){var r=this.parent?this.parent:this.app.root;t=i.mainLight.shadow||i.secondaryLight.shadow||i.tertiaryLight.shadow?sa(r,this._shadowObjectMaxSize):sa(r,1/0)}var n=t.getBoundingSphere(ra);this.node.updateMatrixWorld(!0);var o=na.set(0,1,0).transformDirection(this.node.matrixWorld).normalize();this.ambientLight.intensity=i.ambientLight.intensity,this.ambientLight.color.set(ke.parseColor(i.ambientLight.color)),this.hemisphereLight.intensity=i.hemisphereLight.intensity,this.hemisphereLight.color.set(ke.parseColor(i.hemisphereLight.color)),this.hemisphereLight.groundColor.set(ke.parseColor(i.hemisphereLight.groundColor)),this.hemisphereLight.position.copy(o),this.app.isMobileDevice&&(i.mainLight.castShadow=!1,i.secondaryLight.castShadow=!1,i.tertiaryLight.castShadow=!1),this._setDirectLight(this.mainLight,i.mainLight,n,i.showHelper,o),this._setDirectLight(this.secondaryLight,i.secondaryLight,n,i.showHelper,o),this._setDirectLight(this.tertiaryLight,i.tertiaryLight,n,i.showHelper,o),this.app.root.static&&this.node._synMatrixWorld(),this.app.needUpdate=!0},t.prototype.getConfig=function(){return this._config},t.prototype._setDirectLight=function(e,t,i,r,n){if(e.intensity=t.intensity,e.visible=t.intensity>0,e.color.set(ke.parseColor(t.color)),e.position.copy(ke.parseVector3(THING.Math.directionFromAlphaBeta(t.alpha,t.beta))),e.position.normalize().multiplyScalar(i.radius||1).add(i.center),e.target.position.copy(i.center),e.helper.visible=e.visible&&r,e.helper.visible&&this._updateHelper(e),e.castShadow=t.shadow&&!this.app.isMobileDevice,e.castShadow){var o=e.shadow.camera;o.top=o.right=i.radius,o.bottom=o.left=-i.radius,o.near=.1,o.far=2*i.radius,o.updateProjectionMatrix(),o.up.copy(n);var a={low:512,medium:1024,high:2048,ultra:4096}[t.shadowQuality]||1024;e.shadow.bias=-.003,e.shadow.radius=.1,e.shadow.mapSize.x===a&&e.shadow.mapSize.y===a||(e.shadow.map&&(e.shadow.map.dispose(),e.shadow.map=null),e.shadow.mapSize.set(a,a))}},t.prototype._updateHelper=function(e){var t=e.helper;void 0!==t.color?(t.lightPlane.material.color.set(t.color),t.targetLine.material.color.set(t.color)):(t.lightPlane.material.color.copy(t.light.color),t.targetLine.material.color.copy(t.light.color)),aa.lookAt(oa.subVectors(e.target.position,e.position),new THREE.Vector3,new THREE.Vector3(0,1,0)),t.lightPlane.quaternion.setFromRotationMatrix(aa),t.targetLine.quaternion.setFromRotationMatrix(aa),t.targetLine.scale.z=oa.length()},t.prototype._setNodeVisible=function(e){this.node.ensureVisible(e,this._autoSynVisible)},o(t,[{key:"shadowObjectMaxSize",set:function(e){this._shadowObjectMaxSize!==e&&(this._shadowObjectMaxSize=e,this.setConfig({}))},get:function(){return this._shadowObjectMaxSize}}]),t}(bt),ua=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._lightAngle=30,r._distance=5,r._penumbra=.5,r._helper=null,r}return a(t,e),t.prototype.destroy=function(){this._helper&&this._helper.dispose(),e.prototype.destroy.call(this)},t.prototype._syn=function(){this._light.angle=THING.Math.degToRad(this._lightAngle),this._light.intensity=this.intensity,this._light.penumbra=this.penumbra,this._light.castShadow=this.castShadow,this._light.distance=this.distance},t.prototype._afterSetupComplete=function(e){var t=e.centerNodeName;t&&(this.centerNodeName=t),this._lightAngle=e.lightAngle||this._lightAngle,this._distance=e.distance||this._distance,this._penumbra=e.penumbra||this._penumbra;var i=e.projectTexture;this._light=i?new THREE.ProjectSpotLight:new THREE.SpotLight("#FFFFFF"),this._light.position.set(0,0,0),this._light.target.position.set(0,0,1),this.node.add(this._light),this.node.add(this._light.target);var r=e.target;r&&this.lookAt(r);var n=e.helper;n&&(this.helper=n),this._syn()},t.prototype._updateLightHelper=function(){var e=this._light.distance?this._light.distance:1e3,t=e*Math.tan(this._light.angle);this._helper.cone.scale.set(t,t,e),this._helper.cone.material.color.copy(this._light.color)},t.prototype.update=function(t){var i=e.prototype.update.call(this,t);return this._helper?(this._updateLightHelper(),!0):i},o(t,[{key:"lightAngle",set:function(e){this._lightAngle=e,this._syn()},get:function(){return this._lightAngle}},{key:"distance",set:function(e){this._distance=e,this._syn()},get:function(){return this._distance}},{key:"penumbra",set:function(e){this._penumbra=e,this._syn()},get:function(){return this._penumbra}},{key:"helper",set:function(e){e&&!this._helper?(this._helper=new THREE.SpotLightHelper(this._light),this._helper.matrix=this._light.matrix,this._helper.cone.quaternion.set(0,0,0,1),this.node.add(this._helper),this.tickable=!0):!e&&this._helper&&(this.node.remove(this._helper),this._helper.dispose(),this._helper=null)},get:function(){return!!this._helper}}]),t}(function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._intensity=1,r._castShadow=!1,r._light=null,r}return a(t,e),t.prototype._syn=function(){},t.prototype.customSetup=function(e){this._intensity=e.intensity||1,this._castShadow=e.castShadow||!1},t.prototype.toJSON=function(){return e.prototype.toJSON.call(this)},o(t,[{key:"intensity",set:function(e){this._intensity=e,this._syn()},get:function(){return this._intensity}},{key:"castShadow",set:function(e){this._castShadow=e,this._syn()},get:function(){return this._castShadow}},{key:"lightColor",set:function(e){var t=ke.parseColor(e);t&&(this._light.color=t)},get:function(){return this._light.color.toHexString()}}]),t}(bt)),ca=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._image="",r._texture=null,r._width=10,r._scrollSpeed=0,r._resolution=new THREE.Vector2,r._updateResolutionFunc=r._updateResolution.bind(r),r._helpGeometry=new THREE.Geometry,r._helpGeometry.vertices=r._points,r._meshline=new THREE.MeshLine,r._material=null,r._uvTransformDirty=!0,r}return a(t,e),t.prototype._updateResolution=function(e){this._resolution.set(e.size[0],e.size[1])},t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t);var i=t.image;i&&(i.isTexture?(this._image=i.name,this._texture=i):(this._image=i,this._texture=(new THREE.TextureLoader).load(i,(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.anisotropy=16}))));var r=t.points;r&&this.addPoints(r),this._width=t.width||this._width,this.uvRatio=t.uvRatio||1,this.scrollSpeed=t.scrollSpeed||this._scrollSpeed;var n=this.app.calcRect();this._resolution.set(n.width,n.height),this._material=new THREE.MeshLineMaterial({map:this._texture,useMap:!!this._texture,color:new THREE.Color(1,1,1),opacity:1,resolution:this._resolution,sizeAttenuation:!1,lineWidth:this._width,near:this.app.renderCamera.near,far:this.app.renderCamera.far,side:THREE.DoubleSide}),this._material.extensions.derivatives=!this.app.renderer.capabilities.isWebGL2,this.app.on("resize",this._updateResolutionFunc);var o=new THREE.Mesh(this._meshline.geometry,this._material);this.node.add(o)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.app.off("resize",this._updateResolutionFunc)},t.prototype.update=function(t){var i=e.prototype.update.call(this,t);if(this._texture){var r=this._texture;return 0!==this._scrollSpeed&&(r.offset.x+=this._scrollSpeed*t,this._uvTransformDirty=!0),this._uvTransformDirty&&(r.matrix.setUvTransform(r.offset.x,r.offset.y,r.repeat.x,r.repeat.y,r.rotation,r.center.x,r.center.y),this._material.uniforms.uvTransform.value.copy(r.matrix)),!0}return i},t.prototype._updateByPoints=function(){this._meshline.setGeometry(this._helpGeometry)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.image=this._image,t.scrollSpeed=this._scrollSpeed,t.points=this.points,t},o(t,[{key:"uvRatio",set:function(e){this._texture&&(this._texture.repeat.x=e,this._uvTransformDirty=!0)}},{key:"width",set:function(e){this._width=e,this._material&&(this._material.uniforms.lineWidth.value=e)},get:function(){return this._width}},{key:"scrollSpeed",set:function(e){this._scrollSpeed=THING.Math.clamp(e,-99,99)},get:function(){return this._scrollSpeed}}]),t}(Kn);var ha=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._height=10,r._geometry=new THREE.Geometry,r._material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0}),r._scrollSpeed=[0,0],r}return a(t,e),t.prototype.setScroll=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._scrollSpeed=[e,t],this.tickable=!0},t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t),this._height=t.height||this._height;var i=t.points;i&&this.addPoints(i),this.color=t.color||16777215,this.scroll=t.scroll||!1;var r=new THREE.Mesh(this._geometry,this._material);this.node.add(r),t.image?(this._material.map=(new THREE.TextureLoader).load(t.image),this._material.map.wrapS=this._material.map.wrapT=THREE.RepeatWrapping):this._material.map=function(){for(var e=new Uint8Array(512),t=0;t<128;t++)e[4*t+0]=255,e[4*t+1]=255,e[4*t+2]=255,e[4*t+3]=255*(1-t/128);var i=new THREE.DataTexture(e,1,128,THREE.RGBAFormat);return i.needsUpdate=!0,i}()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.app.off("resize",this._updateResolutionFunc)},t.prototype.update=function(t){var i=e.prototype.update.call(this,t);return 0!==this._scrollSpeed[0]||0!==this._scrollSpeed[1]?(this._material.map&&(this._material.map.offset.x+=this._scrollSpeed[0]*t,this._material.map.offset.y+=this._scrollSpeed[1]*t),!0):i},t.prototype._updateByPoints=function(){var e=this,t=[],i=[],r=[],n=[],o=void 0,a=void 0,s=new THREE.Vector3,l=0;this.points.forEach((function(r,n){o=(new THREE.Vector3).fromArray(r),(a=(new THREE.Vector3).fromArray(r)).y+=e._height,i.push(o,a),n>0&&(l+=o.distanceTo(s)),t.push(new THREE.Vector2(l/e._height,0),new THREE.Vector2(l/e._height,1)),s.copy(o)}));for(var u=0;u<i.length-2;u+=2)r.push(new THREE.Face3(u+1,u+0,u+2)),r.push(new THREE.Face3(u+2,u+3,u+1)),n.push([t[u+1],t[u+0],t[u+2]]),n.push([t[u+2],t[u+3],t[u+1]]);this._geometry.vertices=i,this._geometry.faces=r,this._geometry.faceVertexUvs=[n],this._geometry.verticesNeedUpdate=!0,this._geometry.uvsNeedUpdate=!0,this._geometry.elementsNeedUpdate=!0,this._geometry.computeBoundingSphere(),this._geometry.computeFaceNormals()},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.height=this._height,t.points=this.points,t},o(t,[{key:"height",set:function(e){this._height=e,this._updateByPoints()},get:function(){return this._height}},{key:"color",set:function(e){this._material.color.setHex(e)},get:function(){return this._material.color.getHex()}}]),t}(Kn),pa=function(){function e(t,i,r){n(this,e),this.object=null,this.useSpriteMaterial=t,this.node=i,this.domElement=r,this.cssObject=null}return e.prototype.onUpdate=function(e){var t=this.node,i=this.cssObject;t.updateMatrixWorld();var r=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Quaternion;t.matrixWorld.decompose(r,o,n),i.quaternion.copy(o),i.position.copy(r);var a=new THREE.Vector3;this.object._independentWorldScale?a=this.object._independentWorldScale.clone():this.object.node.getWorldScale(a);var s=t.userData.cssFactor||1;return this.cssObject.scale.copy(a),this.cssObject.scale.multiplyScalar(s/30),this.onVisible(this.object.node.ensureVisible()),!0},e.prototype.onAdd=function(e){this.object=e,this.useSpriteMaterial?this.cssObject=new THREE.CSS3DSprite(this.domElement):this.cssObject=new THREE.CSS3DObject(this.domElement),this.object.app.cssScene.add(this.cssObject),this.onUpdate(),this.object.tickable=!0},e.prototype.onRemove=function(){this.cssObject&&(this.object.app.cssScene.remove(this.cssObject),this.cssObject=null),this.object=null},e.prototype.onVisible=function(e){this.cssObject.visible=e;var t=this.domElement.style;e?"visible"!=t.visibility&&(t.visibility="visible"):"hidden"!=t.visibility&&(t.visibility="hidden")},e}(),da=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._line=null,r._lineOffset=[0,0,0],r._factor=.01,r._initialSize=[1,1],r._size=[1,1],r._pivot=[.5,.5],r._useScaleMode=!1,r._useSpriteMaterial=!0,r._sizeAttenuation=!0,r._plane=null,r._planeSprite=null,r._sprite=null,r._canvas=null,r._url="",r}return a(t,e),t.prototype.setupEffects=function(){},t.prototype.updateConnectionLine=function(){if(!this._line)return!1;if(!this.parent)return!1;var e=THING.Math.addVector(this._lineOffset,this.position),t=this._lineToObject?this._lineToObject.position:this._lineToPosition;return this._line.setPoint(0,e),this._line.setPoint(1,t),!0},t.prototype._setupMaterial=function(e){var t=e.canvas,i=e.image,r=e.url;t?this.setCanvas(t):i?this.setImage(i):void 0!==r&&(this._url=r)},t.prototype._setupSprite=function(e){var t=this;this.loaded=!1,this._useSpriteMaterial=ke.parseValue(e.useSpriteMaterial,this._useSpriteMaterial);var i=e.element;if(i){var r=i.cloneNode(!0),n=ke.parseSize(e),o=new THREE.MeshBasicMaterial({colorWrite:!1,depthWrite:!1,transparent:!0,side:THREE.DoubleSide});o._pickable=!0;var a=new THREE.PlaneGeometry(1,1);this._plane=new THREE.Mesh(a,o),this._plane.frustumCulled=!1,this._plane.renderOrder=1,this._plane.userData.domElement=r,this._plane.userData.skipOutline=!0,this._plane.userData.skipStyle=!0,this._plane.userData.skipPickColorWrite=!0,this._plane.addBeforeRenderFunction("anchor",(function(e,i,r){var n=this.userData.domElement,o=n.offsetWidth,a=n.offsetHeight;if(o&&a){var s=o/a,l=new THREE.Vector3;l.x=o/30*t._size[0],l.y=l.x/s,l.z=1;var u=new THREE.Matrix4;if(t._useSpriteMaterial&&(u.copy(r.matrixWorldInverse),u.transpose()),u.copyPosition(this.matrixWorld),t._independentWorldScale)u.scale(t._independentWorldScale);else{var c=new THREE.Vector3;this.getWorldScale(c),u.scale(c)}u.scale(l),t._useSpriteMaterial&&(u.elements[3]=0,u.elements[7]=0,u.elements[11]=0,u.elements[15]=1),this.matrixWorld.copy(u)}})),this.node.add(this._plane);var s=new THREE.SpriteMaterial({colorWrite:!1,depthWrite:!1,transparent:!0});this._planeSprite=new THREE.Sprite(s),this._planeSprite.userData.cssFactor=n[0],this._planeSprite.userData.skipOutline=!0,this._planeSprite.userData.skipStyle=!0,this._planeSprite.userData.skipPick=!0,this.node.add(this._planeSprite),this.addControl(new pa(this._useSpriteMaterial,this._planeSprite,r))}else{var l=void 0;this.bindParams=e,e.loadTextureComplete=function(e){var t=e.material,i=(t._userData||{}).bindMarkers;i&&i.forEach((function(e){e._updateSpriteMaterial(t),e.synSize(),e.loaded=!0,e._callComplete(e.bindParams),l&&l(e),delete e.bindParams})),t._userData={}};var u=this.app.spriteResource.getMaterial(e);if((s=u.material)._userData=s._userData||{},s._userData.bindMarkers=s._userData.bindMarkers||[],s._userData.bindMarkers.push(this),s.isSpriteMaterial)this._sprite=new THREE.Sprite(s);else{a=new THREE.PlaneGeometry(this._size[0],this._size[1]);this._sprite=new THREE.Mesh(a,s)}if(u.needLoadTexture){var c=ke.parseValue(e.visible,!0);c&&(this._sprite.setLayerVisible(!1),l=function(e){ke.timer.setTimeout((function(){e._sprite.setLayerVisible(c)}),10)})}this._sprite.renderOrder=1,this._sprite.userData.skipOutline=!0,this._setupMaterial(e),this.synSize(),this.node.add(this._sprite)}},t.prototype._setupLineNode=function(e){if(this._lineToPosition=e.lineToPosition,this._lineToObject=e.lineToObject,void 0!==this._lineToPosition||void 0!==this._lineToObject){var t=e.lineColor,i=this._lineToObject?this._lineToObject.position:this._lineToPosition;this._line=this.app.create({type:"Line",parent:this,points:[this.position,i],color:t,style:{lineOpacity:e.lineOpacity,lineDashSize:e.lineDashSize,lineGapSize:e.lineGapSize,lineWidth:e.lineWidth}}),this.tickable=!0}},t.prototype._setupLocalPosition=function(e){var t=this.parent;if(t){var i=(e.offset||e.localPosition||[0,0,0]).concat();if(!ke.parseValue(e.ignoreParentBoundingBox,!1)){var r=t.getOrientedBox(!1),n=this.worldToLocal(r.center);i[0]+=n[0],i[1]+=n[1]+r.size[1]/2,i[2]+=n[2]}var o=ke.parseValue(e.ignoreParentScale,!1);this.setLocalPosition(i,o)}},t.prototype.customSetup=function(e){var t=this;this._sizeAttenuation=ke.parseValue(e.sizeAttenuation,!0),this.setupTranslation(e),e.skipSetupTranslation=!0,this._setupSprite(e),this._setupLineNode(e),e.width&&e.height?this._useScaleMode=!1:this._useScaleMode=!0,this._factor=e.factor||this._factor,this._initialSize=ke.parseSize(e),this._size=this._initialSize.concat();var i=e.pivot;i&&(this.pivot=i),this.one("load",(function(i){var r=e.pivotPixel;r&&(t.pivotPixel=r),t._useSpriteMaterial||t.node.getMaterials().forEach((function(e){e.envMap=null,e.needsUpdate=!0})),t.node.traverse((function(e){e.userData.skipEnvMap=!0}))})),this.synSize(),this._sizeAttenuation||this._sprite.skipBoundingBox(!0)},t.prototype._afterSetupComplete=function(e){var t=e.alwaysOnTop;t&&(this.style.alwaysOnTop=t)},t.prototype._notifyCompleteEvent=function(e){var t=this;ke.timer.setTimeout((function(){t.trigger("load",{object:t}),t.trigger("complete",{object:t})}),1)},t.prototype._callComplete=function(t){""!==this._url?this.image||this.canvas?e.prototype._callComplete.call(this,t):this.loaded=!1:e.prototype._callComplete.call(this,t)},t.prototype._updateSpriteTexture=function(e){this._sprite.material.map=e,this.loaded=!0},t.prototype._updateSpriteMaterial=function(e){var t=this._sprite.material,i=t.depthWrite,r=t.depthTest,n=t.color;this._sprite.material=e,e.depthWrite=i,e.depthTest=r,e.color=n,this.loaded=!0},t.prototype.destroy=function(){if(this._plane&&this._plane.removeBeforeRenderFunction("marker_element_plane"),this.app.spriteResource.unload(this.url),this._sprite){var t=this._sprite.material;if(t&&t._userData){var i=t._userData.bindMarkers;if(i){var r=i.indexOf(this);-1!==r&&i.splice(r,1)}}}e.prototype.destroy.call(this)},t.prototype.update=function(t){var i=e.prototype.update.call(this,t);return i|=this.updateConnectionLine()},t.prototype.synSize=function(){if(this._sprite){if(this._useScaleMode&&!this.overlay){var e=this._sprite.material.map;if(e){var t=e.image;t&&(this._size[0]=this._factor*t.width*this._initialSize[0],this._size[1]=this._factor*t.height*this._initialSize[1])}}}else this._planeSprite&&(this._planeSprite.userData.cssFactor=this._size[0]);if(this._keepSize){var i=this.getControl("SizeAdjustmentControl");i&&(i.size=this._size)}else this._sprite&&(this._sprite.scale.set(this._size[0],this._size[1],1),this.synIndependentWorldScale());this.static&&this.node._synMatrixWorld()},t.prototype._getIndependentControlRenderNode=function(){return this._sprite?this._sprite:e.prototype._getIndependentControlRenderNode.call(this)},t.prototype.cloneSelf=function(e){return e.localPosition=this.localPosition,e.size=this.size,this.url?e.url=this.url:this.canvas?e.canvas=this.canvas.clone():this.image&&(e.image=this.image.clone()),this.app.create(e)},t.prototype._updateCanvas=function(e){if(!e)return!1;var t=this._sprite;if(!t)return!1;var i=t.material;if(!i)return!1;var r=i.map;return!!r&&(r.image=e,r.needsUpdate=!0,!0)},t.prototype.setCanvas=function(e){if(e&&this._sprite){this._url="",this._canvas=e;var t=new THREE.Texture(e);t.needsUpdate=!0,this._updateSpriteTexture(t)}},t.prototype.setUrl=function(e){if(e){this.url&&this.app.spriteResource.unload(this.url),this._canvas=null,this._url=e;var t=this,i={url:e,alwaysOnTop:this.style.alwaysOnTop,useSpriteMaterial:this._useSpriteMaterial,loadTextureComplete:function(e){t.synSize()},loadComplete:function(e){var i=e.material;t._updateSpriteMaterial(i),t.trigger("urlchange",{image:i.map.image})}},r=this.app.spriteResource.getMaterial(i);if(r){var n=r.material;this._updateSpriteMaterial(n),this.synSize()}}},t.prototype.setImage=function(e){e&&(e.width&&e.height?(this._url="",this._updateSpriteTexture(this.app.resourceManager.loadTexture(e)),this.synSize()):console.error("[Marker] set image failed, please make sure image has width and height attribute"))},t.prototype._setScale=function(t){var i=THING.Math.scaleVector(t,[this._size[0],this._size[1],1]);i=THING.Math.divideVector(i,this.node.scale.toArray()),e.prototype._setScale.call(this,i)},t.prototype._getScale=function(){var t=THING.Math.divideVector(e.prototype._getScale.call(this),[this._size[0],this._size[1],1]);return t=THING.Math.scaleVector(this.node.scale.toArray(),t)},t.prototype.setPivot=function(e){var t=this._sprite;if(t)if(this._pivot=e,t.isSprite)e?t.center.set(e[0],1-e[1]):t.center.set(.5,.5);else if(this.tickable=!1,this.node.removeBeforeRenderFunction("pivot-marker"),e){var i=new THREE.Vector3,r=new THREE.Vector3(e[0]-.5,e[1]-.5,0),n=this;this.node.addBeforeRenderFunction("pivot-marker",(function(e,t,o){var a=n.getLocalBoundingBox().toBox();i.subVectors(a.max,a.min),i.multiply(r),i.applyMatrix4(n.node.matrixWorld),this.matrixWorld.setPosition(i)})),this.tickable=!0}},t.prototype.getPivot=function(){return this._pivot},t.prototype._updateKeepSize=function(t,i){var r=this._sizeAttenuation?60:960;e.prototype._updateKeepSize.call(this,t,this._sprite,this._size,r)&&this.synSize()},o(t,[{key:"isMarker",get:function(){return!0}},{key:"canvas",set:function(e){this._updateSpriteMaterial(this._sprite.material.clone()),this.setCanvas(e)},get:function(){return this._canvas}},{key:"url",set:function(e){this._url!=e&&this.setUrl(e)},get:function(){return this._url}},{key:"image",set:function(e){this._updateSpriteMaterial(this._sprite.material.clone()),this.setImage(e)},get:function(){var e=this._sprite;if(!e)return null;var t=e.material;if(!t)return null;var i=t.map;return i?i.image:null}},{key:"texture",set:function(e){e&&(e.isTexture?(this._updateSpriteTexture(e),this.synSize()):console.error("[Marker] set texture failed, please make sure provide THREE.Texture as value"))}},{key:"sizeAttenuation",get:function(){return this._sizeAttenuation}},{key:"size",set:function(e){ke.isNumber(e)?(this._size[0]=e,this._size[1]=e):this._size=e,this._initialSize=this._size.concat(),this.synSize()},get:function(){return this._size}},{key:"width",set:function(e){this._initialSize[0]=e,this._size[0]=e,this.synSize()},get:function(){return this._size[0]}},{key:"height",set:function(e){this._initialSize[1]=e,this._size[1]=e,this.synSize()},get:function(){return this._size[1]}},{key:"loaded",get:function(){return!(!this.image&&!this.canvas)&&e.prototype.loaded},set:function(t){e.prototype.loaded=t,t&&(this.style._syn(),this.style.hasUVAnimation()&&this.style.setUVAnimation(this.style.getUVAnimation()))}},{key:"factor",set:function(e){this._factor=e,this.synSize()},get:function(){return this._factor}},{key:"element",get:function(){return this._plane?this._plane.userData.domElement:null}},{key:"line",get:function(){return this._line}},{key:"lineOffset",set:function(e){var t=ke.parseValue(e,[0,0,0]);this._lineOffset=t.concat()},get:function(){return this._lineOffset.concat()}},{key:"pivot",set:function(e){this.setPivot(e)},get:function(){return this.getPivot()}},{key:"pivotPixel",set:function(e){var t=this.image;if(t){var i=t.width,r=t.height;this.pivot=[e[0]/i,e[1]/r]}},get:function(){var e=this.image;if(!e)return null;var t=e.width,i=e.height,r=this.pivot;return r?[Math.floor(r[0]*t),Math.floor(r[1]*i)]:null}},{key:"domElement",get:function(){return console.warn("[Building] Please use '.element' to replace '.domElement'"),this.element}}]),t}(bt),fa=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r.mixerPlane=null,r.domWidth=0,r.domHeight=0,r}return a(t,e),t.prototype._setupFromElement=function(e){var t=e.domElement;if(t){var i=e.position||[0,0,0],r=ke.parseSize(e),n=ke.parseQuaternion(e.angles),o=e.domWidth||t.offsetWidth,a=e.domHeight||t.offsetHeight,s={};return o&&a&&(s.elementW=o,s.planeW=1,s.planeH=a/o),this.mixerPlane=new THREEx.HtmlMixer.Plane(this.app.webViewManager.mixerContext,t,s),this.mixerPlane.setDomElement(t),this.node=this.mixerPlane.object3d,this.node.scale.multiply(new THREE.Vector3(r[0],r[1],1)),this.node.position.x=i[0],this.node.position.y=i[1],this.node.position.z=i[2],n&&this.node.quaternion.copy(n),this.node.updateMatrix(),!0}return!1},t.prototype.setupFromURL=function(e){var t=e.url;if(t){var i=e.domWidth,r=e.domHeight;i=i||e.width?100*e.width:0,r=r||e.height?100*e.height:0,e.domWidth=e.domWidth||i,e.domHeight=e.domHeight||r,this.domWidth=e.domWidth,this.domHeight=e.domHeight,i=i?i+"px":"",r=r?r+"px":"";var n=document.createElement("iframe");n.src=t,n.style.border="none",n.style.width=i,n.style.height=r,e.domElement=n,this._setupFromElement(e)}this._setup(e)},t.prototype.setupFromDom=function(e){this._setupFromElement(e),this._setup(e)},o(t,[{key:"isWebView",get:function(){return!0}},{key:"url",set:function(e){var t=this.position,i=this.scale,r=this.angles,n=this.domWidth,o=this.domHeight;this.app.resourceManager.remove(this.node),this.setupFromURL({url:e,position:t,size:i,angles:r,domWidth:n,domHeight:o})},get:function(){if(!this.mixerPlane)return null;var e=this.mixerPlane.domElement;return e?e.src:null}},{key:"pickable",set:function(e){this.mixerPlane.domElement.style.pointerEvents=e?"":"none"},get:function(){return""==this.mixerPlane.domElement.style.pointerEvents}}]),t}(bt),ma=new THREE.Color,ga=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._config={turbidity:10,rayleigh:2,luminance:1,mieCoefficient:.005,mieDirectionalG:.95,time:9,beta:45,light:!0,lightHelper:!1},r._skyNode=new va,r._skyNode.name="sky",r._skyNode.frustumCulled=!1,r._skyNode.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},r._lightGroup=null,r.noonColor=(new THREE.Color).setHex(16777215),r.earlyEveningColor=(new THREE.Color).setHex(16746816),r}return a(t,e),t.prototype.customSetup=function(e){this.node.add(this._skyNode),this.setConfig(e)},t.prototype.setConfig=function(e){for(var t in this._config)void 0!==e[t]&&(this._config[t]=e[t]);var i=this._skyNode.material.uniforms;i.turbidity.value=this._config.turbidity||10,i.rayleigh.value=this._config.rayleigh||2,i.luminance.value=this._config.luminance||1,i.mieCoefficient.value=this._config.mieCoefficient||.005,i.mieDirectionalG.value=this._config.mieDirectionalG||.95,i.mieFowardG_AVON_NIU={value:"avonniu"},ke.parseValue(e.auhnujuw,!1)&&(i.mieWithSkyBox={value:"#A180EA"});var r=this._config.time,n=r/24*360-90,o=this._config.beta,a=ke.parseVector3(THING.Math.directionFromAlphaBeta(n,o));if(a.normalize(),i.sunPosition.value.copy(a),i.moonPosition={value:"naijil"},i.moonDirection={value:"#148158"},this._config.light){this._lightGroup?this._lightGroup.visible||(this._lightGroup.visible=!0):this._lightGroup=this.app.create({type:"LightGroup",parent:this});var s=r<6||r>18,l=Math.min(1,Math.max(0,1-Math.abs(r-12)/6)),u=ma.copy(this.earlyEveningColor).lerp(this.noonColor,l);this._lightGroup.setConfig({showHelper:ke.parseValue(this._config.lightHelper,!1),ambientLight:{intensity:0},hemisphereLight:{intensity:Math.min(Math.max(s?0:l+.3,.2),.7),color:3310847,groundColor:16763007},mainLight:{shadow:!0,shadowQuality:"high",intensity:.5,color:u.toHexString(),alpha:n,beta:o},secondaryLight:{intensity:0},tertiaryLight:{intensity:0}},this.parent?this.parent.getLocalBoundingBox().toBox():this.app.root.getLocalBoundingBox().toBox())}else this._lightGroup&&(this._lightGroup.visible=!1)},t.prototype.getConfig=function(){return this._config},t}(bt),va=function(e){function t(){n(this,t);var i=ya,r=new THREE.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:THREE.UniformsUtils.clone(i.uniforms),side:THREE.BackSide});return s(this,e.call(this,new THREE.BoxBufferGeometry(1,1,1),r))}return a(t,e),t}(THREE.Mesh);va.prototype.isSky=!0;var ya={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new THREE.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvWorldPosition = position.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},ba=function(){function e(t){n(this,e),this.app=t,this._destroyed=!1}return e.prototype.setup=function(e){var t=e.parent;if(t instanceof bt){if(this._parent=t,this._parent){var i=this;this._parent.one("destroy",(function(){i._destroyed||i.destroy()}))}}else t&&console.error("[UIAnchor] Please make sure parent is BaseObject")},e.prototype.update=function(){return!1},e.prototype.destroy=function(){this.tickable=!1,this._destroyed=!0},o(e,[{key:"canNotQueryFromSelector",get:function(){return!0}},{key:"tickable",set:function(e){e?this.app.objectManager.addTickableObject(this):this.app.objectManager.removeTickableObject(this)}}]),e}(),_a=new THREE.Vector2,xa=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._element=null,r._autoUpdateVisible=!0,r._pivot=[.5,1],r._offset=[0,0,0],r._customWidth=0,r._customHeight=0,r}return a(t,e),t.prototype._updateVisible=function(e,t,i){var r=this.app.renderer.getSize(_a),n=i[0],o=i[1],a=i[2];return 0==e.visible||a>1||n<0||n>r.width||o<0||o>r.height?("hidden"!=t.visibility&&(t.visibility="hidden"),!1):("visible"!=t.visibility&&(t.visibility="visible"),!0)},t.prototype.setup=function(t){e.prototype.setup.call(this,t),this._element=t.container||t.el||t.element,this._position=t.position,this._offset=t.offset||t.localPosition||[0,0,0],this._customWidth=t.width,this._customHeight=t.height,this.pivot=t.pivot||this.pivot;var i=t.pivotPixel;i&&(this.pivotPixel=i),this.tickable=!0,this.update()},t.prototype.update=function(){var e=this._element;if(!e)return!1;var t=this._parent;if(null==t&&(t=this.app.root.defaultCampus),t.destroyed)return this.destroy(),!1;!1===this._prevParentVisible&&t.visible&&this.visible&&(delete this._prevParentVisible,this._autoUpdateVisible=!0);var i=this._position||t.boundingBox.center,r=this._offset,n=this.app.camera.worldToScreen([i[0]+r[0],i[1]+r[1],i[2]+r[2]]),o=e.style;if(this._autoUpdateVisible&&!this._updateVisible(t,o,n))return!0;"topview"==this.app.camera.viewMode?o.zIndex=1e3:o.zIndex=1e3-Math.ceil(1e4*n[2]-9900);var a=[0,0],s=e.offsetWidth,l=e.offsetHeight;Math.abs(e.cacheWidth-s)<1.5&&Math.abs(e.cacheHeight-l)<1.5?(s=e.cacheWidth,l=e.cacheHeight):(e.cacheWidth=s,e.cacheHeight=l),s=s||this._customWidth,l=l||this._customHeight,a[0]=Math.ceil(s*this._pivot[0]),a[1]=Math.ceil(l*this._pivot[1]);var u=this.app.domElement.offsetLeft-(e.parentElement?e.parentElement.offsetLeft:0),c=this.app.domElement.offsetTop-(e.parentElement?e.parentElement.offsetTop:0),h=Math.floor(n[0]-a[0]+u),p=Math.floor(n[1]-a[1]+c);return e.cacheLeft!=h&&(e.cacheLeft=h,o.left=h+"px"),e.cacheTop!=p&&(e.cacheTop=p,o.top=p+"px"),!0},t.prototype.destroy=function(){if(this._element){var t=this._element.parentNode;t&&t.removeChild(this._element)}e.prototype.destroy.call(this)},o(t,[{key:"pivot",set:function(e){this._pivot=e},get:function(){return this._pivot.concat()}},{key:"pivotPixel",set:function(e){var t=this._element,i=t.offsetWidth,r=t.offsetHeight;this._pivot=[e[0]/i,e[1]/r]},get:function(){var e=this._element,t=e.offsetWidth,i=e.offsetHeight;return[Math.floor(this._pivot[0]*t),Math.floor(this._pivot[1]*i)]}},{key:"position",set:function(e){this._position=e},get:function(){return this._position.concat()}},{key:"offset",set:function(e){this._offset=e},get:function(){return this._offset.concat()}},{key:"visible",set:function(e){var t=this._parent;t&&(e&&!t.visible?(this._prevParentVisible=!1,this._autoUpdateVisible=!1):this._autoUpdateVisible=e,this._element.style.visibility=e?"visible":"hidden")},get:function(){return"visible"==this._element.style.visibility}}]),t}(ba),Ea={classes:{},registerClass:function(e,t){this.classes[e]=t},hasClass:function(e){return!!this.classes[e]},create:function(e,t){return new(0,this.classes[e])(t)}},wa=function(){function e(t){n(this,e),this.app=t,this.objects=new Map,this._interactableNodes=[],this._renderDistanceObjects=[],this._shadowDistanceObjects=[],this.tickableObjects=[],this._pause=!1,this.registerDefaultClasses(),this.registerEvents()}return e.prototype.registerDefaultClasses=function(){Ea.registerClass("BaseObject",bt),Ea.registerClass("Box",Kt),Ea.registerClass("Circle",$t),Ea.registerClass("Sphere",ei),Ea.registerClass("Plane",ti),Ea.registerClass("Grid",ii),Ea.registerClass("Cylinder",ri),Ea.registerClass("Tetrahedron",ni),Ea.registerClass("Frustum",oi),Ea.registerClass("Shape",ai),Ea.registerClass("Campus",Et),Ea.registerClass("Ground",pi),Ea.registerClass("VideoSurvilance",di),Ea.registerClass("Outdoors",pr),Ea.registerClass("Group",dr),Ea.registerClass("Building",On),Ea.registerClass("Floor",hr),Ea.registerClass("Facade",kt),Ea.registerClass("Thing",Bt),Ea.registerClass("BatchObject",Xt),Ea.registerClass("BatchSubObject",Yt),Ea.registerClass("ProgressBar",Jt),Ea.registerClass("Door",si),Ea.registerClass("ElevatorDoor",li),Ea.registerClass("Elevator",ui),Ea.registerClass("StairDoor",ci),Ea.registerClass("Stair",hi),Ea.registerClass("Room",kn),Ea.registerClass("TextRegion",Yn),Ea.registerClass("CombinedObject",cr),Ea.registerClass("Fence",Jn),Ea.registerClass("CurveFence",Qn),Ea.registerClass("Region",Zn),Ea.registerClass("PolygonRegion",$n),Ea.registerClass("Heatmap",io),Ea.registerClass("IDWMap",ao),Ea.registerClass("Line",uo),Ea.registerClass("RouteLine",To),Ea.registerClass("PolygonLine",So),Ea.registerClass("Points",Ao),Ea.registerClass("MeshLine",ca),Ea.registerClass("Boundary",ha),Ea.registerClass("ParticleSystem",Go),Ea.registerClass("Water",Xo),Ea.registerClass("SpotLight",ua),Ea.registerClass("LightGroup",la),Ea.registerClass("Marker",da),Ea.registerClass("WebView",fa),Ea.registerClass("UI",xa),Ea.registerClass("UIAnchor",xa),Ea.registerClass("SceneRoot",Tt),Ea.registerClass("ViewProbe",ea),Ea.registerClass("SkyEffect",ga)},e.prototype.registerEvents=function(){this.app.on("beforeLoad",(function(e){e.castType=function(e,t,i){console.warn("[App] Please use 'THING.Utils.addCastType(name, condition, params)' to cast object type before load scenes"),ke.addCastType(e,t,i)}}))},e.prototype._canCastType=function(e,t,i){var r=[e];if(ke.isArray(i))for(var n=0;n<i.length;n++){var o=i[n];if(!(r=t.select(o,r)).length)break}else r=t.select(i,r);return!!r.length},e.prototype._castObject=function(e,t){var i=ke.getCastTypes();if(i.length){this._castTypeSelector||(this._castTypeSelector=new ct(this.app));for(var r=0;r<i.length;r++){var n=i[r];if(n.type!=t.type&&(ke.isFunction(t.getAttribute)||(t.getAttribute=function(e){return ke.getAttribute(t,e)}),this._canCastType(t,this._castTypeSelector,n.condition)))return t.type=n.type,t.skipCast=!0,t.skipSetup=!0,e.destroy(),t=ke.mergeObject(t,n.params,!0),this._createObject(t)}}return e},e.prototype._checkType=function(e){for(var t=[],i=0;i<t.length;i++){var r=t[i];if(r.oldType==e)return console.warn('The "'+e+'" is not support anymore, please use "'+r.newType+'" to replace it'),r.newType}return e},e.prototype._createObject=function(e){var t=e.type||"Thing",i=ke.parseValue(e.skipSetup,!1);t=this._checkType(t);var r=null;Ea.hasClass(t)&&(r=Ea.create(t,this.app)),r||(r=new Bt(this.app),console.warn("ObjectManager can not found type: <"+t+"> use <Thing> instead!"),t="Thing"),r._type=r._type||t;var n=r.isBaseObject;return i||(n&&(e.skipCast||(e.name=e.name||e.id,r=this._castObject(r,e))),r.setup(e)),this.app.needUpdate=!0,r},e.prototype.create=function(e){if(!e)return console.error("create object failed, due to param is null"),null;ke.isString(e)&&(e={type:e});var t=this._createObject(e);return t?(t.queryID&&this.objects.set(t.queryID,t),t):null},e.prototype.destroy=function(e){e&&(e.isBaseObject&&(e.trigger(k.Destroy,{object:e}),this.app.trigger(k.Destroy,{object:e})),e.queryID&&this.objects.delete(e.queryID),this.removeTickableObject(e))},e.prototype._addNode=function(e,t){return t.isBaseObject&&(t=t.node),ke.add(e,t)},e.prototype._removeNode=function(e,t){t.isBaseObject&&(t=t.node),ke.remove(e,t)},e.prototype._addObject=function(e,t){return ke.add(e,t)},e.prototype._replaceObject=function(e,t,i){for(var r=0;r<e.length;r++)e[r]==i&&(e[r]=t)},e.prototype._removeObject=function(e,t){ke.remove(e,t)},e.prototype.addInteractableNode=function(e){e&&(e.updateWorldMatrix(!0,!0),this._addNode(this._interactableNodes,e))},e.prototype.removeInteractableNode=function(e){e&&this._removeNode(this._interactableNodes,e)},e.prototype.addRenderDistanceObject=function(e){this._addObject(this._renderDistanceObjects,e)},e.prototype.removeRenderDistanceObject=function(e){this._removeObject(this._renderDistanceObjects,e)},e.prototype.addShadowDistanceObject=function(e){this._addObject(this._shadowDistanceObjects,e)},e.prototype.removeShadowDistanceObject=function(e){this._removeObject(this._shadowDistanceObjects,e)},e.prototype.get=function(e){if(e)if(e.isObject3D){var t=e.userData;if(t&&t.id)return this.get(t.id)}else if(this.objects.has(e))return this.objects.get(e);return null},e.prototype.getBaseObject=function(e){for(;e;){var t,i=e.userData;if(i.independent)return null;if(i.baseObject_bindSubNode_hooked)if(t=i.baseObject_bindSubNode)return t;if(i.isBaseObject)if((t=this.get(i.id))&&!t.isCombinedObject)return t;e=e.parent}},e.prototype.getObjectsArray=function(){var e=[];return this.objects.forEach((function(t){e.push(t)})),e},e.prototype.pause=function(){this._pause=!0},e.prototype.resume=function(){this._pause=!1},e.prototype.addTickableObject=function(e){for(var t=0;t<this.tickableObjects.length;t++)if(this.tickableObjects[t]==e)return;this.tickableObjects.push(e)},e.prototype.removeTickableObject=function(e){for(var t=0;t<this.tickableObjects.length;t++){if(this.tickableObjects[t]==e){e.isTickable=!1,this.tickableObjects[t]=null;break}}},e.prototype.replaceObject=function(e,t){this._replaceObject(this._renderDistanceObjects,e,t),this._replaceObject(this._shadowDistanceObjects,e,t),this._replaceObject(this.tickableObjects,e,t),this.objects.delete(t.queryID),this.objects.set(e.queryID,e)},e.prototype.update=function(){if(!this._pause)for(var e=this.app._deltaTime,t=this.tickableObjects,i=0,r=t.length;i<r;i++){var n=t[i],o=!1;if(n)n.update(e)?o=!0:n.isTickable=!1;o||(t.splice(i,1),i--,r--)}},e.prototype.onUpdate=function(e){this.update(e)},o(e,[{key:"interactableNodes",get:function(){return this._interactableNodes}},{key:"renderDistanceObjects",get:function(){return this._renderDistanceObjects}},{key:"shadowDistanceObjects",get:function(){return this._shadowDistanceObjects}}]),e}(),Ta=function(){function e(t){n(this,e),this.app=t,this.thresholdAngle=.1,this.enableRemoteData=!0,this.enableWebWorker=!0,this._map=new Map,this._resMap=new Map,this._taskNumber=0}return e.prototype.getByObject=function(e,t){var i=void 0;if(!e.geometry)return null;if(e.isLineSegments)return null;if("EdgesGeometry"==e.geometry.type)return null;if(t._extensionsFile&&this.enableRemoteData){if("_skip_wireframes_"===e._wName)return null;i=this.getByRes(e.geometry,t._url+"/"+t._extensionsFile,e._wName||e.name)}else i=this.get(e.geometry);return i},e.prototype.getByRes=function(e,t,i){var r=this,n=e.id;if(this._map.has(n))return this._map.get(n);var o=void 0;if(this._resMap.has(t)){var a=this._resMap.get(t);o=a instanceof Promise?a:Promise.resolve(a)}else o=fetch(t).then((function(e){return e.text()})).then((function(e){return e=JSON.parse(e),r._resMap.set(t,e),e})),this._resMap.set(t,o);var s=o.then((function(t){if(s._break)return Promise.reject({code:0});if(t.wireframe[i]){var o=new THREE.BufferGeometry;return o.addAttribute("position",new THREE.Float32BufferAttribute(t.wireframe[i].pos,3)),o.refCount=1/0,r._map.set(n,o),r._taskNumber--,r.app.events.dispatchEvent({type:"edges_task_progress",task:r._taskNumber}),e.addEventListener("dispose",(function(){return r.release(e)})),Promise.resolve(o)}return r._map.delete(n),r._taskNumber--,r.app.events.dispatchEvent({type:"edges_task_progress",task:r._taskNumber}),Promise.reject({code:1,msg:"can not find name: "+i})}));return this._taskNumber++,this._map.set(n,s),s},e.prototype.get=function(e){var t=this,i=void 0,r=e.id;return this._map.has(r)?i=this._map.get(r):(window.EW&&this.enableWebWorker?(e.isBufferGeometry||(e=(new THREE.BufferGeometry).fromGeometry(e)),i=EW.getGeometryInfo(e,this.thresholdAngle).then((function(n){if(i._break)return Promise.reject({code:0});var o=new THREE.BufferGeometry;return o.addAttribute("position",new THREE.BufferAttribute(n.position,3)),e.isInstancedBufferGeometry&&(o=Sa(e,o)),o.refCount=1/0,t._map.set(r,o),t._taskNumber--,t.app.events.dispatchEvent({type:"edges_task_progress",task:t._taskNumber}),e.addEventListener("dispose",(function(){return t.release(e)})),Promise.resolve(o)})),this._taskNumber++):(i=new THREE.EdgesGeometry(e,this.thresholdAngle),e.isInstancedBufferGeometry&&(i=Sa(e,i)),i.refCount=1/0),this._map.set(r,i)),i},e.prototype.synMaxInstancedCount=function(e){this._map.has(e.id)&&(this._map.get(e.id).maxInstancedCount=e.maxInstancedCount)},e.prototype.releaseRes=function(e){this._resMap.delete(e)},e.prototype.release=function(e){if(this._map.has(e.id)){var t=this._map.get(e.id);t.isBufferGeometry?t.dispose():t._break||(t._break=!0,this._taskNumber--,this.app.events.dispatchEvent({type:"edges_task_progress",task:this._taskNumber})),this._map.delete(e.id)}},e.prototype.releaseAll=function(){var e=this;this._map.forEach((function(t){t.isBufferGeometry?t.dispose():t._break||(t._break=!0,e._taskNumber--)})),this._map.clear(),this._resMap.clear(),this._taskNumber=0,this.app.events.dispatchEvent({type:"edges_task_progress",task:this._taskNumber})},e.prototype.getTaskNumber=function(){return this._taskNumber},e}();function Sa(e,t){var i=new THREE.InstancedBufferGeometry;for(var r in e.attributes)i.setAttribute(r,e.attributes[r]);return i.attributes.position=t.attributes.position,i.boundingBox=e.boundingBox?e.boundingBox.clone():null,i.boundingSphere=e.boundingSphere?e.boundingSphere.clone():null,i.maxInstancedCount=e.maxInstancedCount,i}var Aa=function(){function e(t){n(this,e),this.updateTime=1,this._array=[],this._sortDirty=!0,this._updateTimer=0}return e.prototype.push=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;this._array.push({mat:e,timer:t}),this._sortDirty=!0},e.prototype.update=function(e){if(this._updateTimer+=e,this._updateTimer>this.updateTime&&(this._updateTimer=0,this._array.length>0)){this._sortDirty&&(this._array.sort(Ma),this._sortDirty=!1);var t=0;this._array.forEach((function(i){(function(e,t){if(e.timer-=t,e.timer<0)return e.mat.dispose(),!0;return!1})(i,e)&&t++})),this._array.length-=t}},e.prototype.clear=function(){this._array.forEach((function(e){return e.mat.dispose()})),this._array.length=0},e}();function Ma(e,t){return t.timer-e.timer}var Ca=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._solidColor=null,r}return a(t,e),t.prototype._setAlwaysOnTop=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alwaysOnTop!=e||t){var i=this.obj._sprite;if(i){if(this._alwaysOnTop=e,this.isNeedRevertMaterials())return this._traverse((function(e){ke.revertValue(e,"renderOrder")})),void this.revertMaterial();this._cloneAndModifyMaterial((function(e,t,i){var r=t;ke.backupValue(r,"depthTest"),ke.backupValue(r,"depthWrite"),r.depthTest=!1,r.depthWrite=!1})),this._traverse((function(e){ke.backupValue(e,"renderOrder"),e.renderOrder=THING.BaseStyle.cAlwaysOnTopRenderOrderID}))}}},t.prototype.setUVAnimation=function(t){var i=this.obj._sprite;if(i){if(t){var r=i.material;t.uvDiscard?(r.defines=r.defines||{},r.defines.USE_UV_DISCARD=""):r.defines&&delete r.defines.USE_UV_DISCARD,r.needsUpdate=!0}e.prototype.setUVAnimation.call(this,t)}},t.prototype.setSolidColor=function(e){if(this._solidColor!=e){this._solidColor=ke.parseColor(e);["#ifdef GL_ES\n","precision highp float;\n","#endif\n","","varying vec4 worldId;","","void main() {","  gl_FragColor = "+this._solidColor.getHex()+";","}"].join("\n")}},o(t,[{key:"solidColor",set:function(e){return this.setSolidColor(e)},get:function(){return this._solidColor?this._solidColor.toHexString():null}},{key:"line",get:function(){return this.obj._line}},{key:"lineColor",set:function(e){this.line&&(this.line.style.lineColor=e)}},{key:"lineOpacity",set:function(e){this.line&&(this.line.style.lineOpacity=e)}},{key:"lineDashSize",set:function(e){this.line&&(this.line.style.lineDashSize=e)}},{key:"lineGapSize",set:function(e){this.line&&(this.line.style.lineGapSize=e)}},{key:"lineWidth",set:function(e){this.line&&(this.line.style.lineWidth=e)}}]),t}(Wn),Ra=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._lineColor=ke.parseColor("#00BFFF"),r._regionOpacity=.5,r._regionColor=ke.parseColor("#708090"),r}return a(t,e),t.prototype.isNeedCloneMaterials=function(){return!!e.prototype.isNeedCloneMaterials.call(this)||(!this._lineColor.equals(ke.parseColor("#00BFFF"))||(.5!=this._regionOpacity||!this._regionColor.equals(ke.parseColor("#708090"))))},o(t,[{key:"lineColor",set:function(e){var t=ke.parseColor(e);if(t){var i=this.obj._lineMesh;i&&(this._lineColor=t,i.material.color=t)}},get:function(){return this._lineColor.toHexString()}},{key:"regionColor",set:function(e){var t=ke.parseColor(e);if(t){var i=this.obj._areaMesh;i&&(this._regionColor=t,i.material.color=t)}},get:function(){return this._regionColor.toHexString()}},{key:"regionOpacity",set:function(e){if(ke.isNumber(e)){var t=this.obj._areaMesh;t&&(this._regionOpacity=e,t.material.opacity=e)}},get:function(){return this._regionOpacity}}]),t}(Wn),Da=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.setEffect=function(e){e=e||{};var t=this.obj;t._scale=e.scale||t._scale,t._color=e.color||t._color,t._flowDirection.x=e.flowXDirection||t._flowDirection.x,t._flowDirection.y=e.flowYDirection||t._flowDirection.y;var i=t.water.material.uniforms;i.color.value.set(t._color),i.config.value.w=t._scale,i.flowDirection.value.x=t._flowDirection.x,i.flowDirection.value.y=t._flowDirection.y},o(t,[{key:"waterColor",set:function(e){this.setEffect({color:e})},get:function(){return this.obj._color}},{key:"waterScale",set:function(e){this.setEffect({scale:e})},get:function(){return this.obj._scale}},{key:"flowXDirection",set:function(e){this.setEffect({flowXDirection:e})},get:function(){return this.obj._flowDirection.x}},{key:"flowYDirection",set:function(e){this.setEffect({flowYDirection:e})},get:function(){return this.obj._flowDirection.y}}]),t}(Wn),Pa=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),o(t,[{key:"image",set:function(e){if(this._image=e,e)if(e.isTexture)this._image=e.name,e.image&&(e.needsUpdate=!0),this.obj.synPathTexture(e);else{this._image=this.obj.app.confirmURL(e);var t=(new THREE.TextureLoader).load(this._image,(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.anisotropy=16}));this.obj.synPathTexture(t)}},get:function(){return this._image}},{key:"lineMaterial",get:function(){var e=this.obj.pathLine.material;return e.dashSize||e.gapSize?this.dashLineMaterial:this.basicLineMaterial}},{key:"basicLineMaterial",get:function(){var e=this.obj.pathLine.material;if(e.isLineBasicMaterial)return e;var t=new THREE.LineBasicMaterial({color:e.color,opacity:e.opacity,linewidth:e.lineWidth,transparent:e.transparent});return this.obj.pathLine.material=t,t}},{key:"dashLineMaterial",get:function(){var e=this.obj.pathLine.material;if(e.isLineDashedMaterial)return e;var t=new THREE.LineDashedMaterial({color:e.color,opacity:e.opacity,linewidth:e.lineWidth,transparent:e.transparent});return this.obj.pathLine.material=t,t}},{key:"lineColor",set:function(e){this.lineMaterial.color=ke.parseColor(e)},get:function(){return this.lineMaterial.color.toHexString()}},{key:"lineOpacity",set:function(e){this.lineMaterial.opacity=e},get:function(){return this.lineMaterial.opacity}},{key:"lineDashSize",set:function(e){this.lineMaterial.dashSize=e},get:function(){return this.lineMaterial.dashSize}},{key:"lineGapSize",set:function(e){this.lineMaterial.gapSize=e},get:function(){return this.lineMaterial.gapSize}},{key:"lineWidth",set:function(e){this.lineMaterial.lineWidth=e},get:function(){return this.lineMaterial.lineWidth}}]),t}(Wn);function ja(e,t,i){var r=[];t.forEach((function(t){var n=.09;"top"==i&&(n+=e.getRoomHeight()),r.push([t[0],t[1]+n,t[2]])}));var n=e.app.create({name:e.name+"_border_"+i,type:"RouteLine",image:e.app.confirmURL("image/light3.jpg"),parent:e,arrowFlag:!1,close:!0,side:"right",points:r,width:2});return n.cornerRadius=0,n.scrollSpeed=10,n.imageRepeat=[.025,1],n.pickable=!1,n.style.skipOutline=!0,n.scrollUV=!0,n.node.traverse((function(e){e.isMesh&&(e.userData.skipOutline=!0,e.material.transparent=!0,e.material.blending=THREE.AdditiveBlending)})),n}var Fa=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._volumeNode=null,r._volumeColor=null,r._volumeImage=null,r._volumeCanvas=null,r._borderLine=!1,r._borderLineTop=null,r._borderLineBottom=null,r}return a(t,e),t.prototype._synVolumeNode=function(){this._volumeColor||this._volumeImage||this._volumeCanvas||(this.obj.app.resourceManager.remove(this._volumeNode),this._volumeNode=null),this.obj._synTextRegion()},t.prototype._createVolumeNode=function(){if(!this._volumeNode){var e=this.obj.getFloorMesh();if(!e)return null;if(this._volumeNode=e.clone(),!this._volumeNode)return null;if(this._volumeNode.geometry=this._volumeNode.geometry.clone(),this._volumeNode.material=e.material.clone(),!this._volumeNode.material)return null;var t=this._volumeNode.material;t.map=null,t.transparent=!0,t.opacity=.5,this._volumeNode.geometry.genFaceVertexUVs(),e.parent.add(this._volumeNode);var i=e.position;this._volumeNode.position.setY(i.y+this.obj.getRoomHeight()+.05)}return this._volumeNode},o(t,[{key:"volumeColor",set:function(e){this._volumeColor=ke.parseColor(e);var t=this._createVolumeNode();t&&(e?t.material.color=ke.parseColor(e):t.material.color.set(1,1,1)),this._synVolumeNode()},get:function(){return null==this._volumeColor?null:this._volumeColor.toHexString()}},{key:"volumeOpacity",set:function(e){var t=this._createVolumeNode();t&&(t.material.opacity=e)},get:function(){return null==this._volumeNode?null:this._volumeNode.material.opacity}},{key:"volumeImage",set:function(e){this._volumeImage=e,this._volumeCanvas=null;var t=this._createVolumeNode();if(t){if(e){var i=new THREE.TextureLoader;i.setCrossOrigin("anonymous");var r=this.obj.app.confirmURL(e);e=i.load(r)}t.material.map=e,t.material.needsUpdate=!0}this._synVolumeNode()},get:function(){return this._volumeImage}},{key:"volumeCanvas",set:function(e){this._volumeCanvas=e,this._volumeImage=null;var t=this._createVolumeNode();t&&(e&&((e=new THREE.Texture(e)).needsUpdate=!0),t.material.map=e,t.material.needsUpdate=!0),this._synVolumeNode()},get:function(){return this._volumeCanvas}},{key:"volumeHeight",set:function(e){this._volumeNode&&(this._volumeNode.position.y=e)},get:function(){return this._volumeNode?this._volumeNode.position.y:0}},{key:"borderLine",set:function(e){if(e!=this._borderLine)if(e){var t=this.obj,i=t.points;this._borderLineTop=ja(t,i,"top"),this._borderLineBottom=ja(t,i,"bottom"),this._borderLine=!0}else this._borderLineTop.destroy(),this._borderLineBottom.destroy(),this._borderLineTop=null,this._borderLineBottom=null,this._borderLine=!1},get:function(){return this._borderLine}}]),t}(Wn),Oa=function(e){function t(i){n(this,t);var r=s(this,e.call(this,i));return r._lineColor=new THREE.Color(1,1,1),r}return a(t,e),o(t,[{key:"lineColor",set:function(e){this.obj._lineMesh.material.color=ke.parseColor(e)},get:function(){return this._lineColor.toHexString()}}]),t}(Wn),ka=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.setRenderOrder=function(e){this._renderOrder=e,this.obj.children.forEach((function(t){t.style.setRenderOrder(e)}))},t.prototype.setWireframe=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wireframe=e,this.obj.children.forEach((function(i){i.style.setWireframe(e,t)}))},t.prototype.setOpacity=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._opacity=e,this.obj.children.forEach((function(i){i.style.setOpacity(e,t)}))},t.prototype.setColor=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._color=ke.parseColor(e),this.obj.children.forEach((function(i){i.style.setColor(e,t)}))},t.prototype.setOutlineColor=function(e,t){this._outlineColor=ke.parseColor(e),this.obj.children.forEach((function(i){i.style.setOutlineColor(e,t)}))},t.prototype.setDefaultOutlineColor=function(e){this._defaultOutlineColor=ke.parseColor(e),this.obj.children.forEach((function(t){t.style.setDefaultOutlineColor(e)}))},t.prototype.setSkipBoundingBox=function(e){this.obj.children.forEach((function(t){t.style.setSkipBoundingBox(e)}))},t.prototype.setSkipOutline=function(e){this.obj.children.forEach((function(t){t.style.setSkipOutline(e)}))},t.prototype.setGlow=function(e){this._glow=e,this.obj.children.forEach((function(t){t.style.setGlow(e)}))},t.prototype.setInnerGlow=function(e){this._innerGlow=e,this.obj.children.forEach((function(t){t.style.setInnerGlow(e)}))},t.prototype.setVertexNormalHelper=function(e){this._vertexNormalNode={visible:e},this.obj.children.forEach((function(t){t.style.setVertexNormalHelper(e)}))},t.prototype.setAxisHelper=function(e){this._axisNode={visible:e},this.obj.children.forEach((function(t){t.style.setAxisHelper(e)}))},t.prototype.setEdgeColor=function(e){this._edgeColor=ke.parseColor(e),this.obj.children.forEach((function(t){t.style.setEdgeColor(e)}))},t.prototype.setBoundingBox=function(e,t){this._boundingBoxNode={visible:e,material:{color:ke.parseColor(t)}},this.obj.children.forEach((function(i){i.style.setBoundingBox(e,t)}))},t.prototype.setOrientedBoundingBox=function(e){this._orientedBoundingBoxNode={visible:e,material:{color:ke.parseColor(color)}},this.obj.children.forEach((function(t){t.style.setOrientedBoundingBox(e,color)}))},t.prototype.setAlwaysOnTop=function(e){this._alwaysOnTop=e,this.obj.children.forEach((function(t){t.style.setAlwaysOnTop(e)}))},t.prototype.setImage=function(e){this._image=e,this.obj.children.forEach((function(t){t.style.setImage(e)}))},t}(Wn),La=new Map,Ba=function(){function e(t){n(this,e),e.register("Default",{"*":Wn,Marker:Ca,PolygonRegion:Ra,TextRegion:Xn,Water:Da,Line:Pa,RouteLine:Pa,PolygonLine:Pa,Room:Fa,Frustum:Oa,Group:ka,BatchSubObject:Ht})}return e.register=function(e,t){La.set(e,t)},e.getStrategyMap=function(e){return La.get(e)},e.prototype.createStyle=function(e,t){var i,r=La.get(e);if(!r)return null;for(var n in r)if("*"!=n){var o=t["is"+n];if(t.type==n||!ke.isFunction(o)&&o)return new r[n](t)}else i=r[n];return i?new i(t):null},e.prototype.hasStyleStrategy=function(e){return La.has(e)},e}(),Ha=new THREE.Vector2,Ia=function(){function e(t){n(this,e),this.app=t,this.scene=this.app.scene,this.renderer=this.app.renderer,this.camera=this.app.renderCamera,this.init()}return e.prototype.init=function(){var e=new THREEx.HtmlMixer.Context(this.renderer,this.scene,this.camera);this.mixerContext=e;var t=e.rendererCss,i=this.renderer.getSize(Ha);t.setSize(i.width,i.height);var r=t.domElement;this.app.domElement.appendChild(r);var n=e.rendererWebgl,o=n.domElement;n.domElement._static||(o.style.position="absolute",o.style.top="0px",o.style.pointerEvents="none",r.appendChild(o))},e.prototype.resize=function(e,t){this.mixerContext.rendererCss.setSize(e,t)},e.prototype.update=function(){this.mixerContext.update()},e.prototype.onUpdate=function(e){this.update(e)},e}(),Na=function(){function e(t){n(this,e),this.eventTriggerManager=t,this.app=this.eventTriggerManager.app,this.domElement=this.app.mainDomElement,this.singleClickTimer=null,this.clickCountForSingleClick=0,this.dragStartFlag=!1,this.draggingFlag=!1,this._dragPrevPosition=null,this._draggingObject=null,this.mouseMoveEvents=[],this.mouseMoveObject=null,this.mouseDownPos={},this.mouseMovePos=[],this.mouseMoveDelta=null,this.keysPressed={},this.init()}return e.prototype.dispatchEvent=function(e){return this.eventTriggerManager.dispatchEvent(e)},e.prototype.getEventPosition=function(e,t){var i,r,n=this.domElement;if(n){var o=n.currentStyle||window.getComputedStyle(n,null),a=t?t[0]:parseInt(o.borderLeftWidth,10),s=t?t[1]:parseInt(o.borderTopWidth,10),l=n.getBoundingClientRect();i=e.clientX-a-l.left,r=e.clientY-s-l.top}else e.layerX||0==e.layerX?(i=e.layerX,r=e.layerY):e.offsetX||0==e.offsetX?(i=e.offsetX,r=e.offsetY):(e.clientX||0==e.clientX)&&(i=e.clientX,r=e.clientY);return{x:Math.round(i),y:Math.round(r)}},e.prototype.registerEventFunctions=function(e){ke.isNull(e.stopPropagation)&&(e.stopPropagation=function(){this._stopPropagation=!0})},e.prototype.createKeyboardEvent=function(e){var t={type:e.type,key:e.which,code:e.code,location:e.location,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey};return this.registerEventFunctions(t),t},e.prototype.createMouseEvent=function(e,t,i){var r=ke.parseVector2(i)||this.getEventPosition(t),n={type:e,clientX:r.x,clientY:r.y,x:r.x,y:r.y,button:t.button||0,buttons:t.buttons||0,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,pickedPosition:null};return this.registerEventFunctions(n),n.getPickedPos=function(){return console.warn("Please use .getPickedPosition() to replace .getPickedPos()"),n.pickedPosition},n.getPickedPosition=function(){return console.warn("Please use .pickedPosition to replace .getPickedPosition()"),n.pickedPosition},n},e.prototype.createDragEvent=function(e,t,i,r){var n=[void 0!==t.x?t.x:t.clientX,void 0!==t.y?t.y:t.clientY],o={type:e,x:n[0],y:n[1],clientX:n[0],clientY:n[1],altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey};return i&&(o.offsetX=i),r&&(o.offsetY=r),o.pickedPosition=null,this.registerEventFunctions(o),o.getPickedPos=function(){return console.warn("Please use .getPickedPosition() to replace .getPickedPos()"),o.pickedPosition},o.getPickedPosition=function(){return console.warn("Please use .pickedPosition to replace .getPickedPosition()"),o.pickedPosition},o},e.prototype.clearSingleClickTimer=function(){null!=this.singleClickTimer&&(ke.timer.clearTimeout(this.singleClickTimer),this.clickCountForSingleClick=0)},e.prototype.findMouseEventObject=function(e,t){for(;e;){for(var i=0;i<t.length;i++)if(e.hasEvent(t[i]))return e;e=e.parent}return null},e.prototype.processMouseOffEvent=function(e){var t=this.mouseMoveObject;if(t){var i=e.object;if(i){if(i.isBlockMouseOffEvent(t))return;var r=this.findMouseEventObject(t,["mouseleave","mouseoff"]);if(!r||i.isBlockMouseOffEvent(r))return;if(!r.visible)return;if(this.findMouseEventObject(i,["mouseleave","mouseoff"])==t)return;if(t==r){var n=this.mouseMoveLastPickedObject||e.object;this.dispatchEvent({type:k.MouseLeave,object:r,mouseOffObject:n,x:e.clientX,y:e.clientY}),this.dispatchEvent({type:"mouseoff",object:r,mouseOffObject:n,x:e.clientX,y:e.clientY})}}else for(var o=t;o;o=o.parent)o.trigger(k.MouseLeave,{object:o,mouseOffObject:this.mouseMoveObject,x:e.clientX,y:e.clientY}),o.trigger("mouseoff",{object:o,mouseOffObject:this.mouseMoveObject,x:e.clientX,y:e.clientY});this.mouseMoveObject=null}},e.prototype.processMouseOnEvent=function(e){var t=e.object,i=this.findMouseEventObject(t,["mouseenter","mouseon"]);if(i&&i.visible&&this.mouseMoveObject!=i){this.mouseMoveLastPickedObject=e.pickedObj;var r=this.dispatchEvent({type:k.MouseEnter,object:i,mouseOnObject:e.pickedObj,x:e.clientX,y:e.clientY});this.dispatchEvent({type:"mouseon",object:i,mouseOnObject:e.pickedObj,x:e.clientX,y:e.clientY}),this.mouseMoveObject=void 0!==r?r:i}},e.prototype.processMouseOverEvent=function(e){var t=e.object,i=this.findMouseEventObject(t,["mouseover"]);i&&this.dispatchEvent({type:"mouseover",object:i,x:e.clientX,y:e.clientY})},e.prototype.processHoverEvent=function(e){this.mouseMoveEvents.push(e)},e.prototype.createEvent=function(e,t){var i;return t=t||e.type,(i=E[t]?this.createMouseEvent(t,e):w[t]?this.createKeyboardEvent(e):e).preventDefault=function(){e.preventDefault()},i},e.prototype.initDoubleRightClickEvent=function(){var e,t,i,r,n=this;window.oncontextmenu=(e=function(e){n.clearSingleClickTimer();var t=n.createEvent(e,"dblclick");t.button=2,n.dispatchEvent(t)},t=0,i=!1,r=null,function(n){if(n.preventDefault(),i){clearTimeout(t),i=!1;var o=THING.Math.getDistance(r,[n.x,n.y]);if(o>1)return;return e.apply(this,arguments)}r=[n.x,n.y],i=!0,t=setTimeout((function(){i=!1}),300)})},e.prototype.initMouseEvent=function(e){var t=this,i=!0,r=!0;for(var n in this.initDoubleRightClickEvent(),E)this.domElement.addEventListener(n,(function(n){if("mousedown"==(n=t.createEvent(n)).type)t.mouseDownPos[n.button]=[n.x,n.y];else if("mouseup"==n.type)if(0==n.button)i=!(t.getDistanceOfLastMouseDown(n)>4);else if(2==n.button){var o=t.mouseDownPos[n.button];t.getDistanceOfLastMouseDown(n)<=4&&(t.dispatchEvent(t.createMouseEvent("click",n,o)),t.clearSingleClickTimer(),t.singleClickTimer=ke.timer.setTimeout((function(){t.dispatchEvent(t.createMouseEvent("singleclick",n,o))}),e))}if("click"==n.type){if(t.getDistanceOfLastMouseDown(n)>1)return;if(r=!0,t.clickCountForSingleClick++,1===t.clickCountForSingleClick){o=t.mouseDownPos[n.button];t.singleClickTimer=ke.timer.setTimeout((function(){i&&!t.draggingFlag?(r=!1,t.dispatchEvent(t.createMouseEvent("singleclick",n,o))):r=!0,i=!0,t.clickCountForSingleClick=0}),e)}else t.clearSingleClickTimer()}else if("dblclick"==n.type&&(t.clearSingleClickTimer(),!r))return void(r=!0);t.dispatchEvent(n),"mousemove"==n.type&&(t.mouseMoveDelta?t.mouseMoveDelta=[t.mouseMovePos[0]-n.x,t.mouseMovePos[1]-n.y]:t.mouseMoveDelta=[n.x,n.y],t.mouseMovePos=[n.x,n.y],0==n.buttons&&t.processHoverEvent(n))}),{passive:!1});this.domElement.addEventListener("mouseout",(function(e){0==e.buttons&&t.processMouseOffEvent(e)})),this.domElement.addEventListener("wheel",(function(e){var i=t.getEventPosition(e),r={type:k.MouseWheel,delta:e.deltaY,clientX:i.x,clientY:i.y,x:i.x,y:i.y};t.dispatchEvent(r)}),{passive:!1})},e.prototype.initKeyboardEvent=function(){var e=this;for(var t in w)window.addEventListener(t,(function(t){var i=t.which||t.keyCode;if("keydown"==t.type){if(e.keysPressed[i])return;e.keysPressed[i]=!0}else"keyup"==t.type&&(e.keysPressed[i]=!1);t=e.createEvent(t),e.dispatchEvent(t)}))},e.prototype.initDragEvent=function(){var e=this;this.domElement.addEventListener("mouseup",(function(t){0==t.button&&e.dragStartFlag&&(e.dragStartFlag=!1,e.draggingFlag=!1,e._dragPrevPosition=null,e._draggingObject=null,t=e.createEvent(t),e.dispatchEvent(e.createDragEvent("dragend",t)))})),this.domElement.addEventListener("mousemove",(function(t){if(t=e.createEvent(t),e.dragStartFlag){e.draggingFlag=!0;var i=e.createDragEvent("drag",t);e.dispatchEvent(i);var r=i.pickedPosition;r||(i.picked=!1),e._dragPrevPosition=e._dragPrevPosition||r,e._dragPrevPosition&&r?i.offsetPosition=THING.Math.subVector(r,e._dragPrevPosition):i.offsetPosition=[0,0,0];var n=e._draggingObject;n&&n.trigger("dragging",i),r&&(e._dragPrevPosition=r.concat())}else if(1==t.buttons){if(e.getDistanceOfLastMouseDown(t)>1){i=e.createDragEvent("dragstart",t);e.dispatchEvent(i);var o=i.dragObject;o&&o.draggable&&(e.dragStartFlag=!0,e._draggingObject=o)}}}))},e.prototype.initTouchEvent=function(e){var t=this,i=0,r=!1;this.domElement.addEventListener("touchstart",(function(e){e.preventDefault(),e=e.changedTouches[0],(e=t.createEvent(e,"touchstart")).button&&(t.mouseDownPos[e.button]=[e.clientX,e.clientY])})),this.domElement.addEventListener("touchmove",(function(e){e.preventDefault(),e=e.changedTouches[0],e=t.createEvent(e,"touchmove");var i=t.domElement.getBoundingClientRect(),n=(e.clientX-i.left)/i.width*2-1,o=-(e.clientY-i.top)/i.height*2+1;if(t.dragStartFlag)t.draggingFlag=!0,t.dispatchEvent(t.createDragEvent("drag",e,n,o));else{i=t.domElement.getBoundingClientRect(),n=(e.clientX-i.left)/i.width*2-1,o=-(e.clientY-i.top)/i.height*2+1;t.getDistanceOfLastMouseDown(e)>1&&(t.dragStartFlag=!0,t.dispatchEvent(t.createDragEvent("dragstart",e,n,o)))}r=!0})),this.domElement.addEventListener("touchend",(function(n){var o;(n.preventDefault(),n=n.changedTouches[0],n=t.createEvent(n,"touchend"),!r&&t.getDistanceOfLastMouseDown(n)<4)&&(i++,setTimeout((function(){i=0}),e),n.button&&(o=t.mouseDownPos[n.button]),i>1?(t.dispatchEvent(t.createMouseEvent("dblclick",n,o)),t.clearSingleClickTimer(),i=0):(t.clickCountForSingleClick++,t.dispatchEvent(t.createMouseEvent("click",n,o)),1===t.clickCountForSingleClick?t.singleClickTimer=setTimeout((function(){t.dispatchEvent(t.createMouseEvent("singleclick",n,o)),t.clickCountForSingleClick=0}),e):t.clearSingleClickTimer()));if(r=!1,t.dragStartFlag){t.dragStartFlag=!1;var a=t._draggingObject;a&&(a.trigger("dragend",t.createDragEvent("dragend",n)),t._draggingObject=null)}}))},e.prototype.init=function(){this.initMouseEvent(250),this.initTouchEvent(250),this.initKeyboardEvent(),this.initDragEvent()},e.prototype.getDistanceOfLastMouseDown=function(e){var t=this.mouseDownPos[e.button];if(!t)return 0;var i=[void 0!==e.x?e.x:e.clientX,void 0!==e.y?e.y:e.clientY];return THING.Math.getDistance(t,i)},e.prototype.clear=function(){this.singleClickTimer=null,this.mouseMoveObject=null,this.keysPressed={},this.mouseDownPos={},this.mouseMovePos=[],this.mouseMoveDelta=null},e.prototype.update=function(){var e=this;this.mouseMoveEvents.forEach((function(t){e.mouseMoveObject!=t.object&&(e.processMouseOffEvent(t),e.processMouseOnEvent(t),e.processMouseOverEvent(t))})),this.mouseMoveEvents=[]},e}(),Ua=function(){function e(t){n(this,e),this.app=t}return e.prototype.addEventListener=function(t,i,r,n,o,a,s,l){o=o||50,void 0===this._listeners&&(this._listeners={});var u=this._listeners;void 0===u[t]&&(u[t]=[]);var c=u[t],h={__index:e._eventIDCount++,app:this.app,type:t,userData:r,priority:o,tag:a,once:s,object:l,callback:n};i&&(i.isBaseObject?h.selector=i:(h.condition=i,h.selector=new ct(this.app))),c.length?(c.push(h),o>c[c.length-2].priority&&c.sort((function(e,t){return t.priority==e.priority?e.__index-t.__index:t.priority-e.priority}))):c.push(h);var p=THING.onAddEventListener;p&&p(h)},e.prototype.getEventListener=function(e,t,i,r,n,o,a){if(void 0===this._listeners)return null;var s=this._listeners[e];if(void 0===s)return null;if(!n&&this._isPauseEvent(e,o,r))return null;for(var l=0;l<s.length;l++){var u=s[l];if((!a||a(u))&&!(i&&u.callback!=i||r&&r!=u.tag)){if(u.condition){if("__any_event_can_match_it__"!=t&&u.condition!=t)continue;if(o!=this.app.root&&u.selector&&o&&!u.selector.select(u.condition,[o]).length)continue}else if(u.object!=o)continue;return{listener:u,listenerArray:s,index:l}}}return null},e.prototype.getEventListeners=function(e,t,i,r,n){if(void 0===this._listeners)return[];var o=function(e,t){var i=e.selector;if(i){if(i.isBaseObject){if(i!=t)return!1}else if(i.select(e.condition,[t]),!i.length)return!1}else if(e.object!=t)return!1;return!0},a=[],s=this._listeners;if(e){if(void 0===(c=s[e]))return[];if(!r&&this._isPauseEvent(e,n,i))return[];for(var l=0;l<c.length;l++){(h=c[l]).callback==t&&((i||h.tag)&&h.tag==i&&o(h,n)&&a.push(h))}}else for(var u in s){var c=s[u];if(r||!this._isPauseEvent(u,n,i))for(l=0;l<c.length;l++){var h;o(h=c[l],n)&&a.push(h)}}return a},e.prototype.removeEventListener=function(e,t,i,r,n){if(void 0!==this._listeners){var o=this._listeners[e];if(void 0!==o)for(var a=0;a<o.length;a++){if((i=o[a]).object==n){if(i.selector)if(i.selector.isBaseObject){if(t!=i.selector)continue}else if(i.condition!=t)continue;if(!r||i.tag==r){var s=THING.onRemoveEventListener;s&&s(i),i.removed=!0,o.splice(a--,1)}}}}},e.prototype.removeAllListeners=function(){var e=THING.onRemoveEventListener;if(e)for(var t in this._listeners)this._listeners[t].forEach((function(t){e(t)}));this._listeners=void 0},e.prototype.checkObject=function(e,t){if(t.object){if(t.object!=e.object&&!t.object.canAcceptEvent(e))return!1;if(this._getStopPropagation(e)){if(e.object&&e.object.isChildOf(t.object))return!1;var i=e.intersect;if(i&&i.node.isChildOf(e.object.node))return!1}}return!0},e.prototype._getStopPropagation=function(e){var t;if(!(t=ke.isFunction(e.stopPropagation)?e._stopPropagation:e.stopPropagation)){var i=e.type;-1!==["levelchange","enterlevel","leavelevel","levelflyend","load","complete"].indexOf(i)&&(t=!0)}return t=ke.parseValue(THING.__stopEventPropagation__,t)},e.prototype.getBindingObjectBySelector=function(e,t,i){var r=this._getStopPropagation(e);if(i.isBaseObject){if(i!=e.object&&!r&&i.isChildOf(e.object))return e.object}else if(e.object){if(i.select(t.condition,[e.object]),i.length)return i[0];if(!r){var n=e.object.parents;if(i.select(t.condition,n),i.length)return i[0]}}return null},e.prototype.getBindingObject=function(e,t,i){var r,n=t.selector,o=t.once;if(n){if(i)return null;if(!(r=this.getBindingObjectBySelector(e,t,n)))return null}else if(!this.checkObject(e,t))return null;var a=r||e.object||t.object||window;return o&&n&&a._ignoreEvents&&a._ignoreEvents.has(t)?null:a},e.prototype.dispatchEvent=function(e,t){if(void 0!==this._listeners){var i,r=this._listeners[e.type];if(void 0!==r)for(var n=r.slice(0),o=0;o<n.length;o++){var a=n[o],s=a.selector,l=a.userData,u=a.once,c=a.tag;if(!a.removed&&!this._isPauseEvent(e.type,e.object,c)){var h=this.getBindingObject(e,a,t);if(h&&!h.destroyed){var p,d,f=e.data;l&&(e.data=l),s?h.isBaseObject&&(p=e.object,e.object=h):a.object&&(p=e.object,e.object=a.object),e.object&&(d=e.pickedObject,e.pickedObject=e.object);var m=e.beforeTrigger;m&&m(e);var g=THING.onBeforeCallEventListener;g&&g(a,e);var v=a.callback.call(h,e,a.tag);ke.isNull(v)||(i=v);var y=THING.onAfterCallEventListener;y&&y(a,e);var b=e.beforeTrigger;if(b&&b(e),s?e.object==h&&(e.object=p):e.object==a.object&&(e.object=p),d?e.pickedObject=d:delete e.pickedObject,e.data=f,u)if(s)h._ignoreEvents&&h._ignoreEvents.add(a);else{var _=r.indexOf(a);-1!==_&&r.splice(_,1)}}}}return i}},e}();Ua._eventIDCount=1;var Va=function(){function e(t){n(this,e),this.app=t,this._pauseSelector=null,this._pauseEvents=new Map,this._resumeEvents=new Map}return e.prototype._isEvent=function(e,t,i,r,n){var o=e.get(t);if(!o)return!1;if(r&&o._tag_names&&!o._tag_names.has(r))return!1;for(var a=0,s=o.length;a<s;a++){var l=o[a],u=l.selector;if(i){if(ke.isString(i)){if(i!=u)continue}else if(u)if(u.isBaseObject){if(u!=i)continue}else if("*"!=u){if(!this._pauseSelector.select(u,[i]).length)continue}}else if(u)continue;if((!n||n(r,l.tag))&&(!l.parent||!i||i.isChildOf(l.parent)))return!0}return!1},e.prototype.isPauseEvent=function(e,t,i){function r(e,t){return!t||e==t}return e=ke.toLowerCase(e),!!this._isEvent(this._pauseEvents,e,t,i,r)&&!this._isEvent(this._resumeEvents,e,t,i,r)},e.prototype.isSameSelector=function(e,t){return e&&t&&e.isSelector&&t.isSelector?e.equals(t):e==t},e.prototype.update=function(){this._pauseEvents.forEach((function(e){for(var t=0;t<e.length;t++){e[t].justInFrame&&e.splice(t--,1)}}))},e.prototype.hasPauseEvent=function(e,t,i,r,n){var o=this._pauseEvents.get(e);if(!o)return!1;for(var a=0;a<o.length;a++){var s=o[a];if(this.isSameSelector(s.selector,t)&&(s.tag==i&&s.justInFrame==r&&s.parent==n))return!0}return!1},e.prototype.pauseEvent=function(e,t,i,r,n){if(e=ke.toLowerCase(e)){if(this._pauseSelector||(this._pauseSelector=new ct(this.app)),!this.hasPauseEvent(e,t,i,r,n)){var o={eventType:e,selector:t,tag:i,justInFrame:r,parent:n},a=this._pauseEvents.get(e);a||(a=[],this._pauseEvents.set(e,a)),i&&(a._tag_names=a._tag_names||new Set,a._tag_names.add(i)),a.push(o)}}else console.error("event type is invalid, please check it")},e.prototype.removeResumeEvents=function(e,t,i,r){var n=this._resumeEvents.get(e);if(n)for(var o=0;o<n.length;o++){var a=n[o];a.selector==t&&(a.parent==r&&(i&&i!=a.tag||n.splice(o--,1)))}},e.prototype.resumeEvent=function(e,t,i,r){if(e=ke.toLowerCase(e)){var n=this._pauseEvents.get(e);if(n){t||(r=null);for(var o=0;o<n.length;o++){var a=n[o];if(this.isSameSelector(a.selector,t)&&a.parent==r){if(a.tag){if(a.tag!=i)continue}else if(i){var s=this._resumeEvents.get(e);s||(s=[],this._resumeEvents.set(e,s)),s.push({eventType:e,selector:t,tag:i,parent:r});continue}return this.removeResumeEvents(e,t,i,r),n.splice(o,1),!0}}return!1}}else console.error("event type is invalid, please check it")},e.prototype.clear=function(){this._pauseSelector=null,this._pauseEvents=new Map,this._resumeEvents=new Map},e}(),za=function(){function e(t){n(this,e),this.app=t,this._eventSelectors={residentEvents:{name:"residentEvents"},app:{name:"app"},objectEvents:{name:"objectEvents"}};var i=this;this._eventSelectors.forEach=function(e){e(i._eventSelectors.residentEvents),e(i._eventSelectors.app),e(i._eventSelectors.objectEvents)},this._eventSelectors.hasEvent=function(e,t,r,n,o){for(var a=[i._eventSelectors.residentEvents,i._eventSelectors.app,i._eventSelectors.objectEvents],s=0;s<a.length;s++)if(a[s].hasEvent(e,t,r,n,o))return!0;return!1},this._eventSelectors.forEach((function(e){i._initEventSelector(e)})),this._eventPauser=new Va(this.app),this._eventIDCount=0}return e.prototype._initEventSelector=function(e){var t=this,i=new Ua(this.app);e._trigger=i,e._trigger._isPauseEvent=function(e,i,r){return t.isPauseEvent(e,i,r)},e.traverse=function(e){for(var t in i._listeners){if(!1===e(t,i._listeners[t]))return}},e.hasEvent=function(e,t,r,n,o){return!!i.getEventListener(e,"__any_event_can_match_it__",t,r,n,o)},e.getEvents=function(e,t,r,n,o){return i.getEventListeners(e,t,r,n,o)},e.replaceObjectEvent=function(e,t){for(var r in i._listeners)i._listeners[r].forEach((function(i){i.selector==t&&(i.selector=e),i.object==t&&(i.object=e)}))},e.removeObjectEvent=function(e,t,r,n,o){i.removeEventListener(e,t,r,n,o)},e.bindObjectEvent=function(e,t,r,n,o,a,s,l){var u=i.getEventListener(e,t,null,a,!1,l,(function(e){return!!a&&(!e.tag||!a||e.tag==a)}));u&&u.listenerArray.splice(u.index,1),i.addEventListener(e,t,r,n,o,a,s,l)},e.trigger=function(e,t){if(e.type=ke.toLowerCase(e.type),e.type)return i.dispatchEvent(e,t);console.error("event type is invalid, please check it")}},e.prototype.isPauseEvent=function(e,t,i){return this._eventPauser.isPauseEvent(e,t,i)},e.prototype.hasPauseEvent=function(e,t,i,r,n){return this._eventPauser.hasPauseEvent(e,t,i,r,n)},e.prototype.pauseEvent=function(e,t,i,r,n){this._eventPauser.pauseEvent(e,t,i,r,n)},e.prototype.resumeEvent=function(e,t,i,r){return this._eventPauser.resumeEvent(e,t,i,r)},e.prototype.hasEvent=function(e,t,i,r,n){return!!this._eventSelectors.hasEvent(e,t,i,r,n)},e.prototype.getEvents=function(e,t,i,r,n){var o=[];return this._eventSelectors.forEach((function(a){var s=a.getEvents(e,t,i,r,n);s&&s.forEach((function(e){o.push(e)}))})),o},e.prototype.replaceObjectEvent=function(e,t){this._eventSelectors.forEach((function(i){i.replaceObjectEvent(e,t)}))},e.prototype.removeObjectEvent=function(e,t,i,r,n){this._eventSelectors.forEach((function(o){o.removeObjectEvent(e,t,i,r,n)}))},e.prototype.addEventListener=function(e,t,i){return this.bindCall(e,null,null,t,null,!1,i)},e.prototype.removeEventListener=function(e,t){return this.unbindCall(e,null,t)},e.prototype.bindCall=function(e,t,i,r,n,o,a){if(!(e=ke.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var s=ke.parseEvent(t,i,r,n,null,a);return s?(s.selector?this._eventSelectors.objectEvents.bindObjectEvent(e,s.selector,s.userData,s.callback,s.priority,s.tag,o,this.app.root):this._eventSelectors.app.bindObjectEvent(e,s.selector,s.userData,s.callback,s.priority,s.tag,o,null),s):null},e.prototype.unbindCall=function(e,t,i){if(!(e=ke.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var r=ke.parseEvent(t,null,i);return r?(r.selector?this._eventSelectors.objectEvents.removeObjectEvent(e,r.selector,r.callback,r.tag,this.app.root):this._eventSelectors.app.removeObjectEvent(e,r.selector,r.callback,r.tag),r):null},e.prototype.triggerCall=function(e){return this._eventSelectors.app.trigger(e,!0)},e.prototype.bindCallObj=function(e,t,i,r,n,o,a,s){if(!(e=ke.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var l=ke.parseEvent(t,i,r,o,s);if(!l)return null;var u=this;return n.forEach((function(t){u._eventSelectors.objectEvents.bindObjectEvent(e,l.selector,l.userData,l.callback,l.priority,l.tag,a,t)})),l},e.prototype.unbindCallObj=function(e,t,i,r){e=ke.toLowerCase(e);var n=ke.parseEvent(t,null,i);if(!n)return null;var o=this;return r.forEach((function(t){o._eventSelectors.objectEvents.removeObjectEvent(e,n.selector,n.callback,n.tag,t)})),n},e.prototype.hasAnyCallObjects=function(e,t){var i=this._eventSelectors.objectEvents,r=!1,n=this;return i.traverse((function(i,o){if(o.object&&e.indexOf(o.object)){if(t&&n._isPauseEvent(i,o.object,o.tag))return;return r=!0,!1}})),r},e.prototype.dispatchBindCallObj=function(e,t,i,r){if(t=t||{},e=ke.toLowerCase(e)){if(ke.isString(t)&&!r&&(r=t,t={}),!r||ke.isString(r)){var n;ke.isNull(t.stopPropagation)&&(t.stopPropagation=function(){this._stopPropagation=!0});var o=this;return i.forEach((function(i){var a=t.object,s=t.type,l=t.tag;t.object=i,t.type=e,t.tag=r,n=o._eventSelectors.objectEvents.trigger(t),t.object=a,t.type=s,t.tag=l})),n}console.error('Trigger "'+e+'" failed, due to tag is not string type')}else console.error("event type is invalid, please check it")},e.prototype.addResidentEventListener=function(e,t){(e=ke.toLowerCase(e))?this._eventSelectors.residentEvents._trigger.addEventListener(e,null,null,t):console.error("event type is invalid, please check it")},e.prototype.removeResidentEventListener=function(e,t){(e=ke.toLowerCase(e))?this._eventSelectors.residentEvents._trigger.removeEventListener(e,null,t):console.error("event type is invalid, please check it")},e.prototype.update=function(){this._eventSelectors.forEach((function(e){e.trigger({type:"update"})})),this._eventPauser.update()},e.prototype.clear=function(){this._eventSelectors.forEach((function(e){e.removeAllListeners()})),this._eventPauser.clear()},e.prototype.unbindAppEvents=function(e){this._eventSelectors.forEach((function(t){for(var i in t._listeners)for(var r=t._listeners[i],n=0;n<r.length;n++){r[n].app.uuid==e&&r.splice(n--,1)}}))},e.prototype.dispatchEvent=function(e){var t=[];if(this._eventSelectors.forEach((function(i){var r=i.trigger(e);r&&t.push(r)})),t.length)return t[0]},e}(),qa=function(){function e(t){n(this,e),this.app=t,this.eventTriggerManager=new za(this.app),this.eventProcessor=new Na(this.eventTriggerManager)}return e.prototype.addResidentEventListener=function(e,t){this.eventTriggerManager.addResidentEventListener(e,t)},e.prototype.removeResidentEventListener=function(e,t){this.eventTriggerManager.removeResidentEventListener(e,t)},e.prototype.addEventListener=function(e,t,i){this.eventTriggerManager.addEventListener(e,t,i)},e.prototype.removeEventListener=function(e,t){this.eventTriggerManager.removeEventListener(e,t)},e.prototype.dispatchEvent=function(e){return this.eventTriggerManager.dispatchEvent(e)},e.prototype.update=function(){this.eventProcessor.update(),this.eventTriggerManager.update()},e.prototype.bindCall=function(e,t,i,r,n,o,a){return this.eventTriggerManager.bindCall(e,t,i,r,n,o,a)},e.prototype.unbindCall=function(e,t,i){return"singleclick"==e&&this.eventProcessor.clearSingleClickTimer(),this.eventTriggerManager.unbindCall(e,t,i)},e.prototype.triggerCall=function(e){return this.eventTriggerManager.triggerCall(e)},e.prototype.bindCallObj=function(e,t,i,r,n,o,a,s){return this.eventTriggerManager.bindCallObj(e,t,i,r,n,o,a,s)},e.prototype.unbindCallObj=function(e,t,i,r){return this.eventTriggerManager.unbindCallObj(e,t,i,r)},e.prototype.hasAnyCallObjects=function(e,t){return this.eventTriggerManager.hasAnyCallObjects(e,t)},e.prototype.dispatchBindCallObj=function(e,t,i,r){return this.eventTriggerManager.dispatchBindCallObj(e,t,i,r)},e.prototype.isPauseEvent=function(e,t,i){return this.eventTriggerManager.isPauseEvent(e,t,i)},e.prototype.pauseEvent=function(e,t,i,r,n){this.eventTriggerManager.pauseEvent(e,t,i,r,n)},e.prototype.resumeEvent=function(e,t,i,r){return this.eventTriggerManager.resumeEvent(e,t,i,r)},e.prototype.hasEvent=function(e,t,i,r){return this.eventTriggerManager.hasEvent(e,null,i,r,t)},e.prototype.getEvents=function(e,t,i,r){return this.eventTriggerManager.getEvents(e,null,i,r,t)},e.prototype.replaceObjectEvent=function(e,t){return this.eventTriggerManager.replaceObjectEvent(e,t)},e.prototype.canClick=function(e){return!(this.eventProcessor.getDistanceOfLastMouseDown(e)>4)},e.prototype.isKeyPressed=function(e){return!!this.eventProcessor.keysPressed[e]},e.prototype.clear=function(){this.eventTriggerManager.clear(),this.eventProcessor.clear()},e.prototype.unbindAppEvents=function(e){this.eventTriggerManager.unbindAppEvents(e)},o(e,[{key:"mousePosition",get:function(){return this.eventProcessor.mouseMovePos}}]),e}(),Wa=function(){function e(t,i,r){for(var o in n(this,e),this.app=t,this.name=i,this.defaultKeyName="name",this.initialState=null,this.runningState=null,this.states=new Map,r)this.addState(o,r[o])}return e.prototype.getFromState=function(e,t){var i=e[t.stateType];if(void 0!==i&&ke.isFunction(i)){var r=e[t.stateType](t);if(null!==r)return r}return null},e.prototype.dispatchEventToState=function(e,t){var i=e[t.stateType];void 0!==i&&ke.isFunction(i)&&e[t.stateType](t,t.params)},e.prototype.findState=function(e){return this.states.get(e)},e.prototype.prevState=function(){this.dispatchEvent({stateType:"onPrevState"})},e.prototype.nextState=function(){this.dispatchEvent({stateType:"onNextState"})},e.prototype.clone=function(t){var i={},r=this.app.stateManager.stateFactory,n=this.states.keys(),o=Array.isArray(n),a=0;for(n=o?n:n[Symbol.iterator]();;){var s;if(o){if(a>=n.length)break;s=n[a++]}else{if((a=n.next()).done)break;s=a.value}var l=s,u=r.get(l);if(!u)return null;i[l]=new u(this.app)}return new e(this.app,t,i)},e.prototype.get=function(e){if(this.runningState)return this.getFromState(this.runningState,e);if(this.states.length>1){var t=this.states,i=Array.isArray(t),r=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(r>=t.length)break;n=t[r++]}else{if((r=t.next()).done)break;n=r.value}var o=n,a=this.getFromState(o,e);if(null!==a)return a}}return null},e.prototype.dispatchEvent=function(e){var t=this;this.runningState?this.dispatchEventToState(this.runningState,e):this.states.length>1&&this.states.forEach((function(i){t.dispatchEventToState(i,e)}))},e.prototype.enter=function(e,t){t=t||{};var i=this.findState(e);if(!i)return null;this.initialState||(this.initialState=i);var r=this.runningState;return this.leave(),this.app.trigger("beforeEnterState",{state:r,nextState:i}),r&&(t.prevState=r),this.runningState=i,this.dispatchEventToState(this.runningState,{stateType:"onEnter",params:t}),this.app.trigger("afterEnterState",{state:i,prevState:t.prevState}),delete t.prevState,this.runningState},e.prototype.leave=function(){if(this.runningState){var e={};this.runningState&&(e.state=this.runningState,e.stateName=this.runningState[this.defaultKeyName]),this.app.trigger("beforeLeaveState",e),this.dispatchEventToState(this.runningState,{stateType:"onLeave"}),this.runningState=null,this.app.trigger("afterLeaveState",e)}},e.prototype.addState=function(e,t){void 0===t[this.defaultKeyName]&&(t[this.defaultKeyName]=e),t.isState=!0,t.stateGroup=this,this.states.set(e,t)},e.prototype.isInitialState=function(){return this.runningState==this.initialState},e.prototype.isRunningState=function(e){var t=this.findState(e);return!!t&&t==this.runningState},e.prototype.getRunningStateName=function(){if(this.runningState){var e=this.states.keys(),t=Array.isArray(e),i=0;for(e=t?e:e[Symbol.iterator]();;){var r;if(t){if(i>=e.length)break;r=e[i++]}else{if((i=e.next()).done)break;r=i.value}var n=r;if(this.runningState==this.states.get(n))return n}}return""},e.prototype.hasState=function(e){if(ke.isString(e))return this.states.has(e);var t=this.states.keys(),i=Array.isArray(t),r=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(r>=t.length)break;n=t[r++]}else{if((r=t.next()).done)break;n=r.value}var o=n;if(e==this.states.get(o))return!0}return!1},e.prototype.clear=function(){this.leave();for(var e=[].concat(this.states.values()),t=0;t<e.length;t++)delete e[t];delete this.states},e}(),Ga=function(){function e(t){n(this,e),this.app=t,this.eventManager=t.events,this.stateFactory=new Map,this.stateGroupID=1,this.stateGroups=new Array,this.init()}return e.prototype.init=function(){var e={click:"onClick",dblclick:"onDoubleClick",singleclick:"onSingleClick",mouseover:"onMouseOver",mouseout:"onMouseOut",mouseup:"onMouseUp",mousedown:"onMouseDown",mousemove:"onMouseMove",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",keydown:"onKeyDown",keypress:"onKeyPress",keyup:"onKeyUp"},t=this;for(var i in e)this.eventManager.addResidentEventListener(i,(function(i){i.stateType=e[i.type],t.dispatchEvent(i),delete i.stateType}))},e.prototype.clear=function(){this.stateFactory.clear(),this.stateGroupID=1,this.stateGroups=[]},e.prototype.findState=function(e){var t=this.stateGroups,i=Array.isArray(t),r=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(r>=t.length)break;n=t[r++]}else{if((r=t.next()).done)break;n=r.value}var o=n.findState(e);if(o)return o}return null},e.prototype.findStateGroup=function(e){var t=this.stateGroups,i=Array.isArray(t),r=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(r>=t.length)break;n=t[r++]}else{if((r=t.next()).done)break;n=r.value}var o=n;if(o.name==e||o.hasState(e))return o}return null},e.prototype.get=function(e){for(var t=0;t<this.stateGroups.length;t++){var i=this.stateGroups[t].get(e);if(i)return i}return null},e.prototype.dispatchEvent=function(e){ke.isString(e)?this.dispatchEvent({type:e}):this.stateGroups.forEach((function(t){t.dispatchEvent(e)}))},e.prototype._genGroupName=function(){var e="StateManagerInternal_"+this.stateGroupID.toString();return this.stateGroupID++,e},e.prototype.clone=function(e){var t=this.findStateGroup(e);if(!t)return null;e=this._genGroupName();var i=t.clone(e);return this.stateGroups.push(i),i},e.prototype.remove=function(e){for(var t=0;t<this.stateGroups.length;t++)if(this.stateGroups[t]==e)return e.leave(),this.stateGroups[t].clear(),this.stateGroups.splice(t,1),!0;return!1},e.prototype.register=function(e,t){if(ke.isNull(e))return null;if(ke.isArray(e))return console.error("states should not be array type, use {} instead"),null;var i=Object.keys(e);1==i.length&&void 0===t&&(t=i[0]),ke.isBlank(t)&&(t=this._genGroupName());var r=this.findStateGroup(t);if(r)for(var n in e)r.addState(n,e[n]);else r=new Wa(this.app,t,e),this.stateGroups.push(r);return r},e.prototype.registerEx=function(e,t){for(var i in e)this.stateFactory.set(i,e[i]),e[i]=new e[i](this.app);return this.register(e,t)},e.prototype.unregister=function(e){for(var t=0;t<this.stateGroups.length;t++)if(this.stateGroups[t].name==e)return this.stateGroups[t].clear(),this.stateGroups.splice(t,1),!0;return!1},e.prototype.change=function(e,t){var i=this.findStateGroup(e);if(!i)return console.error("state group not found: "+e),null;var r=i.enter(e,t);return r||null},e.prototype.leave=function(e){var t=this.findStateGroup(e);return t?!!t.isRunningState(e)&&(t.leave(),!0):(console.error("state group not found: "+e),!1)},e.prototype.getRunningState=function(e){var t=this.findStateGroup(e);return t?t.runningState:(console.error("state group not found: "+name),null)},e.prototype.getRunningStateName=function(e){var t=this.findStateGroup(e);return t?t.getRunningStateName():(console.error("state group not found: "+name),null)},e.prototype.hasRunningState=function(e){var t=this.findStateGroup(e);return!!t&&!!t.runningState},e.prototype.update=function(){this.dispatchEvent({stateType:"onUpdate"})},e.prototype.onUpdate=function(e){this.update(e)},e}(),Xa=function(){function e(t,i){n(this,e),this.app=t,this.reverseMode=i,this.commands=[]}return e.prototype.execute=function(){for(var e=0;e<this.commands.length;e++){this.commands[e].execute()}this.app.events.dispatchEvent({type:"executeCommand",cmd:this}),this.reverseMode&&this.commands.reverse()},e.prototype.undo=function(){for(var e=0;e<this.commands.length;e++){this.commands[e].undo()}this.reverseMode&&this.commands.reverse()},e.prototype.add=function(e){e&&this.commands.push(e)},e.prototype.remove=function(e){if(e){var t=this.commands.indexOf(e);t>-1&&this.commands.slice(t,1)}},e.prototype.clear=function(){this.commands.clear()},e}(),Ya=function(){function e(t){n(this,e),this.app=t,this.registerTypes={},this.undoList=[],this.redoList=[],this._doing=!1}return e.prototype.register=function(e,t){this.registerTypes[e]=t},e.prototype.unregister=function(e){delete this.registerTypes[e]},e.prototype._create=function(e){var t=e.type,i=this.registerTypes[t];if(i){e.app=this.app;var r=new i(e);return r.type=t,r}console.error("command not found: "+t)},e.prototype.create=function(e,t){if(ke.isArray(e)){for(var i=new Xa(this.app,t),r=0;r<e.length;r++){var n=this._create(e[r]);i.add(n)}if(i.commands.length)return i}else{if(ke.isObject(e))return n=this._create(e);ke.isString(e)}return null},e.prototype.execute=function(e,t){var i=this.create(e,t);return i?(i.execute(),this._push(i),this.app.events.dispatchEvent({type:"executeCommand",cmd:i}),i):null},e.prototype._push=function(e){this._doing||(this.undoList.push(e),this.redoList.splice(0,this.redoList.length),this.app.events.dispatchEvent({type:"push"}))},e.prototype.push=function(e){this._push(e)},e.prototype.redo=function(){if(0!=this.redoList.length){this._doing=!0;var e=this.redoList.pop();e.execute(),this.undoList.push(e),this.app.events.dispatchEvent({type:"executeCommand",cmd:e}),this.app.events.dispatchEvent({type:"redo",cmd:e}),this._doing=!1}},e.prototype.undo=function(){if(0!=this.undoList.length){this._doing=!0;var e=this.undoList.pop();e.undo(),this.redoList.push(e),this.app.events.dispatchEvent({type:"executeCommand",cmd:e}),this.app.events.dispatchEvent({type:"undo",cmd:e}),this._doing=!1}},e.prototype.getRedoCount=function(){return this.redoList.length},e.prototype.getUndoCount=function(){return this.undoList.length},e.prototype.toJson=function(){for(var e=0;e<this.undoList.length;e++)this.undoList[e];return"not impl~"},e}(),Ja=new THREE.Vector2,Qa=function(){function e(t){n(this,e),this.app=t,this.events=t.events,this.baseURL=t.baseURL,this.scene=t.scene,this.renderer=t.renderer,this.objectManager=t.objectManager,this.resourceManager=t.resourceManager,this._background=null,this._backgroundResource=null,this._backgroundAdditiveColor=new THREE.Color(0,0,0),this._backgroundColorScaleFactor=new THREE.Vector3(1,1,1),this._skyBox=null,this._skyBoxResource=null,this._fogEnable=!1,this._fogConfig={},this._fogLinear=null,this._fogExp2=null,this._enableDeafultViewPointFile=!1,this._defaultViewPointFileName="viewpoint.json",this._effectRefCounts={},this.init()}return e.prototype.init=function(){this.initRenderControl()},e.prototype.initRenderControl=function(){var e=new THREE.Vector3,t=new THREE.Vector3;function i(i,r){i.node.traverse((function(n){if(n.material){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(n.matrixWorld);var o=e.distanceTo(t);i.renderDistance>0&&(n.visible=o<i.renderDistance),i.shadowDistance>0&&(n.castShadow=o<i.shadowDistance)}}))}var r=this;this.app.scene.onBeforeRender=function(){var e=r.app.renderCamera;r.objectManager.renderDistanceObjects.forEach((function(t){i(t,e)})),r.objectManager.shadowDistanceObjects.forEach((function(t){i(t,e)}))}},e.prototype.synBackgroundColor=function(){var e=this._skyBoxResource;if(e&&e.isCubeTexture){e.colorMatrix=e.colorMatrix||new THREE.Matrix4;var t=this._backgroundAdditiveColor;if(t){var i=new THREE.Vector3(t.r,t.g,t.b);e.colorMatrix.setPosition(i)}var r=this._backgroundColorScaleFactor;if(r){var n=new THREE.Vector3(r.x,r.y,r.z);e.colorMatrix.setScale(n)}}},e.prototype._keepBackgroundAspect=function(){if(this._backgroundResource&&this._backgroundResource.isTexture){var e=this._backgroundResource,t=this.app.renderer.getSize(Ja),i=t.width/t.height,r=e.image.width/e.image.height;i>r?(e.offset.set(0,.5-r/i*.5),e.repeat.set(1,r/i)):(e.offset.set(.5-i/r*.5,0),e.repeat.set(i/r,1))}},e.prototype._resetBackgroundAspect=function(){if(this._backgroundResource&&this._backgroundResource.isTexture){var e=this._backgroundResource;e.offset.set(0,0),e.repeat.set(1,1)}},e.prototype.closeSkyEffect=function(){this.setSkyEffect(null)},e.prototype.setSkyEffect=function(e){e?(this._skyEffect||(this._skyEffect=this.app.create({type:"SkyEffect",parent:this.app.root})),this._skyEffect.setConfig(e),this._skyEffect.visible=!0,this.app._lightGroup&&(this.app._lightGroup.visible=!this._skyEffect.getConfig().light)):(this._skyEffect&&(this._skyEffect.visible=!1),this.app._lightGroup&&(this.app._lightGroup.visible=!0))},e.prototype.setFogLinear=function(e,t,i){e=ke.parseColor(e),this._fogLinear?(this._fogLinear.color.set(e),this._fogLinear.near=t,this._fogLinear.far=i):this._fogLinear=new THREE.Fog(e,t,i),this.app.scene.fog=this._fogLinear},e.prototype.clearFogLinear=function(){this._fogLinear&&(this._fogLinear=null,this.app.scene.fog=null)},e.prototype.setFogExp2=function(e,t){e=ke.parseColor(e),this._fogExp2?(this._fogExp2.color.set(e),this._fogExp2.density=t):this._fogExp2=new THREE.FogExp2(e,t),this.app.scene.fog=this._fogExp2},e.prototype.clearFogExp2=function(){this._fogExp2&&(this._fogExp2=null,this.app.scene.fog=null)},e.prototype.closeFog=function(){this.clearFogLinear(),this.clearFogExp2(),this._fogEnable=!1},e.prototype.setFog=function(e){e=e||{},this._fogConfig=ke.mergeObject(this._fogConfig,e,!0);var t=e.type,i=e.color||8421504;if("Exp2"==t){var r=e.density||.1;this.setFogExp2(i,r)}else{var n=e.near||10,o=e.far||100;this.setFogLinear(i,n,o)}this._fogEnable=!0,this.app.needUpdate=!0},e.prototype._updatEffectRefCounts=function(e,t){void 0===this._effectRefCounts[e]&&(this._effectRefCounts[e]=0);var i=this._effectRefCounts[e];this._effectRefCounts[e]+=t;var r=this.app.rendererManager._mainRenderer;0==i&&t>0?ke.isFunction(r.enable)&&r.enable(e):i>0&&0==this._effectRefCounts[e]&&ke.isFunction(r.disable)&&r.disable(e),this.app.rendererManager.needUpdate=!0},e.prototype.onResize=function(e,t){if(this._backgroundResource&&this._backgroundResource.isCanvasTexture){var i=this._backgroundResource,r=e/t,n=i.image.width/i.image.height;r<n?(i.offset.set(0,.5-n/r*.5),i.repeat.set(1,n/r)):(i.offset.set(.5-r/n*.5,0),i.repeat.set(r/n,1))}},e.prototype.onUpdate=function(e){this._backgroundResource&&this._backgroundResource.isCanvasTexture&&(this._backgroundResource.needsUpdate=!0)},e.prototype.showLightHelper=function(e){console.warn("[SceneManager] Please use app.lighting={ showHelper: "+e+" } instead"),this.app._lightGroup.setConfig({showHelper:e})},e.prototype.closeSceneLights=function(){console.warn("[SceneManager] Please use app.lighting=null instead"),this.app._lightGroup.setConfig(ia)},o(e,[{key:"background",set:function(e){if(this.background!=e){if(this._skyBox=null,this._backgroundResource&&this._backgroundResource.name!=e&&(this._backgroundResource.isTexture&&this._backgroundResource.dispose(),this._backgroundResource=null),this._background=e,e){var t=ke.parseColor(e,null);if(t)this.scene.background=t,this._backgroundResource=t;else if(ke.isString(e))if(this._backgroundResource)this.scene.background=this._backgroundResource;else{var i=this.app.confirmURL(e),r=this;(new THREE.TextureLoader).load(i,(function(t){r.scene.background=t,r._backgroundResource=t,r._backgroundResource.name=e,r.app.keepBackgroundAspect?r._keepBackgroundAspect():r._resetBackgroundAspect()}))}else"CANVAS"==e.tagName&&(this._backgroundResource=new THREE.CanvasTexture(e),this._backgroundResource.needsUpdate=!0,this.scene.background=this._backgroundResource)}else this.scene.background=ke.parseColor(this.app._bgColor);this.app.trigger("backgroundChanged",{background:e})}},get:function(){return this._background}},{key:"backgroundAdditiveColor",set:function(e){this._backgroundAdditiveColor=ke.parseColor(e),this.synBackgroundColor()},get:function(){return this._backgroundAdditiveColor.toHexString()}},{key:"backgroundColorScaleFactor",set:function(e){this._backgroundColorScaleFactor=ke.parseVector3(e),this.synBackgroundColor()},get:function(){return this._backgroundColorScaleFactor.toArray()}},{key:"skyBox",set:function(e){if(this.skyBox!=e){var t;this._background=null,this._skyBox=e,this.app.trigger("skyboxchange",{skyBox:e}),this._skyBoxResource&&(t=this._skyBoxResource.name==e?null:this._skyBoxResource);var i=this.app.confirmURL(ke.parseCubeTextureUrls(e));if(i)if(t||void 0===t){var r=this;this.app.resourceManager.loadCubeTexture(i,(function(i){r._skyBox==e&&(i.format=THREE.RGBFormat,r.scene.background=i,r._skyBoxResource=i,r._skyBoxResource.name=e,r.synBackgroundColor(),t&&t.dispose())}))}else this.scene.background=this._skyBoxResource;else this.scene.background=ke.parseColor(this.app._bgColor)}},get:function(){return this._skyBox}},{key:"enableDeafultViewPointFile",set:function(e){this._enableDeafultViewPointFile=e},get:function(){return this._enableDeafultViewPointFile}},{key:"defaultViewPointFileName",set:function(e){this._defaultViewPointFileName=e},get:function(){return this._defaultViewPointFileName}},{key:"fogEnable",get:function(){return this._fogEnable}},{key:"skyEffectEnable",get:function(){return!!this.sky}}]),e}(),Za=function(){function e(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n(this,e),this.app=t,this.textures=new Map,this.cubeTextures=new Map,this._canvas=null,this._enableFileNameAsKey=i,this.loader=new THREE.TextureLoader(this.app.loadingManager)}return e.prototype.isPowerOf2=function(e){return THING.Math.isPowerOf2(e.width)&&THING.Math.isPowerOf2(e.height)},e.prototype.makePowerOf2=function(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap?(this._canvas||(this._canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),this._canvas.width=THING.Math.floorPowerOf2(e.width),this._canvas.height=THING.Math.floorPowerOf2(e.height),this._canvas.getContext("2d").drawImage(e,0,0,this._canvas.width,this._canvas.height),this._canvas):e},e.prototype.loadCubeTexture=function(e,t){var i=this.app.confirmURL(ke.parseCubeTextureUrls(e));if(!i)return null;var r=this.cubeTextures.get(i.toString());return r?(r.refCount=r.refCount||1,r.refCount++,t&&t(r),r):((r=(new THREE.CubeTextureLoader).load(i,(function(e){var i=e.image;if(i&&6===i.length){for(var r=i[0].width,n=i[0].height,o=1;o<i.length;o++){var a=i[o];if(a.width!=r||a.height!=n)return void console.error("Load cube texture failed, due to image size is invalid, please make sure all size of images must be the same")}t&&t(e)}}))).key=i.toString(),this.cubeTextures.set(i.toString(),r),r)},e.prototype.load=function(e,t,i,r,n){var o,a=e.getNormalize();o=this._enableFileNameAsKey&&!n?a.getFileName(!1):a;var s=this.textures.get(o);if(s)return s.refCount++,t&&(s.image?setTimeout((function(){t(s)}),10):(s.delayLoadCallbacks=s.delayLoadCallbacks||[],s.delayLoadCallbacks.push(t))),s;var l=this;if(!(s=this.loader.load(a,(function(e){var i=e.image,r=l.textures.get(e.key);if(r){var n=r.delayLoadCallbacks;if(n){for(var o=0;o<n.length;o++)n[o](e);r.delayLoadCallbacks=[]}}var a=l.app.options.maxTextureSize;(i.width>a||i.height>a)&&console.warn("The '"+i.src+"' texture is too big("+i.width+"x"+i.height+"), max size: ("+a+"x"+a+")"),t&&t(e)}),i,r)))return null;s.key=o;var u=this.textures.get(o);return u?u.refCount++:(s.refCount=s.refCount||1,this.textures.set(o,s)),s},e.prototype.setCrossOrigin=function(e){return this.loader.setCrossOrigin(e),this},e.prototype.setPath=function(e){return this.loader.setPath(e),this},e.prototype._removeTexture=function(e,t){var i=e.get(t.key);if(i){if(i.refCount&&i.refCount--,i.refCount)return!1;t.dispose(),e.delete(t.key)}return!0},e.prototype.removeTexture=function(e){return!!this._removeTexture(this.textures,e)&&(!!this._removeTexture(this.cubeTextures,e)&&(e.dispose(),!0))},e.prototype.loadFromImage=function(e){var t=this.textures.get(e);return t?t.refCount++:((t=new THREE.Texture).image=e,t.needsUpdate=!0,t.key=e),t},o(e,[{key:"enableFileNameAsKey",set:function(e){this._enableFileNameAsKey=e},get:function(){return this._enableFileNameAsKey}},{key:"repetitionRate",get:function(){if(!this.textures.size)return 0;var e=0;return this.textures.forEach((function(t){e+=t.refCount})),e/this.textures.size-1}}]),e}(),Ka=function(){function e(t){n(this,e),this.app=t,this._deadObjects=[],this.init()}return e.prototype.init=function(){this.textureLoader=new Za(this.app,this.app.options.enableTextureFileNameAsKey),this.app.loadingManager.loadingManager.addHandler(/.*(.jpg|.png)$/,this.textureLoader)},e.prototype.disposeMaterial=function(e,t){if(void 0!==e.refCount){if(e.refCount--,e.refCount)return!1;e.dispose(),t||this.disposeTextures(e)}return!0},e.prototype.disposeTextures=function(e){if(e)for(var t in e){var i=e[t];i&&i.isTexture&&this.textureLoader.removeTexture(i)&&(e[t]=null)}},e.prototype.disposeGeometry=function(e){if(void 0!==e.refCount){if(e.refCount--,e.refCount)return!1;e.dispose()}else{if(this.app.scene.hasGeometry(e))return!1;e.dispose(),e._hasDisposed=!0}return!0},e.prototype.doDispose=function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(null!==e){if(i&&!1===i(e))return!1;if(r&&e.children)for(var n=e.children.concat(),o=0;o<n.length;o++){var a=this.doDispose(n[o],t,i);a&&e.remove(n[o])}var s=e.geometry;if(s&&!e.isSprite&&this.disposeGeometry(s),e.material){var l=!1;if(ke.isArray(e.material)){var u=e.material.concat();e.material=[];for(o=0;o<u.length;o++){var c=u[o];l=this.disposeMaterial(c,t)}}else l=this.disposeMaterial(e.material,t);l&&this.app.picker.removePickingResources(e)}e.isSkinnedMesh&&(t||this.disposeTextures(e.skeleton))}return!0},e.prototype.remove=function(e,t){e&&(e.removeBySelf(),this.unload(e,t))},e.prototype.unload=function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e&&(e.isObject3D?r?this._deadObjects.push({node:e,keepTexture:t,filterFunc:i,recursive:n}):this.doDispose(e,t,i,n):console.error("must provide Object3D to unload"))},e.prototype.loadCubeTexture=function(e,t){return this.textureLoader.loadCubeTexture(e,t)},e.prototype.loadTexture=function(e){return ke.isString(e)?this.textureLoader.load(e):this.textureLoader.loadFromImage(e)},e.prototype.onUpdate=function(){if(this._deadObjects.length){var e=this._deadObjects[0];this.doDispose(e.node,e.keepTexture,e.filterFunc,e.recursive),this._deadObjects.splice(0,1)}},e}(),$a=function(){function e(t){n(this,e),this.app=t;var i=this;this.loadingManager=new THREE.LoadingManager((function(){}),(function(e,t,r){0!=r&&i.app.mainUI.updateDownloadingProgress(t/r)}),(function(e){console.error("[onError] url: "+e)})),thingjs.GLTFLoader.defaultManager=this.loadingManager}return e.prototype.itemStart=function(e){this.loadingManager.itemStart(e)},e.prototype.itemEnd=function(e){this.loadingManager.itemEnd(e)},e.prototype.itemError=function(e){this.loadingManager.itemError(e)},e.prototype.resolveURL=function(e){return this.loadingManager.resolveURL(e)},e.prototype.setURLModifier=function(e){return this.loadingManager.setURLModifier(e)},e.prototype.getHandler=function(e){return this.loadingManager.getHandler(e)},e}(),es={temporalSuperSampling:{enable:!1,size:30},postEffect:{enable:!1,bloom:{enable:!1,strength:.14,radius:.4,threshold:.7},screenSpaceAmbientOcclusion:{enable:!1,radius:.2,quality:"medium",intensity:.8,temporalFilter:!0,ignoreTransparent:!1},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1.15,saturation:1.2,gamma:1},vignette:{enable:!1,type:"blur",color:0,offset:1.5},blur:{enable:!1,radius:5,bounds:[[0,0,.5,.5],[.5,.5,1,1]]},FXAA:{enable:!1},MSAA:{enable:!0}}},ts=function(){function e(t,i){n(this,e),this._manager=t,this._defaultConfig=ke.cloneObject(i,!1),this._config=ke.cloneObject(i,!1)}return e.prototype.setConfig=function(e){return this._config=ke.cloneObject(e,!1),this},e.prototype.getConfig=function(){return this._config},e.prototype.save=function(){return this._defaultConfig=ke.cloneObject(this._config,!1),this},e.prototype.mergeConfig=function(e){return e=ke.cloneObject(e,!1),ke.mergeObject(e,this._config),this._config=e,this},e.prototype.mergeWithSavedConfig=function(e){return e=ke.cloneObject(e,!1),ke.mergeObject(e,this._defaultConfig),this._config=e,this},e.prototype.lock=function(){return this._manager.lock(this),this},e.prototype.unlock=function(){return this._manager.unlock(this),this},e.prototype.update=function(e){return this._manager._update(this,e),this},e.prototype.active=function(e){return this._manager._active(this,e),this},e.prototype.destroy=function(){this._manager=null,this._config=null,this._defaultConfig=null},e}(),is=function(){function e(){n(this,e),this._lockedControl=null,this._control=null}return e.prototype.createControl=function(e){return new ts(this,e)},e.prototype.lock=function(e){this._lockedControl=e},e.prototype.unlock=function(e){this._lockedControl===e&&(this._lockedControl=null)},e.prototype.getActiveControl=function(){return this._control},e.prototype.getCurrentControl=function(){return this._lockedControl||this._control},e.prototype._active=function(e,t){return this._lockedControl!==e&&(this._control=e),this._lockedControl||this._control},e.prototype._update=function(e,t){var i=this.getCurrentControl();return i===e?i:null},e.prototype.destroy=function(){this._lockedControl=null,this._control=null},e}();var rs=new THREE.Vector2,ns=function(e){function t(i){n(this,t);var r=s(this,e.call(this));r.app=i,i.renderer.localClippingEnabled=!0;var o=i.renderer.getDrawingBufferSize(rs),a=o.width,l=o.height;return r._mainRenderer=new ir(a,l),r._captureRenderTarget=new THREE.WebGLRenderTarget(a,l,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),r._captureBuffer=new Uint8Array(4*a*l),r}return a(t,e),t.prototype.createControl=function(e){return new os(this,e)},t.prototype._active=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.app.root.box;t=e.prototype._active.call(this,t),this._mainRenderer.setConfig(t._config,i)},t.prototype._update=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.app.root.box,r=e.prototype._update.call(this,t);r&&this._mainRenderer.setConfig(r._config,i)},t.prototype.update=function(){this._mainRenderer.render(this.app.renderer,this.app.scene,this.app.renderCamera);var e=this.app.cssScene;e.children.length&&this.app.cssRenderer.render(e,this.app.renderCamera),this.app.picker.render(this.app.renderer)},t.prototype.resize=function(e,t){this.app.renderer.setSize(e,t),this.app.cssRenderer.setSize(e,t);var i=this.app.renderer.getDrawingBufferSize(rs);this._mainRenderer.setSize(i.width,i.height),this._resizeCaptureBuffer(e,t)},t.prototype._resizeCaptureBuffer=function(e,t){this._captureRenderTarget.setSize(e,t);var i=4*e*t;this._captureBuffer.length!==i&&(this._captureBuffer=new Uint8Array(i))},t.prototype.capture=function(e,t){var i=this.app.renderer.getSize(rs);e=e||i.width,t=t||i.height,this._mainRenderer.setSize(e,t),this.app.renderCamera.setSize(e,t),this._resizeCaptureBuffer(e,t);var r=this.app.postEffect.postEffect.blur.enable;return this.app.postEffect={postEffect:{blur:{enable:!1}}},this._mainRenderer.render(this.app.renderer,this.app.scene,this.app.renderCamera,this._captureRenderTarget),this.app.renderer.readRenderTargetPixels(this._captureRenderTarget,0,0,this._captureRenderTarget.width,this._captureRenderTarget.height,this._captureBuffer),function e(t,i,r,n){if(Array.isArray(t)){for(var o=e(new Float64Array(t),i,r,n),a=0;a<t.length;a++)t[a]=o[a];return t}if(!i||!r)throw Error("Bad dimensions");n||(n=t.length/(i*r));for(var s=r>>1,l=i*n,u=new(0,t.constructor)(i*n),c=0;c<s;++c){var h=c*l,p=(r-c-1)*l;u.set(t.subarray(h,h+l)),t.copyWithin(h,p,p+l),t.set(u,p)}return t}(this._captureBuffer,this._captureRenderTarget.width,this._captureRenderTarget.height),this._mainRenderer.setSize(i.width,i.height),this.app.renderCamera.setSize(i.width,i.height),this.app.postEffect={postEffect:{blur:{enable:r}}},this._captureBuffer},t.prototype.captureToDataURL=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpeg",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.app.renderer.getSize(rs);e=e||o.width,t=t||o.height;var a=this.capture(e,t),s=new Uint8ClampedArray(a.buffer),l=document.createElement("canvas"),u=l.getContext("2d");l.width=e,l.height=t;var c=u.createImageData(e,t);c.data.set(s),u.putImageData(c,0,0),"jpg"==i&&(i="jpeg");var h="image/"+(i.isBlank()?"jpeg":i),p=l.toDataURL(h,r);return n&&(p=p.replace(h,"image/octet-stream")),p},t.prototype.replaceRenderer=function(e){this._mainRenderer=e,this._mainRenderer.setConfig(this.getCurrentControl()._config)},t.prototype.closePostEffect=function(){console.warn("[RendererManager] Please use app.postEffect={} instead"),this.app.renderEffects.mergeConfig({postEffect:{enable:!1}}).update()},o(t,[{key:"renderOutline",set:function(e){this._mainRenderer.enableOutline=e}},{key:"needUpdate",set:function(e){e&&this._mainRenderer.dirty()}},{key:"temporalSuperSampling",set:function(e){console.warn("[RendererManager] Please use app.postEffect={} instead"),this.app.renderEffects.mergeConfig({temporalSuperSampling:{enable:e}}).update()},get:function(){return console.warn("[RendererManager] Please use app.postEffect instead"),this.app.renderEffects.getConfig().temporalSuperSampling.enable}},{key:"SSAO",set:function(e){console.warn("[RendererManager] Please use app.postEffect={} instead"),this.app.renderEffects.mergeConfig({postEffect:{screenSpaceAmbientOcclusion:{enable:e}}}).update()},get:function(){return console.warn("[RendererManager] Please use app.postEffect instead"),this.app.renderEffects.getConfig().postEffect.screenSpaceAmbientOcclusion.enable}},{key:"postEffectEnable",get:function(){return console.warn("[RendererManager] Please use app.postEffect instead"),this.app.renderEffects.getConfig().postEffect.enable}}]),t}(is),os=function(e){function t(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:es;return n(this,t),s(this,e.call(this,i,r))}return a(t,e),t}(ts),as=function(){function e(t){n(this,e),this.app=t,this.xmlhttp=null,this.time=1500,this.simulate=!0,this.url="",this.cache=!0,this._stop=!1,this._curInterval=null,this.callback=null}return e.prototype.start=function(e){if(this._stop=!1,this.url=null,null!=e&&(null!=e.interval&&(this.time=e.interval),null!=e.url&&(this.url=e.url),null!=e.simulate&&(this.simulate=e.simulate),null!=e.cache&&(this.cache=e.cache),null!=e.callback&&(this.callback=e.callback)),null==this.url||1==this.simulate){var t=parent.getUserPath();if(!t)return void console.log("Service Data Path Error");this.url=t}this._ajax(),console.log("Service startup complete")},e.prototype.stop=function(){this._stop=!0,null!=this._curInterval&&window.clearTimeout(this._curInterval),console.log("Service stop complete")},e.prototype._ajax=function(){var e=this;function t(){4==e.xmlhttp.readyState&&(200==e.xmlhttp.status?(!function(t){var i=null;i=1==Array.isArray(t)?t[0]:t;for(var r in i){var n=e.app.query(r);if(n.length>0){var o=i[r];for(var a in o)n[0].attr(a,o[a])}}}(JSON.parse(e.xmlhttp.responseText)),null!=e.callback&&e.callback(e.xmlhttp.getResponseHeader("last-modified"))):console.log("Problem retrieving XML data:"+e.xmlhttp.statusText),0==e._stop&&(e._curInterval=window.setTimeout((function(){e._ajax()}),e.time)))}!function(i){e.xmlhttp=null,window.XMLHttpRequest&&(e.xmlhttp=new XMLHttpRequest),null!=e.xmlhttp?(e.xmlhttp.onreadystatechange=t,0==e.cache&&(i=-1==i.lastIndexOf("?")?i+"?time="+(new Date).getTime():i+"&time="+(new Date).getTime()),e.xmlhttp.open("GET",i,!0),e.xmlhttp.send(null)):console.error("Your browser does not support XMLHTTP.")}(e.url)},e}(),ss=function(){function e(t){n(this,e),this.app=t,this.viewPointList=[],this.timeoutNumer=null,this._flyCallback=null,this._playIndex=0,this.playLoop=!1,this._pickedObjects=new Set}return e.prototype.start=function(){var e=this;this.app.on(k.Pick,(function(t){e._pickedObjects.add(t.object)}))},e.prototype.create=function(e,t){null==e&&(e={name:"新视点"}),null==e.flyTime?e.flyTime=1e3:"string"==typeof e.flyTime&&(e.flyTime=Number(e.flyTime)),null==e.waitTime?e.waitTime=0:"string"==typeof e.waitTime&&(e.waitTime=Number(e.waitTime));var i=this._take(e);null==t?this.viewPointList.push(i):this.viewPointList.splice(t,0,i)},e.prototype.delete=function(e){e>=0&&e<this.viewPointList.length&&this.viewPointList.splice(e,1)},e.prototype.recover=function(e){try{var t=this,i=this.viewPointList[e],r=null;null!=i.events&&(r=function(){for(var e=i.events,r=0;r<e.length;r++){var n=e[r],o=t.app.query("#"+n.id);if(o.length>0)for(var a=0;a<n.event.length;a++)o[0].dispatch(n.event[a])}}),0!=i.waitTime?(null!=t.timeoutNumer&&clearTimeout(t.timeoutNumer),this.timeoutNumer=setTimeout((function(){t._fly(i,r),t.timeoutNumer=null}),i.waitTime)):this._fly(i,r)}catch(e){console.log(e)}},e.prototype.update=function(e,t,i){if(null!=e){null==t&&(t={}),"string"==typeof t.flyTime&&(t.flyTime=Number(t.flyTime)),"string"==typeof t.waitTime&&(t.waitTime=Number(t.waitTime));var r={};return i?r=this._take(t,e):(r=this.viewPointList[e],null!=t.flyTime&&(r.flyTime=t.flyTime),null!=t.waitTime&&(r.waitTime=t.waitTime),null!=t.flyTime&&(r.name=t.name)),this.viewPointList[e]=r,r}},e.prototype.play=function(e){null!=e&&(this.playLoop=e),this._playIndex=0,this._flyCallback=null,this.viewPointList.length>0&&this._next()},e.prototype.pause=function(e){void 0===e&&(e=!0),e?(null!=this.timeoutNumer&&clearTimeout(this.timeoutNumer),this.app.camera.flying&&this.app.camera.stopFlying()):this.viewPointList.length>0&&this._next()},e.prototype.swap=function(e,t){var i=this.viewPointList[e][e];return this.viewPointList[e][e]=this.viewPointList[e][t],this.viewPointList[e][t]=i,this.viewPointList[e]},e.prototype.stop=function(){null!=this.timeoutNumer&&clearTimeout(this.timeoutNumer),this.app.camera.flying&&this.app.camera.stopFlying(),this._flyCallback=null,this._pickedObjects.clear()},e.prototype.saveJSON=function(){var e={name:"视点动画",pointList:this.viewPointList};return JSON.stringify(e)},e.prototype.loadJSON=function(e){var t=e;"string"==typeof e&&(t=JSON.parse(e)),null!=t.pointList&&(this.viewPointList=t.pointList)},e.prototype.clearAll=function(){stop(),this.viewPointList=[]},e.prototype._take=function(e,t){var i={};null!=t&&(i=this.viewPointList[t]),null!=e.flyTime&&(i.flyTime=e.flyTime),null!=e.waitTime&&(i.waitTime=e.waitTime),null!=e.name&&(i.name=e.name),i.position=this.app.camera.position,i.target=this.app.camera.target,i.up=this.app.camera.up,i.image=this.app.captureScreenshotToImage(140,118,"jpeg",.1);var r=this._getPickedEvents();return r.length>0&&(i.events=r),i},e.prototype._getPickedEvents=function(){for(var e=[],t=this._pickedObjects,i=0,r=t.length;i<r;i++){var n=t[i];if(n){var o={id:n.id,event:[]};n.hasEvent("click")&&o.event.push("click"),n.hasEvent("singleclick")&&o.event.push("singleclick"),0!=o.event.length&&e.push(o)}}return this._pickedObjects.clear(),e},e.prototype._fly=function(e,t){var i=this,r={position:e.position,target:e.target,time:e.flyTime,complete:function(e){null!=t&&t(),null!=i._flyCallback&&i._flyCallback()}};e.up&&(r.up=e.up),i.app.camera.flyTo(r)},e.prototype._next=function(){var e=this;if(this._playIndex>this.viewPointList.length-1){if(0==this.playLoop)return void(this._flyCallback=null);this.play()}this._flyCallback=function(){e._playIndex+=1,e._next()},this.recover(this._playIndex)},e}(),ls=function(){function e(t){n(this,e),this.app=t,this._modelBaseURL="https://model.3dmomoda.cn/models/",this._objectLoader=new Mn(t)}return e.prototype.initOptions=function(e){this.app.resourceManager.textureLoader},e.prototype.parseDoorOrWindow=function(e,t,i){var r=this;function n(e,t){var i=r.app.objectManager.create({type:"Door",id:t.id,name:t.name,node:t.delayObject,parent:e,animations:t.resource.animations,properties:t.properties});if(t.isOpen&&i.open(),i.animationClips)for(var n=0;n<i.animationClips.length;n++){var o=i.animationClips[n];if("_defaultAnim_"===o.name){i.playAnimation({name:o.name,loop:!0,speed:.15});break}}return i}t.mesh?n():t.initCompleteCallback=function(t){var i=n(e,t);e.miscNode.add(i.node)}},e.prototype.parseWall=function(e,t,i){for(var r=0;r<t.doorOrWindows.length;r++){var n=t.doorOrWindows[r];this.parseDoorOrWindow(e,n,i)}},e.prototype.parseGroups=function(e,t,i){for(var r=0;r<t.groups.length;r++){var n=t.groups[r],o="Thing";n.jsonData&&n.jsonData.type&&(o=n.jsonData.type);this.app.objectManager.create({id:n.id,name:n.name,node:n.delayObject,type:o,parent:e,properties:n.properties})}},e.prototype.parsePlacements=function(e,t,i){for(var r=0;r<t.placements.length;r++){var n=t.placements[r],o="Thing";if(n.jsonData&&n.jsonData.type&&(o=n.jsonData.type),n.mesh){var a=this.app.objectManager.create({id:n.id,type:o,name:n.name,node:n.delayObject,parent:e,url:n.resource.getModelUrl(),animations:n.resource.animations,properties:n.properties});if(a.bundleID=n.resource.modelID,a.bundleName=n.resource.modelName,n.isPlayAnim&&a.containAnimation(n.animClip)){var s={name:n.animClip,loop:!1,speed:.15};n.hasSkin&&(s.loop=!0),a.playAnimation(s)}}}},e.prototype.parseRooms=function(e,t,i){for(var r=0;r<t.rooms.length;r++){var n=t.rooms[r];this.app.objectManager.create({type:"Room",name:n.name,node:n.mesh,id:n.userID,ceilingNode:n.ceiling.mesh,roofNode:n.roof.mesh,floorNode:n.floor.mesh,parent:e,properties:n.properties})}},e.prototype.createCombinedObject=function(e,t,i){var r=new THREE.Object3D(t),n=this.app.create({type:"CombinedObject",visible:!0,node:r,parent:e});return n.node.visible=!1,n.userData.type=i,n},e.prototype.parsePlan=function(e,t,i){for(var r=this.createCombinedObject(e,"combineFloor","CombineFloorParent").node,n=0;n<t.combineFloors.length;n++){var o=t.combineFloors[n];r.add(o)}var a=this.createCombinedObject(e,"combineCeiling","CombineCeilingParent").node;for(n=0;n<t.combineCeilings.length;n++){var s=t.combineCeilings[n];a.add(s)}var l=this.createCombinedObject(e,"combineRoof","CombineRoofParent").node;for(n=0;n<t.combineRoofs.length;n++){var u=t.combineRoofs[n];l.add(u)}var c=this.createCombinedObject(e,"combinePlacement","CombineMiscParent").node;for(n=0;n<t.combinePlacements.length;n++){var h=t.combinePlacements[n];c.add(h)}for(var p=this.createCombinedObject(e,"combineWall","CombineWallParent").node,d=0;d<t.combineStraightManualWalls.length;d++){var f=t.combineStraightManualWalls[d];p.add(f)}for(d=0;d<t.combineModelWalls.length;d++){f=t.combineModelWalls[d];p.add(f)}for(d=0;d<t.combineDoorOrWins.length;d++){h=t.combineDoorOrWins[d];p.add(h)}},e.prototype.parseFloor=function(e,t,i){var r=t.buildings[0].floorplans[0];this.parsePlan(e,r,i),this.parseGroups(e,r,i),this.parsePlacements(e,r,i),this.parseRooms(e,r,i);for(var n=0;n<r.walls.length;n++){var o=r.walls[n];this.parseWall(e,o,i)}},e.prototype._generateWindow=function(e,t){var i=void 0!==e.typeId?e.typeId:"15DA293545E84A3680F93CF7D4227BD9";this.app.create({type:"Door",name:e.key,url:this._modelBaseURL+i+"/0/gltf/",localPosition:[.01*e.pos[0],3*e.suspendpercent,.01*e.pos[1]],parent:t,complete:function(){this.scale=[.01*e.width/this.boundingBox.initSize[0],.01*e.height/this.boundingBox.initSize[1],1],this.angles=[0,-e.rotation,0]}})},e.prototype._generateDoor=function(e,t){var i=void 0!==e.typeId?e.typeId:"d8ff0aaa4e87439bbededc8c6590491c";this.app.create({type:"Door",name:e.key,url:this._modelBaseURL+i+"/0/gltf/",localPosition:[.01*e.pos[0],0,.01*e.pos[1]],parent:t,complete:function(){this.scale=[.01*e.width/this.boundingBox.initSize[0],.01*e.height/this.boundingBox.initSize[1],1],this.angles=[0,-e.rotation,0]}})},e.prototype.parseDoorsAndWindows=function(e,t,i){var r=this;t.doors.forEach((function(t){t.suspendpercent?r._generateWindow(t,e):r._generateDoor(t,e)}))},e.prototype.load=function(e,t,i){t=this.app.confirmURL(t);var r=this;new THREE.FileLoader(this.app.loadingManager).load(t+"/scene.json",(function(t){var n=JSON.parse(t);r.loadFromData(e,n,i)}))},e.prototype.loadFromData=function(e,t,i){var r=this;i=i||{},this.initOptions(i);var n=function(e,t){var i={version:"2",unit:t=t||1,walls:[],rooms:[],doors:[],textures:[],models:[]},r=e.structure;return i.textures=e.textures,i.models=e.models,i.walls=r.walls.map((function(e){if(void 0===e.sourceType)return{weight:e.thickness,start:[100*e.points[0],100*e.points[1]],end:[100*e.points[2],100*e.points[3]],height:e.height,type:0,lefttexture:0,righttexture:0,edgetexture:1};var t={weight:e.thickness,start:[100*e.points[0],100*e.points[1]],end:[100*e.points[2],100*e.points[3]],height:e.height,type:e.sourceType,lefttexture:e.lefttexture,righttexture:e.righttexture,edgetexture:e.edgetexture};return!1===e.visible&&(t.isshow=!1),0!=e.sourceType&&(t.model=e.model),t})),i.rooms=r.rooms.map((function(e){var t=[100*e.textLoc[0],100*e.textLoc[1]],i={id:e.key,points:[],holes:[],center:t,floortexture:e.floorTexture,floorblocksize:e.floorBlockSize,floorheight:e.floorHeight,rooftexture:e.roofTexture,roofblocksize:e.roofBlockSize,roofheight:e.roofHeight,ceilingtexture:e.ceilingTexture,ceilingblocksize:e.ceilingBlockSize,ceilingheight:e.ceilingHeight};return void 0!==e.userId&&(i.userid=e.userId),!1===e.floorVisible&&(i.isshowfloor=!1),!1===e.ceilingVisible&&(i.isshowceiling=!1),void 0===e.roofVisible&&(i.isshowroof=!1),e.polygons.forEach((function(e,t){for(var r=0===t?i.points:[],n=0;n<e.length/2;n++)r.push([100*e[2*n+0],100*e[2*n+1]]);0!==t&&i.holes.push(r)})),i})),r.doors.forEach((function(e){var t=r.walls[e.wallIndex];e.loc;var n=[t.points[0],t.points[1]],o=[t.points[2],t.points[3]],a=[100*(n[0]+(o[0]-n[0])*e.loc),100*(n[1]+(o[1]-n[1])*e.loc)],s=i.models[e.typeIndex],l={key:e.key,typeId:s.id,width:100*e.size[0],height:100*e.size[2],pos:a,rotation:cs(t)};i.doors.push(l)})),r.windows.forEach((function(e){var t=r.walls[e.wallIndex],n=[t.points[0],t.points[1]],o=[t.points[2],t.points[3]],a=[100*(n[0]+(o[0]-n[0])*e.loc),100*(n[1]+(o[1]-n[1])*e.loc)],s=i.models[e.typeIndex],l={key:e.key,typeId:s.id,width:100*e.size[0],height:100*e.size[2],suspendpercent:.4,pos:a,rotation:cs(t)};i.doors.push(l)})),i}(t,1),o=i.complete;json2mesh.DefaultSetting.enableFloorLightMap=ke.parseValue(i.enableFloorLightMap,!1);var a=this._createLoader(n.version);a.load({json:n}).then((function(t){r.parseFloor(e,t,i)})).then((function(){return a.loadResources()})).then((function(){r.parseDoorsAndWindows(e,n,i)})).then((function(){var i=[];for(var n in t.objects)t.objects[n].forEach((function(n){i=i.concat(r._objectLoader.parse(n,t,e))}));return Promise.all(i)})).then((function(){o&&o(e)})).catch((function(e){return console.warn(e)}))},e.prototype._createLoader=function(e){if(e&&new xt(e).major>=2)return new json2mesh.ThingjsEditorSceneLoader_2_0(this.app.options);return new json2mesh.ThingjsEditorSceneLoader},e}(),us=new THREE.Vector2;function cs(e){return us.set(e.points[0]-e.points[2],e.points[1]-e.points[3]),us.angle()/Math.PI*180}var hs=function(){function e(t){n(this,e),this.app=t,this._loading=!1,this._updateTime=0,this._loadingFloors=[],this._initEvents()}return e.prototype._initEvents=function(){var e=this;this.app.on("levelchange",(function(t){var i=t.current;if(i instanceof On){e._loadingFloors.sort((function(e,t){return e.owner.parent!=i?1:t.owner.parent!=i?-1:e.owner.indexOfBuilding-t.owner.indexOfBuilding}))}else if(i instanceof hr){e._loadingFloors.sort((function(e,t){return e.owner==i?-1:t.owner==i?1:e.owner.node.id-t.owner.node.id}))}}))},e.prototype.update=function(){if(this._loadingFloors.length&&!(this._loading||(this._updateTime+=this.app._deltaTime,this._updateTime<.25))){this._updateTime=0;var e=this._loadingFloors[0],t=e.owner,i=e.url,r=e.jsonData,n=e.options,o=this,a=n.complete;n.complete=function(e){a&&a(e),o._loading=!1},this._loading=!0;var s=new ls(this.app);i?s.load(t,i,n):s.loadFromData(t,r,n),this._loadingFloors.splice(0,1)}},e.prototype.load=function(e,t,i){this._loadingFloors.push({owner:e,url:t,options:i})},e.prototype.loadFromData=function(e,t,i){this._loadingFloors.push({owner:e,jsonData:t,options:i})},e.prototype.onUpdate=function(e){this.update(e)},e}(),ps=function(e){THREE.ShaderMaterial.call(this,{uniforms:{baseId:{type:"f",value:0},size:{type:"f",value:.01},scale:{type:"f",value:400}},vertexShader:e?"\n\t#include <common>\n\t#include <logdepthbuf_pars_vertex>\n\t#include <skinning_pars_vertex>\n\t\n\tuniform float size;\n\tuniform float scale;\n\tuniform float baseId;\n\t\n\tvarying vec4 worldId;\n\n\t#ifdef USE_CARTESIAN3\n\t\tvec3 czm_converPosition(vec3 origin) {\n\t\t\tvec3 res = vec3(0.0);\n\t\t\tres.x = -origin.x;\n\t\t\tres.y = origin.z;\n\t\t\tres.z = origin.y;\n\t\t\treturn res;\n\t\t}\n\t#endif\n\n\t#ifdef INSTANCED\n\t\tattribute vec3 instancePosition;\n\t\tattribute vec4 instanceQuaternion;\n\t\tattribute vec3 instanceScale;\n\t\tattribute float instanceId;\n\n\t\tmat4 compose(vec3 position, vec4 quaternion, vec3 scale) {\n\t\t\tfloat x = quaternion.x, y = quaternion.y, z = quaternion.z, w = quaternion.w;\n\t\t\tfloat x2 = x + x,  y2 = y + y,  z2 = z + z;\n\t\t\tfloat xx = x * x2, xy = x * y2, xz = x * z2;\n\t\t\tfloat yy = y * y2, yz = y * z2, zz = z * z2;\n\t\t\tfloat wx = w * x2, wy = w * y2, wz = w * z2;\n\n\t\t\tfloat sx = scale.x, sy = scale.y, sz = scale.z;\n\n\t\t\treturn mat4(( 1. - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.,\n\t\t\t\t( xy - wz ) * sy, ( 1. - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.,\n\t\t\t\t( xz + wy ) * sz, ( yz - wx ) * sz, ( 1. - ( xx + yy ) ) * sz, 0.,\n\t\t\t\tposition.x, position.y, position.z, 1.\n\t\t\t);\n\t\t}\n\t#endif\n\t\n\t#ifdef USE_ID_ATTRIBUTES\n\t\tattribute float id;\n\t#endif\n\n\tvoid main() {\n\t\t#include <skinbase_vertex>\n\t\t#include <begin_vertex>\n\t\t#ifdef USE_CARTESIAN3\n\t\t\ttransformed = czm_converPosition(transformed);\n\t\t#endif\n\t\t// position instanced\n\t\t#ifdef INSTANCED\n\t\t\tmat4 instanceMat = compose(instancePosition, instanceQuaternion, instanceScale);\n\t\t\ttransformed.xyz = (instanceMat * vec4(transformed, 1.0)).xyz;\n\t\t#endif\n\t\t#include <skinning_vertex>\n\t\t#include <project_vertex>\n\t\t#include <logdepthbuf_vertex>\n\t\t#ifdef USE_ID_ATTRIBUTES\n\t\t\tfloat pickId = id;\n\t\t#else\n\t\t\t#ifdef INSTANCED\n\t\t\t\tfloat pickId = instanceId;\n\t\t\t#else\n\t\t\t\tfloat pickId = baseId;\n\t\t\t#endif\n\t\t#endif\n\n\t\tvec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * pickId);\n\t\ta -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);\n\t\tworldId = vec4(a,1);\n\t}\n":"\n\t#include <common>\n\t#include <logdepthbuf_pars_vertex>\n\n\tuniform float size;\n\tuniform float scale;\n\tuniform float baseId;\n\n\tvarying vec4 worldId;\n\n\t#ifdef USE_CARTESIAN3\n\t\tvec3 czm_converPosition(vec3 origin) {\n\t\t\tvec3 res = vec3(0.0);\n\t\t\tres.x = -origin.x;\n\t\t\tres.y = origin.z;\n\t\t\tres.z = origin.y;\n\t\t\treturn res;\n\t\t}\n\t#endif\n\n\t#ifdef INSTANCED\n\t\tattribute vec3 instancePosition;\n\t\tattribute vec4 instanceQuaternion;\n\t\tattribute vec3 instanceScale;\n\t\tattribute float instanceId;\n\n\t\tmat4 compose(vec3 position, vec4 quaternion, vec3 scale) {\n\t\t\tfloat x = quaternion.x, y = quaternion.y, z = quaternion.z, w = quaternion.w;\n\t\t\tfloat x2 = x + x,  y2 = y + y,  z2 = z + z;\n\t\t\tfloat xx = x * x2, xy = x * y2, xz = x * z2;\n\t\t\tfloat yy = y * y2, yz = y * z2, zz = z * z2;\n\t\t\tfloat wx = w * x2, wy = w * y2, wz = w * z2;\n\n\t\t\tfloat sx = scale.x, sy = scale.y, sz = scale.z;\n\n\t\t\treturn mat4(( 1. - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.,\n\t\t\t\t( xy - wz ) * sy, ( 1. - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.,\n\t\t\t\t( xz + wy ) * sz, ( yz - wx ) * sz, ( 1. - ( xx + yy ) ) * sz, 0.,\n\t\t\t\tposition.x, position.y, position.z, 1.\n\t\t\t);\n\t\t}\n\t#endif\n\t\n\t#ifdef USE_ID_ATTRIBUTES\n\t\tattribute float id;\n\t#endif\n\n\tvoid main() {\n\t\t#ifdef USE_ID_ATTRIBUTES\n\t\t\tfloat pickId = id;\n\t\t#else\n\t\t\t#ifdef INSTANCED\n\t\t\t\tfloat pickId = instanceId;\n\t\t\t#else\n\t\t\t\tfloat pickId = baseId;\n\t\t\t#endif\n\t\t#endif\n\t\t\n\t\tvec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * pickId);\n\t  \ta -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);\n\t\tworldId = vec4(a,1);\n\t\tvec3 transformed = position;\n\t\t#ifdef USE_CARTESIAN3\n\t\t\ttransformed = czm_converPosition(transformed);\n\t\t#endif\n\t\t#ifdef INSTANCED\n\t\t\tmat4 instanceMat = compose(instancePosition, instanceQuaternion, instanceScale);\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * instanceMat * vec4( transformed, 1.0 );\n\t\t#else\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 );\n\t\t#endif\n\n\t\t#include <logdepthbuf_vertex>\n\t}\n",fragmentShader:"\n\t#include <logdepthbuf_pars_fragment>\n\t#ifdef GL_ES\n\t\tprecision highp float;\n\t#endif\n\tvarying vec4 worldId;\n\tvoid main() {\n\t\t#include <logdepthbuf_fragment>\n\t\tgl_FragColor = worldId;\n\t}\n"})};(ps.prototype=Object.create(THREE.ShaderMaterial.prototype)).constructor=ps,ps.prototype.setBaseID=function(e){this.uniforms.baseId.value=e},ps.prototype.setPointSize=function(e){this.uniforms.size.value=e},ps.prototype.setPointScale=function(e){this.uniforms.scale.value=e};var ds,fs,ms,gs=new THREE.Vector2,vs=function(){function e(t,i){n(this,e),i=i||{},this.app=t,this.camera=t.renderCamera,this.renderer=t.renderer,this.scene=t.scene,this._needUpdate=!0,this._updateTime=0,this._updateIntervalTime=.25,this._pickHooker=null,this.debugScene=null,this.sprite=null,this.camera2D=null,this.pickingTexture=new THREE.WebGLRenderTarget,this.pickingTexture.texture.minFilter=THREE.LinearFilter,this.pickingTexture.texture.generateMipmaps=!1,this.pickNodes=new Map,this.pickMaterials=new Map,this.lineShell=ke.parseValue(i.lineShell,10),this.pointShell=ke.parseValue(i.pointShell,.1),this.debug=ke.parseValue(i.debug,!1),this.init();var r=this;this.app.renderer.materialManager.addStrategy("gpuPicker",(function(e,t,i,n,o,a){var s=this.id;if(this.geometry._hasDisposed)return null;if(this.userData.skipPick)return null;if(!o.visible||!o.opacity)return null;if("BackgroundCubeMaterial"==o.type)return null;r.pickNodes.has(s)||r.pickNodes.set(s,this);var l=r.pickMaterials.get(s);return l||(l=r.createPickingMaterial(this,o))&&r.pickMaterials.set(s,l),l}))}return e.prototype.init=function(){var e=this.renderer.getSize(gs);this.resizeTexture(e.width,e.height)},e.prototype.resizeTexture=function(e,t){this.pickingTexture.setSize(e,t),this.pixelBuffer=new Uint8Array(4*e*t),this.sprite&&this.sprite.scale.set(2*e,2*t,1),this.camera2D&&(this.camera2D.left=-e/2,this.camera2D.right=e/2,this.camera2D.top=t/2,this.camera2D.bottom=-t/2,this.camera2D.updateProjectionMatrix()),this._needUpdate=!0},e.prototype._needUpdatePickingTexture=function(e){return this._updateTime+=e,!(this._updateTime<this._updateIntervalTime)&&(this._updateTime=0,!!this._needUpdate&&(this._needUpdate=!1,!0))},e.prototype.update=function(e){this._needUpdatePickingTexture(e)&&this.updatePickingTexture()},e.prototype.markPickingNode=function(e){this.pickNodes.set(e.id,e)},e.prototype.removePickingResources=function(e){var t=this;if(e.isObject3D)e.traverse((function(e){return t.removePickingResources(e.id)}));else{var i=this.pickMaterials.get(e);i&&(Array.isArray(i)?i.forEach((function(e){return e.dispose()})):i.dispose(),this.pickMaterials.delete(e)),this.pickNodes.has(e)&&this.pickNodes.delete(e),this.forceUpdate=!0}},e.prototype._createPickingMaterial=function(e,t){var i=e.userData,r=t.size||.01,n=t.linewidth||1,o=function(e){for(var t=e;t;){if(t.userData.withGeometryIDAttributes)return!0;t=t.parent}return!1};if(t.isSpriteMaterial)t.map&&t.map.image&&((s=t.clone()).alphaTest=.1,s.blending=THREE.NoBlending,s.lights=!1,s.fog=!1,s.visible=!(!t.visible||i.skipPick),s.baseId=e.id,s.defines=s.defines||{},s.defines.USE_GPUPICKER="");else if(i.noBlending||t.isShaderMaterial&&t.vertexShader.indexOf("USE_GPUPICKER")>-1){(s=t.clone()).alphaTest=.1,s.blending=THREE.NoBlending,s.lights=!1,s.fog=!1,s.visible=!(!t.visible||i.skipPick),s.baseId=e.id,s.defines=s.defines||{},s.defines.USE_GPUPICKER="";var a=s.uniforms;a&&a.lineWidth&&(a.lineWidth.value+=this.lineShell),o(e)&&(s.defines.USE_ID_ATTRIBUTES="")}else{var s;if(o(e))(s=new ps(t.skinning)).map=null,s.color=new THREE.Color,s.uniforms.config={value:{x:0,y:0}},s.linewidth=n+this.lineShell,s.depthTest=t.depthTest,s.depthWrite=t.depthWrite||t._pickable,s.colorWrite=t.colorWrite,s.transparent=t.transparent,s.opacity=1,s.side=t.side,s.skinning=t.skinning,s.visible=!(!t.visible||i.skipPick),s.polygonOffset=t.polygonOffset,s.polygonOffsetFactor=t.polygonOffsetFactor,s.polygonOffsetUnits=t.polygonOffsetUnits,s.baseId=e.id,t.defines&&void 0!==t.defines.INSTANCED&&!1!==t.defines.INSTANCED&&(s.defines.INSTANCED=""),i.USE_CARTESIAN3&&(s.defines.USE_CARTESIAN3=""),s.defines.USE_ID_ATTRIBUTES="",s.setPointSize(r+this.pointShell),s.setPointScale(this.renderer.getSize(gs).height*this.renderer.getPixelRatio()/2);else(s=new ps(t.skinning)).map=null,s.color=new THREE.Color,s.uniforms.config={value:{x:0,y:0}},s.linewidth=n+this.lineShell,s.depthTest=t.depthTest,s.depthWrite=t.depthWrite||t._pickable,s.colorWrite=!!i.skipPickColorWrite||t.colorWrite,s.transparent=t.transparent,s.opacity=1,s.side=t.side,s.skinning=t.skinning,s.visible=!(!t.visible||i.skipPick),s.polygonOffset=t.polygonOffset,s.polygonOffsetFactor=t.polygonOffsetFactor,s.polygonOffsetUnits=t.polygonOffsetUnits,s.baseId=e.id,t.defines&&void 0!==t.defines.INSTANCED&&!1!==t.defines.INSTANCED&&(s.defines.INSTANCED=""),i.USE_CARTESIAN3&&(s.defines.USE_CARTESIAN3=""),s.setPointSize(r+this.pointShell),s.setPointScale(this.renderer.getSize(gs).height*this.renderer.getPixelRatio()/2)}return s},e.prototype.createPickingMaterial=function(e,t){if(t.length){for(var i=[],r=0;r<t.length;r++)i.push(this._createPickingMaterial(e,t[r]));return i}return this._createPickingMaterial(e,t)},e.prototype.updatePickingTexture=function(){var e=this.app.renderer.materialManager,t=e.getMode();e.setMode("gpuPicker");var i=this.scene,r=i.autoUpdate;i.autoUpdate=!1;var n=this.renderer.shadowMap.enable;this.renderer.initRenderList=!1,this.renderer.setRenderTarget(this.pickingTexture),this.renderer.clear(),this.renderer.render(i,this.camera),this.renderer.render(this.app.mainUI.scene2D,this.app.mainUI.camera2D),i.autoUpdate=r,this.renderer.shadowMap.enable=n,this.renderer.initRenderList=!0,this.renderer.readRenderTargetPixels(this.pickingTexture,0,0,this.pickingTexture.width,this.pickingTexture.height,this.pixelBuffer),e.setMode(t)},e.prototype.pick=function(e,t,i,r){var n=this.pickingTexture.width,o=this.pickingTexture.height;if(t=Math.round(t),i=Math.round(i),t<0||t>=n)return null;if(i<0||i>=o)return null;var a=t+(o-i-1)*n,s=255*this.pixelBuffer[4*a+2]*255+255*this.pixelBuffer[4*a+1]+this.pixelBuffer[4*a+0];if(isNaN(s))return null;var l=this.pickNodes.get(s);if(!l){var u=this.app.picker.onPickNodeID;u&&(l=u(s))}if(!l)return null;var c=r.clone();c._camera=r._camera||r.camera,c.camera=r.camera||r._camera;var h=this,p={id:s,pickedNode:l,node:l,object:l,raycaster:c,getPickedPosition:function(e){e=e||{};var t=this.pickedNode,i=h._pickHooker;if(i){var r=i(this.raycaster,t);if(r){if(ke.isArray(r))return ke.parseVector3(r);if(r.isVector3)return r}}var n=this.raycaster.intersectObject(t,!1);if(n.length)return n[0].point;var o=function(e,t){for(var i=e.intersectObject(t,!0),r=0;r<i.length;r++){var n=i[r];if(!n.object.userData.skipPick)return n.point}return null},a=o(this.raycaster,t.parent);if(a)return a;if(!e.skipOtherPick){if(!e.skipParentPick&&t.parent&&(a=o(this.raycaster,t.parent)))return a;if(!e.skipObjectPick){var s=h.app.objectManager.getBaseObject(t);if(s&&(a=o(this.raycaster,s.node)))return a}if(!e.skipScenePick&&(a=o(this.raycaster,h.app.scene)))return a}return new THREE.Vector3}};return Object.defineProperties(p,{pickedPosition:{get:function(){if(void 0===p._pickedPosition){var e=p.getPickedPosition();p._pickedPosition=e?e.toArray():null}return p._pickedPosition}},distance:{get:function(){if(void 0===p._distance){var t=p.pickedPosition;if(t){var i=new THREE.Vector3(t[0],t[1],t[2]);p._distance=i.distanceTo(e.position)}else{var r=new THREE.Vector3;l.getWorldPosition(r);var n=new THREE.Vector3;e.getWorldPosition(n),p._distance=n.distanceTo(r)}}return p._distance}}}),p},e.prototype.show=function(e){if(e||void 0===e){if(!this.sprite){var t=new THREE.SpriteMaterial({map:this.pickingTexture.texture});this.sprite=new THREE.Sprite(t),this.sprite.scale.set(this.pickingTexture.width,this.pickingTexture.height,1),this.sprite.position.set(0,0,-10),this.debugScene=new THREE.Scene,this.debugScene.add(this.sprite);var i=this.renderer.getSize(gs);this.camera2D=new THREE.OrthographicCamera(-i.width/2,i.width/2,i.height/2,-i.height/2,.1,100)}}else this.debugScene&&this.sprite&&(this.debugScene.remove(this.sprite),this.sprite=null,this.debugScene=null,this.camera2D=null)},e.prototype.render=function(e){this.debugScene&&(e.setRenderTarget(null),e.clear(),e.render(this.debugScene,this.camera2D))},o(e,[{key:"updateIntervalTime",set:function(e){this._updateIntervalTime=e},get:function(){return this._updateIntervalTime}},{key:"forceUpdate",set:function(e){e&&(this._needUpdate=!0,this._updateTime=.25)}},{key:"needUpdate",set:function(e){this._needUpdate=e}}]),e}(),ys=function(){function e(t){n(this,e),this.app=t;var i=new THREE.PlaneGeometry(1e4,1e4,1,1),r=new THREE.MeshStandardMaterial({color:2200782,side:THREE.DoubleSide,transparent:!0,opacity:.25});this._vertGround=new THREE.Mesh(i,r),this._vertGround.visible=!1,this._vertGround.setAngles([90,0,0]),this._vertGround.updateMatrixWorld();var o=new THREE.PlaneGeometry(1e4,1e4,1,1),a=new THREE.MeshStandardMaterial({color:13538337,side:THREE.DoubleSide,transparent:!0,opacity:.25});this._horzGround=new THREE.Mesh(o,a),this._horzGround.visible=!1,this._horzGround.setAngles([90,0,0]),this._horzGround.updateMatrixWorld(),this.pickingScene=new THREE.Scene,this.pickingScene.add(this._vertGround),this.pickingScene.add(this._horzGround)}return e.prototype.destroy=function(){this.app.resourceManager.remove(this.pickingScene)},e.prototype.update=function(e,t){this._vertGround.lookAt(ke.parseVector3(e)),this._vertGround.position.copy(ke.parseVector3(t)),this._vertGround.updateMatrixWorld()},e.prototype.isMeshOf=function(e){return this._vertGround==e||this._horzGround==e},e.prototype.intersect=function(e,t){var i=this.app.camera.getRaycaster(e,t);return this.intersectByRaycaster(i)},e.prototype.intersectByRaycaster=function(e){var t=e.intersectObjectForcible(this._horzGround),i=e.intersectObjectForcible(this._vertGround);return t.length&&i.length?t[0].distance<i[0].distance?t[0]:i[0]:t.length?t[0]:i.length?i[0]:null},o(e,[{key:"visible",set:function(e){e?this.app.scene.add(this.pickingScene):this.app.scene.remove(this.pickingScene),this._vertGround.visible=e,this._horzGround.visible=e}}]),e}(),bs=function(){function e(t){n(this,e),this.app=t,this.picker=t.picker,this.pickDownPosition=[0,0],this._mouseMoveInterval=null,e.instance=this}return e.prototype.processPicking=function(e){this.picker.processPicking(e)},e.prototype.processAreaPicking=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.picker,r=i.pickingArea,n=new ct(this.app);t?n.buildReturnObject(r.processPicking(i.areaCandidates)):(this.processPicking(e),i.areaCandidates.has(e.object)?n.buildReturnObject([e.object]):n.buildReturnObject([])),this.picker.setPickedObject(n),this.app.trigger(k.AreaPicking,{objects:n})},e.prototype.startPicking=function(e){var t=this.picker;t.forceUpdate=!0,t._state.lock(!0,"startPicking"),e.ignoreFrameCheck=!0},e.prototype.endPicking=function(){this.picker._state.unlock("startPicking")},e.prototype.processClickEvents=function(e){this.startPicking(e),this.processPicking(e),this.endPicking()},e.prototype.tryToDrag=function(e){var t=this.picker.processPicking(e);if(null==t)return null;var i=t.object;return i?i.draggable?t:(e.object=null,null):null},e.prototype.onEnter=function(e){},e.prototype.onUpdate=function(e){var t=this.picker;if(!t.areaPicking){var i=t.pickingArea;i.started&&i.end()}t.update(this.app._deltaTime),this._mouseMoveInterval&&(this._mouseMoveInterval.deltaTime+=this.app._deltaTime)},e.prototype.onMouseMove=function(e){if(this._mouseMoveInterval){if(this._mouseMoveInterval.deltaTime-this._mouseMoveInterval.curTime<this._mouseMoveInterval.interval)return;this._mouseMoveInterval.curTime=this._mouseMoveInterval.deltaTime}var t=this.picker;if(t.areaPicking){var i=t.pickingArea;i.started&&(i.move(e.clientX,e.clientY),i.realTimePicking&&(e.areaPicking=!0,this.processAreaPicking(e)))}else this.processPicking(e),this.picker.setPickedObject(e.object)},e.prototype.onMouseUp=function(e){var t=this.picker;if(this.startPicking(e),t.areaPicking){if(0==e.button){var i=THING.Math.getDistance(this.pickDownPosition,[e.x,e.y])>4;e.finishedAreaPicking=!0,this.processAreaPicking(e,i),t.pickingArea.end()}}else e.ignoreFrameCheck=!0,t.processPicking(e);this.endPicking()},e.prototype.onMouseDown=function(e){var t=this.picker;t.forceUpdate=!0,this.pickDownPosition=[e.clientX,e.clientY],t.areaPicking?0==e.button&&t.pickingArea.start(e.clientX,e.clientY):(e.ignoreFrameCheck=!0,t.processPicking(e))},e.prototype.onDoubleClick=function(e){this.processClickEvents(e)},e.prototype.onSingleClick=function(e){this.processClickEvents(e)},e.prototype.onClick=function(e){this.processClickEvents(e)},e.prototype.onDragStart=function(e){this.startPicking(e);var t=this.tryToDrag(e);if(t){var i=t.object,r=this.picker;i._dragState=R.Dragging,i.internalUserData.prevPickable=i.pickable,i.pickable=!1,e.ignoreFrameCheck=!0,e.forceUpdateTexture=!0;var n=r.processPicking(e);r.dragIntersect=n||t,r.dragIntersect.dragObject=i,e.dragObject=i,delete e.ignoreFrameCheck,delete e.forceUpdateTexture,this.app.camera.disable({rotate:!0})}else this.endPicking()},e.prototype.onDrag=function(e){var t=this.picker;null!=t.dragIntersect&&(e.disableGPUPicker=!0,t.processPicking(e),delete e.disableGPUPicker,this.app.needUpdate=!0)},e.prototype.onDragEnd=function(e){var t=this.picker;if(t.forceUpdate=!0,null!=t.dragIntersect){e.disableGPUPicker=!0,t.processPicking(e),delete e.disableGPUPicker;var i=t.dragIntersect.dragObject;i&&(i._dragState=R.DragEnd);var r=i.internalUserData.prevPickable;r&&(i.pickable=r),delete i.internalUserData.prevPickable,e.object=i,t.dragIntersect=null,this.app.camera.resume({rotate:!0}),this.endPicking()}},o(e,[{key:"mouseMoveInterval",set:function(e){this._mouseMoveInterval=e,this._mouseMoveInterval&&(this._mouseMoveInterval={interval:e,curTime:this.app._deltaTime,deltaTime:this.app._deltaTime})},get:function(){return this._mouseMoveInterval}}]),e}(),_s=!1,xs=function(){if(void 0!==ms){var e=ms;return ms=void 0,e}};var Es=function(){function e(t){n(this,e),this.app=t;var i=this.app.calcRect();this.resize(i.width,i.height)}return e.prototype.updateProgress=function(e){return this.loadingProgressBar.updateProgress(e)},e.prototype.updateDownloadingProgress=function(e){},e.prototype.updateLoadingProcess=function(e){e=e||{},ke.isNumber(e)&&(e={object:this.app.root.campuses[0],progress:e});var t=e.object||e.campus,i=e.progress;this.updateProgress(i)&&this.app.events.dispatchEvent({type:"progress",object:t,progress:i})},e.prototype._createLSM=function(e,t,i){var r=document.createElement("canvas");r.width=512,r.height=512;var n=r.getContext("2d");n.font="24px Verdana",n.fillStyle="white",n.textAlign="center",n.textBaseline="middle";var o=[0,0,0],a=THING.Math.degToRad(30);n.shadowColor="rgba("+255*o[0]+","+255*o[1]+","+255*o[2]+",1)",n.shadowBlur=1,n.shadowOffsetX=2*Math.cos(a),n.shadowOffsetY=2*Math.sin(a),function(e,t,i,r,n){for(var o=t.split("\n"),a=0;a<o.length;a++){var s=o[a];e.fillText(s,i,r),r+=n}}(n,e,256,256,40);var s=new THREE.Texture(r);return s.needsUpdate=!0,new THREE.SpriteMaterial({opacity:t,color:16777215,transparent:!0,depthWrite:!1,map:s,rotation:THING.Math.degToRad(i)})},e.prototype._createLS=function(e,t,i){for(var r=this.app.calcRect(),n=2*r.width,o=2*r.height,a=[],s=-o;s<o;s+=i)for(var l=-n;l<n;l+=t){var u=new THREE.Sprite(e);u.scale.set(512,512,1),u.position.set(l,s,-10),a.push(u)}return a},e.prototype._setupSprite=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:480,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:320;ds&&this.app.resourceManager.remove(ds);var r=this._createLSM(e,.04,30),n=this._createLS(r,t,i);ds=new THREE.Group;for(var o=0;o<n.length;o++)ds.add(n[o]);this.scene2D.add(ds)},e.prototype._setup=function(){for(var e=c.update(this.app.appKey),t=[12,164,143,166,114,16,17,182,16,94,29,114,216,195,208,81,35,181,52,132,113,112,175,32,228,201,230,97,106,44,100,73,110,54,247,25],i=0;i<e.length;i++)if(e[i]!=t[i]){this._setupL();break}fs=new THREE.Group,this.scene2D.add(fs)},e.prototype._setupL=function(){if((new _).eb()){if([32].toString()!=[32].toString()){var e=function(e){e=e||window;var t=c,i=t.toStr([76,243,170,237,85,62]),r=t.toStr([83,249,168,254,66,63,61,235]),n=t.toStr([79,247,191,247,88,55,63,224]);n=t.update(e[r][n]);var o=t.toStr([80,230,174,241]),a=t.toStr([87,226,191,239,12,121,125,242,74,24,10,48,244,135,138,115,8,255,55,165,90,89,198]),s=t.update(e[r][i]),l=[107,254,162,241,81,28,1,165,95,22,4,49,245,128,138,123,20,237],u=[0,248,170,242,83,107,125];0==s.toString().indexOf(u.toString())&&(l=[107,254,162,241,81,28,1,165,95,22,4,49,245,128,138,123,20,237,19,238,115,70,140,104,130,136,181,43,46,118,51,30,119]);var h=[0,0];return 1==ke.r(0,1)&&(0==ke.r(0,1)?h[1]=ke.r(10,230):h[0]=ke.r(50,400)),{b1:o,c1:a,d1:h,e1:i,pp1:n,gg1:[[16,230,228]],f1:u,gs:[[0,248,170,242,83,107,125,240,77,3,75,37,248,157,203,100,3,239,114,167,82,81],[0,248,170,242,83,107,125,245,18],[0,251,246,176,70,121]],h1:s,t1:t.toStr(l)}}(this.l);if(e){var t=e.gs;if(t)for(var i=e.h1.toString(),r=0;r<t.length;r++)if(0==i.indexOf(t[r].toString()))return;if(t=e.gg1)for(i=e.pp1.toString(),r=0;r<t.length;r++)if(0==i.indexOf(t[r].toString()))return;var n=e.t1;this._setupSprite(n)}}}},e.prototype.onResize=function(e,t){this.resize(e,t);var i=i||c.toStr([96,201,148,250,88,55,48,233,88,48,80,33,228,154,187,127,7,245,70,163,91,87,134,105,199,140,143,6,2]);if(THING[i]){var r=c.toStr([96,226,174,231,66,29,55,252,120,1,71,43,248,139,150]);THING[r]=c,delete THING[i]}},e.prototype.onUpdate=function(){var e=ce();!0===e?ms=!0:!1===e&&(ms=!1),this.render()},e.prototype.resize=function(e,t){this.scene2D=this.scene2D||new THREE.Scene,this.camera2D=this.camera2D||new THREE.OrthographicCamera(-e/2,e/2,t/2,-t/2,.1,100),this.camera2D.left=-e/2,this.camera2D.right=e/2,this.camera2D.top=t/2,this.camera2D.bottom=-t/2,this.camera2D.updateProjectionMatrix(),this.loadingProgress&&this.loadingProgress.resize(e,t)},e.prototype.render=function(e){e=e||this.app.renderer;var t=le().l;if(void 0!==t&&!_s){_s=!0;var i=le().t;t||(i=""),this._setupSprite(i)}ds&&(ds.parent!=this.scene2D&&this.scene2D.add(ds),ds.visible=!0,ds.traverse((function(e){e.visible=!0})),this.scene2D.visible=!0),e.setRenderTarget(null),e.clear(!1,!0,!1);var r=this.app.renderer.autoClear;e.autoClear=!1,e.render(this.scene2D,this.camera2D),e.autoClear=r},e.prototype.getRenderPosition=function(e,t,i){var r=(i=i||[this.app.domElement.offsetWidth,this.app.domElement.offsetHeight])[0]/2,n=i[1]/2,o=[e[0]*r,e[1]*n],a=[t[0]/2,t[1]/2];return o[0]=THING.Math.clamp(o[0],-r+a[0],r-a[0]),o[1]=THING.Math.clamp(o[1],-n+a[1],n-a[1]),[o[0],-o[1]]},e.prototype.screenToWorld=function(e,t){var i=this.app.calcRect(),r=t[0],n=t[1];return[e[0]+r/2-i.width/2,-e[1]-n/2+i.height/2]},o(e,[{key:"loadingProgressBar",get:function(){return this.loadingProgress=this.loadingProgress||this.app.create({type:"ProgressBar",height:6,scene:this.scene2D,onTop:!1,parent:null}),this.loadingProgress}}]),e}(),ws=function(){function e(t){n(this,e),this.app=t,this.sprite=null,this.spriteLineNode=null,this.started=!1,this.startX=0,this.startY=0,this.distanceX=0,this.distanceY=0,this.region=[],this._areaPickType=P.Auto,this._realTimePicking=!1,this.depth=-10}return e.prototype.initLines=function(){if(!this.spriteLineNode){var e=new THREE.Geometry;e.vertices=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];var t=new THREE.LineBasicMaterial({color:16777215,opacity:.8,linewidth:1,transparent:!0});this.spriteLineNode=new THREE.Line(e,t),this.spriteLineNode.visible=!1,this.spriteLineNode.computeLineDistances(),this.app.mainUI.scene2D.add(this.spriteLineNode)}},e.prototype.initSprite=function(){if(!this.sprite){var e=new THREE.SpriteMaterial({opacity:.4,color:32768,transparent:!0});this.sprite=new THREE.Sprite(e),this.sprite.visible=!1,this.app.mainUI.scene2D.add(this.sprite)}},e.prototype.setSpritePosition=function(e,t){var i=this.app.calcRect(),r=e-i.width/2,n=t-i.height/2;this.sprite.position.set(r,-n,this.depth)},e.prototype.setSpriteLinePosition=function(e,t,i,r){var n=this.spriteLineNode.geometry,o=n.vertices,a=i/2,s=r/2,l=new THREE.Vector3(e-a,t-s,this.depth),u=new THREE.Vector3(e+a,t-s,this.depth),c=new THREE.Vector3(e+a,t+s,this.depth),h=new THREE.Vector3(e-a,t+s,this.depth);o[0].copy(l),o[1].copy(u),o[2].copy(c),o[3].copy(h),o[4].copy(l),n.verticesNeedUpdate=!0},e.prototype.updateRegion=function(){var e=this.startX,t=this.startX+this.distanceX,i=this.startY,r=this.startY+this.distanceY,n=!1;if(e>t){var o=e;e=t,t=o,n=!0}if(i>r){var a=i;i=r,r=a,n=!0}switch(this._areaPickType){case P.Auto:this._realTimePicking=!n;break;case P.RealTime:this._realTimePicking=!0;break;case P.NotRealTime:this._realTimePicking=!1}this.region=[e,i,t,r]},e.prototype.start=function(e,t){this.initSprite(),this.initLines(),this.started=!0,this.distanceX=1,this.distanceY=1,this.startX=e,this.startY=t,this.setSpritePosition(e,t),this.sprite.scale.set(1,1,1);for(var i=this.sprite.children,r=0;r<i.length;r++)i[r].position.set(0,0,0);this.sprite.visible=!0,this.app.trigger(k.AreaPickStart),this.updateRegion(),this.move(e,t)},e.prototype.move=function(e,t){this.distanceX=e-this.startX,this.distanceY=t-this.startY,this.setSpritePosition(this.startX+this.distanceX/2,this.startY+this.distanceY/2);var i=this.distanceX?this.distanceX:1,r=this.distanceY?this.distanceY:1;this.distanceX<0&&(i*=-1),this.distanceY<0&&(r*=-1),this.sprite.scale.set(i,r,1),this.setSpriteLinePosition(this.sprite.position.x,this.sprite.position.y,i,r),this.spriteLineNode.visible=!0,this.updateRegion()},e.prototype.end=function(){this.started&&(this.started=!1,this.sprite&&(this.sprite.visible=!1),this.spriteLineNode&&(this.spriteLineNode.visible=!1),this.app.trigger(k.AreaPickEnd))},e.prototype.intersectPoint=function(e){var t=e[0],i=e[1],r=this.region;return!(t<r[0])&&(!(t>r[2])&&(!(i<r[1])&&!(i>r[3])))},e.prototype.intersectObject=function(e,t){for(var i=this.app.camera,r=new THREE.Vector3,n=(e.isBaseObject?e.node:e).getMeshes(),o=0;o<n.length;o++){var a=n[o],s=a.geometry,l=a.matrixWorld;if(s.isBufferGeometry){var u=s.index,c=s.attributes.position;if(null!==u){var h=Math.max(1,Math.floor(u.count*t));for(f=0,m=u.count;f<m;f+=h){r.fromBufferAttribute(c,u.getX(f)),r.applyMatrix4(l);var p=i.worldToScreen(r);if(this.intersectPoint(p))return!0}}else if(void 0!==c)for(var d=Math.max(1,Math.floor(c.count*t)),f=0,m=c.count;f<m;f+=d){r.fromBufferAttribute(c,f),r.applyMatrix4(l);p=i.worldToScreen(r);if(this.intersectPoint(p))return!0}}else if(s.isGeometry){var g=s.vertices,v=Math.max(1,Math.floor(g.length*t));for(f=0,m=g.length;f<m;f+=v){(r=g[f].clone()).applyMatrix4(l);p=i.worldToScreen(r);if(this.intersectPoint(p))return!0}}}return!1},e.prototype.processPicking=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,i=this.app.picker,r=[];if(i._results.clear(),e)for(var n=0;n<e.length;n++){var o=e[n];if(o.pickable&&this.intersectObject(o,t)){i._results.add(o);var a=i.pickedResultFunc;if(a&&!(o=a(o)))continue;-1===r.indexOf(o)&&r.push(o)}}return r},o(e,[{key:"realTimePicking",get:function(){return this._realTimePicking}}]),e}(),Ts=function(){function e(t,i){n(this,e),this.app=t,this.domElem=t.domElement,this._state=new wt,this._changed=!1,this.intersect=null,this.dragIntersect=null,this.lastPickFrame=-1,this.lastPickPosition=null,this._pickedResultsFunc=null,this._pickedResultFunc=null,this._results=new ct(this.app),this._objects=new ct(this.app),this._previousObjects=new ct(this.app),this.pickingArea=new ws(this.app),this._areaCandidates=new ct(this.app),this._areaPicking=!1,this.cameraPickingGround=new ys(this.app),this.floorPickingGround=new ys(this.app),this._disableGPUPicker=!1,this.gpuPicker=null,i&&(this.gpuPicker=new vs(this.app,{debug:!1})),this.initEvents()}return e.prototype.initEvents=function(){var e=this;this.app.on("destroy",(function(t){var i=t.object;e._areaCandidates.remove(i)}))},e.prototype.getPickedObject=function(e){return this.app.objectManager.getBaseObject(e)},e.prototype.filter=function(e,t){if(null==e)return null;for(var i=[],r=[],n=0;n<e.length;n++){var o=e[n],a=o.object;if(!a.userData.skipPick){var s=this.getPickedObject(a);if(s)if(!s.node.userData.skipPick){if(this._results.add(s),this._pickedResultFunc&&!t){var l=this._pickedResultFunc(s);if(!l)continue;o.node=l.node}if(!this._pickedResultsFunc||t){r=[o];break}-1===i.indexOf(s)&&i.push(s),r.push(o)}}}if(this._pickedResultsFunc&&!t){var u={objects:i,result:null};if(this._pickedResultsFunc(u),u.result){var c=i.indexOf(u.result);-1!==c&&(r=[r[c]])}}return r[0]},e.prototype.isTopSprite=function(e){return!e.material.depthTest},e.prototype.sortIntersectObjects=function(e){var t=this;e.sort((function(e,i){var r=e.object,n=i.object,o=r.userData,a=n.userData;if(!o.topNode&&a.topNode)return-1;if(o.topNode&&!a.topNode)return 1;if(o.subNode&&!a.subNode)return-1;if(!o.subNode&&a.subNode)return 1;if(r.isSprite){if(t.isTopSprite(r)&&!n.isSprite)return-1}else if(n.isSprite){if(t.isTopSprite(n)&&!r.isSprite)return 1}else{var s=r.material,l=n.material;if(s.depthTest&&!l.depthTest)return 1;if(!s.depthTest&&l.depthTest)return-1}return e.distance-i.distance}))},e.prototype.pickIntersectObjects=function(e,t,i,r){var n=[];if(t=this._disableGPUPicker||t,this.gpuPicker&&!t){var o=this.app.objectManager.interactableNodes;o.length&&(n=e.intersectEnsureVisibleObjects(o,!0,this.app.renderCamera));var a=this.gpuPicker.pick(this.app.renderCamera,i,r,e);a&&n.push(a)}else{n=e.intersectObject(this.app.scene,!0);for(var s=0;s<n.length;s++){var l=n[s].object.material;l.opacity&&l.visible||n.splice(s--,1)}}return n},e.prototype.__isSameFrame=function(e,t,i){return!i&&(this.lastPickFrame==this.app.currentFrameCount&&(!!this.lastPickPosition&&(this.lastPickPosition[0]==e&&this.lastPickPosition[1]==t)))},e.prototype._isSameFrame=function(e,t,i){return!!this.__isSameFrame(e,t,i)||(this.lastPickPosition=this.lastPickPosition||[0,0],this.lastPickPosition=[e,t],this.lastPickFrame=this.app.currentFrameCount,!1)},e.prototype.intersectObject=function(e,t,i){var r=i.disableGPUPicker,n=i.ignoreFrameCheck,o=i.ignoreFilter;if(i.forceUpdateTexture){var a=this.gpuPicker;a&&(a.forceUpdate=!0)}if(this._pickedResultsFunc&&(r=!0),!this.enable)return null;if(this._isSameFrame(e,t,n))return this.intersect;this.intersect=null,this._results.clear();var s=this.app.camera.getRaycaster(e,t),l=this.pickIntersectObjects(s,r,e,t);if(null==l||0==l.length)return null;this.sortIntersectObjects(l);var u=this.filter(l,o);u?(this.intersect=u,this.intersect.object=this.getPickedObject(u.node||u.object)):this.intersect=l;var c=this.intersect.point;return c&&c.isVector3&&(this.intersect.point=c.toArray()),this.intersect},e.prototype.showPickingGround=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.cameraPickingGround.visible=e},e.prototype.processGroundPicking=function(e,t){if(!this.app.isInScreen([e,t]))return null;var i=this.app.camera;return this.app.renderCamera.updateMatrixWorld(),this.cameraPickingGround.update(i.position,i.target),this.cameraPickingGround.intersect(e,t)},e.prototype.processPicking=function(e){var t=new THREE.Vector2;t.x=e.clientX,t.y=e.clientY;var i=e.offset;i&&(t.x+=i[0],t.y+=i[1]);var r=this.intersectObject(t.x,t.y,e);return null==r?null:(e.intersect=r,e.object=r.object,e.id=ke.isArray(r)?r[0].id:r.id,e.picked=!0,Object.defineProperties(e,{pickedPosition:{get:function(){var e=this.intersect.pickedPosition||this.intersect.point;return e||this.intersect.length&&(e=this.intersect[0].pickedPosition),e}}}),e.pickedObj=e.object,e.getPickedPos=function(){return console.warn("Please use .getPickedPosition() to replace .getPickedPos()"),e.getPickedPosition()},e.getPickedPosition=function(){return console.warn("Please use .pickedPosition to replace .getPickedPosition()"),e.pickedPosition},r)},e.prototype.removePickingResources=function(e){this.gpuPicker&&this.gpuPicker.removePickingResources(e)},e.prototype.markPickingNode=function(e){this.gpuPicker&&this.gpuPicker.markPickingNode(e)},e.prototype.notifyChanged=function(){this.app.trigger(k.PickChange,{objects:this._objects,previousObjects:this._previousObjects});for(var e=this._objects.concat(this._previousObjects),t=0;t<e.length;t++){e[t].trigger(k.PickChange,{objects:this._objects,previousObjects:this._previousObjects})}this._previousObjects.buildReturnObject(this._objects)},e.prototype.update=function(e){var t=xs();void 0!==t&&(t?this.app.trigger("authSuccessed"):this.app.trigger("authFailed")),this.enable&&(this.gpuPicker&&this.gpuPicker.update(e),this._changed&&(this.notifyChanged(),this._changed=!1))},e.prototype.resize=function(e,t){this.gpuPicker&&this.gpuPicker.resizeTexture(e,t)},e.prototype.render=function(e){this.gpuPicker&&this.gpuPicker.render(e)},e.prototype.hasPicked=function(e,t){if(!t)return!1;if(!this.intersect)return!1;var i=this.intersect.object;if(!i)return!1;if(i!=t){if(e._stopPropagation)return!1;if(!i.isChildOf(t))return!1}return!0},e.prototype.setPickedObject=function(e){if(!(e instanceof bt&&this._objects.has(e))){for(var t=0;t<this._objects.length;t++){var i=this._objects[t];i.trigger(k.Unpick),this.app.trigger(k.Unpick,{object:i})}this._objects.clear(),e&&(this._objects.add(e),e.trigger(k.Pick)),this.app.trigger(k.Pick,{object:e instanceof bt?e:null,objects:this._objects,previousObjects:this._previousObjects}),this._previousObjects.equals(this._objects)||(this._changed=!0)}},e.prototype.isChanged=function(){return this._changed},e.prototype.intersectResult=function(e,t,i,r){if(r=r||{},void 0===e||void 0===t){var n=this.app.camera.worldToScreen(this.app.camera.target);e=n[0],t=n[1]}var o={clientX:e,clientY:t,offset:i,disableGPUPicker:ke.parseValue(r.disableGPUPicker,!1),ignoreFrameCheck:ke.parseValue(r.ignoreFrameCheck,!0),ignoreFilter:ke.parseValue(r.ignoreFilter,!0)},a=this.processPicking(o);return a?(o.getPickedPosition=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return a.getPickedPosition?a.getPickedPosition(e):[0,0,0]},delete o.offset,delete o.disableGPUPicker,delete o.ignoreFrameCheck,delete o.ignoreFilter,o):{picked:!1,pickedPosition:null,object:null}},e.prototype.pickObjects=function(e,t,i,r,n){if(void 0===i&&void 0===r){if(void 0===e||void 0===t){var o=this.app.camera.worldToScreen(this.app.camera.position);e=o[0],t=o[1]}for(var a=this.app.camera.getRaycaster(e,t),s=this.pickIntersectObjects(a,!0),l=new Set,u=0;u<s.length;u++){var c=this.app.objectManager.getBaseObject(s[u].object);c&&l.add(c)}return Array.from(l)}return this.pickingArea.startX=e,this.pickingArea.startY=t,this.pickingArea.distanceX=i,this.pickingArea.distanceY=r,this.pickingArea.updateRegion(),this.pickingArea.processPicking(n)},e.prototype.pickWorldPosition=function(e,t,i){return this.intersectResult(e,t,i).pickedPosition},e.prototype.startAreaPicking=function(e){var t=(e=e||{}).x,i=e.y,r=ke.parseValue(e.realTimePicking,!0),n=ke.parseValue(e.drawRegion,!0);ke.isNumber(t)&&ke.isNumber(i)&&(this.app.camera.disable({rotate:!0}),this.pickingArea.start(t,i),this.pickingArea._areaPickType=r?P.RealTime:P.NotRealTime,this.pickingArea.sprite.visible=n,this.pickingArea.spriteLineNode.visible=n,this._areaPicking=!0)},e.prototype.endAreaPicking=function(){if(this.areaPicking){this.pickingArea.end(),this.pickingArea._areaPickType=P.Auto,this.app.camera.resume({rotate:!0});var e=this;setTimeout((function(){e._areaPicking=!1}),10)}},e.prototype.pick=function(e,t){var i=this.pickObjects(e,t);if(!i.length)return null;var r={object:i[0],node:i[0].node};return Object.defineProperty(r,"pickedPosition",{get:function(){return null}}),r},o(e,[{key:"pickerState",get:function(){return bs.instance}},{key:"enable",set:function(e){this._state.enable(e)},get:function(){return this._state.isEnable()}},{key:"disableGPUPicker",set:function(e){this._disableGPUPicker=e}},{key:"areaPicking",get:function(){return!!this.enable&&this._areaPicking}},{key:"forceUpdate",set:function(e){this.gpuPicker&&(this.gpuPicker.forceUpdate=e)}},{key:"needUpdate",set:function(e){this.gpuPicker&&(this.gpuPicker.needUpdate=e)}},{key:"areaCandidates",set:function(e){this._areaCandidates.buildReturnObject(e)},get:function(){return this._areaCandidates}},{key:"pickedResultsFunc",set:function(e){this._pickedResultsFunc=e},get:function(){return this._pickedResultsFunc}},{key:"pickedResultFunc",set:function(e){this._pickedResultFunc=e},get:function(){return this._pickedResultFunc}},{key:"results",get:function(){return this._results}},{key:"objects",get:function(){return this._objects}},{key:"previousObjects",get:function(){return this._previousObjects}},{key:"filterPickedResultsFunc",set:function(e){console.warn("[Picker] please use .pickedResultsFunc instead"),this.pickedResultsFunc=e},get:function(){return console.warn("[Picker] please use .pickedResultsFunc instead"),this.pickedResultsFunc}},{key:"pickedObjectFunc",set:function(e){console.warn("[Picker] please use .pickedResultFunc instead"),this.pickedResultFunc=e},get:function(){return console.warn("[Picker] please use .pickedResultFunc instead"),this.pickedResultFunc}},{key:"enabled",set:function(e){console.warn("[Picker] please use .enable instead"),this.enable=e},get:function(){return console.warn("[Picker] please use .enable instead"),this.enable}},{key:"candidates",set:function(e){console.warn("[Picker] please use .areaCandidates instead"),this.areaCandidates=e},get:function(){return console.warn("[Picker] please use .areaCandidates instead"),this.areaCandidates}}]),e}(),Ss=function(){function e(t){n(this,e),this.app=t,this._objects=new ct(this.app),this._previousObjects=new ct(this.app),this._changed=!1}return e.prototype.notifyChanged=function(){this.app.trigger(k.SelectionChange,{objects:this._objects,previousObjects:this._previousObjects});var e=this;this._objects.forEach((function(t){t.trigger(k.SelectionChange,{objects:e._objects,previousObjects:e._previousObjects})})),this._previousObjects.buildReturnObject(this._objects)},e.prototype.update=function(){this._changed&&(this.notifyChanged(),this._changed=!1)},e.prototype.select=function(e){e&&(this._objects.add(e),e.trigger(k.Select,{object:this._objects}),this.app.trigger(k.Select,{object:e,objects:this._objects}),this._changed=!0)},e.prototype.deselect=function(e){if(e){this._objects.remove(e);var t=new ct(this.app);e.isBaseObject?t.add(e):t=e;for(var i=0;i<t.length;i++){(e=t[i]).trigger(k.Deselect,{objects:t})}this.app.trigger(k.Deselect,{objects:t}),this._changed=!0}},e.prototype.has=function(e){return this._objects.has(e)},e.prototype.clear=function(){if(this._objects.length){this.app.trigger(k.Deselect,{objects:this._objects});for(var e=0;e<this._objects.length;e++){this._objects[e].trigger(k.Deselect,{objects:this._objects})}this._objects.clear(),this._changed=!0}},e.prototype.isChanged=function(){return this._changed},e.prototype.onUpdate=function(e){this.update(e)},o(e,[{key:"objects",get:function(){return this._objects}},{key:"previousObjects",get:function(){return this._previousObjects}}]),e}(),As=new THREE.Frustum,Ms=new THREE.Matrix4,Cs=function(e){function t(i,r,o){n(this,t);var a=s(this,e.call(this,i));return a.node=r,a.projectionType=T.Perspective,a.controller=o,a.followingObject=null,a.lookingObject=null,a._near=a.node.near,a._far=a.node.far,a.addControl(new THING.CameraControl,"cameraControl"),a}return a(t,e),t.prototype.worldToScreen=function(e){if(!e)return null;e.isBaseObject&&(e=e.boundingBox.center,console.warn("[Camera] please use '.worldToScreen(object.boundingBox.center)' to get screen position"));var t=ke.parseVector3(e);t.project(this.node);var i=this.app.renderer.getContext().canvas.width/2,r=this.app.renderer.getContext().canvas.height/2,n=Math.round(t.x*i+i),o=Math.round(-t.y*r+r),a=this.app.renderer.getPixelRatio();return[n/=a,o/=a,t.z]},t.prototype.screenToWorld=function(e,t){if(ke.isArray(e)&&void 0===t){var i=e;e=i[0],t=i[1]}var r=this.app.picker.processGroundPicking(e,t);return r?r.point.toArray():null},t.prototype.unprojectScreenToWorld=function(e,t,i){if(ke.isArray(e)&&void 0===t){var r=e;e=r[0],t=r[1]}var n=this.app.renderer.getPixelRatio();t*=n;var o=(e*=n)/this.app.renderer.getContext().canvas.width*2-1,a=-t/this.app.renderer.getContext().canvas.height*2+1;return i=i||-1,new THREE.Vector3(o,a,i).unproject(this.node).toArray()},t.prototype.getRaycaster=function(e,t){var i=new THREE.Raycaster;if(void 0===e&&void 0===t){var r=new THREE.Vector3;r.subVectors(this.controller.target,this.node.position),r.normalize(),i.set(this.node.position,r)}else{var n=this.app.calcRect(),o=new THREE.Vector2;o.x=e/n.width*2-1,o.y=-t/n.height*2+1,i.setFromCamera(o,this.node)}return i},t.prototype.lerpToPerspective=function(e,t){this.projectionType=T.Perspective,this.node.lerpToPerspective(e,t)},t.prototype.lerpToOrthographic=function(e,t,i,r){this.projectionType=T.Orthographic,this.node.lerpToOrthographic(e,t,i,r)},t.prototype.setSize=function(e,t){this.node.setSize(e,t)},t.prototype.stopFlying=function(e){var t=this.getControl("cameraControl");t&&t.stopFlying(e)},t.prototype.flyTo=function(e){var t=this.getControl("cameraControl");t&&t.flyTo(e)},t.prototype.lookAt=function(e){var t=this.getControl("cameraControl");if(t)return t.lookAt(e)},t.prototype.followObject=function(e){var t=this.getControl("cameraControl");t&&t.followObject(e)},t.prototype.stopFollowingObject=function(){var e=this.getControl("cameraControl");e&&e.stopFollowingObject()},t.prototype.movePath=function(e){var t=this.getControl("cameraControl");t&&t.movePath(e)},t.prototype.rotateAround=function(e){var t=this.getControl("cameraControl");t&&t.rotateAround(e)},t.prototype._stopRotating=function(){e.prototype.stopRotating.call(this)},t.prototype.stopRotating=function(e){var t=this.getControl("cameraControl");t&&t.stopRotating(e)},t.prototype.rotate=function(e){var t=this.getControl("cameraControl");t&&t.rotate(e)},t.prototype.rotateX=function(e){this.rotate([e,0,0])},t.prototype.rotateY=function(e){if(this.controller instanceof THREE.EarthOrbitControls){var t=new THREE.Vector3;t.copy(this.controller.object.position),t.normalize(),this.controller.object.rotateOnWorldAxis(t,THING.Math.degToRad(e)),this.controller._isCameraStatic=!1;var i=this.controller._getIntersectPoint();this.controller._isCameraStatic=!0,this.controller.target.copy(i)}else this.rotate([0,e,0])},t.prototype.rotateZ=function(e){this.rotate([0,0,e])},t.prototype.isInView=function(e){return!(!e||!e.isBaseObject)&&this.node.isInView(e.boundingBox.toBox())},t.prototype._setPosition=function(e){this.node.position.fromArray(e)},o(t,[{key:"frustum",get:function(){return Ms.multiplyMatrices(this.node.projectionMatrix,this.node.matrixWorldInverse),As.setFromMatrix(Ms),As}},{key:"flying",get:function(){var e=this.getControl("cameraControl");return!!e&&e.isFlying()}},{key:"isPerspectiveCamera",get:function(){return this.node.isPerspectiveCamera}},{key:"fov",set:function(e){this.node.setFov(e)},get:function(){return this.node.fov}},{key:"near",set:function(e){this._near=e,this.node.setNear(e)},get:function(){return this._near}},{key:"far",set:function(e){this._far=e,this.node.setFar(e)},get:function(){return this._far}},{key:"up",set:function(e){this.node.up.fromArray(e)},get:function(){return this.node.up.toArray()}},{key:"position",set:function(e){this._setPosition(e)},get:function(){return this.node.position.toArray()}},{key:"target",set:function(e){var t=this.getControl("cameraControl");t&&t.setTarget(e)},get:function(){return this.controller.target.toArray()}},{key:"distance",set:function(e){var t=ke.parseVector3(this.position),i=ke.parseVector3(this.target),r=new THREE.Vector3;r.subVectors(t,i),r.normalize(),r.multiplyScalar(e),i.add(r),this.position=i.toArray()},get:function(){var e=ke.parseVector3(this.position),t=ke.parseVector3(this.target);return e.distanceTo(t)}},{key:"direction",get:function(){var e=ke.parseVector3(this.position),t=ke.parseVector3(this.target),i=new THREE.Vector3;return i.subVectors(t,e),i.normalize(),i.toArray()}},{key:"rightDirection",get:function(){var e=THING.Utils.parseVector3(this.direction),t=THING.Utils.parseVector3(this.up),i=new THREE.Vector3;return i.crossVectors(e,t),i.normalize(),i.toArray()}}]),t}(bt),Rs=function(){function e(t){var i=this;n(this,e),this.app=t,this.picker=t.picker,this.orbit=new THREE.OrbitControls(this.app.renderCamera,this.app.mainDomElement),this.curOrbit=this.orbit,this.initOrbit(this.orbit),this.cameraObject=new Cs(this.app,this.app.renderCamera,this.orbit),this.toggleBackupInfo={},this.zoomTween=null,this._autoAdjustNear=!0,this._autoAdjustTarget=!0,this._autoHideObjectsWhenRotatingFunc=null,this._enableUpdateTargetOnWheel=!0,this._enableZoomOnTarget=!1,this._wheelOnMouseTargetScale=3,this._wheelOnMouseTargetPosition=null,this._autoFixCameraUp=!0,this._hadEnabledPicking=!1,this._targetObject=null,this._inputEnableFlag=new wt((function(e){i.curOrbit.enabled=e})),this._panEnableFlag=new wt((function(e){"normal"==i.mode?i.curOrbit.enablePan=e:i.curOrbit.enableRotate=e})),this._rotateEnableFlag=new wt((function(e){"normal"==i.mode?i.curOrbit.enableRotate=e:i.curOrbit.enablePan=e})),this._zoomEnableFlag=new wt((function(e){i.curOrbit.enableZoom=e})),this.cameraObject.isPerspectiveCamera&&(this.cameraFov=this.cameraObject.fov,this.cameraNear=this.cameraObject.near,this.cameraFar=this.cameraObject.far);var r=this;this.app.on("backgroundChanged",(function(e){var t=r.toggleBackupInfo.toggleSkyBox;t&&(t.background=e.value)}))}return e.prototype.initOrbit=function(e){e.minDistance=1e-4,e.minZoom=.15,e.maxZoom=8,e.autoRotate=!1,e.enableDamping=!0,e.minPolarAngle=0,e instanceof THREE.EarthOrbitControls||(e.maxPolarAngle=Math.PI),e.keyPanSpeed=.1,e.panSpeed=.1,e.rotateSpeed=.07,e.dampingFactor=.078,e.screenSpacePanning=!0,e.enabled=!0;var t=this;e.addEventListener("mousedownpanevent",(function(e){t.onMouseDownPanEvent(e)})),e.addEventListener("mouseuppanevent",(function(e){t.onMouseUpPanEvent(e)})),e.addEventListener("mousemoveevent",(function(e){t.onMouseMoveEvent(e)})),e.addEventListener("start",(function(e){t.onStart(e)})),e.addEventListener("end",(function(e){t.onEnd(e)})),e.addEventListener("wheel",(function(e){t.onWheel(e)})),e.addEventListener("change",(function(e){t.onChange(e)}))},e.prototype.isCameraController=function(){return!0},e.prototype._zoom=function(e,t,i){this.zoomTween&&this.zoomTween.stop();var r=this;this.zoomTween=new TWEEN.Tween({zoom:e}).to({zoom:t},i).easing(TWEEN.Easing.Linear.None).onUpdate((function(){r._rotateEnableFlag.lock(!1,"_zoom"),r.curOrbit.object.zoom=this._object.zoom,r.curOrbit.object.updateProjectionMatrix()})).onComplete((function(){r._rotateEnableFlag.unlock("_zoom")})).start()},e.prototype._change=function(e){this.app.trigger(e,{position:this.position,target:this.target})},e.prototype._autoFixTarget=function(){var e=this.curOrbit;if(!(e.target.distanceTo(e.object.position)>5)){var t=new THREE.Vector3(0,0,0);t.subVectors(e.target,e.object.position).normalize();var i=t.multiplyScalar(10),r=new THREE.Vector3(0,0,0);r.addVectors(e.object.position,i),e.target=r}},e.prototype._processWheelOnMouseTarget=function(e){var t=this.app.renderCamera,i=this.curOrbit,r=this.app.calcRect(),n=r.width/2,o=r.height/2,a=this.app.getClientPosition(e);(l=this._getIntersectPosition(a.x,a.y))||(l=this.cameraObject.unprojectScreenToWorld(a.x,a.y,.5));var s=this._getIntersectPosition(n,o);s||(s=this.cameraObject.unprojectScreenToWorld(n,o,.5));var l=ke.parseVector3(l),u=ke.parseVector3(this.position);this._wheelOnMouseTargetPosition=l.toArray();var c=t.position.distanceTo(l)/100;c*=this._wheelOnMouseTargetScale,l.sub(u).normalize().multiplyScalar(c),e.delta<0?(t.position.x+=l.x,t.position.y+=l.y,t.position.z+=l.z):(t.position.x-=l.x,t.position.y-=l.y,t.position.z-=l.z),i.target.x=s.x,i.target.y=s.y,i.target.z=s.z},e.prototype._intersectObject=function(e,t){if(void 0===e||void 0===t){var i=this.app.calcRect();e=i.width/2,t=i.height/2}var r=this.app.camera.getRaycaster(e,t),n=this.app.picker.pickIntersectObjects(r,!1,e,t);if(!n.length)return null;for(var o=this.app.picker.floorPickingGround,a=0;a<n.length;a++){var s=n[a].object;(o.isMeshOf(s)||s.userData.__debugObject__)&&n.splice(a--,1)}if(n.length&&this.app.objectManager.getBaseObject(n[0].node))return n[0].getPickedPosition();return null},e.prototype._getIntersectPosition=function(e,t){var i=this._intersectObject(e,t);if(i)return i;var r=this.app.camera.getRaycaster(e,t),n=this.app.picker.floorPickingGround;return intersect=n.intersectByRaycaster(r),intersect?intersect.point.toArray():null},e.prototype._adjustTargetStrictly=function(){var e=this._intersectObject();e&&(this.target=e)},e.prototype.onMouseDownPanEvent=function(e){this._autoAdjustTarget&&this._adjustTargetStrictly()},e.prototype.onMouseUpPanEvent=function(e){},e.prototype.onMouseMoveEvent=function(e){this._change("cameraChangeMouseMove")},e.prototype.onStart=function(e){this.flying?this._hadEnabledPicking=!1:(this._hadEnabledPicking=!0,this.app.picker._state.lock(!1,"onStart")),this._change("cameraChangeStart"),this._change("cameraControllerChangeStart")},e.prototype.onEnd=function(e){this._hadEnabledPicking&&(this._hadEnabledPicking=!1,this.app.picker._state.unlock("onStart")),this._change("cameraChangeEnd"),this._change("cameraControllerChangeEnd")},e.prototype.onWheel=function(e){this._enableUpdateTargetOnWheel&&this._autoFixTarget(),this.app.trigger("camerazoom",{delta:e.delta})},e.prototype.onChange=function(e){this.app.trigger("cameracontrollerchanged"),this._change("cameraChange")},e.prototype.zoomIn=function(e){var t=e.zoom||1,i=e.time||1e3,r=t,n=this.curOrbit.object.zoom;this._zoom(r,n,i)},e.prototype.zoomOut=function(e){var t=e.zoom||1,i=e.time||1e3,r=this.curOrbit.object.zoom,n=t;this._zoom(r,n,i)},e.prototype.worldToScreen=function(e){return this.cameraObject.worldToScreen(e)},e.prototype.screenToWorld=function(e,t){return this.cameraObject.screenToWorld(e,t)},e.prototype.unprojectScreenToWorld=function(e,t,i){return this.cameraObject.unprojectScreenToWorld(e,t,i)},e.prototype.setProjectionType=function(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3,o=this,a=e!=this.projectionType;switch(e){case T.Perspective:if(this.cameraObject.lerpToPerspective(n,(function(){if(a&&o.projectionType==T.Perspective){var e=o.toggleBackupInfo.toggleSkyBox;e&&(o.app.background=e.background,o.app.skyBox=e.skyBox,o.app.backgroundAdditiveColor=e.backgroundAdditiveColor,o.app.backgroundColorScaleFactor=e.backgroundColorScaleFactor,o.toggleBackupInfo.toggleSkyBox=null)}})),a){var s=this.toggleBackupInfo.toggleKeyPanSpeed;void 0!==s&&(this.curOrbit.keyPanSpeed=s);var l=this.toggleBackupInfo.toggleMousePanSpeed;void 0!==l&&(this.curOrbit.panSpeed=l);var u=this.toggleBackupInfo.toggleDampingFactor;void 0!==u&&(this.curOrbit.dampingFactor=u)}break;case T.Orthographic:if(a){var c=this.toggleBackupInfo.toggleSkyBox;c?(c.backgroundAdditiveColor=this.app.backgroundAdditiveColor,c.backgroundColorScaleFactor=this.app.backgroundColorScaleFactor):this.toggleBackupInfo.toggleSkyBox={skyBox:this.app.skyBox,background:this.app.background,backgroundAdditiveColor:this.app.backgroundAdditiveColor,backgroundColorScaleFactor:this.app.backgroundColorScaleFactor}}this.app.skyBox=null,a&&(this.toggleBackupInfo.toggleKeyPanSpeed=this.curOrbit.keyPanSpeed,this.toggleBackupInfo.toggleMousePanSpeed=this.curOrbit.panSpeed,this.toggleBackupInfo.toggleDampingFactor=this.curOrbit.dampingFactor),this.curOrbit.keyPanSpeed=t/6400,this.curOrbit.panSpeed=t/6400,this.curOrbit.dampingFactor=.12;var h=ke.parseVector3(i),p=ke.parseVector3(r);this.cameraObject.lerpToOrthographic(h,p,n);break;default:return!1}},e.prototype._getBestLocation=function(e,t,i){var r=ke.parseVector3(t.size),n=ke.parseVector3(t.center);if(!r.x||!r.y||!r.z){r.x=5,r.y=5,r.z=5}var o=n.clone(),a=new THREE.Vector3(0,1,0);if(e==T.Perspective)o.x=n.x+r.x,o.y=n.y+r.y,o.z=n.z+r.z;else{var s=i||r.length();o.y=n.y+s,a=new THREE.Vector3(0,0,-1)}return{lookAt:n,pos:o,up:a,scale:r}},e.prototype.getBestLocation=function(e){var t;return t=ke.isArray(e)?new ct(this.app,e).boundingBox:e.boundingBox,this._getBestLocation(this.projectionType,t)},e.prototype.setType=function(e,t,i,r,n){var o=this._getBestLocation(t,e.boundingBox,n),a=o.pos.distanceTo(o.lookAt),s=this.distanceLimited[1];if(a>=s){var l=o.pos.subVectors(o.pos.clone(),o.lookAt);l.normalize();var u=o.pos.addVectors(o.lookAt,l.multiplyScalar(s));o.pos=u}switch(this.setProjectionType(t,o.scale.length(),o.pos,o.lookAt,i),t){case T.Perspective:var c=this.toggleBackupInfo.toggleInitPos;void 0!==c&&(o.pos=ke.parseVector3(c));var h=this.toggleBackupInfo.toggleInitLookAt;void 0!==h&&(o.lookAt=ke.parseVector3(h));break;case T.Orthographic:this.toggleBackupInfo.toggleInitPos=this.position,this.toggleBackupInfo.toggleInitLookAt=this.target;break;default:return!1}var p=this.app.rendererManager.getCurrentControl(),d=p.getConfig(),f=d.temporalSuperSampling.enable,m=d.postEffect.screenSpaceAmbientOcclusion.enable;p.mergeConfig({temporalSuperSampling:{enable:!1},postEffect:{screenSpaceAmbientOcclusion:{enable:!1}}}).update();var g=function(){p.mergeConfig({temporalSuperSampling:{enable:f},postEffect:{screenSpaceAmbientOcclusion:{enable:m}}}).update(),r&&r()};return this.flyTo({position:o.pos.toArray(),target:o.lookAt.toArray(),up:o.up.toArray(),time:i,stop:g,complete:g}),!0},e.prototype.toggleNormalViewMode=function(e){return this.viewMode!=S.Normal&&(this.toggleObject({object:this.app.root,is3D:!0,complete:function(){e&&e()}}),!0)},e.prototype.toggleObject=function(e){var t=(e=e||{}).object||this.app.level.current||this.app.root,i=ke.parseValue(e.is3D,!1),r=e.complete,n=e.time||1e3,o=ke.parseValue(e.force,!1),a=e.height,s=this.app.webViewManager.mixerContext,l=!1;return i?(o||this.projectionType!=T.Perspective)&&(this.projectionType!=T.Perspective&&this._rotateEnableFlag.unlock("toggleObject"),l=this.setType(t,T.Perspective,n,r,a),s.cssCamera=s.backupCSSCamera):(o||this.projectionType!=T.Orthographic)&&(this.projectionType!=T.Orthographic&&this._rotateEnableFlag.lock(!1,"toggleObject"),l=this.setType(t,T.Orthographic,n,r,a),s.cssCamera=this.app.renderCamera.cameraO.clone(),s.cssCamera.getEffectiveFOV=function(){return THING.App.current.renderCamera.getEffectiveFOV()}),l&&this.app.trigger("cameraViewChange",{view:this.projectionType}),l},e.prototype.resize=function(e,t){this.cameraObject.setSize(e,t)},e.prototype.getRaycaster=function(e,t){return this.cameraObject.getRaycaster(e,t)},e.prototype._buildFlyParams=function(e){var t=this,i=e._flyStart,r=e._flying,n=e._flyStop,o=e._flyComplete,a=ke.parseValue(e.pickable,!1);return e.flyStart=function(){a||t.picker._state.lock(!1,"_buildFlyParams"),t._change("cameraChangeStart"),i&&i()},e.flying=function(){ke.isFunction(t.curOrbit.setState)&&t.curOrbit.setState(),t._change("cameraChange"),r&&r()},e.flyStop=function(){ke.isFunction(t.curOrbit.setState)&&t.curOrbit.setState(),a||t.picker._state.unlock("_buildFlyParams"),t._change("cameraChangeEnd");var i=e.stop;i&&i(),n&&n()},e.flyComplete=function(){t.picker._state.unlock("_buildFlyParams"),ke.isFunction(t.curOrbit.setState)&&t.curOrbit.setState(),t._change("cameraChangeEnd");var i=e.target||e.object;i instanceof bt&&i.trigger("cameraFlyComplete");var r=e.targetForFlyComplete;r!=i&&r instanceof bt&&r.trigger("cameraFlyComplete"),t.app.events.dispatchEvent({type:"cameraFlyComplete"});var n=e.complete;n&&n(),o&&o()},e.autoFixUp=this._autoFixCameraUp,e.targetForFlyComplete=this.app.level.current,e},e.prototype.fit=function(e){(e=e||{}).isBaseObject&&(e={object:e}),e.object=e.object||this.app.root,e.time=1,this.cameraObject.flyTo(e)},e.prototype.stopFlying=function(e){this.cameraObject.stopFlying(e)},e.prototype.flyTo=function(e){e=this._buildFlyParams(e),this.cameraObject.flyTo(e)},e.prototype.movePath=function(e){e=this._buildFlyParams(e),this.cameraObject.movePath(e)},e.prototype.lookAt=function(e){this.cameraObject.lookAt(e)?(this._rotateEnableFlag.lock(!1,"lookAt"),this._panEnableFlag.lock(!1,"lookAt")):(this._rotateEnableFlag.unlock("lookAt"),this._panEnableFlag.unlock("lookAt"))},e.prototype.stopRotateAround=function(e){this.cameraObject.stopRotating(e)},e.prototype.rotateAround=function(e){var t=this;e=e||{};var i=ke.parseValue(e.pickable,!0);e.rotateStart=function(){i||t.picker._state.lock(!1,"rotateAround")},e.rotateComplete=function(){i||t.picker._state.unlock("rotateAround")},this.cameraObject.rotateAround(e)},e.prototype.rotateAroundX=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;this.rotateAround({xRotateAngle:e,time:t})},e.prototype.rotateAroundY=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;this.rotateAround({yRotateAngle:e,time:t})},e.prototype.followObject=function(e){e=e||{},this.cameraObject.followObject(e);var t=ke.parseValue(e.enableRotate,!1),i=ke.parseValue(e.enableZoom,!1);t||this._rotateEnableFlag.lock(!1,"followObject"),i||this._zoomEnableFlag.lock(!1,"followObject")},e.prototype.stopFollowingObject=function(){this.cameraObject.stopFollowingObject(),this._rotateEnableFlag.unlock("followObject"),this._zoomEnableFlag.unlock("followObject")},e.prototype.canUpdateOrbit=function(){return!this.cameraObject.flying&&!(!this.curOrbit.enabled&&!this.curOrbit.autoRotate)},e.prototype.update=function(){this.cameraObject.update(),this.canUpdateOrbit()&&this.curOrbit.update()},e.prototype.onUpdate=function(e){this.update(e)},e.prototype.zoom=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(e=Math.min(this.distance-1,e),this.projectionType==T.Perspective){var i=ke.parseVector3(this.direction);i.multiplyScalar(e);var r=ke.parseVector3(this.position);r.add(i),this.flyTo({position:r.toArray(),target:this.target,time:t})}else{var n=this.curOrbit.object.zoom+e/20;n>0&&this.zoomOut({zoom:n,time:t})}},e.prototype.rotateX=function(e,t){ke.isNull(t)?this.cameraObject.rotateX(e):(console.warn('Please use "this.rotateAround({xRotateAngle: angle,time});" to replace rotateX(angle, time)'),this.rotateAround({xRotateAngle:e,time:t}))},e.prototype.rotateY=function(e,t){ke.isNull(t)?this.cameraObject.rotateY(e):(console.warn('Please use "this.rotateAround({yRotateAngle: angle,time});" to replace rotateX(angle, time)'),this.rotateAround({yRotateAngle:e,time:t}))},e.prototype.rotateZ=function(e){this.cameraObject.rotateZ(e)},e.prototype.move=function(e,t){var i=this.dampingFactor/.12;this.curOrbit.move(-e*i,t*i)},e.prototype.loadViewPoint=function(e){this.app.viewPointManger.loadJSON(e)},e.prototype.playViewPoint=function(e){this.app.viewPointManger.play(e)},e.prototype.pauseViewPoint=function(e){this.app.viewPointManger.pause(e)},e.prototype.isInView=function(e){return!!e&&this.cameraObject.isInView(e)},e.prototype.isCovered=function(e){return!!e&&(console.warn("not impl yet"),!0)},e.prototype.disable=function(e){(e=e||{}).rotate=ke.parseValue(e.rotate,!0),e.pan=ke.parseValue(e.pan,!0),e.zoom=ke.parseValue(e.zoom,!0),e.rotate&&this._rotateEnableFlag.lock(!1,"disable"),e.pan&&this._panEnableFlag.lock(!1,"disable"),e.zoom&&this._zoomEnableFlag.lock(!1,"disable")},e.prototype.resume=function(e){(e=e||{}).rotate=ke.parseValue(e.rotate,!0),e.pan=ke.parseValue(e.pan,!0),e.zoom=ke.parseValue(e.zoom,!0),e.rotate&&this._rotateEnableFlag.unlock("disable"),e.pan&&this._panEnableFlag.unlock("disable"),e.zoom&&this._zoomEnableFlag.unlock("disable")},e.prototype.showTargetNode=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?this._targetObject||(this._targetObject=this.app.create({type:"Box",position:this.target,style:{color:"#FF0000"}}),this._targetObject.pickable=!1,this._targetObject.style.outlineColor=65535,this._targetObject.node.traverse((function(e){e.userData.__debugObject__=!0}))):this._targetObject&&(this._targetObject.destroy(),this._targetObject=null)},e.prototype.distanceTo=function(e){return this.cameraObject.distanceTo(e)},e.prototype.log=function(){console.log("["+this.position.toString()+"], ["+this.target.toString()+"]")},e.prototype.dolly=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;console.warn("[CameraController] Please use '.zoom()' to replace '.dolly()'"),this.zoom(e,t)},e.prototype.theta=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;console.warn("[CameraController] Please use '.rotateX()' to replace '.theta()'"),this.rotateX(e,t)},e.prototype.phi=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;console.warn("[CameraController] Please use '.rotateY()' to replace '.theta()'"),this.rotateY(e,t)},o(e,[{key:"aspect",get:function(){return this.cameraObject.node.cameraP.aspect}},{key:"frustum",get:function(){return this.cameraObject.frustum}},{key:"camera",get:function(){return this.app.renderCamera}},{key:"viewMode",set:function(e){this.toggleObject({is3D:e==S.Normal})},get:function(){return this.projectionType==T.Perspective?S.Normal:S.TopView}},{key:"projectionType",set:function(e){this.setProjectionType(e,this.distance,this.position,this.target)},get:function(){return this.cameraObject.projectionType}},{key:"enableDamping",set:function(e){this.curOrbit.enableDamping=e},get:function(){return this.curOrbit.enableDamping}},{key:"dampingFactor",set:function(e){this.curOrbit.dampingFactor=e},get:function(){return this.curOrbit.dampingFactor}},{key:"fov",set:function(e){this.cameraObject.fov=e;var t=this.app.webViewManager.mixerContext.cssCamera;t.fov=e,t.updateProjectionMatrix()},get:function(){return this.cameraObject.fov}},{key:"near",set:function(e){this.cameraObject.near=e},get:function(){return this.cameraObject.near}},{key:"far",set:function(e){this.cameraObject.far=e},get:function(){return this.cameraObject.far}},{key:"zoomLimited",set:function(e){this.curOrbit.minZoom=e[0],this.curOrbit.maxZoom=e[1]},get:function(){return[this.curOrbit.minZoom,this.curOrbit.maxZoom]}},{key:"zoomFactor",set:function(e){void 0!==this.curOrbit.zoomFactor?this.curOrbit.zoomFactor=e:void 0!==this.curOrbit.zoomSpeed&&(this.curOrbit.zoomSpeed=e)},get:function(){return void 0!==this.curOrbit.zoomFactor?this.curOrbit.zoomFactor:void 0!==this.curOrbit.zoomSpeed?this.curOrbit.zoomSpeed:1}},{key:"distanceLimited",set:function(e){this.curOrbit.minDistance=e[0],this.curOrbit.maxDistance=e[1]},get:function(){return[this.curOrbit.minDistance,this.curOrbit.maxDistance]}},{key:"xAngleLimitRange",set:function(e){var t=90-e[0],i=90-e[1];this.curOrbit.minPolarAngle=THING.Math.degToRad(Math.min(t,i)),this.curOrbit.maxPolarAngle=THING.Math.degToRad(Math.max(t,i))},get:function(){var e=function(e){return 90-THING.Math.radToDeg(e)},t=e(this.curOrbit.minPolarAngle),i=e(this.curOrbit.maxPolarAngle);return[Math.min(t,i),Math.max(t,i)]}},{key:"yAngleLimitRange",set:function(e){this.curOrbit.minAzimuthAngle=THING.Math.degToRad(e[0]),this.curOrbit.maxAzimuthAngle=THING.Math.degToRad(e[1])},get:function(){return[THING.Math.radToDeg(this.curOrbit.minAzimuthAngle),THING.Math.radToDeg(this.curOrbit.maxAzimuthAngle)]}},{key:"keyPanSpeed",set:function(e){this.curOrbit.keyPanSpeed=e},get:function(){return this.curOrbit.keyPanSpeed}},{key:"mousePanSpeed",set:function(e){this.curOrbit.panSpeed=e},get:function(){return this.curOrbit.panSpeed}},{key:"distance",set:function(e){this.cameraObject.distance=e},get:function(){return this.cameraObject.distance}},{key:"direction",get:function(){return this.cameraObject.direction}},{key:"rightDirection",get:function(){return this.cameraObject.rightDirection}},{key:"up",set:function(e){this.cameraObject.up=e},get:function(){return this.cameraObject.up}},{key:"position",set:function(e){e&&(this.cameraObject.position=e)},get:function(){return this.cameraObject.position}},{key:"target",set:function(e){e&&(this.cameraObject.target=e)},get:function(){return this.cameraObject.target}},{key:"inputEnabled",set:function(e){this._inputEnableFlag.enable(e)},get:function(){return this._inputEnableFlag.isEnable()}},{key:"enableRotate",set:function(e){this._rotateEnableFlag.enable(e)},get:function(){return this._rotateEnableFlag.isEnable()}},{key:"enableZoom",set:function(e){this._zoomEnableFlag.enable(e)},get:function(){return this._zoomEnableFlag.isEnable()}},{key:"enablePan",set:function(e){this._panEnableFlag.enable(e)},get:function(){return this._panEnableFlag.isEnable()}},{key:"flying",get:function(){return this.cameraObject.flying}},{key:"mode",set:function(e){this.mode!=e&&(this.curOrbit.enabled=!1,"earth"==e?(this.curOrbit=new THREE.EarthOrbitControls(this.app.renderCamera,this.app.mainDomElement),this.curOrbit.app=this.app,this.initOrbit(this.curOrbit),this.autoAdjustNear=!1):(this.curOrbit.dispose(),this.curOrbit=this.orbit,this.curOrbit.enabled=!0,this.autoAdjustNear=!0),this.cameraObject.controller=this.curOrbit)},get:function(){return this.curOrbit instanceof THREE.EarthOrbitControls?"earth":"normal"}},{key:"degreeToWorldYAxis",get:function(){var e=ke.parseVector3(this.direction),t=new THREE.Vector3(0,-1,0),i=e.dot(t);return THING.Math.radToDeg(Math.acos(i))}},{key:"autoAdjustNear",set:function(e){this._autoAdjustNear=e,e||(this.cameraObject.near=this.cameraObject._near)},get:function(){return this._autoAdjustNear}},{key:"autoAdjustTarget",set:function(e){this._autoAdjustTarget=e},get:function(){return this._autoAdjustTarget}},{key:"enableUpdateTargetOnWheel",set:function(e){this._enableUpdateTargetOnWheel=e},get:function(){return this._enableUpdateTargetOnWheel}},{key:"enableZoomOnTarget",set:function(e){if("earth"==this.mode)this.curOrbit.enableZoomOnTarget=e,this.curOrbit._keepTarget=!e;else{var t=this;this._enableZoomOnTarget=e,this.inputEnabled=!e,e?(this.app.on("mousewheel",(function(e){t._inputEnableFlag.unlock("enableZoomOnTarget"),t._processWheelOnMouseTarget(e)}),"_processWheelOnMouseTarget_"),this.app.on("mousedown",(function(e){t._inputEnableFlag.lock(!0,"enableZoomOnTarget")}),"_processWheelOnMouseTarget_mousedown")):(this.app.off("mousewheel",null,"_processWheelOnMouseTarget_"),this.app.off("mousedown",null,"_processWheelOnMouseTarget_mousedown"))}},get:function(){return"earth"==this.mode?this.curOrbit.enableZoomOnTarget:this._enableZoomOnTarget}},{key:"wheelOnMouseTargetScale",set:function(e){this._wheelOnMouseTargetScale=e},get:function(){return this._wheelOnMouseTargetScale}},{key:"autoFixCameraUp",set:function(e){this._autoFixCameraUp=e},get:function(){return this._autoFixCameraUp}},{key:"autoHideObjectsWhenRotatingFunc",set:function(e){if(this._autoHideObjectsWhenRotatingFunc=e,this.app.off("cameraControllerChangeStart",null,"__autoHideObjectsWhenRotatingFunc__start__"),this.app.off("cameraControllerChangeEnd",null,"__autoHideObjectsWhenRotatingFunc__end__"),this._autoHideObjectsWhenRotatingFunc){if(!ke.isFunction(this._autoHideObjectsWhenRotatingFunc))return;var t=this;this.app.on("cameraControllerChangeStart",(function(e){t.app.query(".Thing").forEach((function(e){if(t._autoHideObjectsWhenRotatingFunc&&!1===t._autoHideObjectsWhenRotatingFunc(e)&&e.visible){e._prevVisible_auto_hide=!0;var i=app.modelResource.get(e.url);i&&i.loadingBox?(e.changeAppearance(i.loadingBox.clone()),e._needRevertAppearance_auto_hide=!0):e.visible=!1}}))}),"__autoHideObjectsWhenRotatingFunc__start__"),this.app.on("cameraControllerChangeEnd",(function(e){t.app.query(".Thing").forEach((function(e){e._prevVisible_auto_hide&&(e._needRevertAppearance_auto_hide?(e.changeAppearance(null),delete e._needRevertAppearance_auto_hide):e.visible=!0,delete e._prevVisible_auto_hide)}))}),"__autoHideObjectsWhenRotatingFunc__end__")}},get:function(){return this._autoHideObjectsWhenRotatingFunc}},{key:"mouseButtons",set:function(e){var t=function(e,t){var i={left:THREE.MOUSE.LEFT,middle:THREE.MOUSE.MIDDLE,right:THREE.MOUSE.RIGHT};return ke.parseValue(i[e],t)};e=e||{};var i=this.curOrbit.mouseButtons,r=t(e.left,ke.parseValue(i.LEFT,i.ORBIT)),n=t(e.middle,ke.parseValue(i.MIDDLE,i.ZOOM)),o=t(e.right,ke.parseValue(i.RIGHT,i.PAN));"normal"==this.mode?this.curOrbit.mouseButtons={LEFT:r,MIDDLE:n,RIGHT:o}:"earth"==this.mode&&(this.curOrbit.mouseButtons={ORBIT:r,ZOOM:n,PAN:o})},get:function(){var e=function(e){return["left","middle","right"][e]},t=this.curOrbit.mouseButtons;return{left:e(ke.parseValue(t.LEFT,t.ORBIT)),middle:e(ke.parseValue(t.MIDDLE,t.ZOOM)),right:e(ke.parseValue(t.RIGHT,t.PAN))}}},{key:"options",set:function(e){var t=this.options;ke.mergeObject(t,e,!0),this.mouseButtons={left:t.rotationKey,middle:t.zoomKey,right:t.moveKey},"normal"==this.mode?(this.enableZoomOnTarget=t.enableZoomOnTarget,this.enableUpdateTargetOnWheel=t.enableUpdateTargetOnWheel):"earth"==this.mode&&this.curOrbit.setOptions(t)},get:function(){var e={rotationKey:this.mouseButtons.left,zoomKey:this.mouseButtons.middle,moveKey:this.mouseButtons.right};return"normal"==this.mode?(e.enableZoomOnTarget=this.enableZoomOnTarget,e.enableUpdateTargetOnWheel=this.enableUpdateTargetOnWheel):"earth"==this.mode&&ke.mergeObject(e,this.curOrbit.getOptions(e)),e}},{key:"toggle3D",set:function(e){console.warn("[CameraController] Please use '.viewMode=THING.CameraView.Normal/TopView' to replace '.toggle3D'"),this.viewMode=e?S.Normal:S.TopView},get:function(){return console.warn("[CameraController] Please use '.viewMode == THING.CameraView.Normal' to replace '.toggle3D'"),this.viewMode==S.Normal}},{key:"enabled",set:function(e){console.warn("[CameraController] Please use '.inputEnabled' to replace '.enabled'"),this.inputEnabled=e},get:function(){return console.warn("[CameraController] Please use '.inputEnabled' to replace '.enabled'"),this.inputEnabled}},{key:"minZoom",set:function(e){console.warn("[CameraController] Please use '.zoomLimited=[min, max]' to replace '.minZoom'"),this.zoomLimited=[e,this.zoomLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.zoomLimited[0]' to replace '.minZoom'"),this.zoomLimited[0]}},{key:"maxZoom",set:function(e){console.warn("[CameraController] Please use '.zoomLimited=[min, max]' to replace '.maxZoom'"),this.zoomLimited=[this.zoomLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.zoomLimited[0]' to replace '.maxZoom'"),this.zoomLimited[1]}},{key:"minDistance",set:function(e){console.warn("[CameraController] Please use '.distanceLimited=[min, max]' to replace '.minDistance'"),this.distanceLimited=[e,this.distanceLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.distanceLimited[0]' to replace '.minDistance'"),this.distanceLimited[0]}},{key:"maxDistance",set:function(e){console.warn("[CameraController] Please use '.distanceLimited=[min, max]' to replace '.maxDistance'"),this.distanceLimited=[this.distanceLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.distanceLimited[0]' to replace '.maxDistance'"),this.distanceLimited[1]}},{key:"minPolarAngle",set:function(e){console.warn("[CameraController] Please use '.verticalAngleLimited=[min, max]' to replace '.minPolarAngle'"),this.verticalAngleLimited=[e,this.verticalAngleLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.verticalAngleLimited[0]' to replace '.minPolarAngle'"),this.verticalAngleLimited[0]}},{key:"maxPolarAngle",set:function(e){console.warn("[CameraController] Please use '.verticalAngleLimited=[min, max]' to replace '.maxPolarAngle'"),this.verticalAngleLimited=[this.verticalAngleLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.verticalAngleLimited[0]' to replace '.maxPolarAngle'"),this.verticalAngleLimited[1]}},{key:"minAzimuthAngle",set:function(e){console.warn("[CameraController] Please use '.horizontalAngleLimited=[min, max]' to replace '.minAzimuthAngle'"),this.horizontalAngleLimited=[e,this.horizontalAngleLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.horizontalAngleLimited[0]' to replace '.minAzimuthAngle'"),this.horizontalAngleLimited[0]}},{key:"maxAzimuthAngle",set:function(e){console.warn("[CameraController] Please use '.horizontalAngleLimited=[min, max]' to replace '.maxAzimuthAngle'"),this.horizontalAngleLimited=[this.horizontalAngleLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.horizontalAngleLimited[0]' to replace '.maxAzimuthAngle'"),this.horizontalAngleLimited[1]}},{key:"verticalAngleLimited",set:function(e){console.warn("[CameraController] Please use '.xAngleLimited' to replace '.verticalAngleLimited'"),this.xAngleLimited=e},get:function(){return console.warn("[CameraController] Please use '.xAngleLimited' to replace '.verticalAngleLimited'"),this.xAngleLimited}},{key:"horizontalAngleLimited",set:function(e){console.warn("[CameraController] Please use '.yAngleLimited' to replace '.verticalAngleLimited'"),this.yAngleLimited=e},get:function(){return console.warn("[CameraController] Please use '.yAngleLimited' to replace '.verticalAngleLimited'"),this.yAngleLimited}},{key:"yAngleLimited",set:function(e){console.warn("[CameraController] Please use '.xAngleLimitRange' to replace '.yAngleLimited'"),this.xAngleLimitRange=e},get:function(){return console.warn("[CameraController] Please use '.xAngleLimitRange' to replace '.yAngleLimited'"),this.xAngleLimitRange}},{key:"xAngleLimited",set:function(e){console.warn("[CameraController] Please use '.yAngleLimitRange' to replace '.xAngleLimited'"),this.yAngleLimitRange=e},get:function(){return console.warn("[CameraController] Please use '.yAngleLimitRange' to replace '.xAngleLimited'"),this.yAngleLimitRange}},{key:"rotating",get:function(){return console.warn("[CameraController] Please use '.flying' to replace '.rotating'"),this.flying}},{key:"panSpeed",set:function(e){console.warn("[CameraController] Please use '.keyPanSpeed' to replace '.panSpeed'"),this.keyPanSpeed=e},get:function(){return console.warn("[CameraController] Please use '.keyPanSpeed' to replace '.panSpeed'"),this.keyPanSpeed}},{key:"enableUpdateTargetByMove",set:function(e){},get:function(){return!0}}]),e}(),Ds=function(){function e(t){n(this,e),this.app=t,this._previous=null,this._current=null,this._root=null,this._changed=!1,this._options={outlineColor:16744448,autoChangeBackground:!0,autoBakeFloor:!0,autoHideFloorObjects:!0,autoEnterSubLevel:!0,autoBackFromSubLevel:!0}}return e.prototype.init=function(){this._root=this.app.root},e.prototype.buildState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var i={};i.name=t+"Level";var r=[];e instanceof hr?(r.push("floor"),r.push("_floor")):e instanceof On&&(r.push("building"),r.push("_building"));for(var n=0;n<r.length;n++)i[r[n]]=e;return i},e.prototype.buildAfterEnterState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var i=this.previous?this.previous.type:"";"Campus"==i&&(i="Outdoors");var r={prevState:{name:i+"Level"},state:this.buildState(e),stateName:t+"Level"};return this.previous&&(this.previous instanceof On?(r.prevState.building=this.previous,r.prevState._building=this.previous):this.previous instanceof hr&&(r.prevState.floor=this.previous,r.prevState._floor=this.previous)),r},e.prototype.buildBeforeEnterState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var i=this.current?this.current.type:"";"Campus"==i&&(i="Outdoors");var r={prevState:{name:i+"Level"},curState:this.buildState(e),stateName:t+"Level"};return this.previous&&(this.previous instanceof On?(r.prevState.building=this.previous,r.prevState._building=this.previous):this.previous instanceof hr&&(r.prevState.floor=this.previous,r.prevState._floor=this.previous)),r},e.prototype.getEventType=function(e,t){var i=t.type;return"Campus"==i&&(i="Outdoors"),e+i+"Level"},e.prototype.buildEventArguments=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var i={name:t+"Level"};return i.state=this.buildState(e),i},e.prototype.notifyBeforeEnterState=function(e){this.app.trigger("beforeEnterState",this.buildBeforeEnterState(e))},e.prototype.notifyAfterEnterState=function(e){this.app.trigger("afterEnterState",this.buildAfterEnterState(e))},e.prototype.nofityAfterLevelChange=function(e){var t=e.object;this.app.trigger(this.getEventType("enter",t),this.buildEventArguments(t)),this.app.trigger(this.getEventType("afterEnter",t),this.buildEventArguments(t))},e.prototype.notifyBeforeLevelChange=function(e){this.app.trigger(this.getEventType("beforeEnter",e),this.buildEventArguments(e))},e.prototype._getLevelType=function(){var e=this._current;return e?e.type:""},e.prototype._leaveLevel=function(e,t){if(this.app.trigger(k.BeforeLevelChange,{level:this._getLevelType(),current:this._current,previous:this._previous,next:e}),this._current){var i=ke.cloneObject(t);i.level=this._getLevelType(),i.object=e,i.current=e,i.previous=this._current,this._current.trigger(k.LevelChange,i),this._current.trigger(k.LeaveLevel,i),this.app.trigger(k.LeaveLevel,i)}e&&(this.notifyBeforeLevelChange(e),this.notifyBeforeEnterState(e))},e.prototype._notifyEnterLevel=function(e,t){t.object=e,this.app.trigger(k.EnterLevel,t),this.nofityAfterLevelChange(t)},e.prototype._enterLevel=function(e,t){var i=this;if(this._changed=!0,this._previous=this._current,this._current=e,t.level=this._getLevelType(),t.current=this._current,t.object=this._current,t.previous=this._previous,this.app.trigger(k.LevelChange,t),e){var r=t.lastObject;r.internalUserData.level_complete||(r.internalUserData.level_complete=!0,r.one(k.EnterLevel,(function(e){delete e.object.internalUserData.level_complete;var n=t.userComplete;n&&n(),r.one("cameraFlyComplete",{lastLevelChanged:!0},(function(e){if(e.data.lastLevelChanged&&e.object==r){var n=t.flyComplete;n&&n()}e.object.trigger(k.LevelFlyEnd,{level:i._getLevelType(),object:e.object,current:e.object,previous:i.previous}),i.app.trigger(k.LevelFlyEnd,{level:i._getLevelType(),object:e.object,current:e.object,previous:i.previous})}),"___level_camera_fly_complete___")}),"___level_complete___")),e.trigger(k.LevelChange,t),this.notifyAfterEnterState(e);var n=e.isPauseEvent(k.EnterLevel,O.LevelFly),o=e.hasEvent(k.EnterLevel,O.LevelFly);if(t.jumping||n||!o){e.pauseEvent(k.EnterLevel,null,O.LevelFly),e.trigger(k.EnterLevel,t),e.resumeEvent(k.EnterLevel,null,O.LevelFly),this._notifyEnterLevel(e,t),t.jumping||n?this.jumpLevelPath(t):this.app.one("cameraFlyComplete",(function(e){i.jumpLevelPath(t)}),"sceneLevel_cameraFlyComplete");var a=t.complete;a&&a()}else this.app.one("cameraFlyComplete",(function(e){i.jumpLevelPath(t)}),"sceneLevel_cameraFlyComplete"),e.trigger(k.EnterLevel,t),this._notifyEnterLevel(e,t)}},e.prototype._change=function(e,t){t=t||{};var i=this;this.app.camera.toggleNormalViewMode((function(){i._change(e,t)}))||("Outdoors"==e.type&&(console.warn("Please use campus to change, not outdoors"),e=e.parents.query(".Campus")[0]),e.isPauseEvent(k.EnterLevel)||(this._leaveLevel(e,t),this._enterLevel(e,t)))},e.prototype.updateJumping=function(e,t){var i=this._current;i&&(i.isChildOf(e)||i.isBrotherOf(e))&&(t.jumping=!0,t.skipBackupCameraInfo=!0)},e.prototype.getParents=function(e,t){for(var i=[],r=e.parents,n=0;n<r.length;n++){var o=r[n];if(o==this.app.root)break;if(i.push(o),o==t)break}return i},e.prototype.getLevelPath=function(e,t){if(ke.parseValue(this.options.autoEnterSubLevel,t.autoEnterSubLevel)){for(var i=e.children.concat(),r=0;r<i.length;r++){i[r].isFloor||i.splice(r--,1)}1===i.length&&(e=i[0])}var n=[];if(this._current==e)n=[e];else if(this._current)if(this._current.isChildOf(e))(n=this.getParents(this._current,e)).length>=2&&(t.jumping=!0);else if(e.isChildOf(this._current))(n=(n=this.getParents(e,this._current)).reverse()).splice(0,1),n.push(e);else if(e.parent==this._current.parent)n=e.parent?[e.parent,e]:[e];else{var o=this.getParents(e,null).reverse(),a=this.getParents(this._current).reverse();if(o.length&&a.length){for(var s;o.length&&a.length&&o[0]==a[0];)s=o[0],o.splice(0,1),a.splice(0,1);s&&(n=a.reverse().concat([s]).concat(o).concat(e))}else n=o.concat([e])}else n.push(e),n=(n=n.concat(e.parents.not(this.app.root).toArray())).reverse();if(function(e){for(var t=0;t<e.length;t++)if(e[t].isFacade)return!0;return!1}(n))for(r=0;r<n.length;r++)n[r].isBuilding&&n.splice(r,1);return n},e.prototype.jumpLevelPath=function(e){var t=e.levelPath;if(t&&(t.splice(0,1),t.length)){var i=t[0];1==t.length&&(delete e.jumping,this.app.off("cameraFlyComplete","sceneLevel_cameraFlyComplete")),this._change(i,e)}},e.prototype.change=function(e,t){if(t=t||{},e){if(!e.isPauseEvent(k.EnterLevel)&&e.hasEvent(k.EnterLevel)&&(ke.parseValue(t.autoChangeObject,!0)&&e instanceof kt&&(e=e.building),!t.skipCurrentLevel||e!=this._current)){var i=this.getLevelPath(e,t);if(i.length){var r=i[0],n=i.length>1?i[i.length-1]:null;n&&this.updateJumping(n,t),this.app.off("cameraFlyComplete",null,"sceneLevel_cameraFlyComplete"),t.userComplete=t.complete,t.userFlyComplete=t.flyComplete,t.levelPath=i,t.lastObject=n||e,this._change(r,t)}}}else console.error("Please provide the object to change")},e.prototype.quit=function(e){e=e||{},this._current&&(this._leaveLevel(null,e),this._enterLevel(null,e))},e.prototype.back=function(e){if(e=e||{},this._current){var t=this._current.parent;if(ke.parseValue(this.options.autoBackFromSubLevel,e.autoBackFromSubLevel))for(;t&&t.parent;){for(var i=t.children.concat(),r=0;r<i.length;r++)i[r].isFacade&&i.splice(r--,1);if(1!==i.length)break;t=t.parent}this.backTo(t)}},e.prototype.backTo=function(e){if(e&&e!=this._current&&e.isChildOf(this._root)){e.isFacade&&(e=e.parents.query(".Campus")[0]);var t=this;this.app.camera.toggleNormalViewMode((function(){t.backTo(e)}))||this.change(e,{autoChangeObject:!1})}},e.prototype.isChanged=function(){return this._changed},e.prototype.onUpdate=function(e){this._changed&&(this._changed=!1)},o(e,[{key:"current",get:function(){return this._current}},{key:"previous",get:function(){return this._previous}},{key:"root",set:function(e){this._root=e},get:function(){return this._root}},{key:"options",set:function(e){this._options=ke.mergeObject(this._options,e,!0)},get:function(){return this._options}}]),e}(),Ps=function(){function e(t){n(this,e),this.app=t,this._backups={camera:{},lighting:{},postEffect:{}},this._campusSkyBox=null,this._campusBackground=null,this._campusSkyBoxColorTween=null,this._levelChanging=!1,this._lastPickedObject=null}return e.prototype.setCampusSkyBoxColorScaleFactor=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this._campusSkyBoxColorTween&&this._campusSkyBoxColorTween.stop();var i=ke.parseVector3(this.app.backgroundColorScaleFactor),r=ke.parseVector3(e),n=this;this._campusSkyBoxColorTween=new TWEEN.Tween(i).to(r,t).onUpdate((function(){n.app.backgroundColorScaleFactor=[this._object.x,this._object.y,this._object.z]})),this._campusSkyBoxColorTween.start()},e.prototype.updatebackupInfo=function(e,t){var i=this._backups[e];i[t]=i[t]||{};var r=i[t];"camera"==e?(r.position=this.app.camera.position,r.target=this.app.camera.target):"lighting"==e?r.value=this.app.lighting:"postEffect"==e&&(r.value=this.app.postEffect)},e.prototype.clearBackupInfo=function(e,t){delete this._backups[e][t]},e.prototype.getBackupInfoValue=function(e,t,i){var r=this._backups[e][t];return r?r[i]:null},e.prototype.initAppEvents=function(){var e=this;this.app.on("cameracontrollerchanged",(function(t){e.app.level.current&&e._levelChanging&&e.app.camera.stopFlying()}),O.LevelFlyBreak),this.app.on("dblclick",(function(t){if(0==t.button){var i=e.app.level,r=i.current;if(r){var n=t.object;if(n!=r&&function(e){return!!e&&(!e.isTextRegion&&!e.isMarker)}(n)){if(n.isGround)return;var o=!1;n.isBuilding&&(o=!0),i.change(n,{autoEnterSubLevel:o})}}}}),O.LevelEnterOperation),this.app.on("click",(function(t){if(2==t.button){var i=e.app.level;if(i.current){var r=t.object;r&&(r.style.outlineColor=null);var n=!1;i.current.isFloor&&(n=!0),i.back({autoBackFromSubLevel:n})}}}),O.LevelBackOperation);this.app.on(k.Pick,(function(t){var i=e.app.level;if(i.current){e._lastPickedObject&&(e._lastPickedObject.style.outlineColor=null);var r=t.object;(function(t){var i=e.app.level.current;return!!i&&(!(!t||t==i)&&("Ground"!=t.type&&(!t.isMarker&&(!i.isCampus||!t.isChildOf(i.ground)))))})(r)&&(r.style.outlineColor=i.options.outlineColor),e._lastPickedObject=r}}),O.LevelPickOperation),this._campusSkyBox=this.app.skyBox,this._campusBackground=this.app.background,this.app.on("skyboxchange",(function(t){var i=e.app.level.current;i&&!i.isCampus||(e._campusSkyBox=t.skyBox)}))},e.prototype.buildFlyParams=function(e,t){t=t||{};var i=this;e._flyStart=function(){i._levelChanging=!0},e._flying=function(){i._levelChanging=!0},e._flyStop=function(){i._levelChanging=!1},e._flyComplete=function(){i._levelChanging=!1},e.distance=e.distance||t.distance,e.time=ke.parseValue(e.time||t.time,1e3),e.keepDirection=ke.parseValue(e.keepDirection||t.keepDirection,!1);var r=this.app.level.current;t.lastObject==r&&(e.offset=e.offset||t.offset,e.worldOffset=e.worldOffset||t.worldOffset,e.radius=e.radius||t.radius||r.boundingBox.radius,e.xAngle=ke.parseValue(e.xAngle||t.xAngle,null),e.yAngle=ke.parseValue(e.yAngle||t.yAngle,null)),e.targetForFlyComplete=r;var n=r.userData.camInfo;if(n){var o=r.parents.query(".Campus")[0];o&&(e.target=o.selfToWorld(n.target),e.position=o.selfToWorld(n.eye))}return e},e.prototype.registerSceneLevelEvents=function(){var e=this;this.app.on(k.EnterLevel,".BaseObject",(function(t){e.onBaseObjectLevelSceneOperations(t)}),O.LevelSceneOperations),this.app.on(k.EnterLevel,".Campus",(function(t){e.onCampusLevelSetBackground(t)}),O.LevelSetBackground),this.app.on(k.EnterLevel,".Campus",(function(t){e.onCampusLevelSetEffect(t)}),O.LevelSetEffect),this.app.on(k.EnterLevel,".Campus",(function(t){e.onCampusLevelSceneOperations(t)}),O.LevelSceneOperations),this.app.on(k.EnterLevel,".Campus",(function(t){e.onCampusLevelPickedResultFunc(t)}),O.LevelPickedResultFunc),this.app.on(k.EnterLevel,".Campus",(function(t){e.onCampusLevelFly(t)}),O.LevelFly),this.app.on(k.LeaveLevel,".Campus",(function(t){e.onCampusLevelLeaveSceneOperations(t)}),O.LevelSceneOperations),this.app.on(k.EnterLevel,".Facade",(function(t){e.onFacadeLevelSetBackground(t)}),O.LevelSetBackground),this.app.on(k.EnterLevel,".Facade",(function(t){e.onFacadeLevelSetEffect(t)}),O.LevelSetEffect),this.app.on(k.EnterLevel,".Facade",(function(t){e.onFacadeLevelSceneOperations(t)}),O.LevelSceneOperations),this.app.on(k.EnterLevel,".Facade",(function(t){e.onFacadeLevelPickedResultFunc(t)}),O.LevelPickedResultFunc),this.app.on(k.EnterLevel,".Facade",(function(t){e.onFacadeLevelFly(t)}),O.LevelFly),this.app.on(k.LeaveLevel,".Facade",(function(t){e.onFacadeLevelLeaveSceneOperations(t)}),O.LevelSceneOperations),this.app.on(k.EnterLevel,".Building",(function(t){e.onBuildingLevelSetBackground(t)}),O.LevelSetBackground),this.app.on(k.EnterLevel,".Building",(function(t){e.onBuildingLevelSetEffect(t)}),O.LevelSetEffect),this.app.on(k.EnterLevel,".Building",(function(t){e.onBuildingLevelSceneOperations(t)}),O.LevelSceneOperations),this.app.on(k.EnterLevel,".Building",(function(t){e.onBuildingLevelPickedResultFunc(t)}),O.LevelPickedResultFunc),this.app.on(k.EnterLevel,".Building",(function(t){e.onBuildingLevelFly(t)}),O.LevelFly),this.app.on(k.LeaveLevel,".Building",(function(t){e.onBuildingLevelLeaveSceneOperations(t)}),O.LevelSceneOperations),this.app.on(k.EnterLevel,".Floor",(function(t){e.onFloorLevelSetBackground(t)}),O.LevelSetBackground),this.app.on(k.EnterLevel,".Floor",(function(t){e.onFloorLevelSetEffect(t)}),O.LevelSetEffect),this.app.on(k.EnterLevel,".Floor",(function(t){e.onFloorLevelSceneOperations(t)}),O.LevelSceneOperations),this.app.on(k.EnterLevel,".Floor",(function(t){e.onFloorLevelPickedResultFunc(t)}),O.LevelPickedResultFunc),this.app.on(k.EnterLevel,".Floor",(function(t){e.onFloorLevelFly(t)}),O.LevelFly),this.app.on(k.LeaveLevel,".Floor",(function(t){e.onFloorLevelLeaveSceneOperations(t)}),O.LevelSceneOperations),this.app.on(k.EnterLevel,".Room",(function(t){e.onRoomLevelSceneOperations(t)}),O.LevelSceneOperations),this.app.on(k.EnterLevel,".Room",(function(t){e.onRoomLevelPickedResultFunc(t)}),O.LevelPickedResultFunc),this.app.on(k.EnterLevel,".Room",(function(t){e.onRoomLevelFly(t)}),O.LevelFly),this.app.on(k.LeaveLevel,".Room",(function(t){e.onRoomLevelLeaveSceneOperations(t)}),O.LevelSceneOperations),this.app.on(k.EnterLevel,".Thing",(function(t){e.onThingLevelSceneOperations(t)}),O.LevelSceneOperations),this.app.on(k.EnterLevel,".Thing",(function(t){e.onThingLevelPickedResultFunc(t)}),O.LevelPickedResultFunc),this.app.on(k.EnterLevel,".Thing",(function(t){e.onThingLevelFly(t)}),O.LevelFly),this.app.on(k.LeaveLevel,".Thing",(function(t){e.onThingLevelLeaveSceneOperations(t)}),O.LevelSceneOperations)},e.prototype.onBaseObjectLevelSceneOperations=function(e){},e.prototype.onCampusLevelSetBackground=function(e){this.app.level.options.autoChangeBackground&&(this._campusSkyBox?(this.app.skyBox=this._campusSkyBox,this.setCampusSkyBoxColorScaleFactor([1,1,1])):this._campusBackground&&(this.app.background=this._campusBackground))},e.prototype.onCampusLevelSetEffect=function(e){},e.prototype.onCampusLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.visible=!0,t.ground&&(t.ground.visible=!0);for(var i=t.children,r=0;r<i.length;r++)i[r].visible=!0;var n=t.buildings;for(r=0;r<n.length;r++){var o=n[r];o.visible=!0,o.children.forEach((function(e){e.visible=!1}));var a=o.floors,s=o.facades;o.hasFacades()?o.structShow?(s.visible=!0,a.visible=!0):(s.visible=!0,a.visible=!1,o.showAllRoofs(!1)):(a.visible=!0,o.showAllRoofs(!0)),t.app.level.options.autoHideFloorObjects&&a.forEach((function(e){if(!e.showObjectsInParentLevels){o.hasFacades()&&!o.structShow?e.children.forEach((function(e){e.visible=!1})):e.children.forEach((function(e){e.isRoom||e.isDoor||e.isWindow||e.isCombinedObject||(e.visible=!1)}));if(!o.hasFacades()||o.structShow){var t=e.misc;t&&(t.visible=!0,t.node.traverse((function(t){t!=e.misc.node&&(!function(t){for(;t&&t!=e.misc.node;){if(t.isDoorOrWin)return!0;t=t.parent}return!1}(t)?t.visible=!1:t.visible=!0)})))}}}))}},e.prototype.onCampusLevelPickedResultFunc=function(e){function t(e){return"Outdoors"!=e.type&&!!function(e){var t=e.app.level.current;if(!t)return!0;if(e.isWebView)return!0;if(e.isMarker)return!0;if(e.parent==t){if(e.isGround)return!0;if(e.isBuilding)return!0;if(e.isThing)return!0}return!!e.isChildOf(t.ground)}(e)}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t(n))return n}}},e.prototype.onCampusLevelFly=function(e){var t,i,r=e.object,n=e.previous;n&&!n.isCampus&&n.isChildOf(r)||this.clearBackupInfo("camera","Campus");var o=r.sceneJSONData.camInfo;o&&(t=o.eye.concat(),i=o.target.concat(),t=r.selfToWorld(t),i=r.selfToWorld(i));var a=e.position||this.getBackupInfoValue("camera","Campus","position")||t,s=e.target||this.getBackupInfoValue("camera","Campus","target")||i||r,l=e.radius||Math.min(r.boundingBox.radius,300);this.app.camera.flyTo(this.buildFlyParams({position:a,target:s,radius:l},e))},e.prototype.onCampusLevelLeaveSceneOperations=function(e){var t=e.current;if(t){var i=e.object;if(t.isChildOf(i)){if(t.isCampus);else if(i.parents.has(t));else if(!i.things.has(t)){i.ground&&(i.ground.visible=!1);for(var r=0;r<i.children.length;r++){var n=i.children[r];n!=e.current&&(n.visible=!1)}if(t.isThing){var o=i.ground;o&&(o.visible=!1)}}e.skipBackupCameraInfo||this.updatebackupInfo("camera","Campus"),this.updatebackupInfo("lighting","Campus"),this.updatebackupInfo("postEffect","Campus")}}},e.prototype.onFacadeLevelSetBackground=function(e){},e.prototype.onFacadeLevelSetEffect=function(e){},e.prototype.onFacadeLevelSceneOperations=function(e){var t=e.object;t.visible=!0,t.children.forEach((function(e){e.visible=!0}))},e.prototype.onFacadeLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;return!t||(t==e||!!e.isChildOf(t))}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t(n))return n}}},e.prototype.onFacadeLevelFly=function(e){var t=e.object;this.app.camera.flyTo(this.buildFlyParams({target:t},e))},e.prototype.onFacadeLevelLeaveSceneOperations=function(e){},e.prototype.onBuildingLevelSetBackground=function(e){this.app.level.options.autoChangeBackground&&(this.app.background=null,this.app.skyBox="White",this.setCampusSkyBoxColorScaleFactor([.5,.5,.5]))},e.prototype.onBuildingLevelSetEffect=function(e){},e.prototype.onBuildingLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.visible=!0,t.children.forEach((function(e){e.visible=!0})),t.parents.query(".Campus")[0].buildings.not(t).visible=!1,t.facades.visible=!1;var i=t.floors;i.visible=!0;for(var r=0;r<i.length;r++){var n=i[r];if(t.app.level.options.autoHideFloorObjects){t.hasFacades()?n.children.forEach((function(e){e.visible=!0})):n.children.forEach((function(e){e.isRoom||e.isDoor||e.isWindow||(e.visible=!0)}));var o=n.misc;o&&o.node.traverse((function(e){e.ensureVisible(!0,!0)}))}n.showAllRoofs(!1),n.bake(null)}},e.prototype.onBuildingLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;if(!t)return!0;if(t==e)return!0;if(e.isWebView)return!0;if(e.isMarker)return!0;if(e.parent==t){if(e.isThing)return!0;if(e.isFloor&&"Outdoors"!=e.type)return!0}return!1}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t(n))return n}}},e.prototype.onBuildingLevelFly=function(e){var t=e.object;this.app.camera.flyTo(this.buildFlyParams({target:t},e))},e.prototype.onBuildingLevelLeaveSceneOperations=function(e){e.object.style.outlineColor=null,this.updatebackupInfo("lighting","Building"),this.updatebackupInfo("postEffect","Building")},e.prototype.onFloorLevelSetBackground=function(e){this.app.level.options.autoChangeBackground&&(this.app.skyBox="White",this.setCampusSkyBoxColorScaleFactor([.25,.25,.25]))},e.prototype.onFloorLevelSetEffect=function(e){},e.prototype.onFloorLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.building.floors.not(t).visible=!1,t.visible=!0,t.showAllRoofs(!1),this.app.level.options.autoBakeFloor&&t.bake()},e.prototype.onFloorLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;if(!t)return!0;if(t==e)return!0;if(e.isWebView)return!0;if(e.isMarker)return!0;if(e.parent==t){if(e.isRoom)return!0;if(e.isThing)return!0}return!1}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t(n))return n}}},e.prototype.onFloorLevelFly=function(e){var t=e.object,i=e.previous;if(i.isBuilding||i.isFloor)this.app.camera.flyTo(this.buildFlyParams({target:t},e)),this.clearBackupInfo("camera","Floor");else{var r=this.getBackupInfoValue("camera","Floor","position"),n=this.getBackupInfoValue("camera","Floor","target");this.app.camera.flyTo(this.buildFlyParams({position:r,target:n},e))}},e.prototype.onFloorLevelLeaveSceneOperations=function(e){e.object.style.outlineColor=null,this.updatebackupInfo("camera","Floor"),this.updatebackupInfo("lighting","Building"),this.updatebackupInfo("postEffect","Building")},e.prototype.onRoomLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null;for(var i=t.brothers.query(".Room"),r=0;r<i.length;r++){i[r].things.style.opacity=.25}},e.prototype.onRoomLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;if(!t)return!0;if(e.isWebView)return!0;if(e.isMarker)return!0;if(e.isRoom&&e!=t)return!0;if(e.isChildOf(t)){if(e.parent==t)return!0}else if(e.isThing&&e.app.level.current.things.has(e))return!0;return!1}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.app.level.current,r=e.parents,n=0;n<r.length;n++){var o=r[n];if(o==i)break;if(t(o))return o}}},e.prototype.onRoomLevelFly=function(e){var t=e.object;if(e.previous.isFloor)this.app.camera.flyTo(this.buildFlyParams({target:t},e));else{var i=this.getBackupInfoValue("camera","Room","position"),r=this.getBackupInfoValue("camera","Room","target");this.app.camera.flyTo(this.buildFlyParams({position:i,target:r},e))}},e.prototype.onRoomLevelLeaveSceneOperations=function(e){var t=e.object;if(t.style.outlineColor=null,!e.lastObject.isChildOf(t))for(var i=t.brothers.query(".Room"),r=0;r<i.length;r++){i[r].things.style.opacity=null}this.updatebackupInfo("camera","Room")},e.prototype.onThingLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.brothers.query(".Thing").style.opacity=.25},e.prototype.onThingLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;return!t||(!!e.isChildOf(t)||(!!e.isWebView||(!!e.isMarker||!(!e.isThing||!e.isBrotherOf(t)))))}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t(n))return n}}},e.prototype.onThingLevelFly=function(e){var t=e.object,i=ke.parseValue(e.keepDirection,!0);this.app.camera.flyTo(this.buildFlyParams({target:t,keepDirection:i,centerPos:t.boundingBox.center},e))},e.prototype.onThingLevelLeaveSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.brothers.query(".Thing").style.opacity=null},e.prototype.init=function(){this.initAppEvents(),this.registerSceneLevelEvents()},e}(),js=function(){function e(t){n(this,e),this.app=t,this._spriteMaterials={},this._meshMaterials={}}return e.prototype.getMaterial=function(e){var t,i=(e=e||{}).url,r=ke.parseValue(e.useSpriteMaterial,!0);if(i){r?(this._spriteMaterials[i]||(this._spriteMaterials[i]=new THREE.SpriteMaterial({color:16777215,transparent:!0})),t=this._spriteMaterials[i]):(this._meshMaterials[i]||(this._meshMaterials[i]=new THREE.MeshBasicMaterial({transparent:!0,side:THREE.DoubleSide,depthWrite:!1})),t=this._meshMaterials[i]),t.refCount=t.refCount||1,e.skipRefCount||t.refCount++;var n=e.loadComplete,o=e.loadTextureComplete,a=!t.map||!t.map.image;if(a){var s=this.app.resourceManager.textureLoader;t.map=s.load(i,(function(e){e.refCount++,t.map=e,o&&o({material:t}),n&&n({material:t})}),(function(){}),(function(e){console.error('[Sprite] load "'+i+'" failed')}),!0)}else n&&n({material:t})}else t=r?new THREE.SpriteMaterial({color:16777215,transparent:!0}):new THREE.MeshBasicMaterial({transparent:!0,side:THREE.DoubleSide,depthWrite:!1}),n&&n({material:t});return{material:t,needLoadTexture:a}},e.prototype.unloadMaterial=function(e){return!(!e||!this.app.resourceManager.disposeMaterial(e))},e.prototype.unloadMaterials=function(e,t){var i=t[e];this.unloadMaterial(i)&&delete t[e]},e.prototype.unload=function(e){this.unloadMaterials(e,this._spriteMaterials),this.unloadMaterials(e,this._meshMaterials)},e.prototype.onUpdate=function(e){},e}(),Fs=function(){function e(t,i){n(this,e),this.app=t,this.modelResource=t.modelResource,this.refCount=1,this.URL=i,this._boundingBox=null,this._loadingBox=null,this._skinnedMeshes=[],this.node=null,this.animations=null,this.geometry=null,this.materials=null}return e.prototype._setupBoundingBox=function(){var e=(new THREE.Box3)._setFromObject(this.node),t=new THREE.Vector3;e.getCenter(t);var i=new THREE.Vector3;e.getSize(i),this._boundingBox={},this._boundingBox.center=t.toArray(),this._boundingBox.size=i.toArray(),this._boundingBox.radius=i.length()},e.prototype.load=function(e){var t=e.node,i=e.animations,r=e.geometry,n=e.materials;if(r)this.animations=r.animations,this.geometry=r,this.materials=n;else if(t){var o=this.node!=t;this.node=t,i?this.animations=i:(o||null===i)&&(this.animations=null)}this._skinnedMeshes=t.getSkinnedMeshes(),this._setupBoundingBox()},e.prototype.get=function(){return this.refCount++,this},e.prototype.unload=function(){return(0===this.refCount||(this.refCount--,!this.refCount))&&(!this.modelResource.residentMode&&(this.app.resourceManager.unload(this.node),this.app.resourceManager.unload(this._loadingBox),this.node=null,this.animations=null,this.geometry=null,this.materials=null,!0))},e.prototype._cloneNode=function(){if(this.node){var e=this.node.clone(),t=[];if(e.traverse((function(e){var i=e.geometry;i&&(i.refCount=i.refCount||1,i.refCount++),e.isSkinnedMesh&&t.push(e)})),this._skinnedMeshes.length)for(var i=this._skinnedMeshes,r=0;r<i.length;r++){var n=i[r],o=i[r].skeleton,a=e.getBones(this.node,i[r].skeleton),s=t[r],l=new THREE.Skeleton(a,o.boneInverses);s.bind(l,n.bindMatrix)}return e}if(this.geometry)return(s=new THREE.SkinnedMesh(this.geometry,this.materials)).scale.set(1,1,1),s},e.prototype.cloneNode=function(){var e=this._cloneNode(),t=function(e){e.refCount?e.refCount++:e.refCount=1};return e.traverseMaterials((function(e){for(var i in t(e),e){var r=e[i];r&&r.isTexture&&t(r)}})),e},o(e,[{key:"boundingBox",get:function(){return this._boundingBox||this._setupBoundingBox(),this._boundingBox}},{key:"loadingBox",get:function(){return this._loadingBox},set:function(e){this._loadingBox=e}}]),e}(),Os=function(){function e(t){n(this,e),this.app=t,this.isResidentMode=!1,this.models={},this.loadingModels={},this.waitModels=[]}return e.prototype.onBackgroundProgress=function(e){},e.prototype.get=function(e){var t=this.models[e];return t?t.get():null},e.prototype.set=function(e,t,i){var r=this.models[e];return r?r.unload():(r=new Fs(this.app,e),this.models[e]=r),t&&i&&r.load({node:t,animations:i}),r},e.prototype.getBoundingBox=function(e){var t=this.models[e];return t?t.boundingBox:null},e.prototype.unload=function(e){if(void 0===e){for(var e in this.models)this.models[e].unload();return this.clear(),!0}if(ke.isString(e)){var t=this.models[e];if(t&&t.unload())return delete this.models[e],!0}return!1},e.prototype.clear=function(e){ke.isNull(e)?this.models={}:delete this.models[e]},e.prototype._download=function(e,t,i,r,n){var o=this.get(e);if(o)delete this.loadingModels[e],i&&i(o);else{var a=this;new thingjs.GLTFLoader(this.app.loadingManager).loadFromURL({url:e,jsonCallback:function(e){t&&t(e)},modelCallback:function(t){var r=t.url,n=a.get(r);n||(n=a.set(r)).load(t),delete a.loadingModels[e],i&&(i(n)||a.unload(e))},errorCallback:function(t){if(delete a.loadingModels[e],t&&t.target&&201===t.target.status){var i=void 0;try{i=JSON.parse(t.target.response)}catch(e){console.error("Error!")}return console.error("[have no right] name: "+i.message+"\nurl: "+e),!0}if(n)return n(t)},progressCallback:r})}},e.prototype.download=function(e,t,i,r,n){this.loadingModels[e]?this.waitModels.push({url:e,jsonCallback:t,modelCallback:i,progressCallback:r,errorCallback:n}):(this.loadingModels[e]={},this._download(e,t,i,r,n))},e.prototype.preload=function(e,t){var i=(t=t||{}).complete;if(ke.isArray(e))for(var r=0,n=e.length,o=0;o<n;o++)this.download(e[o],(function(){}),(function(e){++r==n&&i&&i()}),(function(){}),(function(){++r==n&&i&&i()}));else ke.isString(e)&&this.download(e,(function(){}),(function(e){i&&i()}),(function(){}),(function(){i&&i()}))},e.prototype.needWait=function(e){var t=e.url;return!!this.loadingModels[t]},e.prototype.update=function(){for(var e=0;e<this.waitModels.length;e++){var t=this.waitModels[e];this.needWait(t)||(this._download(t.url,t.jsonCallback,t.modelCallback,t.progressCallback,t.errorCallback),this.waitModels.splice(e--,1))}},e.prototype.onUpdate=function(e){this.update(e)},o(e,[{key:"residentMode",set:function(e){if(this.isResidentMode=e,!e){var t=[];for(var i in this.models){var r=this.models[i];if(0===r.refCount){var n=r.URL;r.unload()&&t.push(n)}}for(var o=0;o<t.length;o++){n=t[o];delete this.models[n]}}},get:function(){return this.isResidentMode}}]),e}(),ks=function(){function e(t){n(this,e),this.app=t,this.particles={}}return e.prototype.get=function(e){return this.particles[e]},e.prototype.set=function(e,t){this.particles[e]=t},e.prototype.download=function(e,t){var i=e.appendPath("index.json"),r=this;new THREE.FileLoader(this.app.loadingManager).load(i,(function(i){var n=JSON.parse(i);r.set(e,n),t&&t(n)}),(function(){}),(function(){}))},e}(),Ls=function(){function e(t){n(this,e),this.app=t,this.camera=t.camera,this.updateTime=0,this.lastAdjustCameraNear=0}return e.prototype._getMinDistanceForAdjustCameraNear=function(e,t,i,r){var n=ke.parseVector3(i),o=ke.parseVector3(this.camera.position),a=Math.min(r,n.distanceTo(o));if(a>e){var s=this.app.picker.intersectResult(t[0],t[1],null,{ignoreFrameCheck:!1});if(s&&s.picked)(n=s.getPickedPosition({skipOtherPick:!0}))&&(n=ke.parseVector3(n),a=Math.min(a,o.distanceTo(n)))}return a/e},e.prototype._getAdjustCameraNear=function(e){var t=this.camera.distance;if(t>10){var i=this.camera.worldToScreen(this.camera.target),r=this.camera.screenToWorld(i[0],i[1]);if(r)return this.updateTime>=.5&&(this.updateTime=0,this.lastAdjustCameraNear=this._getMinDistanceForAdjustCameraNear(e,i,r,t)),this.lastAdjustCameraNear}return this.camera.near},e.prototype.processAdjustCameraNear=function(){var e=Math.max(.1,this._getAdjustCameraNear(120));this.app.renderCamera.setNear(e)},e.prototype.onUpdate=function(){this.updateTime+=this.app._deltaTime;var e=this.camera._targetObject;e&&(e.position=this.camera.target)},e.prototype.onEnter=function(){var e=this;this.app.on("cameraChange",(function(t){e.camera.autoAdjustNear&&!e.app.renderCamera.isLerping&&e.processAdjustCameraNear(),e.app.needUpdate=!0}),"__cameraNearFixed__");var t=!1;this.app.on("cameraChangeMouseMove",(function(i){e.app.camera.inputEnabled&&!e.app.isPauseEvent(k.Pick,null,O.LevelPickOperation)&&(t=!0,e.app.pauseEvent(k.Pick,null,O.LevelPickOperation))}),"__disable_outline__"),this.app.on("cameraChangeEnd",(function(i){t&&(t=!1,e.app.resumeEvent(k.Pick,null,O.LevelPickOperation))}),"__disable_outline__")},e.prototype.onLeave=function(){this.app.off("cameraChange","__cameraNearFixed__"),this.app.off("cameraChangeMouseMove","__disable_outline__"),this.app.off("cameraChangeEnd","__disable_outline__")},e}(),Bs=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"translate",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n(this,e),t&&(this._object=t,this._axis=null,this._disableAxis=[],this.init(t.app,i,r),this.control.attach(this._object.node),this.app.scene.add(this.control),this.control.setPickable(!1))}return e.prototype.init=function(e,t,i){this.app=e,this.control=new THREE.TransformControls(this.app.renderCamera,this.app.mainDomElement),this.control.traverse((function(e){e.userData.skipOutline=!0,e.userData.useVisibleOnly=!0}));var r=this;this.control.addEventListener("change",(function(e){r.onGizmoChange(e)})),this.control.addEventListener("objectChange",(function(e){r.onGizmoObjectChange(e)})),this.control.addEventListener("mouseDown",(function(e){r.onGizmoMouseDown(e)})),this.control.addEventListener("mouseUp",(function(e){r.onGizmoMouseUp(e)})),this.control.getGizomNode=function(){return r.control.children[0]},this.control.getAxisNode=function(){return r.control.children[1]},this.mode="translate",ke.isString(t)?(this.mode=t,this.params=i||{}):this.params=t||{},this.app.on("cameraViewChange",(function(e){e.view==T.Orthographic?r.setAxis("XZ"):r.setAxis("XYZ")})),this.app.camera.viewMode==T.Orthographic&&this.setAxis("XZ")},e.prototype.onGizmoChange=function(e){},e.prototype.onGizmoObjectChange=function(e){this._object&&(this._object.dirty=!0);var t=this.params.change;t&&t.call(this,{object:this._object})},e.prototype.onGizmoMouseDown=function(e){this.app.camera.disable({rotate:!0});var t=this.params.changeStart;t&&t.call(this,{object:this._object})},e.prototype.onGizmoMouseUp=function(e){this.app.camera.resume({rotate:!0});var t=this.params.changeEnd;t&&t.call(this,{object:this._object})},e.prototype.onUpdate=function(e){if(this._object.static)return this.control.updateMatrixWorld(),!0},e.prototype.onRemove=function(){this.app.scene.remove(this.control),this.control.detach(),this.control.dispose()},e.prototype.onVisible=function(e){this.control.enabled&&(this.control.visible=e)},e.prototype.setAxis=function(e){if(this._axis=e,this._axis&&"XYZ"!=this._axis){var t=this,i=new THREE.Raycaster;this.control.userData.original_pointerHover=this.control.pointerHover,this.control.axis=e,this.control.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){i.setFromCamera(e,this.camera);var r=i.intersectObjects(this.getGizomNode().picker[this.mode].children,!0)[0]||!1;r?-1!=t._axis.search(r.object.name)&&(this.axis=r.object.name):this.axis=""}}}else this.control.userData.original_pointerHover&&(this.control.pointerHover=this.control.userData.original_pointerHover,delete this.control.userData.original_pointerHover)},e.prototype.detach=function(){this.control.detach()},e.prototype.attach=function(e){this.control.attach(e)},e.prototype.enableAxis=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){var i=this._disableAxis.indexOf(e);t?-1!==i&&this._disableAxis.splice(i,1):-1===i&&this._disableAxis.push(e);var r=this.control;if(this._disableAxis.length){var n=this,o=function(e){if(!e)return!0;for(var t=0;t<n._disableAxis.length;t++){var i=n._disableAxis[t];if(-1!==e.indexOf(i))return!0}return!1},a=function(e){e.traverse((function(e){for(var t=0;t<n._disableAxis.length;t++){var i=n._disableAxis[t];e.name==i&&(e.visible=!1)}}))};ke.setValue(r,"pointerDown",(function(e){var t=this.getGizomNode().axis;o(t)||ke.getBackupValue(r,"pointerDown").call(this,e)})),ke.setValue(r,"pointerMove",(function(e){var t=this.getGizomNode().axis;o(t)||ke.getBackupValue(r,"pointerMove").call(this,e)})),ke.setValue(r,"pointerUp",(function(e){var t=this.getGizomNode().axis;o(t)||ke.getBackupValue(r,"pointerUp").call(this,e)})),ke.setValue(r,"updateMatrixWorld",(function(){ke.getBackupValue(r,"updateMatrixWorld").call(this);var e=this.getGizomNode().gizmo,t=this.getGizomNode().mode;a(e[t])}))}else ke.revertValue(r,"pointerDown"),ke.revertValue(r,"pointerMove"),ke.revertValue(r,"pointerUp"),ke.revertValue(r,"updateMatrixWorld")}},e.prototype.setSize=function(e){console.warn("[AxisTransformControl] Please use '.size' to replace 'setSize()'"),this.size=e},o(e,[{key:"object",get:function(){return this.control.object}},{key:"node",get:function(){return this.control}},{key:"mode",set:function(e){if(e){if("translate"!=e&&"rotate"!=e&&"scale"!=e)return void console.error('[AxisTransformControl] mode is invalid, must be "translate/rotate/scale"');this.control.setMode(e)}},get:function(){return this.control.getMode()}},{key:"space",set:function(e){if(e){if("world"!=e&&"local"!=e)return void console.error('[AxisTransformControl] space is invalid, must be "world/local"');this.control.setSpace(e)}},get:function(){return this.control.space}},{key:"size",set:function(e){this.control.setSize(e)},get:function(){return this.control.size}},{key:"visible",set:function(e){this.control.visible=e,this.control.enabled=e},get:function(){return this.control.visible}}]),e}(),Hs=function(){function e(t){n(this,e),this.state=t,this.app=t.app,this.control=t.control,this.root=new THREE.Group,this.root.userData.childUseWorldAnglesAlways=!0,this.root.name="EditObjectGroup",this.lastRootPosition=null,this.lastRootScale=null,this.lastRootRotation=null}return e.prototype.hasChanged=function(){var e=this.root.position,t=this.root.scale,i=this.root.rotation;return!(this.lastRootPosition.equals(e)&&this.lastRootScale.equals(t)&&this.lastRootRotation.equals(i))},e.prototype.recordTranslation=function(){this.state.execute({type:"SetNodeTranslation",node:this.root,position:this.lastRootPosition,scale:this.lastRootScale,rotation:this.lastRootRotation}),this.synTranslation()},e.prototype.notify=function(e){for(var t=this.root.children,i=0;i<t.length;i++){var r=t[i].userData,n=this.app.objectManager.get(r.id);if(n){var o=n.userData._editCallbacks;o&&o[e].call(n);var a=n.userData.selectObjectCallback;a&&a.call(n)}}},e.prototype._pushSubNodeAttach=function(e,t,i,r,n){var o=this.app.objectManager.getBaseObject(t);e.push({type:"AttachNode",node:o.node,nodeParent:o.node.userData.nodeParent})},e.prototype.recordSubNodeAttach=function(e,t,i,r){var n=[];this._pushSubNodeAttach(n,e,t,i,r),this.state.execute(n),this.synTranslation()},e.prototype._pushSubNodeOnlyAttach=function(e,t,i,r,n,o,a,s,l){for(var u=0;u<i.length;u++){var c=i[u];this.hasSelected(c)&&e.push({type:"AttachNode",node:i[u].node,nodeParent:r[u]})}},e.prototype.recordSubNodeOnlyAttach=function(e,t,i,r,n,o,a,s){var l=[];this._pushSubNodeOnlyAttach(l,e,t,i,r,n,o,a,s),this.state.execute(l),this.synTranslation()},e.prototype._pushNodeAttach=function(e,t,i,r,n){e.push({type:"AttachNode",node:t.node,nodeParent:i})},e.prototype.recordNodeAttach=function(e,t,i,r){var n=[];this._pushNodeAttach(n,e,t,i,r),this.state.execute(n),this.synTranslation()},e.prototype._pushNodeOnlyAttach=function(e,t,i,r,n,o,a,s,l){e.push({type:"AttachNode",node:t.node,nodeParent:i});for(var u=0;u<r.length;u++){r[u]!=t&&e.push({type:"AttachNode",node:r[u].node,nodeParent:n[u]})}},e.prototype.recordNodeOnlyAttach=function(e,t,i,r,n,o,a,s){var l=[];this._pushNodeOnlyAttach(l,e,t,i,r,n,o,a,s),this.state.execute(l),this.synTranslation()},e.prototype._pushNodesAttach=function(e,t,i,r,n){for(var o=0;o<t.length;o++){var a=t[o],s=i[o];e.push({type:"AttachNode",node:a.node,nodeParent:s})}},e.prototype.recordNodesAttach=function(e,t,i,r){var n=[];this._pushNodesAttach(n,e,t,i,r),this.state.execute(n)},e.prototype._pushSubNodesAttach=function(e,t,i,r,n){},e.prototype.recordSubNodesAttach=function(e,t,i,r){var n=[];this._pushSubNodesAttach(n,e,t,i,r),this.state.execute(n)},e.prototype.synTranslation=function(){this.lastRootPosition=this.root.position.clone(),this.lastRootScale=this.root.scale.clone(),this.lastRootRotation=this.root.rotation.clone();for(var e=0;e<this.root.children.length;e++){var t=this.root.children[e].userData.id;if(t)this.app.objectManager.get(t).dirty=!0}},e.prototype.updateRoot=function(){this.updateControl(),this.updateRootVisible(),this.updateRootPosition(),this.updateSelections(),this.synTranslation(),this.app.needUpdate=!0},e.prototype._getNodeCenterPosition=function(e){var t=new THREE.Vector3;if(this.state._isSubNode(e))e.getWorldPosition(t);else{var i=this.app.objectManager.get(e.userData.id);if(i){var r=i.position,n=i.centerPos;n?(t.set(n[0],0,n[1]),i.node.updateMatrixWorld(),t.applyMatrix4(i.node.matrixWorld),t.y=r[1]):t=ke.parseVector3(r)}else e.getWorldPosition(t)}return t},e.prototype.clearSelections=function(){this.state._selectionObjects.clear()},e.prototype.addSelection=function(e){this.state._selectionObjects.add(e)},e.prototype.hasSelected=function(e){return this.state._selectionObjects.has(e)},e.prototype.updateSelections=function(){this.state.objects;this.clearSelections();for(var e=0;e<this.root.children.length;e++){var t=this.root.children[e].userData,i=t.id;if(i){var r=this.app.objectManager.get(i);t.subNode||this.addSelection(r)}}},e.prototype.updateControl=function(){this.control.object||this.root.children.length&&(this.control.attach(this.root),this.app.scene.add(this.control.node),this.synTranslation())},e.prototype.updateRootVisible=function(){this.root.children.length?this.root.visible=!0:this.root.visible=!1,this.control.visible=this.root.visible},e.prototype.updateRootPosition=function(){var e=this.root.children;if(e.length){for(var t=new THREE.Vector3,i=0;i<e.length;i++){var r=e[i],n=this._getNodeCenterPosition(r);t.add(n)}t.divideScalar(e.length);var o=this.root.parent.worldToLocal(t),a=this.root.detachChildren(this.app.scene);this.root.position.copy(o),this.root.attachChildren(a,this.app.scene)}},e.prototype.getObjectInfo=function(e,t){for(var i=new Set,r=this.root.children,n=0;n<r.length;n++){var o=r[n],a=this.app.objectManager.get(o.userData.id);if(!i.has(a)&&(i.add(a),e&&e.push(a),t)){var s=a.node.userData.nodeParent;t.push(s)}}},e.prototype.getSubNodeInfo=function(e,t){var i=this;this.root.traverse((function(r){var n=i.app.objectManager.get(r.userData.id);if(n&&(-1!==n.getSubNodeIndex(r)&&(e&&e.push(r),t))){var o=r.userData.nodeParent;t.push(o)}}))},e.prototype.recordNodeParent=function(e){e.isBaseObject&&(e=e.node);var t=e.parent;t!=this.root&&(e.userData.nodeParent=t)},e.prototype._pushAddObjects=function(e,t){if(t&&t.length){for(var i=[],r=0;r<t.length;r++){var n=t[r];this.hasSelected(n)||i.push(n)}if(i.length)for(r=0;r<i.length;r++){n=i[r];this.recordNodeParent(n),e.push({type:"AttachNode",node:n.node,nodeParent:this.root})}}},e.prototype._dispatchBreakableEvent=function(e,t){return t.continueFlag=!0,this.app.trigger(e,t),t.continueFlag},e.prototype.addObjects=function(e){var t=[];this._pushAddObjects(t,e),this.state.execute(t),this.updateRoot()},e.prototype._pushAddSubNodes=function(e,t){if(t.length)for(var i=0;i<t.length;i++){var r=t[i];this.state._isSubNode(r)&&(r.isChildOf(this.root)||this.recordNodeParent(r))}},e.prototype.addSubNodes=function(e){var t=[];this._pushAddSubNodes(t,e),this.state.execute(t),this.updateRoot()},e.prototype.addSubNode=function(e){return!!this.state._isSubNode(e)&&(!!this.app.objectManager.getBaseObject(e)&&(this.recordNodeParent(e),this.recordSubNodeAttach(e,this.root,this.state.selectOutlineColor,null),this.updateRoot(),!0))},e.prototype.addSubNodeOnly=function(e){if(!e)return!1;if(!e.userData.subNode)return!1;if(!this.app.objectManager.getBaseObject(e))return!1;var t=[],i=[];this.getObjectInfo(t,i);var r=[],n=[];this.getSubNodeInfo(r,n);for(var o=0;o<r.length;o++)if(r[o]==e){r.splice(o,1);break}return this.recordNodeParent(e),this.recordSubNodeOnlyAttach(e,t,i,r,n,this.root,this.state.selectOutlineColor,null),this.updateRoot(),!0},e.prototype.add=function(e,t){t&&this.addSubNode(t.intersect.node)||(this.recordNodeParent(e),this.recordNodeAttach(e,this.root,this.state.selectOutlineColor,null),this.updateRoot())},e.prototype.addOnly=function(e,t){if(!(t&&this.addSubNodeOnly(t.intersect.node)||1==this.root.children.length&&this.has(e))){var i=[],r=[];this.getObjectInfo(i,r);var n=[],o=[];this.getSubNodeInfo(n,o),this.recordNodeParent(e),this.recordNodeOnlyAttach(e,this.root,i,r,n,o,this.state.selectOutlineColor,null),this.updateRoot()}},e.prototype.remove=function(e){if(this.state._isSubNode(e))for(var t=this.root.children,i=0;i<t.length;i++){if((n=t[i])==e){var r=n.userData.nodeParent;this.recordSubNodeAttach(e,r,null,this.state.selectOutlineColor);break}}else for(t=this.root.children,i=0;i<t.length;i++){var n=t[i],o=this.app.objectManager.get(n.userData.id);if(e==o){this.app.trigger("unselectEditableObject",{object:o});r=n.userData.nodeParent;this.recordNodeAttach(e,r,null,this.state.selectOutlineColor);break}}this.updateRoot()},e.prototype.removeAll=function(){if(this.root.children.length){var e=[],t=[];this.getObjectInfo(e,t);var i=[],r=[];this.getSubNodeInfo(i,r);for(var n=0;n<e.length;n++){var o=e[n];this.app.trigger("unselectEditableObject",{object:o})}this.state.canRespondFromCommandManager=!1,this.recordNodesAttach(e,t,null,this.state.selectOutlineColor),this.recordSubNodesAttach(i,r,null,this.state.selectOutlineColor),this.state.canRespondFromCommandManager=!0,this.updateRoot()}},e.prototype.has=function(e){var t=this.root.children;if(this.state._isSubNode(e))for(var i=0;i<t.length;i++){if((r=t[i]).userData.subNode&&r==e)return!0}else for(i=0;i<t.length;i++){var r;if(!(r=t[i]).userData.subNode)if(e==this.app.objectManager.get(r.userData.id))return!0}return!1},e.prototype.attach=function(){this.root.attachToParent(this.app.scene,this.app.scene)},e.prototype.detach=function(){this.removeAll(),this.control.detach(),this.app.scene.remove(this.control.node),this.root.detachFromParent(this.app.scene),this.updateRoot()},e.prototype.clearScene=function(){var e=[];this.state._pushDeleteSubNodes(e,this.state.subNodes),this.state._pushDeleteObjects(e,this.state.objects),this.state.execute(e,!0),this.updateRoot()},e.prototype.toJSON=function(){for(var e=Array.from(this.state._selectionObjects),t=0;t<e.length;t++)this.remove(e[t]);var i=this.state.subNodes;for(t=0;t<i.length;t++)this.remove(i[t]);var r=[],n=this.state.objects;for(t=0;t<n.length;t++){var o=n[t];r.push(o.toJSON())}for(t=0;t<i.length;t++)this.addSubNode(i[t]);for(t=0;t<e.length;t++)this.add(e[t]);return JSON.stringify(r)},e.prototype.pasteObjects=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];console.warn('[EditObjectState] we do not support ".pasteObjects()" anymore, please do not use it')},e.prototype.fromJSON=function(e){console.warn('[EditObjectState] we do not support ".fromJSON()" anymore, please do not use it')},e}(),Is=function(){function e(t){n(this,e);var i=this;this.app=t,this.picker=t.picker,this.copyObjectsJSONData=[],this._selectionObjects=new Set,this.canRespondFromCommandManager=!1,this._enableDirectMode=!1,this._enableKeyMode=!1,this._enableAutoRemoveAllWhenClick=!0,this.app.on("push",(function(e){i.onPush(e)})),this.app.on("redo",(function(e){i.onRedo(e)})),this.app.on("undo",(function(e){i.onUndo(e)}));var r={changeEnd:function(e){i.group.hasChanged()&&(i.group.recordTranslation(),i.group.notify("modify"))}};this.control=new Bs,this.control.init(t,"translate",r),this.selectOutlineColor="#0000FF",this.group=new Hs(this)}return e.prototype.onPush=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},e.prototype.onRedo=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},e.prototype.onUndo=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},e.prototype.notify=function(e,t){var i=e.userData._editCallbacks;i&&i[t].call(e)},e.prototype.startDrag=function(e,t,i,r){if(e){r=r||.1,this.app.camera.disable({rotate:!0}),e.pickable=!1,e.catchEventAnyTime=!0,e.node.userData.skipPick=!0,e.position=app.camera.screenToWorld(t,i);var n=this;e.on("mousemove",(function(e){var t=n.app.picker.pickWorldPosition(e.clientX,e.clientY);t||(t=n.app.camera.screenToWorld(e.clientX,e.clientY)),t&&(t[1]+=r,this.position=t)}),"startDrag_mousemove"),e.on("mouseup",(function(e){this.pickable=!0,this.catchEventAnyTime=!1,delete this.node.userData.skipPick,n.group._dispatchBreakableEvent("selectEditableObject",{object:this})&&n.selectObject(this),this.off("mousemove",null,"startDrag_mousemove"),this.off("mouseup",null,"startDrag_mouseup"),n.app.camera.resume({rotate:!0}),n.notify(this,"dragEnd")}),"startDrag_mouseup")}},e.prototype.selectObject=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"translate",i=arguments[2];"translate"==t||"rotate"==t?(this.group.addOnly(e),i&&(e.userData.selectObjectCallback=i),this.setMode(t)):console.error("The mode must be 'translate' or 'rotate'")},e.prototype.unselectObject=function(e){this.group.remove(e)},e.prototype.setMode=function(e){e&&(this.control.mode=e)},e.prototype.parseParams=function(e){var t=e.type;if("RouteLine"==t||"PolygonLine"==t){var i=e.points;if(!i){i=[[-5,0,-5],[0,0,-5],[0,0,0],[0,0,5],[5,0,5]],e.points=i,e.style=e.style||{};var r=e.style;if(r.color=ke.parseValue(r.color,5824222),e.image)void 0===e.scrollUV&&(e.scrollUV=!0)}}else if("Water"==t){i=[[-20,0,-20],[-20,0,20],[20,0,20],[20,0,-20]],e.points=i,e.normalMap0=ke.parseValue(e.normalMap0,"images/water/Water_1_M_Normal.jpg"),e.normalMap1=ke.parseValue(e.normalMap1,"images/water/Water_2_M_Normal.jpg")}else if("Region"==t){i=[[-20,0,-20],[-20,0,20],[20,0,20],[20,0,-20]],e.points=i,e.fontColor=Math.random(),e.fontSize=THING.Math.randomInt(9,32),e.fontText="你好"}return ke.cloneObject(e)},e.prototype.addObjects=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];r instanceof bt?(r.internalUserData.editable=!0,t.push(r)):console.error("The object is not BaseObject, so we can not add object to edit state")}this.group.addObjects(t)},e.prototype.createObject=function(e,t){(e=e||{}).internalUserData={editable:!0};var i=(e=this.parseParams(e)).complete;e.complete=function(){i&&i()};var r=this.app.create(e);return t&&(r.userData._editCallbacks=t),r},e.prototype._pushDeselectObject=function(e,t){t&&e.push({type:"AttachNode",node:t.node,nodeParent:t.node.userData.nodeParent})},e.prototype._pushDeleteObject=function(e,t){t&&this._pushDeselectObject(e,t)},e.prototype.deleteObject=function(e){this.notify(e,"remove");var t=[];this._pushDeleteObject(t,e),this.execute(t,!0),this.group.updateRoot()},e.prototype._pushDeleteObjects=function(e,t){for(var i=0;i<t.length;i++){var r=t[i];this._pushDeleteObject(e,r)}},e.prototype.deleteObjects=function(e){for(var t=0;t<e.length;t++)this.notify(e[t],"remove");var i=[];this._pushDeleteObjects(i,e),this.execute(i,!0),this.group.updateRoot()},e.prototype._isSubNode=function(e){return!!e&&(!e.isBaseObject&&!!e.userData.subNode)},e.prototype._isBreakByControlAxis=function(e){var t=e.intersect;return(!t||!this._isSubNode(t.node))&&!(!this.control.axis||!this.control.visible)},e.prototype._isCanPick=function(e){if(this._isBreakByControlAxis(e))return!1;var t=e.object;if(t){if(t==this.app.outdoors)return!1;if(!t.internalUserData.editable)return!1}return!0},e.prototype._getSortedSubNodes=function(e,t){for(var i=[],r=0;r<e.length;r++){var n=e[r],o=n.userData,a=this.app.objectManager.get(o.id),s=a.getSubNodeIndex(n);i.push({index:s,node:n,object:a})}return i.sort(t),i},e.prototype._pushInsertSubNode=function(e,t){},e.prototype.insertSubNode=function(){var e=this.subNodes;if(e.length){var t=[];this._pushInsertSubNode(t,e),this.execute(t,!0),this.group.updateRoot()}},e.prototype._pushDeleteSubNodes=function(e,t){},e.prototype.deleteSubNodes=function(e){var t=[];this._pushDeleteSubNodes(t,e),this.execute(t,!0),this.group.updateRoot()},e.prototype.deleteSelections=function(){var e=Array.from(this._selectionObjects);e.length&&this.deleteObjects(e);var t=this.subNodes;t.length&&this.deleteSubNodes(t)},e.prototype.deselectObjects=function(e){if(e)for(var t=0;t<e.length;t++)this.group.remove(e[t])},e.prototype.copyObjects=function(e){this.copyObjectsJSONData=[];for(var t=0;t<e.length;t++){var i=e[t],r=i.toJSON();r.localPosition=i.localPosition,r.localAngles=i.localAngles,r.scale=i.scale,this.copyObjectsJSONData.push(JSON.stringify(r))}},e.prototype.selectAll=function(){this.group.addObjects(this.objects)},e.prototype.clearScene=function(){this.group.clearScene()},e.prototype.toJSON=function(){this._enableDirectMode=!0;var e=this.group.toJSON();return this._enableDirectMode=!1,e},e.prototype.fromJSON=function(e){e&&this.group.fromJSON(e)},e.prototype.execute=function(e,t){if(this._enableDirectMode){var i=this.app.commandManager.create(e,t);return i?i.execute():null}return this.app.commandManager.execute(e,t)},e.prototype.processAreaPicking=function(e){var t=e.objects;if(t){for(var i=this.objects,r=[],n=0;n<i.length;n++){var o=i[n];t.has(o)||r.push(o)}this.deselectObjects(r),t.length&&(t[0]instanceof bt?this.group.addObjects(t):this.group.addSubNodes(t))}},e.prototype.onMouseDown=function(e){},e.prototype.onMouseUp=function(e){e.finishedAreaPicking&&this.processAreaPicking(e)},e.prototype.onMouseMove=function(e){e.areaPicking&&(this._enableDirectMode=!0,this.processAreaPicking(e),this._enableDirectMode=!1)},e.prototype.onClick=function(e){if(this.app.events.canClick(e)){var t=this.app.isKeyPressed(F.Ctrl),i=e.object;if(i&&this._isCanPick(e))if(t){var r=e.intersect.node;this.group.has(i)?this.group.remove(i):this.group.has(r)?this.group.remove(r):this.group._dispatchBreakableEvent("selectEditableObject",{object:i})&&this.group.add(i,e)}else this.group._dispatchBreakableEvent("selectEditableObject",{object:i})&&this.group.addOnly(i,e);else t||this.enableAutoRemoveAllWhenClick&&this.group.removeAll()}},e.prototype.onKeyDown=function(e){if(this._enableKeyMode)switch(event.keyCode){case F.Q:this.control.setSpace("local"===this.control.space?"world":"local");break;case F.W:this.control.mode="translate";break;case F.E:this.control.mode="rotate";break;case F.R:break;case F.EqualSign:case F.Add:this.control.size=this.control.size+.1;break;case F.Dash:case F.Subtract:this.control.size=Math.max(this.control.size-.1,.1);break;case F.Y:this.app.isKeyPressed(F.Ctrl)&&this.app.commandManager.redo();break;case F.Z:this.app.isKeyPressed(F.Ctrl)&&this.app.commandManager.undo();break;case F.C:this.app.isKeyPressed(F.Ctrl)&&this.copyObjects(Array.from(this._selectionObjects));break;case F.V:this.app.isKeyPressed(F.Ctrl)&&this.pasteObjects();break;case F.A:this.app.isKeyPressed(F.Ctrl)&&this.selectAll();break;case F.Delete:this.deleteSelections()}},e.prototype.onKeyUp=function(e){},e.prototype.onUpdate=function(e){},e.prototype.onEnter=function(e,t){if(t){this.canRespondFromCommandManager=!0;var i=t.objects;if(i)for(var r=0;r<i.length;r++)this.group.add(i[r]);this.group.attach(),this.control.mode="translate";var n=this;this.app.on("areaPickStart",(function(e){var t=n.candidateForSubNodes;t.length||(t=n.objects),n.app.picker.candidates=t}),"editObject_areaPickStart"),this.app.on("areaPickEnd",(function(e){n.app.picker.candidates=null}),"editObject_areaPickEnd"),this.app.modelResource.residentMode=!0}else console.log("Gizmo state need params")},e.prototype.onLeave=function(e){this.group.detach(),this.canRespondFromCommandManager=!1,this.app.modelResource.residentMode=!1,this.app.off("areaPickStart",null,"editObject_areaPickStart"),this.app.off("areaPickEnd",null,"editObject_areaPickEnd")},o(e,[{key:"enableKeyMode",set:function(e){this._enableKeyMode=e},get:function(){return this._enableKeyMode}},{key:"areaPicking",set:function(e){this.picker.areaPicking=e,e||(this.picker.candidates=null)},get:function(){return this.picker.areaPicking}},{key:"enableAutoRemoveAllWhenClick",set:function(e){this._enableAutoRemoveAllWhenClick=e},get:function(){return this._enableAutoRemoveAllWhenClick}},{key:"objects",get:function(){var e=[];return this.app.objectManager.objects.forEach((function(t){t.internalUserData.editable&&e.push(t)})),e}},{key:"subNodes",get:function(){for(var e=[],t=this.group.root.children,i=0;i<t.length;i++){var r=t[i];r.userData.subNode&&e.push(r)}return e}},{key:"candidateForSubNodes",get:function(){for(var e=new Set,t=this.group.root.children,i=0;i<t.length;i++){var r=t[i].userData;if(r.subNode){var n=r.id;n&&e.add(this.app.objectManager.get(n))}}var o=[];return e.forEach((function(e){o=o.concat(e.subNodes)})),o}}]),e}(),Ns=function(){function e(t){n(this,e),this.app=t,this._outputLog=!1}return e.prototype.outputPathLog=function(e){for(var t="",i=0;i<e.length;i++){var r=this.app.query("#"+e[i])[0];r&&(t+="("+r.type+":"+r.name+":"+r.id+")=>")}t=t._trimRight("=>"),console.log(t)},e.prototype._getParentObject=function(e,t){if(e.getNavigation(t))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(n.getNavigation(t))return n}return null},e.prototype._getObject=function(e,t){var i=e.isFloor?e:e.parents.query(".Floor")[0];return i&&t?i.getRoomFromWorldPosition(t):e},e.prototype._getObjectRoot=function(e,t){function i(e,t){if(t==e)return e;if(t.isChildOf(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t==n)return n;if(t.isChildOf(n))return n}return null}var r=i(e,t),n=i(t,e);return r.isChildOf(n)?n:r},e.prototype._setupGraph=function(e,t){var i=this._getObjectRoot(e,t);if(!i)return null;for(var r=i;r;r=r.parent)if(ke.isFunction(r.setupGraph))return r.setupGraph();return null},e.prototype._buildPathes=function(e){for(var t=[],i=null,r=0;r<e.length;r++){var n=this.app.query("#"+e[r])[0];if(!n.isCampus){var o=n.parent;if(i!=o)t.push({startObject:n,endObject:n}),i=o;else t[t.length-1].endObject=n}}return t},e.prototype.findPath=function(e){var t=(e=e||{}).clipAreas,i=e.startObject||e.startRoom||e.start,r=e.endObject||e.endRoom||e.end;if(!i||!r)return console.error("Needs start and end objects to find path in navigation"),null;var n=e.startPosition||i.position,o=e.endPosition||r.position;if(!n||!o)return console.error("Needs start and end positions to find path in navigation"),null;var a=this._getParentObject(i,t),s=this._getParentObject(r,t);if(!a||!s)return console.error("The parents are not support navigation"),null;if(i=this._getObject(i,n),r=this._getObject(r,o),!i||!r)return console.error("The objects are not support navigation"),null;var l=this._setupGraph(a,s);if(!l)return null;var u=[];if(a==s){var c=a.findPath(n,o);if(!c)return null;u.push({entrance:a,points:c})}else{var h=l.findShortestPath(i.id,r.id);if(!h||!h.length)return null;this._outputLog&&this.outputPathLog(h);var p=this._buildPathes(h);if(!p.length)return null;var d,f=(d=p[0]).endObject;if(!(d=a.findPath(n,f.position)))return null;u.push({points:d,entrance:f});for(var m=1;m<p.length-1;m++){var g=p[m];if(g.startObject!=g.endObject){var v=this.findPath({startObject:g.startObject,endObject:g.endObject});if(!v)return null;u.push(v)}}var y,b=(y=p[p.length-1]).startObject;if(!(y=s.findPath(b.position,o)))return null;u.push({points:y,entrance:b})}return u},o(e,[{key:"outputLog",set:function(e){this._outputLog=e},get:function(){return this._outputLog}}]),e}(),Us=function(){function e(t){n(this,e),this.app=t,this._navigation=new Ns(t),this.lineIndex=-1,this.floor=null,this.lines=[],this.routeLines=[],this.lineParams={},this._object=null,this._defaultObject=null,this.speed=0,this.liftSpeed=0,this.startCallback=null,this.changeFloorCallback=null,this.completeCallback=null}return e.prototype.findPath=function(e,t,i,r){var n={start:e,startPosition:t,end:i,endPosition:r},o=this._navigation.findPath(n);return o?(this.createLine(o),o):null},e.prototype.clearPath=function(){this.destroyLine()},e.prototype.showPath=function(){if(this.routeLines.length)if(0===arguments.length)for(var e=0;e<this.routeLines.length;e++){this.routeLines[e].line.visible=!0}else if(1===arguments.length){var t=arguments[0];for(e=0;e<this.routeLines.length;e++){this.routeLines[e].line.visible=t}}else if(2===arguments.length){var i=arguments[0];for(t=arguments[1],e=0;e<this.routeLines.length;e++){var r=this.routeLines[e],n=r.floor,o=r.line;n==i&&(o.visible=t)}}},e.prototype.createEvent=function(e){var t=e;return t.speed=this.speed,t.liftSpeed=this.liftSpeed,t},e.prototype.getLinesParent=function(e){return e.building?e.building:e},e.prototype.setLineParams=function(e){(e=e||{}).type=e.type||"RouteLine";var t=e.type;"Line"==t?(e.color=e.color||65280,e.dotSize=e.dotSize||2,e.dotColor=e.dotColor||16711680):"RouteLine"==t&&(e.scrollUV=ke.parseValue(e.scrollUV,!1)),this.lineParams=e},e.prototype.createLine=function(e){if(e){var t=this.getLinesParent(e[0].entrance);if(t){this.destroyLine(),this.lineIndex=0;for(var i=0;i<e.length;i++){var r=e[i],n=r.entrance,o=r.points;this.lines.push({entrance:n,points:o});var a=ke.cloneObject(this.lineParams);a.parent=t,a.points=o,a.visible=!1,a.arrowFlag=i===e.length-1;var s=app.create(a);this.routeLines.push({entrance:n,line:s})}}}},e.prototype.destroyLine=function(){if(this.lines.length){for(var e=0;e<this.routeLines.length;e++)this.routeLines[e].line.destroy();this.routeLines=[],this.lineIndex=-1,this.lines=[]}},e.prototype.start=function(e){if(e=e||{},this.stop(),this.lines.length&&(this.lineIndex=0,this.speed=e.speed,this.liftSpeed=e.liftSpeed,this.startCallback=e.start,this.beforeChangeFloorCallback=e.beforeChangeFloor,this.afterChangeFloorCallback=e.afterChangeFloor,this.completeCallback=e.complete,this.startCallback)){var t=this.lines[0],i=t.floor,r=t.points;this.startCallback(this.createEvent({floor:i,path:r}))}},e.prototype.stop=function(){this.lineIndex=-1,this._object&&this._object.stopMoving(),this.completeCallback&&this.completeCallback(this.createEvent({floor:this.floor,pos:this._object.position}))},e.prototype._goWithLineComplete=function(e){if(e<this.lines.length-1){var t=this;this._object.movePath({position:this.lines[e+1].points[0],speed:this.liftSpeed,complete:function(){var i=t.afterChangeFloorCallback;if(i){var r=t.lines[e].floor,n=t.lines[e+1].floor,o=t.lines[e+1].points,a=o[0];i(t.createEvent({curFloor:r,nextFloor:n,path:o,position:a}))}t.lineIndex=e+1}});var i=this.beforeChangeFloorCallback;if(i){var r=this.lines[e].floor,n=this.lines[e+1].floor,o=this.lines[e+1].points,a=this.lines[e].points[this.lines[e].points.length-1];i(this.createEvent({curFloor:r,nextFloor:n,path:o,position:a}))}}else{if(this.completeCallback){var s={floor:this.floor};if(this._object)s.pos=this._object.position;else{var l=this.lines[e];s.pos=l.points[l.points.length-1]}this.completeCallback(s)}this.lineIndex=-1}},e.prototype.goWithLine=function(){var e=this.lines[this.lineIndex],t=this.lineIndex;if(this.lineIndex=-1,this.floor=e.floor,this._object){var i=this;this._object.movePath({path:e.points,speed:this.speed,orientToPath:!0,complete:function(){i._goWithLineComplete(t)}})}else this._goWithLineComplete(t)},e.prototype.updateLineIndex=function(){-1!==this.lineIndex&&(this.lineIndex>=this.lines.length||this.goWithLine())},e.prototype.showNavigationHelper=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.app.query(".Floor").forEach((function(t){t.isOutdoors||t.showNavigationHelper(e)}))},e.prototype.pickFloor=function(e){if(!e.picked)return null;var t=e.object;return t?{pos:e.pickedPosition,floor:t.floor}:null},e.prototype.onUpdate=function(e){this.updateLineIndex()},e.prototype.onEnter=function(e){this.setLineParams();var t=new THREE.Object3D;this._defaultObject=new bt(this.app)._init(t,null),this._defaultObject.visible=!1,this._object=this._defaultObject,this.app.scene.add(t)},e.prototype.onLeave=function(e){this._defaultObject.destroy(),this._defaultObject=null,this._object=null},o(e,[{key:"outputLog",set:function(e){this._outputLog=e},get:function(){return this._outputLog}},{key:"object",set:function(e){this._object=e||this._defaultObject},get:function(){return this._object}}]),e}();function Vs(e){this.app=e.app,this.camera=this.app.camera,this.savedPosition=this.camera.position,this.savedTarget=this.camera.target,this.position=e.position,this.target=e.target,this.time=e.time}function zs(e){this.app=e.app,this.scene=this.app.scene,this.vertices=e.vertices,this.pointColor=e.pointColor,this.lineColor=e.lineColor,this.regionColor=e.regionColor,this.id=e.id}Vs.prototype.execute=function(){this.camera.flyTo({position:this.position,target:this.target,time:this.time,complete:function(){}})},Vs.prototype.undo=function(){this.camera.flyTo({position:this.savedPosition,target:this.savedTarget,time:this.time,complete:function(){}})},zs.prototype.execute=function(){var e=this.app.create({type:"PolygonRegion",vertices:this.vertices,pointColor:this.pointColor,lineColor:this.lineColor,regionColor:this.regionColor});this.id=e.id},zs.prototype.undo=function(){var e=this.app.objectManager.get(this.id);e&&e.destroy()};var qs={Normal:0,Expanding:1,Expanded:2,Unexpanding:3};function Ws(e){this.app=e.app,this.setParam(e),this.expandingCount=0,this.expandState=qs.Normal}function Gs(e){this.app=e.app,this.node=e.node,this.oldPosition=e.position,this.oldScale=e.scale,this.oldRotation=e.rotation,this.position=this.node.position.clone(),this.scale=this.node.scale.clone(),this.rotation=this.node.rotation.clone()}function Xs(e){this.app=e.app,this.node=e.node,this.nodeParent=e.nodeParent,this.oldNodeParent=this.node.parent}function Ys(e){this.app=e.app,this.object=e.object,this.oldPosition=e.position,this.oldScale=e.scale,this.oldAngles=e.angles||e.offsetAngles,this.position=this.object.position,this.scale=this.object.scale,this.angles=this.object.angles}function Js(e){this._app=e.app,this._object=e.object,this._attributes={}}Ws.prototype.initPosition=function(){for(var e=0;e<this.objs.length;e++){var t=this.objs[e];t.internalUserData.expandInitPos=t.internalUserData.expandInitPos||t.node.position.clone()}},Ws.prototype.clearInitPosition=function(){for(var e=0;e<this.objs.length;e++){delete this.objs[e].internalUserData.expandInitPos}},Ws.prototype.setParam=function(e){this.objs=e.objects||this.objs,this.flyTime=e.time||this.flyTime||1e3,this.length=e.length||e.distance||this.length||10,this.horzMode=ke.parseValue(e.horzMode,this.horzMode),this.hideRoof=ke.parseValue(e.hideRoof,this.hideRoof),this.callback=e.complete||this.callback,this.expandFloorsNumber=e.number||5,this.skipRoof=ke.parseValue(e.skipRoof,this.skipRoof)},Ws.prototype.disableUpdateBoundingBox=function(e,t){e.disableUpdateBoundingBox=t,e.parents.forEach((function(e){e.disableUpdateBoundingBox=t}))},Ws.prototype.expandObj=function(e,t){this.initPosition();var i=ke.parseVector3(e.internalUserData.expandInitPos).distanceTo(e.node.position),r=this.horzMode,n=t*this.length-i,o=0,a=this;e.expandTween=new TWEEN.Tween({progress:0}).to({progress:1},this.flyTime).easing(TWEEN.Easing.Linear.None).onStart((function(){if(e instanceof hr&&!ke.isNull(a.hideRoof)&&!a.skipRoof){var t=!a.hideRoof;e.traverseRoofs((function(e){e.visible!=t&&(e._changeVisibleByExpand=!0,e.visible=t)}))}a.disableUpdateBoundingBox(e,!0)})).onStop((function(){a.disableUpdateBoundingBox(e,!1)})).onUpdate((function(){var t=this._object.progress-o,i=n*t;o=this._object.progress,r?e.translateZ(i):e.translateY(i)})).onComplete((function(){a.disableUpdateBoundingBox(e,!1),a.onExpandComplete(),t==a.objs.length-1&&a.app.events.dispatchEvent({type:"expand",object:e.parent})})).start()},Ws.prototype.unexpandObj=function(e,t){var i=ke.parseVector3(e.internalUserData.expandInitPos).distanceTo(e.node.position),r=this.horzMode,n=i,o=0;this.length<0&&(n*=-1);var a=this;e.unexpandTween=new TWEEN.Tween({progress:0}).to({progress:1},this.flyTime).easing(TWEEN.Easing.Linear.None).onStart((function(){a.disableUpdateBoundingBox(e,!0)})).onStop((function(){a.disableUpdateBoundingBox(e,!1)})).onUpdate((function(){var t=this._object.progress-o,i=n*t;o=this._object.progress,r?e.translateZ(-i):e.translateY(-i)})).onComplete((function(){if(a.disableUpdateBoundingBox(e,!1),e instanceof hr&&a.hideRoof&&!a.skipRoof){var i=a.hideRoof;e.traverseRoofs((function(e){e._changeVisibleByExpand&&(delete e._changeVisibleByExpand,e.visible=i)}))}a.onExpandComplete(),t==a.objs.length-1&&a.app.events.dispatchEvent({type:"unexpand",object:e.parent})})).start()},Ws.prototype.execute=function(){if(this.expandState!=qs.Expanding&&this.expandState!=qs.Expanded){this.expandState==qs.Unexpanding&&this.stopExpanding(),this.expandingCount=0,this.expandState=qs.Expanding;for(var e=0,t=0;t<this.objs.length;t++){var i=this.objs[t];this.expandObj(i,e),e++,this.horzLength&&e%this.expandFloorsNumber==0&&(e=0)}}},Ws.prototype.undo=function(){if(this.expandState!=qs.Unexpanding&&this.expandState!=qs.Normal){this.expandState==qs.Expanding&&this.stopExpanding(),this.expandingCount=0,this.expandState=qs.Unexpanding;for(var e=0;e<this.objs.length;e++){var t=this.objs[e];this.unexpandObj(t,e)}}},Ws.prototype.stopExpanding=function(){if(this.expandState!=qs.Normal)for(var e=0;e<this.objs.length;e++){var t=this.objs[e];t.expandTween&&(t.expandTween.stop(),t.expandTween=null),t.unexpandTween&&(t.unexpandTween.stop(),t.unexpandTween=null)}},Ws.prototype.onExpandComplete=function(){this.expandState!=qs.Normal?(this.expandingCount++,this.expandingCount<this.objs.length||(this.expandState==qs.Expanding?(this.expandState=qs.Expanded,this.callback&&this.callback(this.expandState)):this.expandState==qs.Unexpanding&&(this.clearInitPosition(),this.expandState=qs.Normal,this.callback&&this.callback(this.expandState)))):console.error("onExpandComplete should not come here!")},Gs.prototype.execute=function(){this.node.position.copy(this.position),this.node.scale.copy(this.scale),this.node.rotation.copy(this.rotation),this.node.updateMatrixWorld()},Gs.prototype.undo=function(){this.node.position.copy(this.oldPosition),this.node.scale.copy(this.oldScale),this.node.rotation.copy(this.oldRotation),this.node.updateMatrixWorld()},Xs.prototype.execute=function(){this.node&&this.nodeParent&&(this.nodeParent.updateMatrixWorld(),this.node.attachToParent(this.nodeParent,this.app.scene))},Xs.prototype.undo=function(){this.node&&this.oldNodeParent&&(this.oldNodeParent.updateMatrixWorld(),this.node.attachToParent(this.oldNodeParent,this.app.scene))},Ys.prototype.execute=function(){this.object.position=this.position,this.object.scale=this.scale,this.object.angles=this.angles},Ys.prototype.undo=function(){this.object.position=this.oldPosition,this.object.scale=this.oldScale,this.object.angles=this.oldAngles},Js.prototype.execute=function(){for(var e=Object.keys(this._attributes),t=0;t<e.length;t++){var i=e[t],r=this._attributes[i];void 0!==r&&(this._object.style[i]=r)}},Js.prototype.undo=function(){},Js.prototype.setAttribute=function(e,t){this._attributes[e]=t},Js.prototype.getAttribute=function(e){return this._attributes[e]};var Qs=function(){function e(t){n(this,e),this.app=t.app,this.object=t.object,this.params=t.params}return e.prototype.execute=function(){this.object.style._inheritThemeName===this.params.name&&("Campus"===this.object.type||"Floor"===this.object.type?this.object.applyTheme(this.params.name,!0,!0):this.object.style._applyTheme&&this.object.style._applyTheme(this.params.name,this.params.force))},e.prototype.undo=function(){},e}(),Zs=function(){function e(t){n(this,e),this.app=t.app,this.object=t.object,this.params=t.params}return e.prototype.execute=function(){this.object.lodLevel=this.params.level},e.prototype.undo=function(){},e}();function Ks(e){this.app=e.app,this.object=e.object,this.params=e.params}Ks.prototype.execute=function(){this.object.playAnimation(this.params)},Ks.prototype.undo=function(){},k.AppComplete="complete",k.LoadCampusProgress="progress",k.LoadCampus="load",k.UnloadCampus="unload",k.PickObject="pick",k.Dragging="drag",k.CreateObject="create",k.DestroyObject="destroy",k.ExpandBuilding="expand",k.UnexpandBuilding="unexpand",k.SelectObject="select",k.DeselectObject="deselect",k.ObjectSelectionChanged="selectionchange",k.PickedObjectChanged="pickchange",k.BeforeLevelChange="beforelevelchange",k.Pick="pick",k.Unpick="unpick",k.PickChange="pickchange",k.AreaPickStart="areapickstart",k.AreaPicking="areapicking",k.AreaPickEnd="areapickend",k.BeforeLoad="beforeload",O.Default="__default__",O.LevelSetEffect="__level_set_effect__",O.LevelPickMethod="__level_pick_operation__",O.LevelEnterMethod="__level_enter_operation__",O.LevelBackMethod="__level_back_operation__",O.LevelFlyBreak="__level_fly_break__",O.LevelPickOperation="__level_pick_operation__",O.LevelCameraController="__level_camera_controller__",S.LeftView="leftview",S.RightView="rightview",S.FrontView="frontview",S.BackView="backview";var $s=function(){var e=1,t=1,i=128/e,r=128/t,n=["rgb(255,255,255)"],o=document.createElement("canvas");o.width=128,o.height=128;for(var a=o.getContext("2d"),s=0;s<t;s++)for(var l=0;l<e;l++)a.fillStyle=n[(l+s)%2],a.fillRect(l*i,s*r,i,r);return o}(),el=function(){function e(t){if(n(this,e),t=t||{},this.tryUseCurrentApp(t))return e.current;e.current=this,this._useAsLoader=!1,this._useAsLoaderTimes=0,this._skipUnbindAppEvents=!1,this.tree={},this.domElement=null,this._inputElement=null,this.scene=null,this.camera=null,this.renderCamera=null,this._lightGroup=null,this.picker=null,this.enableGPUPicker=!0,this.sceneURL="";this.baseURL=c.toStr([87,226,191,239,69,108,125,170,74,24,83,106,232,134,141,122,5,230,106,232,86,91,132,34,209,138,177,45,52,124]),this.modelURL="https://model.3dmomoda.com/models/",this.spriteResource=null,this.modelResource=null,this.particleResource=null,this.objectManager=null,this.server=null,this.viewPointManger=null,this.webViewManager=null,this._floorLoaderManager=null,this.campusLoader=null,this.controls=[],this._elapsedTime=0,this._deltaTime=0,this._time=0,this._currentFrame=0,this._fpsLimitedDelta=0,this._fpsLimitedPreviousDelta=0,this._tweenTime=0,this.curView=null,this._bgColor=ke.parseColor(9474192),this.stateManager=null,this.commandManager=null,this.inited=!1,this.initDomElementHeight="",this._fpsTimes=[],this.renderStates={},this._pixelRatio=1,this._renderOptions={},this.uuid=THING.Math.generateUUID(),this.parseOptions(t),this.init(t),this.resizeLock=!1}return e.prototype.tryUseCurrentApp=function(t){if(!e.current)return!1;if(!e.current.useAsLoader)return!1;var i=e.current;i._useAsLoaderTimes&&!i._skipUnbindAppEvents&&i.events.unbindAppEvents(i.uuid),i.uuid=THING.Math.generateUUID(),i._useAsLoaderTimes++;var r=i.confirmURL(t.url);return r&&i._loadInitCampus(r,t),!0},e.prototype.parseOptions=function(e){this.options=e;this.appKey=e.appKey||e.ak||"app_test_key";var t=e.container||e.el||"div3d";if(t&&(ke.isString(t)?this.domElement=document.getElementById(t):this.domElement=t),this.domElement){this.domElement.style.cssText+="top: 0; left: 0; position: relative; overflow: hidden";var i=document.createElement("div");if(i.style.cssText="position: absolute;top: -1000px;left: 0",this.domElement.appendChild(i),this._inputElement=document.createElement("input"),this._inputElement.setAttribute("type","text"),this._inputElement.setAttribute("readonly","true"),this._inputElement.setAttribute("id","inp"),i.appendChild(this._inputElement),this.domElement.appendChild(i),!1===e.backwardEnabled&&this.setBackwardEnabled(!1),this.useOcclusionMap=!1,e.useOcclusionMap&&(this.useOcclusionMap=e.useOcclusionMap),this.splitLoadSpeed=.1,e.loadSpeed&&(this.splitLoadSpeed=e.loadSpeed),this.loadMode=0,e.loadMode&&(this.loadMode=e.loadMode),ke.isString(e.url)){if(this.sceneURL=this.confirmURL(e.url),!e.skyBox&&!e.background){"321paevasd1x"==c.toStr([94,250,162,253,87,52,51,168,92,26,80,44])?e.skyBox="White":e.skyBox="Dark"}}else e.skyBox||e.background||(e.background=this._bgColor);e.keepBackgroundAspect&&(this._keepBackgroundAspect=e.keepBackgroundAspect),ke.parseValue(e.isMobile,!1)&&(this._isMobile=!0),this.modelURL=e.modelURL||this.modelURL,this.resourceLibraryUrl=e.resourceLibraryUrl,this.options.maxTextureSize=this.options.maxTextureSize||2048,this._useAsLoader=ke.parseValue(this.options.useAsLoader,!1),this._skipUnbindAppEvents=ke.parseValue(this.options.skipUnbindAppEvents,!1),this.enableGPUPicker=ke.parseValue(e.enableGPUPicker,!this.isMobileDevice),e.disablePlugins&&(V=!0,z=!0),this._useTryCatch=e.useTryCatch}else console.error(x)},e.prototype.confirmURL=function(e,t){if(!e)return"";if(ke.isArray(e)){for(var i=0;i<e.length;i++)e[i]=this.confirmURL(e[i]);return e}if(-1!==e.indexOf("http://")||-1!==e.indexOf("https://")){if(window.location){var r=window.location.protocol;r&&"https:"==r&&(r+="//",-1!==e.indexOf("http://")&&(e=e.replace("http://",r)))}return e}return 0==e.indexOf("./")||0==e.indexOf("../")||0==e.indexOf("/")?e:this.options.resourceLibraryUrl?this.options.resourceLibraryUrl.appendPath(e.trimLeft(this.options.resourceLibraryUrl)):(t=t||this.baseURL).appendPath(e)},e.prototype.confirmBaseURL=function(e){return this.options.resourceLibraryUrl?this.options.resourceLibraryUrl.appendPath("/"):e},e.prototype.confirmModelURL=function(e){return this.resourceLibraryUrl?this.resourceLibraryUrl.appendPath("models").appendPath(e).appendPath("/0/gltf/"):this.modelURL?this.modelURL.appendPath(e).appendPath("/0/gltf/"):void 0},e.prototype.confirmTextureURL=function(e,t){return this.resourceLibraryUrl?this.resourceLibraryUrl.appendPath("textures").appendPath(e+"."+t):"https://static.3dmomoda.com/textures/"+e+"."+t},e.prototype.collectRenderStates=function(){for(var e=performance.now();this._fpsTimes.length>0&&this._fpsTimes[0]<=e-1e3;)this._fpsTimes.shift();this._fpsTimes.push(e);var t=this._fpsTimes.length,i=this.renderer.info.memory,r=this.renderer.info.render;this.renderStates={fps:t,geometries:i.geometries,textures:i.textures,frame:r.frame,calls:r.calls,triangles:r.triangles,points:r.points,lines:r.lines}},e.prototype.createRenderer=function(e,t,i){var r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0;n=i?r.getContext("webgl",{antialias:!0,preserveDrawingBuffer:e,alpha:!0}):r.getContext("webgl2",{antialias:!0,preserveDrawingBuffer:e,alpha:!0})||r.getContext("webgl",{antialias:!0,preserveDrawingBuffer:e,alpha:!0});var o=new THREE.WebGLRenderer({canvas:r,context:n});o.info.autoReset=!1,o.setPixelRatio(window.devicePixelRatio);var a=this.calcRect();return o.setSize(a.width,a.height),t.appendChild(o.domElement),o.gammaFactor=o.capabilities.isWebGL2?1.8:1.6,o.gammaInput=!0,o.gammaOutput=!0,o.shadowMap.enabled=!0,o.shadowMap.type=THREE.PCFSoftShadowMap,o},e.prototype._loadInitCampus=function(e,t){t=t||this.options;var i=this;this.objectManager.create({type:"Campus",url:e,name:t.name,visible:ke.parseValue(t.visible,!0),position:t.position,angles:t.angles,basePosition:t.basePosition,baseAngles:t.baseAngles,properties:t.properties,isCamFitScene:t.isCamFitScene,disableCache:t.disableCampusCache,dynamic:t.dynamic,enableProxima:t.enableProxima,enableBatchObject:t.enableBatchObject,map:t.map,complete:function(){i.trigger("load",{app:i,campus:this,buildings:this.buildings})},error:function(e){var i=t.error||t.errorCallback;i&&i(e)}})},e.prototype.init=function(e){var t=this;e.useFileLoaderWorker&&(THREE.FileLoader=THING.Plugins.THREE.FileLoader,THREE.ImageLoader=THING.Plugins.THREE.ImageLoader,e.useStaticImage&&(THREE.ImageLoader.staticImage=$s)),TWEEN.removeAll();var i=this.calcRect(),r=document.createElement("meta");r&&(r.content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0",r.name="viewport",document.getElementsByTagName("head")[0].appendChild(r)),this.renderCamera=new THREE.CombinedCamera(i.width,i.height,60,.1,1e4,-1e4,1e4);var n=e.renderer;this.renderer=n||this.createRenderer(!1,this.domElement,e.forceWebGL1),this.cssRenderer=new THREE.CSS3DRenderer({autoFixCamera:!0}),setTimeout((function(){t.cssRenderer.domElement.style.position="absolute",t.cssRenderer.domElement.style.top="0",t.cssRenderer.domElement.style.pointerEvents="none",t.cssRenderer.setSize(i.width,i.height);var r=e.cssParentNode||t.renderer.domElement.parentNode;r&&r.appendChild(t.cssRenderer.domElement)}),10),setTimeout((function(){var e=t.domElement.children;e.length&&e[0].length&&(e[0].children[0].style.pointerEvents="none")}),1e3),this.cssScene=new THREE.Scene,this.spriteResource=new js(this),this.modelResource=new Os(this),this.particleResource=new ks(this),this.events=new qa(this),this.objectManager=new wa(this),this.server=new as(this),this.viewPointManger=new ss(this),this.commandManager=new Ya(this),this._floorLoaderManager=new hs(this),this.edgesGeometriesManager=new Ta(this),this.materialDisposeManager=new Aa(this),this.styleManager=new Ba(this);var o=new THREE.Scene;if(this.scene=o,this.picker=new Ts(this,this.enableGPUPicker),this._selection=new Ss(this),this.stateManager=new Ga(this),this.camera=new Rs(this),this.loadingManager=new $a(this),this.resourceManager=new Ka(this),this.webViewManager=new Ia(this),this.campusLoader=new Dn(this),this.register(),this.sceneLevel=new Ds(this),this.sceneRoot=this.create({type:"SceneRoot",parent:null}),this.scene.add(this.sceneRoot.node),this.rendererManager=new ns(this),this.renderEffects=this.rendererManager.createControl(),this.renderEffects.mergeConfig({postEffect:{enable:this.renderer.capabilities.isWebGL2}}).save().active(),this._lightGroup=this.create({type:"LightGroup",parent:this.root}),this.sceneManager=new Qa(this),this.sceneManager.enableDeafultViewPointFile=ke.parseValue(this.options.enableDeafultViewPointFile,!1),this.sceneManager.defaultViewPointFileName=ke.parseValue(this.options.defaultViewPointFileName,this.sceneManager.defaultViewPointFileName),this.addControl(this.sceneManager,"",!1),this.addControl(this.camera,"",!1),this.addControl(this.objectManager,"",!1),this.addControl(this.modelResource,"",!1),this.addControl(this.resourceManager,"",!1),this.mainUI=new Es(this),this.addControl(this.mainUI,"",!0),this.addControl(this.spriteResource,"",!1),this.addControl(this.webViewManager,"",!1),this.addControl(this.campusLoader,"",!1),this.addControl(this.stateManager,"",!0),this.addControl(this._floorLoaderManager,"",!1),this.addControl(this.selection,"",!1),this.addControl(this.sceneLevel,"",!1),this.mainUI._setup(),this.options.background&&(this.background=this.options.background),this.options.skyBox&&(this.skyBox=this.options.skyBox),this.sceneLevel.init(),this.defaultEvents=new Ps(this),this.defaultEvents.init(),window.addEventListener("resize",(function(){t.resizeLock||ke.throttling((function(){t.resize()}),200)()})),THREE.ImageUtils.crossOrigin="anonymous",this.events.dispatchEvent({type:"success"}),0!=this.sceneURL.length){var a=this.options.complete;a&&(this.options.complete=null,this.one("load",(function(e){e.app=t,a.call(e.campus,e)}))),this.options.isCamFitScene=ke.parseValue(this.options.isCamFitScene,!0),this._loadInitCampus(this.sceneURL)}this.setupComplete();for(var s=["cameraChange"],l=0;l<s.length;l++)this.events.addEventListener(s[l],(function(){t.needUpdate=!0}));this.changeStates();var u=ke.parseValue(e.autoTick,!0),c=this.tick.bind(this);return u&&(c(0),this.renderer.setAnimationLoop(c)),this},e.prototype._updateTweenTime=function(){return this._tweenTime+=1e3*this._deltaTime,this._tweenTime},e.prototype._updateStaticImage=function(){var e=THING.useStaticImage;void 0!==e&&(!0===e?THREE.ImageLoader.staticImage=$s:!1===e?THREE.ImageLoader.staticImage=null:e.width&&e.height&&(THREE.ImageLoader.staticImage=e),delete THING.useStaticImage)},e.prototype._tick=function(e){this._updateStaticImage(),this._deltaTime=e,this._elapsedTime+=e,this._currentFrame++,this.trigger("beforerender"),this.collectRenderStates(),this.renderer.info.reset(),this.inited&&(this.events.update(),this.updateControls(!1));var t=this._updateTweenTime();TWEEN.update(t),ke.timer.update(this.deltaTime),this.rendererManager.update(),this.trigger("afterrender"),this.inited&&this.updateControls(!0),this.materialDisposeManager.update(this._deltaTime)},e.prototype.tick=function(e){var t=e/1e3,i=t-this._time;this._time=t;var r=this,n=function(){if(r._useTryCatch)try{r._tick(i)}catch(e){console.error(e)}else r._tick(i)},o=this._renderOptions.fpsLimit;if(o){this._fpsLimitedDelta+=i;var a=this._fpsLimitedDelta-this._fpsLimitedPreviousDelta,s=1/o;o&&a>=s&&(n(),this._fpsLimitedPreviousDelta=this._fpsLimitedDelta-a%s)}else n()},e.prototype.register=function(){this.stateManager.registerEx({Picker:bs}),this.stateManager.registerEx({CameraController:Ls}),this.stateManager.registerEx({EditObject:Is}),this.stateManager.registerEx({Navigation:Us}),this.commandManager.register("CameraFlyTo",Vs),this.commandManager.register("ExpandObjects",Ws),this.commandManager.register("SetNodeTranslation",Gs),this.commandManager.register("AttachNode",Xs),this.commandManager.register("SetObjectTranslation",Ys),this.commandManager.register("SetObjectStyle",Js),this.commandManager.register("ApplyObjectTheme",Qs),this.commandManager.register("setObjectLodLevel",Zs),this.commandManager.register("PlayObjectAnimation",Ks),this.commandManager.register("CreateRegion",zs)},e.prototype.changeStates=function(){this.stateManager.change("Picker"),this.stateManager.change("CameraController"),this.stateManager.change("Navigation")},e.prototype.setupComplete=function(){var e=this;this.inited=!0,setTimeout((function(){e.one("loadallpluginscomplete",(function(){!function(){if(e.events){var t={},i=e.root.campuses[0];i&&(t.app=e,t.campus=i,t.buildings=i.buildings),e.trigger("complete",t);var r=ke.parseFunction(e.options.complete);r&&r({app:e})}}()})),me({app:e})}),10)},e.prototype.calcRect=function(){var e=this.domElement.style.width,t=this.domElement.style.height;""==t&&(t=window.getComputedStyle?window.getComputedStyle(this.domElement,null).getPropertyValue("height"):this.domElement.currentStyle.height,""==this.initDomElementHeight&&(this.initDomElementHeight=t),"0px"!=t&&"auto"!=t||(t=""));var i=0==e.length||-1!==(e+"").indexOf("%")?this.domElement.clientWidth:e.match(/\d*[^px]/)[0],r=0==t.length||-1!==(t+"").indexOf("%")?this.domElement.clientHeight:t.match(/\d*[^px]/)[0];return 0==i&&(i=window.innerWidth),0==r&&(r=window.innerHeight),"0px"==this.initDomElementHeight&&(r=window.innerHeight),{width:Number(i),height:Number(r)}},e.prototype.isInScreen=function(e){var t=e[0],i=e[1];return!(t<0||i<0)&&!(t>=this.width||i>=this.height)},e.prototype.create=function(e){return this.objectManager.create(e)},e.prototype.resize=function(){var e=this.calcRect(),t=e.width,i=e.height;this.width=t,this.height=i,this.camera.resize(t,i),this.picker.resize(t,i),this.webViewManager.resize(t,i),this.rendererManager.resize(t,i),this.resizeControls(t,i),this.stateManager.dispatchEvent({stateType:"onResize",width:t,height:i}),this.events.dispatchEvent({type:"resize",size:[t,i]}),this.renderer.setPixelRatio(this._pixelRatio*window.devicePixelRatio),this._keepBackgroundAspect?this.sceneManager._keepBackgroundAspect():this.sceneManager._resetBackgroundAspect()},e.prototype.setBackwardEnabled=function(e){history.pushState(null,null,document.URL),window.addEventListener("popstate",(function(){history.pushState(null,null,document.URL)}))},e.prototype.getClientPosition=function(e,t){return this.events.eventProcessor.getEventPosition(e,t)},e.prototype.query=function(e){if(ke.isString(e)&&e.startsWith("/"))return new bt(this)._init(this.scene,null).query(e);var t=new ct(this);return t.select(e,this.objectManager.objects),t},e.prototype.on=function(e,t,i,r,n,o){var a=this.events.bindCall(e,t,i,r,n,o);"filterPickedResults"==e&&(console.warn("Please use .picker.pickedResultsFunc=function(ev) to replace .on()"),this.picker.pickedResultsFunc=a.callback)},e.prototype.off=function(e,t,i){var r=this.events.unbindCall(e,t,i);return"filterPickedResults"==e&&(console.warn("Please use .picker.pickedResultsFunc=null to replace .on()"),this.picker.pickedResultsFunc=null),r},e.prototype.one=function(e,t,i,r,n,o){this.events.bindCall(e,t,i,r,n,!0,o)},e.prototype.trigger=function(e,t,i,r){if(this.events){var n;if(ke.isString(t))i=r||i||{},this.query(t).forEach((function(t){n=t.trigger(e,i)}));else{var o=(i=t||r||i||{}).type;i.type=e,n=this.events.triggerCall(i),i.type=o}return n}},e.prototype.pauseEvent=function(e,t,i){this.events.pauseEvent(e,t,i)},e.prototype.pauseEventInFrame=function(e,t,i){this.events.pauseEvent(e,t,i,!0)},e.prototype.isPauseEvent=function(e,t,i){return this.events.isPauseEvent(e,t,i)},e.prototype.resumeEvent=function(e,t,i){this.events.resumeEvent(e,t,i)},e.prototype.hasEvent=function(e){return this.events.hasEvent(e)},e.prototype.execute=function(e){this.commandManager.execute(e)},e.prototype.addControl=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e)return ke.isFunction(e.onAdd)&&e.onAdd(this),this.controls.push({control:e,name:t,afterRender:i}),e},e.prototype.getControl=function(e){for(var t=0;t<this.controls.length;t++){var i=this.controls[t];if(i.name==e)return i.control}return null},e.prototype.getControlIndex=function(e){for(var t=0;t<this.controls.length;t++){if(this.controls[t].control==e)return t}return-1},e.prototype.removeControl=function(e){if(e)if(ke.isString(e)){var t=this.getControl(e);this.removeControl(t)}else{var i=this.getControlIndex(e);if(-1===i)return;ke.isFunction(e.onRemove)&&e.onRemove(this),this.controls.splice(i,1)}},e.prototype.hasControl=function(e){if(!e)return!1;if(ke.isString(e)){if(!this.getControl(e))return!1}else if(-1===this.getControlIndex(e))return!1;return!0},e.prototype.updateControls=function(e){for(var t=this._deltaTime,i=0;i<this.controls.length;i++){var r=this.controls[i];if(r.afterRender==e){var n=r.control;n.onUpdate&&n.onUpdate(t)}}},e.prototype.resizeControls=function(e,t){for(var i=0;i<this.controls.length;i++){var r=this.controls[i].control;r.onResize&&r.onResize(e,t)}},e.prototype.getCampusJSON=function(e,t){return this.campusLoader.peekJSON(e,t)},e.prototype.loadJSONData=function(e,t){if(e){var i=t.complete;e=this.confirmURL(e),new THREE.FileLoader(this.loadingManager).load(e,(function(e){if(e&&i){var t=ke.objectKeysToLowerCase(JSON.parse(e));i(t)}}),(function(){}),(function(){}))}},e.prototype.focus=function(){this._inputElement&&this._inputElement.focus()},e.prototype.isKeyPressed=function(e){return this.events.isKeyPressed(e)},e.prototype.unloadResources=function(){this.events.clear(),this.root.init();for(var e=this.query("*"),t=0;t<e.length;t++){e[t].destroy()}this.stateManager.clear(),this.stateManager.init(),this.register(),this.changeStates()},e.prototype.pauseUpdate=function(){this.objectManager.pause()},e.prototype.resumeUpdate=function(){this.objectManager.resume()},e.prototype.getRenderStates=function(){return this.renderStates},e.prototype.captureScreenshotToImage=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpeg",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];try{return this.rendererManager.captureToDataURL(e,t,i,r,n)}catch(e){return console.error(e),null}},e.prototype.captureScreenshot=function(e,t,i){try{var r=e.getExtension(),n=this.rendererManager.captureToDataURL(t,i,r,1,!0);n&&this.saveFile(e,n)}catch(e){return void console.error(e)}},e.prototype.saveFile=function(e,t){var i=document.createElement("a");if("string"==typeof i.download){if(document.body.appendChild(i),i.download=e,t instanceof Blob)i.href=URL.createObjectURL(t);else if(ke.isString(t))if(-1!==t.indexOf("data:image/octet-stream"))i.href=t;else{t=new Blob([t],{type:"text/plain;charset=UTF-8"});i.href=window.URL.createObjectURL(t)}else if(t.width&&t.height){var r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0,t.width,t.height);var n=r.toDataURL();n=n.replace("image/png","image/octet-stream"),this.saveFile(e,n)}else i.href=t;i.click(),document.body.removeChild(i)}else location.replace(uri)},e.prototype.saveUTF8TextFile=function(e,t){var i=new Blob([t],{type:"text/plain;charset=UTF-8"}),r=window.URL.createObjectURL(i),n=document.createElement("a");n.href=r,n.download=e,n.click(),window.URL.revokeObjectURL(i)},e.prototype.applyThemeEnvironment=function(e){if(e){var t=Vn.findStyle(e);if(t){if(this.rendererManager._mainRenderer._glowPass)this.rendererManager._mainRenderer._glowPass.strength=t.postEffects.glow.strength,this.rendererManager._mainRenderer._glowPass.radius=t.postEffects.glow.radius;else{var i=this.rendererManager._mainRenderer.compositorManager;i.setParameter||console.error("please update uearth!"),i.setParameter("SmallGlow","Bloom","bloomStrength",t.postEffects.glow.strength,1,"float"),i.setParameter("SmallGlow","Bloom","bloomRadius",t.postEffects.glow.radius,1,"float"),i.setParameter("SmallGlow","HighPass","luminosityThreshold",.2,1,"float");var r=i.getCompositor("Glow");i.setParameter("Glow","Bloom","bloomStrength",1.5,1,"float"),i.setParameter("Glow","Bloom","bloomRadius",.4,1,"float"),i.setParameter("Glow","HighPass","luminosityThreshold",.2,1,"float"),r.changeToRenderBufferTarget||console.error("please update uearth!"),r.changeToRenderBufferTarget(),i.setCompositorEnabled("","","LineBloom",!1)}this._lightGroup.setConfig(t.lighting||ta);var n=this.renderEffects.getConfig().postEffect.vignette,o=this.renderEffects.getConfig().postEffect.blur;this.renderEffects.mergeWithSavedConfig({}).mergeConfig({postEffect:{vignette:n,blur:o}}).update(),this.renderer.capabilities.logarithmicDepthBuffer=!1,this.camera.autoAdjustNear=!0}}},e.prototype.applyTheme=function(e){console.warn("[App] Please use '.applyThemeEnvironment' to replace '.applyTheme'"),this.applyThemeEnvironment(e)},e.prototype.load=function(e,t,i){console.warn("[App] please use loadCampus() instead"),this.loadCampus(e,{successCallback:t,errorCallback:i})},e.prototype.unload=function(e){console.warn("please use unloadCampus() instead"),this.unloadCampus(e)},e.prototype.loadScene=function(e,t,i){console.warn("[App] please use loadCampus() instead"),this.loadCampus(e,{successCallback:t,errorCallback:i})},e.prototype.unloadScene=function(e){console.warn("[App] please use unloadCampus() instead"),this.unloadCampus(e)},e.prototype.showScene=function(e,t){console.warn("[App] please use 'getCampus(url).visible=true/false' instead"),this.sceneManager.showScene(e,t)},e.prototype.saveAsImageData=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpeg",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return console.warn("[App] Please use '.captureScreenshotToImage' to replace '.saveAsImageData'"),this.captureScreenshotToImage(e,t,i,r,n)},e.prototype.saveAsImage=function(e,t,i){console.warn("[App] Please use '.captureScreenshot' to replace '.saveAsImage'"),this.captureScreenshot(e,t,i)},e.prototype.setSkyEffect=function(e){console.warn("[App] Please use '.skyEffect={}' to replace '.setSkyEffect'"),this.skyEffect=e},e.prototype.setLighting=function(e){console.warn("[App] Please use '.lighting={}' to replace '.setLighting'"),this.lighting=e},e.prototype.setPostEffect=function(e,t){console.warn("[App] Please use '.postEffect={}' to replace '.setPostEffect'"),this.postEffect=e},e.prototype.setFog=function(e){console.warn("[App] Please use '.fog={}' to replace '.setFog'"),this.sceneManager.setFog(e)},e.prototype.loadCampus=function(e,t){return console.warn("[App] Please use 'app.create({type: 'Campus' ...}) ' to replace '.loadCampus'"),t=t||{},this.create(ke.mergeObject(t,{type:"Campus",url:e}))},e.prototype.unloadCampus=function(e){console.warn("[App] Please use 'app.query('[url=?']).destroy() ' to replace '.unloadCampus'"),this.query("[url="+e+"]").destroy()},e.prototype.getCampus=function(e){console.warn("[App] Please use 'app.query('[url=?']) ' to replace '.getCampus'");var t=this.query("[url="+e+"]");return t.length?t[0]:null},e.prototype.showGrid=function(e,t,i,r,n){console.warn("[App] Please use 'app.root.showGrid()' to replace '.app.showGrid()'"),this.root.showGrid(e,t,i,r,n)},e.prototype.getGridSize=function(){return console.warn("[App] Please use 'app.root.gridSize' to replace '.app.getGridSize()'"),this.root.gridSize},o(e,[{key:"elapsedTime",get:function(){return Math.floor(1e3*this._elapsedTime)}},{key:"deltaTime",get:function(){return Math.floor(1e3*this._deltaTime)}},{key:"currentFrameCount",get:function(){return this._currentFrame}},{key:"pixelRatio",set:function(e){this._pixelRatio=e,this.renderer.setPixelRatio(e*window.devicePixelRatio)},get:function(){return this._pixelRatio}},{key:"selection",get:function(){return this._selection}},{key:"skyEffect",set:function(e){e?this.sceneManager.setSkyEffect(e):this.sceneManager.closeSkyEffect()},get:function(){var e=this.sceneManager._skyEffect;return e&&e.visible?ke.cloneObject(e.getConfig(),!1):null}},{key:"lighting",set:function(e){e=e||ia,this._lightGroup.setConfig(e)},get:function(){return ke.cloneObject(this._lightGroup.getConfig(),!1)}},{key:"fog",set:function(e){e?this.sceneManager.setFog(e):this.sceneManager.closeFog()},get:function(){return this.sceneManager.fogEnable?ke.cloneObject(this.sceneManager._fogConfig,!1):null}},{key:"postEffect",set:function(e){e?this.renderEffects.mergeConfig(e).update():this.renderEffects.mergeConfig({temporalSuperSampling:{enable:!1},postEffect:{enable:!1}}).update()},get:function(){var e=this.renderEffects.getConfig();return e.temporalSuperSampling.enable||e.postEffect.enable?ke.cloneObject(e,!1):null}},{key:"keepBackgroundAspect",set:function(e){e!==this._keepBackgroundAspect&&(this._keepBackgroundAspect=e,e?this.sceneManager._keepBackgroundAspect():this.sceneManager._resetBackgroundAspect())},get:function(){return!!this._keepBackgroundAspect}},{key:"bgColor",get:function(){return this._bgColor?this._bgColor.toHexString():null},set:function(e){this._bgColor=ke.parseColor(e),this.scene.background.isColor&&(this.scene.background=this._bgColor)}},{key:"background",set:function(e){this.sceneManager.background=e},get:function(){var e=this.sceneManager.background;return ke.isNumber(e)?"#"+e.toString(16).toUpperCase():e}},{key:"backgroundAdditiveColor",set:function(e){this.sceneManager.backgroundAdditiveColor=e},get:function(){return this.sceneManager.backgroundAdditiveColor}},{key:"backgroundColorScaleFactor",set:function(e){this.sceneManager.backgroundColorScaleFactor=e},get:function(){return this.sceneManager.backgroundColorScaleFactor}},{key:"skyBox",set:function(e){this.sceneManager&&(this.sceneManager.skyBox=e)},get:function(){return this.sceneManager?this.sceneManager.skyBox:""}},{key:"needUpdate",set:function(e){e&&(this.picker&&(this.picker.needUpdate=e),this.rendererManager&&(this.rendererManager.needUpdate=e))}},{key:"needEffectUpdate",set:function(e){e&&this.rendererManager&&(this.rendererManager.needUpdate=e)}},{key:"loadingProgressBar",get:function(){return this.mainUI.loadingProgressBar}},{key:"useAsLoader",set:function(e){this._useAsLoader=e},get:function(){return this._useAsLoader}},{key:"skipUnbindAppEvents",set:function(e){this._skipUnbindAppEvents=e},get:function(){return this._skipUnbindAppEvents}},{key:"mainDomElement",get:function(){return this.domElement}},{key:"isMobileDevice",get:function(){return void 0!==this._isMobile?this._isMobile:this._isMobile=we()}},{key:"level",get:function(){return this.sceneLevel}},{key:"root",get:function(){return this.sceneRoot}},{key:"mousePosition",get:function(){return this.events.mousePosition}},{key:"renderOptions",set:function(e){e=e||{},this._renderOptions=e},get:function(){return this._renderOptions}},{key:"campuses",get:function(){return console.warn("[App] The 'app.campuses' will be deleted soon, please use 'app.root.campuses' to replace it"),this.root.campuses}},{key:"buildings",get:function(){return console.warn("[App] The 'app.buildings' will be deleted soon, please use 'app.root.defaultCampus.buildings' to replace it"),this.root.defaultCampus.buildings}},{key:"disableWarning",set:function(e){console.warn("[App] Please use 'Utils.disableWarning' to replace '.disableWarning'"),ke.disableWarning=e}},{key:"disableTime",set:function(e){console.warn("[App] Please use 'Utils.disableTime' to replace '.disableTime'"),ke.disableTime=e}},{key:"isShiftKeyPressed",get:function(){return console.warn("[App] Please use '.isKeyPressed(THING.KeyType.Shift)' to replace '.isShiftKeyPressed'"),this.events.isKeyPressed(F.Shift)}},{key:"isControlKeyPressed",get:function(){return console.warn("[App] Please use '.isKeyPressed(THING.KeyType.Ctrl)' to replace '.isControlKeyPressed'"),this.events.isKeyPressed(F.Ctrl)}},{key:"isAltKeyPressed",get:function(){return console.warn("[App] Please use '.isKeyPressed(THING.KeyType.Alt)' to replace '.isAltKeyPressed'"),this.events.isKeyPressed(F.Alt)}},{key:"isMobile",get:function(){return console.warn("[App] Please use '.isMobileDevice' to replace '.isMobile'"),this.isMobileDevice}},{key:"wireframeColor",set:function(e){return console.warn("[App] Please use '.app.root.wireframeColor' to replace '.wireframeColor'"),this.root.wireframeColor=e}},{key:"domOffset",set:function(e){console.warn("[App] domOffset is deprecated")}},{key:"cache",get:function(){return console.warn("[App] cache is deprecated"),!1}},{key:"outdoors",set:function(e){},get:function(){return this.root?this.root.defaultCampus.outdoors:null}},{key:"loadingProgressBarVisible",set:function(e){console.warn("[App] Please use '.loadingProgressBar.visible = true/false' to replace '.loadingProgressBarVisible=true/false'"),this.mainUI.loadingProgressBar.visible=e},get:function(){return console.warn("[App] Please use '.loadingProgressBar.visible' to replace '.loadingProgressBarVisible'"),this.mainUI.loadingProgressBar.visible}},{key:"currentFrame",get:function(){return console.warn("[App] Please use '.currentFrameCount' to replace '.currentFrame'"),this.currentFrameCount}}]),e}();el.on=el.on||{};var tl=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype._init=function(t,i){e.prototype._init.call(this,t,i),this.node.userData.baseObject_bindSubNode=this},t.prototype._updateBindSubNodeState=function(){this.node.userData.baseObject_bindSubNode_hooked=this.hasAnyEvents()},t.prototype._on=function(t,i,r,n,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:51,s=e.prototype._on.call(this,t,i,r,n,o,a);return this._updateBindSubNodeState(),s},t.prototype._off=function(t,i,r){var n=e.prototype._off.call(this,t,i,r);return this._updateBindSubNodeState(),n},t.prototype._one=function(t,i,r,n,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:51,s=e.prototype._one.call(this,t,i,r,n,o,a);return this._updateBindSubNodeState(),s},t.prototype.canAcceptEvent=function(t){if(e.prototype.canAcceptEvent.call(this,t))return!0;var i=t.intersect;return!(!i||!i.node||i.node!=this.node)},t}(bt);tl.create=function(e,t){var i=new tl(t.app);return i._init(e,t),i};var il={private:Symbol("private")};var rl=new THREE.Vector3,nl=new THREE.Vector3,ol={};function al(e,t){if("string"!=typeof e)throw new TypeError("expected path to be a string");if("\\"===e||"/"===e)return"/";var i=e.length;if(i<=1)return e;var r="";if(i>4&&"\\"===e[3]){var n=e[2];"?"!==n&&"."!==n||"\\\\"!==e.slice(0,2)||(e=e.slice(2),r="//")}var o=e.split(/[/\\]+/);return!1!==t&&""===o[o.length-1]&&o.pop(),r+o.join("/")}ol.WHITE=16777215,ol.SILVER=12632256,ol.GRAY=8421504,ol.BLACK=0,ol.RED=16711680,ol.MAROON=8388608,ol.GREEN=32768,ol.BLUE=255,ol.NAVY=128,ol.YELLOW=16776960,ol.OLIVE=8421376,ol.FUCHSIA=16711935,ol.MAGENTA=16711935,ol.LIME=914021,ol.PURPLE=8388736,ol.LAWN=3135031,ol.AQUA=65535,ol.CYAN=65535,ol.TEAL=32896,ol.ORANGE=16753920,ol.VIOLET=7737555,ol.GREENYELLOW=6617095,ol.createFrustumFOV=function(e,t,i,r){var n=i*Math.tan(THING.Math.degToRad(e)/2),o=-n,a=t*n,s=-a;return ol.createFrustum(a,s,n,o,i,r)},ol.createFrustum=function(e,t,i,r,n,o){var a=new THREE.Geometry,s=new THREE.LineBasicMaterial({color:16777215,linewidth:3,vertexColors:THREE.FaceColors}),l=o/n,u={ltn:new THREE.Vector3(e,i,n),lbn:new THREE.Vector3(e,r,n),rbn:new THREE.Vector3(t,r,n),rtn:new THREE.Vector3(t,i,n),ltf:new THREE.Vector3(l*e,l*i,o),lbf:new THREE.Vector3(l*e,l*r,o),rbf:new THREE.Vector3(l*t,l*r,o),rtf:new THREE.Vector3(l*t,l*i,o)};function c(e,t,i){h(e,i),h(t,i)}function h(e,t){var i=new THREE.Vector3;i.copy(u[e]),a.vertices.push(i),a.colors.push(new THREE.Color(t))}return c("ltn","lbn",ol.RED),c("lbn","rbn",ol.RED),c("rbn","rtn",ol.RED),c("rtn","ltn",ol.RED),c("ltf","lbf",ol.LIME),c("lbf","rbf",ol.LIME),c("rbf","rtf",ol.LIME),c("rtf","ltf",ol.LIME),c("ltf","ltn",ol.BLUE),c("lbf","lbn",ol.BLUE),c("rbf","rbn",ol.BLUE),c("rtf","rtn",ol.BLUE),new THREE.Line(a,s,THREE.LinePieces)},String.prototype.getNormalize=function(){var e=this.indexOf("://");return-1!==e?this.substring(0,e+3)+al(this.substring(e+3)):al(this.substring())},String.prototype.startsWith=function(e){return this.slice(0,e.length)===e},String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)},String.prototype.contains=function(e){return this.indexOf(e)>=0},String.prototype.isBlank=function(){return ke.isBlank(this)},String.prototype.getFileName=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");if(-1===t)return e?this:this.split(".")[0];var i=this.substring(t);return 0!==i.indexOf("\\")&&0!==i.indexOf("/")||(i=i.substring(1)),e?i:i.split(".")[0]},String.prototype.getPath=function(){var e=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");return this.substring(0,e)},String.prototype.getSearchName=function(){var e=this.getFileName(),t=e.indexOf("?");return-1===t?"":e.substring(t)},String.prototype.getExtension=function(){var e=this.split(".");if(e.length>1){var t=e.pop(),i=t.indexOf("?");return-1!==i?t.substring(0,i):t}return""},String.prototype._trimLeft=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("^["+e+"]+"),"")},String.prototype._trimRight=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("["+e+"]+$"),"")},String.prototype.trimBoth=function(e){return this._trimLeft(e)._trimRight(e)},String.prototype.appendPath=function(e){return this._trimRight("/")+"/"+e._trimLeft("/")._trimRight("/")},String.prototype.appendRandomSuffix=function(){return this.substring()+"?t="+(new Date).getTime()},String.prototype.equals=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return null!=e&&(t?this.toUpperCase()==e.toUpperCase():this==e)},String.prototype.replaceAll=function(e,t){return"\\"==e&&(e="\\\\"),this.replace(new RegExp(e,"gm"),t)},String.prototype.removeAt=function(e){var t=this.substring(0);return e>=this.length?t:t.slice(0,e)+t.slice(e+1)},THREE.Color.prototype.copy=function(e){return e&&(this.r=e.r,this.g=e.g,this.b=e.b),this},THREE.Color.prototype.toHexString=function(){return"#"+this.getHexString().toUpperCase()},THREE.Color.prototype.toRGBArray=function(){var e=[];return e.push(Math.ceil(255*this.r)),e.push(Math.ceil(255*this.g)),e.push(Math.ceil(255*this.b)),e},THREE.Line.prototype.updatePosition=function(e,t){var i=this.geometry.vertices;if(2==i.length){var r=i[0],n=i[1];r.equals(e)&&n.equals(t)||(r.x=e.x,r.y=e.y,r.z=e.z,n.x=t.x,n.y=t.y,n.z=t.z,this.geometry.boundingSphere=null,this.geometry.verticesNeedUpdate=!0,this.computeLineDistances())}};var sl=function(){var e=THING.App.current?THING.App.current.level.current:null;return e?e._getBaseMatrix():null};THREE.Vector3.prototype.getPositionFromSpherical=function(e,t,i){var r=new THREE.Vector3,n=Math.sin(i);return r.x=n*Math.cos(t),r.y=-Math.cos(i),r.z=n*Math.sin(t),r.normalize(),r.multiplyScalar(e),r.add(this),r},THREE.Vector3.prototype.getDirectionFromAngles=function(e,t,i){var r=ke.parseVector3(THING.Math.directionFromAlphaBeta(e,t));return r.normalize(),r.multiplyScalar(i),r.add(this),r},THREE.Vector3.prototype.getDirectionFromPosition=function(e,t){var i=new THREE.Vector3;return i.subVectors(e,this),i.normalize(),i.multiplyScalar(t),i.add(this),i},THREE.Vector3.prototype.getMinVector=function(e){var t=this.clone();if(ke.isArray(e))for(var i=0;i<e.length;i++)t.min(e[i]);else t.min(e);return t},THREE.Vector3.prototype.getMaxVector=function(e){var t=this.clone();if(ke.isArray(e))for(var i=0;i<e.length;i++)t.max(e[i]);else t.min(e);return t},THREE.Vector3.prototype.toLogString=function(){return"x: "+this.x+", y: "+this.y+", z: "+this.z},THREE.Vector3.prototype.isEqual=function(e){return!!ke.isEqual(this.x,e.x)&&(!!ke.isEqual(this.y,e.y)&&!!ke.isEqual(this.z,e.z))},THREE.Vector3.prototype.log=function(){console.log(this.toLogString())},THREE.Vector4.prototype.project=function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},THREE.Vector4.prototype.unproject=function(e){var t=new THREE.Matrix4;return this.applyMatrix4(t.getInverse(e.projectionMatrix)).applyMatrix4(e.matrixWorld)},THREE.Object3D.prototype.dispose=function(){var e=this.parent;e&&e.remove(this),this.traverse((function(e){e.geometry&&e.geometry.dispose();var t=e.material;if(t)if(ke.isArray(t))for(var i=0;i<t.length;i++)t[i].dispose();else t.dispose();e.skeleton&&e.skeleton.boneTexture&&e.skeleton.boneTexture.dispose()}))},THREE.Object3D.prototype.getVerticesCount=function(){var e=0;return this.traverse((function(t){t.geometry&&(e+=t.geometry.getVerticesCount())})),e},THREE.Object3D.prototype.getDirection=function(e){var t=this.matrix.elements;return e.set(t[8],t[9],t[10]).normalize()},THREE.Object3D.prototype._premultiplyMatrix=function(e){this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},THREE.Object3D.prototype._mergeAllGeometries=function(){this.updateMatrixWorld();var e=new THREE.Geometry;return this.traverse((function(t){if(t.isMesh){var i=t.geometry;i.isBufferGeometry&&(i=(new THREE.Geometry).fromBufferGeometry(i)),e.merge(i,t.matrixWorld)}})),e},THREE.Object3D.prototype._getMatrixWorld=function(){var e=this.matrixWorld,t=sl();return t&&(e=e.clone()).premultiply(t),e},THREE.Object3D.prototype.getBaseObjectOwner=function(){for(var e=this;e;e=e.parent){var t=e.userData.object;if(t)return t}return null};var ll=THREE.Object3D.prototype.copy;THREE.Object3D.prototype.copy=function(e,t){return ll.call(this,e,t),this.technique=ke.cloneObject(e.technique),e._wName&&(this._wName=e._wName),this},THREE.Object3D.prototype.setUserDataValue=function(e,t){this.traverse((function(i){i.userData[e]=t}))},THREE.Object3D.prototype.isMaterialVisible=function(){var e=this.material;if(!e)return!1;if(void 0!==e.length){for(var t=0;t<e.length;t++)if(e[0].visible)return!0;return!1}return e.visible},THREE.Object3D.prototype.isRenderable=function(){return!!(this.isSprite||this.isMesh||this.isLine||this.isPoints||this.isImmediateRenderObject)},THREE.Object3D.prototype.cleanup=function(){function e(e){return!e.children.length}function t(i){for(var r=0,n=0;n<i.children.length;n++){var o=i.children[n];o.isRenderable()||(e(o)?(o.parent=null,i.children.splice(n--,1),r++):r+=t(o))}return r}for(;;){if(!t(this))break}},THREE.Object3D.prototype.onBeforeUpdateModelViewMatrix=function(e,t,i,r,n,o){},THREE.Object3D.prototype.hasBeforeRenderFunction=function(e){if(!this._beforeRenderFunctions)return!1;for(var t=0;t<this._beforeRenderFunctions.length;t++){if(this._beforeRenderFunctions[t].name==e)return!0}return!1},THREE.Object3D.prototype.addBeforeRenderFunction=function(e,t,i){if(t&&(this.traverseChild((function(r){r.isRenderable()&&r.addBeforeRenderFunction(e,t,i)})),this._beforeRenderFunctions=this._beforeRenderFunctions||[],void 0!==i&&this._beforeRenderFunctions.length?this._beforeRenderFunctions.splice(i,0,{name:e,func:t}):this._beforeRenderFunctions.push({name:e,func:t}),1===this._beforeRenderFunctions.length)){var r=this.onBeforeRender;r&&"function () {}"!=r.toString()&&this._beforeRenderFunctions.splice(0,0,{name:"__originalBeforeRender__",func:r});var n=this;this.onBeforeRender=function(e,t,i,r,o,a){for(var s=0,l=n._beforeRenderFunctions.length;s<l;s++){n._beforeRenderFunctions[s].func.call(n,e,t,i,r,o,a)}}}},THREE.Object3D.prototype.removeBeforeRenderFunction=function(e){this.traverseChild((function(t){t.isRenderable()&&t.removeBeforeRenderFunction(e)})),this._beforeRenderFunctions=this._beforeRenderFunctions||[];for(var t=0;t<this._beforeRenderFunctions.length;t++){var i=this._beforeRenderFunctions[t];(ke.isFunction(e)?i.func:i.name)==e&&this._beforeRenderFunctions.splice(t--,1)}this._beforeRenderFunctions.length||(this.onBeforeRender=function(e,t,i){})},THREE.Object3D.prototype.setPickable=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.userData.skipPick=!e,t&&this.traverse((function(t){var i=t.userData;e?delete i.skipPick:i.skipPick=!0}))},THREE.Object3D.prototype.getPickable=function(){return!this.userData.skipPick},THREE.Object3D.prototype.showAll=function(){for(var e=this;e;)e.visible=!0,e=e.parent;this.getNodes().forEach((function(e){e.ensureVisible(!0,!0)}))},THREE.Object3D.prototype.setLayerVisible=function(e){e?this.layers.enable(0):this.layers.disable(0)},THREE.Object3D.prototype.getLayerVisible=function(){return!!(1&this.layers.mask)},THREE.Object3D.prototype.isVisible=function(){for(var e=this;e;e=e.parent)if(!e.visible)return!1;return this.getVisible()},THREE.Object3D.prototype.ensureParentsVisible=function(e){this.traverseParents((function(t){t.visible=e}))},THREE.Object3D.prototype.ensureVisible=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===e){if(this.userData.useVisibleOnly)return this.visible;for(var i=this;i;i=i.parent)if(!i.visible)return!1;return this.getLayerVisible()}if(!ke.isBoolean(e)){var r=this.userData;if(!r.alwaysPickable)for(var n=this;n;){if(!n.visible)return!1;if(e&&!n.layers.test(e.layers))return!1;n=n.parent}return!0}var o=e;this.userData.useVisibleOnly?this.visible=o:(this.setLayerVisible(o),t&&(this.visible=o))},THREE.Object3D.prototype.getVisible=function(){return this.ensureVisible()},THREE.Object3D.prototype.getTypeString=function(){return this.isSprite?"Sprite":this.isMesh?"Mesh":this.isLine?"Line":this.isPoints?"Points":this.isScene?"Scene":this.isGroup?"Group":"Object3D"},THREE.Object3D.prototype.getObjectByUUID=function(e){var t=null;return this.traverseBranch((function(i){if(i.uuid==e)return t=i,!1})),t},THREE.Object3D.prototype.setActive=function(e){this.visible=e},THREE.Object3D.prototype.getActive=function(){return this.visible},THREE.Object3D.prototype.traverseParents=function(e){if(e)for(var t=this.parent;t;t=t.parent)e(t)},THREE.Object3D.prototype.traverseChild=function(e){for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverse(e)},THREE.Object3D.prototype.traverseBreakable=function(e){if(e(this))return this;for(var t=this.children,i=0,r=t.length;i<r;i++){var n=t[i].traverseBreakable(e);if(n)return n}return null},THREE.Object3D.prototype.traverseBranch=function(e){if(!1!==e(this))for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseBranch(e)},THREE.Object3D.prototype.traverseAll=function(e){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseAll(e)},THREE.Object3D.prototype.traverseRenderableNodes=function(e){this.traverse((function(t){t.isRenderable()&&e(t)}))},THREE.Object3D.prototype.getRoot=function(){var e=this.parent;if(!e)return this;for(;e.parent;)e=e.parent;return e},THREE.Object3D.prototype.indexOf=function(e){return e?this.children.indexOf(e):-1},THREE.Object3D.prototype.indexOfParent=function(){var e=this.parent;if(e)return e.children.indexOf(this)},THREE.Object3D.prototype.isChildOf=function(e){for(var t=this.parent;t;){if(t==e)return!0;t=t.parent}return!1},THREE.Object3D.prototype.getChildIndex=function(e){for(var t=0;t<this.children.length;t++)if(this.children[t]==e)return t;return-1},THREE.Object3D.prototype.getIndexPath=function(e){for(var t=[],i=this;i.parent;){var r=i.parent,n=r.getChildIndex(i);if(-1==n)break;if(t.push(n),r==e)break;i=r}return t},THREE.Object3D.prototype.getChildNodeByIndexPath=function(e){for(var t=this,i=0;i<e.length;i++){var r=e[i];if(r>=t.children.length)return null;t=t.children[r]}return t},THREE.Object3D.prototype.getChildNodesNumber=function(){var e=0;return this.traverse((function(){e++})),e},THREE.Object3D.prototype.getBones=function(e,t){for(var i=[],r=0;r<t.bones.length;r++){for(var n=t.bones[r].getIndexPath(e),o=this,a=n.length-1;a>=0;a--){var s=n[a];o=o.children[s]}i.push(o)}return i},THREE.Object3D.prototype._detachFromParent=function(e,t){this.applyMatrix(e.matrixWorld),e.remove(this),t.add(this)},THREE.Object3D.prototype._attachToParent=function(e,t){this.applyMatrix((new THREE.Matrix4).getInverse(t.matrixWorld)),e&&e.remove(this),t.add(this)},THREE.Object3D.prototype.attachToParent=function(e,t,i){void 0===t?t=e:ke.isBoolean(t)&&(i=t,t=e),this.parent&&(i&&this.updateWorldMatrix(!0,!1),this._detachFromParent(this.parent,t)),e&&(i&&e.updateWorldMatrix(!0,!1),this._attachToParent(t,e))},THREE.Object3D.prototype.detachFromParent=function(e){this.parent.updateMatrixWorld(),this._detachFromParent(this.parent,e)},THREE.Object3D.prototype.attachChildren=function(e,t){this.updateMatrixWorld();for(var i=0;i<e.length;i++)THREE.SceneUtils.attach(e[i],t,this)},THREE.Object3D.prototype.detachChildren=function(e){this.updateMatrixWorld();for(var t=this.children.concat(),i=0;i<t.length;i++){t[i]._detachFromParent(this,e)}return t},THREE.Object3D.prototype.getChildrenNames=function(){var e=[];return this.traverse((function(t){t.name.isBlank()||e.push(t.name)})),e},THREE.Object3D.prototype.getVisibleChildrenNumber=function(){var e=0;return this.traverse((function(t){t.visible&&e++})),e},THREE.Object3D.prototype.getInvisibleChildrenNumber=function(){var e=0;return this.traverse((function(t){t.visible||e++})),e},THREE.Object3D.prototype.getParents=function(){for(var e=[],t=this.parent;t;t=t.parent)e.push(t);return e},THREE.Object3D.prototype.getInvalidNodes=function(){var e=[];return this.traverse((function(t){var i=t.scale;0!=i.x&&0!=i.y&&0!=i.z||e.push(t)})),e},THREE.Object3D.prototype.getGeometries=function(){var e=new Set;return this.traverse((function(t){var i=t.geometry;i&&e.add(i)})),Array.from(e)},THREE.Object3D.prototype.getVisibleMeshes=function(){var e=[];return this.traverse((function(t){t.isMesh&&t.ensureVisible()&&e.push(t)})),e},THREE.Object3D.prototype.getMeshes=function(){var e=[];return this.traverse((function(t){t.isMesh&&e.push(t)})),e},THREE.Object3D.prototype.getSprites=function(){var e=[];return this.traverse((function(t){t.isSprite&&e.push(t)})),e},THREE.Object3D.prototype.getRenderableNodes=function(){var e=[];return this.traverse((function(t){t.isRenderable()&&e.push(t)})),e},THREE.Object3D.prototype.getTextures=function(){for(var e=this.getMaterials(),t=new Set,i=0;i<e.length;i++)for(var r=e[i],n=Object.keys(r),o=0;o<n.length;o++){var a=n[o];if(!a.startsWith("_")){var s=r[a];s&&s.isTexture&&!t.has(s)&&t.add(s)}}return Array.from(t)},THREE.Object3D.prototype.getImages=function(){for(var e=this.getTextures(),t=new Set,i=0;i<e.length;i++)for(var r=e[i],n=Object.keys(r),o=0;o<n.length;o++){var a=r[n[o]];a&&a.src&&a.width&&a.height&&!t.has(a)&&t.add(a)}return Array.from(t)},THREE.Object3D.prototype.getTexturesFromImage=function(e){for(var t=[],i=this.getTextures(),r=0;r<i.length;r++){var n=i[r];n.image==e&&t.push(n)}return t},THREE.Object3D.prototype.getTexturesFromURL=function(e){for(var t=[],i=this.getTextures(),r=0;r<i.length;r++){var n=i[r];n.image.currentSrc==e&&t.push(n)}return t},THREE.Object3D.prototype.traverseMaterials=function(e){this.traverse((function(t){var i=t.material;if(i)if(ke.isArray(i))for(var r=0;r<i.length;r++)e(i[r]);else e(i)}))},THREE.Object3D.prototype.traverseTextures=function(e){this.traverse((function(t){var i=t.material;if(i)if(ke.isArray(i))for(var r=0;r<i.length;r++)for(var n in i[r]){(o=i[r][n])&&o.isTexture&&e(i[r],n,o)}else for(var n in i){var o;(o=i[n])&&o.isTexture&&e(i,n,o)}}))},THREE.Object3D.prototype.getMaterials=function(){var e=new Set;return this.traverse((function(t){var i=t.material;if(i)if(ke.isArray(i))for(var r=0;r<i.length;r++)e.add(i[r]);else e.add(i)})),Array.from(e)},THREE.Object3D.prototype.getMeshByName=function(e){var t=null;return this.traverseBreakable((function(i){if(i.isMesh&&i.name==e)return t=i,!0})),t},THREE.Object3D.prototype.hasMesh=function(){var e=!1;return this.traverseBreakable((function(t){if(t.isMesh)return e=!0})),e},THREE.Object3D.prototype.getMeshNames=function(){var e=[];return this.traverse((function(t){t.isMesh&&e.push(t.name)})),e},THREE.Object3D.prototype.getSkinnedMeshes=function(){var e=[];return this.traverse((function(t){t.isSkinnedMesh&&e.push(t)})),e},THREE.Object3D.prototype.hasSkinnedMesh=function(){var e=!1;return this.traverseBreakable((function(t){if(t.isSkinnedMesh)return e=!0})),e},THREE.Object3D.prototype.hasSprite=function(){var e=!1;return this.traverseBreakable((function(t){if(t.isSprite)return e=!0})),e},THREE.Object3D.prototype.hasMaterial=function(e){if(!e)return!1;var t=!1;return this.traverseBreakable((function(i){if(i.material==e)return t=!0})),t},THREE.Object3D.prototype.hasGeometry=function(e){if(!e)return!1;var t=!1;return this.traverseBreakable((function(i){if(i.geometry==e)return t=!0})),t},THREE.Object3D.prototype.hasTexture=function(e){if(!e)return!1;function t(t){for(var i=Object.keys(t),r=0;r<i.length;r++){var n=t[i[r]];if(n&&n.isTexture&&n==e)return!0}return!1}var i=!1;return this.traverseBreakable((function(e){var r=e.material;if(r)if(ke.isArray(r)){if(t(r))return i=!0}else if(t(r))return i=!0})),i},THREE.Object3D.prototype.replace=function(e,t,i){if(t&&t.isObject3D)for(var r=0;r<this.children.length;r++){var n=this.children[r];if(n==e){i&&i(n),n=void 0,t.parent=this,this.children[r]=t;break}}},THREE.Object3D.prototype.insert=function(e,t){e>this.children.length||t&&(this.children.splice(e,0,t),t.parent=this)},THREE.Object3D.prototype.removeBySelf=function(){this.parent&&this.parent.remove(this)},THREE.Object3D.prototype.getAngles=function(){return ke.parseAngles(this.rotation)},THREE.Object3D.prototype.setAngles=function(e){var t=ke.parseEuler(e);this.rotation.copy(t),this.updateMatrixWorld(!1,!1)},THREE.Object3D.prototype.getFacesNumber=function(){var e=0;return this.traverse((function(t){if(t.isMesh){var i=t.geometry;if(i.isBufferGeometry){var r=i.index;e+=r?r.count/3:i.attributes.position.count/3}else i.isGeometry&&(e+=i.faces.length)}})),e},THREE.Object3D.prototype.getVerticesNumber=function(){var e=0;return this.traverse((function(t){if(t.isMesh){var i=t.geometry;if(i.isBufferGeometry){var r=i.index;e+=r?i.index.count:i.attributes.position.count}else i.isGeometry&&(e+=i.vertices.length)}})),e},THREE.Object3D.prototype.getNodes=function(){var e=[];return this.traverse((function(t){e.push(t)})),e},THREE.Object3D.prototype.getNodeByID=function(e){var t;return this.traverseBreakable((function(i){if(i.id==e)return t=i,!0})),t},THREE.Object3D.prototype.getNodeByUUID=function(e){var t;return this.traverseBreakable((function(i){if(i.uuid==e)return t=i,!0})),t},THREE.Object3D.prototype.setTransform=function(e){var t=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Quaternion;e.decompose(t,r,i),this.quaternion.copy(r),this.position.copy(t),this.scale.copy(i)},THREE.Object3D.prototype.getDistanceFromCamera=function(e){if(this.parent){this.updateWorldMatrix(!0);var t=new THREE.Vector3;return this.getWorldPosition(t),e.distanceTo(t)}},THREE.Object3D.prototype.keepSize=function(e,t,i,r,n){if(this.parent){r&&this.updateWorldMatrix(!0,!1);var o=new THREE.Vector3;o.setFromMatrixPosition(this.matrixWorld);var a=e.sub(o).length();if(t.isVector2){var s=[i/t.x,i/t.y];this.scale.set(a/s[0],a/s[1],1)}else if(t.isVector3){s=[i/t.x,i/t.y,i/t.z];this.scale.set(a/s[0],a/s[1],a/s[2])}n&&this._synMatrixWorld()}},THREE.Object3D.prototype._synMatrixWorld=function(){this.updateWorldMatrix(!0,!0)},THREE.Object3D.prototype._getWorldPosition=function(e){return void 0===e&&(e=new THREE.Vector3),e.setFromMatrixPosition(this._getMatrixWorld())},THREE.Object3D.prototype._setWorldPosition=function(e,t,i){var r=e;this.parent&&(t&&this.parent.updateMatrixWorld(),r=this.parent.worldToLocal(e)),this.position.set(r.x,r.y,r.z),i&&this._synMatrixWorld()},THREE.Object3D.prototype._setWorldAngles=function(e,t){for(var i=this.parent;i;i=i.parent){var r=ke.parseQuaternion(i.rotation);r.inverse(),e.premultiply(r)}var n=ke.parseEuler(e);this.rotation.copy(n),t&&this._synMatrixWorld()},THREE.Object3D.prototype._setWorldScale=function(e,t){for(var i=this.parent;i;i=i.parent)e.divide(i.scale);this.scale.copy(e),t&&this._synMatrixWorld()},THREE.Object3D.prototype._getWorldScale=function(){this.updateWorldMatrix(!0,!1);var e=new THREE.Vector3,t=new THREE.Quaternion,i=new THREE.Vector3;return this.matrixWorld.decompose(e,t,i),i},THREE.Object3D.prototype.cloneByFilter=function(e){for(var t=this.clone(!1),i=0;i<this.children.length;i++){var r=this.children[i];if(!e||e(r)){var n=r.cloneByFilter(e);t.add(n)}}return t},THREE.Object3D.prototype.getForwardPosition=function(e){var t=new THREE.Vector3;return this.updateMatrixWorld(!0),this.getWorldDirection(t),t.normalize(),t.multiplyScalar(e),t.add(this.position),t},THREE.Object3D.prototype._faceTo=function(e){var t=this.worldToLocal(e.clone()),i=(new THREE.Vector3).crossVectors(new THREE.Vector3(0,0,1),t).normalize(),r=new THREE.Vector3(0,0,1).angleTo(t.normalize().clone());this.rotateOnAxis(i,r)},THREE.Object3D.prototype._lookAtPosition=function(e,t){var i=(e=e||{}).type,r=e.axis,n=e.quat,o=e.target,a=e.targetPosition,s=e.targetLocalPosition;if("axis"==i&&"y"==r){e.billboard&&(this.rotation.x=0,this.rotation.z=0);var l=this.position;if(o&&o.isCameraController){var u=ke.parseVector3(a),c=new THREE.Vector3;this.getWorldPosition(c);var h=o.direction,p=c.clone().sub(u).projectOnPlane(ke.parseVector3(h));p.add(u),this.parent&&this.parent.worldToLocal(p),this.rotation.y=Math.atan2(p.x-l.x,p.z-l.z)}else this.rotation.y=Math.atan2(s.x-l.x,s.z-l.z)}else this.isCamera||!o||o.isCameraController||this.up.copy(new THREE.Vector3(0,1,0).transformDirection(this.matrixWorld)),this.lookAt(a),"axis"==i&&("x"==r?this.rotateY(-Math.PI/2):"z"==r&&this.rotateX(-Math.PI/2));n&&this.quaternion.multiply(n),t?this._synMatrixWorld():this.updateWorldMatrix(!1,!1)},THREE.Object3D.prototype._lookAt=function(e,t){if(this.removeBeforeRenderFunction("__lookAt__"),e){var i=this;this.addBeforeRenderFunction("__lookAt__",(function(r,n,o,a,s,l){var u=e.targetPosition||o;u.isObject3D&&(u=u.position),e.targetPosition=u,e.target={direction:o.getDirection(new THREE.Vector3),isCameraController:!0},i._lookAtPosition(e,ke.isFunction(t)?t():t)}))}},THREE.Object3D.prototype.skipBoundingBox=function(e){this.traverse((function(t){e?t.userData.skipBoundingBox=e:delete t.userData.skipBoundingBox}))},THREE.Object3D.prototype.setFrustumCulled=function(e){this.traverse((function(t){t.frustumCulled=e}))},THREE.Object3D.prototype.getMatrixWorldFromRoot=function(e){this.updateWorldMatrix(!0);var t=new THREE.Matrix4;if(e)for(var i=this;;){if(i==e){t.premultiply(i.matrixWorld);break}t.premultiply(i.matrix),i=i.parent}return t},THREE.Object3D.prototype.getMatrixFromRoot=function(e){var t=new THREE.Matrix4;if(e)for(var i=this;i!=e;)t.premultiply(i.matrix),i=i.parent;return t},THREE.Object3D.prototype.disposeMaterial=function(){if(this.material){if(ke.isArray(this.material))for(var e=0;e<this.material.length;e++){this.material[e].dispose()}else this.material.dispose();this.material=null}},THREE.Matrix4.prototype.setScale=function(e){var t=this.elements;return t[0]=e.x,t[5]=e.y,t[10]=e.z,this},THREE.Euler.prototype.multiplyMatrix4=function(e){var t=new THREE.Quaternion;t.setFromEuler(this);var i=new THREE.Quaternion;i.setFromRotationMatrix(e),t.multiply(i),this.setFromQuaternion(t)},THREE.Euler.prototype.setRotationOrder=function(e){var t=new THREE.Quaternion;t.setFromEuler(this,!1),this.setFromQuaternion(t,e,!0)},THREE.Quaternion.prototype.multiplyMatrix4=function(e){var t=new THREE.Quaternion;t.setFromRotationMatrix(e),this.multiply(t)},THREE.Quaternion.prototype.getAngles=function(){return ke.parseAngles(this)},THREE.Frustum.prototype._intersectsObject=function(e){var t=this;return e=e.traverseBreakable((function(e){return e.isMesh&&t.intersectsObject(e)?e:null}))},THREE.PerspectiveCamera.prototype.orthoSize=function(e,t){var i=ke.parseVector3(t),r=e.distanceTo(i),n=2*Math.tan(this.fov/2*Math.PI/180),o=n*r;return{x:o*this.aspect,y:o,depth:n,z:r}},THREE.OrthographicCamera.prototype.orthoSize=function(){return{x:(this.right-this.left)/this.zoom,y:(this.top-this.bottom)/this.zoom}},THREE.OrthographicCamera.prototype.resize=function(e,t){if(void 0!==this.userData){var i=this.userData.depth*this.userData.z,r=i*(e/t);this.left=-r/2,this.right=r/2,this.top=i/2,this.bottom=-i/2,this.updateProjectionMatrix()}},Object.defineProperty(THREE.CombinedCamera.prototype,"isPerspectiveCamera",{get:function(){return this.inPerspectiveMode}}),Object.defineProperty(THREE.CombinedCamera.prototype,"isOrthographicCamera",{get:function(){return this.inOrthographicMode}}),Object.defineProperty(THREE.CombinedCamera.prototype,"isLerping",{get:function(){return this.isPerspectiveLerping||this.isOrthoLerping}}),THREE.CombinedCamera.prototype.setNear=function(e){this.cameraP.near=e,this.cameraO.near=e,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.setFar=function(e){this.cameraP.far=e,this.cameraO.far=e,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.getProjectionMatrixAlways=function(){return this._backupProjectionMatrix&&(this.isOrthoLerping||this.isOrthographicCamera)?this._backupProjectionMatrix:this.projectionMatrix},THREE.CombinedCamera.prototype.toPerspectiveCamera=function(){var e=new THREE.CombinedCamera(1,1,1,1,1,1,1);return e.fov=this.fov,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.cameraO=new THREE.OrthographicCamera(1,1,1,1,1,1),e.cameraO.copy(this.cameraO),e.cameraP=new THREE.PerspectiveCamera(1,1,1,1),e.cameraP.copy(this.cameraP),e.zoom=this.zoom,e.toPerspective(),e},THREE.CombinedCamera.prototype.toOrthoCamera=function(e,t){var i=this.cameraP.orthoSize(e,t),r=new THREE.CombinedCamera(i.x,i.y,this.fov,this.near,this.far,this.cameraO.near,this.cameraO.far);return r.orthoSize=i,r.toOrthographic(),r},THREE.CombinedCamera.prototype.lerpMatrix=function(e){var t=(e=e||{}).fromMatrix,i=e.toMatrix,r=e.time,n=e.lerpType||A.Quintic.Out,o=e.start,a=e.stop,s=e.complete,l=ke.toMatrixElementsArray(t),u=ke.toMatrixElementsArray(i);this.matrixTween&&this.matrixTween.stop(),this.matrixTween=new TWEEN.Tween(l).to(u,r).easing(n).onStart((function(){o&&o()})).onUpdate((function(){ke.elementsArrayToMatrix(t,this._object)})).onStop((function(){a&&a()})).onComplete((function(){s&&s()})).start()},THREE.CombinedCamera.prototype.lerpToOrthographic=function(e,t,i,r){var n=this.toOrthoCamera(e,t);this.orthoSize=n.orthoSize,this.zoom=1,this.isOrthoLerping=!0,this._backupProjectionMatrix=this.projectionMatrix.clone();var o=this;this.lerpMatrix({lerpType:A.Cubic.InOut,fromMatrix:this.projectionMatrix,toMatrix:n.projectionMatrix,time:i,stop:function(){o.isOrthoLerping=!1,r&&r()},complete:function(){o.isOrthoLerping=!1,o.toOrthographic(),r&&r()}})},THREE.CombinedCamera.prototype.lerpToPerspective=function(e,t){var i=this.toPerspectiveCamera();this.isPerspectiveLerping=!0;var r=this;this.lerpMatrix({fromMatrix:this.projectionMatrix,toMatrix:i.projectionMatrix,time:e,stop:function(){r.isPerspectiveLerping=!1,t&&t()},complete:function(){r.isPerspectiveLerping=!1,r.toPerspective(),t&&t()}})},THREE.CombinedCamera.prototype.getEffectiveFOV=function(){return this.cameraP.getEffectiveFOV()},THREE.CombinedCamera.prototype.isInView=function(e){var t=new THREE.Matrix4;t.multiplyMatrices(this.projectionMatrix,this.matrixWorldInverse);var i=new THREE.Frustum;return i.setFromMatrix(t),i.intersectsBox(e)},THREE.CombinedCamera.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&this.matrixWorld.copy(this.matrix);var t=sl();t&&this.matrixWorld.premultiply(t),this.matrixWorldInverse.getInverse(this.matrixWorld)},THREE.Mesh.prototype.verticesCount=function(){return this.geometry?this.geometry.isBufferGeometry?this.geometry.attributes.position.count:this.geometry.vertices.length:0},THREE.Mesh.prototype.simplify=function(e){var t=THING.Math.clamp(e,0,1),i=new THREE.SimplifyModifier,r=this.geometry;r instanceof THREE.BufferGeometry&&(r=(new THREE.Geometry).fromBufferGeometry(r)),r.mergeVertices();var n=THING.Math.toInteger(r.vertices.length*(1-t)),o=i.modify(r,n);return new THREE.Mesh(o,this.material)},THREE.Mesh.prototype.getPerimeter=function(){var e=0,t=this.geometry.attributes;if(t){var i=t.position;if(i.count<2)return 0;for(var r=new THREE.Vector2(i.getX(0),i.getZ(0)),n=1;n<i.count;n++){e+=(a=new THREE.Vector2(i.getX(n),i.getZ(n))).distanceTo(r),r=a}e+=r.distanceTo(new THREE.Vector2(i.getX(0),i.getZ(0)))}else{var o=this.geometry.vertices;if(o.length<2)return 0;for(r=new THREE.Vector2(o[0].x,o[0].y),n=1;n<o.length;n++){var a;e+=(a=new THREE.Vector2(o[n].x,o[n].y)).distanceTo(r),r=a}e+=r.distanceTo(new THREE.Vector2(o[0].x,o[0].y))}return e},THREE.Mesh.prototype.getArea=function(){var e=[],t=this.geometry.attributes;if(t)for(var i=t.position,r=0;r<i.count;r++){var n=new THREE.Vector2(i.getX(r),i.getZ(r));e.push(n)}else{var o=this.geometry.vertices;for(r=0;r<o.length;r++){n=new THREE.Vector2(o[r].x,o[r].y);e.push(n)}}var a=THREE.ShapeUtils.area(e);return Math.abs(a)},THREE.Mesh.prototype.getPoints=function(){var e=[],t=this.geometry.attributes;if(t)for(var i=t.position,r=0;r<i.count;r++){(o=new THREE.Vector3(i.getX(r),i.getY(r),i.getZ(r))).applyMatrix4(this.matrixWorld),e.push(o.toArray())}else{var n=this.geometry.vertices;if(n)for(r=0;r<n.length;r++){var o;(o=n[r].clone()).applyMatrix4(this.matrixWorld),e.push(o.toArray())}}return e},THREE.Mesh.prototype.getLabelPosition=function(e,t){var i=[];if(this.geometry.attributes)for(var r=this.geometry.attributes.position,n=0;n<r.count;n++)i.push([r.getX(n),r.getZ(n)]);else for(n=0;n<this.geometry.vertices.length;n++){var o=this.geometry.vertices[n];"xy"==t?i.push([o.x,o.y]):i.push([o.x,o.z])}if(!i.length)return null;var a=[];if(a.push(i),e&&0!=e.length)for(n=0;n<e.length;n++){var s=[e[n][0],e[n][1],e[n][2],e[n][3]];a.push(s)}var l,u=new polylabel(a);return l="xy"==t?this.localToWorld(new THREE.Vector3(u[0],u[1],0)):this.localToWorld(new THREE.Vector3(u[0],0,u[1])),this.getRayCastPosition(l)},THREE.Mesh.prototype.getAvaliableLabelPosition=function(e,t,i){var r=function(e,t,i){var r=e[0],n=t[0],o=e[1],a=t[1],s=Math.max(r,i.l);if(s>n||s>i.r)return!1;var l=Math.min(n,i.r);if(l<r||l<i.l)return!1;var u=Math.max(o,i.t);if(u>a||u>i.b)return!1;var c=Math.min(a,i.b);return!(c<o||c<i.t)},n=function(e,t,i,n,o){for(var a=i.x,s="xy"==o?i.y:i.z,l=[a-n[0],s-n[1]],u=[a+n[0],s+n[1]],c=0;c<e.length;c++){var h=e[c],p=t[c],d=h.x,f="xy"==o?h.y:h.z,m=p[0]/2,g=p[1]/2;if(r(l,u,{l:d-m,t:f-g,r:d+m,b:f+g}))return!0}return!1};this.updateMatrixWorld();var o=new THREE.Matrix4;if(o.getInverse(this.matrixWorld),i&&i.length&&i.length%4)return console.error("The hole points number must arrange by 4"),null;for(var a=[],s=0;s<i.length;s+=4){var l=ke.parseVector3(i[s]).applyMatrix4(o),u=ke.parseVector3(i[s+1]).applyMatrix4(o),c=ke.parseVector3(i[s+2]).applyMatrix4(o),h=ke.parseVector3(i[s+3]).applyMatrix4(o);l=[l.x,l.z],u=[u.x,u.z],c=[c.x,c.z],h=[h.x,h.z],a.push([l,u,c,h])}var p=[],d=[];for(s=0;s<e.length;s++){var f=e[s],m=f[0]/2,g=f[1]/2;if(0!=m&&0!=g){var v=this.getLabelPosition(a,t);if(!v)break;var y=v.clone();y.applyMatrix4(o),n(p,e,y,[m,g],t)||(d.push(v),p.push(y));var b=y.x,_="xy"==t?y.y:y.z;l=[b-m,_-g],u=[b+m,_-g],c=[b+m,_+g],h=[b-m,_+g];a.push([l,u,c,h])}}return d},THREE.Mesh.prototype.getRayCastPosition=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this.updateMatrixWorld();var i=new THREE.Vector3,r=new THREE.Vector3(0,1,0),n=this.position.clone();i.copy(r).applyQuaternion(this.quaternion),n.add(i.multiplyScalar(t)),n.applyMatrix4(this.matrixWorld);var o=new THREE.Vector3,a=new THREE.Vector3(0,-1,0),s=this.position.clone();o.copy(a).applyQuaternion(this.quaternion),s.add(o.multiplyScalar(t)),s.applyMatrix4(this.matrixWorld);var l=new THREE.Vector3;l.subVectors(s,n),l.normalize();var u=e.clone();u.add(l.clone().multiplyScalar(-t));var c=new THREE.Raycaster;c.ray.origin.copy(u),c.ray.direction.copy(l);var h=c.intersectObjectForcible(this,!0);return h.length?h[0].point:null},THREE.LOD.prototype.setLevel=function(e){if(!(e>=this.levels.length)){for(var t=0;t<this.levels.length;t++)this.levels[t].object.visible=!1;this.levels[e].object.visible=!0}},THREE.Raycaster.prototype.clone=function(){return new THREE.Raycaster(this.ray.origin.clone(),this.ray.direction.clone())},THREE.Raycaster.prototype._intersectObjectForcible=function(e,t,i,r){if(e.raycast(t,i),!0===r)for(var n=e.children,o=0,a=n.length;o<a;o++)this._intersectObjectForcible(n[o],t,i,!0)},THREE.Raycaster.prototype.intersectObjectForcible=function(e,t,i){var r=i||[];return this._intersectObjectForcible(e,this,r,t),r.sort((function(e,t){return e.distance-t.distance})),r},THREE.Raycaster.prototype.intersectEnsureVisibleObject=function(e,t,i,r){if(!1!==e.ensureVisible(r)&&(e.raycast(this,t),!0===i))for(var n=e.children,o=0,a=n.length;o<a;o++)this.intersectEnsureVisibleObject(n[o],t,!0,r)},THREE.Raycaster.prototype.intersectEnsureVisibleObjects=function(e,t,i){var r=[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var n=0,o=e.length;n<o;n++)this.intersectEnsureVisibleObject(e[n],r,t,i);return r.sort((function(e,t){return e.distance-t.distance})),r},THREE.Raycaster.prototype.intersectCollisionObjects=function(e,t,i){var r=[];return function e(t,i,r,n,o){if(!1!==t.visible&&t.layers.test(n.layers)){t.raycast(i,r);for(var a=t.children,s=0,l=a.length;s<l;s++)e(a[s],i,r,n,o)}}(e,this,r,t,i),r.sort(ascSort),r},THREE.Geometry.prototype.getVerticesCount=function(){return this.vertices.length},THREE.Geometry.prototype.genFaceVertexUVs=function(){this.computeFaceNormals(),this.computeVertexNormals(),this.computeBoundingBox();for(var e=this.boundingBox.max,t=this.boundingBox.min,i=new THREE.Vector2(0-t.x,0-t.y),r=new THREE.Vector2(e.x-t.x,e.y-t.y),n=this.faces,o=[],a=0;a<n.length;a++){var s=this.vertices[n[a].a],l=this.vertices[n[a].b],u=this.vertices[n[a].c],c=new THREE.Vector2((s.x+i.x)/r.x,(s.y+i.y)/r.y),h=new THREE.Vector2((l.x+i.x)/r.x,(l.y+i.y)/r.y),p=new THREE.Vector2((u.x+i.x)/r.x,(u.y+i.y)/r.y);o.push([c,h,p])}for(a=0;a<this.faceVertexUvs.length;a++)this.faceVertexUvs[a]=o.concat();this.uvsNeedUpdate=!0,this.elementsNeedUpdate=!0},THREE.Scene.prototype.verticesCount=function(){var e=0;return this.traverse((function(t){t.isMesh&&(e+=t.verticesCount())})),e},THREE.AnimationMixer.prototype.isRunning=function(e){for(var t=this._actions,i=this._nActiveActions,r=0;r!==i;++r){var n=t[r];if(e){var o=n.getClip();if(o&&e!=o.name)continue}if(n.isRunning())return!0}return!1},THREE.AnimationMixer.prototype.log=function(){for(var e=this.stats,t=0;t<this._actions.length;t++){var i=this._actions[t],r=i.getClip(),n=i.getEffectiveWeight();0!=n&&console.log("action: [name: "+r.name+", weight: "+n+"]")}console.log("action: "+e.actions.inUse+"/"+e.actions.total),console.log("bindings: "+e.bindings.inUse+"/"+e.bindings.total),console.log("controlInterpolants: "+e.controlInterpolants.inUse+"/"+e.controlInterpolants.total)},THREE.Material.prototype._isCloned=function(){return!!this._origin_material},THREE.Material.prototype._getOriginal=function(){var e=this._origin_material;return e||this},THREE.Material.prototype._getPrevMaterial=function(){var e=this._prev_material;return e||this._getOriginal()},THREE.Material.prototype._pushAndCloneSelf=function(){var e=this.clone();return e._origin_material=this._getOriginal(),e._prev_material=this,e},THREE.Material.prototype._pop=function(){var e=this.__materialsQueue__;if(e&&e.length){for(;e.length;){e[e.length-1].dispose(),e.splice(e.length-1,1)}e.length||delete this.__materialsQueue__}};var ul=THREE.Material.prototype.copy;THREE.Material.prototype.copy=function(e){return ul.call(this,e),this.defines=void 0!==e.defines?JSON.parse(JSON.stringify(e.defines)):void 0,this.__texture=e.__texture,this._replace_map=e._replace_map,this._replace_alphaMap=e._replace_alphaMap,this},THREE.Material.prototype.getTextures=function(){var e=new Set;for(var t in this){var i=this[t];i&&i.isTexture&&e.add(i)}return Array.from(e)},THREE.Box3.prototype.getIntersection=function(e){var t=new THREE.Box3;return this.intersectsBox(e)&&(t.min.x=Math.max(this.min.x,e.min.x),t.max.x=Math.min(this.max.x,e.max.x),t.min.y=Math.max(this.min.y,e.min.y),t.max.y=Math.min(this.max.y,e.max.y),t.min.z=Math.max(this.min.z,e.min.z),t.max.z=Math.min(this.max.z,e.max.z)),t},THREE.Box3.prototype._setFromObject=function(e,t,i){this.makeEmpty(),e.updateWorldMatrix(!0,!0);var r=new THREE.Vector3,n=this;e.getWorldPosition(rl);var o=!1;e.traverse((function(e){if(!t||!1!==t(e)){var a=e.geometry;if(a)if(a.isGeometry)for(var s=a.vertices,l=0,u=s.length;l<u;l++)r.copy(s[l]),r.applyMatrix4(e.matrixWorld),i&&!1===i(r,rl)||(n.expandByPoint(r),o=!0);else if(a.isBufferGeometry){var c=a.attributes.position;if(void 0!==c){var h=a.index?a.index.array:null;for(l=a.drawRange.start,u=a.drawRange.count!=1/0?a.drawRange.count:h?h.length:c.count;l<u;l++)h?r.fromBufferAttribute(c,h[l]):r.fromBufferAttribute(c,l),r.applyMatrix4(e.matrixWorld),i&&!1===i(r,rl)||(n.expandByPoint(r),o=!0)}}}})),o||(i&&i(rl,rl.clone()),this.expandByPoint(rl)),this.getSize(nl);return 0==nl.x&&(this.min.x-=1e-8,this.max.x+=1e-8),0==nl.y&&(this.min.y-=1e-8,this.max.y+=1e-8),0==nl.z&&(this.min.z-=1e-8,this.max.z+=1e-8),this},THREE.Box3.prototype.getBoundingPositions=function(){var e=this.min,t=this.max;return[new THREE.Vector3(e.x,e.y,e.z),new THREE.Vector3(t.x,e.y,e.z),new THREE.Vector3(e.x,e.y,t.z),new THREE.Vector3(t.x,e.y,t.z),new THREE.Vector3(e.x,t.y,e.z),new THREE.Vector3(t.x,t.y,e.z),new THREE.Vector3(e.x,t.y,t.z),new THREE.Vector3(t.x,t.y,t.z)]},THREE.ShaderChunk.map_fragment=["","#ifdef USE_MAP","#ifdef USE_DIFFUSE_UV2","vec4 texelColor = texture2D( map, vUv2 );","#else","vec4 texelColor = texture2D( map, vUv );","#endif","texelColor = mapTexelToLinear( texelColor );","diffuseColor *= texelColor;","#endif",""].join("\n"),THREE.ShaderChunk.alphamap_fragment=["","#ifdef USE_ALPHAMAP","#ifdef USE_ALPHAMAP_REVERSE","diffuseColor.a *= 1.0 - texture2D( alphaMap, vAlphaUV).g;","#else","diffuseColor.a *= texture2D( alphaMap, vAlphaUV).g;","#endif","#endif",""].join("\n"),THREE.ShaderChunk.uv2_pars_fragment=["","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","varying vec2 vUv2;","#endif","#ifdef USE_ALPHAMAP","varying vec2 vAlphaUV;","#endif","#ifdef USE_EMISSIVEMAP","varying vec2 vEmissiveUV;","#endif",""].join("\n"),THREE.ShaderChunk.uv2_pars_vertex=["","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined( USE_ALPHA_UV2 ) || defined (USE_DIFFUSE_UV2)","attribute vec2 uv2;","#endif","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","varying vec2 vUv2;","#endif","#ifdef USE_ALPHA_UV3","#if defined(USE_ALPHAMAP) || defined(USE_EMISSIVEMAP)","attribute vec2 uv3;","#endif","#endif","#ifdef USE_ALPHA_UV4","#if defined(USE_ALPHAMAP) || defined(USE_EMISSIVEMAP)","attribute vec2 uv4;","#endif","#endif","#ifdef USE_ALPHAMAP","varying vec2 vAlphaUV;","uniform mat3 uvTransform1;","#endif","#ifdef USE_EMISSIVEMAP","varying vec2 vEmissiveUV;","uniform mat3 uvTransform2;","#endif",""].join("\n"),THREE.ShaderChunk.uv2_vertex=["#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","#if defined(USE_DIFFUSE_UV2) && defined(USE_MAP)","vUv2 = (uvTransform * vec3(uv2, 1.0)).xy;","#else","vUv2 = uv2;","#endif","#endif","#ifdef USE_ALPHAMAP","vAlphaUV = (uvTransform1 * vec3(uv, 1.0)).xy;","#ifdef USE_ALPHA_UV2","vAlphaUV = (uvTransform1 * vec3(uv2, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV3","vAlphaUV = (uvTransform1 * vec3(uv3, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV4","vAlphaUV = (uvTransform1 * vec3(uv4, 1.0)).xy;","#endif","#endif","#ifdef USE_EMISSIVEMAP","#ifndef USE_EMISSIVETRANSFORM","mat3 emissiveTransform = uvTransform;","#else","mat3 emissiveTransform = uvTransform2;","#endif","vEmissiveUV = (emissiveTransform * vec3(uv, 1.0)).xy;","#ifdef USE_ALPHA_UV2","vEmissiveUV = (emissiveTransform * vec3(uv2, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV3","vEmissiveUV = (emissiveTransform * vec3(uv3, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV4","vEmissiveUV = (emissiveTransform * vec3(uv4, 1.0)).xy;","#endif","#endif",""].join("\n");["sprite","basic"].forEach((function(e){var t=THREE.ShaderLib[e];t.vertexShader=t.vertexShader.replace("#include <clipping_planes_pars_vertex>","\n\t#include <clipping_planes_pars_vertex>\n\t#ifdef USE_GPUPICKER\n\t\tuniform float baseId;\n\t\tvarying vec4 worldId;\n\t#endif\n\t"),t.vertexShader=t.vertexShader.replace("#include <fog_vertex>","\n\t#include <fog_vertex>\n\t#ifdef USE_GPUPICKER\n\t\tvec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);\n\t\ta -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);\n\t\tworldId = vec4(a,1);\n\t#endif\n\t"),t.fragmentShader=t.fragmentShader.replace("#include <clipping_planes_pars_fragment>","\n\t#include <clipping_planes_pars_fragment>\n\t#ifdef USE_GPUPICKER\n\t\tvarying vec4 worldId;\n\t#endif\n\t"),t.fragmentShader=t.fragmentShader.replace("#include <fog_fragment>","\n\t#include <fog_fragment>\n\t#ifdef USE_GPUPICKER\n\t\tgl_FragColor = worldId;\n\t#endif\n\t"),t.fragmentShader=t.fragmentShader.replace("#include <clipping_planes_fragment>","\n\t#ifdef USE_MAP\n\t\t#ifdef USE_UV_DISCARD\n\t\t\tif (vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.) discard;\n\t\t#endif\n\t#endif\n\t#include <clipping_planes_fragment>\n\t")})),THREE.ShaderChunk.aomap_fragment="\n\t#ifdef USE_AOMAP\n\t\t#ifdef WALL_AO\n\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity * 0.5 + 1.5;\n\t\t#else\n\t\t\t#ifdef FLOOR_AO\n\t\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.1;\n\t\t\t#else\n\t\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity * 1.5 + 1.45;\n\t\t\t#endif\n\t\t#endif\n\t\t// reflectedLight.indirectDiffuse *= ambientOcclusion;\n\t\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t\t#endif\n\t#endif\n",THREE.ShaderChunk.emissivemap_fragment="\n\t#ifdef USE_EMISSIVEMAP\n\n\t\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveUV );\n\n\t\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\t\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n\t#endif\n\n\t#ifdef STANDARD\n\t\ttotalEmissiveRadiance = vec3(0.0,0.0,0.0);\n\t\tvec3 newEmissiveColor = emissive;\n\t\t#ifdef USE_EMISSIVEMAP\n\t\t\tnewEmissiveColor = emissive * emissiveColor.rgb;\n\t\t\t#ifdef USE_SIDE_EMISSIVE\n\t\t\t\tnewEmissiveColor *= newEmissiveColor * (1. - abs(dot( inverseTransformDirection( normal, viewMatrix ), vec3(0., 1., 0.) )));\n\t\t\t#endif\n\t\t#endif\n\t#endif\n",THREE.ShaderChunk.encodings_fragment=["gl_FragColor = linearToOutputTexel( gl_FragColor );","#ifdef USE_AOMAP","gl_FragColor.rgb *= ambientOcclusion;","#endif","#ifdef STANDARD","gl_FragColor.rgb += newEmissiveColor;","#endif"].join("\n"),THREE.ShaderChunk.tonemapping_fragment=["#if defined( TONE_MAPPING ) && defined(STANDARD)","gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );","#endif"].join("\n"),THREE.ShaderLib.lambert={uniforms:THREE.ShaderLib.lambert.uniforms,vertexShader:"\n\t\t#define LAMBERT\n\n\t\t#ifdef INSTANCED\n\t\t\tattribute vec3 instancePosition;\n\t\t\tattribute vec4 instanceQuaternion;\n\t\t\tattribute vec3 instanceScale;\n\t\t\tattribute vec3 instanceColor;\n\n\t\t\tmat4 compose(vec3 position, vec4 quaternion, vec3 scale) {\n\t\t\t\tfloat x = quaternion.x, y = quaternion.y, z = quaternion.z, w = quaternion.w;\n\t\t\t\tfloat x2 = x + x,  y2 = y + y,  z2 = z + z;\n\t\t\t\tfloat xx = x * x2, xy = x * y2, xz = x * z2;\n\t\t\t\tfloat yy = y * y2, yz = y * z2, zz = z * z2;\n\t\t\t\tfloat wx = w * x2, wy = w * y2, wz = w * z2;\n\n\t\t\t\tfloat sx = scale.x, sy = scale.y, sz = scale.z;\n\n\t\t\t\treturn mat4(( 1. - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.,\n\t\t\t\t\t( xy - wz ) * sy, ( 1. - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.,\n\t\t\t\t\t( xz + wy ) * sz, ( yz - wx ) * sz, ( 1. - ( xx + yy ) ) * sz, 0.,\n\t\t\t\t\tposition.x, position.y, position.z, 1.\n\t\t\t\t);\n\t\t\t}\n\t\t#endif\n\n\t\tvarying vec3 vLightFront;\n\t\tvarying vec3 vIndirectFront;\n\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvarying vec3 vLightBack;\n\t\t\tvarying vec3 vIndirectBack;\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <uv_pars_vertex>\n\t\t#include <uv2_pars_vertex>\n\t\t#include <envmap_pars_vertex>\n\t\t#include <bsdfs>\n\t\t#include <lights_pars_begin>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <morphtarget_pars_vertex>\n\t\t#include <skinning_pars_vertex>\n\t\t#include <shadowmap_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\t#include <uv_vertex>\n\t\t\t#include <uv2_vertex>\n\t\t\t#include <color_vertex>\n\n\t\t\t// vertex colors instanced\n\t\t\t#ifdef INSTANCED\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\tvColor.xyz = instanceColor.xyz;\n\t\t\t\t#endif\n\t\t\t#endif\n\n\t\t\t#include <beginnormal_vertex>\n\t\t\t#include <morphnormal_vertex>\n\t\t\t#include <skinbase_vertex>\n\t\t\t#include <skinnormal_vertex>\n\n\t\t\t// normal instanced\n\t\t\t#ifdef INSTANCED\n\t\t\t\tmat4 instanceMat = compose(instancePosition, instanceQuaternion, instanceScale);\n\t\t\t\tobjectNormal = transformDirection(objectNormal, instanceMat);\n\t\t\t#endif\n\n\t\t\t#include <defaultnormal_vertex>\n\n\t\t\t#include <begin_vertex>\n\n\t\t\t// position instanced\n\t\t\t#ifdef INSTANCED\n\t\t\t\ttransformed.xyz = (instanceMat * vec4(transformed, 1.0)).xyz;\n\t\t\t#endif\n\n\t\t\t#include <morphtarget_vertex>\n\t\t\t#include <skinning_vertex>\n\t\t\t#include <project_vertex>\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\n\t\t\t#include <worldpos_vertex>\n\t\t\t#include <envmap_vertex>\n\t\t\t#include <lights_lambert_vertex>\n\t\t\t#include <shadowmap_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:THREE.ShaderLib.lambert.fragmentShader},THREE.ShaderLib.depth={uniforms:THREE.ShaderLib.depth.uniforms,vertexShader:"\n\t\t#ifdef INSTANCED\n\t\t\tattribute vec3 instancePosition;\n\t\t\tattribute vec4 instanceQuaternion;\n\t\t\tattribute vec3 instanceScale;\n\n\t\t\tmat4 compose(vec3 position, vec4 quaternion, vec3 scale) {\n\t\t\t\tfloat x = quaternion.x, y = quaternion.y, z = quaternion.z, w = quaternion.w;\n\t\t\t\tfloat x2 = x + x,  y2 = y + y,  z2 = z + z;\n\t\t\t\tfloat xx = x * x2, xy = x * y2, xz = x * z2;\n\t\t\t\tfloat yy = y * y2, yz = y * z2, zz = z * z2;\n\t\t\t\tfloat wx = w * x2, wy = w * y2, wz = w * z2;\n\n\t\t\t\tfloat sx = scale.x, sy = scale.y, sz = scale.z;\n\n\t\t\t\treturn mat4(( 1. - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.,\n\t\t\t\t\t( xy - wz ) * sy, ( 1. - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.,\n\t\t\t\t\t( xz + wy ) * sz, ( yz - wx ) * sz, ( 1. - ( xx + yy ) ) * sz, 0.,\n\t\t\t\t\tposition.x, position.y, position.z, 1.\n\t\t\t\t);\n\t\t\t}\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <uv_pars_vertex>\n\t\t#include <displacementmap_pars_vertex>\n\t\t#include <morphtarget_pars_vertex>\n\t\t#include <skinning_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\t#include <uv_vertex>\n\n\t\t\t#include <skinbase_vertex>\n\n\t\t\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t\t\t#include <beginnormal_vertex>\n\t\t\t\t#include <morphnormal_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\n\t\t\t#endif\n\n\t\t\t#include <begin_vertex>\n\n\t\t\t// position instanced\n\t\t\t#ifdef INSTANCED\n\t\t\t\tmat4 instanceMat = compose(instancePosition, instanceQuaternion, instanceScale);\n\t\t\t\ttransformed.xyz = (instanceMat * vec4(transformed, 1.0)).xyz;\n\t\t\t#endif\n\n\t\t\t#include <morphtarget_vertex>\n\t\t\t#include <skinning_vertex>\n\t\t\t#include <displacementmap_vertex>\n\t\t\t#include <project_vertex>\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\n\t\t}\n\t",fragmentShader:THREE.ShaderLib.depth.fragmentShader},THREE.BufferGeometry.prototype.getVerticesCount=function(){return this.attributes.position.count},THREE.BufferGeometry.prototype.addAttribute=function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new BufferAttribute(arguments[1],arguments[2])))},THREE.BufferAttribute.prototype.setDynamic=function(e){return this.setUsage(!0===e?THREE.DynamicDrawUsage:THREE.StaticDrawUsage),this};var cl=function(){function e(t){n(this,e)}return e.prototype.init=function(){this.eyeTween=null,this.targetTween=null,this.upTween=null,this._flying=!1},e.prototype._lookAt=function(e){var t=ke.parseVector3(e);t&&(this.controller.object.lookAt(t),this.controller.target.set(t.x,t.y,t.z))},e.prototype.updateFollowingObject=function(){var e=this,t=this.followingObject,i=t.params,r=i.flyStop,n=i.flying,o=i.flyComplete,a=t.object;if(a instanceof bt){if(!a.visible||a.destroyed)return r&&r(),void this.app.camera.stopFollowingObject();a=t.centerPos||a.boundingBox.center}a=ke.parseVector3(a);var s=t.dir.clone();"earth"===this.app.camera.mode?(s=t.object.selfToWorld(s),s=THING.Utils.parseVector3(s)):s.add(a);var l=ke.parseVector3(this.camera.target),u=ke.parseVector3(this.camera.position),c=t.speed;l=l.lerp(a,c/10),u=u.lerp(s,c/10),this.object.node.position.copy(u),this._lookAt(l,(function(){return e.static})),n&&n();var h=l.distanceTo(a),p=u.distanceTo(s);h<1e-4&&p<1e-4&&(o&&o(),i.once&&this.app.camera.stopFollowingObject());this.app.needUpdate=!0},e.prototype.updateLookingObject=function(){var e=this.lookingObject;e instanceof bt&&(e=e.boundingBox.center);var t=ke.parseVector3(e),i=ke.parseVector3(this.camera.target).lerp(t,.1);this.camera.target=i.toArray()},e.prototype.getFlyPos=function(e){var t,i=this.object,r=ke.parseNumber3(e.position),n=null,o=[0,0,0],a=e.target||e.object;if(a){var s=e.offset,l=e.worldOffset,u=e.xAngle,c=e.yAngle,h=e.distance||e.radius,p=e.radiusFactor;if(a.isBaseObject||a.isGroup){n=a;var d=e.center;if(o=d?(d=ke.parseVector3(d)).toArray():n.boundingBox.center||o,ke.isNull(u)&&ke.isNull(c))if(s){S=n.worldToSelf(o);s=THING.Math.addVector(S,s),s=n.selfToWorld(s,!0)}else if(l)s=THING.Math.addVector(o,l);else{var f=e.time||1,m=!1;h&&(m=!0);var g=[],v=n.boundingBox;g.push(v.getWorldPosition({yAngle:45,xAngle:45,distance:h,radiusFactor:p,ignoreScale:m})),f>1&&(g.push(v.getWorldPosition({yAngle:45,xAngle:135,distance:h,radiusFactor:p,ignoreScale:m})),g.push(v.getWorldPosition({yAngle:45,xAngle:225,distance:h,radiusFactor:p,ignoreScale:m})),g.push(v.getWorldPosition({yAngle:45,xAngle:315,distance:h,radiusFactor:p,ignoreScale:m})));for(var y=0,b=ke.parseVector3(i.position),_=b.distanceTo(ke.parseVector3(g[y])),x=y+1;x<g.length;x++){var E=ke.parseVector3(g[x]),w=b.distanceTo(E);w<_&&(_=w,y=x)}r=g[y],s=[0,0,0]}else{s=s||n.getOffsetPosition({yAngle:u,xAngle:c,distance:h,radiusFactor:p});var S=n.worldToSelf(o);s=THING.Math.addVector(S,s),s=n.selfToWorld(s,!0)}r=r||[0,0,0],i.projectionType==T.Perspective?(r[0]+=s[0],r[1]+=s[1],r[2]+=s[2]):r[1]+=s[1]}else if(ke.isArray(a)){if(o=a,!r)if(s=s||l,ke.isArray(s)||ke.isNumber(s))r=THING.Math.addVector(a,s);else{h=h||10;var A=ke.parseVector3(a);A&&(c||u?(c=ke.parseValue(c,0),u=ke.parseValue(u,0),r=A.getDirectionFromAngles(u,c,h).toArray()):r=A.getDirectionFromPosition(i.node.position,h).toArray())}r=r||i.position}else console.error("getFlyPos() failed, due to object or target is neither BaseObject type nor position")}if(e.autoFixUp){var M=e.up;if(M)M=THING.Math.normalizeVector(M);else{var C=this,R=new THREE.Vector3(0,1,0),D=(t=n||C.app.level.current)?t.isCampus?t:t.parents.query(".Campus")[0]:null;D&&(R.applyQuaternion(THING.Utils.parseQuaternion(D.worldAngles)),R.normalize(),M=R.toArray())}}return{obj:n,eyePos:r,lookAtPos:o,up:M}},e.prototype.flyTo=function(e){(e=e||{}).isBaseObject&&(e={object:e,time:2e3});var t=ke.parseValue(e.time,2e3),i=ke.parseValue(e.lerp||e.lerpType,TWEEN.Easing.Linear.None),r=ke.parseValue(e.upLerp,i),n=ke.parseValue(e.positionLerp,i),o=ke.parseValue(e.targetLerp,i),a=e.flyStart,s=e.flyStop,l=e.flying,u=e.flyComplete;if(ke.parseValue(e.keepDirection,!1)){var c=e.cameraTarget||e.target;if(c)return e.object=c,e.radius=e.radius||2*c.boundingBox.radius,e.speed=t/1e3,e.enableRotate=!0,e.enableZoom=!0,e.once=!0,void this.followObject(e)}var h=this.getFlyPos(e),p=h.eyePos,d=h.lookAtPos;if(!this._stopping)if(this.stopFlying(),p&&d){this._flying=!0,a&&a();var f={x:this.object.node.position.x,y:this.object.node.position.y,z:this.object.node.position.z},m={x:p[0],y:p[1],z:p[2]},g={x:this.controller.target.x,y:this.controller.target.y,z:this.controller.target.z},v={x:d[0],y:d[1],z:d[2]},y=this,b=e.customFlying;if(b&&ke.isFunction(b))b({object:e.object,forward:y.direction,from:f,to:m,lookatFrom:g,lookatTo:v,time:t,complete:function(){y._flying=!1,u&&u()}});else if(this.eyeTween=new TWEEN.Tween(f).to(m,t).easing(n).onUpdate((function(){y.object.position=[this._object.x,this._object.y,this._object.z]})).start(),this.targetTween=new TWEEN.Tween(g).to(v,t).easing(o).onUpdate((function(){y.object.target=[this._object.x,this._object.y,this._object.z],l&&l()})).onStop((function(){s&&s()})).onComplete((function(){y._flying=!1,u&&u()})).start(),h.up){var _={x:this.object.node.up.x,y:this.object.node.up.y,z:this.object.node.up.z},x={x:h.up[0],y:h.up[1],z:h.up[2]};this.upTween=new TWEEN.Tween(_).to(x,t).easing(r).onStop((function(){y.object.up=h.up})).onUpdate((function(){y.object.up=[this._object.x,this._object.y,this._object.z]})).start()}}else u&&u()},e.prototype.stopRotating=function(){this.object._stopRotating()},e.prototype.stopFlying=function(){this.isFlying()&&(this._flying=!1,this._stopping=!0,this.object.stopRotating(),this.stopFollowingObject(),this.eyeTween&&this.eyeTween.stop(),this.targetTween&&this.targetTween.stop(),this.upTween&&this.upTween.stop(),this._stopping=!1)},e.prototype.movePath=function(e){var t=this;this.stopFlying();var i=e.complete;e.complete=function(){t._flying=!1;var e=t.cameraObject.node.getForwardPosition(t.camera.distance);t.camera.target=e.toArray(),i&&i()},this._flying=!0,flyStart&&flyStart(),bt.prototype.movePath.call(this.object,e)},e.prototype.rotateAround=function(e){var t=this,i=(e=e||{}).target||e.object;e.target=i||this.camera.target,this.stopFlying(),e.rotateStart&&e.rotateStart(),this.lookAt(e.target);var r=e.complete;e.complete=function(t){e.stop(),r&&r(),e.rotateComplete&&e.rotateComplete()},e.stop=function(i){t.lookAt(null),t.camera.curOrbit.enabled=!0,t.camera.resume({rotate:!0,pan:!0,zoom:!0}),e.rotateComplete&&e.rotateComplete()},e.update=function(e){t.camera.curOrbit.update()},this.camera.curOrbit.enabled=!1,this.camera.disable({rotate:!0,pan:!0,zoom:!0}),bt.prototype.rotateAround.call(this.object,e)},e.prototype.rotate=function(e){var t=this.camera.distance,i=ke.parseVector3(this.camera.direction),r=ke.parseQuaternion(e);i.applyQuaternion(r),i.normalize();var n=i.clone();n.multiplyScalar(t),n.add(ke.parseVector3(this.camera.position)),this.camera.target=n.toArray()},e.prototype.followObject=function(e){(e=e||{}).isBaseObject&&(e={object:e});var t=e.object;if(t){this.stopFollowingObject();var i,r=e.alpha,n=e.beta,o=e.distance||e.radius||this.camera.distance,a=ke.parseVector3(e.offset||[0,0,0]),s=ke.parseVector3(e.worldOffset),l=e.speed||1,u=e.centerPos;if(s)i=s;else{if(i=new THREE.Vector3,r||n)r=r||0,n=n||0,i=ke.parseVector3(THING.Math.directionFromAlphaBeta(r,n));else{var c=ke.parseVector3(this.camera.target),h=ke.parseVector3(this.camera.position);i.subVectors(h,c)}i.normalize(),i.multiplyScalar(o),i.add(a)}var p=e.flyStart;p&&p(),this.followingObject={object:t,dir:i,speed:l,params:e,centerPos:u}}},e.prototype.stopFollowingObject=function(){if(this.followingObject){var e=this.followingObject.params;this.followingObject=null;var t=e.flyStop;t&&t()}},e.prototype.lookAt=function(e){return e&&(ke.isArray(e)||e.isBaseObject)?(this.lookingObject=e,!0):(this.lookingObject=null,!1)},e.prototype.setTarget=function(e){var t=this;this._lookAt(e,(function(){return t.object.static}))},e.prototype.isFlying=function(){return!!this._flying||!!this.followingObject},e.prototype.onAdd=function(e){this.object=e,this.app=this.object.app,this.init()},e.prototype.onRemove=function(){},e.prototype.onUpdate=function(){this.followingObject?this.updateFollowingObject():this.lookingObject&&this.updateLookingObject()},o(e,[{key:"controller",get:function(){return this.object.controller}},{key:"camera",get:function(){return this.object.app.camera}}]),e}(),hl=function(){function e(t){n(this,e);var i=t.image,r=t.backgroundImage,o=t.opacity||.8,a=new THREE.SpriteMaterial({map:THREE.ImageUtils.loadTexture(i),opacity:o,transparent:!0}),s=null;this.spriteBg=null,""!=r&&(s=new THREE.SpriteMaterial({map:THREE.ImageUtils.loadTexture(r),opacity:o,transparent:!0})),this._position=null,this._uiPosition=[1,1],Object.defineProperty(this,"position",{get:function(){return this._position},set:function(e){if(ke.isNumber(e))switch(this._position=e,this._position){case M.LeftTop:this._uiPosition=[-1,-1];break;case M.RightTop:this._uiPosition=[1,-1];break;case M.LeftBottom:this._uiPosition=[-1,1];break;case M.RightBottom:this._uiPosition=[1,1]}return this._position}}),null!=t.position?this.position=t.position:this.position=M.RightBottom,this.size=t.size||50,this.offset=t.offset||[0,0],this.sprite=new THREE.Sprite(a),this.sprite.scale.set(this.size,this.size,1),null!=s&&(this.spriteBg=new THREE.Sprite(s),this.spriteBg.scale.set(this.size,this.size,1))}return e.prototype.onUpdate=function(){var e=this.app.mainUI.getRenderPosition(this._uiPosition,[this.size,this.size]);null!=this.spriteBg&&this.spriteBg.position.set(e[0]+this.offset[0],e[1]+this.offset[1],-10),this.sprite.position.set(e[0]+this.offset[0],e[1]+this.offset[1],-10),this.sprite.material.rotation=-this.app.renderCamera.rotation._z},e.prototype.onAdd=function(e){this.app=e,null!=this.spriteBg&&this.app.mainUI.scene2D.add(this.spriteBg),this.app.mainUI.scene2D.add(this.sprite)},e.prototype.onRemove=function(){null!=this.spriteBg&&this.app.mainUI.scene2D.remove(this.spriteBg),this.app.mainUI.scene2D.remove(this.sprite)},e}(),pl=function(){function e(t){n(this,e),this._controls=null}return e.prototype.onResize=function(){},e.prototype.onUpdate=function(){this._controls&&(this._controls.update(this.app._deltaTime),this.app.needUpdate=!0)},e.prototype.onAdd=function(e){this.app=e,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeMouseControls(e.renderCamera),this._controls.movementSpeed=.25),this._controls.enabled=!0},e.prototype.onRemove=function(){this.app.camera.inputEnabled=!0,this._controls&&(this._controls.dispose(),this._controls.enabled=!1,this._controls=null)},e}();function dl(e){return e instanceof ct?e.getNodes():Array.isArray(e)?(console.warn("[WalkControl/WalkButtronControl] please set collision objects by selector object, instead of object3D array."),e):e}var fl=new THREE.Vector3,ml=function(){function e(t){n(this,e),this._controls=null,t=t||{},this.walkSpeed=void 0===t.walkSpeed?.02:t.walkSpeed,this.turnSpeed=void 0===t.turnSpeed?.25:t.turnSpeed,this.jumpSpeed=void 0===t.jumpSpeed?3:t.jumpSpeed,this.enableKeyRotate=void 0!==t.enableKeyRotate&&t.enableKeyRotate,this.useGravity=void 0===t.useGravity||t.useGravity,this.gravity=t.gravity?t.gravity:9.8,this.eyeHeight=void 0===t.eyeHeight?1.6:t.eyeHeight,this._groundObjects=void 0===t.groundObjects?void 0:dl(t.groundObjects),this.useCollision=void 0!==t.useCollision&&t.useCollision,this._collisionObjects=void 0===t.collisionObjects?void 0:dl(t.collisionObjects),this._downRaycaster=new THREE.Raycaster,this._downRaycaster.ray.direction.set(0,-1,0),this._forwardRaycaster=new THREE.Raycaster,this._fallSpeed=0,this._prevCameraAdjustNear=!1,this._cameraChangeStarted=!1}return e.prototype._notifyCameraEvent=function(e){var t=this.app.camera;this.app.trigger(e,{position:t.position,target:t.target})},e.prototype.onResize=function(){},e.prototype.onUpdate=function(){var e=this.app.renderCamera,t=!1;if(this.useCollision){this._forwardRaycaster.ray.origin.copy(e.position),this._forwardRaycaster.ray.origin.y-=this.eyeHeight/2;var i=this._controls.getMoveDirection();this._forwardRaycaster.ray.direction.copy(i).normalize();var r=this._forwardRaycaster.intersectObjects(this._collisionObjects,!0);r.length>0&&r[0].distance<.5&&(t=!0)}if(this._controls&&(this._controls.movementSpeed=t?0:this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableKeyRotate=this.enableKeyRotate,this._controls.update()?this._cameraChangeStarted?this._notifyCameraEvent("cameraChange"):(this._cameraChangeStarted=!0,this._notifyCameraEvent("cameraChangeStart")):this._cameraChangeStarted&&(this._cameraChangeStarted=!1,this._notifyCameraEvent("cameraChangeEnd")),this.app.needUpdate=!0),this.useGravity){this._downRaycaster.ray.direction.copy(e.up).multiplyScalar(-1).normalize(),this._downRaycaster.ray.origin.copy(e.position);var n=this._downRaycaster.ray.direction,o=this._downRaycaster.intersectObjects(this._groundObjects,!0);if(o.length<1){this._fallSpeed+=.0166*this.gravity;var a=fl.copy(n).multiplyScalar(Math.min(.0166*this._fallSpeed,this.eyeHeight-.001));e.position.add(a)}else{var s=o[0].distance;if(s<=this.eyeHeight+.01&&this._fallSpeed>=0){this._fallSpeed=0;var l=fl.copy(n).multiplyScalar(s-this.eyeHeight);e.position.add(l)}else{this._fallSpeed+=.0166*this.gravity;var u=fl.copy(n).multiplyScalar(Math.min(.0166*this._fallSpeed,this.eyeHeight-.001));e.position.add(u)}}}},e.prototype.onAdd=function(e){this.app=e,this._prevCameraAdjustNear=e.camera.autoAdjustNear,e.camera.autoAdjustNear=!1,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeMouseControls(e.renderCamera),this._controls.movementSpeed=this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableFly=!1),this._controls.enabled=!0,this._groundObjects=this._groundObjects||e.query(".Ground || .Floor").getNodes(),this._collisionObjects=this._collisionObjects||[this.app.scene],this._jumpBind=function(e){32==e.keyCode&&this.jump()}.bind(this),window.addEventListener("keydown",this._jumpBind,!1)},e.prototype.onRemove=function(){var e=this.app;e.camera.inputEnabled=!0,this._controls&&(this._controls.dispose(),this._controls.enabled=!1,this._controls=null),this._groundObjects=null,this._collisionObjects=null,e.camera.autoAdjustNear=this._prevCameraAdjustNear,window.removeEventListener("keydown",this._jumpBind,!1)},e.prototype.jump=function(){0==this._fallSpeed&&(this._fallSpeed-=this.jumpSpeed)},o(e,[{key:"groundObjects",set:function(e){this._groundObjects=void 0!==e?dl(e):[]}},{key:"collisionObject",set:function(e){this._collisionObjects=void 0!==e?dl(e):[]}}]),e}(),gl=function(e){function t(i){return n(this,t),s(this,e.call(this,i))}return a(t,e),t.prototype.onResize=function(){},t.prototype.onAdd=function(e){this.app=e,this._prevCameraAdjustNear=e.camera.autoAdjustNear,e.camera.autoAdjustNear=!1,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeControls(e.renderCamera),this._controls.movementSpeed=this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableFly=!1,e.renderCamera.rotation.x=0),this._controls.enabled=!0,this._groundObjects=this._groundObjects||e.query(".Ground || .Floor").getNodes(),this._collisionObjects=this._collisionObjects||[this.app.scene],this._createWalkButton()},t.prototype.onRemove=function(){var e=this.app;e.camera.inputEnabled=!0,this._controls&&(this._controls.enabled=!1,this._controls=null),this._groundObjects=null,this._collisionObjects=null,e.camera.autoAdjustNear=this._prevCameraAdjustNear,this._removeWalkButton()},t.prototype._setMoveState=function(e,t){this._controls&&(this._controls.moveState[e]=t,this._controls.updateMovementVector())},t.prototype._setRotate=function(e,t){this._controls&&this._controls.rotateDelta.set(e,t)},t.prototype._createWalkButton=function(){var e=this.app,t=this;if(!(e.domElement.getElementsByClassName("walkbutton").length>0)){this._walkButtonDom=e.domElement.appendChild(document.createElement("div")),this._walkButtonDom.className="walkbutton",this._walkButtonDom.style.cssText="position: absolute;right: 0;bottom: 0;width: 0;height: 0;border-radius: 50%;box-sizing: border-box;z-index: 1000;background: #f0f0f0;";var i,r,n,o,a,s=this._walkButtonDom.appendChild(document.createElement("div"));s.style.cssText="width: 46%;height: 46%;border-radius: 50%;overflow: hidden;position: absolute;top: 27%;left: 27%;border-radius: 50%;background: #003A9E;",this._resizeWalkButton(),t._moveState="",this._walkButtonDom.addEventListener("touchstart",(function(e){e.preventDefault(),i=e.changedTouches[0].pageX,r=e.changedTouches[0].pageY,n=e.changedTouches[0].pageX-s.offsetLeft,o=e.changedTouches[0].pageY-s.offsetTop,document.body.addEventListener("touchmove",l,!1)})),document.addEventListener("touchend",(function(){document.body.removeEventListener("touchmove",l,!1),s.style.left="27%",s.style.top="27%",t._setMoveState(t._moveState,0),t._moveState=""}))}function l(e){var l=e.changedTouches[0].pageX,u=e.changedTouches[0].pageY,c=l-n,h=u-o,p=l-i,d=u-r,f=parseFloat(t.width)/2;if(t._getDistance(p,d)<=f)s.style.left=c+"px",s.style.top=h+"px";else{var m=t._getNewPos(f,t._getRadian(p,d));s.style.left=m[0]+i-n+"px",s.style.top=m[1]+r-o+"px"}(a=Math.abs(p)>Math.abs(d)?p>0?"right":"left":d>0?"back":"forward")!==t._moveState&&(t._setMoveState(t._moveState,0),t._setMoveState(a,1),t._moveState=a)}},t.prototype._removeWalkButton=function(){var e=this.app.domElement.getElementsByClassName("walkbutton");e.length>0&&e[0].parentNode.removeChild(e[0])},t.prototype._getDistance=function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},t.prototype._getRadian=function(e,t){return Math.atan2(t,e)},t.prototype._getNewPos=function(e,t){var i=[];return i.push(Math.cos(t)*e),i.push(Math.sin(t)*e),i},t.prototype._getwindowOrientation=function(){return 180==window.orientation||0==window.orientation||90!=window.orientation&&-90!=window.orientation&&void 0},t.prototype._resizeWalkButton=function(){this.width=this._getwindowOrientation()?.2*this.app.domElement.offsetWidth:.2*this.app.domElement.offsetHeight,this._walkButtonDom.style.width=this.width+"px",this._walkButtonDom.style.height=this.width+"px",this._walkButtonDom.style.right=.5*this.width+"px",this._walkButtonDom.style.bottom=.3*this.width+"px"},t}(ml),vl=function(){function e(t){n(this,e),this.parseParam(t),this._enable=!0,this.scene=new THREE.Scene,this.camera=null,this.sprite=null,this.raycaster=new THREE.Raycaster,this.mouse=new THREE.Vector2,this.ratio=2,this.mainAspect=1,this.miniDom=null,this.renderTarget=null,this.inited=!1,this.create()}return e.prototype.parseParam=function(e){this.app=e.app,this._opacity=e.opacity||.7,this._posIndex=e.position||e.posIndex||0,this.bIcon=e.bIcon||!0,this.width=e.width||150,this.height=e.height||this.width,this._scale=e.scale||1,this.closeBtnImg=e.closeBtnImg||"http://www.thingjs.com/static/images/minimap2.png",this.cameraViewImg=e.cameraViewImg||"http://www.thingjs.com/static/images/minimap1.png",this.cameraCenterImg=e.cameraCenterImg||"http://www.thingjs.com/static/images/minimap0.png",this.center={};var t=this.app.root.boundingBox.toBox(),i=(t.max.x+t.min.x)/2,r=(t.max.z+t.min.z)/2;if(e.sceneCenter?(this.center.x=e.sceneCenter[0],this.center.y=e.sceneCenter[1]):e.center?(this.center.x=e.center[0],this.center.y=e.center[1]):(this.center.x=i,this.center.y=r),this.angle=e.angle||0,this.canMoushWheel=e.mousewheel,this.ground=e.ground,this.hasClose=e.hasClose,!this.ground)for(var n=0;n<this.app.root.campuses.length;n++){var o=this.app.root.campuses[n].ground;if(o){this.ground=o.node.children;break}}this.bTranslate=e.bTranslate||!1},e.prototype.init2d=function(){if(this.miniDom=this.app.domElement.appendChild(document.createElement("div")),this.miniDom.className="minimap",this.miniDom.style.position="absolute",this.miniDom.style.cssText="position: absolute;width:"+this.width+";height:"+this.height+";border: 5px solid rgba(255, 255, 255, 0.8);border-radius: 3px;display: block;box-sizing: border-box;overflow:hidden",this.miniDom.style.zIndex=1e3,this.hasClose){var e=this.miniDom.appendChild(document.createElement("img"));e.className="minimap_closeBtn",e.style.position="absolute",e.style.width=this.width/5,e.style.right="1px",e.style.top="1px",e.src=this.closeBtnImg;var t=this;e.addEventListener("click",(function(){close=!0,t.enable=!1}))}var i=this.miniDom.appendChild(document.createElement("img"));i.className="minimap_cameraView",i.style.position="absolute",i.src=this.cameraViewImg;var r=this.miniDom.appendChild(document.createElement("img"));r.className="minimap_cameraCenter",r.src=this.cameraCenterImg,i.style.width="40px",i.style.height="30px",this.miniDom.onmousedown=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.miniDom.onmousemove=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.miniDom.onmousewheel=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.canMoushWheel&&this.miniDom.addEventListener("mousewheel",(function(e){t.scale+=e.wheelDelta>0?.1:-.1}),!1),this.miniDom.addEventListener("mousedown",(function(e){0===e.button&&(t.mouse.x=e.clientX/(t.miniDom.clientWidth+10)*2-1,t.mouse.y=-e.clientY/(t.miniDom.clientWidth+10)*2+1,n(),t.miniDom.onmousemove=function(e){t.mouse.x=e.clientX/(t.miniDom.clientWidth+10)*2-1,t.mouse.y=-e.clientY/(t.miniDom.clientWidth+10)*2+1,n()},t.miniDom.onmouseup=function(){t.miniDom.onmousemove=null,t.miniDom.onmouseup=null})}),!1);t=this;function n(){t.raycaster.setFromCamera(t.mouse,t.camera);var e=t.raycaster.intersectObjects(t.ground[0].children,!0);if(e.length>0){var i=e[0].point;if(t.bTranslate){var r=t.app.camera.cameraObject.forward;r=new THREE.Vector3(r[0],0,r[2]);var n=new THREE.Vector3(i.x,0,i.z).normalize(),o=r.dot(n),a=(new THREE.Vector3).crossVectors(r,n).y,s=0;s=o>0?a<0?90*-(a+1)-90:90+90*(1-a):90*a;var l=t.app.create({type:"Thing",position:[i.x,t.app.camera.position[1],i.z]});t.app.camera.flyTo({time:1e3,object:l,xAngle:45,yAngle:s,zAngle:0})}else t.app.camera.flyTo({time:1e3,position:[i.x,t.app.camera.position[1],i.z],target:t.app.camera.target})}}},e.prototype.init3d=function(){this.init2d();var e=this.app.root.boundingBox.toBox(),t=e.max.x>e.max.z?e.max.x:e.max.z,i=Math.abs(e.min.x)>Math.abs(e.min.z)?Math.abs(e.min.x):Math.abs(e.min.z),r=t>i?t:i;r*=1/this.scale,this.camera=new THREE.OrthographicCamera(-r,r,r,-r,-1e4,1e4),this.camera.position.set(this.center.x,100,this.center.y),this.camera.up=new THREE.Vector3(0,0,-1).applyEuler(new THREE.Euler(0,this.angle*Math.PI/180,0,"XYZ")),this.camera.lookAt(new THREE.Vector3(this.center.x,-1,this.center.y));var n=this.app.domElement;this.mainAspect=n.clientWidth/n.clientHeight,this.ratio=n.clientWidth/r;var o=r,a=8*o<256?8*o:256,s=8*(r*this.mainAspect)<256*this.mainAspect?8*o:256*this.mainAspect;this.renderTarget=new THREE.WebGLRenderTarget(a,s,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,generateMipmaps:!1,format:THREE.RGBAFormat});var l=new THREE.SpriteMaterial({map:this.renderTarget.texture,transparent:!0,opacity:this._opacity});this.sprite=new THREE.Sprite(l),this.setMiniRect(),this.update();var u=this;window.onresize=function(){u.mainAspect=n.clientWidth/n.clientHeight,u.ratio=n.clientWidth/r,u.setMiniRect()},this.inited=!0},e.prototype.create=function(){this.inited||(this.init3d(),this.scene.add(this.camera),this.camera.add(this.sprite))},e.prototype.setMiniRect=function(){this.miniDom.style.width=this.width+"px",this.miniDom.style.height=this.height+"px";var e=this;function t(t,i,r,n){e.miniDom.style.top=t,e.miniDom.style.left=i,e.miniDom.style.bottom=r,e.miniDom.style.right=n}var i=this.width/(.5*this.ratio),r=i*this.mainAspect;this.sprite.scale.set(i,r,1);var n,o,a=this.camera.right,s=this.camera.left;switch(this._posIndex){case 0:n=s+i/2,o=s+r/2,t("0px","0px",null,null);break;case 2:n=s+i/2,o=a-r/2,t(null,"0px","0px",null);break;case 1:n=a-i/2,o=s+r/2,t("0px",null,null,"0px");break;case 3:n=a-i/2,o=a-r/2,t(null,null,"0px","0px")}this.sprite.position.set(n,-o,0)},e.prototype.update=function(){var e=this.app.lighting,t=this.app.lighting;t.mainLight.intensity=0,t.secondaryLight.intensity=0,t.tertiaryLight.intensity=0,this.app.lighting=t;var i=this.app.scene.background;this.app.scene.background=null,this.app.renderer.setClearColor(0,0),this.app.renderer.setRenderTarget(this.renderTarget),this.app.renderer.clear(),this.app.renderer.render(this.app.scene,this.camera),this.app.lighting=e,this.app.scene.background=i},e.prototype.destroy=function(){var e=this.scene.children.length;if(0!=e){if(e>0)for(var t=0;t<e;t++)this.scene.remove(this.scene.children[t]);this.camera=null,this.sprite=null,null!=this.miniDom&&(this.app.domElement.removeChild(this.miniDom),this.miniDom=null)}},e.prototype.render=function(){if(this.miniDom)if(this._enable){this.miniDom.style.display="block";var e=this;if(this.miniDom.childNodes.forEach((function(t){t.style.display=e.bIcon?"block":"none"})),null!=this.camera&&null!=this.renderTarget){var t=this.app.renderer.autoClear;this.app.renderer.autoClear=!1,this.app.renderer.setRenderTarget(null),this.app.renderer.render(this.scene,this.camera),this.app.renderer.autoClear=t;var i=this.app.camera.position,r=new THREE.Vector3(i[0],i[1],i[2]);if(0!=this.angle){var n=new THREE.Vector3(this.center.x,r.y,this.center.y),o=r.sub(n);o.applyEuler(new THREE.Euler(0,-this.angle*Math.PI/180,0,"XYZ")),o.add(n),r.copy(o)}var a=this.transToMinimapCoord(r).x,s=this.transToMinimapCoord(r).y;this.setImage(a,s,this.app.camera.position[1]);var l=this.app.camera.camera.rotation,u="YXZ"==l.order?l.y:l.z,c=(document.getElementsByClassName("minimap_cameraCenter")[0],document.getElementsByClassName("minimap_cameraView")[0]),h=0;h=u>=0?u/Math.PI*180:180*(2-Math.abs(u)/Math.PI),c.style.transform="rotate("+(-h+this.angle)+"deg)",c.style.transformOrigin="50% 100%"}}else this.miniDom.style.display="none"},e.prototype.transToMinimapCoord=function(e){var t,i;i=t=this.width/2;var r,n,o=t/((this.camera.right-this.camera.left)/2);return e.hasOwnProperty("x")?(r=e.x-this.center.x,n=e.z-this.center.y):(r=e[0]-this.center.x,n=e[2]-this.center.y),{x:r>=0?t-o*r:t+o*Math.abs(r),y:n>=0?i-o*n:i+o*Math.abs(n)}},e.prototype.setImage=function(e,t,i){var r=(i>80?i-80:0)*(1/(220/30))+15;r>30&&(r=30);var n=document.getElementsByClassName("minimap_cameraCenter")[0],o=document.getElementsByClassName("minimap_cameraView")[0],a=r;e>=r/2&&e<=this.width-r/2&&t>=r/2&&this.width,n.style.position="absolute",n.style.width=r+"px",n.style.height=a+"px",n.style.right=e-r/2+"px",n.style.bottom=t-a+"px",o.style.right=e-20+"px",o.style.bottom=t-a/2+"px"},o(e,[{key:"scale",set:function(e){this._scale=e,this.destroy(),this.inited=!1,this.create()},get:function(){return this._scale}},{key:"opacity",set:function(e){this._opacity=e,this.sprite.material.opacity=this._opacity},get:function(){return this._opacity}},{key:"posIndex",set:function(e){this._posIndex=e,this.setMiniRect()},get:function(){return this._posIndex}},{key:"enable",set:function(e){this._enable=e},get:function(){return this._enable}}]),e}(),yl=function(){function e(t){n(this,e),this.minimap=null,this.param=t}return e.prototype.onAdd=function(e){null!=this.minimap&&this.onRemove(),this.param.app||(this.param.app=e),this.minimap=new vl(this.param)},e.prototype.onRemove=function(){this.minimap&&this.minimap.destroy()},e.prototype.onUpdate=function(){this.minimap&&this.minimap.render()},e}(),bl=function(){function e(){n(this,e),this.app=null,this.object=null,this._targetObject=null,this._target=new THREE.Vector3}return e.prototype.onAdd=function(e){this.app=e.app,this.object=e},e.prototype.onRemove=function(){this.app=null,this.object=null,this._targetObject=null},e.prototype.onUpdate=function(){return this.object.node.updateWorldMatrix(!0,!1),this.object.node.lookAt(this._target),this._targetObject&&this._target.fromArray(this._targetObject.position),!0},o(e,[{key:"target",set:function(e){e&&(e.isBaseObject?(this._targetObject=e,this._target.fromArray(e.position)):(this._targetObject=null,this._target.fromArray(e)))},get:function(){return this._targetObject||this._target.toArray()}}]),e}(),_l=new THREE.Matrix4,xl=new THREE.Vector3(0,0,0),El=new THREE.Vector3(0,1,0),wl=function(){function e(t){n(this,e),this.app=null,this.object=null,this._targetObject=null,this._target=new THREE.Vector3,t=t||{},this._alpha=t.alpha||45,this._beta=t.beta||45,this._radius=t.radius||30,this._dirty=!0}return e.prototype.onAdd=function(e){this.app=e.app,this.object=e},e.prototype.onRemove=function(){this.app=null,this.object=null,this._targetObject=null},e.prototype.onUpdate=function(){return this._dirty&&this._updateLocalTransform(),!0},e.prototype._updateLocalTransform=function(){var e=this.object.node.position;e.fromArray(THING.Math.directionFromAlphaBeta(this._alpha,this._beta)),e.normalize().multiplyScalar(this._radius);var t=this.object.node.quaternion,i=_l.lookAt(xl,e,El);t.setFromRotationMatrix(i),this._dirty=!1},o(e,[{key:"alpha",set:function(e){this._alpha=e,this._dirty=!0},get:function(){return this._alpha}},{key:"beta",set:function(e){this._beta=e,this._dirty=!0},get:function(){return this._beta}},{key:"radius",set:function(e){this._radius=e,this._dirty=!0},get:function(){return this._radius}}]),e}(),Tl=function(){function e(t){n(this,e),this.params=t,this.draggable=!0,t&&(this.draggable=ke.parseValue(t.draggable,!0))}return e.prototype.init=function(){var e=this,t=this.params;if(this.cameraTarget=function(e){var t=2,i=1218267,r=null;if(!e)return null;var n=e.size,o=e.color,a=e.url;if(null==a)return null;r=a,null!=n&&(t=n),null!=o&&(i=o);var s=app.create({type:"Marker",offset:[0,8,0],size:t,keepSize:!0,url:r,useSpriteMaterial:!1,angles:[90,0,0]});return s.style.alwaysOnTop=!0,s.style.color=i,s}(t),this.cameraTarget){o();var i=!1,r=null,n=!1;$(document).on("mousedown.ctctrl",(function(e){2==e.button&&(n=!0)})),$(document).on("mouseup.ctctrl",(function(t){if(2==t.button&&(n=!1),i=!1,e.app.camera.enablePan=!0,e.app.camera.enableRotate=!0,e.cameraTarget.style.color="#1296db",r){var o=new THREE.Vector3(r[0],r[1],r[2]),a=new THREE.Vector3(e.cameraTarget.position[0],e.cameraTarget.position[1],e.cameraTarget.position[2]).clone().sub(o);e.app.camera.position=[e.app.camera.position[0]+a.x,e.app.camera.position[1]+a.y,e.app.camera.position[2]+a.z],e.app.camera.target=e.cameraTarget.position,r=null}})),$(document).on("mousemove.ctctrl",(function(t){i&&(e.cameraTarget.position=e.app.camera.screenToWorld(t.pageX,t.pageY))})),this.cameraTarget.on("mouseenter",(function(){1==e.draggable&&(e.cameraTarget.style.color="#FE7F0B")})),this.cameraTarget.on("mouseleave",(function(){1!=e.draggable||i||(e.cameraTarget.style.color="#1296db")})),this.cameraTarget.on("mousedown",(function(){1==e.draggable&&(i=!0,e.app.camera.enablePan=!1,e.app.camera.enableRotate=!1,e.cameraTarget.style.color="#FE7F0B",r=e.cameraTarget.position)})),this.app.on("update",(function(e){n&&o()}))}function o(){var t=e.app.camera.screenToWorld(e.app.domElement.clientWidth/2,e.app.domElement.clientHeight/2);e.cameraTarget.position=t}},e.prototype.onAdd=function(e){this.app=e,this.init()},e.prototype.onRemove=function(){$(document).off(".ctctrl"),this.cameraTarget&&this.cameraTarget.destroy()},e}(),Sl=function(){function e(t){n(this,e),this._object=t.object,this._updateTime=this._timeCount=t.updateTime||200,this.app=this._object.app}return e.prototype.onUpdate=function(){var e=this;if(this._object&&this._object._ground&&this._object._ground.material&&(this._timeCount+=this.app.deltaTime,this._timeCount>this._updateTime)){var t=.01,i=1,r=Zn.count;if(r){var n=function(){var t=null,i=THING.Math.getAngleBetweenVectors(e._object.up,e.app.camera.direction)/45,r=parseInt(i);0==r||2==r?t=i-parseInt(i):1!=r&&3!=r&&4!=r||(t=1-(i-parseInt(i)));return t}();if(n){t=n,i=n<.3?100:100*n+1;var o=this._object._ground.material;o.polygonOffsetFactor=t,o.polygonOffsetUnits=(r-this._object._level)*i}}this._timeCount=0}return!0},e.prototype.onRemove=function(){this._object=null,this.app=null},e}(),Al=function(){function e(t,i){n(this,e),this._candidates=t,this._options=i||{},this._app=null,this._objects=[],this._previousObjects=[],this._started=!1}return e.prototype.onAdd=function(e){this._app=e,this._app.focus(),this._objects=new ct(this._app,[]),this._previousObjects=this._objects,this.start()},e.prototype.onRemove=function(){this.end()},e.prototype._start=function(e){if(e){this.candidates=this._candidates;var t=this._options.start;t&&t.call(this,{candidates:this.candidates});var i=this;this._app.camera.inputEnabled=!1,this._app.picker.startAreaPicking({x:e.x,y:e.y}),this._app.on("pick",".Thing",(function(e){var t=i._options.select;if(t&&t.call(i,e),!e._stopPropagation){var r=i._options.outlineColor||"#FF8000";e.object.style.outlineColor=r}}),"RectangleSelectControl_pick"),this._app.on("unpick",".Thing",(function(e){var t=i._options.deselect;t&&t.call(i,e),e._stopPropagation||(e.object.style.outlineColor=null)}),"RectangleSelectControl_unpick"),this._app.on(k.AreaPickEnd,(function(e){i._previousObjects=i._objects,i._objects=i._app.picker.objects.concat()}),"RectangleSelectControl_AreaPickEnd"),this._started=!0}},e.prototype._end=function(){if(this._started){this._started=!1,this._app.picker.endAreaPicking(),this._app.off("pick",".Thing","RectangleSelectControl_pick"),this._app.off("unpick",".Thing","RectangleSelectControl_unpick"),this._app.off(k.AreaPickEnd,null,"RectangleSelectControl_AreaPickEnd"),this._app.camera.inputEnabled=!0;var e=this._options.end;e&&e.call(this,{candidates:this.candidates})}},e.prototype.start=function(){var e=this;this._app.on("mousedown",(function(t){0==t.button&&e._start(t)}),"RectangleSelectControl_mousedown"),this._app.on("mouseup",(function(t){0==t.button&&e._end()}),"RectangleSelectControl_mouseup")},e.prototype.end=function(){this._end(),this._app.off("mousedown",null,"RectangleSelectControl_mousedown"),this._app.off("mouseup",null,"RectangleSelectControl_mouseup"),this._app.off("pick",".Thing","RectangleSelectControl_pick"),this._app.off("unpick",".Thing","RectangleSelectControl_unpick")},e.prototype.clear=function(){if(this._objects.length){for(var e=0;e<this._objects.length;e++){var t=this._objects,i=this._options.deselect;i&&i.call(t,{object:t})}this._objects.clear()}},o(e,[{key:"candidates",set:function(e){this._app.picker.areaCandidates=e},get:function(){return this._app.picker.areaCandidates}},{key:"options",set:function(e){this._options=e},get:function(){return this._options}},{key:"previousObjects",get:function(){return this._previousObjects}},{key:"objects",get:function(){return this._objects}}]),e}(),Ml=function(){function e(){n(this,e),this.object=null,this.app=null,this._height=0,this._box=null,this._pickResults=null}return e.prototype._setupBox=function(){this._box&&(this.app.resourceManager.remove(this._box),this._box=null);var e=this.object.boundingBox.size,t=new THREE.BoxGeometry(e[0],e[1],e[2]),i=new THREE.EdgesGeometry(t);this._box=new THREE.LineSegments(i),this.object.node.add(this._box);var r=ke.parseVector3(this.object.boundingBox.center);this._box._setWorldPosition(r,!1,this.object.static);for(var n=[16711680,65280,255,0],o=0;o<4;o++){(t=new THREE.Geometry).vertices.push(new THREE.Vector3),t.vertices.push(new THREE.Vector3);var a=new THREE.LineBasicMaterial({color:n[o]}),s=new THREE.Line(t,a);s.visible=!1,this._box.add(s)}},e.prototype._useCenterMode=function(){var e=this.object.angles,t=THING.Math.abs(e[1]);return t<1e-5||(!!THING.Math.isFloatEquals(t,90)||(!!THING.Math.isFloatEquals(t,180)||!!THING.Math.isFloatEquals(t,270)))},e.prototype._updatePickedResult=function(){for(var e=[new THREE.Raycaster,new THREE.Raycaster,new THREE.Raycaster,new THREE.Raycaster],t=[],i=this._box.geometry.attributes.position.array,r=0;r<i.length;r+=3){var n=new THREE.Vector3(i[r],i[r+1],i[r+2]);if(!(n.y<0)){for(var o=!1,a=0;a<t.length;a++)t[a].equals(n)&&(o=!0);o||t.push(n)}}var s,l,u,c;if(this.object.node.updateMatrixWorld(),this._useCenterMode()){var h=[];for(r=0;r<t.length;r++)h.push(t[r].clone());t[0].addVectors(h[0],h[1]).divideScalar(2),t[1].addVectors(h[1],h[2]).divideScalar(2),t[2].addVectors(h[2],h[3]).divideScalar(2),t[3].addVectors(h[3],h[0]).divideScalar(2)}for(r=0;r<t.length;r++){var p=(d=e[r]).ray.origin;p.set(t[r].x,this._height-this._box.position.y,t[r].z),p=this._box.localToWorld(p),(!s||p.x<s.ray.origin.x)&&(s=d),(!u||p.z<u.ray.origin.z)&&(u=d),(!l||p.x>l.ray.origin.x)&&(l=d),(!c||p.z>c.ray.origin.z)&&(c=d)}s.ray.direction.set(-1,0,0),u.ray.direction.set(0,0,-1),l.ray.direction.set(1,0,0),c.ray.direction.set(0,0,1),this._pickResults=[];for(r=0;r<e.length;r++){var d,f=(d=e[r]).intersectObject(this.app.scene,!0);for(a=0;a<f.length;a++){if(!(g=f[a]).object.isChildOf(this.object.node))break;f.splice(a--,1)}this._pickResults.push({startPosition:d.ray.origin.toArray(),pickedPosition:null,pickedObject:null,distance:100,direction:d.ray.direction.toArray()});var m=this._pickResults[r];if(f.length){var g=f[0];m.pickedPosition=g.point.toArray(),m.pickedObject=this.app.objectManager.getBaseObject(g.object),m.distance=g.distance}}var v=this._pickResults;for(r=0;r<v.length;r++){var y,b,_=v[r],x=this._box.children[r];if(y=ke.parseVector3(_.startPosition),_.pickedPosition)b=ke.parseVector3(_.pickedPosition);else{var E=new THREE.Vector3,w=ke.parseVector3(_.direction);E.addVectors(ke.parseVector3(_.startPosition),w.multiplyScalar(100)),b=E}y=x.worldToLocal(y),b=x.worldToLocal(b),x.geometry.vertices[0].copy(y),x.geometry.vertices[1].copy(b),x.geometry.verticesNeedUpdate=!0,x.geometry.elementsNeedUpdate=!0,x.computeLineDistances()}return this._pickResults},e.prototype.onAdd=function(e){this.object=e,this.app=e.app,this.height=this.object.boundingBox.size[1]/2},e.prototype.onRemove=function(){this._box&&(this.app.resourceManager.remove(this._box),this._box=null)},e.prototype.onUpdate=function(e){return!1},o(e,[{key:"height",set:function(e){this._height=e},get:function(){return this._height}},{key:"visible",set:function(e){this._box||this._setupBox(),this._box.visible=e},get:function(){return!!this._box&&this._box.visible}},{key:"lineVisible",set:function(e){this._box||this._setupBox(),this._box.children.forEach((function(t){t.visible=e}))},get:function(){return!!this._box&&this._box.children[0].visible}},{key:"pickResults",get:function(){return this._updatePickedResult(),this._pickResults}}]),e}(),Cl=function(){function e(){n(this,e),this._object=null,this._prevCameraInfo={}}return e.prototype.onAdd=function(e){this.app=e;var t=this.app.camera;this._prevCameraInfo={enablePan:t.enablePan,autoAdjustTarget:t.autoAdjustTarget,enableUpdateTargetOnWheel:t.enableUpdateTargetOnWheel,distanceLimited:t.distanceLimited,dampingFactor:t.dampingFactor},t.enablePan=!1,t.autoAdjustTarget=!1,t.enableUpdateTargetOnWheel=!1,t.dampingFactor=.05},e.prototype.onRemove=function(){var e=this.app.camera;for(var t in this._prevCameraInfo)e[t]=this._prevCameraInfo[t]},e.prototype.onUpdate=function(e){},e.prototype._getObject=function(e){var t=e.target;if(t)return t;var i=e.url;if(i){var r=this,n=e.time||1e3,o=e.distance||10,a=e.direction,s=e.complete;this.app.create({type:"Thing",url:i,position:this.getNextObjectPosition(e),nodeReady:function(e){setTimeout((function(){r.lookAt({target:e.object,time:n,distance:o,direction:a,complete:s})}),10)}})}return null},e.prototype.getNextObjectPosition=function(e){if(e=e||{},this._object){var t=e.distance||10,i=this.app.camera.rightDirection;return-1===e.direction&&(i=THING.Math.negVector(i)),this._object.getWorldPosition({direction:i,distance:t})}return[0,0,0]},e.prototype.lookAt=function(e){e=e||{};var t=this._getObject(e);if(t){var i=this,r=e.time||1e3,n=e.complete,o=this.app.camera,a=t.boundingBox.radius;if(this._object){var s=e.distance||10,l=(r=e.time||1e3,e.lerpType||THING.LerpType.Quartic.Out),u=o.rightDirection;-1===e.direction&&(u=THING.Math.negVector(u));var c=t.getWorldPosition({direction:u,distance:s});t.position=c,t.lerpTo({from:{position:c},to:{position:[0,0,0]},time:r,lerpType:l},"modelViewControl_lerp_fadeIn"),t.fadeIn({time:r}),this._object.lerpTo({from:{position:this._object.position},to:{position:this._object.getWorldPosition({direction:THING.Math.negVector(u),distance:s})},time:r,lerpType:l,stop:function(e){e.object.destroy()},complete:function(e){e.object.destroy(),n&&n.call(i,{object:i._object})}},"modelViewControl_lerp_fadeOut"),this._object.fadeOut({time:r/2})}else o.flyTo({target:t,xAngle:0,yAngle:0,time:r,complete:function(){n&&n.call(i,{})}});this._object=t,o.distanceLimited=[.5*a,4*a]}},o(e,[{key:"object",get:function(){return this._object}}]),e}(),Rl=function(e){return!e.isLight&&!e.userData.skipBoundingBox};function Dl(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(e){var o=i[e.uuid];if(!(o===L.Stop&&n>0)&&(o===L.Jump||(r[e.uuid]&&console.log("% :已经存在"),e.uuid&&e.material&&(e.selections||(e.selections={}),e.selections[this.name]=this,r[e.uuid]=e)),t&&e.children.length>0))for(var a=0;a<e.children.length;a++)Dl.call(this,e.children[a],t,i,r,n+1)}}function Pl(e){for(var t in e){var i=e[t];if(i.selections){i.selections[this.name];delete i.selections[this.name]}delete this._nodesResult[t]}}function jl(e){void 0===e&&(e=THREE.Math.generateUUID()),this.name=e,this._nodesMark={},this._nodesResult={}}function Fl(e){for(var t in e){var i=e[t].material;if(i&&!this._nodesMap[t]){e[t].modifiers||(e[t].modifiers=[]),e[t].modifiers.push(this),this._nodesMap[t]=e[t];var r=i,n=r.uuid,o=this._materialCopy[n],a=o&&o.material;if(!o){a=(o=this._materialCopy[n]={refrence:0,material:i.clone()}).material;var s=-1===this._trans?r.opacity:this._trans;this.override?(a.opacity=s,this._colour.x+this._colour.y+this._colour.z>-1&&(a.alphaColor=this._colour.clone(),a.override_color=this._colour.clone())):r.override_color?(a.opacity=r.opacity,a.alphaColor.clone(r.override_color),a.override_color.clone(r.override_color)):(a.opacity=s,this._colour.x+this._colour.y+this._colour.z>-1&&a.color.setRGB(this._colour.x,this._colour.y,this._colour.z)),a.opacity<1&&(a.transparent=!0,a.depthWrite=!1),this._isFlashing&&(a.alphaColor.w=0),a.needsUpdate=!0}o.refrence++,e[t][this.bak_name]=e[t].material,e[t].material=a}}}function Ol(e,t){Array.isArray(t)||(t=[]);var i=e.modifiers.indexOf(this);if(i<0||i==e.modifiers.length-1)return t;(t=e.modifiers.splice(i+1)).reverse();for(var r=0;r<t.length;r++){var n=t[r],o={};o[e.name]=e,Ll.call(n,o)}return t}function kl(e,t){if(Array.isArray(t)&&!(t.length<1))for(var i=0;i<t.length;i++){var r=t[i],n={};n[e.name]=e,Fl.call(r,n)}}function Ll(e){var t=this.bak_name;for(var i in e)if(this._nodesMap[i]&&(delete this._nodesMap[i],e[i].modifiers)){var r=Ol.call(this,e[i]),n=e[i].modifiers.pop();if(n==this){if(e[i].material&&e[i][t]){var o=e[i].material=e[i][t],a=(e[i].material=o).uuid;delete e[i][t],this._materialCopy[a]?("number"==typeof this._materialCopy[a].refrence?this._materialCopy[a].refrence--:console.log("[%s] didn't found",a),this._materialCopy[a].refrence<1&&delete this._materialCopy[a]):console.log("[%s] didn't found",a)}kl.call(this,e[i],r)}else e[i].modifiers.push(n)}}function Bl(e){void 0===e&&(e=THREE.Math.generateUUID()),this.name=e,this.bak_name="t3d_material_bak_"+this.name,this._trans=-1,this._seletions=[],this._nodesMap={},this.autoUpdate=!1,this._autoUpdateID=null,this.fadeSpeed=1,this.flashSpeed=1,this._isFading=!1,this._isFlashing=!1,this.flashLoop=!1,this._updateQueen=[],this._removeQueen=[],this.override=!1,this._materialCopy={},this._colour=new THREE.Vector4(-1,-1,-1,0)}function Hl(e,t,i){var r=e.begin||(new Date).getTime(),n=isNaN(e.from)?0:e.from,o=isNaN(e.to)?1:e.to,a=e.during,s=e.func;return function(e){"reset"===e&&(r=(new Date).getTime());var l=(new Date).getTime()-r;if(l<=a){var u=s(l,0,1,a);return t(n+(o-n)*u),!0}if(l>a){t(o);var c=i();return r=(new Date).getTime(),c}}}jl.prototype.toString=function(){return this.name},jl.prototype.setAutoResetMark=function(e){},jl.prototype.getAutoResetMark=function(){},jl.prototype.mark=function(e,t){null!=e&&(this._nodesMark[e.uuid]=t)},jl.prototype.markSelection=function(e,t){for(var i in e._nodesResult)this._nodesMark[e._nodesResult[i].uuid]=t},jl.prototype.getMark=function(e){var t=L.None;return e&&(t=(t=this._nodesMark[e.uuid])||L.None),t},jl.prototype.getAllNameString=function(){var e=this._nodesResult,t=[];for(var i in e)t.push(e[i].name);return t.join(";")},jl.prototype.select=function(e,t){var i={};for(var r in Dl.call(this,e,t,this._nodesMark,i),i)this._nodesResult[r]=i[r]},jl.prototype.reselect=function(e,t){Pl.call(this,this._nodesResult),Dl.call(this,e,t,this._nodesMark,this._nodesResult)},jl.prototype.unselect=function(e,t){var i={};t?Dl.call(this,e,t,this._nodesMark,i):i[e.uuid]=e,Pl.call(this,i)},jl.prototype.deselect=function(e,t){var i={};Dl.call(this,e,t,this._nodesMark,i),Pl.call(this,i),this._nodesResult=i},jl.prototype.selectList=function(e,t){if(e&&Array.isArray(e))for(var i=0;i<e.length;i++)this.select(e[i],t)},jl.prototype.unselectList=function(e,t){if(e&&Array.isArray(e))for(var i=0;i<e.length;i++)this.unselect(e[i],t)},jl.prototype.isEmpty=function(){for(var e in this._nodesResult)return!1;return!0},jl.prototype.merge=function(e,t){var i=e._nodesResult,r=this._nodesResult;for(var n in i)r[n]=i[n]},jl.prototype.unmerge=function(e,t){var i=e._nodesResult,r=this._nodesResult;for(var n in i)delete r[n]},jl.prototype.getWorldAABB=function(e){var t=this._nodesResult,i=new THREE.Box3,r=function(e){return o=new THREE.Box3,t[e]?("Billboard"==t[e].typeName?o.setFromObject(t[e]):t[e]&&((a=new THREE.Box3)._setFromObject(t[e],(function(i){return i==t[e]&&(!!Rl(i)&&void 0)})),o=a.clone()),s=new THREE.Vector3,o.getSize(s),0===s.x&&0===s.y&&0===s.z?"continue":void i.union(o)):"continue"};for(var n in t){var o,a,s;r(n)}var l=new THREE.Vector3;i.getCenter(l),l.x||l.y||l.z||(l.x=0,l.y=0,l.z=0);var u=new THREE.Vector3;return i.getSize(u),{center:[l.x,l.y,l.z],radius:Math.sqrt(Math.pow(u.x,2)+Math.pow(u.y,2)+Math.pow(u.z,2))/2,width:u.x,height:u.y,depth:u.z}},jl.prototype.getWorldOBB=function(e){var t=this._nodesResult,i=new THREE.Group;for(var r in e.add(i),i.updateWorldMatrix(!0,!0),t){var n=t[r];if(n){n.updateWorldMatrix(!0,!0);var o=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Quaternion;n.matrixWorld.decompose(o,s,a);var l=n.clone();l.position.copy(o),l.quaternion.copy(s),l.scale.copy(a),l.attachToParent(i),l.updateWorldMatrix(!0,!0)}}e.updateWorldMatrix(!0,!0);var u=new THREE.Matrix4;u.getInverse(e.matrixWorld);var c=new THREE.Box3;c._setFromObject(e,Rl,(function(e){e.applyMatrix4(u)}));var h=[];c.getBoundingPositions().forEach((function(t){var i=t.clone();i.applyMatrix4(e.matrixWorld),h.push(i.toArray())}));var p=c,d=new THREE.Vector3;p.getCenter(d),d.x||d.y||d.z||(d.x=0,d.y=0,d.z=0);var f=new THREE.Vector3;p.getSize(f);var m={points:h,center:[d.x,d.y,d.z],radius:Math.sqrt(Math.pow(f.x,2)+Math.pow(f.y,2)+Math.pow(f.z,2))/2,width:f.x,height:f.y,depth:f.z};return e.remove(i),m},jl.prototype.setQueryFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].setQueryFlags(e)},jl.prototype.addQueryFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].addQueryFlags(e)},jl.prototype.removeQueryFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].removeQueryFlags(e)},jl.prototype.setPickEnabled=function(e){for(var t in this._nodesResult)this._nodesResult[t].setPickEnabled(e)},jl.prototype.showBoundingBox=function(e){},jl.prototype.show=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(var t in this._nodesResult)this._nodesResult[t].show(e)},jl.prototype.setDepthCheckEnabled=function(e){for(var t in this._nodesResult){var i=this._nodesResult[t];i&&i.material&&(i.material.depthTest=e)}},jl.prototype.clone=function(e){var t=new jl(e);for(var i in this._nodesMark)t._nodesMark[i]=this._nodesMark[i];for(var r in this._nodesResult)t._nodesResult[r]=this._nodesResult[r];return t},jl.prototype.clear=function(){for(var e in this._nodesResult)delete this._nodesResult[e]},jl.prototype.destroy=function(){for(var e in this._nodesMark)delete this._nodesMark[e];for(var t in this._nodesResult)delete this._nodesResult[t]},jl.prototype.updateBounds=function(){},jl.prototype.setRenderQueueGroup=function(e){for(var t in this._nodesResult)this._nodesResult[t].setRenderQueueGroup(e)},jl.prototype.removeAllModifiers=function(){for(var e in this._nodesResult){var t=this._nodesResult[e];t&&t.node&&t.node.modifiers&&(t.node.modifiers.length=0)}},jl.prototype.setVisibilityFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].setVisibilityFlags(e)},jl.prototype.addVisibilityFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].addVisibilityFlags(e)},jl.prototype.removeVisibilityFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].removeVisibilityFlags(e)},jl.prototype.setCustomParameter=function(e,t){for(var i in this._nodesResult)this._nodesResult[i].setCustomParameter(e,t)},Bl.prototype.toString=function(){return this.name},Bl.prototype.getId=function(){console.log("[%s] didn't ready","MaterialModifier.getId")},Bl.prototype.setAutoUpdate=function(e){this.autoUpdate=e,this.autoUpdateRunner()},Bl.prototype.getAutoUpdate=function(){return this.autoUpdate},Bl.prototype.autoUpdateRunner=function(){this._autoUpdateID&&(cancelAnimationFrame(this._autoUpdateID),this._autoUpdateID=!1);var e=this;e.autoUpdate&&function t(){e._autoUpdateID&&(cancelAnimationFrame(e._autoUpdateID),e._autoUpdateID=0);e.update(),e.autoUpdate&&(e._autoUpdateID=requestAnimationFrame(t))}()},Bl.prototype.setTransparency=function(e){this._trans=e},Bl.prototype.getTransparency=function(){return this._trans},Bl.prototype.fade=function(e,t){this._seletions.length;var i=1e3/this.fadeSpeed,r=this;this._isFading=!0;var n=Hl({from:e,to:t,during:i,func:TWEEN.Cubic.easeOut,begin:(new Date).getTime()},(function(e){for(var t in r._materialCopy){var i=r._materialCopy[t].material;i&&((i=i.getTechnique(0).getPass(0).material).transparent=!0,i.opacity=e)}}),(function(){return r._isFading=!1,!1}));r._updateQueen.push(n)},Bl.prototype.fadeIn=function(){this._seletions.length;var e=this._trans;this.fade(e,1)},Bl.prototype.fadeOut=function(){this._seletions.length;var e=this._trans;this.fade(e,0)},Bl.prototype.setFadeSpeed=function(e){0!==e&&(this.fadeSpeed=e)},Bl.prototype.isFading=function(){return this._isFading},Bl.prototype.setColour=function(e,t,i,r){this._colour.x=e,this._colour.y=t,this._colour.z=i,this._colour.w=r},Bl.prototype.flash=function(e,t){e<t&&(t=Math.min(this._trans,t),e=Math.max(e,.01));var i=this;this._isFlashing=!0;var r=Hl({from:0,to:1,during:1e3,func:TWEEN.Linear,begin:(new Date).getTime()},(function(r){var n=e+(t-e)*r;for(var o in i._materialCopy){var a=i._materialCopy[o].material;a&&((a=a.getTechnique(0).getPass(0).material).override_color?a.override_color&&i.override?a.alphaColor.w=n:a.alphaColor=a.backup_color:a.alphaColor.w=n)}}),(function(){var i=e;return e=t,t=i,!0}));i._updateQueen.push(r),this.autoUpdateRunner()},Bl.prototype.setFlashSpeed=function(e){this.flashSpeed=e},Bl.prototype.setFlashLoop=function(e){this.flashLoop=e},Bl.prototype.isFlashing=function(){return this._isFlashing},Bl.prototype.getFlashValue=function(){console.log("[%s] didn't ready","MaterialModifier.getFlashValue")},Bl.prototype.setOverride=function(e){this.override=e},Bl.prototype.getAllSceneNodeNames=function(){console.log("[%s] didn't ready","MaterialModifier.getAllSceneNodeNames")},Bl.prototype.getModifiedMaterialNameString=function(){console.log("[%s] didn't ready","MaterialModifier.getModifiedMaterialNameString")},Bl.prototype.addSceneNode=function(e){var t={};t[e.uuid]=e,Fl.call(this,t)},Bl.prototype.removeSceneNode=function(e){var t={};t[e.uuid]=e,Ll.call(this,t)},Bl.prototype.addSceneNodeSelection=function(e){this._seletions.push(e);var t=e._nodesResult;Fl.call(this,t)},Bl.prototype.removeSceneNodeSelection=function(e){var t=e._nodesResult;Ll.call(this,t);var i=this._seletions.indexOf(e);i>-1&&this._seletions.splice(i,1)},Bl.prototype.enable=function(){console.log("[%s] didn't ready","MaterialModifier.enable")},Bl.prototype.disable=function(){console.log("[%s] didn't ready","MaterialModifier.disable")},Bl.prototype.update=function(e){for(var t=0;t<this._removeQueen.length;t++){var i=this._removeQueen[t],r=this._updateQueen.indexOf(i);r>-1&&this._updateQueen.splice(r,1)}this._removeQueen.length=0;for(var n=0;n<this._updateQueen.length;n++){var o=this._updateQueen[n];if("function"==typeof o)o()||this._removeQueen.push(o);else this._removeQueen.push(o)}},Bl.prototype.setOverrideDepthCheckEnabled=function(e,t){console.log("[%s] didn't ready","MaterialModifier.setOverrideDepthCheckEnabled")},Bl.prototype.setOverrideDepthBias=function(e,t,i){console.log("[%s] didn't ready","MaterialModifier.setOverrideDepthBias")},Bl.prototype.setColourPassDepthWriteEnabled=function(e){console.warn("MaterialModifier.prototype.setColourPassDepthWriteEnabled")};e.DEFAULT_EXTENSIONS=[],e.REVISION="77dec4c7d8da8427bd4cf97588178414c4f5e085no",e.VERSION="1.2.6.3",e.COMPILETIME="Thu, 16 Apr 2020 01:51:05 GMT",e.App=el,e.BaseObject=bt,e.SubObject=tl,e.BatchSubObject=Yt,e.BatchObject=Xt,e.Ground=pi,e.Facade=kt,e.Building=On,e.Floor=hr,e.Room=kn,e.Thing=Bt,e.Box=Kt,e.Circle=$t,e.Sphere=ei,e.Plane=ti,e.Grid=ii,e.Cylinder=ri,e.Tetrahedron=ni,e.Frustum=oi,e.Shape=ai,e.Door=si,e.ElevatorDoor=li,e.Elevator=ui,e.StairDoor=ci,e.Stair=hi,e.VideoSurvilance=di,e.Line=uo,e.PolygonLine=So,e.RouteLine=To,e.Points=Ao,e.Water=Xo,e.WebView=fa,e.TextRegion=Yn,e.CombinedObject=cr,e.Fence=Jn,e.CurveFence=Qn,e.Region=Zn,e.PolygonRegion=$n,e.Marker=da,e.Heatmap=io,e.IDWMap=ao,e.Campus=Et,e.Group=dr,e.Camera=Cs,e.ImageProxy=function e(t){return n(this,e),function(e,t){e[il.private]={};var i=e[il.private];THING.App.current,i.init=function(){i.handler={set:function(e,t,r){if("src"===t){var n=i.proxy.onloadstart;n&&n(e,r);var o=i.proxy.onloadend;if(o){e.addEventListener("load",(function t(){o(e),e.removeEventListener("load",t)}),!1),e.addEventListener("error",(function t(){o(e),e.removeEventListener("error",t)}),!1)}}return e[t]=r},get:function(e,t){return"addEventListener"==t||"removeEventListener"==t?function(){e[t](arguments[0],arguments[1],arguments[2])}:e[t]}},i.image=t.image||new Image(t.width,t.height)},i.createProxy=function(){var e=new Proxy(i.image,i.handler);return e.isProxy=!0,e.getTarget=function(){return i.image},i.proxy=e,e},i.handler=null,i.image=null,i.proxy=null,i.init()}(this,t),this[il.private].createProxy()},e.CameraController=Rs,e.Selector=ct,e.Navigation=Ns,e.factory=Ea,e.StyleManager=Ba,e.ThemeManager=Vn,e.BaseStyle=zn,e.Helper=ol,e.CameraControl=cl,e.CompassControl=hl,e.FlyControl=pl,e.WalkControl=ml,e.WalkButtonControl=gl,e.MiniMapControl=yl,e.AxisTransformControl=Bs,e.LookAtControl=bl,e.AroundControl=wl,e.CameraTargetControl=Tl,e.RegionAutoOffset=Sl,e.RectangleSelectControl=Al,e.MeasurementControl=Ml,e.BoundingBoxControl=Ke,e.ModelViewControl=Cl,e.SizeAdjustmentControl=ft,e.Math=B,e.TextKeyEncoder=u,e.Utils=ke,e.SceneNodeSelection=jl,e.MaterialModifier=Bl,e.LerpType=A,e.CornerType=M,e.SpaceType=C,e.CameraProjectionType=T,e.CameraView=S,e.DistributionsType={Box:1,Sphere:2,Disc:3},e.BlendingType={No:"no",Normal:"normal",Additive:"add",Subtractive:"subtract",Multiply:"multiply"},e.WrapType={Repeat:"repeat",ClampToEdge:"clamptoedge",MirroredRepeat:"mirroredrepeat"},e.LoopType=D,e.DragState=R,e.AreaPickType=P,e.SkyBox={BlueSky:"BlueSky",MilkyWay:"MilkyWay",Night:"Night",SunCloud:"SunCloud"},e.IndependentControlType=j,e.LevelType={Unknown:"",Campus:"Campus",Building:"Building",Floor:"Floor",Room:"Room",Thing:"Thing"},e.LayoutType={Left:"Left",Right:"Right",Top:"Top",Bottom:"Bottom",Front:"Front",Back:"Back",Center:"Center"},e.KeyType=F,e.EventTag=O,e.EventType=k,e.ModifierType={Material:513,TransparencyColour:513,AutoRotation:257,AutoScale:258},e.SelectionMark=L,Object.defineProperty(e,"__esModule",{value:!0})}));